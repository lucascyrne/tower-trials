â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                     FIX: ERRO DE SLOTS DE POÃ‡ÃƒO                              â•‘
â•‘                          Resumo Executivo                                    â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ“‹ PROBLEMA
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
Erro ao usar poÃ§Ãµes em batalha:
  â€¢ Code: 42702
  â€¢ Message: column reference "slot_position" is ambiguous
  â€¢ Context: POST /rpc/get_character_potion_slots â†’ 400 Bad Request

ğŸ” CAUSA
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
1. FunÃ§Ã£o RPC get_character_potion_slots tem ORDER BY ambÃ­guo
   - MÃºltiplos JOINs com mesma coluna
   - Falta qualificaÃ§Ã£o: "slot_position" â†’ "ps.slot_position"

2. FunÃ§Ã£o consume_potion_from_slot NÃƒO EXISTE
   - Criada em slot.service.ts mas nÃ£o implementada no DB
   - Resultado: RPC call falha com 404/Function Does Not Exist

âœ… SOLUÃ‡ÃƒO
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
Nova migraÃ§Ã£o: supabase/migrations/00016_fix_slot_functions.sql

CorreÃ§Ã£o 1: get_character_potion_slots
  â€¢ Qualifica todas as colunas com alias de tabela (ps., c., cc.)
  â€¢ ORDER BY ps.slot_position (nÃ£o ambÃ­guo)

CorreÃ§Ã£o 2: consume_potion_from_slot (CRIADA)
  â€¢ Valida slot position (1-3)
  â€¢ ObtÃ©m consumable_id do slot
  â€¢ Chama consume_potion()
  â€¢ Limpa slot se vazio

ğŸ“¦ COMO APLICAR
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
OpÃ§Ã£o 1: Supabase CLI (Recomendado)
  $ cd tower-trials
  $ npx supabase db push

OpÃ§Ã£o 2: Supabase Dashboard
  1. Acesse https://app.supabase.com
  2. SQL Editor â†’ New Query
  3. Cole conteÃºdo de supabase/migrations/00016_fix_slot_functions.sql
  4. Run

ğŸ§ª VERIFICAÃ‡ÃƒO
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
SQL:
  SELECT * FROM get_character_potion_slots('UUID');
  â†’ Deve retornar 3 linhas (1 para cada slot)

Browser Console:
  const { data, error } = await supabase.rpc('get_character_potion_slots', {
    p_character_id: 'UUID_DO_PERSONAGEM'
  });
  console.log(data, error);  // NÃ£o deve ter erro

Em Batalha:
  â€¢ Pressionar Q/W/E para usar poÃ§Ãµes
  â€¢ Verificar se HP/Mana atualizam
  â€¢ Verificar se poÃ§Ã£o nÃ£o pode ser usada 2x

ğŸ“Š IMPACTO
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
Afetado:
  âœ… CombinedBattleInterface.tsx â†’ Usa poÃ§Ãµes normalmente
  âœ… game-battle.tsx â†’ Slots carregam e recarregam
  âœ… QuickActionPanel.tsx â†’ Dados dos slots aparecem
  âœ… slot.service.ts â†’ RPC funciona sem erro

Status:
  âŒ ANTES: Erro ao usar poÃ§Ã£o, interface travada
  âœ… DEPOIS: PoÃ§Ã£o funciona, batalha continua

ğŸ“ ARQUIVOS
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
Criados:
  â€¢ supabase/migrations/00016_fix_slot_functions.sql (migraÃ§Ã£o)
  â€¢ docs/SLOT_FUNCTIONS_FIX.md (documentaÃ§Ã£o completa)
  â€¢ docs/SLOT_FUNCTIONS_BEFORE_AFTER.md (comparaÃ§Ã£o antes/depois)
  â€¢ MIGRATION_FIX_INSTRUCTIONS.md (instruÃ§Ãµes de aplicaÃ§Ã£o)

ğŸ¯ PRÃ“XIMOS PASSOS
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
1. Aplicar migraÃ§Ã£o (conforme instruÃ§Ãµes acima)
2. Testar uso de poÃ§Ãµes em batalha
3. Verificar que slots recarregam corretamente
4. Confirmar que limite de 1 poÃ§Ã£o por turno funciona
5. Fazer deploy para produÃ§Ã£o

âœ¨ STATUS: PRONTO PARA DEPLOY âœ¨

