import{u as e,f as s,r as a,j as l}from"./unknown-BjZws6l5.js";import{C as t,S as r,B as n,a as c,b as i,c as o,d,I as m,e as x,f as h}from"./main-BRzRyVm5.js";import{t as u}from"./unknown-Chho9maJ.js";import{Y as j,ay as p,aU as g,a5 as f,ah as N,a9 as v,bq as b,aO as w,aB as y,az as _,a1 as S,X as C,b0 as k,a2 as E,a0 as M,a8 as q}from"./unknown-CWUl0966.js";import"./unknown-DE60C25c.js";import"./unknown-CgHcGUJm.js";function T(){const T=e(),$=s({from:"/_authenticated/game/play/hub/spells"}).character,[O,D]=a.useState(null),[z,B]=a.useState([]),[L,V]=a.useState(null),[A,I]=a.useState({slot1:null,slot2:null,slot3:null}),[F,G]=a.useState({slot1:null,slot2:null,slot3:null}),[J,P]=a.useState(!0),[H,R]=a.useState(!1),[U,Y]=a.useState(""),[K,Q]=a.useState("all"),[W,X]=a.useState("all");a.useEffect((()=>{if(!$)return u.error("Personagem não especificado"),void T({to:"/game/play"});Z()}),[$,T]);const Z=async()=>{if($){P(!0);try{const e=await t.getCharacter($);if(!e.success||!e.data)throw new Error("Erro ao carregar personagem");D(e.data);const s=await r.getCharacterAvailableSpells($);if(!s.success||!s.data)throw new Error("Erro ao carregar magias");B(s.data);const a=await r.getCharacterSpellStats($);a.success&&a.data&&V(a.data);const l=s.data.filter((e=>e.is_equipped)),n={slot1:l.find((e=>1===e.slot_position))||null,slot2:l.find((e=>2===e.slot_position))||null,slot3:l.find((e=>3===e.slot_position))||null};I(n),G(n)}catch(e){u.error("Erro ao carregar dados das magias")}finally{P(!1)}}},ee=(e,s)=>{I((a=>{const l={...a};return Object.keys(l).forEach((s=>{const a=s;l[a]?.id===e.id&&(l[a]=null)})),l[s]=e,l}))},se=e=>{I((s=>({...s,[e]:null})))},ae=e=>({damage:l.jsx(y,{className:"h-5 w-5"}),heal:l.jsx(q,{className:"h-5 w-5"}),buff:l.jsx(M,{className:"h-5 w-5"}),debuff:l.jsx(E,{className:"h-5 w-5"}),dot:l.jsx(k,{className:"h-5 w-5"}),hot:l.jsx(p,{className:"h-5 w-5"})}[e]||l.jsx(S,{className:"h-5 w-5"})),le=e=>({damage:"text-red-500 border-red-500/30 bg-red-500/5",heal:"text-green-500 border-green-500/30 bg-green-500/5",buff:"text-blue-500 border-blue-500/30 bg-blue-500/5",debuff:"text-purple-500 border-purple-500/30 bg-purple-500/5",dot:"text-orange-500 border-orange-500/30 bg-orange-500/5",hot:"text-emerald-500 border-emerald-500/30 bg-emerald-500/5"}[e]||"text-gray-500 border-gray-500/30 bg-gray-500/5"),te=e=>e<=15?"early":e<=35?"mid":"high",re=z.filter((e=>{const s=e.name.toLowerCase().includes(U.toLowerCase())||e.description.toLowerCase().includes(U.toLowerCase()),a="all"===K||e.effect_type===K,l="all"===W||te(e.unlocked_at_level)===W;return s&&a&&l})),ne=JSON.stringify(A)!==JSON.stringify(F);return J?l.jsx("div",{className:"min-h-screen flex items-center justify-center",children:l.jsxs("div",{className:"text-center",children:[l.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-primary mx-auto mb-4"}),l.jsx("p",{className:"text-muted-foreground",children:"Carregando magias..."})]})}):O?l.jsx("div",{className:"min-h-screen bg-gradient-to-b from-background to-secondary p-4",children:l.jsxs("div",{className:"max-w-7xl mx-auto",children:[l.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-4 mb-6",children:[l.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center gap-2 sm:gap-4",children:[l.jsxs(n,{variant:"ghost",size:"sm",onClick:()=>T({to:"/game/play/hub",search:{character:$}}),className:"w-fit",children:[l.jsx(j,{className:"h-4 w-4 mr-2"}),"Voltar ao Hub"]}),l.jsxs("div",{className:"mt-2 sm:mt-0",children:[l.jsxs("h1",{className:"text-2xl sm:text-3xl font-bold flex items-center gap-2",children:[l.jsx(p,{className:"h-6 sm:h-8 w-6 sm:w-8 text-purple-500"}),"Grimório de Magias"]}),l.jsxs("p",{className:"text-sm sm:text-base text-muted-foreground",children:["Gerencie as magias de"," ",l.jsx("span",{className:"font-medium text-primary",children:O.name})]})]})]}),ne&&l.jsx(n,{onClick:async()=>{if($){R(!0);try{const e=[A.slot1?.id||null,A.slot2?.id||null,A.slot3?.id||null],s=await r.setCharacterSpells($,e);if(!s.success)throw new Error(s.error||"Erro ao salvar seleção");G({...A}),u.success("Seleção de magias salva com sucesso!"),await Z()}catch(e){u.error("Erro ao salvar seleção de magias")}finally{R(!1)}}},disabled:H,size:"lg",className:"bg-purple-600 hover:bg-purple-700 w-full sm:w-auto",children:H?l.jsxs(l.Fragment,{children:[l.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-2 border-white border-t-transparent mr-2"}),"Salvando..."]}):l.jsxs(l.Fragment,{children:[l.jsx(g,{className:"h-4 w-4 mr-2"}),"Salvar Seleção"]})})]}),L&&l.jsxs(c,{className:"mb-6",children:[l.jsx(i,{children:l.jsxs(o,{className:"flex items-center gap-2",children:[l.jsx(f,{className:"h-5 w-5"}),"Estatísticas de Magia"]})}),l.jsx(d,{children:l.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[l.jsxs("div",{className:"text-center",children:[l.jsx("div",{className:"text-2xl font-bold text-blue-500",children:L.total_available}),l.jsx("div",{className:"text-sm text-muted-foreground",children:"Magias Disponíveis"})]}),l.jsxs("div",{className:"text-center",children:[l.jsxs("div",{className:"text-2xl font-bold text-purple-500",children:[L.total_equipped,"/3"]}),l.jsx("div",{className:"text-sm text-muted-foreground",children:"Magias Equipadas"})]}),l.jsxs("div",{className:"text-center",children:[l.jsx("div",{className:"text-2xl font-bold text-yellow-500",children:O.level}),l.jsx("div",{className:"text-sm text-muted-foreground",children:"Nível Atual"})]}),l.jsxs("div",{className:"text-center",children:[l.jsx("div",{className:"text-2xl font-bold text-green-500",children:L.highest_level_unlocked}),l.jsx("div",{className:"text-sm text-muted-foreground",children:"Máximo Desbloqueado"})]})]})})]}),l.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[l.jsxs(c,{className:"lg:col-span-2",children:[l.jsxs(i,{children:[l.jsxs(o,{className:"flex items-center gap-2",children:[l.jsx(N,{className:"h-5 w-5"}),"Seleção de Magias (Máximo 3)"]}),l.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[l.jsx("div",{className:"flex-1",children:l.jsxs("div",{className:"relative",children:[l.jsx(v,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),l.jsx(m,{placeholder:"Buscar magias...",value:U,onChange:e=>Y(e.target.value),className:"pl-10"})]})}),l.jsxs("div",{className:"flex gap-2",children:[l.jsxs("select",{value:K,onChange:e=>Q(e.target.value),className:"px-3 py-2 border border-border rounded-md bg-background text-sm",children:[l.jsx("option",{value:"all",children:"Todos os Tipos"}),l.jsx("option",{value:"damage",children:"Dano"}),l.jsx("option",{value:"heal",children:"Cura"}),l.jsx("option",{value:"buff",children:"Benefício"}),l.jsx("option",{value:"debuff",children:"Maldição"}),l.jsx("option",{value:"dot",children:"Dano Contínuo"}),l.jsx("option",{value:"hot",children:"Cura Contínua"})]}),l.jsxs("select",{value:W,onChange:e=>X(e.target.value),className:"px-3 py-2 border border-border rounded-md bg-background text-sm",children:[l.jsx("option",{value:"all",children:"Todos os Níveis"}),l.jsx("option",{value:"early",children:"Iniciante (1-15)"}),l.jsx("option",{value:"mid",children:"Intermediário (16-35)"}),l.jsx("option",{value:"high",children:"Avançado (36-50)"})]})]})]})]}),l.jsx(d,{children:l.jsx(x,{className:"h-[600px]",children:l.jsxs("div",{className:"grid gap-3",children:[re.map((e=>{const s=Object.values(A).some((s=>s?.id===e.id)),a=e.unlocked_at_level<=O.level;return l.jsx(c,{className:`transition-all cursor-pointer ${s?"ring-2 ring-purple-500 bg-purple-500/10":a?"hover:bg-accent/50":"opacity-50 cursor-not-allowed"} ${le(e.effect_type)}`,onClick:()=>{a&&(s?Object.keys(A).forEach((s=>{const a=s;A[a]?.id===e.id&&se(a)})):A.slot1?A.slot2?A.slot3?u.warning("Você já selecionou 3 magias! Remova uma para adicionar outra."):ee(e,"slot3"):ee(e,"slot2"):ee(e,"slot1"))},children:l.jsx(d,{className:"p-4",children:l.jsxs("div",{className:"flex items-start gap-3",children:[l.jsx("div",{className:`p-2 rounded-lg ${le(e.effect_type)}`,children:ae(e.effect_type)}),l.jsxs("div",{className:"flex-1 min-w-0",children:[l.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[l.jsx("h3",{className:"font-semibold truncate",children:e.name}),s&&l.jsx(h,{variant:"secondary",className:"bg-purple-500/20 text-purple-400",children:"Selecionada"}),!a&&l.jsxs(h,{variant:"destructive",className:"text-xs",children:["Nível ",e.unlocked_at_level]})]}),l.jsx("p",{className:"text-sm text-muted-foreground mb-2 line-clamp-2",children:e.description}),l.jsxs("div",{className:"flex flex-wrap gap-2 text-xs",children:[l.jsxs(h,{variant:"outline",className:"flex items-center gap-1",children:[l.jsx(b,{className:"h-3 w-3"}),e.mana_cost," Mana"]}),l.jsxs(h,{variant:"outline",className:"flex items-center gap-1",children:[l.jsx(w,{className:"h-3 w-3"}),e.cooldown,"T CD"]}),l.jsxs(h,{variant:"outline",className:"flex items-center gap-1",children:[l.jsx(y,{className:"h-3 w-3"}),e.effect_value]}),l.jsxs(h,{variant:"outline",className:`flex items-center gap-1 ${t=e.unlocked_at_level,{early:"text-green-400",mid:"text-yellow-400",high:"text-red-400"}[te(t)]}`,children:[l.jsx(_,{className:"h-3 w-3"}),"Nível ",e.unlocked_at_level]})]})]})]})})},e.id);var t})),0===re.length&&l.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[l.jsx(p,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),l.jsx("p",{children:"Nenhuma magia encontrada com os filtros selecionados"})]})]})})})]}),l.jsxs(c,{children:[l.jsx(i,{children:l.jsxs(o,{className:"flex items-center gap-2",children:[l.jsx(S,{className:"h-5 w-5"}),"Magias Selecionadas"]})}),l.jsxs(d,{className:"space-y-4",children:[[1,2,3].map((e=>{const s=`slot${e}`,a=A[s];return l.jsxs(c,{className:"p-4 border-2 border-dashed transition-all "+(a?`border-solid ${le(a.effect_type)}`:"border-muted-foreground/20 hover:border-muted-foreground/40"),children:[l.jsxs("div",{className:"flex items-center justify-between mb-2",children:[l.jsxs(h,{variant:"outline",className:"text-xs",children:["Slot ",e," (Tecla ",e,")"]}),a&&l.jsx(n,{variant:"ghost",size:"sm",onClick:()=>se(s),className:"h-6 w-6 p-0 hover:bg-red-500/10 hover:text-red-500",children:l.jsx(C,{className:"h-3 w-3"})})]}),a?l.jsxs("div",{className:"space-y-2",children:[l.jsxs("div",{className:"flex items-center gap-2",children:[l.jsx("div",{className:`p-1 rounded ${le(a.effect_type)}`,children:ae(a.effect_type)}),l.jsxs("div",{children:[l.jsx("h4",{className:"font-medium text-sm",children:a.name}),l.jsx("p",{className:"text-xs text-muted-foreground",children:r.translateEffectType(a.effect_type)})]})]}),l.jsxs("div",{className:"grid grid-cols-2 gap-2 text-xs",children:[l.jsxs("div",{className:"flex items-center gap-1",children:[l.jsx(b,{className:"h-3 w-3"}),l.jsx("span",{children:a.mana_cost})]}),l.jsxs("div",{className:"flex items-center gap-1",children:[l.jsx(w,{className:"h-3 w-3"}),l.jsxs("span",{children:[a.cooldown,"T"]})]}),l.jsxs("div",{className:"flex items-center gap-1",children:[l.jsx(y,{className:"h-3 w-3"}),l.jsx("span",{children:a.effect_value})]}),l.jsxs("div",{className:"flex items-center gap-1",children:[l.jsx(_,{className:"h-3 w-3"}),l.jsxs("span",{children:["Nv ",a.unlocked_at_level]})]})]})]}):l.jsxs("div",{className:"text-center text-muted-foreground",children:[l.jsx(p,{className:"h-8 w-8 mx-auto mb-2 opacity-30"}),l.jsx("p",{className:"text-xs",children:"Clique em uma magia para equipar"})]})]},e)})),ne&&l.jsx("div",{className:"mt-4 p-3 bg-yellow-500/10 border border-yellow-500/20 rounded-lg",children:l.jsxs("p",{className:"text-sm text-yellow-400 flex items-center gap-2",children:[l.jsx("span",{className:"h-2 w-2 bg-yellow-400 rounded-full animate-pulse"}),"Você tem alterações não salvas"]})})]})]})]})]})}):l.jsx("div",{className:"min-h-screen flex items-center justify-center",children:l.jsxs("div",{className:"text-center",children:[l.jsx("p",{className:"text-muted-foreground",children:"Personagem não encontrado"}),l.jsx(n,{onClick:()=>T({to:"/game/play"}),className:"mt-4",children:"Voltar"})]})})}export{T as default};
