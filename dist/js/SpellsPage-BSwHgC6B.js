import{r as e,u as s,f as a,j as l}from"./unknown-4jvSuY0O.js";import{C as r,B as t,a as n,b as c,c as o,d as i,I as d,S as m,e as x,f as u}from"./main-CsrKMSiW.js";import{t as h}from"./unknown-BbZV662f.js";import{Y as p,ay as j,aZ as g,a5 as f,ah as v,a9 as N,bu as b,aV as w,aC as y,aA as _,a1 as S,X as C,b5 as k,a2 as E,a0 as M,a8 as $}from"./unknown-64GElSgY.js";import"./unknown-DE60C25c.js";import"./unknown-CF7AHsrn.js";function D(){const D=s(),T=a({from:"/_authenticated/game/play/hub/spells"}).character,{character:q,loading:V,error:O}=function(s){const[a,l]=e.useState(null),[t,n]=e.useState(!1),[c,o]=e.useState(null),i=e.useCallback((async()=>{if(!s?.trim())return o("ID do personagem não fornecido"),void l(null);n(!0),o(null);try{const e=await r.getCharacter(s);if(!e.success||!e.data)throw new Error(e.error||"Personagem não encontrado");const a=e.data;if(!a.id||!a.name||null===a.level||void 0===a.level)throw new Error("Dados do personagem inválidos ou incompletos");if(a.level<1||a.level>100)throw new Error(`Nível inválido: ${a.level}`);l(a)}catch(e){const s=e instanceof Error?e.message:"Erro ao carregar personagem";o(s),l(null),(s.includes("autenticação")||s.includes("não autorizado"))&&(h.error("Sessão expirada. Faça login novamente."),window.location.href="/auth")}finally{n(!1)}}),[s]);return e.useEffect((()=>{i()}),[i]),{character:a,loading:t,error:c,retry:i}}(T),[z,A]=e.useState([]),[I,L]=e.useState(null),[B,F]=e.useState({slot1:null,slot2:null,slot3:null}),[P,G]=e.useState({slot1:null,slot2:null,slot3:null}),[J,H]=e.useState(!1),[R,Y]=e.useState(!1),[Z,K]=e.useState(""),[Q,U]=e.useState("all"),[W,X]=e.useState("all");e.useEffect((()=>{if(!T)return h.error("Personagem não especificado"),void D({to:"/game/play"})}),[T,D]);const ee=async()=>{if(q){H(!0);try{const e=await u.getCharacterAvailableSpells(T,q.level);if(!e.success||!e.data)throw new Error(e.error||"Erro ao carregar magias");A(e.data);const s=u.calculateSpellStats(e.data);L(s);const a=e.data.filter((e=>e.is_equipped)),l={slot1:a.find((e=>1===e.slot_position))||null,slot2:a.find((e=>2===e.slot_position))||null,slot3:a.find((e=>3===e.slot_position))||null};F(l),G(l)}catch(e){h.error("Erro ao carregar dados das magias")}finally{H(!1)}}};e.useEffect((()=>{ee()}),[q]);const se=(e,s)=>{F((a=>{const l={...a};return Object.keys(l).forEach((s=>{const a=s;l[a]?.id===e.id&&(l[a]=null)})),l[s]=e,l}))},ae=e=>{F((s=>({...s,[e]:null})))},le=e=>({damage:l.jsx(y,{className:"h-5 w-5"}),heal:l.jsx($,{className:"h-5 w-5"}),buff:l.jsx(M,{className:"h-5 w-5"}),debuff:l.jsx(E,{className:"h-5 w-5"}),dot:l.jsx(k,{className:"h-5 w-5"}),hot:l.jsx(j,{className:"h-5 w-5"})}[e]||l.jsx(S,{className:"h-5 w-5"})),re=e=>({damage:"text-red-500 border-red-500/30 bg-red-500/5",heal:"text-green-500 border-green-500/30 bg-green-500/5",buff:"text-blue-500 border-blue-500/30 bg-blue-500/5",debuff:"text-purple-500 border-purple-500/30 bg-purple-500/5",dot:"text-orange-500 border-orange-500/30 bg-orange-500/5",hot:"text-emerald-500 border-emerald-500/30 bg-emerald-500/5"}[e]||"text-gray-500 border-gray-500/30 bg-gray-500/5"),te=e=>e<=15?"early":e<=35?"mid":"high",ne=z.filter((e=>{const s=e.name.toLowerCase().includes(Z.toLowerCase())||e.description.toLowerCase().includes(Z.toLowerCase()),a="all"===Q||e.effect_type===Q,l="all"===W||te(e.unlocked_at_level)===W;return s&&a&&l})),ce=JSON.stringify(B)!==JSON.stringify(P);return O?l.jsx("div",{className:"min-h-screen flex items-center justify-center",children:l.jsxs("div",{className:"text-center",children:[l.jsx("p",{className:"text-destructive font-semibold mb-4",children:"Erro ao carregar personagem"}),l.jsx("p",{className:"text-muted-foreground mb-6",children:O}),l.jsx(t,{onClick:()=>D({to:"/game/play"}),children:"Voltar à Seleção"})]})}):V||J?l.jsx("div",{className:"min-h-screen flex items-center justify-center",children:l.jsxs("div",{className:"text-center",children:[l.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-primary mx-auto mb-4"}),l.jsx("p",{className:"text-muted-foreground",children:"Carregando magias..."})]})}):q?l.jsx("div",{className:"min-h-screen bg-gradient-to-b from-background to-secondary p-4",children:l.jsxs("div",{className:"max-w-7xl mx-auto",children:[l.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-4 mb-6",children:[l.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center gap-2 sm:gap-4",children:[l.jsxs(t,{variant:"ghost",size:"sm",onClick:()=>D({to:"/game/play/hub",search:{character:T}}),className:"w-fit",children:[l.jsx(p,{className:"h-4 w-4 mr-2"}),"Voltar ao Hub"]}),l.jsxs("div",{className:"mt-2 sm:mt-0",children:[l.jsxs("h1",{className:"text-2xl sm:text-3xl font-bold flex items-center gap-2",children:[l.jsx(j,{className:"h-6 sm:h-8 w-6 sm:w-8 text-purple-500"}),"Grimório de Magias"]}),l.jsxs("p",{className:"text-sm sm:text-base text-muted-foreground",children:["Gerencie as magias de"," ",l.jsx("span",{className:"font-medium text-primary",children:q.name})]})]})]}),ce&&l.jsx(t,{onClick:async()=>{if(T){Y(!0);try{const e=[B.slot1?.id||null,B.slot2?.id||null,B.slot3?.id||null],s=await u.setCharacterSpells(T,e);if(!s.success)throw new Error(s.error||"Erro ao salvar seleção");G({...B}),h.success("Seleção de magias salva com sucesso!"),await ee()}catch(e){h.error("Erro ao salvar seleção de magias")}finally{Y(!1)}}},disabled:R,size:"lg",className:"bg-purple-600 hover:bg-purple-700 w-full sm:w-auto",children:R?l.jsxs(l.Fragment,{children:[l.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-2 border-white border-t-transparent mr-2"}),"Salvando..."]}):l.jsxs(l.Fragment,{children:[l.jsx(g,{className:"h-4 w-4 mr-2"}),"Salvar Seleção"]})})]}),I&&l.jsxs(n,{className:"mb-6",children:[l.jsx(c,{children:l.jsxs(o,{className:"flex items-center gap-2",children:[l.jsx(f,{className:"h-5 w-5"}),"Estatísticas de Magia"]})}),l.jsx(i,{children:l.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[l.jsxs("div",{className:"text-center",children:[l.jsx("div",{className:"text-2xl font-bold text-blue-500",children:I.total_available}),l.jsx("div",{className:"text-sm text-muted-foreground",children:"Magias Disponíveis"})]}),l.jsxs("div",{className:"text-center",children:[l.jsxs("div",{className:"text-2xl font-bold text-purple-500",children:[I.total_equipped,"/3"]}),l.jsx("div",{className:"text-sm text-muted-foreground",children:"Magias Equipadas"})]}),l.jsxs("div",{className:"text-center",children:[l.jsx("div",{className:"text-2xl font-bold text-yellow-500",children:q.level}),l.jsx("div",{className:"text-sm text-muted-foreground",children:"Nível Atual"})]}),l.jsxs("div",{className:"text-center",children:[l.jsx("div",{className:"text-2xl font-bold text-green-500",children:I.highest_level_unlocked}),l.jsx("div",{className:"text-sm text-muted-foreground",children:"Máximo Desbloqueado"})]})]})})]}),l.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[l.jsxs(n,{className:"lg:col-span-2",children:[l.jsxs(c,{children:[l.jsxs(o,{className:"flex items-center gap-2",children:[l.jsx(v,{className:"h-5 w-5"}),"Seleção de Magias (Máximo 3)"]}),l.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[l.jsx("div",{className:"flex-1",children:l.jsxs("div",{className:"relative",children:[l.jsx(N,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),l.jsx(d,{placeholder:"Buscar magias...",value:Z,onChange:e=>K(e.target.value),className:"pl-10"})]})}),l.jsxs("div",{className:"flex gap-2",children:[l.jsxs("select",{value:Q,onChange:e=>U(e.target.value),className:"px-3 py-2 border border-border rounded-md bg-background text-sm",children:[l.jsx("option",{value:"all",children:"Todos os Tipos"}),l.jsx("option",{value:"damage",children:"Dano"}),l.jsx("option",{value:"heal",children:"Cura"}),l.jsx("option",{value:"buff",children:"Benefício"}),l.jsx("option",{value:"debuff",children:"Maldição"}),l.jsx("option",{value:"dot",children:"Dano Contínuo"}),l.jsx("option",{value:"hot",children:"Cura Contínua"})]}),l.jsxs("select",{value:W,onChange:e=>X(e.target.value),className:"px-3 py-2 border border-border rounded-md bg-background text-sm",children:[l.jsx("option",{value:"all",children:"Todos os Níveis"}),l.jsx("option",{value:"early",children:"Iniciante (1-15)"}),l.jsx("option",{value:"mid",children:"Intermediário (16-35)"}),l.jsx("option",{value:"high",children:"Avançado (36-50)"})]})]})]})]}),l.jsx(i,{children:l.jsx(m,{className:"h-[600px]",children:l.jsxs("div",{className:"grid gap-3",children:[ne.map((e=>{const s=Object.values(B).some((s=>s?.id===e.id)),a=e.unlocked_at_level<=q.level;return l.jsx(n,{className:`transition-all cursor-pointer ${s?"ring-2 ring-purple-500 bg-purple-500/10":a?"hover:bg-accent/50":"opacity-50 cursor-not-allowed"} ${re(e.effect_type)}`,onClick:()=>{a&&(s?Object.keys(B).forEach((s=>{const a=s;B[a]?.id===e.id&&ae(a)})):B.slot1?B.slot2?B.slot3?h.warning("Você já selecionou 3 magias! Remova uma para adicionar outra."):se(e,"slot3"):se(e,"slot2"):se(e,"slot1"))},children:l.jsx(i,{className:"p-4",children:l.jsxs("div",{className:"flex items-start gap-3",children:[l.jsx("div",{className:`p-2 rounded-lg ${re(e.effect_type)}`,children:le(e.effect_type)}),l.jsxs("div",{className:"flex-1 min-w-0",children:[l.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[l.jsx("h3",{className:"font-semibold truncate",children:e.name}),s&&l.jsx(x,{variant:"secondary",className:"bg-purple-500/20 text-purple-400",children:"Selecionada"}),!a&&l.jsxs(x,{variant:"destructive",className:"text-xs",children:["Nível ",e.unlocked_at_level]})]}),l.jsx("p",{className:"text-sm text-muted-foreground mb-2 line-clamp-2",children:e.description}),l.jsxs("div",{className:"flex flex-wrap gap-2 text-xs",children:[l.jsxs(x,{variant:"outline",className:"flex items-center gap-1",children:[l.jsx(b,{className:"h-3 w-3"}),e.mana_cost," Mana"]}),l.jsxs(x,{variant:"outline",className:"flex items-center gap-1",children:[l.jsx(w,{className:"h-3 w-3"}),e.cooldown,"T CD"]}),l.jsxs(x,{variant:"outline",className:"flex items-center gap-1",children:[l.jsx(y,{className:"h-3 w-3"}),e.effect_value]}),l.jsxs(x,{variant:"outline",className:`flex items-center gap-1 ${r=e.unlocked_at_level,{early:"text-green-400",mid:"text-yellow-400",high:"text-red-400"}[te(r)]}`,children:[l.jsx(_,{className:"h-3 w-3"}),"Nível ",e.unlocked_at_level]})]})]})]})})},e.id);var r})),0===ne.length&&l.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[l.jsx(j,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),l.jsx("p",{children:"Nenhuma magia encontrada com os filtros selecionados"})]})]})})})]}),l.jsxs(n,{children:[l.jsx(c,{children:l.jsxs(o,{className:"flex items-center gap-2",children:[l.jsx(S,{className:"h-5 w-5"}),"Magias Selecionadas"]})}),l.jsxs(i,{className:"space-y-4",children:[[1,2,3].map((e=>{const s=`slot${e}`,a=B[s];return l.jsxs(n,{className:"p-4 border-2 border-dashed transition-all "+(a?`border-solid ${re(a.effect_type)}`:"border-muted-foreground/20 hover:border-muted-foreground/40"),children:[l.jsxs("div",{className:"flex items-center justify-between mb-2",children:[l.jsxs(x,{variant:"outline",className:"text-xs",children:["Slot ",e," (Tecla ",e,")"]}),a&&l.jsx(t,{variant:"ghost",size:"sm",onClick:()=>ae(s),className:"h-6 w-6 p-0 hover:bg-red-500/10 hover:text-red-500",children:l.jsx(C,{className:"h-3 w-3"})})]}),a?l.jsxs("div",{className:"space-y-2",children:[l.jsxs("div",{className:"flex items-center gap-2",children:[l.jsx("div",{className:`p-1 rounded ${re(a.effect_type)}`,children:le(a.effect_type)}),l.jsxs("div",{children:[l.jsx("h4",{className:"font-medium text-sm",children:a.name}),l.jsx("p",{className:"text-xs text-muted-foreground",children:u.translateEffectType(a.effect_type)})]})]}),l.jsxs("div",{className:"grid grid-cols-2 gap-2 text-xs",children:[l.jsxs("div",{className:"flex items-center gap-1",children:[l.jsx(b,{className:"h-3 w-3"}),l.jsx("span",{children:a.mana_cost})]}),l.jsxs("div",{className:"flex items-center gap-1",children:[l.jsx(w,{className:"h-3 w-3"}),l.jsxs("span",{children:[a.cooldown,"T"]})]}),l.jsxs("div",{className:"flex items-center gap-1",children:[l.jsx(y,{className:"h-3 w-3"}),l.jsx("span",{children:a.effect_value})]}),l.jsxs("div",{className:"flex items-center gap-1",children:[l.jsx(_,{className:"h-3 w-3"}),l.jsxs("span",{children:["Nv ",a.unlocked_at_level]})]})]})]}):l.jsxs("div",{className:"text-center text-muted-foreground",children:[l.jsx(j,{className:"h-8 w-8 mx-auto mb-2 opacity-30"}),l.jsx("p",{className:"text-xs",children:"Clique em uma magia para equipar"})]})]},e)})),ce&&l.jsx("div",{className:"mt-4 p-3 bg-yellow-500/10 border border-yellow-500/20 rounded-lg",children:l.jsxs("p",{className:"text-sm text-yellow-400 flex items-center gap-2",children:[l.jsx("span",{className:"h-2 w-2 bg-yellow-400 rounded-full animate-pulse"}),"Você tem alterações não salvas"]})})]})]})]})]})}):l.jsx("div",{className:"min-h-screen flex items-center justify-center",children:l.jsxs("div",{className:"text-center",children:[l.jsx("p",{className:"text-muted-foreground",children:"Personagem não encontrado"}),l.jsx(t,{onClick:()=>D({to:"/game/play"}),className:"mt-4",children:"Voltar"})]})})}export{D as default};
