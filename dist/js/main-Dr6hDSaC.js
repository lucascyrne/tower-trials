const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["js/SpellsPage-BOKD9Y3K.js","js/unknown-4jvSuY0O.js","js/unknown-DE60C25c.js","js/unknown-BbZV662f.js","js/unknown-9qQMNSD6.js","js/unknown-CF7AHsrn.js"])))=>i.map(i=>d[i]);
import{r as e,j as t,d as a,O as s,u as r,e as n,f as i,L as o,g as l,h as c,i as d,c as m,_ as u,k as h,l as p,m as x}from"./unknown-4jvSuY0O.js";import{c as f,g}from"./unknown-DE60C25c.js";import{o as b,s as v,n as y,Z as j,T as N,t as _,a as w,b as C,c as S,u as E,F as k,C as A,d as P,e as M}from"./unknown-BbZV662f.js";import{c as T,A as q}from"./unknown-CF7AHsrn.js";import{L as D,t as L,c as $,S as R,a as I,G as F,T as V,D as O,O as B,P as U,C as z,b as H,X as G,d as X,R as W,e as Y,U as K,f as J,M as Q,g as Z,h as ee,i as te,j as ae,k as se,l as re,m as ne,I as ie,n as oe,o as le,p as ce,q as de,r as me,s as ue,V as he,u as pe,v as xe,w as fe,x as ge,y as be,z as ve,A as ye,B as je,E as Ne,F as _e,H as we,J as Ce,W as Se,K as Ee,N as ke,Q as Ae,Y as Pe,Z as Me,_ as Te,$ as qe,a0 as De,a1 as Le,a2 as $e,a3 as Re,a4 as Ie,a5 as Fe,a6 as Ve,a7 as Oe,a8 as Be,a9 as Ue,aa as ze,ab as He,ac as Ge,ad as Xe,ae as We,af as Ye,ag as Ke,ah as Je,ai as Qe,aj as Ze,ak as et,al as tt,am as at,an as st,ao as rt,ap as nt,aq as it,ar as ot,as as lt,at as ct,au as dt,av as mt,aw as ut,ax as ht,ay as pt,az as xt,aA as ft,aB as gt,aC as bt,aD as vt,aE as yt,aF as jt,aG as Nt,aH as _t,aI as wt,aJ as Ct,aK as St,aL as Et,aM as kt,aN as At,aO as Pt,aP as Mt,aQ as Tt,aR as qt,aS as Dt,aT as Lt,aU as $t,aV as Rt,aW as It,aX as Ft,aY as Vt,aZ as Ot,a_ as Bt,a$ as Ut,b0 as zt,b1 as Ht,b2 as Gt,b3 as Xt,b4 as Wt,b5 as Yt,b6 as Kt,b7 as Jt,b8 as Qt,b9 as Zt,ba as ea,bb as ta,bc as aa,bd as sa,be as ra,bf as na,bg as ia,bh as oa,bi as la,bj as ca,bk as da,bl as ma,bm as ua,bn as ha,bo as pa,bp as xa,bq as fa,br as ga,bs as ba,bt as va}from"./unknown-9qQMNSD6.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver((e=>{for(const a of e)if("childList"===a.type)for(const e of a.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)})).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();const ya=g(f()),ja=b({email:v().email("Email inválido"),password:v().min(6,"A senha deve ter pelo menos 6 caracteres")}),Na=b({email:v().email("Email inválido"),password:v().min(6,"A senha deve ter pelo menos 6 caracteres"),confirmPassword:v().min(6,"A senha deve ter pelo menos 6 caracteres")}).refine((e=>e.password===e.confirmPassword),{message:"As senhas não coincidem",path:["confirmPassword"]}),_a={user:null,session:null,isLoading:!1,isAuthenticated:!1,error:null,loading:{onAuthUserChanged:!1,signIn:!1,signUp:!1,signOut:!1,updateProfile:!1}},wa=e.createContext({..._a,signInWithEmail:async()=>({success:!1}),signUpWithEmail:async()=>({success:!1}),signOut:async()=>{},updateProfile:async()=>({success:!1})});var Ca=(e=>(e.LOCAL="LOCAL",e.DEV="DEV",e.PROD="PROD",e))(Ca||{});const Sa=b({VITE_ENV:y(Ca),VITE_BASE_URL:v().url().optional(),VITE_SUPABASE_URL:v().url(),VITE_SUPABASE_ANON_KEY:v(),VITE_SERVICE_ROLE:v().optional(),VITE_LOGIN_URL:v().url().optional(),VITE_SUPABASE_LOCAL_URL:v().url().optional(),VITE_SUPABASE_LOCAL_ANON_KEY:v().optional()});const Ea=function(){const e={VITE_ENV:"DEV",VITE_BASE_URL:"http://tower-trials.vercel.app",VITE_SUPABASE_URL:"https://bkqzntlkkbepzvoesqxh.supabase.co",VITE_SUPABASE_ANON_KEY:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImJrcXpudGxra2JlcHp2b2VzcXhoIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjEyNzI2NTIsImV4cCI6MjA3Njg0ODY1Mn0.Tr1UdumfKh8k8S6YaLFVS49rfXylQcyaU-O7qpynrK4",VITE_SERVICE_ROLE:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImJrcXpudGxra2JlcHp2b2VzcXhoIiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTc2MTI3MjY1MiwiZXhwIjoyMDc2ODQ4NjUyfQ.lzOfCWvDf9JpqLngMosX1LeG7S-PUmHaXHEDBWvfLuI",VITE_LOGIN_URL:"http://tower-trials.vercel.app/login",VITE_SUPABASE_LOCAL_URL:void 0,VITE_SUPABASE_LOCAL_ANON_KEY:void 0};try{return Sa.parse(e)}catch(t){throw t instanceof j&&t.errors.forEach((e=>{})),new Error("Configuração de ambiente inválida")}}(),ka=(()=>{switch(Ea.VITE_ENV){case Ca.LOCAL:return{url:Ea.VITE_SUPABASE_LOCAL_URL||"http://127.0.0.1:54321",anonKey:Ea.VITE_SUPABASE_ANON_KEY,serviceRoleKey:Ea.VITE_SERVICE_ROLE};case Ca.DEV:case Ca.PROD:default:return{url:Ea.VITE_SUPABASE_URL,anonKey:Ea.VITE_SUPABASE_ANON_KEY,serviceRoleKey:Ea.VITE_SERVICE_ROLE}}})(),Aa=T(ka.url,ka.anonKey,{auth:{persistSession:!0,autoRefreshToken:!0,detectSessionInUrl:!0,storage:localStorage}}),Pa=T(ka.url,ka.serviceRoleKey||"",{auth:{autoRefreshToken:!1,persistSession:!1}}),Ma=Object.freeze(Object.defineProperty({__proto__:null,supabase:Aa,supabaseAdmin:Pa},Symbol.toStringTag,{value:"Module"})),Ta={getSession:async()=>{try{const{data:{session:e},error:t}=await Aa.auth.getSession();if(t)throw t;return e}catch(e){return null}},getCurrentUser:async()=>{try{const{data:{user:e},error:t}=await Aa.auth.getUser();if(403===t?.status||!e)return null;if(t)throw t;const{data:a,error:s}=await Aa.from("users").select("*").eq("uid",e.id).maybeSingle();return s?null:a?{...e,username:a.username,display_name:a.display_name,avatar_url:a.avatar_url,role:a.role,highest_floor:a.highest_floor,total_games:a.total_games,total_victories:a.total_victories,total_character_level:a.total_character_level,max_character_slots:a.max_character_slots,is_active:a.is_active,last_login:a.last_login}:null}catch(e){return e instanceof Error&&e.message.includes("JWT"),null}},signOut:async()=>{try{const{error:e}=await Aa.auth.signOut();if(e)throw e}catch(e){throw e}},signInWithEmail:async({email:e,password:t})=>{try{const{data:a,error:s}=await Aa.auth.signInWithPassword({email:e,password:t});if(s)throw s;if(!a.user)return{user:null,session:null,error:"Usuário não encontrado"};const{data:r,error:n}=await Aa.from("users").select("*").eq("uid",a.user.id).maybeSingle();if(n)return{user:null,session:a.session,error:"Erro ao buscar perfil do usuário"};if(!r)return{user:null,session:a.session,error:"Perfil não encontrado"};await Aa.from("users").update({last_login:(new Date).toISOString()}).eq("uid",a.user.id);return{user:{...a.user,username:r.username,display_name:r.display_name,avatar_url:r.avatar_url,role:r.role,highest_floor:r.highest_floor,total_games:r.total_games,total_victories:r.total_victories,total_character_level:r.total_character_level,max_character_slots:r.max_character_slots,is_active:r.is_active,last_login:r.last_login},session:a.session}}catch(a){return{user:null,session:null,error:String(a)}}},signUpWithEmail:async e=>{try{const{email:s,password:r,username:n=s.split("@")[0]}=e,{data:i,error:o}=await Aa.auth.signUp({email:s,password:r,options:{data:{username:n},emailRedirectTo:`${window.location.origin}/auth`}});if(o)throw o;if(!i.user)throw new Error("Falha ao criar usuário");await new Promise((e=>setTimeout(e,1e3)));try{await Aa.rpc("create_user_profile",{p_uid:i.user.id,p_username:n,p_email:s})}catch(t){try{const{error:e}=await Aa.from("users").insert({uid:i.user.id,username:n,email:s,role:"PLAYER",highest_floor:0,total_games:0,total_victories:0,total_character_level:0,max_character_slots:3,is_active:!0,created_at:(new Date).toISOString(),updated_at:(new Date).toISOString()});if(e){if("23505"===e.code)return{user:{...i.user,username:n,role:"PLAYER",highest_floor:0,total_games:0,total_victories:0,total_character_level:0,max_character_slots:3,is_active:!0},session:i.session};throw e}}catch(a){}}return{user:{...i.user,username:n,role:"PLAYER",highest_floor:0,total_games:0,total_victories:0,total_character_level:0,max_character_slots:3,is_active:!0},session:i.session}}catch(s){return{user:null,session:null,error:String(s)}}},updateProfile:async e=>{try{const t=await Ta.getSession();if(!t?.user)throw new Error("Usuário não autenticado");const{error:a}=await Aa.from("users").update({display_name:e.display_name,avatar_url:e.avatar_url,updated_at:(new Date).toISOString()}).eq("uid",t.user.id).select().single();if(a)throw a;return{user:await Ta.getCurrentUser(),session:t}}catch(t){return{user:null,session:null,error:String(t)}}},handleAuthError:e=>{if(e instanceof q)switch(e.status){case 400:if(e.message.includes("Email not confirmed"))return new Error("Por favor, confirme seu e-mail antes de fazer login");if(e.message.includes("Invalid login credentials"))return new Error("E-mail ou senha incorretos");if(e.message.includes("Password should be at least 6 characters"))return new Error("A senha deve ter pelo menos 6 caracteres");if(e.message.includes("User already registered"))return new Error("Este e-mail já está cadastrado");break;case 401:return new Error("Sessão expirada. Por favor, faça login novamente");case 422:return new Error("Dados inválidos. Verifique as informações e tente novamente");case 429:return new Error("Muitas tentativas. Por favor, aguarde alguns minutos")}return e instanceof Error?e:new Error("Ocorreu um erro inesperado. Tente novamente mais tarde")}},qa={onAuthUserChanged:!0,signIn:!1,signUp:!1,signOut:!1,updateProfile:!1},Da={user:null,session:null,isLoading:!0,isAuthenticated:!1,error:null,loading:qa};function La({children:a}){const[s,r]=e.useState(Da),n=e.useCallback((async()=>{r((e=>e.isLoading?{...e,loading:{...e.loading,onAuthUserChanged:!0}}:e));try{const e=await Ta.getSession();if(!e)return void r({...Da,isLoading:!1,loading:{...qa,onAuthUserChanged:!1}});const t=await Ta.getCurrentUser();r({...Da,user:t,session:e,isAuthenticated:!!t,isLoading:!1,loading:{...qa,onAuthUserChanged:!1}})}catch(e){r({...Da,error:e instanceof Error?e.message:String(e),isLoading:!1,loading:{...qa,onAuthUserChanged:!1}})}}),[]);e.useEffect((()=>{const{data:{subscription:e}}=Aa.auth.onAuthStateChange(((e,t)=>{r((e=>JSON.stringify(t)===JSON.stringify(e.session)?e:{...e,session:t,isLoading:!0,loading:{...e.loading,onAuthUserChanged:!0}}))}));return()=>{e.unsubscribe()}}),[]),e.useEffect((()=>{s.isLoading&&n()}),[s.isLoading,n]);const i=e.useCallback((async e=>{r((e=>({...e,loading:{...e.loading,signIn:!0}})));try{const t=await Ta.signInWithEmail(e);return t.error?(r((e=>({...e,error:t.error,loading:{...e.loading,signIn:!1}}))),{success:!1,error:t.error}):(r((e=>({...e,isLoading:!0,loading:{...e.loading,signIn:!1,onAuthUserChanged:!0}}))),{success:!0})}catch(t){const e=t instanceof Error?t.message:"Erro ao fazer login";return r((t=>({...t,error:e,loading:{...t.loading,signIn:!1}}))),{success:!1,error:e}}}),[]),o=e.useCallback((async e=>{r((e=>({...e,loading:{...e.loading,signUp:!0}})));try{const t=await Ta.signUpWithEmail(e);return t.error?(r((e=>({...e,error:t.error,loading:{...e.loading,signUp:!1}}))),{success:!1,error:t.error}):(r((e=>({...e,isLoading:!0,loading:{...e.loading,signUp:!1,onAuthUserChanged:!0}}))),{success:!0})}catch(t){const e=t instanceof Error?t.message:"Erro ao criar conta";return r((t=>({...t,error:e,loading:{...t.loading,signUp:!1}}))),{success:!1,error:e}}}),[]),l=e.useCallback((async()=>{r((e=>({...e,loading:{...e.loading,signOut:!0}})));try{await Ta.signOut(),r({...Da,isLoading:!1,loading:{...qa,onAuthUserChanged:!1}}),"undefined"!=typeof window&&(window.location.href="/auth?auth=logout")}catch(e){r((t=>({...t,error:e instanceof Error?e.message:String(e),loading:{...t.loading,signOut:!1}})))}}),[]),c=e.useCallback((async e=>{r((e=>({...e,loading:{...e.loading,updateProfile:!0}})));try{const t=await Ta.updateProfile(e);return t.error?(r((e=>({...e,error:t.error,loading:{...e.loading,updateProfile:!1}}))),{success:!1,error:t.error}):(r((e=>({...e,isLoading:!0,loading:{...e.loading,updateProfile:!1,onAuthUserChanged:!0}}))),{success:!0})}catch(t){const e=t instanceof Error?t.message:"Erro ao atualizar perfil";return r((t=>({...t,error:e,loading:{...t.loading,updateProfile:!1}}))),{success:!1,error:e}}}),[]),d=e.useMemo((()=>({...s,signInWithEmail:i,signUpWithEmail:o,signOut:l,updateProfile:c})),[s,i,o,l,c]);return t.jsx(wa.Provider,{value:d,children:a})}function $a(){const[t,a]=e.useState((()=>{if("undefined"==typeof window)return"dark";try{return localStorage.getItem("theme")||"dark"}catch{return"dark"}})),[s,r]=e.useState("dark");e.useEffect((()=>{if("undefined"==typeof window)return;const e=window.document.documentElement,a=t=>{const a="system"===t?(()=>{try{return window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"}catch{return"dark"}})():t;r(a),e.classList.remove("light","dark"),e.classList.add(a)};if(a(t),"system"===t)try{const e=window.matchMedia("(prefers-color-scheme: dark)"),s=()=>a(t);return e.addEventListener?(e.addEventListener("change",s),()=>e.removeEventListener("change",s)):(e.addListener(s),()=>e.removeListener(s))}catch{return}}),[t]);return{theme:t,setTheme:e=>{if(a(e),"undefined"!=typeof window)try{localStorage.setItem("theme",e)}catch{}},resolvedTheme:s}}function Ra({children:e}){return t.jsx(t.Fragment,{children:e})}function Ia(){return e.useEffect((()=>{}),[]),$a(),null}function Fa(){return t.jsx("div",{className:"min-h-screen w-full flex items-center justify-center bg-background",children:t.jsxs("div",{className:"text-center",children:[t.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-primary mx-auto mb-4"}),t.jsx("p",{className:"text-muted-foreground",children:"Carregando página..."})]})})}const Va=a({component:function(){return t.jsxs("div",{className:"font-inter min-h-screen w-full",children:[t.jsx(Ia,{}),t.jsx(N,{richColors:!0,position:"top-right"}),t.jsx(La,{children:t.jsxs(Ra,{children:[t.jsx(e.Suspense,{fallback:t.jsx(Fa,{}),children:t.jsx(s,{})}),!1]})})]})}});const Oa=()=>e.useContext(wa),Ba=()=>t.jsx("div",{className:"flex items-center justify-center min-h-screen w-full",children:t.jsxs("div",{className:"flex flex-col items-center gap-2",children:[t.jsx(D,{className:"h-8 w-8 animate-spin text-primary"}),t.jsx("p",{className:"text-sm text-muted-foreground",children:"Carregando..."})]})});function Ua({children:a}){const{loading:s}=Oa(),[r,n]=e.useState(!1),i=e.useRef(!1),o=e.useRef(null);return e.useEffect((()=>{if("undefined"!=typeof window&&!i.current)return i.current=!0,r||(s.onAuthUserChanged?o.current=setTimeout((()=>{n(!0)}),5e3):n(!0)),()=>{o.current&&clearTimeout(o.current)}}),[s.onAuthUserChanged,r]),e.useEffect((()=>{s.onAuthUserChanged||r||(n(!0),o.current&&(clearTimeout(o.current),o.current=null))}),[s.onAuthUserChanged,r]),r?a:t.jsx(Ba,{})}function za({children:a}){const{user:s,signOut:o,loading:l}=Oa(),c=r(),d=n(),m=i({strict:!1}).auth,u=e.useRef(!1),h=e.useRef(!1),p=e.useRef(null);return e.useLayoutEffect((()=>{const e=null!==s;p.current!==e&&(p.current=e,e||(h.current=!1,u.current=!1))}),[s]),e.useEffect((()=>{if("undefined"!=typeof window&&!l.onAuthUserChanged&&void 0!==s){if("/logout"===d.pathname){if(s&&!u.current)return _.error("Sessão expirada, faça o login novamente."),o(),void(u.current=!0);if(!s&&u.current){const t=`${d.pathname}${d.search||""}`;try{const e="string"==typeof t?t:"",a=e?encodeURIComponent(e):"";c({to:"/auth",search:{auth:a},replace:!0})}catch(e){c({to:"/auth",search:{auth:""},replace:!0})}return}}if("/auth/verify-email"!==d.pathname&&s&&!h.current&&!u.current){h.current=!0;try{if(m&&"string"==typeof m&&""!==m.trim()&&"true"!==m){const e=decodeURIComponent(m);if(e&&e.startsWith("/")&&!e.includes("[object")&&!e.startsWith("/auth"))return void c({to:e,replace:!0})}c({to:"/game",replace:!0})}catch(e){c({to:"/game",replace:!0})}}}}),[s,m,d.pathname,d.search,l.onAuthUserChanged,o,c]),l.onAuthUserChanged||void 0===s||s&&!u.current&&"/auth/verify-email"!==d.pathname&&"/logout"!==d.pathname?t.jsx(Ba,{}):a}function Ha({children:e}){return t.jsx(Ua,{children:t.jsx(za,{children:e})})}function Ga(...e){return L($(e))}const Xa=I("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground shadow hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground shadow-sm hover:bg-destructive/90",outline:"border border-input bg-background shadow-sm hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground shadow-sm hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2",sm:"h-8 rounded-md px-3 text-xs",lg:"h-10 rounded-md px-8",icon:"h-9 w-9"}},defaultVariants:{variant:"default",size:"default"}}),Wa=e.forwardRef((({className:e,variant:a,size:s,asChild:r=!1,...n},i)=>{const o=r?R:"button";return t.jsx(o,{className:Ga(Xa({variant:a,size:s,className:e})),ref:i,...n})}));function Ya(){return t.jsx("footer",{className:"bg-gradient-to-t from-background/90 to-background/70 border-t border-border",children:t.jsxs("section",{className:"py-8 md:py-12",children:[t.jsxs("div",{className:"max-w-5xl mx-auto p-6 sm:p-8 grid gap-12 md:grid-cols-[1.5fr_0.5fr_0.5fr]",children:[t.jsxs("div",{className:"not-prose flex flex-col gap-6",children:[t.jsxs(o,{to:"/",className:"group",children:[t.jsx("h3",{className:"sr-only",children:"Tower Trials"}),t.jsx("h1",{className:"text-2xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-purple-400 to-pink-600 group-hover:from-purple-500 group-hover:to-pink-700 transition-colors",children:"Tower Trials"})]}),t.jsx("p",{className:"text-muted-foreground",children:"Enfrente desafios, suba a torre e torne-se uma lenda neste RPG roguelike épico."})]}),t.jsxs("div",{className:"flex flex-col gap-3",children:[t.jsx("h5",{className:"font-bold text-primary",children:"Links"}),t.jsx(o,{to:"/game/ranking",className:"text-muted-foreground hover:text-primary transition-colors",children:"Ranking Global"}),t.jsx(o,{to:"/game/guide",className:"text-muted-foreground hover:text-primary transition-colors",children:"Guia do Jogo"})]}),t.jsx("div",{className:"flex flex-col gap-3",children:t.jsx("h5",{className:"font-bold text-primary",children:"Legal"})})]}),t.jsxs("div",{className:"max-w-5xl mx-auto p-6 sm:p-8 not-prose mt-8 flex flex-col justify-between gap-6 border-t border-border pt-8 md:flex-row md:items-center md:gap-2",children:[t.jsxs("div",{className:"flex gap-2",children:[t.jsx(Wa,{variant:"ghost",size:"icon",className:"text-muted-foreground hover:text-primary transition-colors",children:t.jsx(F,{className:"h-5 w-5"})}),t.jsx(Wa,{variant:"ghost",size:"icon",className:"text-muted-foreground hover:text-primary transition-colors",children:t.jsx(V,{className:"h-5 w-5"})})]}),t.jsx("p",{className:"text-muted-foreground",children:"© 2024 Tower Trials. Todos os direitos reservados."})]})]})})}Wa.displayName="Button";const Ka=l("/_public")({component:function(){return t.jsx(Ha,{children:t.jsxs("main",{className:"flex min-h-screen w-full flex-col",children:[t.jsx("div",{className:"flex flex-1 w-full items-center justify-center p-4",children:t.jsx(s,{})}),t.jsx(Ya,{})]})})}});function Ja({children:a}){const{user:s,loading:i}=Oa(),o=r(),l=n(),c=e.useRef(!1),d=e.useRef(null);return e.useLayoutEffect((()=>{const e=null!==s;d.current!==e&&(d.current=e,c.current=!1)}),[s]),e.useEffect((()=>{if("undefined"!=typeof window&&!i.onAuthUserChanged&&null===s&&!c.current){if(c.current=!0,l.pathname.startsWith("/auth"))return;const t=`${l.pathname}${l.search||""}`;if(t&&"/auth"!==t)try{const e=encodeURIComponent("string"==typeof t?t:"/game");o({to:"/auth",search:{auth:e},replace:!0})}catch(e){o({to:"/auth",search:{auth:encodeURIComponent("/game")},replace:!0})}else o({to:"/auth",search:{auth:""},replace:!0})}}),[s,i.onAuthUserChanged,l.pathname,l.search]),i.onAuthUserChanged||null==s?t.jsx(Ba,{}):a}function Qa({children:e}){return t.jsx(Ua,{children:t.jsx(Ja,{children:e})})}function Za({children:a}){const{user:s}=Oa(),n=r(),i=e.useRef(!1),o=e.useRef(null);return e.useLayoutEffect((()=>{if(!s)return o.current=null,void(i.current=!1);const e=!!s.email_confirmed_at;o.current!==e&&(o.current=e,i.current=!1)}),[s?.email_confirmed_at]),e.useEffect((()=>{"undefined"!=typeof window&&s&&(s.email_confirmed_at||i.current||(i.current=!0,n({to:"/auth/verify-email",search:{auth:"true"},replace:!0})))}),[s,n]),s&&s.email_confirmed_at?t.jsx(t.Fragment,{children:a}):null}function es(){const[t,a]=e.useState(null),[s,r]=e.useState(!1),[n,i]=e.useState(!1);e.useEffect((()=>{const e=e=>{e.preventDefault(),a(e),r(!0)},t=()=>{i(!0),r(!1),a(null)};return window.addEventListener("beforeinstallprompt",e),window.addEventListener("appinstalled",t),(()=>{const e=window.matchMedia("(display-mode: standalone)").matches,t=window.matchMedia("(display-mode: fullscreen)").matches,a=window.matchMedia("(display-mode: minimal-ui)").matches;(e||t||a)&&i(!0)})(),()=>{window.removeEventListener("beforeinstallprompt",e),window.removeEventListener("appinstalled",t)}}),[]);return{installPWA:async()=>{if(!t)return!1;try{t.prompt();const{outcome:e}=await t.userChoice;return"accepted"===e&&(a(null),r(!1),!0)}catch(e){return!1}},isInstallable:s,isInstalled:n,canInstall:s&&!n}}function ts(){const{installPWA:e,canInstall:a,isInstalled:s}=es();return s?t.jsxs("div",{className:"flex items-center gap-2 text-sm text-green-600 dark:text-green-400",children:[t.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full animate-pulse"}),"App Instalado"]}):a?t.jsxs(Wa,{onClick:async()=>{await e()},variant:"outline",size:"sm",className:"flex items-center gap-2 bg-blue-50 hover:bg-blue-100 dark:bg-blue-950 dark:hover:bg-blue-900 border-blue-200 dark:border-blue-800",children:[t.jsx(O,{className:"w-4 h-4"}),"Instalar App"]}):null}const as=W,ss=Y,rs=U,ns=e.forwardRef((({className:e,...a},s)=>t.jsx(B,{className:Ga("fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",e),...a,ref:s})));ns.displayName=B.displayName;const is=I("fixed z-50 gap-4 bg-background p-6 shadow-lg transition ease-in-out data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:duration-300 data-[state=open]:duration-500",{variants:{side:{top:"inset-x-0 top-0 border-b data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top",bottom:"inset-x-0 bottom-0 border-t data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom",left:"inset-y-0 left-0 h-full w-3/4 border-r data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left sm:max-w-sm",right:"inset-y-0 right-0 h-full w-3/4 border-l data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right sm:max-w-sm"}},defaultVariants:{side:"right"}}),os=e.forwardRef((({side:e="right",className:a,children:s,...r},n)=>t.jsxs(rs,{children:[t.jsx(ns,{}),t.jsxs(z,{ref:n,className:Ga(is({side:e}),a),...r,children:[s,t.jsxs(H,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-secondary",children:[t.jsx(G,{className:"h-4 w-4"}),t.jsx("span",{className:"sr-only",children:"Close"})]})]})]})));os.displayName=z.displayName;const ls=({className:e,...a})=>t.jsx("div",{className:Ga("flex flex-col space-y-2 text-center sm:text-left",e),...a});ls.displayName="SheetHeader";const cs=e.forwardRef((({className:e,...a},s)=>t.jsx(X,{ref:s,className:Ga("text-lg font-semibold text-foreground",e),...a})));cs.displayName=X.displayName;function ds({userName:e}){const a=n(),s=r(),i=a.pathname,{user:o}=Oa(),{resolvedTheme:l,setTheme:c}=$a(),d=i.startsWith("/game/play/"),m=((e,t)=>{const a=[...t?[]:[{href:"/game",icon:te,label:"Jogar"}],{href:"/game/ranking",icon:ae,label:"Ranking"},{href:"/game/guide",icon:se,label:"Guia"}];return"ADMIN"===e?[...a,{href:"/users",icon:K,label:"Admin"}]:a})(o?.role,d),u=e=>{s({to:e})};return t.jsxs("header",{className:"flex w-full flex-col bg-gradient-to-b from-background/90 to-background/70 border-b border-border",children:[t.jsxs("div",{className:"flex w-full items-center justify-between px-4 py-3",children:[t.jsx("button",{onClick:()=>u("/game"),className:"group cursor-pointer",children:t.jsx("h1",{className:"text-xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-purple-400 to-pink-600 group-hover:from-purple-500 group-hover:to-pink-700 transition-colors",children:"Tower Trials"})}),t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx(ts,{}),t.jsxs("div",{className:"hidden sm:flex items-center gap-2 text-muted-foreground",children:[t.jsx(K,{className:"h-4 w-4"}),t.jsx("span",{className:"text-sm",children:e})]}),t.jsx(Wa,{variant:"ghost",size:"icon",onClick:()=>c("dark"===l?"light":"dark"),className:"text-muted-foreground hover:text-primary transition-colors",title:"dark"===l?"Modo claro":"Modo escuro",children:"dark"===l?t.jsx(J,{className:"h-5 w-5"}):t.jsx(Q,{className:"h-5 w-5"})}),t.jsx(Wa,{variant:"ghost",size:"icon",className:"text-muted-foreground hover:text-primary transition-colors",onClick:()=>u("/profile"),children:t.jsx(K,{className:"h-5 w-5"})}),t.jsx(Wa,{variant:"ghost",size:"icon",className:"text-muted-foreground hover:text-primary transition-colors",onClick:()=>u("/logout"),children:t.jsx(Z,{className:"h-5 w-5"})}),t.jsxs(as,{children:[t.jsx(ss,{asChild:!0,children:t.jsx(Wa,{variant:"ghost",size:"icon",className:"text-muted-foreground hover:text-primary transition-colors lg:hidden",children:t.jsx(ee,{className:"h-5 w-5"})})}),t.jsxs(os,{side:"left",className:"w-[300px] bg-background border-r border-border p-0",children:[t.jsx(ls,{className:"border-b border-border p-4",children:t.jsx(cs,{children:"Menu Principal"})}),t.jsxs("div",{className:"flex flex-col py-2",children:[m.map((e=>{const a=e.icon,s=i===e.href;return t.jsxs("button",{onClick:()=>u(e.href),className:"flex items-center gap-3 px-4 py-3 transition-colors hover:bg-accent text-left cursor-pointer "+(s?"bg-accent text-primary":"text-muted-foreground"),children:[t.jsx(a,{className:"h-5 w-5"}),t.jsx("span",{className:"text-sm font-medium",children:e.label})]},e.href)})),t.jsx("button",{onClick:()=>c("dark"===l?"light":"dark"),className:"flex items-center gap-3 px-4 py-3 transition-colors hover:bg-accent text-muted-foreground text-left cursor-pointer",children:"dark"===l?t.jsxs(t.Fragment,{children:[t.jsx(J,{className:"h-5 w-5"}),t.jsx("span",{className:"text-sm font-medium",children:"Modo Claro"})]}):t.jsxs(t.Fragment,{children:[t.jsx(Q,{className:"h-5 w-5"}),t.jsx("span",{className:"text-sm font-medium",children:"Modo Escuro"})]})})]})]})]})]})]}),t.jsx("nav",{className:"hidden border-t border-border lg:block",children:t.jsx("div",{className:"flex items-center justify-center gap-1 px-2",children:m.map((e=>{const a=e.icon,s=i===e.href;return t.jsxs("button",{onClick:()=>u(e.href),className:"flex items-center gap-2 rounded-md px-4 py-3 transition-colors hover:bg-accent cursor-pointer "+(s?"text-primary":"text-muted-foreground"),children:[t.jsx(a,{className:"h-4 w-4"}),t.jsx("span",{className:"text-sm font-medium",children:e.label})]},e.href)}))})})]})}const ms=l("/_authenticated")({component:function(){return t.jsx(Qa,{children:t.jsx(Za,{children:t.jsx(us,{})})})}});function us(){const{user:e}=Oa();return n().pathname.startsWith("/game")?t.jsx("div",{className:"flex min-h-screen w-full flex-col bg-transparent",children:t.jsx("main",{className:"flex-1 w-full p-0 m-0 min-h-screen",children:t.jsx(s,{})})}):t.jsxs("div",{className:"flex min-h-screen w-full flex-col",children:[t.jsx(ds,{userName:e?.username||"Usuário"}),t.jsx("main",{className:"flex-1 w-full",children:t.jsx(s,{})}),t.jsx(Ya,{})]})}const hs=l("/")({beforeLoad:()=>{throw c({to:"/game"})}}),ps=l("/_public/logout")({component:function(){const{signOut:a,user:s}=Oa(),n=r();return e.useEffect((()=>{(async()=>{s&&(_.info("Encerrando sessão..."),await a()),setTimeout((()=>{n({to:"/auth",search:{auth:"true"}})}),1e3)})()}),[a,n,s]),t.jsx("div",{className:"flex min-h-screen items-center justify-center",children:t.jsxs("div",{className:"text-center space-y-4",children:[t.jsx(Ba,{}),t.jsx("p",{className:"text-muted-foreground",children:"Encerrando sessão..."})]})})}});function xs(e,t,a){function s(a,s){var r;Object.defineProperty(a,"_zod",{value:a._zod??{},enumerable:!1}),(r=a._zod).traits??(r.traits=new Set),a._zod.traits.add(e),t(a,s);for(const e in i.prototype)e in a||Object.defineProperty(a,e,{value:i.prototype[e].bind(a)});a._zod.constr=i,a._zod.def=s}const r=a?.Parent??Object;class n extends r{}function i(e){var t;const r=a?.Parent?new n:this;s(r,e),(t=r._zod).deferred??(t.deferred=[]);for(const a of r._zod.deferred)a();return r}return Object.defineProperty(n,"name",{value:e}),Object.defineProperty(i,"init",{value:s}),Object.defineProperty(i,Symbol.hasInstance,{value:t=>!!(a?.Parent&&t instanceof a.Parent)||t?._zod?.traits?.has(e)}),Object.defineProperty(i,"name",{value:e}),i}class fs extends Error{constructor(){super("Encountered Promise during synchronous parse. Use .parseAsync() instead.")}}const gs={};function bs(e){return gs}function vs(e,t){return"bigint"==typeof t?t.toString():t}function ys(e){return"string"==typeof e?e:e?.message}function js(e,t,a){const s={...e,path:e.path??[]};if(!e.message){const r=ys(e.inst?._zod.def?.error?.(e))??ys(t?.error?.(e))??ys(a.customError?.(e))??ys(a.localeError?.(e))??"Invalid input";s.message=r}return delete s.inst,delete s.continue,t?.reportInput||delete s.input,s}const Ns=(e,t)=>{e.name="$ZodError",Object.defineProperty(e,"_zod",{value:e._zod,enumerable:!1}),Object.defineProperty(e,"issues",{value:t,enumerable:!1}),Object.defineProperty(e,"message",{get:()=>JSON.stringify(t,vs,2),enumerable:!0})},_s=xs("$ZodError",Ns),ws=xs("$ZodError",Ns,{Parent:Error}),Cs=(e=>(t,a,s,r)=>{const n=s?Object.assign(s,{async:!1}):{async:!1},i=t._zod.run({value:a,issues:[]},n);if(i instanceof Promise)throw new fs;if(i.issues.length){const t=new(r?.Err??e)(i.issues.map((e=>js(e,n,bs()))));throw Error.captureStackTrace(t,r?.callee),t}return i.value})(ws),Ss=(e=>async(t,a,s,r)=>{const n=s?Object.assign(s,{async:!0}):{async:!0};let i=t._zod.run({value:a,issues:[]},n);if(i instanceof Promise&&(i=await i),i.issues.length){const t=new(r?.Err??e)(i.issues.map((e=>js(e,n,bs()))));throw Error.captureStackTrace(t,r?.callee),t}return i.value})(ws);function Es(e,t){try{var a=e()}catch(e){return t(e)}return a&&a.then?a.then(void 0,t):a}function ks(e,t){for(var a={};e.length;){var s=e[0],r=s.code,n=s.message,i=s.path.join(".");if(!a[i])if("unionErrors"in s){var o=s.unionErrors[0].errors[0];a[i]={message:o.message,type:o.code}}else a[i]={message:n,type:r};if("unionErrors"in s&&s.unionErrors.forEach((function(t){return t.errors.forEach((function(t){return e.push(t)}))})),t){var l=a[i].types,c=l&&l[s.code];a[i]=S(i,t,a,r,c?[].concat(c,s.message):s.message)}e.shift()}return a}function As(e,t){for(var a={};e.length;){var s=e[0],r=s.code,n=s.message,i=s.path.join(".");if(!a[i])if("invalid_union"===s.code){var o=s.errors[0][0];a[i]={message:o.message,type:o.code}}else a[i]={message:n,type:r};if("invalid_union"===s.code&&s.errors.forEach((function(t){return t.forEach((function(t){return e.push(t)}))})),t){var l=a[i].types,c=l&&l[s.code];a[i]=S(i,t,a,r,c?[].concat(c,s.message):s.message)}e.shift()}return a}function Ps(e,t,a){if(void 0===a&&(a={}),"_def"in(s=e)&&"object"==typeof s._def&&"typeName"in s._def)return function(r,n,i){try{return Promise.resolve(Es((function(){return Promise.resolve(e["sync"===a.mode?"parse":"parseAsync"](r,t)).then((function(e){return i.shouldUseNativeValidation&&w({},i),{errors:{},values:a.raw?Object.assign({},r):e}}))}),(function(e){if(function(e){return Array.isArray(null==e?void 0:e.issues)}(e))return{values:{},errors:C(ks(e.errors,!i.shouldUseNativeValidation&&"all"===i.criteriaMode),i)};throw e})))}catch(s){return Promise.reject(s)}};var s;if(function(e){return"_zod"in e&&"object"==typeof e._zod}(e))return function(r,n,i){try{return Promise.resolve(Es((function(){return Promise.resolve(("sync"===a.mode?Cs:Ss)(e,r,t)).then((function(e){return i.shouldUseNativeValidation&&w({},i),{errors:{},values:a.raw?Object.assign({},r):e}}))}),(function(e){if(function(e){return e instanceof _s}(e))return{values:{},errors:C(As(e.issues,!i.shouldUseNativeValidation&&"all"===i.criteriaMode),i)};throw e})))}catch(s){return Promise.reject(s)}};throw new Error("Invalid input: not a Zod schema")}const Ms=e.forwardRef((({className:e,type:a,...s},r)=>t.jsx("input",{type:a,className:Ga("flex h-9 w-full rounded-md border border-neutral-200 bg-white px-3 py-1 text-sm shadow-sm transition-colors file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-neutral-500 focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-neutral-950 disabled:cursor-not-allowed disabled:opacity-50 dark:border-neutral-800 dark:bg-neutral-950 dark:placeholder:text-neutral-400 dark:focus-visible:ring-neutral-300",e),ref:r,...s})));Ms.displayName="Input";var Ts=e.forwardRef(((e,a)=>t.jsx(re.label,{...e,ref:a,onMouseDown:t=>{t.target.closest("button, input, select, textarea")||(e.onMouseDown?.(t),!t.defaultPrevented&&t.detail>1&&t.preventDefault())}})));Ts.displayName="Label";var qs=Ts;const Ds=I("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),Ls=e.forwardRef((({className:e,...a},s)=>t.jsx(qs,{ref:s,className:Ga(Ds(),e),...a})));Ls.displayName=qs.displayName;const $s=k,Rs=e.createContext({}),Is=({...e})=>t.jsx(Rs.Provider,{value:{name:e.name},children:t.jsx(A,{...e})}),Fs=()=>{const t=e.useContext(Rs),a=e.useContext(Vs),{getFieldState:s,formState:r}=E(),n=s(t.name,r);if(!t)throw new Error("useFormField should be used within <FormField>");const{id:i}=a;return{id:i,name:t.name,formItemId:`${i}-form-item`,formDescriptionId:`${i}-form-item-description`,formMessageId:`${i}-form-item-message`,...n}},Vs=e.createContext({}),Os=e.forwardRef((({className:a,...s},r)=>{const n=e.useId();return t.jsx(Vs.Provider,{value:{id:n},children:t.jsx("div",{ref:r,className:Ga("space-y-2",a),...s})})}));Os.displayName="FormItem";const Bs=e.forwardRef((({className:e,...a},s)=>{const{error:r,formItemId:n}=Fs();return t.jsx(Ls,{ref:s,className:Ga(r&&"text-destructive",e),htmlFor:n,...a})}));Bs.displayName="FormLabel";const Us=e.forwardRef((({...e},a)=>{const{error:s,formItemId:r,formDescriptionId:n,formMessageId:i}=Fs();return t.jsx(R,{ref:a,id:r,"aria-describedby":s?`${n} ${i}`:`${n}`,"aria-invalid":!!s,...e})}));Us.displayName="FormControl";e.forwardRef((({className:e,...a},s)=>{const{formDescriptionId:r}=Fs();return t.jsx("p",{ref:s,id:r,className:Ga("text-[0.8rem] text-muted-foreground",e),...a})})).displayName="FormDescription";const zs=e.forwardRef((({className:e,children:a,...s},r)=>{const{error:n,formMessageId:i}=Fs(),o=n?String(n?.message??""):a;return o?t.jsx("p",{ref:r,id:i,className:Ga("text-[0.8rem] font-medium text-destructive",e),...s,children:o}):null}));function Hs({onSubmit:e,isLoading:a}){const s=P({resolver:Ps(ja),defaultValues:{email:"",password:""}});return t.jsx($s,{...s,children:t.jsxs("form",{onSubmit:s.handleSubmit(e),className:"space-y-4",children:[t.jsx(Is,{control:s.control,name:"email",render:({field:e})=>t.jsxs(Os,{children:[t.jsx(Bs,{children:"Email"}),t.jsx(Us,{children:t.jsx(Ms,{type:"email",placeholder:"seu@email.com",...e})}),t.jsx(zs,{})]})}),t.jsx(Is,{control:s.control,name:"password",render:({field:e})=>t.jsxs(Os,{children:[t.jsx(Bs,{children:"Senha"}),t.jsx(Us,{children:t.jsx(Ms,{type:"password",placeholder:"••••••",...e})}),t.jsx(zs,{})]})}),t.jsx(Wa,{type:"submit",className:"w-full",disabled:a,children:a?"Processando...":"Entrar"})]})})}function Gs({onSubmit:e,isLoading:a}){const s=P({resolver:Ps(Na),defaultValues:{email:"",password:"",confirmPassword:""}});return t.jsx($s,{...s,children:t.jsxs("form",{onSubmit:s.handleSubmit(e),className:"space-y-4",children:[t.jsx(Is,{control:s.control,name:"email",render:({field:e})=>t.jsxs(Os,{children:[t.jsx(Bs,{children:"Email"}),t.jsx(Us,{children:t.jsx(Ms,{type:"email",placeholder:"seu@email.com",...e})}),t.jsx(zs,{})]})}),t.jsx(Is,{control:s.control,name:"password",render:({field:e})=>t.jsxs(Os,{children:[t.jsx(Bs,{children:"Senha"}),t.jsx(Us,{children:t.jsx(Ms,{type:"password",placeholder:"••••••",...e})}),t.jsx(zs,{})]})}),t.jsx(Is,{control:s.control,name:"confirmPassword",render:({field:e})=>t.jsxs(Os,{children:[t.jsx(Bs,{children:"Confirmar Senha"}),t.jsx(Us,{children:t.jsx(Ms,{type:"password",placeholder:"••••••",...e})}),t.jsx(zs,{})]})}),t.jsx(Wa,{type:"submit",className:"w-full",disabled:a,children:a?"Processando...":"Criar Conta"})]})})}zs.displayName="FormMessage";const Xs=e.createContext({});function Ws(t){const a=e.useRef(null);return null===a.current&&(a.current=t()),a.current}const Ys="undefined"!=typeof window,Ks=Ys?e.useLayoutEffect:e.useEffect,Js=e.createContext(null);function Qs(e,t){-1===e.indexOf(t)&&e.push(t)}function Zs(e,t){const a=e.indexOf(t);a>-1&&e.splice(a,1)}const er=(e,t,a)=>a>t?t:a<e?e:a;const tr={},ar=e=>/^-?(?:\d+(?:\.\d+)?|\.\d+)$/u.test(e);function sr(e){return"object"==typeof e&&null!==e}const rr=e=>/^0[^.\s]+$/u.test(e);function nr(e){let t;return()=>(void 0===t&&(t=e()),t)}const ir=e=>e,or=(e,t)=>a=>t(e(a)),lr=(...e)=>e.reduce(or),cr=(e,t,a)=>{const s=t-e;return 0===s?1:(a-e)/s};class dr{constructor(){this.subscriptions=[]}add(e){return Qs(this.subscriptions,e),()=>Zs(this.subscriptions,e)}notify(e,t,a){const s=this.subscriptions.length;if(s)if(1===s)this.subscriptions[0](e,t,a);else for(let r=0;r<s;r++){const s=this.subscriptions[r];s&&s(e,t,a)}}getSize(){return this.subscriptions.length}clear(){this.subscriptions.length=0}}const mr=e=>1e3*e,ur=e=>e/1e3;function hr(e,t){return t?e*(1e3/t):0}const pr=(e,t,a)=>(((1-3*a+3*t)*e+(3*a-6*t))*e+3*t)*e;function xr(e,t,a,s){if(e===t&&a===s)return ir;const r=t=>function(e,t,a,s,r){let n,i,o=0;do{i=t+(a-t)/2,n=pr(i,s,r)-e,n>0?a=i:t=i}while(Math.abs(n)>1e-7&&++o<12);return i}(t,0,1,e,a);return e=>0===e||1===e?e:pr(r(e),t,s)}const fr=e=>t=>t<=.5?e(2*t)/2:(2-e(2*(1-t)))/2,gr=e=>t=>1-e(1-t),br=xr(.33,1.53,.69,.99),vr=gr(br),yr=fr(vr),jr=e=>(e*=2)<1?.5*vr(e):.5*(2-Math.pow(2,-10*(e-1))),Nr=e=>1-Math.sin(Math.acos(e)),_r=gr(Nr),wr=fr(Nr),Cr=xr(.42,0,1,1),Sr=xr(0,0,.58,1),Er=xr(.42,0,.58,1),kr=e=>Array.isArray(e)&&"number"==typeof e[0],Ar={linear:ir,easeIn:Cr,easeInOut:Er,easeOut:Sr,circIn:Nr,circInOut:wr,circOut:_r,backIn:vr,backInOut:yr,backOut:br,anticipate:jr},Pr=e=>{if(kr(e)){e.length;const[t,a,s,r]=e;return xr(t,a,s,r)}return"string"==typeof e?Ar[e]:e},Mr=["setup","read","resolveKeyframes","preUpdate","update","preRender","render","postRender"],Tr={value:null};function qr(e,t){let a=!1,s=!0;const r={delta:0,timestamp:0,isProcessing:!1},n=()=>a=!0,i=Mr.reduce(((e,a)=>(e[a]=function(e,t){let a=new Set,s=new Set,r=!1,n=!1;const i=new WeakSet;let o={delta:0,timestamp:0,isProcessing:!1},l=0;function c(t){i.has(t)&&(d.schedule(t),e()),l++,t(o)}const d={schedule:(e,t=!1,n=!1)=>{const o=n&&r?a:s;return t&&i.add(e),o.has(e)||o.add(e),e},cancel:e=>{s.delete(e),i.delete(e)},process:e=>{o=e,r?n=!0:(r=!0,[a,s]=[s,a],a.forEach(c),t&&Tr.value&&Tr.value.frameloop[t].push(l),l=0,a.clear(),r=!1,n&&(n=!1,d.process(e)))}};return d}(n,t?a:void 0),e)),{}),{setup:o,read:l,resolveKeyframes:c,preUpdate:d,update:m,preRender:u,render:h,postRender:p}=i,x=()=>{const n=tr.useManualTiming?r.timestamp:performance.now();a=!1,tr.useManualTiming||(r.delta=s?1e3/60:Math.max(Math.min(n-r.timestamp,40),1)),r.timestamp=n,r.isProcessing=!0,o.process(r),l.process(r),c.process(r),d.process(r),m.process(r),u.process(r),h.process(r),p.process(r),r.isProcessing=!1,a&&t&&(s=!1,e(x))};return{schedule:Mr.reduce(((t,n)=>{const o=i[n];return t[n]=(t,n=!1,i=!1)=>(a||(a=!0,s=!0,r.isProcessing||e(x)),o.schedule(t,n,i)),t}),{}),cancel:e=>{for(let t=0;t<Mr.length;t++)i[Mr[t]].cancel(e)},state:r,steps:i}}const{schedule:Dr,cancel:Lr,state:$r,steps:Rr}=qr("undefined"!=typeof requestAnimationFrame?requestAnimationFrame:ir,!0);let Ir;function Fr(){Ir=void 0}const Vr={now:()=>(void 0===Ir&&Vr.set($r.isProcessing||tr.useManualTiming?$r.timestamp:performance.now()),Ir),set:e=>{Ir=e,queueMicrotask(Fr)}},Or=e=>t=>"string"==typeof t&&t.startsWith(e),Br=Or("--"),Ur=Or("var(--"),zr=e=>!!Ur(e)&&Hr.test(e.split("/*")[0].trim()),Hr=/var\(--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)$/iu,Gr={test:e=>"number"==typeof e,parse:parseFloat,transform:e=>e},Xr={...Gr,transform:e=>er(0,1,e)},Wr={...Gr,default:1},Yr=e=>Math.round(1e5*e)/1e5,Kr=/-?(?:\d+(?:\.\d+)?|\.\d+)/gu;const Jr=/^(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))$/iu,Qr=(e,t)=>a=>Boolean("string"==typeof a&&Jr.test(a)&&a.startsWith(e)||t&&!function(e){return null==e}(a)&&Object.prototype.hasOwnProperty.call(a,t)),Zr=(e,t,a)=>s=>{if("string"!=typeof s)return s;const[r,n,i,o]=s.match(Kr);return{[e]:parseFloat(r),[t]:parseFloat(n),[a]:parseFloat(i),alpha:void 0!==o?parseFloat(o):1}},en={...Gr,transform:e=>Math.round((e=>er(0,255,e))(e))},tn={test:Qr("rgb","red"),parse:Zr("red","green","blue"),transform:({red:e,green:t,blue:a,alpha:s=1})=>"rgba("+en.transform(e)+", "+en.transform(t)+", "+en.transform(a)+", "+Yr(Xr.transform(s))+")"};const an={test:Qr("#"),parse:function(e){let t="",a="",s="",r="";return e.length>5?(t=e.substring(1,3),a=e.substring(3,5),s=e.substring(5,7),r=e.substring(7,9)):(t=e.substring(1,2),a=e.substring(2,3),s=e.substring(3,4),r=e.substring(4,5),t+=t,a+=a,s+=s,r+=r),{red:parseInt(t,16),green:parseInt(a,16),blue:parseInt(s,16),alpha:r?parseInt(r,16)/255:1}},transform:tn.transform},sn=e=>({test:t=>"string"==typeof t&&t.endsWith(e)&&1===t.split(" ").length,parse:parseFloat,transform:t=>`${t}${e}`}),rn=sn("deg"),nn=sn("%"),on=sn("px"),ln=sn("vh"),cn=sn("vw"),dn=(()=>({...nn,parse:e=>nn.parse(e)/100,transform:e=>nn.transform(100*e)}))(),mn={test:Qr("hsl","hue"),parse:Zr("hue","saturation","lightness"),transform:({hue:e,saturation:t,lightness:a,alpha:s=1})=>"hsla("+Math.round(e)+", "+nn.transform(Yr(t))+", "+nn.transform(Yr(a))+", "+Yr(Xr.transform(s))+")"},un={test:e=>tn.test(e)||an.test(e)||mn.test(e),parse:e=>tn.test(e)?tn.parse(e):mn.test(e)?mn.parse(e):an.parse(e),transform:e=>"string"==typeof e?e:e.hasOwnProperty("red")?tn.transform(e):mn.transform(e)},hn=/(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))/giu;const pn="number",xn="color",fn=/var\s*\(\s*--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)|#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\)|-?(?:\d+(?:\.\d+)?|\.\d+)/giu;function gn(e){const t=e.toString(),a=[],s={color:[],number:[],var:[]},r=[];let n=0;const i=t.replace(fn,(e=>(un.test(e)?(s.color.push(n),r.push(xn),a.push(un.parse(e))):e.startsWith("var(")?(s.var.push(n),r.push("var"),a.push(e)):(s.number.push(n),r.push(pn),a.push(parseFloat(e))),++n,"${}"))).split("${}");return{values:a,split:i,indexes:s,types:r}}function bn(e){return gn(e).values}function vn(e){const{split:t,types:a}=gn(e),s=t.length;return e=>{let r="";for(let n=0;n<s;n++)if(r+=t[n],void 0!==e[n]){const t=a[n];r+=t===pn?Yr(e[n]):t===xn?un.transform(e[n]):e[n]}return r}}const yn=e=>"number"==typeof e?0:e;const jn={test:function(e){return isNaN(e)&&"string"==typeof e&&(e.match(Kr)?.length||0)+(e.match(hn)?.length||0)>0},parse:bn,createTransformer:vn,getAnimatableNone:function(e){const t=bn(e);return vn(e)(t.map(yn))}};function Nn(e,t,a){return a<0&&(a+=1),a>1&&(a-=1),a<1/6?e+6*(t-e)*a:a<.5?t:a<2/3?e+(t-e)*(2/3-a)*6:e}function _n(e,t){return a=>a>0?t:e}const wn=(e,t,a)=>e+(t-e)*a,Cn=(e,t,a)=>{const s=e*e,r=a*(t*t-s)+s;return r<0?0:Math.sqrt(r)},Sn=[an,tn,mn];function En(e){const t=(e=>Sn.find((t=>t.test(e))))(e);if(!Boolean(t))return!1;let a=t.parse(e);return t===mn&&(a=function({hue:e,saturation:t,lightness:a,alpha:s}){e/=360,a/=100;let r=0,n=0,i=0;if(t/=100){const s=a<.5?a*(1+t):a+t-a*t,o=2*a-s;r=Nn(o,s,e+1/3),n=Nn(o,s,e),i=Nn(o,s,e-1/3)}else r=n=i=a;return{red:Math.round(255*r),green:Math.round(255*n),blue:Math.round(255*i),alpha:s}}(a)),a}const kn=(e,t)=>{const a=En(e),s=En(t);if(!a||!s)return _n(e,t);const r={...a};return e=>(r.red=Cn(a.red,s.red,e),r.green=Cn(a.green,s.green,e),r.blue=Cn(a.blue,s.blue,e),r.alpha=wn(a.alpha,s.alpha,e),tn.transform(r))},An=new Set(["none","hidden"]);function Pn(e,t){return a=>wn(e,t,a)}function Mn(e){return"number"==typeof e?Pn:"string"==typeof e?zr(e)?_n:un.test(e)?kn:Dn:Array.isArray(e)?Tn:"object"==typeof e?un.test(e)?kn:qn:_n}function Tn(e,t){const a=[...e],s=a.length,r=e.map(((e,a)=>Mn(e)(e,t[a])));return e=>{for(let t=0;t<s;t++)a[t]=r[t](e);return a}}function qn(e,t){const a={...e,...t},s={};for(const r in a)void 0!==e[r]&&void 0!==t[r]&&(s[r]=Mn(e[r])(e[r],t[r]));return e=>{for(const t in s)a[t]=s[t](e);return a}}const Dn=(e,t)=>{const a=jn.createTransformer(t),s=gn(e),r=gn(t);return s.indexes.var.length===r.indexes.var.length&&s.indexes.color.length===r.indexes.color.length&&s.indexes.number.length>=r.indexes.number.length?An.has(e)&&!r.values.length||An.has(t)&&!s.values.length?function(e,t){return An.has(e)?a=>a<=0?e:t:a=>a>=1?t:e}(e,t):lr(Tn(function(e,t){const a=[],s={color:0,var:0,number:0};for(let r=0;r<t.values.length;r++){const n=t.types[r],i=e.indexes[n][s[n]],o=e.values[i]??0;a[r]=o,s[n]++}return a}(s,r),r.values),a):_n(e,t)};function Ln(e,t,a){if("number"==typeof e&&"number"==typeof t&&"number"==typeof a)return wn(e,t,a);return Mn(e)(e,t)}const $n=e=>{const t=({timestamp:t})=>e(t);return{start:(e=!0)=>Dr.update(t,e),stop:()=>Lr(t),now:()=>$r.isProcessing?$r.timestamp:Vr.now()}},Rn=(e,t,a=10)=>{let s="";const r=Math.max(Math.round(t/a),2);for(let n=0;n<r;n++)s+=e(n/(r-1))+", ";return`linear(${s.substring(0,s.length-2)})`},In=2e4;function Fn(e){let t=0;let a=e.next(t);for(;!a.done&&t<In;)t+=50,a=e.next(t);return t>=In?1/0:t}function Vn(e,t,a){const s=Math.max(t-5,0);return hr(a-e(s),t-s)}const On=100,Bn=10,Un=1,zn=0,Hn=800,Gn=.3,Xn=.3,Wn={granular:.01,default:2},Yn={granular:.005,default:.5},Kn=.01,Jn=10,Qn=.05,Zn=1,ei=.001;function ti({duration:e=Hn,bounce:t=Gn,velocity:a=zn,mass:s=Un}){let r,n,i=1-t;i=er(Qn,Zn,i),e=er(Kn,Jn,ur(e)),i<1?(r=t=>{const s=t*i,r=s*e,n=s-a,o=si(t,i),l=Math.exp(-r);return ei-n/o*l},n=t=>{const s=t*i*e,n=s*a+a,o=Math.pow(i,2)*Math.pow(t,2)*e,l=Math.exp(-s),c=si(Math.pow(t,2),i);return(-r(t)+ei>0?-1:1)*((n-o)*l)/c}):(r=t=>Math.exp(-t*e)*((t-a)*e+1)-.001,n=t=>Math.exp(-t*e)*(e*e*(a-t)));const o=function(e,t,a){let s=a;for(let r=1;r<ai;r++)s-=e(s)/t(s);return s}(r,n,5/e);if(e=mr(e),isNaN(o))return{stiffness:On,damping:Bn,duration:e};{const t=Math.pow(o,2)*s;return{stiffness:t,damping:2*i*Math.sqrt(s*t),duration:e}}}const ai=12;function si(e,t){return e*Math.sqrt(1-t*t)}const ri=["duration","bounce"],ni=["stiffness","damping","mass"];function ii(e,t){return t.some((t=>void 0!==e[t]))}function oi(e=Xn,t=Gn){const a="object"!=typeof e?{visualDuration:e,keyframes:[0,1],bounce:t}:e;let{restSpeed:s,restDelta:r}=a;const n=a.keyframes[0],i=a.keyframes[a.keyframes.length-1],o={done:!1,value:n},{stiffness:l,damping:c,mass:d,duration:m,velocity:u,isResolvedFromDuration:h}=function(e){let t={velocity:zn,stiffness:On,damping:Bn,mass:Un,isResolvedFromDuration:!1,...e};if(!ii(e,ni)&&ii(e,ri))if(e.visualDuration){const a=e.visualDuration,s=2*Math.PI/(1.2*a),r=s*s,n=2*er(.05,1,1-(e.bounce||0))*Math.sqrt(r);t={...t,mass:Un,stiffness:r,damping:n}}else{const a=ti(e);t={...t,...a,mass:Un},t.isResolvedFromDuration=!0}return t}({...a,velocity:-ur(a.velocity||0)}),p=u||0,x=c/(2*Math.sqrt(l*d)),f=i-n,g=ur(Math.sqrt(l/d)),b=Math.abs(f)<5;let v;if(s||(s=b?Wn.granular:Wn.default),r||(r=b?Yn.granular:Yn.default),x<1){const e=si(g,x);v=t=>{const a=Math.exp(-x*g*t);return i-a*((p+x*g*f)/e*Math.sin(e*t)+f*Math.cos(e*t))}}else if(1===x)v=e=>i-Math.exp(-g*e)*(f+(p+g*f)*e);else{const e=g*Math.sqrt(x*x-1);v=t=>{const a=Math.exp(-x*g*t),s=Math.min(e*t,300);return i-a*((p+x*g*f)*Math.sinh(s)+e*f*Math.cosh(s))/e}}const y={calculatedDuration:h&&m||null,next:e=>{const t=v(e);if(h)o.done=e>=m;else{let a=0===e?p:0;x<1&&(a=0===e?mr(p):Vn(v,e,t));const n=Math.abs(a)<=s,l=Math.abs(i-t)<=r;o.done=n&&l}return o.value=o.done?i:t,o},toString:()=>{const e=Math.min(Fn(y),In),t=Rn((t=>y.next(e*t).value),e,30);return e+"ms "+t},toTransition:()=>{}};return y}function li({keyframes:e,velocity:t=0,power:a=.8,timeConstant:s=325,bounceDamping:r=10,bounceStiffness:n=500,modifyTarget:i,min:o,max:l,restDelta:c=.5,restSpeed:d}){const m=e[0],u={done:!1,value:m},h=e=>void 0===o?l:void 0===l||Math.abs(o-e)<Math.abs(l-e)?o:l;let p=a*t;const x=m+p,f=void 0===i?x:i(x);f!==x&&(p=f-m);const g=e=>-p*Math.exp(-e/s),b=e=>f+g(e),v=e=>{const t=g(e),a=b(e);u.done=Math.abs(t)<=c,u.value=u.done?f:a};let y,j;const N=e=>{(e=>void 0!==o&&e<o||void 0!==l&&e>l)(u.value)&&(y=e,j=oi({keyframes:[u.value,h(u.value)],velocity:Vn(b,e,u.value),damping:r,stiffness:n,restDelta:c,restSpeed:d}))};return N(0),{calculatedDuration:null,next:e=>{let t=!1;return j||void 0!==y||(t=!0,v(e),N(e)),void 0!==y&&e>=y?j.next(e-y):(!t&&v(e),u)}}}function ci(e,t,{clamp:a=!0,ease:s,mixer:r}={}){const n=e.length;if(t.length,1===n)return()=>t[0];if(2===n&&t[0]===t[1])return()=>t[1];const i=e[0]===e[1];e[0]>e[n-1]&&(e=[...e].reverse(),t=[...t].reverse());const o=function(e,t,a){const s=[],r=a||tr.mix||Ln,n=e.length-1;for(let i=0;i<n;i++){let a=r(e[i],e[i+1]);if(t){const e=Array.isArray(t)?t[i]||ir:t;a=lr(e,a)}s.push(a)}return s}(t,s,r),l=o.length,c=a=>{if(i&&a<e[0])return t[0];let s=0;if(l>1)for(;s<e.length-2&&!(a<e[s+1]);s++);const r=cr(e[s],e[s+1],a);return o[s](r)};return a?t=>c(er(e[0],e[n-1],t)):c}function di(e){const t=[0];return function(e,t){const a=e[e.length-1];for(let s=1;s<=t;s++){const r=cr(0,t,s);e.push(wn(a,1,r))}}(t,e.length-1),t}function mi({duration:e=300,keyframes:t,times:a,ease:s="easeInOut"}){const r=(e=>Array.isArray(e)&&"number"!=typeof e[0])(s)?s.map(Pr):Pr(s),n={done:!1,value:t[0]},i=function(e,t){return e.map((e=>e*t))}(a&&a.length===t.length?a:di(t),e),o=ci(i,t,{ease:Array.isArray(r)?r:(l=t,c=r,l.map((()=>c||Er)).splice(0,l.length-1))});var l,c;return{calculatedDuration:e,next:t=>(n.value=o(t),n.done=t>=e,n)}}oi.applyToOptions=e=>{const t=function(e,t=100,a){const s=a({...e,keyframes:[0,t]}),r=Math.min(Fn(s),In);return{type:"keyframes",ease:e=>s.next(r*e).value/t,duration:ur(r)}}(e,100,oi);return e.ease=t.ease,e.duration=mr(t.duration),e.type="keyframes",e};const ui=e=>null!==e;function hi(e,{repeat:t,repeatType:a="loop"},s,r=1){const n=e.filter(ui),i=r<0||t&&"loop"!==a&&t%2==1?0:n.length-1;return i&&void 0!==s?s:n[i]}const pi={decay:li,inertia:li,tween:mi,keyframes:mi,spring:oi};function xi(e){"string"==typeof e.type&&(e.type=pi[e.type])}class fi{constructor(){this.updateFinished()}get finished(){return this._finished}updateFinished(){this._finished=new Promise((e=>{this.resolve=e}))}notifyFinished(){this.resolve()}then(e,t){return this.finished.then(e,t)}}const gi=e=>e/100;class bi extends fi{constructor(e){super(),this.state="idle",this.startTime=null,this.isStopped=!1,this.currentTime=0,this.holdTime=null,this.playbackSpeed=1,this.stop=()=>{const{motionValue:e}=this.options;e&&e.updatedAt!==Vr.now()&&this.tick(Vr.now()),this.isStopped=!0,"idle"!==this.state&&(this.teardown(),this.options.onStop?.())},this.options=e,this.initAnimation(),this.play(),!1===e.autoplay&&this.pause()}initAnimation(){const{options:e}=this;xi(e);const{type:t=mi,repeat:a=0,repeatDelay:s=0,repeatType:r,velocity:n=0}=e;let{keyframes:i}=e;const o=t||mi;o!==mi&&"number"!=typeof i[0]&&(this.mixKeyframes=lr(gi,Ln(i[0],i[1])),i=[0,100]);const l=o({...e,keyframes:i});"mirror"===r&&(this.mirroredGenerator=o({...e,keyframes:[...i].reverse(),velocity:-n})),null===l.calculatedDuration&&(l.calculatedDuration=Fn(l));const{calculatedDuration:c}=l;this.calculatedDuration=c,this.resolvedDuration=c+s,this.totalDuration=this.resolvedDuration*(a+1)-s,this.generator=l}updateTime(e){const t=Math.round(e-this.startTime)*this.playbackSpeed;null!==this.holdTime?this.currentTime=this.holdTime:this.currentTime=t}tick(e,t=!1){const{generator:a,totalDuration:s,mixKeyframes:r,mirroredGenerator:n,resolvedDuration:i,calculatedDuration:o}=this;if(null===this.startTime)return a.next(0);const{delay:l=0,keyframes:c,repeat:d,repeatType:m,repeatDelay:u,type:h,onUpdate:p,finalKeyframe:x}=this.options;this.speed>0?this.startTime=Math.min(this.startTime,e):this.speed<0&&(this.startTime=Math.min(e-s/this.speed,this.startTime)),t?this.currentTime=e:this.updateTime(e);const f=this.currentTime-l*(this.playbackSpeed>=0?1:-1),g=this.playbackSpeed>=0?f<0:f>s;this.currentTime=Math.max(f,0),"finished"===this.state&&null===this.holdTime&&(this.currentTime=s);let b=this.currentTime,v=a;if(d){const e=Math.min(this.currentTime,s)/i;let t=Math.floor(e),a=e%1;!a&&e>=1&&(a=1),1===a&&t--,t=Math.min(t,d+1);Boolean(t%2)&&("reverse"===m?(a=1-a,u&&(a-=u/i)):"mirror"===m&&(v=n)),b=er(0,1,a)*i}const y=g?{done:!1,value:c[0]}:v.next(b);r&&(y.value=r(y.value));let{done:j}=y;g||null===o||(j=this.playbackSpeed>=0?this.currentTime>=s:this.currentTime<=0);const N=null===this.holdTime&&("finished"===this.state||"running"===this.state&&j);return N&&h!==li&&(y.value=hi(c,this.options,x,this.speed)),p&&p(y.value),N&&this.finish(),y}then(e,t){return this.finished.then(e,t)}get duration(){return ur(this.calculatedDuration)}get time(){return ur(this.currentTime)}set time(e){e=mr(e),this.currentTime=e,null===this.startTime||null!==this.holdTime||0===this.playbackSpeed?this.holdTime=e:this.driver&&(this.startTime=this.driver.now()-e/this.playbackSpeed),this.driver?.start(!1)}get speed(){return this.playbackSpeed}set speed(e){this.updateTime(Vr.now());const t=this.playbackSpeed!==e;this.playbackSpeed=e,t&&(this.time=ur(this.currentTime))}play(){if(this.isStopped)return;const{driver:e=$n,startTime:t}=this.options;this.driver||(this.driver=e((e=>this.tick(e)))),this.options.onPlay?.();const a=this.driver.now();"finished"===this.state?(this.updateFinished(),this.startTime=a):null!==this.holdTime?this.startTime=a-this.holdTime:this.startTime||(this.startTime=t??a),"finished"===this.state&&this.speed<0&&(this.startTime+=this.calculatedDuration),this.holdTime=null,this.state="running",this.driver.start()}pause(){this.state="paused",this.updateTime(Vr.now()),this.holdTime=this.currentTime}complete(){"running"!==this.state&&this.play(),this.state="finished",this.holdTime=null}finish(){this.notifyFinished(),this.teardown(),this.state="finished",this.options.onComplete?.()}cancel(){this.holdTime=null,this.startTime=0,this.tick(0),this.teardown(),this.options.onCancel?.()}teardown(){this.state="idle",this.stopDriver(),this.startTime=this.holdTime=null}stopDriver(){this.driver&&(this.driver.stop(),this.driver=void 0)}sample(e){return this.startTime=0,this.tick(e,!0)}attachTimeline(e){return this.options.allowFlatten&&(this.options.type="keyframes",this.options.ease="linear",this.initAnimation()),this.driver?.stop(),e.observe(this)}}const vi=e=>180*e/Math.PI,yi=e=>{const t=vi(Math.atan2(e[1],e[0]));return Ni(t)},ji={x:4,y:5,translateX:4,translateY:5,scaleX:0,scaleY:3,scale:e=>(Math.abs(e[0])+Math.abs(e[3]))/2,rotate:yi,rotateZ:yi,skewX:e=>vi(Math.atan(e[1])),skewY:e=>vi(Math.atan(e[2])),skew:e=>(Math.abs(e[1])+Math.abs(e[2]))/2},Ni=e=>((e%=360)<0&&(e+=360),e),_i=e=>Math.sqrt(e[0]*e[0]+e[1]*e[1]),wi=e=>Math.sqrt(e[4]*e[4]+e[5]*e[5]),Ci={x:12,y:13,z:14,translateX:12,translateY:13,translateZ:14,scaleX:_i,scaleY:wi,scale:e=>(_i(e)+wi(e))/2,rotateX:e=>Ni(vi(Math.atan2(e[6],e[5]))),rotateY:e=>Ni(vi(Math.atan2(-e[2],e[0]))),rotateZ:yi,rotate:yi,skewX:e=>vi(Math.atan(e[4])),skewY:e=>vi(Math.atan(e[1])),skew:e=>(Math.abs(e[1])+Math.abs(e[4]))/2};function Si(e){return e.includes("scale")?1:0}function Ei(e,t){if(!e||"none"===e)return Si(t);const a=e.match(/^matrix3d\(([-\d.e\s,]+)\)$/u);let s,r;if(a)s=Ci,r=a;else{const t=e.match(/^matrix\(([-\d.e\s,]+)\)$/u);s=ji,r=t}if(!r)return Si(t);const n=s[t],i=r[1].split(",").map(ki);return"function"==typeof n?n(i):i[n]}function ki(e){return parseFloat(e.trim())}const Ai=["transformPerspective","x","y","z","translateX","translateY","translateZ","scale","scaleX","scaleY","rotate","rotateX","rotateY","rotateZ","skew","skewX","skewY"],Pi=(()=>new Set(Ai))(),Mi=e=>e===Gr||e===on,Ti=new Set(["x","y","z"]),qi=Ai.filter((e=>!Ti.has(e)));const Di={width:({x:e},{paddingLeft:t="0",paddingRight:a="0"})=>e.max-e.min-parseFloat(t)-parseFloat(a),height:({y:e},{paddingTop:t="0",paddingBottom:a="0"})=>e.max-e.min-parseFloat(t)-parseFloat(a),top:(e,{top:t})=>parseFloat(t),left:(e,{left:t})=>parseFloat(t),bottom:({y:e},{top:t})=>parseFloat(t)+(e.max-e.min),right:({x:e},{left:t})=>parseFloat(t)+(e.max-e.min),x:(e,{transform:t})=>Ei(t,"x"),y:(e,{transform:t})=>Ei(t,"y")};Di.translateX=Di.x,Di.translateY=Di.y;const Li=new Set;let $i=!1,Ri=!1,Ii=!1;function Fi(){if(Ri){const e=Array.from(Li).filter((e=>e.needsMeasurement)),t=new Set(e.map((e=>e.element))),a=new Map;t.forEach((e=>{const t=function(e){const t=[];return qi.forEach((a=>{const s=e.getValue(a);void 0!==s&&(t.push([a,s.get()]),s.set(a.startsWith("scale")?1:0))})),t}(e);t.length&&(a.set(e,t),e.render())})),e.forEach((e=>e.measureInitialState())),t.forEach((e=>{e.render();const t=a.get(e);t&&t.forEach((([t,a])=>{e.getValue(t)?.set(a)}))})),e.forEach((e=>e.measureEndState())),e.forEach((e=>{void 0!==e.suspendedScrollY&&window.scrollTo(0,e.suspendedScrollY)}))}Ri=!1,$i=!1,Li.forEach((e=>e.complete(Ii))),Li.clear()}function Vi(){Li.forEach((e=>{e.readKeyframes(),e.needsMeasurement&&(Ri=!0)}))}class Oi{constructor(e,t,a,s,r,n=!1){this.state="pending",this.isAsync=!1,this.needsMeasurement=!1,this.unresolvedKeyframes=[...e],this.onComplete=t,this.name=a,this.motionValue=s,this.element=r,this.isAsync=n}scheduleResolve(){this.state="scheduled",this.isAsync?(Li.add(this),$i||($i=!0,Dr.read(Vi),Dr.resolveKeyframes(Fi))):(this.readKeyframes(),this.complete())}readKeyframes(){const{unresolvedKeyframes:e,name:t,element:a,motionValue:s}=this;if(null===e[0]){const r=s?.get(),n=e[e.length-1];if(void 0!==r)e[0]=r;else if(a&&t){const s=a.readValue(t,n);null!=s&&(e[0]=s)}void 0===e[0]&&(e[0]=n),s&&void 0===r&&s.set(e[0])}!function(e){for(let t=1;t<e.length;t++)e[t]??(e[t]=e[t-1])}(e)}setFinalKeyframe(){}measureInitialState(){}renderEndStyles(){}measureEndState(){}complete(e=!1){this.state="complete",this.onComplete(this.unresolvedKeyframes,this.finalKeyframe,e),Li.delete(this)}cancel(){"scheduled"===this.state&&(Li.delete(this),this.state="pending")}resume(){"pending"===this.state&&this.scheduleResolve()}}const Bi=nr((()=>void 0!==window.ScrollTimeline)),Ui={};function zi(e,t){const a=nr(e);return()=>Ui[t]??a()}const Hi=zi((()=>{try{document.createElement("div").animate({opacity:0},{easing:"linear(0, 1)"})}catch(e){return!1}return!0}),"linearEasing"),Gi=([e,t,a,s])=>`cubic-bezier(${e}, ${t}, ${a}, ${s})`,Xi={linear:"linear",ease:"ease",easeIn:"ease-in",easeOut:"ease-out",easeInOut:"ease-in-out",circIn:Gi([0,.65,.55,1]),circOut:Gi([.55,0,1,.45]),backIn:Gi([.31,.01,.66,-.59]),backOut:Gi([.33,1.53,.69,.99])};function Wi(e,t){return e?"function"==typeof e?Hi()?Rn(e,t):"ease-out":kr(e)?Gi(e):Array.isArray(e)?e.map((e=>Wi(e,t)||Xi.easeOut)):Xi[e]:void 0}function Yi(e,t,a,{delay:s=0,duration:r=300,repeat:n=0,repeatType:i="loop",ease:o="easeOut",times:l}={},c=void 0){const d={[t]:a};l&&(d.offset=l);const m=Wi(o,r);Array.isArray(m)&&(d.easing=m);const u={delay:s,duration:r,easing:Array.isArray(m)?"linear":m,fill:"both",iterations:n+1,direction:"reverse"===i?"alternate":"normal"};c&&(u.pseudoElement=c);return e.animate(d,u)}function Ki(e){return"function"==typeof e&&"applyToOptions"in e}class Ji extends fi{constructor(e){if(super(),this.finishedTime=null,this.isStopped=!1,!e)return;const{element:t,name:a,keyframes:s,pseudoElement:r,allowFlatten:n=!1,finalKeyframe:i,onComplete:o}=e;this.isPseudoElement=Boolean(r),this.allowFlatten=n,this.options=e,e.type;const l=function({type:e,...t}){return Ki(e)&&Hi()?e.applyToOptions(t):(t.duration??(t.duration=300),t.ease??(t.ease="easeOut"),t)}(e);this.animation=Yi(t,a,s,l,r),!1===l.autoplay&&this.animation.pause(),this.animation.onfinish=()=>{if(this.finishedTime=this.time,!r){const e=hi(s,this.options,i,this.speed);this.updateMotionValue?this.updateMotionValue(e):function(e,t,a){(e=>e.startsWith("--"))(t)?e.style.setProperty(t,a):e.style[t]=a}(t,a,e),this.animation.cancel()}o?.(),this.notifyFinished()}}play(){this.isStopped||(this.animation.play(),"finished"===this.state&&this.updateFinished())}pause(){this.animation.pause()}complete(){this.animation.finish?.()}cancel(){try{this.animation.cancel()}catch(e){}}stop(){if(this.isStopped)return;this.isStopped=!0;const{state:e}=this;"idle"!==e&&"finished"!==e&&(this.updateMotionValue?this.updateMotionValue():this.commitStyles(),this.isPseudoElement||this.cancel())}commitStyles(){this.isPseudoElement||this.animation.commitStyles?.()}get duration(){const e=this.animation.effect?.getComputedTiming?.().duration||0;return ur(Number(e))}get time(){return ur(Number(this.animation.currentTime)||0)}set time(e){this.finishedTime=null,this.animation.currentTime=mr(e)}get speed(){return this.animation.playbackRate}set speed(e){e<0&&(this.finishedTime=null),this.animation.playbackRate=e}get state(){return null!==this.finishedTime?"finished":this.animation.playState}get startTime(){return Number(this.animation.startTime)}set startTime(e){this.animation.startTime=e}attachTimeline({timeline:e,observe:t}){return this.allowFlatten&&this.animation.effect?.updateTiming({easing:"linear"}),this.animation.onfinish=null,e&&Bi()?(this.animation.timeline=e,ir):t(this)}}const Qi={anticipate:jr,backInOut:yr,circInOut:wr};function Zi(e){"string"==typeof e.ease&&e.ease in Qi&&(e.ease=Qi[e.ease])}class eo extends Ji{constructor(e){Zi(e),xi(e),super(e),e.startTime&&(this.startTime=e.startTime),this.options=e}updateMotionValue(e){const{motionValue:t,onUpdate:a,onComplete:s,element:r,...n}=this.options;if(!t)return;if(void 0!==e)return void t.set(e);const i=new bi({...n,autoplay:!1}),o=mr(this.finishedTime??this.time);t.setWithVelocity(i.sample(o-10).value,i.sample(o).value,10),i.stop()}}const to=(e,t)=>"zIndex"!==t&&(!("number"!=typeof e&&!Array.isArray(e))||!("string"!=typeof e||!jn.test(e)&&"0"!==e||e.startsWith("url(")));function ao(e){return sr(e)&&"offsetHeight"in e}const so=new Set(["opacity","clipPath","filter","transform"]),ro=nr((()=>Object.hasOwnProperty.call(Element.prototype,"animate")));class no extends fi{constructor({autoplay:e=!0,delay:t=0,type:a="keyframes",repeat:s=0,repeatDelay:r=0,repeatType:n="loop",keyframes:i,name:o,motionValue:l,element:c,...d}){super(),this.stop=()=>{this._animation&&(this._animation.stop(),this.stopTimeline?.()),this.keyframeResolver?.cancel()},this.createdAt=Vr.now();const m={autoplay:e,delay:t,type:a,repeat:s,repeatDelay:r,repeatType:n,name:o,motionValue:l,element:c,...d},u=c?.KeyframeResolver||Oi;this.keyframeResolver=new u(i,((e,t,a)=>this.onKeyframesResolved(e,t,m,!a)),o,l,c),this.keyframeResolver?.scheduleResolve()}onKeyframesResolved(e,t,a,s){this.keyframeResolver=void 0;const{name:r,type:n,velocity:i,delay:o,isHandoff:l,onUpdate:c}=a;this.resolvedAt=Vr.now(),function(e,t,a,s){const r=e[0];if(null===r)return!1;if("display"===t||"visibility"===t)return!0;const n=e[e.length-1],i=to(r,t),o=to(n,t);return!(!i||!o)&&(function(e){const t=e[0];if(1===e.length)return!0;for(let a=0;a<e.length;a++)if(e[a]!==t)return!0}(e)||("spring"===a||Ki(a))&&s)}(e,r,n,i)||(!tr.instantAnimations&&o||c?.(hi(e,a,t)),e[0]=e[e.length-1],a.duration=0,a.repeat=0);const d={startTime:s?this.resolvedAt&&this.resolvedAt-this.createdAt>40?this.resolvedAt:this.createdAt:void 0,finalKeyframe:t,...a,keyframes:e},m=!l&&function(e){const{motionValue:t,name:a,repeatDelay:s,repeatType:r,damping:n,type:i}=e;if(!ao(t?.owner?.current))return!1;const{onUpdate:o,transformTemplate:l}=t.owner.getProps();return ro()&&a&&so.has(a)&&("transform"!==a||!l)&&!o&&!s&&"mirror"!==r&&0!==n&&"inertia"!==i}(d)?new eo({...d,element:d.motionValue.owner.current}):new bi(d);m.finished.then((()=>this.notifyFinished())).catch(ir),this.pendingTimeline&&(this.stopTimeline=m.attachTimeline(this.pendingTimeline),this.pendingTimeline=void 0),this._animation=m}get finished(){return this._animation?this.animation.finished:this._finished}then(e,t){return this.finished.finally(e).then((()=>{}))}get animation(){return this._animation||(this.keyframeResolver?.resume(),Ii=!0,Vi(),Fi(),Ii=!1),this._animation}get duration(){return this.animation.duration}get time(){return this.animation.time}set time(e){this.animation.time=e}get speed(){return this.animation.speed}get state(){return this.animation.state}set speed(e){this.animation.speed=e}get startTime(){return this.animation.startTime}attachTimeline(e){return this._animation?this.stopTimeline=this.animation.attachTimeline(e):this.pendingTimeline=e,()=>this.stop()}play(){this.animation.play()}pause(){this.animation.pause()}complete(){this.animation.complete()}cancel(){this._animation&&this.animation.cancel(),this.keyframeResolver?.cancel()}}const io=/^var\(--(?:([\w-]+)|([\w-]+), ?([a-zA-Z\d ()%#.,-]+))\)/u;function oo(e,t,a=1){const[s,r]=function(e){const t=io.exec(e);if(!t)return[,];const[,a,s,r]=t;return[`--${a??s}`,r]}(e);if(!s)return;const n=window.getComputedStyle(t).getPropertyValue(s);if(n){const e=n.trim();return ar(e)?parseFloat(e):e}return zr(r)?oo(r,t,a+1):r}function lo(e,t){return e?.[t]??e?.default??e}const co=new Set(["width","height","top","left","right","bottom",...Ai]),mo=e=>t=>t.test(e),uo=[Gr,on,nn,rn,cn,ln,{test:e=>"auto"===e,parse:e=>e}],ho=e=>uo.find(mo(e));const po=new Set(["brightness","contrast","saturate","opacity"]);function xo(e){const[t,a]=e.slice(0,-1).split("(");if("drop-shadow"===t)return e;const[s]=a.match(Kr)||[];if(!s)return e;const r=a.replace(s,"");let n=po.has(t)?1:0;return s!==a&&(n*=100),t+"("+n+r+")"}const fo=/\b([a-z-]*)\(.*?\)/gu,go={...jn,getAnimatableNone:e=>{const t=e.match(fo);return t?t.map(xo).join(" "):e}},bo={...Gr,transform:Math.round},vo={borderWidth:on,borderTopWidth:on,borderRightWidth:on,borderBottomWidth:on,borderLeftWidth:on,borderRadius:on,radius:on,borderTopLeftRadius:on,borderTopRightRadius:on,borderBottomRightRadius:on,borderBottomLeftRadius:on,width:on,maxWidth:on,height:on,maxHeight:on,top:on,right:on,bottom:on,left:on,padding:on,paddingTop:on,paddingRight:on,paddingBottom:on,paddingLeft:on,margin:on,marginTop:on,marginRight:on,marginBottom:on,marginLeft:on,backgroundPositionX:on,backgroundPositionY:on,...{rotate:rn,rotateX:rn,rotateY:rn,rotateZ:rn,scale:Wr,scaleX:Wr,scaleY:Wr,scaleZ:Wr,skew:rn,skewX:rn,skewY:rn,distance:on,translateX:on,translateY:on,translateZ:on,x:on,y:on,z:on,perspective:on,transformPerspective:on,opacity:Xr,originX:dn,originY:dn,originZ:on},zIndex:bo,fillOpacity:Xr,strokeOpacity:Xr,numOctaves:bo},yo={...vo,color:un,backgroundColor:un,outlineColor:un,fill:un,stroke:un,borderColor:un,borderTopColor:un,borderRightColor:un,borderBottomColor:un,borderLeftColor:un,filter:go,WebkitFilter:go},jo=e=>yo[e];function No(e,t){let a=jo(e);return a!==go&&(a=jn),a.getAnimatableNone?a.getAnimatableNone(t):void 0}const _o=new Set(["auto","none","0"]);class wo extends Oi{constructor(e,t,a,s,r){super(e,t,a,s,r,!0)}readKeyframes(){const{unresolvedKeyframes:e,element:t,name:a}=this;if(!t||!t.current)return;super.readKeyframes();for(let o=0;o<e.length;o++){let a=e[o];if("string"==typeof a&&(a=a.trim(),zr(a))){const s=oo(a,t.current);void 0!==s&&(e[o]=s),o===e.length-1&&(this.finalKeyframe=a)}}if(this.resolveNoneKeyframes(),!co.has(a)||2!==e.length)return;const[s,r]=e,n=ho(s),i=ho(r);if(n!==i)if(Mi(n)&&Mi(i))for(let o=0;o<e.length;o++){const t=e[o];"string"==typeof t&&(e[o]=parseFloat(t))}else Di[a]&&(this.needsMeasurement=!0)}resolveNoneKeyframes(){const{unresolvedKeyframes:e,name:t}=this,a=[];for(let r=0;r<e.length;r++)(null===e[r]||("number"==typeof(s=e[r])?0===s:null===s||"none"===s||"0"===s||rr(s)))&&a.push(r);var s;a.length&&function(e,t,a){let s,r=0;for(;r<e.length&&!s;){const t=e[r];"string"==typeof t&&!_o.has(t)&&gn(t).values.length&&(s=e[r]),r++}if(s&&a)for(const n of t)e[n]=No(a,s)}(e,a,t)}measureInitialState(){const{element:e,unresolvedKeyframes:t,name:a}=this;if(!e||!e.current)return;"height"===a&&(this.suspendedScrollY=window.pageYOffset),this.measuredOrigin=Di[a](e.measureViewportBox(),window.getComputedStyle(e.current)),t[0]=this.measuredOrigin;const s=t[t.length-1];void 0!==s&&e.getValue(a,s).jump(s,!1)}measureEndState(){const{element:e,name:t,unresolvedKeyframes:a}=this;if(!e||!e.current)return;const s=e.getValue(t);s&&s.jump(this.measuredOrigin,!1);const r=a.length-1,n=a[r];a[r]=Di[t](e.measureViewportBox(),window.getComputedStyle(e.current)),null!==n&&void 0===this.finalKeyframe&&(this.finalKeyframe=n),this.removedTransforms?.length&&this.removedTransforms.forEach((([t,a])=>{e.getValue(t).set(a)})),this.resolveNoneKeyframes()}}const Co=(e,t)=>t&&"number"==typeof e?t.transform(e):e;class So{constructor(e,t={}){this.canTrackVelocity=null,this.events={},this.updateAndNotify=(e,t=!0)=>{const a=Vr.now();if(this.updatedAt!==a&&this.setPrevFrameValue(),this.prev=this.current,this.setCurrent(e),this.current!==this.prev&&(this.events.change?.notify(this.current),this.dependents))for(const s of this.dependents)s.dirty();t&&this.events.renderRequest?.notify(this.current)},this.hasAnimated=!1,this.setCurrent(e),this.owner=t.owner}setCurrent(e){var t;this.current=e,this.updatedAt=Vr.now(),null===this.canTrackVelocity&&void 0!==e&&(this.canTrackVelocity=(t=this.current,!isNaN(parseFloat(t))))}setPrevFrameValue(e=this.current){this.prevFrameValue=e,this.prevUpdatedAt=this.updatedAt}onChange(e){return this.on("change",e)}on(e,t){this.events[e]||(this.events[e]=new dr);const a=this.events[e].add(t);return"change"===e?()=>{a(),Dr.read((()=>{this.events.change.getSize()||this.stop()}))}:a}clearListeners(){for(const e in this.events)this.events[e].clear()}attach(e,t){this.passiveEffect=e,this.stopPassiveEffect=t}set(e,t=!0){t&&this.passiveEffect?this.passiveEffect(e,this.updateAndNotify):this.updateAndNotify(e,t)}setWithVelocity(e,t,a){this.set(t),this.prev=void 0,this.prevFrameValue=e,this.prevUpdatedAt=this.updatedAt-a}jump(e,t=!0){this.updateAndNotify(e),this.prev=e,this.prevUpdatedAt=this.prevFrameValue=void 0,t&&this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}dirty(){this.events.change?.notify(this.current)}addDependent(e){this.dependents||(this.dependents=new Set),this.dependents.add(e)}removeDependent(e){this.dependents&&this.dependents.delete(e)}get(){return this.current}getPrevious(){return this.prev}getVelocity(){const e=Vr.now();if(!this.canTrackVelocity||void 0===this.prevFrameValue||e-this.updatedAt>30)return 0;const t=Math.min(this.updatedAt-this.prevUpdatedAt,30);return hr(parseFloat(this.current)-parseFloat(this.prevFrameValue),t)}start(e){return this.stop(),new Promise((t=>{this.hasAnimated=!0,this.animation=e(t),this.events.animationStart&&this.events.animationStart.notify()})).then((()=>{this.events.animationComplete&&this.events.animationComplete.notify(),this.clearAnimation()}))}stop(){this.animation&&(this.animation.stop(),this.events.animationCancel&&this.events.animationCancel.notify()),this.clearAnimation()}isAnimating(){return!!this.animation}clearAnimation(){delete this.animation}destroy(){this.dependents?.clear(),this.events.destroy?.notify(),this.clearListeners(),this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}}function Eo(e,t){return new So(e,t)}const{schedule:ko}=qr(queueMicrotask,!1),Ao={x:!1,y:!1};function Po(){return Ao.x||Ao.y}function Mo(e,t){const a=function(e,t,a){if(e instanceof EventTarget)return[e];if("string"==typeof e){let t=document;const s=a?.[e]??t.querySelectorAll(e);return s?Array.from(s):[]}return Array.from(e)}(e),s=new AbortController;return[a,{passive:!0,...t,signal:s.signal},()=>s.abort()]}function To(e){return!("touch"===e.pointerType||Po())}const qo=(e,t)=>!!t&&(e===t||qo(e,t.parentElement)),Do=e=>"mouse"===e.pointerType?"number"!=typeof e.button||e.button<=0:!1!==e.isPrimary,Lo=new Set(["BUTTON","INPUT","SELECT","TEXTAREA","A"]);const $o=new WeakSet;function Ro(e){return t=>{"Enter"===t.key&&e(t)}}function Io(e,t){e.dispatchEvent(new PointerEvent("pointer"+t,{isPrimary:!0,bubbles:!0}))}function Fo(e){return Do(e)&&!Po()}function Vo(e,t,a={}){const[s,r,n]=Mo(e,a),i=e=>{const s=e.currentTarget;if(!Fo(e))return;$o.add(s);const n=t(s,e),i=(e,t)=>{window.removeEventListener("pointerup",o),window.removeEventListener("pointercancel",l),$o.has(s)&&$o.delete(s),Fo(e)&&"function"==typeof n&&n(e,{success:t})},o=e=>{i(e,s===window||s===document||a.useGlobalTarget||qo(s,e.target))},l=e=>{i(e,!1)};window.addEventListener("pointerup",o,r),window.addEventListener("pointercancel",l,r)};return s.forEach((e=>{var t;(a.useGlobalTarget?window:e).addEventListener("pointerdown",i,r),ao(e)&&(e.addEventListener("focus",(e=>((e,t)=>{const a=e.currentTarget;if(!a)return;const s=Ro((()=>{if($o.has(a))return;Io(a,"down");const e=Ro((()=>{Io(a,"up")}));a.addEventListener("keyup",e,t),a.addEventListener("blur",(()=>Io(a,"cancel")),t)}));a.addEventListener("keydown",s,t),a.addEventListener("blur",(()=>a.removeEventListener("keydown",s)),t)})(e,r))),t=e,Lo.has(t.tagName)||-1!==t.tabIndex||e.hasAttribute("tabindex")||(e.tabIndex=0))})),n}function Oo(e){return sr(e)&&"ownerSVGElement"in e}const Bo=e=>Boolean(e&&e.getVelocity),Uo=[...uo,un,jn],zo=e.createContext({transformPagePoint:e=>e,isStatic:!1,reducedMotion:"never"});class Ho extends e.Component{getSnapshotBeforeUpdate(e){const t=this.props.childRef.current;if(t&&e.isPresent&&!this.props.isPresent){const e=t.offsetParent,a=ao(e)&&e.offsetWidth||0,s=this.props.sizeRef.current;s.height=t.offsetHeight||0,s.width=t.offsetWidth||0,s.top=t.offsetTop,s.left=t.offsetLeft,s.right=a-s.width-s.left}return null}componentDidUpdate(){}render(){return this.props.children}}function Go({children:a,isPresent:s,anchorX:r}){const n=e.useId(),i=e.useRef(null),o=e.useRef({width:0,height:0,top:0,left:0,right:0}),{nonce:l}=e.useContext(zo);return e.useInsertionEffect((()=>{const{width:e,height:t,top:a,left:c,right:d}=o.current;if(s||!i.current||!e||!t)return;const m="left"===r?`left: ${c}`:`right: ${d}`;i.current.dataset.motionPopId=n;const u=document.createElement("style");return l&&(u.nonce=l),document.head.appendChild(u),u.sheet&&u.sheet.insertRule(`\n          [data-motion-pop-id="${n}"] {\n            position: absolute !important;\n            width: ${e}px !important;\n            height: ${t}px !important;\n            ${m}px !important;\n            top: ${a}px !important;\n          }\n        `),()=>{document.head.contains(u)&&document.head.removeChild(u)}}),[s]),t.jsx(Ho,{isPresent:s,childRef:i,sizeRef:o,children:e.cloneElement(a,{ref:i})})}const Xo=({children:a,initial:s,isPresent:r,onExitComplete:n,custom:i,presenceAffectsLayout:o,mode:l,anchorX:c})=>{const d=Ws(Wo),m=e.useId();let u=!0,h=e.useMemo((()=>(u=!1,{id:m,initial:s,isPresent:r,custom:i,onExitComplete:e=>{d.set(e,!0);for(const t of d.values())if(!t)return;n&&n()},register:e=>(d.set(e,!1),()=>d.delete(e))})),[r,d,n]);return o&&u&&(h={...h}),e.useMemo((()=>{d.forEach(((e,t)=>d.set(t,!1)))}),[r]),e.useEffect((()=>{!r&&!d.size&&n&&n()}),[r]),"popLayout"===l&&(a=t.jsx(Go,{isPresent:r,anchorX:c,children:a})),t.jsx(Js.Provider,{value:h,children:a})};function Wo(){return new Map}function Yo(t=!0){const a=e.useContext(Js);if(null===a)return[!0,null];const{isPresent:s,onExitComplete:r,register:n}=a,i=e.useId();e.useEffect((()=>{if(t)return n(i)}),[t]);const o=e.useCallback((()=>t&&r&&r(i)),[i,r,t]);return!s&&r?[!1,o]:[!0]}const Ko=e=>e.key||"";function Jo(t){const a=[];return e.Children.forEach(t,(t=>{e.isValidElement(t)&&a.push(t)})),a}const Qo=({children:a,custom:s,initial:r=!0,onExitComplete:n,presenceAffectsLayout:i=!0,mode:o="sync",propagate:l=!1,anchorX:c="left"})=>{const[d,m]=Yo(l),u=e.useMemo((()=>Jo(a)),[a]),h=l&&!d?[]:u.map(Ko),p=e.useRef(!0),x=e.useRef(u),f=Ws((()=>new Map)),[g,b]=e.useState(u),[v,y]=e.useState(u);Ks((()=>{p.current=!1,x.current=u;for(let e=0;e<v.length;e++){const t=Ko(v[e]);h.includes(t)?f.delete(t):!0!==f.get(t)&&f.set(t,!1)}}),[v,h.length,h.join("-")]);const j=[];if(u!==g){let e=[...u];for(let t=0;t<v.length;t++){const a=v[t],s=Ko(a);h.includes(s)||(e.splice(t,0,a),j.push(a))}return"wait"===o&&j.length&&(e=j),y(Jo(e)),b(u),null}const{forceRender:N}=e.useContext(Xs);return t.jsx(t.Fragment,{children:v.map((e=>{const a=Ko(e),g=!(l&&!d)&&(u===v||h.includes(a));return t.jsx(Xo,{isPresent:g,initial:!(p.current&&!r)&&void 0,custom:s,presenceAffectsLayout:i,mode:o,onExitComplete:g?void 0:()=>{if(!f.has(a))return;f.set(a,!0);let e=!0;f.forEach((t=>{t||(e=!1)})),e&&(N?.(),y(x.current),l&&m?.(),n&&n())},anchorX:c,children:e},a)}))})},Zo=e.createContext({strict:!1}),el={animation:["animate","variants","whileHover","whileTap","exit","whileInView","whileFocus","whileDrag"],exit:["exit"],drag:["drag","dragControls"],focus:["whileFocus"],hover:["whileHover","onHoverStart","onHoverEnd"],tap:["whileTap","onTap","onTapStart","onTapCancel"],pan:["onPan","onPanStart","onPanSessionStart","onPanEnd"],inView:["whileInView","onViewportEnter","onViewportLeave"],layout:["layout","layoutId"]},tl={};for(const Ob in el)tl[Ob]={isEnabled:e=>el[Ob].some((t=>!!e[t]))};const al=new Set(["animate","exit","variants","initial","style","values","variants","transition","transformTemplate","custom","inherit","onBeforeLayoutMeasure","onAnimationStart","onAnimationComplete","onUpdate","onDragStart","onDrag","onDragEnd","onMeasureDragConstraints","onDirectionLock","onDragTransitionEnd","_dragX","_dragY","onHoverStart","onHoverEnd","onViewportEnter","onViewportLeave","globalTapTarget","ignoreStrict","viewport"]);function sl(e){return e.startsWith("while")||e.startsWith("drag")&&"draggable"!==e||e.startsWith("layout")||e.startsWith("onTap")||e.startsWith("onPan")||e.startsWith("onLayout")||al.has(e)}let rl=e=>!sl(e);try{(nl=require("@emotion/is-prop-valid").default)&&(rl=e=>e.startsWith("on")?!sl(e):nl(e))}catch{}var nl;function il(e){if("undefined"==typeof Proxy)return e;const t=new Map;return new Proxy(((...t)=>e(...t)),{get:(a,s)=>"create"===s?e:(t.has(s)||t.set(s,e(s)),t.get(s))})}const ol=e.createContext({});function ll(e){return null!==e&&"object"==typeof e&&"function"==typeof e.start}function cl(e){return"string"==typeof e||Array.isArray(e)}const dl=["animate","whileInView","whileFocus","whileHover","whileTap","whileDrag","exit"],ml=["initial",...dl];function ul(e){return ll(e.animate)||ml.some((t=>cl(e[t])))}function hl(e){return Boolean(ul(e)||e.variants)}function pl(t){const{initial:a,animate:s}=function(e,t){if(ul(e)){const{initial:t,animate:a}=e;return{initial:!1===t||cl(t)?t:void 0,animate:cl(a)?a:void 0}}return!1!==e.inherit?t:{}}(t,e.useContext(ol));return e.useMemo((()=>({initial:a,animate:s})),[xl(a),xl(s)])}function xl(e){return Array.isArray(e)?e.join(" "):e}const fl=Symbol.for("motionComponentSymbol");function gl(e){return e&&"object"==typeof e&&Object.prototype.hasOwnProperty.call(e,"current")}function bl(t,a,s){return e.useCallback((e=>{e&&t.onMount&&t.onMount(e),a&&(e?a.mount(e):a.unmount()),s&&("function"==typeof s?s(e):gl(s)&&(s.current=e))}),[a])}const vl=e=>e.replace(/([a-z])([A-Z])/gu,"$1-$2").toLowerCase(),yl="data-"+vl("framerAppearId"),jl=e.createContext({});function Nl(t,a,s,r,n){const{visualElement:i}=e.useContext(ol),o=e.useContext(Zo),l=e.useContext(Js),c=e.useContext(zo).reducedMotion,d=e.useRef(null);r=r||o.renderer,!d.current&&r&&(d.current=r(t,{visualState:a,parent:i,props:s,presenceContext:l,blockInitialAnimation:!!l&&!1===l.initial,reducedMotionConfig:c}));const m=d.current,u=e.useContext(jl);!m||m.projection||!n||"html"!==m.type&&"svg"!==m.type||function(e,t,a,s){const{layoutId:r,layout:n,drag:i,dragConstraints:o,layoutScroll:l,layoutRoot:c,layoutCrossfade:d}=t;e.projection=new a(e.latestValues,t["data-framer-portal-id"]?void 0:_l(e.parent)),e.projection.setOptions({layoutId:r,layout:n,alwaysMeasureLayout:Boolean(i)||o&&gl(o),visualElement:e,animationType:"string"==typeof n?n:"both",initialPromotionConfig:s,crossfade:d,layoutScroll:l,layoutRoot:c})}(d.current,s,n,u);const h=e.useRef(!1);e.useInsertionEffect((()=>{m&&h.current&&m.update(s,l)}));const p=s[yl],x=e.useRef(Boolean(p)&&!window.MotionHandoffIsComplete?.(p)&&window.MotionHasOptimisedAnimation?.(p));return Ks((()=>{m&&(h.current=!0,window.MotionIsMounted=!0,m.updateFeatures(),ko.render(m.render),x.current&&m.animationState&&m.animationState.animateChanges())})),e.useEffect((()=>{m&&(!x.current&&m.animationState&&m.animationState.animateChanges(),x.current&&(queueMicrotask((()=>{window.MotionHandoffMarkAsComplete?.(p)})),x.current=!1))})),m}function _l(e){if(e)return!1!==e.options.allowProjection?e.projection:_l(e.parent)}function wl({preloadedFeatures:a,createVisualElement:s,useRender:r,useVisualState:n,Component:i}){function o(a,o){let l;const c={...e.useContext(zo),...a,layoutId:Cl(a)},{isStatic:d}=c,m=pl(a),u=n(a,d);if(!d&&Ys){e.useContext(Zo).strict;const t=function(e){const{drag:t,layout:a}=tl;if(!t&&!a)return{};const s={...t,...a};return{MeasureLayout:t?.isEnabled(e)||a?.isEnabled(e)?s.MeasureLayout:void 0,ProjectionNode:s.ProjectionNode}}(c);l=t.MeasureLayout,m.visualElement=Nl(i,u,c,s,t.ProjectionNode)}return t.jsxs(ol.Provider,{value:m,children:[l&&m.visualElement?t.jsx(l,{visualElement:m.visualElement,...c}):null,r(i,a,bl(u,m.visualElement,o),u,d,m.visualElement)]})}a&&function(e){for(const t in e)tl[t]={...tl[t],...e[t]}}(a),o.displayName=`motion.${"string"==typeof i?i:`create(${i.displayName??i.name??""})`}`;const l=e.forwardRef(o);return l[fl]=i,l}function Cl({layoutId:t}){const a=e.useContext(Xs).id;return a&&void 0!==t?a+"-"+t:t}const Sl={};function El(e,{layout:t,layoutId:a}){return Pi.has(e)||e.startsWith("origin")||(t||void 0!==a)&&(!!Sl[e]||"opacity"===e)}const kl={x:"translateX",y:"translateY",z:"translateZ",transformPerspective:"perspective"},Al=Ai.length;function Pl(e,t,a){const{style:s,vars:r,transformOrigin:n}=e;let i=!1,o=!1;for(const l in t){const e=t[l];if(Pi.has(l))i=!0;else if(Br(l))r[l]=e;else{const t=Co(e,vo[l]);l.startsWith("origin")?(o=!0,n[l]=t):s[l]=t}}if(t.transform||(i||a?s.transform=function(e,t,a){let s="",r=!0;for(let n=0;n<Al;n++){const i=Ai[n],o=e[i];if(void 0===o)continue;let l=!0;if(l="number"==typeof o?o===(i.startsWith("scale")?1:0):0===parseFloat(o),!l||a){const e=Co(o,vo[i]);l||(r=!1,s+=`${kl[i]||i}(${e}) `),a&&(t[i]=e)}}return s=s.trim(),a?s=a(t,r?"":s):r&&(s="none"),s}(t,e.transform,a):s.transform&&(s.transform="none")),o){const{originX:e="50%",originY:t="50%",originZ:a=0}=n;s.transformOrigin=`${e} ${t} ${a}`}}const Ml=()=>({style:{},transform:{},transformOrigin:{},vars:{}});function Tl(e,t,a){for(const s in t)Bo(t[s])||El(s,a)||(e[s]=t[s])}function ql(t,a){const s={};return Tl(s,t.style||{},t),Object.assign(s,function({transformTemplate:t},a){return e.useMemo((()=>{const e={style:{},transform:{},transformOrigin:{},vars:{}};return Pl(e,a,t),Object.assign({},e.vars,e.style)}),[a])}(t,a)),s}function Dl(e,t){const a={},s=ql(e,t);return e.drag&&!1!==e.dragListener&&(a.draggable=!1,s.userSelect=s.WebkitUserSelect=s.WebkitTouchCallout="none",s.touchAction=!0===e.drag?"none":"pan-"+("x"===e.drag?"y":"x")),void 0===e.tabIndex&&(e.onTap||e.onTapStart||e.whileTap)&&(a.tabIndex=0),a.style=s,a}const Ll={offset:"stroke-dashoffset",array:"stroke-dasharray"},$l={offset:"strokeDashoffset",array:"strokeDasharray"};function Rl(e,{attrX:t,attrY:a,attrScale:s,pathLength:r,pathSpacing:n=1,pathOffset:i=0,...o},l,c,d){if(Pl(e,o,c),l)return void(e.style.viewBox&&(e.attrs.viewBox=e.style.viewBox));e.attrs=e.style,e.style={};const{attrs:m,style:u}=e;m.transform&&(u.transform=m.transform,delete m.transform),(u.transform||m.transformOrigin)&&(u.transformOrigin=m.transformOrigin??"50% 50%",delete m.transformOrigin),u.transform&&(u.transformBox=d?.transformBox??"fill-box",delete m.transformBox),void 0!==t&&(m.x=t),void 0!==a&&(m.y=a),void 0!==s&&(m.scale=s),void 0!==r&&function(e,t,a=1,s=0,r=!0){e.pathLength=1;const n=r?Ll:$l;e[n.offset]=on.transform(-s);const i=on.transform(t),o=on.transform(a);e[n.array]=`${i} ${o}`}(m,r,n,i,!1)}const Il=()=>({style:{},transform:{},transformOrigin:{},vars:{},attrs:{}}),Fl=e=>"string"==typeof e&&"svg"===e.toLowerCase();function Vl(t,a,s,r){const n=e.useMemo((()=>{const e={style:{},transform:{},transformOrigin:{},vars:{},attrs:{}};return Rl(e,a,Fl(r),t.transformTemplate,t.style),{...e.attrs,style:{...e.style}}}),[a]);if(t.style){const e={};Tl(e,t.style,t),n.style={...e,...n.style}}return n}const Ol=["animate","circle","defs","desc","ellipse","g","image","line","filter","marker","mask","metadata","path","pattern","polygon","polyline","rect","stop","switch","symbol","svg","text","tspan","use","view"];function Bl(e){return"string"==typeof e&&!e.includes("-")&&!!(Ol.indexOf(e)>-1||/[A-Z]/u.test(e))}function Ul(t=!1){return(a,s,r,{latestValues:n},i)=>{const o=(Bl(a)?Vl:Dl)(s,n,i,a),l=function(e,t,a){const s={};for(const r in e)"values"===r&&"object"==typeof e.values||(rl(r)||!0===a&&sl(r)||!t&&!sl(r)||e.draggable&&r.startsWith("onDrag"))&&(s[r]=e[r]);return s}(s,"string"==typeof a,t),c=a!==e.Fragment?{...l,...o,ref:r}:{},{children:d}=s,m=e.useMemo((()=>Bo(d)?d.get():d),[d]);return e.createElement(a,{...c,children:m})}}function zl(e){const t=[{},{}];return e?.values.forEach(((e,a)=>{t[0][a]=e.get(),t[1][a]=e.getVelocity()})),t}function Hl(e,t,a,s){if("function"==typeof t){const[r,n]=zl(s);t=t(void 0!==a?a:e.custom,r,n)}if("string"==typeof t&&(t=e.variants&&e.variants[t]),"function"==typeof t){const[r,n]=zl(s);t=t(void 0!==a?a:e.custom,r,n)}return t}function Gl(e){return Bo(e)?e.get():e}const Xl=t=>(a,s)=>{const r=e.useContext(ol),n=e.useContext(Js),i=()=>function({scrapeMotionValuesFromProps:e,createRenderState:t},a,s,r){return{latestValues:Wl(a,s,r,e),renderState:t()}}(t,a,r,n);return s?i():Ws(i)};function Wl(e,t,a,s){const r={},n=s(e,{});for(const u in n)r[u]=Gl(n[u]);let{initial:i,animate:o}=e;const l=ul(e),c=hl(e);t&&c&&!l&&!1!==e.inherit&&(void 0===i&&(i=t.initial),void 0===o&&(o=t.animate));let d=!!a&&!1===a.initial;d=d||!1===i;const m=d?o:i;if(m&&"boolean"!=typeof m&&!ll(m)){const t=Array.isArray(m)?m:[m];for(let a=0;a<t.length;a++){const s=Hl(e,t[a]);if(s){const{transitionEnd:e,transition:t,...a}=s;for(const s in a){let e=a[s];if(Array.isArray(e)){e=e[d?e.length-1:0]}null!==e&&(r[s]=e)}for(const s in e)r[s]=e[s]}}}return r}function Yl(e,t,a){const{style:s}=e,r={};for(const n in s)(Bo(s[n])||t.style&&Bo(t.style[n])||El(n,e)||void 0!==a?.getValue(n)?.liveStyle)&&(r[n]=s[n]);return r}const Kl={useVisualState:Xl({scrapeMotionValuesFromProps:Yl,createRenderState:Ml})};function Jl(e,t,a){const s=Yl(e,t,a);for(const r in e)if(Bo(e[r])||Bo(t[r])){s[-1!==Ai.indexOf(r)?"attr"+r.charAt(0).toUpperCase()+r.substring(1):r]=e[r]}return s}const Ql={useVisualState:Xl({scrapeMotionValuesFromProps:Jl,createRenderState:Il})};function Zl(e,t){return function(a,{forwardMotionProps:s}={forwardMotionProps:!1}){return wl({...Bl(a)?Ql:Kl,preloadedFeatures:e,useRender:Ul(s),createVisualElement:t,Component:a})}}function ec(e,t,a){const s=e.getProps();return Hl(s,t,void 0!==a?a:s.custom,e)}const tc=e=>Array.isArray(e);function ac(e,t,a){e.hasValue(t)?e.getValue(t).set(a):e.addValue(t,Eo(a))}function sc(e){return tc(e)?e[e.length-1]||0:e}function rc(e,t){const a=e.getValue("willChange");if(s=a,Boolean(Bo(s)&&s.add))return a.add(t);if(!a&&tr.WillChange){const a=new tr.WillChange("auto");e.addValue("willChange",a),a.add(t)}var s}function nc(e){return e.props[yl]}const ic=e=>null!==e;const oc={type:"spring",stiffness:500,damping:25,restSpeed:10},lc={type:"keyframes",duration:.8},cc={type:"keyframes",ease:[.25,.1,.35,1],duration:.3},dc=(e,{keyframes:t})=>t.length>2?lc:Pi.has(e)?e.startsWith("scale")?{type:"spring",stiffness:550,damping:0===t[1]?2*Math.sqrt(550):30,restSpeed:10}:oc:cc;const mc=(e,t,a,s={},r,n)=>i=>{const o=lo(s,e)||{},l=o.delay||s.delay||0;let{elapsed:c=0}=s;c-=mr(l);const d={keyframes:Array.isArray(a)?a:[null,a],ease:"easeOut",velocity:t.getVelocity(),...o,delay:-c,onUpdate:e=>{t.set(e),o.onUpdate&&o.onUpdate(e)},onComplete:()=>{i(),o.onComplete&&o.onComplete()},name:e,motionValue:t,element:n?void 0:r};(function({when:e,delay:t,delayChildren:a,staggerChildren:s,staggerDirection:r,repeat:n,repeatType:i,repeatDelay:o,from:l,elapsed:c,...d}){return!!Object.keys(d).length})(o)||Object.assign(d,dc(e,d)),d.duration&&(d.duration=mr(d.duration)),d.repeatDelay&&(d.repeatDelay=mr(d.repeatDelay)),void 0!==d.from&&(d.keyframes[0]=d.from);let m=!1;if((!1===d.type||0===d.duration&&!d.repeatDelay)&&(d.duration=0,0===d.delay&&(m=!0)),(tr.instantAnimations||tr.skipAnimations)&&(m=!0,d.duration=0,d.delay=0),d.allowFlatten=!o.type&&!o.ease,m&&!n&&void 0!==t.get()){const e=function(e,{repeat:t,repeatType:a="loop"}){const s=e.filter(ic);return s[t&&"loop"!==a&&t%2==1?0:s.length-1]}(d.keyframes,o);if(void 0!==e)return void Dr.update((()=>{d.onUpdate(e),d.onComplete()}))}return o.isSync?new bi(d):new no(d)};function uc({protectedKeys:e,needsAnimating:t},a){const s=e.hasOwnProperty(a)&&!0!==t[a];return t[a]=!1,s}function hc(e,t,{delay:a=0,transitionOverride:s,type:r}={}){let{transition:n=e.getDefaultTransition(),transitionEnd:i,...o}=t;s&&(n=s);const l=[],c=r&&e.animationState&&e.animationState.getState()[r];for(const d in o){const t=e.getValue(d,e.latestValues[d]??null),s=o[d];if(void 0===s||c&&uc(c,d))continue;const r={delay:a,...lo(n||{},d)},i=t.get();if(void 0!==i&&!t.isAnimating&&!Array.isArray(s)&&s===i&&!r.velocity)continue;let m=!1;if(window.MotionHandoffAnimation){const t=nc(e);if(t){const e=window.MotionHandoffAnimation(t,d,Dr);null!==e&&(r.startTime=e,m=!0)}}rc(e,d),t.start(mc(d,t,s,e.shouldReduceMotion&&co.has(d)?{type:!1}:r,e,m));const u=t.animation;u&&l.push(u)}return i&&Promise.all(l).then((()=>{Dr.update((()=>{i&&function(e,t){const a=ec(e,t);let{transitionEnd:s={},transition:r={},...n}=a||{};n={...n,...s};for(const i in n)ac(e,i,sc(n[i]))}(e,i)}))})),l}function pc(e,t,a={}){const s=ec(e,t,"exit"===a.type?e.presenceContext?.custom:void 0);let{transition:r=e.getDefaultTransition()||{}}=s||{};a.transitionOverride&&(r=a.transitionOverride);const n=s?()=>Promise.all(hc(e,s,a)):()=>Promise.resolve(),i=e.variantChildren&&e.variantChildren.size?(s=0)=>{const{delayChildren:n=0,staggerChildren:i,staggerDirection:o}=r;return function(e,t,a=0,s=0,r=1,n){const i=[],o=(e.variantChildren.size-1)*s,l=1===r?(e=0)=>e*s:(e=0)=>o-e*s;return Array.from(e.variantChildren).sort(xc).forEach(((e,s)=>{e.notify("AnimationStart",t),i.push(pc(e,t,{...n,delay:a+l(s)}).then((()=>e.notify("AnimationComplete",t))))})),Promise.all(i)}(e,t,n+s,i,o,a)}:()=>Promise.resolve(),{when:o}=r;if(o){const[e,t]="beforeChildren"===o?[n,i]:[i,n];return e().then((()=>t()))}return Promise.all([n(),i(a.delay)])}function xc(e,t){return e.sortNodePosition(t)}function fc(e,t){if(!Array.isArray(t))return!1;const a=t.length;if(a!==e.length)return!1;for(let s=0;s<a;s++)if(t[s]!==e[s])return!1;return!0}const gc=ml.length;function bc(e){if(!e)return;if(!e.isControllingVariants){const t=e.parent&&bc(e.parent)||{};return void 0!==e.props.initial&&(t.initial=e.props.initial),t}const t={};for(let a=0;a<gc;a++){const s=ml[a],r=e.props[s];(cl(r)||!1===r)&&(t[s]=r)}return t}const vc=[...dl].reverse(),yc=dl.length;function jc(e){return t=>Promise.all(t.map((({animation:t,options:a})=>function(e,t,a={}){let s;if(e.notify("AnimationStart",t),Array.isArray(t)){const r=t.map((t=>pc(e,t,a)));s=Promise.all(r)}else if("string"==typeof t)s=pc(e,t,a);else{const r="function"==typeof t?ec(e,t,a.custom):t;s=Promise.all(hc(e,r,a))}return s.then((()=>{e.notify("AnimationComplete",t)}))}(e,t,a))))}function Nc(e){let t=jc(e),a=Cc(),s=!0;const r=t=>(a,s)=>{const r=ec(e,s,"exit"===t?e.presenceContext?.custom:void 0);if(r){const{transition:e,transitionEnd:t,...s}=r;a={...a,...s,...t}}return a};function n(n){const{props:i}=e,o=bc(e.parent)||{},l=[],c=new Set;let d={},m=1/0;for(let t=0;t<yc;t++){const u=vc[t],h=a[u],p=void 0!==i[u]?i[u]:o[u],x=cl(p),f=u===n?h.isActive:null;!1===f&&(m=t);let g=p===o[u]&&p!==i[u]&&x;if(g&&s&&e.manuallyAnimateOnMount&&(g=!1),h.protectedKeys={...d},!h.isActive&&null===f||!p&&!h.prevProp||ll(p)||"boolean"==typeof p)continue;const b=_c(h.prevProp,p);let v=b||u===n&&h.isActive&&!g&&x||t>m&&x,y=!1;const j=Array.isArray(p)?p:[p];let N=j.reduce(r(u),{});!1===f&&(N={});const{prevResolvedValues:_={}}=h,w={..._,...N},C=t=>{v=!0,c.has(t)&&(y=!0,c.delete(t)),h.needsAnimating[t]=!0;const a=e.getValue(t);a&&(a.liveStyle=!1)};for(const e in w){const t=N[e],a=_[e];if(d.hasOwnProperty(e))continue;let s=!1;s=tc(t)&&tc(a)?!fc(t,a):t!==a,s?null!=t?C(e):c.add(e):void 0!==t&&c.has(e)?C(e):h.protectedKeys[e]=!0}h.prevProp=p,h.prevResolvedValues=N,h.isActive&&(d={...d,...N}),s&&e.blockInitialAnimation&&(v=!1);v&&(!(g&&b)||y)&&l.push(...j.map((e=>({animation:e,options:{type:u}}))))}if(c.size){const t={};if("boolean"!=typeof i.initial){const a=ec(e,Array.isArray(i.initial)?i.initial[0]:i.initial);a&&a.transition&&(t.transition=a.transition)}c.forEach((a=>{const s=e.getBaseTarget(a),r=e.getValue(a);r&&(r.liveStyle=!0),t[a]=s??null})),l.push({animation:t})}let u=Boolean(l.length);return!s||!1!==i.initial&&i.initial!==i.animate||e.manuallyAnimateOnMount||(u=!1),s=!1,u?t(l):Promise.resolve()}return{animateChanges:n,setActive:function(t,s){if(a[t].isActive===s)return Promise.resolve();e.variantChildren?.forEach((e=>e.animationState?.setActive(t,s))),a[t].isActive=s;const r=n(t);for(const e in a)a[e].protectedKeys={};return r},setAnimateFunction:function(a){t=a(e)},getState:()=>a,reset:()=>{a=Cc(),s=!0}}}function _c(e,t){return"string"==typeof t?t!==e:!!Array.isArray(t)&&!fc(t,e)}function wc(e=!1){return{isActive:e,protectedKeys:{},needsAnimating:{},prevResolvedValues:{}}}function Cc(){return{animate:wc(!0),whileInView:wc(),whileHover:wc(),whileTap:wc(),whileDrag:wc(),whileFocus:wc(),exit:wc()}}class Sc{constructor(e){this.isMounted=!1,this.node=e}update(){}}let Ec=0;const kc={animation:{Feature:class extends Sc{constructor(e){super(e),e.animationState||(e.animationState=Nc(e))}updateAnimationControlsSubscription(){const{animate:e}=this.node.getProps();ll(e)&&(this.unmountControls=e.subscribe(this.node))}mount(){this.updateAnimationControlsSubscription()}update(){const{animate:e}=this.node.getProps(),{animate:t}=this.node.prevProps||{};e!==t&&this.updateAnimationControlsSubscription()}unmount(){this.node.animationState.reset(),this.unmountControls?.()}}},exit:{Feature:class extends Sc{constructor(){super(...arguments),this.id=Ec++}update(){if(!this.node.presenceContext)return;const{isPresent:e,onExitComplete:t}=this.node.presenceContext,{isPresent:a}=this.node.prevPresenceContext||{};if(!this.node.animationState||e===a)return;const s=this.node.animationState.setActive("exit",!e);t&&!e&&s.then((()=>{t(this.id)}))}mount(){const{register:e,onExitComplete:t}=this.node.presenceContext||{};t&&t(this.id),e&&(this.unmount=e(this.id))}unmount(){}}}};function Ac(e,t,a,s={passive:!0}){return e.addEventListener(t,a,s),()=>e.removeEventListener(t,a)}function Pc(e){return{point:{x:e.pageX,y:e.pageY}}}function Mc(e,t,a,s){return Ac(e,t,(e=>t=>Do(t)&&e(t,Pc(t)))(a),s)}function Tc({top:e,left:t,right:a,bottom:s}){return{x:{min:t,max:a},y:{min:e,max:s}}}function qc(e){return e.max-e.min}function Dc(e,t,a,s=.5){e.origin=s,e.originPoint=wn(t.min,t.max,e.origin),e.scale=qc(a)/qc(t),e.translate=wn(a.min,a.max,e.origin)-e.originPoint,(e.scale>=.9999&&e.scale<=1.0001||isNaN(e.scale))&&(e.scale=1),(e.translate>=-.01&&e.translate<=.01||isNaN(e.translate))&&(e.translate=0)}function Lc(e,t,a,s){Dc(e.x,t.x,a.x,s?s.originX:void 0),Dc(e.y,t.y,a.y,s?s.originY:void 0)}function $c(e,t,a){e.min=a.min+t.min,e.max=e.min+qc(t)}function Rc(e,t,a){e.min=t.min-a.min,e.max=e.min+qc(t)}function Ic(e,t,a){Rc(e.x,t.x,a.x),Rc(e.y,t.y,a.y)}const Fc=()=>({x:{min:0,max:0},y:{min:0,max:0}});function Vc(e){return[e("x"),e("y")]}function Oc(e){return void 0===e||1===e}function Bc({scale:e,scaleX:t,scaleY:a}){return!Oc(e)||!Oc(t)||!Oc(a)}function Uc(e){return Bc(e)||zc(e)||e.z||e.rotate||e.rotateX||e.rotateY||e.skewX||e.skewY}function zc(e){return Hc(e.x)||Hc(e.y)}function Hc(e){return e&&"0%"!==e}function Gc(e,t,a){return a+t*(e-a)}function Xc(e,t,a,s,r){return void 0!==r&&(e=Gc(e,r,s)),Gc(e,a,s)+t}function Wc(e,t=0,a=1,s,r){e.min=Xc(e.min,t,a,s,r),e.max=Xc(e.max,t,a,s,r)}function Yc(e,{x:t,y:a}){Wc(e.x,t.translate,t.scale,t.originPoint),Wc(e.y,a.translate,a.scale,a.originPoint)}const Kc=.999999999999,Jc=1.0000000000001;function Qc(e,t){e.min=e.min+t,e.max=e.max+t}function Zc(e,t,a,s,r=.5){Wc(e,t,a,wn(e.min,e.max,r),s)}function ed(e,t){Zc(e.x,t.x,t.scaleX,t.scale,t.originX),Zc(e.y,t.y,t.scaleY,t.scale,t.originY)}function td(e,t){return Tc(function(e,t){if(!t)return e;const a=t({x:e.left,y:e.top}),s=t({x:e.right,y:e.bottom});return{top:a.y,left:a.x,bottom:s.y,right:s.x}}(e.getBoundingClientRect(),t))}const ad=({current:e})=>e?e.ownerDocument.defaultView:null,sd=(e,t)=>Math.abs(e-t);class rd{constructor(e,t,{transformPagePoint:a,contextWindow:s,dragSnapToOrigin:r=!1}={}){if(this.startEvent=null,this.lastMoveEvent=null,this.lastMoveEventInfo=null,this.handlers={},this.contextWindow=window,this.updatePoint=()=>{if(!this.lastMoveEvent||!this.lastMoveEventInfo)return;const e=od(this.lastMoveEventInfo,this.history),t=null!==this.startEvent,a=function(e,t){const a=sd(e.x,t.x),s=sd(e.y,t.y);return Math.sqrt(a**2+s**2)}(e.offset,{x:0,y:0})>=3;if(!t&&!a)return;const{point:s}=e,{timestamp:r}=$r;this.history.push({...s,timestamp:r});const{onStart:n,onMove:i}=this.handlers;t||(n&&n(this.lastMoveEvent,e),this.startEvent=this.lastMoveEvent),i&&i(this.lastMoveEvent,e)},this.handlePointerMove=(e,t)=>{this.lastMoveEvent=e,this.lastMoveEventInfo=nd(t,this.transformPagePoint),Dr.update(this.updatePoint,!0)},this.handlePointerUp=(e,t)=>{this.end();const{onEnd:a,onSessionEnd:s,resumeAnimation:r}=this.handlers;if(this.dragSnapToOrigin&&r&&r(),!this.lastMoveEvent||!this.lastMoveEventInfo)return;const n=od("pointercancel"===e.type?this.lastMoveEventInfo:nd(t,this.transformPagePoint),this.history);this.startEvent&&a&&a(e,n),s&&s(e,n)},!Do(e))return;this.dragSnapToOrigin=r,this.handlers=t,this.transformPagePoint=a,this.contextWindow=s||window;const n=nd(Pc(e),this.transformPagePoint),{point:i}=n,{timestamp:o}=$r;this.history=[{...i,timestamp:o}];const{onSessionStart:l}=t;l&&l(e,od(n,this.history)),this.removeListeners=lr(Mc(this.contextWindow,"pointermove",this.handlePointerMove),Mc(this.contextWindow,"pointerup",this.handlePointerUp),Mc(this.contextWindow,"pointercancel",this.handlePointerUp))}updateHandlers(e){this.handlers=e}end(){this.removeListeners&&this.removeListeners(),Lr(this.updatePoint)}}function nd(e,t){return t?{point:t(e.point)}:e}function id(e,t){return{x:e.x-t.x,y:e.y-t.y}}function od({point:e},t){return{point:e,delta:id(e,cd(t)),offset:id(e,ld(t)),velocity:dd(t,.1)}}function ld(e){return e[0]}function cd(e){return e[e.length-1]}function dd(e,t){if(e.length<2)return{x:0,y:0};let a=e.length-1,s=null;const r=cd(e);for(;a>=0&&(s=e[a],!(r.timestamp-s.timestamp>mr(t)));)a--;if(!s)return{x:0,y:0};const n=ur(r.timestamp-s.timestamp);if(0===n)return{x:0,y:0};const i={x:(r.x-s.x)/n,y:(r.y-s.y)/n};return i.x===1/0&&(i.x=0),i.y===1/0&&(i.y=0),i}function md(e,t,a){return{min:void 0!==t?e.min+t:void 0,max:void 0!==a?e.max+a-(e.max-e.min):void 0}}function ud(e,t){let a=t.min-e.min,s=t.max-e.max;return t.max-t.min<e.max-e.min&&([a,s]=[s,a]),{min:a,max:s}}const hd=.35;function pd(e,t,a){return{min:xd(e,t),max:xd(e,a)}}function xd(e,t){return"number"==typeof e?e:e[t]||0}const fd=new WeakMap;class gd{constructor(e){this.openDragLock=null,this.isDragging=!1,this.currentDirection=null,this.originPoint={x:0,y:0},this.constraints=!1,this.hasMutatedConstraints=!1,this.elastic={x:{min:0,max:0},y:{min:0,max:0}},this.visualElement=e}start(e,{snapToCursor:t=!1}={}){const{presenceContext:a}=this.visualElement;if(a&&!1===a.isPresent)return;const{dragSnapToOrigin:s}=this.getProps();this.panSession=new rd(e,{onSessionStart:e=>{const{dragSnapToOrigin:a}=this.getProps();a?this.pauseAnimation():this.stopAnimation(),t&&this.snapToCursor(Pc(e).point)},onStart:(e,t)=>{const{drag:a,dragPropagation:s,onDragStart:r}=this.getProps();if(a&&!s&&(this.openDragLock&&this.openDragLock(),this.openDragLock="x"===(n=a)||"y"===n?Ao[n]?null:(Ao[n]=!0,()=>{Ao[n]=!1}):Ao.x||Ao.y?null:(Ao.x=Ao.y=!0,()=>{Ao.x=Ao.y=!1}),!this.openDragLock))return;var n;this.isDragging=!0,this.currentDirection=null,this.resolveConstraints(),this.visualElement.projection&&(this.visualElement.projection.isAnimationBlocked=!0,this.visualElement.projection.target=void 0),Vc((e=>{let t=this.getAxisMotionValue(e).get()||0;if(nn.test(t)){const{projection:a}=this.visualElement;if(a&&a.layout){const s=a.layout.layoutBox[e];if(s){t=qc(s)*(parseFloat(t)/100)}}}this.originPoint[e]=t})),r&&Dr.postRender((()=>r(e,t))),rc(this.visualElement,"transform");const{animationState:i}=this.visualElement;i&&i.setActive("whileDrag",!0)},onMove:(e,t)=>{const{dragPropagation:a,dragDirectionLock:s,onDirectionLock:r,onDrag:n}=this.getProps();if(!a&&!this.openDragLock)return;const{offset:i}=t;if(s&&null===this.currentDirection)return this.currentDirection=function(e,t=10){let a=null;Math.abs(e.y)>t?a="y":Math.abs(e.x)>t&&(a="x");return a}(i),void(null!==this.currentDirection&&r&&r(this.currentDirection));this.updateAxis("x",t.point,i),this.updateAxis("y",t.point,i),this.visualElement.render(),n&&n(e,t)},onSessionEnd:(e,t)=>this.stop(e,t),resumeAnimation:()=>Vc((e=>"paused"===this.getAnimationState(e)&&this.getAxisMotionValue(e).animation?.play()))},{transformPagePoint:this.visualElement.getTransformPagePoint(),dragSnapToOrigin:s,contextWindow:ad(this.visualElement)})}stop(e,t){const a=this.isDragging;if(this.cancel(),!a)return;const{velocity:s}=t;this.startAnimation(s);const{onDragEnd:r}=this.getProps();r&&Dr.postRender((()=>r(e,t)))}cancel(){this.isDragging=!1;const{projection:e,animationState:t}=this.visualElement;e&&(e.isAnimationBlocked=!1),this.panSession&&this.panSession.end(),this.panSession=void 0;const{dragPropagation:a}=this.getProps();!a&&this.openDragLock&&(this.openDragLock(),this.openDragLock=null),t&&t.setActive("whileDrag",!1)}updateAxis(e,t,a){const{drag:s}=this.getProps();if(!a||!bd(e,s,this.currentDirection))return;const r=this.getAxisMotionValue(e);let n=this.originPoint[e]+a[e];this.constraints&&this.constraints[e]&&(n=function(e,{min:t,max:a},s){return void 0!==t&&e<t?e=s?wn(t,e,s.min):Math.max(e,t):void 0!==a&&e>a&&(e=s?wn(a,e,s.max):Math.min(e,a)),e}(n,this.constraints[e],this.elastic[e])),r.set(n)}resolveConstraints(){const{dragConstraints:e,dragElastic:t}=this.getProps(),a=this.visualElement.projection&&!this.visualElement.projection.layout?this.visualElement.projection.measure(!1):this.visualElement.projection?.layout,s=this.constraints;e&&gl(e)?this.constraints||(this.constraints=this.resolveRefConstraints()):this.constraints=!(!e||!a)&&function(e,{top:t,left:a,bottom:s,right:r}){return{x:md(e.x,a,r),y:md(e.y,t,s)}}(a.layoutBox,e),this.elastic=function(e=hd){return!1===e?e=0:!0===e&&(e=hd),{x:pd(e,"left","right"),y:pd(e,"top","bottom")}}(t),s!==this.constraints&&a&&this.constraints&&!this.hasMutatedConstraints&&Vc((e=>{!1!==this.constraints&&this.getAxisMotionValue(e)&&(this.constraints[e]=function(e,t){const a={};return void 0!==t.min&&(a.min=t.min-e.min),void 0!==t.max&&(a.max=t.max-e.min),a}(a.layoutBox[e],this.constraints[e]))}))}resolveRefConstraints(){const{dragConstraints:e,onMeasureDragConstraints:t}=this.getProps();if(!e||!gl(e))return!1;const a=e.current,{projection:s}=this.visualElement;if(!s||!s.layout)return!1;const r=function(e,t,a){const s=td(e,a),{scroll:r}=t;return r&&(Qc(s.x,r.offset.x),Qc(s.y,r.offset.y)),s}(a,s.root,this.visualElement.getTransformPagePoint());let n=function(e,t){return{x:ud(e.x,t.x),y:ud(e.y,t.y)}}(s.layout.layoutBox,r);if(t){const e=t(function({x:e,y:t}){return{top:t.min,right:e.max,bottom:t.max,left:e.min}}(n));this.hasMutatedConstraints=!!e,e&&(n=Tc(e))}return n}startAnimation(e){const{drag:t,dragMomentum:a,dragElastic:s,dragTransition:r,dragSnapToOrigin:n,onDragTransitionEnd:i}=this.getProps(),o=this.constraints||{},l=Vc((i=>{if(!bd(i,t,this.currentDirection))return;let l=o&&o[i]||{};n&&(l={min:0,max:0});const c=s?200:1e6,d=s?40:1e7,m={type:"inertia",velocity:a?e[i]:0,bounceStiffness:c,bounceDamping:d,timeConstant:750,restDelta:1,restSpeed:10,...r,...l};return this.startAxisValueAnimation(i,m)}));return Promise.all(l).then(i)}startAxisValueAnimation(e,t){const a=this.getAxisMotionValue(e);return rc(this.visualElement,e),a.start(mc(e,a,0,t,this.visualElement,!1))}stopAnimation(){Vc((e=>this.getAxisMotionValue(e).stop()))}pauseAnimation(){Vc((e=>this.getAxisMotionValue(e).animation?.pause()))}getAnimationState(e){return this.getAxisMotionValue(e).animation?.state}getAxisMotionValue(e){const t=`_drag${e.toUpperCase()}`,a=this.visualElement.getProps(),s=a[t];return s||this.visualElement.getValue(e,(a.initial?a.initial[e]:void 0)||0)}snapToCursor(e){Vc((t=>{const{drag:a}=this.getProps();if(!bd(t,a,this.currentDirection))return;const{projection:s}=this.visualElement,r=this.getAxisMotionValue(t);if(s&&s.layout){const{min:a,max:n}=s.layout.layoutBox[t];r.set(e[t]-wn(a,n,.5))}}))}scalePositionWithinConstraints(){if(!this.visualElement.current)return;const{drag:e,dragConstraints:t}=this.getProps(),{projection:a}=this.visualElement;if(!gl(t)||!a||!this.constraints)return;this.stopAnimation();const s={x:0,y:0};Vc((e=>{const t=this.getAxisMotionValue(e);if(t&&!1!==this.constraints){const a=t.get();s[e]=function(e,t){let a=.5;const s=qc(e),r=qc(t);return r>s?a=cr(t.min,t.max-s,e.min):s>r&&(a=cr(e.min,e.max-r,t.min)),er(0,1,a)}({min:a,max:a},this.constraints[e])}}));const{transformTemplate:r}=this.visualElement.getProps();this.visualElement.current.style.transform=r?r({},""):"none",a.root&&a.root.updateScroll(),a.updateLayout(),this.resolveConstraints(),Vc((t=>{if(!bd(t,e,null))return;const a=this.getAxisMotionValue(t),{min:r,max:n}=this.constraints[t];a.set(wn(r,n,s[t]))}))}addListeners(){if(!this.visualElement.current)return;fd.set(this.visualElement,this);const e=Mc(this.visualElement.current,"pointerdown",(e=>{const{drag:t,dragListener:a=!0}=this.getProps();t&&a&&this.start(e)})),t=()=>{const{dragConstraints:e}=this.getProps();gl(e)&&e.current&&(this.constraints=this.resolveRefConstraints())},{projection:a}=this.visualElement,s=a.addEventListener("measure",t);a&&!a.layout&&(a.root&&a.root.updateScroll(),a.updateLayout()),Dr.read(t);const r=Ac(window,"resize",(()=>this.scalePositionWithinConstraints())),n=a.addEventListener("didUpdate",(({delta:e,hasLayoutChanged:t})=>{this.isDragging&&t&&(Vc((t=>{const a=this.getAxisMotionValue(t);a&&(this.originPoint[t]+=e[t].translate,a.set(a.get()+e[t].translate))})),this.visualElement.render())}));return()=>{r(),e(),s(),n&&n()}}getProps(){const e=this.visualElement.getProps(),{drag:t=!1,dragDirectionLock:a=!1,dragPropagation:s=!1,dragConstraints:r=!1,dragElastic:n=hd,dragMomentum:i=!0}=e;return{...e,drag:t,dragDirectionLock:a,dragPropagation:s,dragConstraints:r,dragElastic:n,dragMomentum:i}}}function bd(e,t,a){return!(!0!==t&&t!==e||null!==a&&a!==e)}const vd=e=>(t,a)=>{e&&Dr.postRender((()=>e(t,a)))};const yd={hasAnimatedSinceResize:!0,hasEverUpdated:!1};function jd(e,t){return t.max===t.min?0:e/(t.max-t.min)*100}const Nd={correct:(e,t)=>{if(!t.target)return e;if("string"==typeof e){if(!on.test(e))return e;e=parseFloat(e)}return`${jd(e,t.target.x)}% ${jd(e,t.target.y)}%`}},_d={correct:(e,{treeScale:t,projectionDelta:a})=>{const s=e,r=jn.parse(e);if(r.length>5)return s;const n=jn.createTransformer(e),i="number"!=typeof r[0]?1:0,o=a.x.scale*t.x,l=a.y.scale*t.y;r[0+i]/=o,r[1+i]/=l;const c=wn(o,l,.5);return"number"==typeof r[2+i]&&(r[2+i]/=c),"number"==typeof r[3+i]&&(r[3+i]/=c),n(r)}};class wd extends e.Component{componentDidMount(){const{visualElement:e,layoutGroup:t,switchLayoutGroup:a,layoutId:s}=this.props,{projection:r}=e;!function(e){for(const t in e)Sl[t]=e[t],Br(t)&&(Sl[t].isCSSVariable=!0)}(Sd),r&&(t.group&&t.group.add(r),a&&a.register&&s&&a.register(r),r.root.didUpdate(),r.addEventListener("animationComplete",(()=>{this.safeToRemove()})),r.setOptions({...r.options,onExitComplete:()=>this.safeToRemove()})),yd.hasEverUpdated=!0}getSnapshotBeforeUpdate(e){const{layoutDependency:t,visualElement:a,drag:s,isPresent:r}=this.props,{projection:n}=a;return n?(n.isPresent=r,s||e.layoutDependency!==t||void 0===t||e.isPresent!==r?n.willUpdate():this.safeToRemove(),e.isPresent!==r&&(r?n.promote():n.relegate()||Dr.postRender((()=>{const e=n.getStack();e&&e.members.length||this.safeToRemove()}))),null):null}componentDidUpdate(){const{projection:e}=this.props.visualElement;e&&(e.root.didUpdate(),ko.postRender((()=>{!e.currentAnimation&&e.isLead()&&this.safeToRemove()})))}componentWillUnmount(){const{visualElement:e,layoutGroup:t,switchLayoutGroup:a}=this.props,{projection:s}=e;s&&(s.scheduleCheckAfterUnmount(),t&&t.group&&t.group.remove(s),a&&a.deregister&&a.deregister(s))}safeToRemove(){const{safeToRemove:e}=this.props;e&&e()}render(){return null}}function Cd(a){const[s,r]=Yo(),n=e.useContext(Xs);return t.jsx(wd,{...a,layoutGroup:n,switchLayoutGroup:e.useContext(jl),isPresent:s,safeToRemove:r})}const Sd={borderRadius:{...Nd,applyTo:["borderTopLeftRadius","borderTopRightRadius","borderBottomLeftRadius","borderBottomRightRadius"]},borderTopLeftRadius:Nd,borderTopRightRadius:Nd,borderBottomLeftRadius:Nd,borderBottomRightRadius:Nd,boxShadow:_d};const Ed=(e,t)=>e.depth-t.depth;class kd{constructor(){this.children=[],this.isDirty=!1}add(e){Qs(this.children,e),this.isDirty=!0}remove(e){Zs(this.children,e),this.isDirty=!0}forEach(e){this.isDirty&&this.children.sort(Ed),this.isDirty=!1,this.children.forEach(e)}}const Ad=["TopLeft","TopRight","BottomLeft","BottomRight"],Pd=Ad.length,Md=e=>"string"==typeof e?parseFloat(e):e,Td=e=>"number"==typeof e||on.test(e);function qd(e,t){return void 0!==e[t]?e[t]:e.borderRadius}const Dd=$d(0,.5,_r),Ld=$d(.5,.95,ir);function $d(e,t,a){return s=>s<e?0:s>t?1:a(cr(e,t,s))}function Rd(e,t){e.min=t.min,e.max=t.max}function Id(e,t){Rd(e.x,t.x),Rd(e.y,t.y)}function Fd(e,t){e.translate=t.translate,e.scale=t.scale,e.originPoint=t.originPoint,e.origin=t.origin}function Vd(e,t,a,s,r){return e=Gc(e-=t,1/a,s),void 0!==r&&(e=Gc(e,1/r,s)),e}function Od(e,t,[a,s,r],n,i){!function(e,t=0,a=1,s=.5,r,n=e,i=e){nn.test(t)&&(t=parseFloat(t),t=wn(i.min,i.max,t/100)-i.min);if("number"!=typeof t)return;let o=wn(n.min,n.max,s);e===n&&(o-=t),e.min=Vd(e.min,t,a,o,r),e.max=Vd(e.max,t,a,o,r)}(e,t[a],t[s],t[r],t.scale,n,i)}const Bd=["x","scaleX","originX"],Ud=["y","scaleY","originY"];function zd(e,t,a,s){Od(e.x,t,Bd,a?a.x:void 0,s?s.x:void 0),Od(e.y,t,Ud,a?a.y:void 0,s?s.y:void 0)}function Hd(e){return 0===e.translate&&1===e.scale}function Gd(e){return Hd(e.x)&&Hd(e.y)}function Xd(e,t){return e.min===t.min&&e.max===t.max}function Wd(e,t){return Math.round(e.min)===Math.round(t.min)&&Math.round(e.max)===Math.round(t.max)}function Yd(e,t){return Wd(e.x,t.x)&&Wd(e.y,t.y)}function Kd(e){return qc(e.x)/qc(e.y)}function Jd(e,t){return e.translate===t.translate&&e.scale===t.scale&&e.originPoint===t.originPoint}class Qd{constructor(){this.members=[]}add(e){Qs(this.members,e),e.scheduleRender()}remove(e){if(Zs(this.members,e),e===this.prevLead&&(this.prevLead=void 0),e===this.lead){const e=this.members[this.members.length-1];e&&this.promote(e)}}relegate(e){const t=this.members.findIndex((t=>e===t));if(0===t)return!1;let a;for(let s=t;s>=0;s--){const e=this.members[s];if(!1!==e.isPresent){a=e;break}}return!!a&&(this.promote(a),!0)}promote(e,t){const a=this.lead;if(e!==a&&(this.prevLead=a,this.lead=e,e.show(),a)){a.instance&&a.scheduleRender(),e.scheduleRender(),e.resumeFrom=a,t&&(e.resumeFrom.preserveOpacity=!0),a.snapshot&&(e.snapshot=a.snapshot,e.snapshot.latestValues=a.animationValues||a.latestValues),e.root&&e.root.isUpdating&&(e.isLayoutDirty=!0);const{crossfade:s}=e.options;!1===s&&a.hide()}}exitAnimationComplete(){this.members.forEach((e=>{const{options:t,resumingFrom:a}=e;t.onExitComplete&&t.onExitComplete(),a&&a.options.onExitComplete&&a.options.onExitComplete()}))}scheduleRender(){this.members.forEach((e=>{e.instance&&e.scheduleRender(!1)}))}removeLeadSnapshot(){this.lead&&this.lead.snapshot&&(this.lead.snapshot=void 0)}}const Zd=["","X","Y","Z"],em={visibility:"hidden"};let tm=0;function am(e,t,a,s){const{latestValues:r}=t;r[e]&&(a[e]=r[e],t.setStaticValue(e,0),s&&(s[e]=0))}function sm(e){if(e.hasCheckedOptimisedAppear=!0,e.root===e)return;const{visualElement:t}=e.options;if(!t)return;const a=nc(t);if(window.MotionHasOptimisedAnimation(a,"transform")){const{layout:t,layoutId:s}=e.options;window.MotionCancelOptimisedAnimation(a,"transform",Dr,!(t||s))}const{parent:s}=e;s&&!s.hasCheckedOptimisedAppear&&sm(s)}function rm({attachResizeListener:e,defaultParent:t,measureScroll:a,checkIsScrollRoot:s,resetTransform:r}){return class{constructor(e={},a=t?.()){this.id=tm++,this.animationId=0,this.children=new Set,this.options={},this.isTreeAnimating=!1,this.isAnimationBlocked=!1,this.isLayoutDirty=!1,this.isProjectionDirty=!1,this.isSharedProjectionDirty=!1,this.isTransformDirty=!1,this.updateManuallyBlocked=!1,this.updateBlockedByResize=!1,this.isUpdating=!1,this.isSVG=!1,this.needsReset=!1,this.shouldResetTransform=!1,this.hasCheckedOptimisedAppear=!1,this.treeScale={x:1,y:1},this.eventHandlers=new Map,this.hasTreeAnimated=!1,this.updateScheduled=!1,this.scheduleUpdate=()=>this.update(),this.projectionUpdateScheduled=!1,this.checkUpdateFailed=()=>{this.isUpdating&&(this.isUpdating=!1,this.clearAllSnapshots())},this.updateProjection=()=>{this.projectionUpdateScheduled=!1,this.nodes.forEach(om),this.nodes.forEach(pm),this.nodes.forEach(xm),this.nodes.forEach(lm)},this.resolvedRelativeTargetAt=0,this.hasProjected=!1,this.isVisible=!0,this.animationProgress=0,this.sharedNodes=new Map,this.latestValues=e,this.root=a?a.root||a:this,this.path=a?[...a.path,a]:[],this.parent=a,this.depth=a?a.depth+1:0;for(let t=0;t<this.path.length;t++)this.path[t].shouldResetTransform=!0;this.root===this&&(this.nodes=new kd)}addEventListener(e,t){return this.eventHandlers.has(e)||this.eventHandlers.set(e,new dr),this.eventHandlers.get(e).add(t)}notifyListeners(e,...t){const a=this.eventHandlers.get(e);a&&a.notify(...t)}hasListeners(e){return this.eventHandlers.has(e)}mount(t){if(this.instance)return;var a;this.isSVG=Oo(t)&&!(Oo(a=t)&&"svg"===a.tagName),this.instance=t;const{layoutId:s,layout:r,visualElement:n}=this.options;if(n&&!n.current&&n.mount(t),this.root.nodes.add(this),this.parent&&this.parent.children.add(this),this.root.hasTreeAnimated&&(r||s)&&(this.isLayoutDirty=!0),e){let a;const s=()=>this.root.updateBlockedByResize=!1;e(t,(()=>{this.root.updateBlockedByResize=!0,a&&a(),a=function(e,t){const a=Vr.now(),s=({timestamp:r})=>{const n=r-a;n>=t&&(Lr(s),e(n-t))};return Dr.setup(s,!0),()=>Lr(s)}(s,250),yd.hasAnimatedSinceResize&&(yd.hasAnimatedSinceResize=!1,this.nodes.forEach(hm))}))}s&&this.root.registerSharedNode(s,this),!1!==this.options.animate&&n&&(s||r)&&this.addEventListener("didUpdate",(({delta:e,hasLayoutChanged:t,hasRelativeLayoutChanged:a,layout:s})=>{if(this.isTreeAnimationBlocked())return this.target=void 0,void(this.relativeTarget=void 0);const r=this.options.transition||n.getDefaultTransition()||jm,{onLayoutAnimationStart:i,onLayoutAnimationComplete:o}=n.getProps(),l=!this.targetLayout||!Yd(this.targetLayout,s),c=!t&&a;if(this.options.layoutRoot||this.resumeFrom||c||t&&(l||!this.currentAnimation)){this.resumeFrom&&(this.resumingFrom=this.resumeFrom,this.resumingFrom.resumingFrom=void 0);const t={...lo(r,"layout"),onPlay:i,onComplete:o};(n.shouldReduceMotion||this.options.layoutRoot)&&(t.delay=0,t.type=!1),this.startAnimation(t),this.setAnimationOrigin(e,c)}else t||hm(this),this.isLead()&&this.options.onExitComplete&&this.options.onExitComplete();this.targetLayout=s}))}unmount(){this.options.layoutId&&this.willUpdate(),this.root.nodes.remove(this);const e=this.getStack();e&&e.remove(this),this.parent&&this.parent.children.delete(this),this.instance=void 0,this.eventHandlers.clear(),Lr(this.updateProjection)}blockUpdate(){this.updateManuallyBlocked=!0}unblockUpdate(){this.updateManuallyBlocked=!1}isUpdateBlocked(){return this.updateManuallyBlocked||this.updateBlockedByResize}isTreeAnimationBlocked(){return this.isAnimationBlocked||this.parent&&this.parent.isTreeAnimationBlocked()||!1}startUpdate(){this.isUpdateBlocked()||(this.isUpdating=!0,this.nodes&&this.nodes.forEach(fm),this.animationId++)}getTransformTemplate(){const{visualElement:e}=this.options;return e&&e.getProps().transformTemplate}willUpdate(e=!0){if(this.root.hasTreeAnimated=!0,this.root.isUpdateBlocked())return void(this.options.onExitComplete&&this.options.onExitComplete());if(window.MotionCancelOptimisedAnimation&&!this.hasCheckedOptimisedAppear&&sm(this),!this.root.isUpdating&&this.root.startUpdate(),this.isLayoutDirty)return;this.isLayoutDirty=!0;for(let r=0;r<this.path.length;r++){const e=this.path[r];e.shouldResetTransform=!0,e.updateScroll("snapshot"),e.options.layoutRoot&&e.willUpdate(!1)}const{layoutId:t,layout:a}=this.options;if(void 0===t&&!a)return;const s=this.getTransformTemplate();this.prevTransformTemplateValue=s?s(this.latestValues,""):void 0,this.updateSnapshot(),e&&this.notifyListeners("willUpdate")}update(){this.updateScheduled=!1;if(this.isUpdateBlocked())return this.unblockUpdate(),this.clearAllSnapshots(),void this.nodes.forEach(dm);this.isUpdating||this.nodes.forEach(mm),this.isUpdating=!1,this.nodes.forEach(um),this.nodes.forEach(nm),this.nodes.forEach(im),this.clearAllSnapshots();const e=Vr.now();$r.delta=er(0,1e3/60,e-$r.timestamp),$r.timestamp=e,$r.isProcessing=!0,Rr.update.process($r),Rr.preRender.process($r),Rr.render.process($r),$r.isProcessing=!1}didUpdate(){this.updateScheduled||(this.updateScheduled=!0,ko.read(this.scheduleUpdate))}clearAllSnapshots(){this.nodes.forEach(cm),this.sharedNodes.forEach(gm)}scheduleUpdateProjection(){this.projectionUpdateScheduled||(this.projectionUpdateScheduled=!0,Dr.preRender(this.updateProjection,!1,!0))}scheduleCheckAfterUnmount(){Dr.postRender((()=>{this.isLayoutDirty?this.root.didUpdate():this.root.checkUpdateFailed()}))}updateSnapshot(){!this.snapshot&&this.instance&&(this.snapshot=this.measure(),!this.snapshot||qc(this.snapshot.measuredBox.x)||qc(this.snapshot.measuredBox.y)||(this.snapshot=void 0))}updateLayout(){if(!this.instance)return;if(this.updateScroll(),!(this.options.alwaysMeasureLayout&&this.isLead()||this.isLayoutDirty))return;if(this.resumeFrom&&!this.resumeFrom.instance)for(let a=0;a<this.path.length;a++){this.path[a].updateScroll()}const e=this.layout;this.layout=this.measure(!1),this.layoutCorrected={x:{min:0,max:0},y:{min:0,max:0}},this.isLayoutDirty=!1,this.projectionDelta=void 0,this.notifyListeners("measure",this.layout.layoutBox);const{visualElement:t}=this.options;t&&t.notify("LayoutMeasure",this.layout.layoutBox,e?e.layoutBox:void 0)}updateScroll(e="measure"){let t=Boolean(this.options.layoutScroll&&this.instance);if(this.scroll&&this.scroll.animationId===this.root.animationId&&this.scroll.phase===e&&(t=!1),t&&this.instance){const t=s(this.instance);this.scroll={animationId:this.root.animationId,phase:e,isRoot:t,offset:a(this.instance),wasRoot:this.scroll?this.scroll.isRoot:t}}}resetTransform(){if(!r)return;const e=this.isLayoutDirty||this.shouldResetTransform||this.options.alwaysMeasureLayout,t=this.projectionDelta&&!Gd(this.projectionDelta),a=this.getTransformTemplate(),s=a?a(this.latestValues,""):void 0,n=s!==this.prevTransformTemplateValue;e&&this.instance&&(t||Uc(this.latestValues)||n)&&(r(this.instance,s),this.shouldResetTransform=!1,this.scheduleRender())}measure(e=!0){const t=this.measurePageBox();let a=this.removeElementScroll(t);var s;return e&&(a=this.removeTransform(a)),wm((s=a).x),wm(s.y),{animationId:this.root.animationId,measuredBox:t,layoutBox:a,latestValues:{},source:this.id}}measurePageBox(){const{visualElement:e}=this.options;if(!e)return{x:{min:0,max:0},y:{min:0,max:0}};const t=e.measureViewportBox();if(!(this.scroll?.wasRoot||this.path.some(Sm))){const{scroll:e}=this.root;e&&(Qc(t.x,e.offset.x),Qc(t.y,e.offset.y))}return t}removeElementScroll(e){const t={x:{min:0,max:0},y:{min:0,max:0}};if(Id(t,e),this.scroll?.wasRoot)return t;for(let a=0;a<this.path.length;a++){const s=this.path[a],{scroll:r,options:n}=s;s!==this.root&&r&&n.layoutScroll&&(r.wasRoot&&Id(t,e),Qc(t.x,r.offset.x),Qc(t.y,r.offset.y))}return t}applyTransform(e,t=!1){const a={x:{min:0,max:0},y:{min:0,max:0}};Id(a,e);for(let s=0;s<this.path.length;s++){const e=this.path[s];!t&&e.options.layoutScroll&&e.scroll&&e!==e.root&&ed(a,{x:-e.scroll.offset.x,y:-e.scroll.offset.y}),Uc(e.latestValues)&&ed(a,e.latestValues)}return Uc(this.latestValues)&&ed(a,this.latestValues),a}removeTransform(e){const t={x:{min:0,max:0},y:{min:0,max:0}};Id(t,e);for(let a=0;a<this.path.length;a++){const e=this.path[a];if(!e.instance)continue;if(!Uc(e.latestValues))continue;Bc(e.latestValues)&&e.updateSnapshot();const s={x:{min:0,max:0},y:{min:0,max:0}};Id(s,e.measurePageBox()),zd(t,e.latestValues,e.snapshot?e.snapshot.layoutBox:void 0,s)}return Uc(this.latestValues)&&zd(t,this.latestValues),t}setTargetDelta(e){this.targetDelta=e,this.root.scheduleUpdateProjection(),this.isProjectionDirty=!0}setOptions(e){this.options={...this.options,...e,crossfade:void 0===e.crossfade||e.crossfade}}clearMeasurements(){this.scroll=void 0,this.layout=void 0,this.snapshot=void 0,this.prevTransformTemplateValue=void 0,this.targetDelta=void 0,this.target=void 0,this.isLayoutDirty=!1}forceRelativeParentToResolveTarget(){this.relativeParent&&this.relativeParent.resolvedRelativeTargetAt!==$r.timestamp&&this.relativeParent.resolveTargetDelta(!0)}resolveTargetDelta(e=!1){const t=this.getLead();this.isProjectionDirty||(this.isProjectionDirty=t.isProjectionDirty),this.isTransformDirty||(this.isTransformDirty=t.isTransformDirty),this.isSharedProjectionDirty||(this.isSharedProjectionDirty=t.isSharedProjectionDirty);const a=Boolean(this.resumingFrom)||this!==t;if(!(e||a&&this.isSharedProjectionDirty||this.isProjectionDirty||this.parent?.isProjectionDirty||this.attemptToResolveRelativeTarget||this.root.updateBlockedByResize))return;const{layout:s,layoutId:r}=this.options;if(this.layout&&(s||r)){if(this.resolvedRelativeTargetAt=$r.timestamp,!this.targetDelta&&!this.relativeTarget){const e=this.getClosestProjectingParent();e&&e.layout&&1!==this.animationProgress?(this.relativeParent=e,this.forceRelativeParentToResolveTarget(),this.relativeTarget={x:{min:0,max:0},y:{min:0,max:0}},this.relativeTargetOrigin={x:{min:0,max:0},y:{min:0,max:0}},Ic(this.relativeTargetOrigin,this.layout.layoutBox,e.layout.layoutBox),Id(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}var n,i,o;if(this.relativeTarget||this.targetDelta)if(this.target||(this.target={x:{min:0,max:0},y:{min:0,max:0}},this.targetWithTransforms={x:{min:0,max:0},y:{min:0,max:0}}),this.relativeTarget&&this.relativeTargetOrigin&&this.relativeParent&&this.relativeParent.target?(this.forceRelativeParentToResolveTarget(),n=this.target,i=this.relativeTarget,o=this.relativeParent.target,$c(n.x,i.x,o.x),$c(n.y,i.y,o.y)):this.targetDelta?(Boolean(this.resumingFrom)?this.target=this.applyTransform(this.layout.layoutBox):Id(this.target,this.layout.layoutBox),Yc(this.target,this.targetDelta)):Id(this.target,this.layout.layoutBox),this.attemptToResolveRelativeTarget){this.attemptToResolveRelativeTarget=!1;const e=this.getClosestProjectingParent();e&&Boolean(e.resumingFrom)===Boolean(this.resumingFrom)&&!e.options.layoutScroll&&e.target&&1!==this.animationProgress?(this.relativeParent=e,this.forceRelativeParentToResolveTarget(),this.relativeTarget={x:{min:0,max:0},y:{min:0,max:0}},this.relativeTargetOrigin={x:{min:0,max:0},y:{min:0,max:0}},Ic(this.relativeTargetOrigin,this.target,e.target),Id(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}}}getClosestProjectingParent(){if(this.parent&&!Bc(this.parent.latestValues)&&!zc(this.parent.latestValues))return this.parent.isProjecting()?this.parent:this.parent.getClosestProjectingParent()}isProjecting(){return Boolean((this.relativeTarget||this.targetDelta||this.options.layoutRoot)&&this.layout)}calcProjection(){const e=this.getLead(),t=Boolean(this.resumingFrom)||this!==e;let a=!0;if((this.isProjectionDirty||this.parent?.isProjectionDirty)&&(a=!1),t&&(this.isSharedProjectionDirty||this.isTransformDirty)&&(a=!1),this.resolvedRelativeTargetAt===$r.timestamp&&(a=!1),a)return;const{layout:s,layoutId:r}=this.options;if(this.isTreeAnimating=Boolean(this.parent&&this.parent.isTreeAnimating||this.currentAnimation||this.pendingAnimation),this.isTreeAnimating||(this.targetDelta=this.relativeTarget=void 0),!this.layout||!s&&!r)return;Id(this.layoutCorrected,this.layout.layoutBox);const n=this.treeScale.x,i=this.treeScale.y;!function(e,t,a,s=!1){const r=a.length;if(!r)return;let n,i;t.x=t.y=1;for(let o=0;o<r;o++){n=a[o],i=n.projectionDelta;const{visualElement:r}=n.options;r&&r.props.style&&"contents"===r.props.style.display||(s&&n.options.layoutScroll&&n.scroll&&n!==n.root&&ed(e,{x:-n.scroll.offset.x,y:-n.scroll.offset.y}),i&&(t.x*=i.x.scale,t.y*=i.y.scale,Yc(e,i)),s&&Uc(n.latestValues)&&ed(e,n.latestValues))}t.x<Jc&&t.x>Kc&&(t.x=1),t.y<Jc&&t.y>Kc&&(t.y=1)}(this.layoutCorrected,this.treeScale,this.path,t),!e.layout||e.target||1===this.treeScale.x&&1===this.treeScale.y||(e.target=e.layout.layoutBox,e.targetWithTransforms={x:{min:0,max:0},y:{min:0,max:0}});const{target:o}=e;o?(this.projectionDelta&&this.prevProjectionDelta?(Fd(this.prevProjectionDelta.x,this.projectionDelta.x),Fd(this.prevProjectionDelta.y,this.projectionDelta.y)):this.createProjectionDeltas(),Lc(this.projectionDelta,this.layoutCorrected,o,this.latestValues),this.treeScale.x===n&&this.treeScale.y===i&&Jd(this.projectionDelta.x,this.prevProjectionDelta.x)&&Jd(this.projectionDelta.y,this.prevProjectionDelta.y)||(this.hasProjected=!0,this.scheduleRender(),this.notifyListeners("projectionUpdate",o))):this.prevProjectionDelta&&(this.createProjectionDeltas(),this.scheduleRender())}hide(){this.isVisible=!1}show(){this.isVisible=!0}scheduleRender(e=!0){if(this.options.visualElement?.scheduleRender(),e){const e=this.getStack();e&&e.scheduleRender()}this.resumingFrom&&!this.resumingFrom.instance&&(this.resumingFrom=void 0)}createProjectionDeltas(){this.prevProjectionDelta={x:{translate:0,scale:1,origin:0,originPoint:0},y:{translate:0,scale:1,origin:0,originPoint:0}},this.projectionDelta={x:{translate:0,scale:1,origin:0,originPoint:0},y:{translate:0,scale:1,origin:0,originPoint:0}},this.projectionDeltaWithTransform={x:{translate:0,scale:1,origin:0,originPoint:0},y:{translate:0,scale:1,origin:0,originPoint:0}}}setAnimationOrigin(e,t=!1){const a=this.snapshot,s=a?a.latestValues:{},r={...this.latestValues},n={x:{translate:0,scale:1,origin:0,originPoint:0},y:{translate:0,scale:1,origin:0,originPoint:0}};this.relativeParent&&this.relativeParent.options.layoutRoot||(this.relativeTarget=this.relativeTargetOrigin=void 0),this.attemptToResolveRelativeTarget=!t;const i={x:{min:0,max:0},y:{min:0,max:0}},o=(a?a.source:void 0)!==(this.layout?this.layout.source:void 0),l=this.getStack(),c=!l||l.members.length<=1,d=Boolean(o&&!c&&!0===this.options.crossfade&&!this.path.some(ym));let m;this.animationProgress=0,this.mixTargetDelta=t=>{const a=t/1e3;bm(n.x,e.x,a),bm(n.y,e.y,a),this.setTargetDelta(n),this.relativeTarget&&this.relativeTargetOrigin&&this.layout&&this.relativeParent&&this.relativeParent.layout&&(Ic(i,this.layout.layoutBox,this.relativeParent.layout.layoutBox),function(e,t,a,s){vm(e.x,t.x,a.x,s),vm(e.y,t.y,a.y,s)}(this.relativeTarget,this.relativeTargetOrigin,i,a),m&&function(e,t){return Xd(e.x,t.x)&&Xd(e.y,t.y)}(this.relativeTarget,m)&&(this.isProjectionDirty=!1),m||(m={x:{min:0,max:0},y:{min:0,max:0}}),Id(m,this.relativeTarget)),o&&(this.animationValues=r,function(e,t,a,s,r,n){r?(e.opacity=wn(0,a.opacity??1,Dd(s)),e.opacityExit=wn(t.opacity??1,0,Ld(s))):n&&(e.opacity=wn(t.opacity??1,a.opacity??1,s));for(let i=0;i<Pd;i++){const r=`border${Ad[i]}Radius`;let n=qd(t,r),o=qd(a,r);void 0===n&&void 0===o||(n||(n=0),o||(o=0),0===n||0===o||Td(n)===Td(o)?(e[r]=Math.max(wn(Md(n),Md(o),s),0),(nn.test(o)||nn.test(n))&&(e[r]+="%")):e[r]=o)}(t.rotate||a.rotate)&&(e.rotate=wn(t.rotate||0,a.rotate||0,s))}(r,s,this.latestValues,a,d,c)),this.root.scheduleUpdateProjection(),this.scheduleRender(),this.animationProgress=a},this.mixTargetDelta(this.options.layoutRoot?1e3:0)}startAnimation(e){this.notifyListeners("animationStart"),this.currentAnimation?.stop(),this.resumingFrom?.currentAnimation?.stop(),this.pendingAnimation&&(Lr(this.pendingAnimation),this.pendingAnimation=void 0),this.pendingAnimation=Dr.update((()=>{yd.hasAnimatedSinceResize=!0,this.motionValue||(this.motionValue=Eo(0)),this.currentAnimation=function(e,t,a){const s=Bo(e)?e:Eo(e);return s.start(mc("",s,t,a)),s.animation}(this.motionValue,[0,1e3],{...e,velocity:0,isSync:!0,onUpdate:t=>{this.mixTargetDelta(t),e.onUpdate&&e.onUpdate(t)},onStop:()=>{},onComplete:()=>{e.onComplete&&e.onComplete(),this.completeAnimation()}}),this.resumingFrom&&(this.resumingFrom.currentAnimation=this.currentAnimation),this.pendingAnimation=void 0}))}completeAnimation(){this.resumingFrom&&(this.resumingFrom.currentAnimation=void 0,this.resumingFrom.preserveOpacity=void 0);const e=this.getStack();e&&e.exitAnimationComplete(),this.resumingFrom=this.currentAnimation=this.animationValues=void 0,this.notifyListeners("animationComplete")}finishAnimation(){this.currentAnimation&&(this.mixTargetDelta&&this.mixTargetDelta(1e3),this.currentAnimation.stop()),this.completeAnimation()}applyTransformsToTarget(){const e=this.getLead();let{targetWithTransforms:t,target:a,layout:s,latestValues:r}=e;if(t&&a&&s){if(this!==e&&this.layout&&s&&Cm(this.options.animationType,this.layout.layoutBox,s.layoutBox)){a=this.target||{x:{min:0,max:0},y:{min:0,max:0}};const t=qc(this.layout.layoutBox.x);a.x.min=e.target.x.min,a.x.max=a.x.min+t;const s=qc(this.layout.layoutBox.y);a.y.min=e.target.y.min,a.y.max=a.y.min+s}Id(t,a),ed(t,r),Lc(this.projectionDeltaWithTransform,this.layoutCorrected,t,r)}}registerSharedNode(e,t){this.sharedNodes.has(e)||this.sharedNodes.set(e,new Qd);this.sharedNodes.get(e).add(t);const a=t.options.initialPromotionConfig;t.promote({transition:a?a.transition:void 0,preserveFollowOpacity:a&&a.shouldPreserveFollowOpacity?a.shouldPreserveFollowOpacity(t):void 0})}isLead(){const e=this.getStack();return!e||e.lead===this}getLead(){const{layoutId:e}=this.options;return e&&this.getStack()?.lead||this}getPrevLead(){const{layoutId:e}=this.options;return e?this.getStack()?.prevLead:void 0}getStack(){const{layoutId:e}=this.options;if(e)return this.root.sharedNodes.get(e)}promote({needsReset:e,transition:t,preserveFollowOpacity:a}={}){const s=this.getStack();s&&s.promote(this,a),e&&(this.projectionDelta=void 0,this.needsReset=!0),t&&this.setOptions({transition:t})}relegate(){const e=this.getStack();return!!e&&e.relegate(this)}resetSkewAndRotation(){const{visualElement:e}=this.options;if(!e)return;let t=!1;const{latestValues:a}=e;if((a.z||a.rotate||a.rotateX||a.rotateY||a.rotateZ||a.skewX||a.skewY)&&(t=!0),!t)return;const s={};a.z&&am("z",e,s,this.animationValues);for(let r=0;r<Zd.length;r++)am(`rotate${Zd[r]}`,e,s,this.animationValues),am(`skew${Zd[r]}`,e,s,this.animationValues);e.render();for(const r in s)e.setStaticValue(r,s[r]),this.animationValues&&(this.animationValues[r]=s[r]);e.scheduleRender()}getProjectionStyles(e){if(!this.instance||this.isSVG)return;if(!this.isVisible)return em;const t={visibility:""},a=this.getTransformTemplate();if(this.needsReset)return this.needsReset=!1,t.opacity="",t.pointerEvents=Gl(e?.pointerEvents)||"",t.transform=a?a(this.latestValues,""):"none",t;const s=this.getLead();if(!this.projectionDelta||!this.layout||!s.target){const t={};return this.options.layoutId&&(t.opacity=void 0!==this.latestValues.opacity?this.latestValues.opacity:1,t.pointerEvents=Gl(e?.pointerEvents)||""),this.hasProjected&&!Uc(this.latestValues)&&(t.transform=a?a({},""):"none",this.hasProjected=!1),t}const r=s.animationValues||s.latestValues;this.applyTransformsToTarget(),t.transform=function(e,t,a){let s="";const r=e.x.translate/t.x,n=e.y.translate/t.y,i=a?.z||0;if((r||n||i)&&(s=`translate3d(${r}px, ${n}px, ${i}px) `),1===t.x&&1===t.y||(s+=`scale(${1/t.x}, ${1/t.y}) `),a){const{transformPerspective:e,rotate:t,rotateX:r,rotateY:n,skewX:i,skewY:o}=a;e&&(s=`perspective(${e}px) ${s}`),t&&(s+=`rotate(${t}deg) `),r&&(s+=`rotateX(${r}deg) `),n&&(s+=`rotateY(${n}deg) `),i&&(s+=`skewX(${i}deg) `),o&&(s+=`skewY(${o}deg) `)}const o=e.x.scale*t.x,l=e.y.scale*t.y;return 1===o&&1===l||(s+=`scale(${o}, ${l})`),s||"none"}(this.projectionDeltaWithTransform,this.treeScale,r),a&&(t.transform=a(r,t.transform));const{x:n,y:i}=this.projectionDelta;t.transformOrigin=`${100*n.origin}% ${100*i.origin}% 0`,s.animationValues?t.opacity=s===this?r.opacity??this.latestValues.opacity??1:this.preserveOpacity?this.latestValues.opacity:r.opacityExit:t.opacity=s===this?void 0!==r.opacity?r.opacity:"":void 0!==r.opacityExit?r.opacityExit:0;for(const o in Sl){if(void 0===r[o])continue;const{correct:e,applyTo:a,isCSSVariable:n}=Sl[o],i="none"===t.transform?r[o]:e(r[o],s);if(a){const e=a.length;for(let s=0;s<e;s++)t[a[s]]=i}else n?this.options.visualElement.renderState.vars[o]=i:t[o]=i}return this.options.layoutId&&(t.pointerEvents=s===this?Gl(e?.pointerEvents)||"":"none"),t}clearSnapshot(){this.resumeFrom=this.snapshot=void 0}resetTree(){this.root.nodes.forEach((e=>e.currentAnimation?.stop())),this.root.nodes.forEach(dm),this.root.sharedNodes.clear()}}}function nm(e){e.updateLayout()}function im(e){const t=e.resumeFrom?.snapshot||e.snapshot;if(e.isLead()&&e.layout&&t&&e.hasListeners("didUpdate")){const{layoutBox:a,measuredBox:s}=e.layout,{animationType:r}=e.options,n=t.source!==e.layout.source;"size"===r?Vc((e=>{const s=n?t.measuredBox[e]:t.layoutBox[e],r=qc(s);s.min=a[e].min,s.max=s.min+r})):Cm(r,t.layoutBox,a)&&Vc((s=>{const r=n?t.measuredBox[s]:t.layoutBox[s],i=qc(a[s]);r.max=r.min+i,e.relativeTarget&&!e.currentAnimation&&(e.isProjectionDirty=!0,e.relativeTarget[s].max=e.relativeTarget[s].min+i)}));const i={x:{translate:0,scale:1,origin:0,originPoint:0},y:{translate:0,scale:1,origin:0,originPoint:0}};Lc(i,a,t.layoutBox);const o={x:{translate:0,scale:1,origin:0,originPoint:0},y:{translate:0,scale:1,origin:0,originPoint:0}};n?Lc(o,e.applyTransform(s,!0),t.measuredBox):Lc(o,a,t.layoutBox);const l=!Gd(i);let c=!1;if(!e.resumeFrom){const s=e.getClosestProjectingParent();if(s&&!s.resumeFrom){const{snapshot:r,layout:n}=s;if(r&&n){const i={x:{min:0,max:0},y:{min:0,max:0}};Ic(i,t.layoutBox,r.layoutBox);const o={x:{min:0,max:0},y:{min:0,max:0}};Ic(o,a,n.layoutBox),Yd(i,o)||(c=!0),s.options.layoutRoot&&(e.relativeTarget=o,e.relativeTargetOrigin=i,e.relativeParent=s)}}}e.notifyListeners("didUpdate",{layout:a,snapshot:t,delta:o,layoutDelta:i,hasLayoutChanged:l,hasRelativeLayoutChanged:c})}else if(e.isLead()){const{onExitComplete:t}=e.options;t&&t()}e.options.transition=void 0}function om(e){e.parent&&(e.isProjecting()||(e.isProjectionDirty=e.parent.isProjectionDirty),e.isSharedProjectionDirty||(e.isSharedProjectionDirty=Boolean(e.isProjectionDirty||e.parent.isProjectionDirty||e.parent.isSharedProjectionDirty)),e.isTransformDirty||(e.isTransformDirty=e.parent.isTransformDirty))}function lm(e){e.isProjectionDirty=e.isSharedProjectionDirty=e.isTransformDirty=!1}function cm(e){e.clearSnapshot()}function dm(e){e.clearMeasurements()}function mm(e){e.isLayoutDirty=!1}function um(e){const{visualElement:t}=e.options;t&&t.getProps().onBeforeLayoutMeasure&&t.notify("BeforeLayoutMeasure"),e.resetTransform()}function hm(e){e.finishAnimation(),e.targetDelta=e.relativeTarget=e.target=void 0,e.isProjectionDirty=!0}function pm(e){e.resolveTargetDelta()}function xm(e){e.calcProjection()}function fm(e){e.resetSkewAndRotation()}function gm(e){e.removeLeadSnapshot()}function bm(e,t,a){e.translate=wn(t.translate,0,a),e.scale=wn(t.scale,1,a),e.origin=t.origin,e.originPoint=t.originPoint}function vm(e,t,a,s){e.min=wn(t.min,a.min,s),e.max=wn(t.max,a.max,s)}function ym(e){return e.animationValues&&void 0!==e.animationValues.opacityExit}const jm={duration:.45,ease:[.4,0,.1,1]},Nm=e=>"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().includes(e),_m=Nm("applewebkit/")&&!Nm("chrome/")?Math.round:ir;function wm(e){e.min=_m(e.min),e.max=_m(e.max)}function Cm(e,t,a){return"position"===e||"preserve-aspect"===e&&(s=Kd(t),r=Kd(a),n=.2,!(Math.abs(s-r)<=n));var s,r,n}function Sm(e){return e!==e.root&&e.scroll?.wasRoot}const Em=rm({attachResizeListener:(e,t)=>Ac(e,"resize",t),measureScroll:()=>({x:document.documentElement.scrollLeft||document.body.scrollLeft,y:document.documentElement.scrollTop||document.body.scrollTop}),checkIsScrollRoot:()=>!0}),km={current:void 0},Am=rm({measureScroll:e=>({x:e.scrollLeft,y:e.scrollTop}),defaultParent:()=>{if(!km.current){const e=new Em({});e.mount(window),e.setOptions({layoutScroll:!0}),km.current=e}return km.current},resetTransform:(e,t)=>{e.style.transform=void 0!==t?t:"none"},checkIsScrollRoot:e=>Boolean("fixed"===window.getComputedStyle(e).position)}),Pm={pan:{Feature:class extends Sc{constructor(){super(...arguments),this.removePointerDownListener=ir}onPointerDown(e){this.session=new rd(e,this.createPanHandlers(),{transformPagePoint:this.node.getTransformPagePoint(),contextWindow:ad(this.node)})}createPanHandlers(){const{onPanSessionStart:e,onPanStart:t,onPan:a,onPanEnd:s}=this.node.getProps();return{onSessionStart:vd(e),onStart:vd(t),onMove:a,onEnd:(e,t)=>{delete this.session,s&&Dr.postRender((()=>s(e,t)))}}}mount(){this.removePointerDownListener=Mc(this.node.current,"pointerdown",(e=>this.onPointerDown(e)))}update(){this.session&&this.session.updateHandlers(this.createPanHandlers())}unmount(){this.removePointerDownListener(),this.session&&this.session.end()}}},drag:{Feature:class extends Sc{constructor(e){super(e),this.removeGroupControls=ir,this.removeListeners=ir,this.controls=new gd(e)}mount(){const{dragControls:e}=this.node.getProps();e&&(this.removeGroupControls=e.subscribe(this.controls)),this.removeListeners=this.controls.addListeners()||ir}unmount(){this.removeGroupControls(),this.removeListeners()}},ProjectionNode:Am,MeasureLayout:Cd}};function Mm(e,t,a){const{props:s}=e;e.animationState&&s.whileHover&&e.animationState.setActive("whileHover","Start"===a);const r=s["onHover"+a];r&&Dr.postRender((()=>r(t,Pc(t))))}function Tm(e,t,a){const{props:s}=e;if(e.current instanceof HTMLButtonElement&&e.current.disabled)return;e.animationState&&s.whileTap&&e.animationState.setActive("whileTap","Start"===a);const r=s["onTap"+("End"===a?"":a)];r&&Dr.postRender((()=>r(t,Pc(t))))}const qm=new WeakMap,Dm=new WeakMap,Lm=e=>{const t=qm.get(e.target);t&&t(e)},$m=e=>{e.forEach(Lm)};function Rm(e,t,a){const s=function({root:e,...t}){const a=e||document;Dm.has(a)||Dm.set(a,{});const s=Dm.get(a),r=JSON.stringify(t);return s[r]||(s[r]=new IntersectionObserver($m,{root:e,...t})),s[r]}(t);return qm.set(e,a),s.observe(e),()=>{qm.delete(e),s.unobserve(e)}}const Im={some:0,all:1};const Fm={inView:{Feature:class extends Sc{constructor(){super(...arguments),this.hasEnteredView=!1,this.isInView=!1}startObserver(){this.unmount();const{viewport:e={}}=this.node.getProps(),{root:t,margin:a,amount:s="some",once:r}=e,n={root:t?t.current:void 0,rootMargin:a,threshold:"number"==typeof s?s:Im[s]};return Rm(this.node.current,n,(e=>{const{isIntersecting:t}=e;if(this.isInView===t)return;if(this.isInView=t,r&&!t&&this.hasEnteredView)return;t&&(this.hasEnteredView=!0),this.node.animationState&&this.node.animationState.setActive("whileInView",t);const{onViewportEnter:a,onViewportLeave:s}=this.node.getProps(),n=t?a:s;n&&n(e)}))}mount(){this.startObserver()}update(){if("undefined"==typeof IntersectionObserver)return;const{props:e,prevProps:t}=this.node;["amount","margin","root"].some(function({viewport:e={}},{viewport:t={}}={}){return a=>e[a]!==t[a]}(e,t))&&this.startObserver()}unmount(){}}},tap:{Feature:class extends Sc{mount(){const{current:e}=this.node;e&&(this.unmount=Vo(e,((e,t)=>(Tm(this.node,t,"Start"),(e,{success:t})=>Tm(this.node,e,t?"End":"Cancel"))),{useGlobalTarget:this.node.props.globalTapTarget}))}unmount(){}}},focus:{Feature:class extends Sc{constructor(){super(...arguments),this.isActive=!1}onFocus(){let e=!1;try{e=this.node.current.matches(":focus-visible")}catch(t){e=!0}e&&this.node.animationState&&(this.node.animationState.setActive("whileFocus",!0),this.isActive=!0)}onBlur(){this.isActive&&this.node.animationState&&(this.node.animationState.setActive("whileFocus",!1),this.isActive=!1)}mount(){this.unmount=lr(Ac(this.node.current,"focus",(()=>this.onFocus())),Ac(this.node.current,"blur",(()=>this.onBlur())))}unmount(){}}},hover:{Feature:class extends Sc{mount(){const{current:e}=this.node;e&&(this.unmount=function(e,t,a={}){const[s,r,n]=Mo(e,a),i=e=>{if(!To(e))return;const{target:a}=e,s=t(a,e);if("function"!=typeof s||!a)return;const n=e=>{To(e)&&(s(e),a.removeEventListener("pointerleave",n))};a.addEventListener("pointerleave",n,r)};return s.forEach((e=>{e.addEventListener("pointerenter",i,r)})),n}(e,((e,t)=>(Mm(this.node,t,"Start"),e=>Mm(this.node,e,"End")))))}unmount(){}}}},Vm={layout:{ProjectionNode:Am,MeasureLayout:Cd}},Om={current:null},Bm={current:!1};const Um=new WeakMap;const zm=["AnimationStart","AnimationComplete","Update","BeforeLayoutMeasure","LayoutMeasure","LayoutAnimationStart","LayoutAnimationComplete"];class Hm{scrapeMotionValuesFromProps(e,t,a){return{}}constructor({parent:e,props:t,presenceContext:a,reducedMotionConfig:s,blockInitialAnimation:r,visualState:n},i={}){this.current=null,this.children=new Set,this.isVariantNode=!1,this.isControllingVariants=!1,this.shouldReduceMotion=null,this.values=new Map,this.KeyframeResolver=Oi,this.features={},this.valueSubscriptions=new Map,this.prevMotionValues={},this.events={},this.propEventSubscriptions={},this.notifyUpdate=()=>this.notify("Update",this.latestValues),this.render=()=>{this.current&&(this.triggerBuild(),this.renderInstance(this.current,this.renderState,this.props.style,this.projection))},this.renderScheduledAt=0,this.scheduleRender=()=>{const e=Vr.now();this.renderScheduledAt<e&&(this.renderScheduledAt=e,Dr.render(this.render,!1,!0))};const{latestValues:o,renderState:l}=n;this.latestValues=o,this.baseTarget={...o},this.initialValues=t.initial?{...o}:{},this.renderState=l,this.parent=e,this.props=t,this.presenceContext=a,this.depth=e?e.depth+1:0,this.reducedMotionConfig=s,this.options=i,this.blockInitialAnimation=Boolean(r),this.isControllingVariants=ul(t),this.isVariantNode=hl(t),this.isVariantNode&&(this.variantChildren=new Set),this.manuallyAnimateOnMount=Boolean(e&&e.current);const{willChange:c,...d}=this.scrapeMotionValuesFromProps(t,{},this);for(const m in d){const e=d[m];void 0!==o[m]&&Bo(e)&&e.set(o[m],!1)}}mount(e){this.current=e,Um.set(e,this),this.projection&&!this.projection.instance&&this.projection.mount(e),this.parent&&this.isVariantNode&&!this.isControllingVariants&&(this.removeFromVariantTree=this.parent.addVariantChild(this)),this.values.forEach(((e,t)=>this.bindToMotionValue(t,e))),Bm.current||function(){if(Bm.current=!0,Ys)if(window.matchMedia){const e=window.matchMedia("(prefers-reduced-motion)"),t=()=>Om.current=e.matches;e.addListener(t),t()}else Om.current=!1}(),this.shouldReduceMotion="never"!==this.reducedMotionConfig&&("always"===this.reducedMotionConfig||Om.current),this.parent&&this.parent.children.add(this),this.update(this.props,this.presenceContext)}unmount(){this.projection&&this.projection.unmount(),Lr(this.notifyUpdate),Lr(this.render),this.valueSubscriptions.forEach((e=>e())),this.valueSubscriptions.clear(),this.removeFromVariantTree&&this.removeFromVariantTree(),this.parent&&this.parent.children.delete(this);for(const e in this.events)this.events[e].clear();for(const e in this.features){const t=this.features[e];t&&(t.unmount(),t.isMounted=!1)}this.current=null}bindToMotionValue(e,t){this.valueSubscriptions.has(e)&&this.valueSubscriptions.get(e)();const a=Pi.has(e);a&&this.onBindTransform&&this.onBindTransform();const s=t.on("change",(t=>{this.latestValues[e]=t,this.props.onUpdate&&Dr.preRender(this.notifyUpdate),a&&this.projection&&(this.projection.isTransformDirty=!0)})),r=t.on("renderRequest",this.scheduleRender);let n;window.MotionCheckAppearSync&&(n=window.MotionCheckAppearSync(this,e,t)),this.valueSubscriptions.set(e,(()=>{s(),r(),n&&n(),t.owner&&t.stop()}))}sortNodePosition(e){return this.current&&this.sortInstanceNodePosition&&this.type===e.type?this.sortInstanceNodePosition(this.current,e.current):0}updateFeatures(){let e="animation";for(e in tl){const t=tl[e];if(!t)continue;const{isEnabled:a,Feature:s}=t;if(!this.features[e]&&s&&a(this.props)&&(this.features[e]=new s(this)),this.features[e]){const t=this.features[e];t.isMounted?t.update():(t.mount(),t.isMounted=!0)}}}triggerBuild(){this.build(this.renderState,this.latestValues,this.props)}measureViewportBox(){return this.current?this.measureInstanceViewportBox(this.current,this.props):{x:{min:0,max:0},y:{min:0,max:0}}}getStaticValue(e){return this.latestValues[e]}setStaticValue(e,t){this.latestValues[e]=t}update(e,t){(e.transformTemplate||this.props.transformTemplate)&&this.scheduleRender(),this.prevProps=this.props,this.props=e,this.prevPresenceContext=this.presenceContext,this.presenceContext=t;for(let a=0;a<zm.length;a++){const t=zm[a];this.propEventSubscriptions[t]&&(this.propEventSubscriptions[t](),delete this.propEventSubscriptions[t]);const s=e["on"+t];s&&(this.propEventSubscriptions[t]=this.on(t,s))}this.prevMotionValues=function(e,t,a){for(const s in t){const r=t[s],n=a[s];if(Bo(r))e.addValue(s,r);else if(Bo(n))e.addValue(s,Eo(r,{owner:e}));else if(n!==r)if(e.hasValue(s)){const t=e.getValue(s);!0===t.liveStyle?t.jump(r):t.hasAnimated||t.set(r)}else{const t=e.getStaticValue(s);e.addValue(s,Eo(void 0!==t?t:r,{owner:e}))}}for(const s in a)void 0===t[s]&&e.removeValue(s);return t}(this,this.scrapeMotionValuesFromProps(e,this.prevProps,this),this.prevMotionValues),this.handleChildMotionValue&&this.handleChildMotionValue()}getProps(){return this.props}getVariant(e){return this.props.variants?this.props.variants[e]:void 0}getDefaultTransition(){return this.props.transition}getTransformPagePoint(){return this.props.transformPagePoint}getClosestVariantNode(){return this.isVariantNode?this:this.parent?this.parent.getClosestVariantNode():void 0}addVariantChild(e){const t=this.getClosestVariantNode();if(t)return t.variantChildren&&t.variantChildren.add(e),()=>t.variantChildren.delete(e)}addValue(e,t){const a=this.values.get(e);t!==a&&(a&&this.removeValue(e),this.bindToMotionValue(e,t),this.values.set(e,t),this.latestValues[e]=t.get())}removeValue(e){this.values.delete(e);const t=this.valueSubscriptions.get(e);t&&(t(),this.valueSubscriptions.delete(e)),delete this.latestValues[e],this.removeValueFromRenderState(e,this.renderState)}hasValue(e){return this.values.has(e)}getValue(e,t){if(this.props.values&&this.props.values[e])return this.props.values[e];let a=this.values.get(e);return void 0===a&&void 0!==t&&(a=Eo(null===t?void 0:t,{owner:this}),this.addValue(e,a)),a}readValue(e,t){let a=void 0===this.latestValues[e]&&this.current?this.getBaseTargetFromProps(this.props,e)??this.readValueFromInstance(this.current,e,this.options):this.latestValues[e];return null!=a&&("string"==typeof a&&(ar(a)||rr(a))?a=parseFloat(a):!(e=>Uo.find(mo(e)))(a)&&jn.test(t)&&(a=No(e,t)),this.setBaseTarget(e,Bo(a)?a.get():a)),Bo(a)?a.get():a}setBaseTarget(e,t){this.baseTarget[e]=t}getBaseTarget(e){const{initial:t}=this.props;let a;if("string"==typeof t||"object"==typeof t){const s=Hl(this.props,t,this.presenceContext?.custom);s&&(a=s[e])}if(t&&void 0!==a)return a;const s=this.getBaseTargetFromProps(this.props,e);return void 0===s||Bo(s)?void 0!==this.initialValues[e]&&void 0===a?void 0:this.baseTarget[e]:s}on(e,t){return this.events[e]||(this.events[e]=new dr),this.events[e].add(t)}notify(e,...t){this.events[e]&&this.events[e].notify(...t)}}class Gm extends Hm{constructor(){super(...arguments),this.KeyframeResolver=wo}sortInstanceNodePosition(e,t){return 2&e.compareDocumentPosition(t)?1:-1}getBaseTargetFromProps(e,t){return e.style?e.style[t]:void 0}removeValueFromRenderState(e,{vars:t,style:a}){delete t[e],delete a[e]}handleChildMotionValue(){this.childSubscription&&(this.childSubscription(),delete this.childSubscription);const{children:e}=this.props;Bo(e)&&(this.childSubscription=e.on("change",(e=>{this.current&&(this.current.textContent=`${e}`)})))}}function Xm(e,{style:t,vars:a},s,r){Object.assign(e.style,t,r&&r.getProjectionStyles(s));for(const n in a)e.style.setProperty(n,a[n])}class Wm extends Gm{constructor(){super(...arguments),this.type="html",this.renderInstance=Xm}readValueFromInstance(e,t){if(Pi.has(t))return this.projection?.isProjecting?Si(t):((e,t)=>{const{transform:a="none"}=getComputedStyle(e);return Ei(a,t)})(e,t);{const s=(a=e,window.getComputedStyle(a)),r=(Br(t)?s.getPropertyValue(t):s[t])||0;return"string"==typeof r?r.trim():r}var a}measureInstanceViewportBox(e,{transformPagePoint:t}){return td(e,t)}build(e,t,a){Pl(e,t,a.transformTemplate)}scrapeMotionValuesFromProps(e,t,a){return Yl(e,t,a)}}const Ym=new Set(["baseFrequency","diffuseConstant","kernelMatrix","kernelUnitLength","keySplines","keyTimes","limitingConeAngle","markerHeight","markerWidth","numOctaves","targetX","targetY","surfaceScale","specularConstant","specularExponent","stdDeviation","tableValues","viewBox","gradientTransform","pathLength","startOffset","textLength","lengthAdjust"]);class Km extends Gm{constructor(){super(...arguments),this.type="svg",this.isSVGTag=!1,this.measureInstanceViewportBox=Fc}getBaseTargetFromProps(e,t){return e[t]}readValueFromInstance(e,t){if(Pi.has(t)){const e=jo(t);return e&&e.default||0}return t=Ym.has(t)?t:vl(t),e.getAttribute(t)}scrapeMotionValuesFromProps(e,t,a){return Jl(e,t,a)}build(e,t,a){Rl(e,t,this.isSVGTag,a.transformTemplate,a.style)}renderInstance(e,t,a,s){!function(e,t,a,s){Xm(e,t,void 0,s);for(const r in t.attrs)e.setAttribute(Ym.has(r)?r:vl(r),t.attrs[r])}(e,t,0,s)}mount(e){this.isSVGTag=Fl(e.tagName),super.mount(e)}}const Jm=il(Zl({...kc,...Fm,...Pm,...Vm},((t,a)=>Bl(t)?new Km(a):new Wm(a,{allowProjection:t!==e.Fragment}))));function Qm({children:e,className:a,...s}){return t.jsx(Jm.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.3},className:Ga("relative overflow-hidden rounded-2xl border bg-card p-8 shadow-xl",'before:absolute before:-left-80 before:-top-80 before:h-[500px] before:w-[500px] before:rounded-full before:bg-primary/20 before:blur-3xl before:content-[""]','after:absolute after:-right-80 after:-top-80 after:h-[500px] after:w-[500px] after:rounded-full after:bg-secondary/20 after:blur-3xl after:content-[""]',a),...s,children:e})}const Zm=l("/_public/auth")({component:function(){const[a,s]=e.useState(!0),{signInWithEmail:n,signUpWithEmail:i,loading:o,isAuthenticated:l}=Oa(),c=r(),{auth:d}=Zm.useSearch();e.useEffect((()=>{if(l){let t="/game";if(d&&"string"==typeof d&&""!==d.trim()&&"true"!==d)try{const e=decodeURIComponent(d);e&&e.startsWith("/")&&!e.includes("[object")&&!e.startsWith("/auth")&&(t=e)}catch(e){t="/game"}c({to:t})}}),[l,d,c]);return t.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gradient-to-b from-background via-background/95 to-background/90 transition-colors duration-300",children:t.jsx(Qm,{className:"w-full max-w-md",children:t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"space-y-2",children:[t.jsx("h1",{className:"text-2xl font-semibold tracking-tight",children:a?"Login":"Criar Conta"}),t.jsx("p",{className:"text-sm text-muted-foreground",children:a?"Entre com suas credenciais para acessar o sistema":"Preencha os dados abaixo para criar sua conta"})]}),a?t.jsx(Hs,{onSubmit:async e=>{try{const t=await n(e);t.success||_.error("Erro ao fazer login",{description:t.error||"Ocorreu um erro inesperado"})}catch(t){_.error("Erro ao fazer login",{description:t instanceof Error?t.message:"Ocorreu um erro inesperado"})}},isLoading:o.signIn}):t.jsx(Gs,{onSubmit:async e=>{try{const t={email:e.email,password:e.password,username:e.email.split("@")[0]},a=await i(t);a.success||a.error&&a.error.includes("Email rate limit")?(_.success("Conta criada com sucesso",{description:"Por favor, verifique seu e-mail para confirmar sua conta."}),c({to:"/auth/verify-email",search:{auth:"true"}})):_.error("Erro ao criar conta",{description:a.error||"Ocorreu um erro inesperado"})}catch(t){_.error("Erro ao criar conta",{description:t instanceof Error?t.message:"Ocorreu um erro inesperado"})}},isLoading:o.signUp}),t.jsx(Wa,{type:"button",variant:"ghost",className:"w-full",onClick:()=>s(!a),disabled:o.signIn||o.signUp,children:a?"Não tem uma conta? Criar conta":"Já tem uma conta? Fazer login"})]})})})},validateSearch:e=>({auth:e.auth||""})});const eu=new class{async getUserProfile(){try{const{data:{user:e},error:t}=await Aa.auth.getUser();if(t)throw t;if(!e)return{data:null,error:"Usuário não autenticado"};const{data:a,error:s}=await Aa.from("users").select("*").eq("uid",e.id).maybeSingle();if(s)throw s;return{data:a,error:null}}catch(e){return{data:null,error:e instanceof Error?e.message:"Erro ao buscar perfil"}}}async searchUsers(e){try{let t=Aa.from("users").select("id",{count:"exact"});e.nome&&(t=t.ilike("nome",`%${e.nome}%`)),e.email&&(t=t.ilike("email",`%${e.email}%`)),e.role&&(t=t.eq("role",e.role)),void 0!==e.ativo&&(t=t.eq("ativo",e.ativo));const{count:a,error:s}=await t;if(s)throw s;let r=Aa.from("users").select("*").order("created_at",{ascending:!1});e.nome&&(r=r.ilike("nome",`%${e.nome}%`)),e.email&&(r=r.ilike("email",`%${e.email}%`)),e.role&&(r=r.eq("role",e.role)),void 0!==e.ativo&&(r=r.eq("ativo",e.ativo));const{data:n,error:i}=await r.range((e.page-1)*e.limit,e.page*e.limit-1);if(i)throw i;return{data:n,count:a||0,error:null}}catch(t){return{data:null,count:0,error:t instanceof Error?t.message:"Erro ao buscar usuários"}}}async updateUser(e,t){try{let a;if(t.imagemPerfil){const s=t.imagemPerfil.name.split(".").pop(),r=`${e}-${Date.now()}.${s}`,{error:n}=await Aa.storage.from("profile-images").upload(r,t.imagemPerfil,{cacheControl:"3600",upsert:!0});if(n)throw n;const{data:{publicUrl:i}}=Aa.storage.from("profile-images").getPublicUrl(r);a=i,delete t.imagemPerfil}const{error:s}=await Aa.from("users").update({...t,...a&&{imagem_perfil_url:a},updated_at:(new Date).toISOString()}).eq("uid",e);if(s)throw s;return{error:null}}catch(a){return{error:a instanceof Error?a.message:"Erro ao atualizar usuário"}}}};const tu=e.forwardRef((({className:e,...a},s)=>t.jsx("div",{className:"relative w-full overflow-auto",children:t.jsx("table",{ref:s,className:Ga("w-full caption-bottom text-sm",e),...a})})));tu.displayName="Table";const au=e.forwardRef((({className:e,...a},s)=>t.jsx("thead",{ref:s,className:Ga("[&_tr]:border-b",e),...a})));au.displayName="TableHeader";const su=e.forwardRef((({className:e,...a},s)=>t.jsx("tbody",{ref:s,className:Ga("[&_tr:last-child]:border-0",e),...a})));su.displayName="TableBody";e.forwardRef((({className:e,...a},s)=>t.jsx("tfoot",{ref:s,className:Ga("border-t bg-muted/50 font-medium [&>tr]:last:border-b-0",e),...a}))).displayName="TableFooter";const ru=e.forwardRef((({className:e,...a},s)=>t.jsx("tr",{ref:s,className:Ga("border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted",e),...a})));ru.displayName="TableRow";const nu=e.forwardRef((({className:e,...a},s)=>t.jsx("th",{ref:s,className:Ga("h-10 px-2 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",e),...a})));nu.displayName="TableHead";const iu=e.forwardRef((({className:e,...a},s)=>t.jsx("td",{ref:s,className:Ga("p-2 align-middle [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",e),...a})));iu.displayName="TableCell";e.forwardRef((({className:e,...a},s)=>t.jsx("caption",{ref:s,className:Ga("mt-4 text-sm text-muted-foreground",e),...a}))).displayName="TableCaption";const ou=ye,lu=je,cu=e.forwardRef((({className:e,children:a,...s},r)=>t.jsxs(ne,{ref:r,className:Ga("flex h-9 w-full items-center justify-between whitespace-nowrap rounded-md border border-input bg-transparent px-3 py-2 text-sm shadow-sm ring-offset-background data-[placeholder]:text-muted-foreground focus:outline-none focus:ring-1 focus:ring-ring disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",e),...s,children:[a,t.jsx(ie,{asChild:!0,children:t.jsx(oe,{className:"h-4 w-4 opacity-50"})})]})));cu.displayName=ne.displayName;const du=e.forwardRef((({className:e,...a},s)=>t.jsx(le,{ref:s,className:Ga("flex cursor-default items-center justify-center py-1",e),...a,children:t.jsx(ce,{className:"h-4 w-4"})})));du.displayName=le.displayName;const mu=e.forwardRef((({className:e,...a},s)=>t.jsx(de,{ref:s,className:Ga("flex cursor-default items-center justify-center py-1",e),...a,children:t.jsx(oe,{className:"h-4 w-4"})})));mu.displayName=de.displayName;const uu=e.forwardRef((({className:e,children:a,position:s="popper",...r},n)=>t.jsx(me,{children:t.jsxs(ue,{ref:n,className:Ga("relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2","popper"===s&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",e),position:s,...r,children:[t.jsx(du,{}),t.jsx(he,{className:Ga("p-1","popper"===s&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:a}),t.jsx(mu,{})]})})));uu.displayName=ue.displayName;e.forwardRef((({className:e,...a},s)=>t.jsx(pe,{ref:s,className:Ga("px-2 py-1.5 text-sm font-semibold",e),...a}))).displayName=pe.displayName;const hu=e.forwardRef((({className:e,children:a,...s},r)=>t.jsxs(xe,{ref:r,className:Ga("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-2 pr-8 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",e),...s,children:[t.jsx("span",{className:"absolute right-2 flex h-3.5 w-3.5 items-center justify-center",children:t.jsx(fe,{children:t.jsx(ge,{className:"h-4 w-4"})})}),t.jsx(be,{children:a})]})));hu.displayName=xe.displayName;e.forwardRef((({className:e,...a},s)=>t.jsx(ve,{ref:s,className:Ga("-mx-1 my-1 h-px bg-muted",e),...a}))).displayName=ve.displayName;const pu=e.forwardRef((({className:e,...a},s)=>t.jsx("div",{ref:s,className:Ga("w-full max-w-full overflow-hidden rounded-xl border bg-card text-card-foreground shadow",e),...a})));pu.displayName="Card";const xu=e.forwardRef((({className:e,...a},s)=>t.jsx("div",{ref:s,className:Ga("flex flex-col space-y-1.5 p-4 sm:p-6",e),...a})));xu.displayName="CardHeader";const fu=e.forwardRef((({className:e,...a},s)=>t.jsx("div",{ref:s,className:Ga("break-words font-semibold leading-none tracking-tight",e),...a})));fu.displayName="CardTitle";const gu=e.forwardRef((({className:e,...a},s)=>t.jsx("div",{ref:s,className:Ga("break-words text-sm text-muted-foreground",e),...a})));gu.displayName="CardDescription";const bu=e.forwardRef((({className:e,...a},s)=>t.jsx("div",{ref:s,className:Ga("w-full p-4 sm:p-6",e),...a})));bu.displayName="CardContent";const vu=e.forwardRef((({className:e,...a},s)=>t.jsx("div",{ref:s,className:Ga("flex flex-wrap items-center gap-2 p-4 pt-0 sm:p-6 sm:pt-0",e),...a})));function yu({children:a}){const s=r(),{user:n,loading:i}=Oa();return e.useEffect((()=>{!i.onAuthUserChanged&&n&&"ADMIN"!==n.role&&(_.error("Você não tem permissão para acessar esta página"),s({to:"/403"}))}),[n,i.onAuthUserChanged,s]),i.onAuthUserChanged||!n?t.jsx(Ba,{}):"ADMIN"!==n.role?t.jsx(t.Fragment,{}):a}vu.displayName="CardFooter";const ju=I("inline-flex items-center rounded-md border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground shadow hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground shadow hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function Nu({className:e,variant:a,...s}){return t.jsx("div",{className:Ga(ju({variant:a}),e),...s})}const _u={ADMIN:"Administrador",PLAYER:"Jogador"},wu=l("/_authenticated/users")({component:function(){const a=r(),{users:s,loading:n,searchUsers:i}=function(){const[t,a]=e.useState(!1),[s,r]=e.useState(null),[n,i]=e.useState(null),[o,l]=e.useState([]);return{user:n,users:o,loading:t,error:s,getUserProfile:e.useCallback((async()=>{try{a(!0),r(null);const{data:e,error:t}=await eu.getUserProfile();if(t)throw new Error(t);return e&&i(e),e}catch(e){const t=e instanceof Error?e.message:"Erro ao buscar perfil";return r(t),null}finally{a(!1)}}),[]),searchUsers:e.useCallback((async e=>{try{a(!0),r(null);const{data:t,error:s}=await eu.searchUsers(e);if(s)throw new Error(s);t&&l(t)}catch(t){const e=t instanceof Error?t.message:"Erro ao buscar usuários";r(e)}finally{a(!1)}}),[])}}(),[o,l]=e.useState({page:1,limit:10});e.useEffect((()=>{i(o)}),[o,i]);const c=e=>{switch(e){case"ADMIN":return"bg-red-500";case"PLAYER":return"bg-blue-500";default:return"bg-gray-500"}};return t.jsx(yu,{children:t.jsx("div",{className:"container mx-auto py-8",children:t.jsxs(pu,{children:[t.jsx(xu,{children:t.jsx("div",{className:"flex items-center justify-between",children:t.jsx(fu,{children:"Usuários"})})}),t.jsxs(bu,{children:[t.jsxs("div",{className:"mb-6 grid grid-cols-1 gap-4 md:grid-cols-3",children:[t.jsx(Ms,{placeholder:"Nome",value:o.nome||"",onChange:e=>l({...o,nome:e.target.value})}),t.jsx(Ms,{placeholder:"Email",value:o.email||"",onChange:e=>l({...o,email:e.target.value})}),t.jsxs(ou,{value:o.role,onValueChange:e=>l({...o,role:e}),children:[t.jsx(cu,{children:t.jsx(lu,{placeholder:"Tipo de Usuário"})}),t.jsxs(uu,{children:[t.jsx(hu,{value:"ADMIN",children:"Administrador"}),t.jsx(hu,{value:"PLAYER",children:"Jogador"})]})]})]}),t.jsx("div",{className:"rounded-md border",children:t.jsxs(tu,{children:[t.jsx(au,{children:t.jsxs(ru,{children:[t.jsx(nu,{children:"Nome"}),t.jsx(nu,{children:"Email"}),t.jsx(nu,{children:"Tipo"}),t.jsx(nu,{children:"Maior Andar"}),t.jsx(nu,{children:"Total de Jogos"}),t.jsx(nu,{children:"Vitórias"}),t.jsx(nu,{children:"Ações"})]})}),t.jsx(su,{children:n?t.jsx(ru,{children:t.jsx(iu,{colSpan:7,className:"text-center",children:"Carregando..."})}):0===s.length?t.jsx(ru,{children:t.jsx(iu,{colSpan:7,className:"text-center",children:"Nenhum usuário encontrado"})}):s.map((e=>t.jsxs(ru,{children:[t.jsx(iu,{children:e.nome}),t.jsx(iu,{children:e.email}),t.jsx(iu,{children:t.jsx(Nu,{className:c(e.role),children:_u[e.role]})}),t.jsx(iu,{children:e.highest_floor}),t.jsx(iu,{children:e.total_games}),t.jsx(iu,{children:e.total_victories}),t.jsx(iu,{children:t.jsx(Wa,{variant:"ghost",onClick:()=>a({to:`/users/${e.id}`}),children:"Visualizar"})})]},e.id)))})]})})]})]})})})}});var Cu=d();function Su(){return()=>{}}var Eu="Avatar",[ku,Au]=Ne(Eu),[Pu,Mu]=ku(Eu),Tu=e.forwardRef(((a,s)=>{const{__scopeAvatar:r,...n}=a,[i,o]=e.useState("idle");return t.jsx(Pu,{scope:r,imageLoadingStatus:i,onImageLoadingStatusChange:o,children:t.jsx(re.span,{...n,ref:s})})}));Tu.displayName=Eu;var qu="AvatarImage",Du=e.forwardRef(((a,s)=>{const{__scopeAvatar:r,src:n,onLoadingStatusChange:i=()=>{},...o}=a,l=Mu(qu,r),c=function(t,{referrerPolicy:a,crossOrigin:s}){const r=Cu.useSyncExternalStore(Su,(()=>!0),(()=>!1)),n=e.useRef(null),i=r?(n.current||(n.current=new window.Image),n.current):null,[o,l]=e.useState((()=>Ru(i,t)));return we((()=>{l(Ru(i,t))}),[i,t]),we((()=>{const e=e=>()=>{l(e)};if(!i)return;const t=e("loaded"),r=e("error");return i.addEventListener("load",t),i.addEventListener("error",r),a&&(i.referrerPolicy=a),"string"==typeof s&&(i.crossOrigin=s),()=>{i.removeEventListener("load",t),i.removeEventListener("error",r)}}),[i,s,a]),o}(n,o),d=_e((e=>{i(e),l.onImageLoadingStatusChange(e)}));return we((()=>{"idle"!==c&&d(c)}),[c,d]),"loaded"===c?t.jsx(re.img,{...o,ref:s,src:n}):null}));Du.displayName=qu;var Lu="AvatarFallback",$u=e.forwardRef(((a,s)=>{const{__scopeAvatar:r,delayMs:n,...i}=a,o=Mu(Lu,r),[l,c]=e.useState(void 0===n);return e.useEffect((()=>{if(void 0!==n){const e=window.setTimeout((()=>c(!0)),n);return()=>window.clearTimeout(e)}}),[n]),l&&"loaded"!==o.imageLoadingStatus?t.jsx(re.span,{...i,ref:s}):null}));function Ru(e,t){return e?t?(e.src!==t&&(e.src=t),e.complete&&e.naturalWidth>0?"loaded":"loading"):"error":"idle"}$u.displayName=Lu;var Iu=Tu,Fu=Du,Vu=$u;const Ou=e.forwardRef((({className:e,...a},s)=>t.jsx(Iu,{ref:s,className:Ga("relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full",e),...a})));Ou.displayName=Iu.displayName;const Bu=e.forwardRef((({className:e,...a},s)=>t.jsx(Fu,{ref:s,className:Ga("aspect-square h-full w-full",e),...a})));Bu.displayName=Fu.displayName;const Uu=e.forwardRef((({className:e,...a},s)=>t.jsx(Vu,{ref:s,className:Ga("flex h-full w-full items-center justify-center rounded-full bg-muted",e),...a})));function zu(){const{isInstalled:a,canInstall:s}=es(),[r,n]=e.useState(!0),[i,o]=e.useState(!1);e.useEffect((()=>{const e=()=>n(navigator.onLine);window.addEventListener("online",e),window.addEventListener("offline",e);return(()=>{const e=window.matchMedia("(display-mode: standalone)").matches,t=window.matchMedia("(display-mode: fullscreen)").matches;o(e||t)})(),()=>{window.removeEventListener("online",e),window.removeEventListener("offline",e)}}),[]);const l=[{name:"Modo Offline",status:"serviceWorker"in navigator,icon:r?Se:Ee,description:r?"Online":"Offline"},{name:"PWA Instalado",status:a,icon:a?ke:O,description:a?"Instalado":s?"Disponível":"Não disponível"},{name:"Modo Tela Cheia",status:i,icon:Ce,description:i?"Ativo":"Navegador"},{name:"Service Worker",status:"serviceWorker"in navigator,icon:"serviceWorker"in navigator?ke:Ae,description:"serviceWorker"in navigator?"Suportado":"Não suportado"}];return t.jsxs(pu,{className:"w-full max-w-md",children:[t.jsx(xu,{children:t.jsxs(fu,{className:"flex items-center gap-2",children:[t.jsx(Ce,{className:"h-5 w-5"}),"Status PWA"]})}),t.jsxs(bu,{className:"space-y-3",children:[l.map((e=>{const a=e.icon;return t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(a,{className:"h-4 w-4 "+(e.status?"text-green-500":"text-red-500")}),t.jsx("span",{className:"text-sm font-medium",children:e.name})]}),t.jsx(Nu,{variant:e.status?"default":"secondary",children:e.description})]},e.name)})),!r&&t.jsx("div",{className:"mt-4 p-3 bg-orange-50 dark:bg-orange-950 border border-orange-200 dark:border-orange-800 rounded-md",children:t.jsx("p",{className:"text-sm text-orange-800 dark:text-orange-200",children:"🌐 Você está offline! O jogo ainda pode funcionar com recursos em cache."})})]})]})}Uu.displayName=Vu.displayName;const Hu=b({nome:v().min(3,"Nome deve ter no mínimo 3 caracteres"),tipo_pessoa:M(["PF","PJ"]),documento:v().optional(),telefone:v().optional(),data_nascimento:v().optional()}),Gu=l("/_authenticated/profile")({component:function(){const{user:a}=Oa(),s=r(),[n,i]=e.useState(null),[o,l]=e.useState(!0),c=e.useRef(null),[d,m]=e.useState(null),u=P({resolver:Ps(Hu),defaultValues:{nome:"",tipo_pessoa:"PF"}});e.useEffect((()=>{(async()=>{try{l(!0);const{data:e,error:t}=await eu.getUserProfile();if(t)return void _.error("Erro",{description:t});e&&(i(e),u.reset({nome:e.nome,tipo_pessoa:e.tipo_pessoa,documento:e.documento,telefone:e.telefone,data_nascimento:e.data_nascimento}))}catch(e){_.error("Erro",{description:e instanceof Error?e.message:"Não foi possível carregar seu perfil"})}finally{l(!1)}})()}),[u]);if(o)return t.jsx("div",{className:"container mx-auto px-4 py-6",children:t.jsx(pu,{children:t.jsx(xu,{children:t.jsx(fu,{children:"Carregando..."})})})});return t.jsxs("div",{className:"container mx-auto px-4 py-6",children:[t.jsx("div",{className:"space-y-3 sm:space-y-4 mb-6",children:t.jsxs("div",{className:"flex flex-col gap-3",children:[t.jsxs(Wa,{variant:"outline",size:"sm",onClick:()=>s({to:"/game"}),className:"self-start",children:[t.jsx(Pe,{className:"h-4 w-4 mr-2"}),t.jsx("span",{className:"hidden sm:inline",children:"Voltar ao Menu"}),t.jsx("span",{className:"sm:hidden",children:"Voltar"})]}),t.jsxs("div",{children:[t.jsx("h1",{className:"text-2xl sm:text-3xl font-bold",children:"Perfil"}),t.jsx("p",{className:"text-sm sm:text-base text-muted-foreground",children:"Gerencie suas informações pessoais"})]})]})}),t.jsxs("div",{className:"grid gap-6",children:[t.jsxs(pu,{children:[t.jsxs(xu,{children:[t.jsx(fu,{children:"Foto de Perfil"}),t.jsx(gu,{children:"Atualize sua foto de perfil"})]}),t.jsx(bu,{children:t.jsxs("div",{className:"flex items-center gap-4",children:[t.jsxs(Ou,{className:"h-24 w-24",children:[t.jsx(Bu,{src:n?.imagem_perfil_url}),t.jsx(Uu,{children:n?.nome?.charAt(0)})]}),t.jsx(Ms,{type:"file",ref:c,accept:"image/*",onChange:e=>{const t=e.target.files?.[0];t&&m(t)},className:"max-w-xs"})]})})]}),t.jsxs(pu,{children:[t.jsxs(xu,{children:[t.jsx(fu,{children:"Informações Pessoais"}),t.jsx(gu,{children:"Atualize suas informações pessoais"})]}),t.jsx(bu,{children:t.jsx($s,{...u,children:t.jsxs("form",{onSubmit:u.handleSubmit((async e=>{if(a?.id&&n)try{const{error:t}=await eu.updateUser(a.id,{...e,data_nascimento:e.data_nascimento?new Date(e.data_nascimento):void 0,imagemPerfil:d||void 0});if(t)throw new Error(t);const{data:s,error:r}=await eu.getUserProfile();if(r)throw new Error(r);s&&i(s),_.success("Sucesso",{description:"Perfil atualizado com sucesso!"}),m(null)}catch(t){_.error("Erro",{description:t instanceof Error?t.message:"Erro ao atualizar perfil"})}})),className:"space-y-4",children:[t.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[t.jsx(Is,{control:u.control,name:"nome",render:({field:e})=>t.jsxs(Os,{children:[t.jsx(Bs,{children:"Nome *"}),t.jsx(Us,{children:t.jsx(Ms,{...e})}),t.jsx(zs,{})]})}),t.jsx(Is,{control:u.control,name:"tipo_pessoa",render:({field:e})=>t.jsxs(Os,{children:[t.jsx(Bs,{children:"Tipo de Pessoa *"}),t.jsxs(ou,{onValueChange:e.onChange,defaultValue:e.value,children:[t.jsx(Us,{children:t.jsx(cu,{children:t.jsx(lu,{placeholder:"Selecione o tipo de pessoa"})})}),t.jsxs(uu,{children:[t.jsx(hu,{value:"PF",children:"Pessoa Física"}),t.jsx(hu,{value:"PJ",children:"Pessoa Jurídica"})]})]}),t.jsx(zs,{})]})}),t.jsx(Is,{control:u.control,name:"documento",render:({field:e})=>t.jsxs(Os,{children:[t.jsx(Bs,{children:"PF"===u.watch("tipo_pessoa")?"CPF":"CNPJ"}),t.jsx(Us,{children:t.jsx(Ms,{...e,value:e.value||""})}),t.jsx(zs,{})]})}),t.jsx(Is,{control:u.control,name:"telefone",render:({field:e})=>t.jsxs(Os,{children:[t.jsx(Bs,{children:"Telefone"}),t.jsx(Us,{children:t.jsx(Ms,{...e,value:e.value||""})}),t.jsx(zs,{})]})}),t.jsx(Is,{control:u.control,name:"data_nascimento",render:({field:e})=>t.jsxs(Os,{children:[t.jsx(Bs,{children:"Data de Nascimento"}),t.jsx(Us,{children:t.jsx(Ms,{type:"date",...e,value:e.value||""})}),t.jsx(zs,{})]})})]}),t.jsx("div",{className:"flex justify-end",children:t.jsx(Wa,{type:"submit",children:"Salvar"})})]})})})]}),t.jsx(zu,{})]})]})}});function Xu(){return t.jsxs(pu,{className:"w-full max-w-md",children:[t.jsx(xu,{children:t.jsxs(fu,{className:"flex items-center gap-2",children:[t.jsx(Me,{className:"h-5 w-5 text-primary"}),"Sobre Tower Trials"]})}),t.jsxs(bu,{className:"space-y-4",children:[t.jsx("p",{className:"text-sm text-muted-foreground",children:"Um jogo de aventura em que você sobe uma torre mágica, enfrentando inimigos cada vez mais fortes em cada andar. Quanto mais alto você chegar, melhor será sua posição no ranking."}),t.jsxs("div",{className:"grid grid-cols-1 gap-3 mt-4",children:[t.jsxs("div",{className:"flex items-start gap-3 p-3 bg-muted/50 rounded-md",children:[t.jsx("div",{className:"mt-1",children:t.jsx(Te,{className:"h-5 w-5 text-primary"})}),t.jsxs("div",{children:[t.jsx("h3",{className:"font-medium mb-1",children:"Progressão na Torre"}),t.jsx("p",{className:"text-sm text-muted-foreground",children:"Cada andar apresenta um inimigo mais forte. A dificuldade aumenta conforme você sobe, mas você recupera um pouco de HP a cada inimigo derrotado."})]})]}),t.jsxs("div",{className:"flex items-start gap-3 p-3 bg-muted/50 rounded-md",children:[t.jsx("div",{className:"mt-1",children:t.jsx(qe,{className:"h-5 w-5 text-primary"})}),t.jsxs("div",{children:[t.jsx("h3",{className:"font-medium mb-1",children:"Ataque"}),t.jsx("p",{className:"text-sm text-muted-foreground",children:"Ataque direto ao inimigo, causando dano baseado no seu valor de ataque menos a defesa do inimigo."})]})]}),t.jsxs("div",{className:"flex items-start gap-3 p-3 bg-muted/50 rounded-md",children:[t.jsx("div",{className:"mt-1",children:t.jsx(De,{className:"h-5 w-5 text-primary"})}),t.jsxs("div",{children:[t.jsx("h3",{className:"font-medium mb-1",children:"Defesa"}),t.jsx("p",{className:"text-sm text-muted-foreground",children:"Aumenta temporariamente sua defesa, reduzindo o dano recebido no próximo ataque do inimigo."})]})]}),t.jsxs("div",{className:"flex items-start gap-3 p-3 bg-muted/50 rounded-md",children:[t.jsx("div",{className:"mt-1",children:t.jsx(Le,{className:"h-5 w-5 text-primary"})}),t.jsxs("div",{children:[t.jsx("h3",{className:"font-medium mb-1",children:"Habilidade Especial"}),t.jsx("p",{className:"text-sm text-muted-foreground",children:"Causa o dobro do seu dano de ataque, mas tem um cooldown de 3 turnos antes de poder ser usada novamente."})]})]})]})]})]})}const Wu=l("/_authenticated/game")({component:function(){if("/game"===n().pathname)return t.jsx(Yu,{});return t.jsx(s,{})}});function Yu(){const a=r(),{user:s}=Oa(),[n,i]=e.useState(!1);return t.jsxs("div",{className:"min-h-screen flex flex-col items-center justify-center bg-gradient-to-b from-background to-secondary p-4",children:[t.jsxs("div",{className:"w-full max-w-md text-center mb-8",children:[t.jsx("h1",{className:"text-4xl font-bold text-primary mb-2",children:"Tower Trials"}),t.jsx("p",{className:"text-foreground/80",children:"Suba a torre mágica, derrote inimigos e alcance o andar mais alto possível!"})]}),n?t.jsxs("div",{className:"w-full max-w-md mb-4",children:[t.jsx("div",{className:"flex justify-end mb-2",children:t.jsx(Wa,{variant:"ghost",size:"sm",className:"p-1 h-8 w-8",onClick:()=>i(!1),children:t.jsx(G,{className:"h-5 w-5"})})}),t.jsx(Xu,{})]}):t.jsxs(pu,{className:"w-full max-w-md mb-4",children:[t.jsx(xu,{children:t.jsx(fu,{className:"text-center",children:"Menu Principal"})}),t.jsxs(bu,{className:"space-y-4",children:[t.jsx(Wa,{onClick:()=>{a(s?{to:"/game/play"}:{to:"/auth",search:{auth:"true"}})},className:"w-full py-6 text-lg cursor-pointer",size:"lg",children:s?"Jogar":"Entrar para Jogar"}),t.jsx(Wa,{onClick:()=>{a({to:"/game/ranking"})},className:"w-full py-6 text-lg cursor-pointer",variant:"outline",size:"lg",children:"Ranking"}),s&&t.jsxs(Wa,{onClick:()=>{a({to:"/game/play/hub/cemetery",search:{character:""}})},className:"w-full py-4 text-base border border-red-500/20 bg-red-500/5 hover:bg-red-500/10 text-red-400 hover:text-red-300 cursor-pointer",variant:"ghost",size:"lg",children:[t.jsx($e,{className:"h-5 w-5 mr-2"}),"Cemitério"]})]}),t.jsxs(vu,{className:"flex justify-between",children:[t.jsxs(Wa,{variant:"ghost",size:"sm",className:"flex items-center gap-1 cursor-pointer",onClick:()=>i(!0),children:[t.jsx(Re,{className:"h-4 w-4"}),t.jsx("span",{children:"Como Jogar"})]}),s?t.jsxs("div",{className:"text-sm text-muted-foreground",children:[t.jsx("span",{className:"font-medium",children:s.username||s.email})," |",t.jsx(o,{to:"/logout",className:"text-primary ml-1 hover:underline",children:"Sair"})]}):t.jsx(o,{to:"/auth",search:{auth:"true"},children:t.jsx(Wa,{variant:"ghost",size:"sm",className:"cursor-pointer",children:"Entrar / Criar Conta"})})]})]})]})}const Ku=l("/_authenticated/403")({component:function(){return t.jsx("div",{className:"w-full h-full flex items-center justify-center",children:t.jsx("h1",{children:"A página que você tentou acessar não existe ou você não possui a permissão necessária."})})}});const Ju=l("/_public/auth/verify-email")({component:function(){const{user:e}=Oa();return t.jsx("div",{className:"container mx-auto flex min-h-screen items-center justify-center px-4",children:t.jsxs(pu,{className:"w-full max-w-md",children:[t.jsx(xu,{children:t.jsxs("div",{className:"flex items-center space-x-4",children:[t.jsx(Ie,{className:"h-8 w-8 text-primary"}),t.jsxs("div",{children:[t.jsx(fu,{children:"Verifique seu Email"}),t.jsx(gu,{children:"Enviamos um link de confirmação para seu email"})]})]})}),t.jsxs(bu,{className:"space-y-6",children:[t.jsxs("div",{className:"rounded-lg bg-muted p-4 text-sm",children:[t.jsxs("p",{className:"mb-2",children:["Olá ",t.jsx("span",{className:"font-semibold",children:e?.email}),","]}),t.jsx("p",{className:"mb-2",children:"Para sua segurança, enviamos um email de confirmação para o endereço fornecido."}),t.jsx("p",{children:"Por favor, siga estas etapas:"}),t.jsxs("ol",{className:"ml-4 mt-2 list-decimal space-y-1",children:[t.jsx("li",{children:"Verifique sua caixa de entrada"}),t.jsx("li",{children:"Clique no link de confirmação no email"}),t.jsx("li",{children:"Retorne aqui para fazer login"})]})]}),t.jsx("div",{className:"space-y-4 text-sm text-muted-foreground",children:t.jsx("p",{children:"Não recebeu o email? Verifique sua pasta de spam ou aguarde alguns minutos."})}),t.jsx("div",{className:"flex flex-col space-y-2",children:t.jsx(o,{to:"/auth",search:{auth:"true"},children:t.jsxs(Wa,{variant:"outline",className:"w-full",children:[t.jsx(Pe,{className:"mr-2 h-4 w-4"}),"Voltar para o Login"]})})})]})]})})},validateSearch:e=>({auth:e.auth||""})});class Qu{static rankingCache=new Map;static userStatsCache=new Map;static userRankingCache=new Map;static CACHE_DURATION=12e4;static USER_CACHE_DURATION=3e5;static isCacheValid(e,t){if(!e)return!1;return Date.now()-e.timestamp<t}static generateCacheKey(e,t,a,s,r){return`${e}-${t}-${a}-${s}-${r}`}static async saveScore(e){try{const t=e;if(!t||!t.user_id||!t.player_name)return{data:"",error:"Dados do ranking são obrigatórios"};const{data:a,error:s}=await Aa.rpc("save_ranking_entry",{p_user_id:t.user_id,p_player_name:t.player_name,p_highest_floor:t.floor,p_character_level:t.character_level||1,p_character_gold:t.character_gold||0,p_character_alive:t.character_alive??!0});if(s)throw s;return this.invalidateUserCaches(t.user_id),this.invalidateGlobalCaches(),{data:a,error:null}}catch(t){return{data:"",error:t instanceof Error?t.message:"Erro ao salvar no ranking"}}}static async getGlobalRanking(e="floor",t=10,a="all",s="",r=1){try{const n=this.generateCacheKey(e,t,a,s,r),i=this.rankingCache.get(n);if(this.isCacheValid(i,this.CACHE_DURATION))return{data:i.data,error:null};const o=(r-1)*t,l={floor:"get_dynamic_ranking_by_highest_floor",level:"get_dynamic_ranking_by_level",gold:"get_dynamic_ranking_by_gold"}[e],{data:c,error:d}=await Aa.rpc(l,{p_limit:t,p_status_filter:a,p_name_filter:s,p_offset:o});if(d)throw d;const m=c||[];return this.rankingCache.set(n,{data:m,timestamp:Date.now(),params:n}),{data:m,error:null}}catch(n){return{data:[],error:n instanceof Error?n.message:"Erro ao buscar ranking"}}}static async countRankingEntries(e="all",t=""){try{const{data:a,error:s}=await Aa.rpc("count_ranking_entries",{p_status_filter:e,p_name_filter:t});if(s)throw s;return{data:a||0,error:null}}catch(a){return{data:0,error:a instanceof Error?a.message:"Erro ao contar entradas"}}}static async getUserRanking(e,t=10){try{let a=e;if(!a){const e=await Ta.getCurrentUser();if(!e?.id)return{data:[],error:"Usuário não encontrado para buscar ranking"};a=e.id}const s=`user-${a}-${t}`,r=this.userRankingCache.get(s);if(this.isCacheValid(r,this.USER_CACHE_DURATION))return{data:r.data,error:null};const{data:n,error:i}=await Aa.rpc("get_dynamic_user_ranking_history",{p_user_id:a,p_limit:t});if(i)throw i;const o=n||[];return this.userRankingCache.set(s,{data:o,timestamp:Date.now(),params:s}),{data:o,error:null}}catch(a){return{data:[],error:a instanceof Error?a.message:"Erro ao buscar ranking do usuário"}}}static async getUserStats(e){try{let t=e;if(!t){const e=await Ta.getCurrentUser();if(!e?.id)return{data:{bestFloor:0,bestLevel:1,bestGold:0,totalRuns:0,aliveCharacters:0},error:"Usuário não encontrado para buscar estatísticas"};t=e.id}if(!t)return{data:{bestFloor:0,bestLevel:1,bestGold:0,totalRuns:0,aliveCharacters:0},error:"ID do usuário é obrigatório"};const a=this.userStatsCache.get(t);if(this.isCacheValid(a,this.USER_CACHE_DURATION)){const e=a.data;return{data:{bestFloor:e.best_floor,bestLevel:e.best_level,bestGold:e.best_gold,totalRuns:e.total_runs,aliveCharacters:e.alive_characters},error:null}}const{data:s,error:r}=await Aa.rpc("get_dynamic_user_stats",{p_user_id:t}).single();if(r)throw r;const n=s,i={bestFloor:n?.best_floor||0,bestLevel:n?.best_level||1,bestGold:n?.best_gold||0,totalRuns:n?.total_runs||0,aliveCharacters:n?.alive_characters||0};return n&&this.userStatsCache.set(t,{data:n,timestamp:Date.now(),params:t}),{data:i,error:null}}catch(t){return{data:{bestFloor:0,bestLevel:1,bestGold:0,totalRuns:0,aliveCharacters:0},error:t instanceof Error?t.message:"Erro ao buscar estatísticas"}}}static async testRankingSystem(e){try{const{data:t,error:a}=await Aa.rpc("test_ranking_system",{p_user_id:e||null});if(a)throw a;return{data:t||[],error:null}}catch(t){return{data:[],error:t instanceof Error?t.message:"Erro ao testar ranking"}}}static async syncAllRankings(){try{const{data:e,error:t}=await Aa.rpc("refresh_all_rankings");if(t)throw t;return this.clearAllCaches(),{data:e||"Sincronização concluída",error:null}}catch(e){return{data:"",error:e instanceof Error?e.message:"Erro ao sincronizar rankings"}}}static invalidateUserCaches(e){this.userStatsCache.delete(e);for(const[t]of this.userRankingCache)t.startsWith(`user-${e}-`)&&this.userRankingCache.delete(t)}static invalidateGlobalCaches(){this.rankingCache.clear()}static clearAllCaches(){this.rankingCache.clear(),this.userStatsCache.clear(),this.userRankingCache.clear()}static async getPlayerRankingPosition(e,t,a="floor"){if(!e||!t)return 0;try{const s=await this.getGlobalRanking(a,100);if(s.error||!s.data)return 0;const r=s.data.findIndex((a=>a.user_id===e&&a.player_name===t));return r>=0?r+1:0}catch(s){return 0}}}const Zu={ADMIN:"Administrador",PLAYER:"Jogador"},eh=l("/_authenticated/users/$id")({component:function(){const{id:a}=eh.useParams(),[s,r]=e.useState(null),[n,i]=e.useState([]),[o,l]=e.useState(!0),[c,d]=e.useState(null);if(e.useEffect((()=>{(async()=>{try{l(!0),d(null);const{data:e,error:t}=await eu.searchUsers({page:1,limit:1,email:a});if(t)return void d(`Erro ao buscar usuário: ${t}`);if(!e||0===e.length)return void d("Usuário não encontrado");const s=e[0];r(s);const{data:n}=await Qu.getUserRanking(s.uid);i(n||[])}catch(e){d("Erro ao carregar dados do usuário")}finally{l(!1)}})()}),[a]),o)return t.jsx("div",{children:"Carregando..."});if(c)return t.jsx("div",{className:"text-red-500",children:c});if(!s)return t.jsx("div",{children:"Usuário não encontrado"});return t.jsx(yu,{children:t.jsxs("div",{className:"container mx-auto py-8",children:[t.jsxs(pu,{className:"mb-8",children:[t.jsx(xu,{children:t.jsx(fu,{children:"Detalhes do Usuário"})}),t.jsx(bu,{children:t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsxs("div",{children:[t.jsx("p",{className:"text-sm font-medium",children:"Nome"}),t.jsx("p",{className:"text-lg",children:s.nome})]}),t.jsxs("div",{children:[t.jsx("p",{className:"text-sm font-medium",children:"Email"}),t.jsx("p",{className:"text-lg",children:s.email})]}),t.jsxs("div",{children:[t.jsx("p",{className:"text-sm font-medium",children:"Tipo"}),t.jsx(Nu,{className:"ADMIN"===s.role?"bg-red-500":"bg-blue-500",children:Zu[s.role]})]}),t.jsxs("div",{children:[t.jsx("p",{className:"text-sm font-medium",children:"Status"}),t.jsx(Nu,{variant:s.ativo?"default":"destructive",children:s.ativo?"Ativo":"Inativo"})]}),t.jsxs("div",{children:[t.jsx("p",{className:"text-sm font-medium",children:"Maior Andar Alcançado"}),t.jsx("p",{className:"text-lg",children:s.highest_floor})]}),t.jsxs("div",{children:[t.jsx("p",{className:"text-sm font-medium",children:"Total de Jogos"}),t.jsx("p",{className:"text-lg",children:s.total_games})]}),t.jsxs("div",{children:[t.jsx("p",{className:"text-sm font-medium",children:"Vitórias"}),t.jsx("p",{className:"text-lg",children:s.total_victories})]})]})})]}),t.jsxs(pu,{children:[t.jsx(xu,{children:t.jsx(fu,{children:"Histórico de Rankings"})}),t.jsx(bu,{children:t.jsx("div",{className:"rounded-md border",children:t.jsxs(tu,{children:[t.jsx(au,{children:t.jsxs(ru,{children:[t.jsx(nu,{children:"Andar Alcançado"}),t.jsx(nu,{children:"Data"})]})}),t.jsx(su,{children:0===n.length?t.jsx(ru,{children:t.jsx(iu,{colSpan:2,className:"text-center",children:"Nenhum ranking encontrado"})}):n.map((e=>t.jsxs(ru,{children:[t.jsx(iu,{children:e.highest_floor}),t.jsx(iu,{children:e.created_at?new Date(e.created_at).toLocaleDateString("pt-BR"):"-"})]},e.id)))})]})})})]})]})})}});const th=({activeMode:e,onModeChange:a,statusFilter:s,onStatusFilterChange:r,nameFilter:n,onNameFilterChange:i,currentPage:o,totalPages:l,onPageChange:c,isLoading:d=!1})=>{const m=[{key:"floor",label:"Andar Mais Alto",icon:ae,color:"text-yellow-500"},{key:"level",label:"Maior Nível",icon:Fe,color:"text-blue-500"},{key:"gold",label:"Mais Rico",icon:Ve,color:"text-amber-500"}],u=[{key:"all",label:"Todos",shortLabel:"Todos",icon:Oe,color:"text-gray-500"},{key:"alive",label:"Apenas Vivos",shortLabel:"Vivos",icon:Be,color:"text-green-500"},{key:"dead",label:"Apenas Mortos",shortLabel:"Mortos",icon:$e,color:"text-red-500"}];return t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{children:[t.jsx("h3",{className:"text-sm font-medium mb-2 text-muted-foreground",children:"Modalidade"}),t.jsx("div",{className:"flex flex-wrap gap-2",children:m.map((s=>{const r=s.icon,n=e===s.key;return t.jsxs(Wa,{variant:n?"default":"outline",size:"sm",onClick:()=>a(s.key),disabled:d,className:"flex items-center gap-2 text-xs "+(n?"":"hover:bg-muted"),children:[t.jsx(r,{className:"h-3 w-3 "+(n?"text-white":"text-muted-foreground")}),t.jsx("span",{className:"hidden sm:inline",children:s.label}),t.jsx("span",{className:"sm:hidden",children:"floor"===s.key?"Andar":"level"===s.key?"Nível":"Ouro"})]},s.key)}))})]}),t.jsxs("div",{children:[t.jsx("h3",{className:"text-sm font-medium mb-2 text-muted-foreground",children:"Status"}),t.jsx("div",{className:"flex flex-wrap gap-2",children:u.map((e=>{const a=e.icon,n=s===e.key;return t.jsxs(Wa,{variant:n?"default":"outline",size:"sm",onClick:()=>r(e.key),disabled:d,className:"flex items-center gap-2 text-xs "+(n?"":"hover:bg-muted"),children:[t.jsx(a,{className:"h-3 w-3 "+(n?"text-white":"text-muted-foreground")}),t.jsx("span",{className:"hidden sm:inline",children:e.label}),t.jsx("span",{className:"sm:hidden",children:e.shortLabel})]},e.key)}))})]}),t.jsxs("div",{children:[t.jsx("h3",{className:"text-sm font-medium mb-2 text-muted-foreground",children:"Buscar Jogador"}),t.jsxs("div",{className:"relative",children:[t.jsx(Ue,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),t.jsx(Ms,{type:"text",placeholder:"Digite o nome do jogador...",value:n,onChange:e=>i(e.target.value),disabled:d,className:"pl-10 text-sm"})]})]}),l>1&&t.jsxs("div",{children:[t.jsx("h3",{className:"text-sm font-medium mb-2 text-muted-foreground",children:"Páginas"}),t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs(Wa,{variant:"outline",size:"sm",onClick:()=>c(o-1),disabled:o<=1||d,className:"flex items-center gap-2",children:[t.jsx(ze,{className:"h-4 w-4"}),t.jsx("span",{className:"hidden sm:inline",children:"Anterior"})]}),t.jsx("div",{className:"flex items-center gap-2",children:t.jsxs("span",{className:"text-sm text-muted-foreground",children:["Página ",o," de ",l]})}),t.jsxs(Wa,{variant:"outline",size:"sm",onClick:()=>c(o+1),disabled:o>=l||d,className:"flex items-center gap-2",children:[t.jsx("span",{className:"hidden sm:inline",children:"Próxima"}),t.jsx(He,{className:"h-4 w-4"})]})]})]})]})},ah=e=>e>=1e6?(e/1e6).toFixed(1)+"M":e>=1e3?(e/1e3).toFixed(1)+"K":e.toString(),sh=({entries:e,mode:a,currentUserId:s})=>{const r=e=>{switch(e){case 0:return"text-yellow-500";case 1:return"text-gray-400";case 2:return"text-amber-700";default:return"text-gray-300"}},n=(e,t)=>{switch(t){case"floor":default:return`Andar ${e.highest_floor}`;case"level":return`Nível ${e.character_level}`;case"gold":return`${ah(e.character_gold)} Gold`}},i=(e,t)=>{switch(t){case"floor":return`Nível ${e.character_level} • ${ah(e.character_gold)} Gold`;case"level":return`Andar ${e.highest_floor} • ${ah(e.character_gold)} Gold`;case"gold":return`Andar ${e.highest_floor} • Nível ${e.character_level}`;default:return`Nível ${e.character_level}`}},o=(e=>{switch(e){case"floor":default:return ae;case"level":return Fe;case"gold":return Ve}})(a);return 0===e.length?t.jsxs("div",{className:"text-center py-8",children:[t.jsx(o,{className:"h-12 w-12 text-muted-foreground mx-auto mb-4"}),t.jsx("p",{className:"text-muted-foreground",children:"Nenhum registro encontrado para esta modalidade."})]}):t.jsxs(tu,{children:[t.jsx(au,{children:t.jsxs(ru,{children:[t.jsx(nu,{className:"w-12 text-center",children:"Pos."}),t.jsx(nu,{children:"Jogador"}),t.jsx(nu,{className:"text-right",children:"Valor Principal"}),t.jsx(nu,{className:"text-right hidden sm:table-cell",children:"Detalhes"}),t.jsx(nu,{className:"text-right",children:"Data"})]})}),t.jsx(su,{children:e.map(((e,o)=>t.jsxs(ru,{className:e.user_id===s?"bg-primary/5":"",children:[t.jsx(iu,{className:"text-center font-medium",children:o<3?t.jsx(ae,{className:`inline h-4 w-4 ${r(o)}`}):t.jsx("span",{className:"text-muted-foreground",children:o+1})}),t.jsx(iu,{children:t.jsx("div",{className:"flex items-center gap-2",children:t.jsxs("div",{className:"flex flex-col",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("span",{className:"font-medium",children:e.player_name}),e.character_alive?t.jsx(Be,{className:"h-3 w-3 text-green-500"}):t.jsx($e,{className:"h-3 w-3 text-red-500"}),e.user_id===s&&t.jsx("span",{className:"text-xs bg-primary/20 text-primary px-1.5 py-0.5 rounded",children:"Você"})]}),t.jsx("div",{className:"text-xs text-muted-foreground sm:hidden",children:i(e,a)})]})})}),t.jsx(iu,{className:"text-right font-medium",children:n(e,a)}),t.jsx(iu,{className:"text-right text-muted-foreground hidden sm:table-cell",children:i(e,a)}),t.jsx(iu,{className:"text-right text-muted-foreground",children:e.created_at?new Date(e.created_at).toLocaleDateString("pt-BR",{day:"2-digit",month:"2-digit",year:"2-digit",hour:"2-digit",minute:"2-digit"}):"-"})]},e.id)))})]})},rh=({stats:a,userRanking:s})=>{const[r,n]=e.useState(!0),[i,o]=e.useState(!1),l=s[0];return t.jsxs("div",{className:"space-y-4",children:[t.jsxs(pu,{children:[t.jsx(xu,{className:"pb-3",children:t.jsxs(Wa,{variant:"ghost",className:"w-full justify-between p-0 h-auto hover:bg-transparent",onClick:()=>n(!r),children:[t.jsx(fu,{className:"text-lg font-medium",children:"Suas Conquistas"}),r?t.jsx(ce,{className:"h-4 w-4 text-muted-foreground"}):t.jsx(oe,{className:"h-4 w-4 text-muted-foreground"})]})}),r&&t.jsx(bu,{className:"pt-0",children:t.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-3",children:[t.jsxs("div",{className:"text-center p-4 bg-muted/30 rounded-lg border",children:[t.jsx(ae,{className:"h-5 w-5 text-muted-foreground mx-auto mb-2"}),t.jsx("div",{className:"text-2xl font-bold mb-1",children:a.bestFloor}),t.jsx("div",{className:"text-xs text-muted-foreground",children:"Melhor Andar"})]}),t.jsxs("div",{className:"text-center p-4 bg-muted/30 rounded-lg border",children:[t.jsx(Fe,{className:"h-5 w-5 text-muted-foreground mx-auto mb-2"}),t.jsx("div",{className:"text-2xl font-bold mb-1",children:a.bestLevel}),t.jsx("div",{className:"text-xs text-muted-foreground",children:"Maior Nível"})]}),t.jsxs("div",{className:"text-center p-4 bg-muted/30 rounded-lg border",children:[t.jsx(Ve,{className:"h-5 w-5 text-muted-foreground mx-auto mb-2"}),t.jsx("div",{className:"text-xl font-bold mb-1",title:`${a.bestGold.toLocaleString("pt-BR")} Gold`,children:ah(a.bestGold)}),t.jsx("div",{className:"text-xs text-muted-foreground",children:"Mais Rico"})]})]})})]}),l&&t.jsxs(pu,{children:[t.jsx(xu,{className:"pb-3",children:t.jsxs(Wa,{variant:"ghost",className:"w-full justify-between p-0 h-auto hover:bg-transparent",onClick:()=>o(!i),children:[t.jsxs(fu,{className:"text-lg font-medium flex items-center gap-2",children:[t.jsx(Ge,{className:"h-4 w-4"}),"Última Tentativa"]}),i?t.jsx(ce,{className:"h-4 w-4 text-muted-foreground"}):t.jsx(oe,{className:"h-4 w-4 text-muted-foreground"})]})}),i&&t.jsx(bu,{className:"pt-0",children:t.jsxs("div",{className:"flex items-center justify-between p-3 bg-muted/30 rounded-lg",children:[t.jsxs("div",{className:"flex items-center gap-3",children:[l.character_alive?t.jsx("span",{className:"text-sm",children:"❤️"}):t.jsx("span",{className:"text-sm",children:"💀"}),t.jsxs("div",{children:[t.jsx("div",{className:"font-medium text-sm",children:l.character_alive?"Vivo":"Morto"}),t.jsx("div",{className:"text-xs text-muted-foreground",children:new Date(l.created_at).toLocaleDateString("pt-BR")})]})]}),t.jsxs("div",{className:"text-right",children:[t.jsxs("div",{className:"font-bold",children:["Andar ",l.highest_floor]}),t.jsxs("div",{className:"text-xs text-muted-foreground",children:["Nível ",l.character_level]})]})]})})]}),t.jsx(pu,{children:t.jsx(bu,{className:"p-4",children:t.jsxs("div",{className:"flex justify-between items-center text-sm",children:[t.jsx("span",{className:"text-muted-foreground",children:"Total de Tentativas:"}),t.jsx("span",{className:"font-medium",children:a.totalRuns})]})})})]})},nh=l("/_authenticated/game/ranking")({component:function(){const a=r(),{user:s}=Oa(),[n,i]=e.useState([]),[o,l]=e.useState([]),[c,d]=e.useState({bestFloor:0,bestLevel:1,bestGold:0,totalRuns:0,aliveCharacters:0}),[m,u]=e.useState(!0),[h,p]=e.useState("floor"),[x,f]=e.useState("all"),[g,b]=e.useState(""),[v,y]=e.useState(1),[j,N]=e.useState(1),[_,w]=e.useState("");e.useEffect((()=>{const e=setTimeout((()=>{w(g)}),500);return()=>clearTimeout(e)}),[g]),e.useEffect((()=>{y(1)}),[h,x,_]),e.useEffect((()=>{S()}),[s?.id,h,x,_,v]);const C=e.useCallback((async()=>{try{const e=await Qu.countRankingEntries(x,_);if(null!==e.data){const t=e.data,a=Math.max(1,Math.ceil(t/20));N(a)}}catch(e){N(1)}}),[x,_]),S=async()=>{try{u(!0),await C();const e=await Qu.getGlobalRanking(h,20,x,_,v);if(e.error?i([]):(i(e.data||[]),e.data&&e.data.length),s?.id){const[e,t]=await Promise.all([Qu.getUserRanking(s.id,15),Qu.getUserStats(s.id)]);e.error?l([]):l(e.data||[]),t.error?d({bestFloor:0,bestLevel:1,bestGold:0,totalRuns:0,aliveCharacters:0}):d(t.data||{bestFloor:0,bestLevel:1,bestGold:0,totalRuns:0,aliveCharacters:0})}}catch(e){i([]),l([]),d({bestFloor:0,bestLevel:1,bestGold:0,totalRuns:0,aliveCharacters:0})}finally{u(!1)}},E=e=>{y(e)};return t.jsxs("div",{className:"container mx-auto p-2 md:p-4 max-w-7xl",children:[t.jsxs("div",{className:"flex items-center justify-between mb-4 md:mb-6",children:[t.jsxs("div",{className:"flex items-center gap-4",children:[t.jsxs(Wa,{variant:"ghost",size:"sm",onClick:()=>a({to:"/game"}),children:[t.jsx(Pe,{className:"h-4 w-4 mr-2"}),"Voltar"]}),t.jsxs("div",{children:[t.jsx("h1",{className:"text-2xl font-bold",children:(e=>{switch(e){case"floor":return"Ranking por Andar Mais Alto";case"level":return"Ranking por Nível Mais Alto";case"gold":return"Ranking por Mais Ouro";default:return"Ranking"}})(h)}),t.jsxs("p",{className:"text-muted-foreground",children:["Veja os melhores jogadores",(()=>{const e=[];return"all"!==x&&e.push("alive"===x?"vivos":"mortos"),_&&e.push(`nome: "${_}"`),e.length>0?` (${e.join(", ")})`:""})()]})]})]}),t.jsx("div",{className:"flex gap-2",children:t.jsx(Wa,{variant:"outline",size:"sm",onClick:async()=>{await S()},disabled:m,children:"Atualizar"})})]}),t.jsx(pu,{className:"mb-4 md:mb-6",children:t.jsx(xu,{children:t.jsx(th,{activeMode:h,onModeChange:p,statusFilter:x,onStatusFilterChange:f,nameFilter:g,onNameFilterChange:b,currentPage:v,totalPages:j,onPageChange:E,isLoading:m})})}),t.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-4 gap-4 md:gap-6",children:[s&&t.jsx("div",{className:"lg:col-span-1",children:t.jsx(rh,{stats:c,userRanking:o.map((e=>({highest_floor:e.highest_floor,character_level:e.character_level,character_gold:e.character_gold,character_alive:e.character_alive,created_at:e.created_at})))})}),t.jsx("div",{className:s?"lg:col-span-3":"lg:col-span-4",children:t.jsxs(pu,{children:[t.jsx(bu,{className:"p-0",children:t.jsx(sh,{entries:n,mode:h,currentUserId:s?.id})}),j>1&&t.jsxs(vu,{className:"flex justify-center gap-2",children:[t.jsx(Wa,{variant:"outline",size:"sm",onClick:()=>E(v-1),disabled:v<=1||m,children:"Anterior"}),t.jsxs("span",{className:"flex items-center px-4 text-sm text-muted-foreground",children:["Página ",v," de ",j]}),t.jsx(Wa,{variant:"outline",size:"sm",onClick:()=>E(v+1),disabled:v>=j||m,children:"Próxima"})]})]})})]})]})}});var ih=(e=>(e.SWORD_MASTERY="sword",e.AXE_MASTERY="axe",e.BLUNT_MASTERY="blunt",e.DEFENSE_MASTERY="defense",e.MAGIC_MASTERY="magic",e))(ih||{});function oh(e){return{sword:"Maestria com espadas. Aumenta ataque (+1), chance crítica (+0.2%) e dano crítico (+3%) por nível.",axe:"Maestria com machados. Aumenta ataque (+1), chance crítica (+0.2%) e dano crítico (+3%) por nível.",blunt:"Maestria com armas de concussão. Aumenta ataque (+1), chance crítica (+0.2%) e dano crítico (+3%) por nível.",defense:"Maestria defensiva. Aumenta defesa (+2) por nível e reduz dano recebido.",magic:"Maestria mágica. Aumenta mana (+3), dano mágico (+15%) e cura (+10%) por nível."}[e]}function lh(e){return{buff:"🛡️",debuff:"💀",dot:"🔥",hot:"✨",damage:"⚔️",heal:"❤️"}[e]||"🔮"}function ch(e){return{buff:"text-blue-400 bg-blue-500/20 border-blue-500/30",debuff:"text-red-400 bg-red-500/20 border-red-500/30",dot:"text-orange-400 bg-orange-500/20 border-orange-500/30",hot:"text-green-400 bg-green-500/20 border-green-500/30",damage:"text-purple-400 bg-purple-500/20 border-purple-500/30",heal:"text-emerald-400 bg-emerald-500/20 border-emerald-500/30"}[e]||"text-gray-400 bg-gray-500/20 border-gray-500/30"}class dh{static async updateCharacterHpMana(e,t,a){try{if(!e)return{success:!1,error:"ID do personagem é obrigatório",data:null};const s=void 0!==t?Math.floor(Number(t)):void 0,r=void 0!==a?Math.floor(Number(a)):void 0;if(void 0!==s&&(s<0||s>9999))return{success:!1,error:"Valor de HP inválido",data:null};if(void 0!==r&&(r<0||r>9999))return{success:!1,error:"Valor de Mana inválido",data:null};const{error:n}=await Aa.rpc("update_character_stats",{p_character_id:e,p_hp:s,p_mana:r});return n?{success:!1,error:`Erro ao atualizar stats: ${n.message}`,data:null}:{success:!0,error:null,data:null}}catch(s){return{success:!1,error:s instanceof Error?s.message:"Erro desconhecido ao atualizar HP/Mana",data:null}}}static calculateAutoHeal(e,t,a=!1){if(a)return{hp:e.max_hp,mana:e.max_mana};if(!e.last_activity)return{hp:e.hp,mana:e.mana};if(e.hp>=e.max_hp&&e.mana>=e.max_mana)return{hp:e.hp,mana:e.mana};const s=new Date(e.last_activity),r=t.getTime()-s.getTime(),n=Math.floor(r/1e3);if(n<1)return{hp:e.hp,mana:e.mana};const i=100;let o=e.hp;if(e.hp<e.max_hp){const t=Math.max(e.hp,Math.ceil(.001*e.max_hp)),a=t/e.max_hp*100,s=.013875,r=Math.min(s*n,i-a),l=Math.floor(r/100*e.max_hp);o=Math.min(e.max_hp,t+l)}let l=e.mana;if(e.mana<e.max_mana){const t=Math.max(e.mana,Math.ceil(.001*e.max_mana)),a=t/e.max_mana*100,s=.013875,r=Math.min(s*n,i-a),o=Math.floor(r/100*e.max_mana);l=Math.min(e.max_mana,t+o)}return{hp:o,mana:l}}static async applyAutoHeal(e,t=!1){try{const a=new Date,{hp:s,mana:r}=dh.calculateAutoHeal(e,a,t);if(s===e.hp&&r===e.mana)return{data:{healed:!1,oldHp:e.hp,newHp:e.hp,character:e},error:null,success:!0};const n=await dh.updateCharacterHpMana(e.id,s,r);if(!n.success)throw new Error(n.error||"Erro ao atualizar HP/Mana");await dh.updateLastActivity(e.id);const i={...e,hp:s,mana:r,last_activity:a.toISOString()};return{data:{healed:!0,oldHp:e.hp,newHp:s,character:i},error:null,success:!0}}catch(a){return{data:null,error:a instanceof Error?a.message:"Erro ao aplicar cura automática",success:!1}}}static async forceFullHealForHub(e){const{data:t,error:a}=await Aa.from("characters").select("*").eq("id",e).single();return a||!t?{data:null,error:a?.message||"Personagem não encontrado",success:!1}:await this.applyAutoHeal(t,!0)}static async updateLastActivity(e){try{const{error:t}=await Aa.rpc("update_character_last_activity",{p_character_id:e});if(t)throw t;return{data:null,error:null,success:!0}}catch(t){return{data:null,error:t instanceof Error?t.message:"Erro ao atualizar última atividade",success:!1}}}}class mh{static async updateCharacterFloor(e,t){try{const{error:a}=await Aa.rpc("update_character_floor",{p_character_id:e,p_floor:t});if(a)throw a;return{data:null,error:null,success:!0}}catch(a){return{data:null,error:a instanceof Error?a.message:"Erro desconhecido",success:!1}}}static async getUnlockedCheckpoints(e){try{const{data:t,error:a}=await Aa.from("characters").select("*").eq("id",e).single();if(a)throw a;if(!t)return{data:null,error:"Personagem não encontrado",success:!1};const s=Math.max(t.floor,("highest_floor"in t?t.highest_floor:t.floor)||t.floor),r=[];r.push({floor:1,description:"Andar 1 - Início da Torre"}),s>=5&&r.push({floor:5,description:"Andar 5 - Primeiro Desafio"});for(let e=1;e<=100;e++){const t=10*e+1;if(!(s>=t&&t<=1001))break;r.push({floor:t,description:`Andar ${t} - Checkpoint Pós-Boss`})}return{data:r,error:null,success:!0}}catch(t){return{data:null,error:t instanceof Error?t.message:"Erro ao obter checkpoints",success:!1}}}static async startFromCheckpoint(e,t){try{if(!(1===t||5===t||t>10&&(t-1)%10==0))return{data:null,error:"Checkpoint inválido",success:!1};const a=await this.getUnlockedCheckpoints(e);if(!a.success||!a.data)return{data:null,error:"Erro ao verificar checkpoints",success:!1};if(!a.data.some((e=>e.floor===t)))return{data:null,error:"Checkpoint não desbloqueado",success:!1};const s=await this.updateCharacterFloor(e,t);if(!s.success)return s;const{data:r,error:n}=await Aa.from("characters").select("max_hp, max_mana").eq("id",e).single();if(n)throw n;return await dh.updateCharacterHpMana(e,r.max_hp,r.max_mana),{data:null,error:null,success:!0}}catch(a){return{data:null,error:a instanceof Error?a.message:"Erro ao iniciar do checkpoint",success:!1}}}static async resetCharacterProgress(e){try{const t=await this.updateCharacterFloor(e,1);if(!t.success)return t;const{data:a,error:s}=await Aa.from("characters").select("max_hp, max_mana").eq("id",e).single();if(s)throw s;return await dh.updateCharacterHpMana(e,a.max_hp,a.max_mana),{data:null,error:null,success:!0}}catch(t){return{data:null,error:t instanceof Error?t.message:"Erro ao resetar progresso",success:!1}}}}class uh{static async getUserCharacterProgression(e){try{const{data:t,error:a}=await Aa.rpc("get_user_character_progression",{p_user_id:e}).single();if(a)throw a;return{data:t,error:null,success:!0}}catch(t){return{data:null,error:t instanceof Error?t.message:"Erro ao buscar progressão",success:!1}}}static async checkCharacterLimit(e){try{const{data:t,error:a}=await Aa.rpc("check_character_limit",{p_user_id:e}).single();if(a)throw a;return{data:t,error:null,success:!0}}catch(t){return{data:null,error:t instanceof Error?t.message:"Erro ao verificar limite",success:!1}}}static async grantSecureXP(e,t,a="combat"){try{"combat"===a||(a.charAt(0).toUpperCase(),a.slice(1));const{data:s,error:r}=await Aa.rpc("update_character_stats",{p_character_id:e,p_xp:t}).single();if(r){if(r.message?.includes("suspeita detectada")||"P0001"===r.code){}throw r}const n=s;n.leveled_up?n.new_level:n.new_level,n.slots_unlocked&&n.new_available_slots;return{data:n,error:null,success:!0}}catch(s){const e=s instanceof Error?s.message:"Erro ao conceder XP";return e.includes("suspeita detectada")||e.includes("P0001"),{data:null,error:e,success:!1}}}static async grantSecureGold(e,t){try{const{error:a}=await Aa.rpc("update_character_stats",{p_character_id:e,p_gold:t}).single();if(a)throw a;return{data:t,error:null,success:!0}}catch(a){return{data:null,error:a instanceof Error?a.message:"Erro ao conceder gold",success:!1}}}static async addSkillXp(e,t,a){try{const{data:s,error:r}=await Aa.rpc("add_skill_xp",{p_character_id:e,p_skill_type:t,p_xp_amount:a}).single();if(r)throw r;return{data:s,error:null,success:!0}}catch(s){return{data:null,error:s instanceof Error?s.message:"Erro ao adicionar XP",success:!1}}}static async updateGold(e,t){try{const{error:a}=await Aa.from("characters").update({gold:t}).eq("id",e);if(a)throw a;return{data:null,error:null,success:!0}}catch(a){return{data:null,error:a instanceof Error?a.message:"Erro ao atualizar gold",success:!1}}}}class hh{static async calculateDerivedStats(e){const{level:t,strength:a=10,dexterity:s=10,intelligence:r=10,wisdom:n=10,vitality:i=10,luck:o=10,sword_mastery:l=1,axe_mastery:c=1,blunt_mastery:d=1,defense_mastery:m=1,magic_mastery:u=1}=e,h=50+2*t,p=20+1*t,x=2+t,f=1+t,g=3+t,b=Math.pow(a,1.1),v=Math.pow(s,1.1),y=Math.pow(r,1.1),j=Math.pow(n,1.05),N=Math.pow(i,1.2),_=o,w=Math.pow(Math.max(l,c,d),1.05),C=Math.pow(m,1.1),S=Math.pow(u,1.05),E=h+Math.floor(1.5*N)+Math.floor(.2*b),k=p+Math.floor(1*y)+Math.floor(.8*j)+Math.floor(.5*S),A=.15*v,P=.25*_,M=.05*b,T=.1*w,q=.3*b,D=.2*_,L=.4*w;let $=2+.8*y+.4*j+1*S;$>50&&($=50+.5*($-50));const R=.05*v,I=.1*_;return{hp:E,max_hp:E,mana:k,max_mana:k,atk:x+Math.floor(.8*b)+Math.floor(.4*w)+Math.floor(.1*v),magic_attack:x+Math.floor(.8*y)+Math.floor(.4*j)+Math.floor(.6*S),def:f+Math.floor(.4*N)+Math.floor(.3*j)+Math.floor(.8*C),speed:g+Math.floor(.8*v)+Math.floor(.1*_),critical_chance:Math.min(60,1+A+P+M+T),critical_damage:Math.min(200,102+q+D+L),magic_damage_bonus:Math.min(150,$),double_attack_chance:Math.min(25,R+I)}}static analyzeBuildDiversity(e){const{strength:t=10,dexterity:a=10,intelligence:s=10,wisdom:r=10,vitality:n=10,luck:i=10}=e,o=[t,a,s,r,n,i],l=o.reduce(((e,t)=>e+t),0),c=Math.max(...o),d=c/l,m=l/6,u=o.reduce(((e,t)=>e+Math.pow(t-m,2)),0)/6,h=Math.sqrt(u),p=Math.max(0,1-h/(l/6));let x="Balanced";if(d>.3){x=["Strength","Dexterity","Intelligence","Wisdom","Vitality","Luck"][o.indexOf(c)]}return{diversity:p,dominantAttribute:x,monoBuild:d>.8}}static calculateEffectiveStats(e){const t=("atk"in e?e.atk:e.attack)||0,a=("def"in e?e.def:e.defense)||0,s=e.speed||0,r=("magic_attack"in e?e.magic_attack:0)||0,n=e.critical_chance||0,i=e.critical_damage||110;if(!e.active_effects?.attribute_modifications?.length)return{atk:t,def:a,speed:s,magic_attack:r,critical_chance:n,critical_damage:i};let o=t,l=a,c=s,d=r,m=n,u=i;for(const h of e.active_effects.attribute_modifications){if(h.duration<=0)continue;const e=h.value,t="percentage"===h.type;switch(h.attribute){case"atk":t?o=Math.floor(o*(1+e/100)):o+=e;break;case"def":t?l=Math.floor(l*(1+e/100)):l+=e;break;case"speed":t?c=Math.floor(c*(1+e/100)):c+=e;break;case"magic_attack":t?d=Math.floor(d*(1+e/100)):d+=e;break;case"critical_chance":t?m*=1+e/100:m+=e;break;case"critical_damage":t?u*=1+e/100:u+=e}}return{atk:Math.max(1,Math.floor(o)),def:Math.max(0,Math.floor(l)),speed:Math.max(1,Math.floor(c)),magic_attack:Math.max(0,Math.floor(d)),critical_chance:Math.max(0,m),critical_damage:Math.max(100,u)}}static getActiveModifiers(e,t){return e.active_effects?.attribute_modifications?.length?e.active_effects.attribute_modifications.filter((e=>e.attribute===t&&e.duration>0)):[]}static hasActiveModifiers(e,t){return this.getActiveModifiers(e,t).length>0}static getTotalModifierValue(e,t){const a=this.getActiveModifiers(e,t);if(!a.length)return 0;let s=0;for(const r of a)r.type,s+=r.value;return s}}class ph{static async distributeAttributePoints(e,t){try{const{data:a,error:s}=await Aa.rpc("distribute_attribute_points",{p_character_id:e,p_strength:t.strength,p_dexterity:t.dexterity,p_intelligence:t.intelligence,p_wisdom:t.wisdom,p_vitality:t.vitality,p_luck:t.luck}).single();if(s)throw s;return{data:a,error:null,success:!0}}catch(a){return{data:null,error:a instanceof Error?a.message:"Erro ao distribuir pontos",success:!1}}}static async recalculateCharacterStats(e){try{const{error:t}=await Aa.rpc("recalculate_character_stats",{p_character_id:e});if(t)throw t;return{data:null,error:null,success:!0}}catch(t){return{data:null,error:t instanceof Error?t.message:"Erro ao recalcular stats",success:!1}}}}class xh{static BLACKLIST_WORDS=["porra","merda","caralho","puta","putaria","viado","bicha","cu","buceta","piroca","pinto","rola","foda","foder","fodido","cuzao","cuzão","babaca","otario","otário","idiota","imbecil","retardado","mongoloide","burro","desgraça","desgraçado","filho da puta","fdp","vagabundo","safado","cachorro","cadela","prostituta","vagabunda","piranha","galinha","fuck","shit","bitch","damn","hell","ass","asshole","bastard","crap","piss","dick","cock","pussy","cunt","whore","slut","fag","faggot","nigger","retard","moron","idiot","stupid","gay","lesbian","homo","nazi","hitler","rape","kill","murder","mierda","joder","puta","puto","cabron","cabrón","pendejo","idiota","estupido","estúpido","culo","coño","verga","chingar","pinche","mamada","putada","hijo de puta","hdp","marica","maricon","maricón","droga","cocaina","heroina","crack","cocaine","heroin","drug","dealer","traficante","sexo","sex","porn","porno","nude","naked","xxx","fetish","admin","moderador","mod","gm","gamemaster","suporte","support","oficial","staff","dev","developer","bot","sistema","system"];static RESERVED_WORDS=["admin","administrator","moderador","moderator","mod","gm","gamemaster","suporte","support","help","ajuda","oficial","official","staff","dev","developer","sistema","system","bot","null","undefined","test","teste","demo","sample","example","exemplo","guest","visitante","player","jogador","user","usuario","usuário","npc","monster","monstro"];static INVALID_PATTERNS=[/^[0-9]+$/,/^[^a-zA-ZÀ-ÿ]/,/[^a-zA-ZÀ-ÿ0-9\s'-]/,/\d{3,}/,/(.)\1{3,}/,/^\s|\s$/,/\s{2,}/];static validateCharacterName(e){if(!e||"string"!=typeof e)return{isValid:!1,error:"Nome é obrigatório"};const t=e.trim();if(t.length<3)return{isValid:!1,error:"Nome deve ter pelo menos 3 caracteres"};if(t.length>20)return{isValid:!1,error:"Nome deve ter no máximo 20 caracteres"};for(const n of this.INVALID_PATTERNS)if(n.test(t))return{isValid:!1,error:this.getPatternError(n)};const a=t.toLowerCase().split(/[\s\-']+/);for(const n of a)if(this.BLACKLIST_WORDS.includes(n))return{isValid:!1,error:"Nome contém palavras inadequadas"};const s=t.toLowerCase().replace(/[\s\-']/g,"");for(const n of this.BLACKLIST_WORDS)if(s.includes(n))return{isValid:!1,error:"Nome contém termos inadequados"};for(const n of this.RESERVED_WORDS)if(s.includes(n))return{isValid:!1,error:"Nome contém termos reservados do sistema"};if(!/[a-zA-ZÀ-ÿ]/.test(t))return{isValid:!1,error:"Nome deve conter pelo menos uma letra"};const r=(t.match(/[a-zA-ZÀ-ÿ]/g)||[]).length;return(t.match(/[0-9]/g)||[]).length>r?{isValid:!1,error:"Nome não pode ter mais números que letras"}:{isValid:!0}}static getPatternError(e){const t=e.toString();return t.includes("^[0-9]+$")?"Nome não pode ser apenas números":t.includes("^[^a-zA-ZÀ-ÿ]")?"Nome deve começar com uma letra":t.includes("[^a-zA-ZÀ-ÿ0-9\\s'\\-]")?"Nome contém caracteres especiais não permitidos":t.includes("\\d{3,}")?"Nome não pode ter mais de 2 números consecutivos":t.includes("(.)\\1{3,}")?"Nome não pode ter mais de 3 caracteres iguais seguidos":t.includes("^\\s|\\s$")?"Nome não pode começar ou terminar com espaços":t.includes("\\s{2,}")?"Nome não pode ter espaços múltiplos":"Nome contém formato inválido"}static formatCharacterName(e){if(!e)return"";let t=e.trim().replace(/\s+/g," ");return t=t.replace(/\b\w/g,(e=>e.toUpperCase())),t}static generateNameSuggestions(e){const t=[],a=e.replace(/[^a-zA-ZÀ-ÿ]/g,"");if(a.length>=3){for(let s=1;s<=3;s++){const e=Math.floor(100*Math.random());t.push(this.formatCharacterName(a+e))}const e=["Jr","II","III","X","Prime","Neo"];for(const s of e.slice(0,2))t.push(this.formatCharacterName(a+s))}if(0===t.length){const e=["Aventureiro","Guerreiro","Explorador","Heroi","Campeao","Bravo","Valente","Nobre","Lenda","Mestre"];for(let a=0;a<3;a++){const a=e[Math.floor(Math.random()*e.length)],s=Math.floor(1e3*Math.random());t.push(`${a}${s}`)}}return t.slice(0,3)}static isTooSimilar(e,t){const a=e.toLowerCase().replace(/[^a-zA-ZÀ-ÿ0-9]/g,"");for(const s of t){const e=s.toLowerCase().replace(/[^a-zA-ZÀ-ÿ0-9]/g,"");if(a===e)return!0;if(this.calculateSimilarity(a,e)>.8)return!0}return!1}static calculateSimilarity(e,t){const a=e.length>t.length?e:t,s=e.length>t.length?t:e;if(0===a.length)return 1;const r=this.levenshteinDistance(a,s);return(a.length-r)/a.length}static levenshteinDistance(e,t){const a=Array(t.length+1).fill(null).map((()=>Array(e.length+1).fill(null)));for(let s=0;s<=e.length;s+=1)a[0][s]=s;for(let s=0;s<=t.length;s+=1)a[s][0]=s;for(let s=1;s<=t.length;s+=1)for(let r=1;r<=e.length;r+=1){const n=e[r-1]===t[s-1]?0:1;a[s][r]=Math.min(a[s][r-1]+1,a[s-1][r]+1,a[s-1][r-1]+n)}return a[t.length][e.length]}}function fh(e,t){if(e&&"object"==typeof e){if("message"in e&&"string"==typeof e.message)return e.message;if(e instanceof Error)return e.message}return t}class gh{static equipmentCache=new Map;static lastFetchTimestamp=0;static CACHE_DURATION=3e5;static async getAvailableEquipment(e){try{const t=`level_${e}`,a=Date.now();if(a-this.lastFetchTimestamp<this.CACHE_DURATION&&this.equipmentCache.has(t))return this.equipmentCache.get(t)||[];const{data:s,error:r}=await Aa.from("equipment").select("*").lte("level_requirement",e).eq("is_unlocked",!0).order("level_requirement",{ascending:!0});if(r)throw r;const n=s;return this.equipmentCache.set(t,n),this.lastFetchTimestamp=a,n}catch(t){return[]}}static async getAllEquipments(){try{const{data:e,error:t}=await Aa.from("equipment").select("*").order("name");if(t)throw t;return e}catch(e){return[]}}static async getCharacterEquipmentComplete(e){try{const{data:t,error:a}=await Aa.from("character_equipment").select("\n          *,\n          equipment:equipment_id (\n            id,\n            name,\n            description,\n            type,\n            weapon_subtype,\n            rarity,\n            level_requirement,\n            atk_bonus,\n            def_bonus,\n            mana_bonus,\n            speed_bonus,\n            hp_bonus,\n            critical_chance_bonus,\n            critical_damage_bonus,\n            price,\n            is_unlocked,\n            created_at,\n            updated_at\n          )\n        ").eq("character_id",e).order("created_at",{ascending:!1});if(a)throw a;const s=t,r={};return s.forEach((e=>{if(e.is_equipped&&e.equipment){let t=null;switch(e.equipment.type){case"weapon":t=r.main_hand?r.off_hand?"main_hand":"off_hand":"main_hand";break;case"armor":t=r.armor?r.off_hand?"armor":"off_hand":"armor";break;case"chest":t="chest";break;case"helmet":t="helmet";break;case"legs":t="legs";break;case"boots":t="boots";break;case"ring":t=r.ring_1?r.ring_2?"ring_1":"ring_2":"ring_1";break;case"necklace":t="necklace";break;case"amulet":t="amulet"}t&&(r[t]=e.equipment)}})),{allEquipment:s,equippedSlots:r}}catch{return{allEquipment:[],equippedSlots:{}}}}static async getCharacterEquipment(e){const{allEquipment:t}=await this.getCharacterEquipmentComplete(e);return t}static async getEquippedItems(e){const{equippedSlots:t}=await this.getCharacterEquipmentComplete(e);return t}static async toggleEquipment(e,t,a){try{const{error:s}=await Aa.rpc("toggle_equipment",{p_character_id:e,p_equipment_id:t});if(s)throw s;return{data:a?"Item equipado com sucesso!":"Item desequipado com sucesso!",error:null,success:!0}}catch(s){return{data:null,error:fh(s,"Erro ao equipar/desequipar item"),success:!1}}}static async buyEquipment(e,t){try{const{data:a,error:s}=await Aa.rpc("buy_equipment",{p_character_id:e,p_equipment_id:t});if(s)throw s;return{data:{newGold:a},error:null,success:!0}}catch(a){return{data:null,error:fh(a,"Erro ao comprar equipamento"),success:!1}}}static async sellEquipment(e,t){try{const{data:a,error:s}=await Aa.rpc("sell_equipment",{p_character_id:e,p_equipment_id:t});if(s)throw s;return{data:{newGold:a},error:null,success:!0}}catch(a){return{data:null,error:fh(a,"Erro ao vender equipamento"),success:!1}}}static async sellEquipmentBatch(e,t){try{const{data:a,error:s}=await Aa.rpc("sell_character_equipment_batch",{p_character_id:e,p_equipment_sales:t}).single();if(s)throw s;const r=a;return{data:{totalGoldEarned:r.total_gold_earned,itemsSold:r.items_sold,newGold:r.new_character_gold},error:null,success:!0}}catch(a){return{data:null,error:fh(a,"Erro ao vender equipamentos"),success:!1}}}static async calculateEquipmentSellPrice(e,t,a=1){try{const{data:s,error:r}=await Aa.rpc("calculate_sell_prices",{p_character_id:e,p_item_type:"equipment",p_item_id:t,p_quantity:a}).single();if(r)throw r;const n=s;return{data:{canSell:n.can_sell,availableQuantity:n.available_quantity,unitSellPrice:n.unit_sell_price,totalSellPrice:n.total_sell_price,originalPrice:n.original_price},error:null,success:!0}}catch(s){return{data:null,error:fh(s,"Erro ao calcular preço"),success:!1}}}static async getEquipmentCraftingRecipes(){try{const{data:e,error:t}=await Aa.from("equipment_crafting_recipes").select("\n          *,\n          equipment:result_equipment_id (*),\n          ingredients:equipment_crafting_ingredients (*)\n        ").order("name");if(t)throw t;return{data:e,error:null,success:!0}}catch(e){return{data:null,error:"Erro ao buscar receitas de equipamentos",success:!1}}}static async canCraftEquipment(e,t){try{const{data:a,error:s}=await Aa.rpc("check_can_craft_equipment",{p_character_id:e,p_recipe_id:t});if(s)throw s;return{data:a,error:null,success:!0}}catch(a){return{data:null,error:fh(a,"Erro ao verificar crafting de equipamento"),success:!1}}}static async craftEquipment(e,t){try{const{error:a}=await Aa.rpc("craft_equipment",{p_character_id:e,p_recipe_id:t});if(a)throw a;return{data:{message:"Equipamento criado com sucesso!"},error:null,success:!0}}catch(a){return{data:null,error:fh(a,"Erro ao craftar equipamento"),success:!1}}}static async canEquipItem(e,t){try{const{data:a,error:s}=await Aa.from("equipment").select("*").eq("id",t).single();if(s||!a)return{data:{canEquip:!1,reason:"Equipamento não encontrado"},error:null,success:!0};const r=await this.getEquippedItems(e);let n=!1,i="",o="";switch(a.type){case"weapon":r.main_hand?r.off_hand?(n=!0,i="Pode substituir equipamento existente",o="main_hand"):(n=!0,i="Pode equipar na mão secundária",o="off_hand"):(n=!0,i="Pode equipar na mão principal",o="main_hand");break;case"armor":r.armor?r.off_hand?(n=!0,i="Pode substituir equipamento existente",o="armor"):(n=!0,i="Pode equipar como escudo na mão secundária",o="off_hand"):(n=!0,i="Pode equipar como escudo na mão secundária",o="armor");break;case"chest":r.chest?(n=!0,i="Pode substituir peitoral existente",o="chest"):(n=!0,i="Pode equipar como peitoral",o="chest");break;case"helmet":r.helmet?(n=!0,i="Pode substituir capacete existente",o="helmet"):(n=!0,i="Pode equipar como capacete",o="helmet");break;case"legs":r.legs?(n=!0,i="Pode substituir perneiras existentes",o="legs"):(n=!0,i="Pode equipar como perneiras",o="legs");break;case"boots":r.boots?(n=!0,i="Pode substituir botas existentes",o="boots"):(n=!0,i="Pode equipar como botas",o="boots");break;case"ring":r.ring_1?r.ring_2?(n=!0,i="Pode substituir anel existente",o="ring_1"):(n=!0,i="Pode equipar no segundo slot de anel",o="ring_2"):(n=!0,i="Pode equipar no primeiro slot de anel",o="ring_1");break;case"necklace":r.necklace?(n=!0,i="Pode substituir colar existente",o="necklace"):(n=!0,i="Pode equipar como colar",o="necklace");break;case"amulet":r.amulet?(n=!0,i="Pode substituir amuleto existente",o="amulet"):(n=!0,i="Pode equipar como amuleto",o="amulet");break;default:n=!1,i="Tipo de equipamento não reconhecido"}return{data:{canEquip:n,reason:i,suggestedSlot:o},error:null,success:!0}}catch(a){return{data:null,error:fh(a,"Erro ao verificar se pode equipar item"),success:!1}}}static async compareEquipmentStats(e,t,a){try{const{data:s,error:r}=await Aa.rpc("compare_equipment_stats",{p_character_id:e,p_new_equipment_id:t,p_slot_type:a});if(r)return{success:!1,error:r.message,data:null};return{success:!0,error:null,data:s||[]}}catch(s){return{success:!1,error:fh(s,"Erro ao comparar equipamentos"),data:null}}}static async getEquipmentBonuses(e){try{const{data:t,error:a}=await Aa.rpc("calculate_equipment_bonuses",{p_character_id:e});if(a)return{success:!1,error:a.message,data:null};return{success:!0,error:null,data:t?.[0]||{total_atk_bonus:0,total_def_bonus:0,total_mana_bonus:0,total_speed_bonus:0,total_hp_bonus:0,total_critical_chance_bonus:0,total_critical_damage_bonus:0}}}catch(t){return{success:!1,error:fh(t,"Erro ao obter bônus de equipamentos"),data:null}}}static clearCache(){this.equipmentCache.clear(),this.lastFetchTimestamp=0}static determineEquipmentSlot(e,t){switch(e.type){case"weapon":return t.main_hand?t.off_hand?"main_hand":"off_hand":"main_hand";case"armor":return t.armor?t.off_hand?"armor":"off_hand":"armor";case"chest":return"chest";case"helmet":return"helmet";case"legs":return"legs";case"boots":return"boots";case"ring":return t.ring_1?t.ring_2?"ring_1":"ring_2":"ring_1";case"necklace":return"necklace";case"amulet":return"amulet";default:return null}}static getAvailableSlotsForType(e,t){switch(e){case"weapon":return{availableSlots:[...t.main_hand?[]:["main_hand"],...t.off_hand?[]:["off_hand"]],occupiedSlots:[...t.main_hand?["main_hand"]:[],...t.off_hand?["off_hand"]:[]],maxSlots:2};case"armor":return{availableSlots:[...t.armor?[]:["armor"],...t.off_hand?[]:["off_hand"]],occupiedSlots:[...t.armor?["armor"]:[],...t.off_hand?["off_hand"]:[]],maxSlots:2};case"chest":return{availableSlots:t.chest?[]:["chest"],occupiedSlots:t.chest?["chest"]:[],maxSlots:1};case"helmet":return{availableSlots:t.helmet?[]:["helmet"],occupiedSlots:t.helmet?["helmet"]:[],maxSlots:1};case"legs":return{availableSlots:t.legs?[]:["legs"],occupiedSlots:t.legs?["legs"]:[],maxSlots:1};case"boots":return{availableSlots:t.boots?[]:["boots"],occupiedSlots:t.boots?["boots"]:[],maxSlots:1};case"ring":return{availableSlots:[...t.ring_1?[]:["ring_1"],...t.ring_2?[]:["ring_2"]],occupiedSlots:[...t.ring_1?["ring_1"]:[],...t.ring_2?["ring_2"]:[]],maxSlots:2};case"necklace":return{availableSlots:t.necklace?[]:["necklace"],occupiedSlots:t.necklace?["necklace"]:[],maxSlots:1};case"amulet":return{availableSlots:t.amulet?[]:["amulet"],occupiedSlots:t.amulet?["amulet"]:[],maxSlots:1};default:return{availableSlots:[],occupiedSlots:[],maxSlots:0}}}}class bh{static spellCache=new Map;static lastFetchTimestamp=0;static CACHE_DURATION=3e5;static characterSpellCache=new Map;static equippedSpellCache=new Map;static pendingAvailableRequests=new Map;static pendingEquippedRequests=new Map;static CHARACTER_CACHE_DURATION=3e5;static REQUEST_TIMEOUT=8e3;static isCacheValid(e){if(!e)return!1;const t=Date.now();return e.isValid&&t-e.timestamp<this.CHARACTER_CACHE_DURATION}static cancelPendingRequest(e,t){const a=e.get(t);a&&(a.abortController.abort(),e.delete(t))}static invalidateCharacterCache(e){this.cancelPendingRequest(this.pendingAvailableRequests,e),this.cancelPendingRequest(this.pendingEquippedRequests,e);const t=this.characterSpellCache.get(e);t&&(t.isValid=!1);const a=this.equippedSpellCache.get(e);a&&(a.isValid=!1)}static clearCache(){this.spellCache.clear(),this.lastFetchTimestamp=0;for(const[,e]of this.pendingAvailableRequests)e.abortController.abort();for(const[,e]of this.pendingEquippedRequests)e.abortController.abort();this.characterSpellCache.clear(),this.equippedSpellCache.clear(),this.pendingAvailableRequests.clear(),this.pendingEquippedRequests.clear()}static async getCharacterAvailableSpells(e,t){try{const s=this.characterSpellCache.get(e);if(this.isCacheValid(s))return{data:s.data,error:null,success:!0};const r=this.pendingAvailableRequests.get(e);if(r)try{return await r.promise}catch(a){if(!r.abortController.signal.aborted)throw a}const n=new AbortController,i=this.fetchCharacterAvailableSpells(e,t,n.signal);this.pendingAvailableRequests.set(e,{promise:i,abortController:n});try{const t=await i;return t.success&&t.data&&this.characterSpellCache.set(e,{data:t.data,timestamp:Date.now(),isValid:!0}),t}finally{this.pendingAvailableRequests.delete(e)}}catch(a){return{data:null,error:a instanceof Error?a.message:"Erro desconhecido",success:!1}}}static async fetchCharacterAvailableSpells(e,t,a){const s=new Promise(((e,t)=>{const s=setTimeout((()=>{t(new Error("Timeout ao carregar magias disponíveis"))}),this.REQUEST_TIMEOUT);a.addEventListener("abort",(()=>{clearTimeout(s),t(new Error("Request cancelado"))}))})),r=Aa.rpc("get_available_spells",{p_level:t}),{data:n,error:i}=await Promise.race([r,s]);if(a.aborted)throw new Error("Request cancelado");if(i)throw i;const{data:o,error:l}=await Aa.from("spell_slots").select("slot_position, spell_id").eq("character_id",e);if(l)throw l;const c=new Map;(o||[]).forEach((e=>{e.spell_id&&c.set(e.spell_id,e.slot_position)}));return{data:(n||[]).map((e=>({id:e.id,name:e.name,description:e.description,effect_type:e.effect_type,mana_cost:e.mana_cost,cooldown:e.cooldown,effect_value:e.effect_value,duration:e.duration,unlocked_at_level:e.unlocked_at_level||1,is_equipped:c.has(e.id),slot_position:c.get(e.id)||null}))),error:null,success:!0}}static async setCharacterSpells(e,t){try{const[a,s,r]=t,n=await Promise.all([Aa.rpc("set_spell_slot",{p_character_id:e,p_slot_position:1,p_spell_id:a||null}),Aa.rpc("set_spell_slot",{p_character_id:e,p_slot_position:2,p_spell_id:s||null}),Aa.rpc("set_spell_slot",{p_character_id:e,p_slot_position:3,p_spell_id:r||null})]);for(const e of n)if(e.error)throw e.error;return this.invalidateCharacterCache(e),{data:null,error:null,success:!0}}catch(a){return{data:null,error:a instanceof Error?a.message:"Erro desconhecido",success:!1}}}static calculateSpellStats(e){const t=e.filter((e=>e.is_equipped)),a={};e.forEach((e=>{a[e.effect_type]=(a[e.effect_type]||0)+1}));const s={total_available:e.length,total_equipped:t.length,highest_level_unlocked:e.length>0?Math.max(...e.map((e=>e.unlocked_at_level))):1,spells_by_type:a};return s}static async getAvailableSpells(e){const t=Date.now();if(this.spellCache.has(e)&&t-this.lastFetchTimestamp<this.CACHE_DURATION)return{data:this.spellCache.get(e),error:null,success:!0};try{const{data:a,error:s}=await Aa.rpc("get_available_spells",{p_level:e});if(s)throw s;return this.spellCache.set(e,a||[]),this.lastFetchTimestamp=t,{data:a||[],error:null,success:!0}}catch(a){return{data:null,error:a instanceof Error?a.message:"Erro desconhecido",success:!1}}}static calculateScaledSpellDamage(e,t){if(!("intelligence"in t)||!("wisdom"in t)||!("magic_mastery"in t))return e;const a=t.intelligence||10,s=t.wisdom||10,r=t.magic_mastery||1;let n=1.8*Math.pow(a,1.35)+1.2*Math.pow(s,1.2)+2.5*Math.pow(r,1.2);n>150&&(n=150+.6*(n-150)),n=Math.min(300,n);return Math.round(e*(1+n/100))}static calculateScaledSpellHealing(e,t){if(!("wisdom"in t)||!("magic_mastery"in t))return e;const a=t.wisdom||10,s=t.magic_mastery||1;let r=2.2*Math.pow(a,1.3)+1.8*Math.pow(s,1.15);r>120&&(r=120+.5*(r-120)),r=Math.min(220,r);return Math.round(e*(1+r/100))}static applySpellEffect(e,t,a){const s={damage:()=>{const s=this.calculateScaledSpellDamage(e.effect_value,t);return a.hp=Math.max(0,a.hp-s),`${e.name} causou ${s} de dano mágico!`},heal:()=>{const s=this.calculateScaledSpellHealing(e.effect_value,t),r="max_hp"in a?a.max_hp:a.maxHp,n=a.hp;a.hp=Math.min(r,a.hp+s);const i=a.hp-n;return`${e.name} restaurou ${i} HP!`},buff:()=>this.applyAttributeEffect(e,a,"buff"),debuff:()=>this.applyAttributeEffect(e,a,"debuff"),dot:()=>this.applyOverTimeEffect(e,a,"dot"),hot:()=>this.applyOverTimeEffect(e,a,"hot")};try{const t=s[e.effect_type]?.()||`${e.name} não teve efeito!`,a=function(e){return"buff"===e.effect_type||"heal"===e.effect_type||"debuff"===e.effect_type}(e);return{message:t,success:!0,endsTurn:a}}catch(r){return{message:`Erro ao usar ${e.name}!`,success:!1,endsTurn:!0}}}static applyAttributeEffect(e,t,a){if(!t.active_effects)return`${e.name} não teve efeito!`;const s={buffs:[...t.active_effects.buffs],debuffs:[...t.active_effects.debuffs],dots:[...t.active_effects.dots],hots:[...t.active_effects.hots],attribute_modifications:t.active_effects.attribute_modifications?[...t.active_effects.attribute_modifications]:[]};if("buff"===a){const r=this.getAttributeModificationsForSpell(e);if(r.length>0){const a=e.duration||3,n=r.map((e=>({...e,duration:a})));s.attribute_modifications.push(...n);const i=n.map((e=>{const t=e.value>0?"+":"",a="percentage"===e.type?"%":"";return`${t}${e.value}${a} ${this.translateAttributeName(e.attribute)}`})).join(", ");return t.active_effects=s,`${e.name} concedeu: ${i} por ${a} turnos!`}{const r=this.calculateScaledSpellDamage(e.effect_value,t),n=e.duration||3,i={type:a,value:r,duration:n,source_spell:e.name};return s.buffs.push(i),t.active_effects=s,`${e.name} aplicou um efeito benéfico genérico (+${r}) por ${n} turnos!`}}{const r=this.getAttributeModificationsForSpell(e);if(r.length>0){const a=e.duration||3,n=r.map((e=>({...e,value:-Math.abs(e.value),duration:a})));s.attribute_modifications.push(...n);const i=n.map((e=>{const t="percentage"===e.type?"%":"";return`${e.value}${t} ${this.translateAttributeName(e.attribute)}`})).join(", ");return t.active_effects=s,`${e.name} reduziu: ${i} por ${a} turnos!`}{const r=this.calculateScaledSpellDamage(e.effect_value,t),n=e.duration||3,i={type:a,value:r,duration:n,source_spell:e.name};return s.debuffs.push(i),t.active_effects=s,`${e.name} aplicou um efeito prejudicial genérico (-${r}) por ${n} turnos!`}}}static applyOverTimeEffect(e,t,a){if(!t.active_effects)return`${e.name} não teve efeito!`;const s="dot"===a?this.calculateScaledSpellDamage(e.effect_value,t):this.calculateScaledSpellHealing(e.effect_value,t),r={type:a,value:s,duration:e.duration,source_spell:e.name},n={buffs:[...t.active_effects.buffs],debuffs:[...t.active_effects.debuffs],dots:[...t.active_effects.dots],hots:[...t.active_effects.hots],attribute_modifications:t.active_effects.attribute_modifications?[...t.active_effects.attribute_modifications]:[]};return"dot"===a?(n.dots.push(r),t.active_effects=n,`${e.name} aplicou dano contínuo (${s} por ${e.duration} turnos)!`):(n.hots.push(r),t.active_effects=n,`${e.name} aplicou cura contínua (${s} por ${e.duration} turnos)!`)}static processOverTimeEffects(e){const t=[];if(!("active_effects"in e)||!e.active_effects)return t;const a={buffs:[...e.active_effects.buffs],debuffs:[...e.active_effects.debuffs],dots:[...e.active_effects.dots],hots:[...e.active_effects.hots],attribute_modifications:e.active_effects.attribute_modifications?[...e.active_effects.attribute_modifications]:[]};return a.dots=a.dots.map((e=>({...e}))).filter((a=>(e.hp=Math.max(0,e.hp-a.value),a.duration--,t.push(`${a.source_spell} causou ${a.value} de dano contínuo.`),a.duration>0))),a.hots=a.hots.map((e=>({...e}))).filter((a=>{const s="max_hp"in e?e.max_hp:e.maxHp,r=e.hp;e.hp=Math.min(s,e.hp+a.value);const n=e.hp-r;return a.duration--,n>0&&t.push(`${a.source_spell} restaurou ${n} HP.`),a.duration>0})),a.attribute_modifications&&(a.attribute_modifications=a.attribute_modifications.map((e=>({...e}))).filter((e=>(e.duration--,!(e.duration<=0)||(t.push(`O efeito de ${e.source_spell} em ${this.translateAttributeName(e.attribute)} expirou.`),!1))))),a.buffs=a.buffs.map((e=>({...e}))).filter((e=>(e.duration--,!(e.duration<=0)||(t.push(`O efeito benéfico de ${e.source_spell} expirou.`),!1)))),a.debuffs=a.debuffs.map((e=>({...e}))).filter((e=>(e.duration--,!(e.duration<=0)||(t.push(`O efeito prejudicial de ${e.source_spell} expirou.`),!1)))),e.active_effects=a,t}static updateSpellCooldowns(e){return{...e,player:{...e.player,spells:e.player.spells.map((e=>({...e,current_cooldown:e.current_cooldown>0?e.current_cooldown-1:0})))}}}static resetSpellCooldowns(e){return{...e,player:{...e.player,spells:e.player.spells.map((e=>({...e,current_cooldown:0})))}}}static getSpellTypeIcon(e){return{damage:"⚔️",heal:"❤️",buff:"🛡️",debuff:"💀",dot:"🔥",hot:"✨"}[e]||"🔮"}static getSpellTypeColor(e){return{damage:"text-red-500",heal:"text-green-500",buff:"text-blue-500",debuff:"text-purple-500",dot:"text-orange-500",hot:"text-emerald-500"}[e]||"text-gray-500"}static translateEffectType(e){return{damage:"Dano",heal:"Cura",buff:"Benefício",debuff:"Maldição",dot:"Dano Contínuo",hot:"Cura Contínua"}[e]||e}static getAttributeModificationsForSpell(e){const t=[],a=e.name.toLowerCase();return[{keywords:["força","strength","fortalecer","fúria","guerreiro","berserker","poder"],attribute:"atk",multiplier:1.2},{keywords:["velocidade","speed","agilidade","pressa","vento","corrida"],attribute:"speed",multiplier:1},{keywords:["defesa","defense","proteção","armadura","barreira","escudo"],attribute:"def",multiplier:1.1},{keywords:["crítico","critical","precisão","foco","mira","acerto"],attribute:"critical_chance",multiplier:.8,type:"percentage"},{keywords:["magia","magic","mystic","arcano","místico","feitiço"],attribute:"magic_attack",multiplier:1.3},{keywords:["destruição","devastação","carnificina","massacre"],attribute:"critical_damage",multiplier:1.5,type:"percentage"}].forEach((({keywords:s,attribute:r,multiplier:n,type:i="flat"})=>{if(s.some((e=>a.includes(e)))){const a=Math.floor(e.effect_value*n),s=Math.max(5,a);t.push({attribute:r,value:s,type:i,duration:e.duration||3,source_spell:e.name,applied_at:Date.now()})}})),t}static translateAttributeName(e){return{atk:"Ataque",def:"Defesa",speed:"Velocidade",magic_attack:"Ataque Mágico",critical_chance:"Chance Crítica",critical_damage:"Dano Crítico"}[e]||e}static async getCharacterEquippedSpells(e){try{const a=this.equippedSpellCache.get(e);if(this.isCacheValid(a))return{data:a.data,error:null,success:!0};const s=this.pendingEquippedRequests.get(e);if(s)try{return await s.promise}catch(t){if(!s.abortController.signal.aborted)throw t}const r=new AbortController,n=this.fetchCharacterEquippedSpells(e,r.signal);this.pendingEquippedRequests.set(e,{promise:n,abortController:r});try{const t=await n;return t.success&&t.data&&this.equippedSpellCache.set(e,{data:t.data,timestamp:Date.now(),isValid:!0}),t}finally{this.pendingEquippedRequests.delete(e)}}catch(t){return{data:null,error:t instanceof Error?t.message:"Erro desconhecido",success:!1}}}static async fetchCharacterEquippedSpells(e,t){const{data:a,error:s}=await Aa.from("spell_slots").select("\n        slot_position,\n        spell_id,\n        spell:spells(\n          id,\n          name,\n          description,\n          mana_cost,\n          cooldown,\n          effect_type,\n          effect_value,\n          duration,\n          unlocked_at_level\n        )\n      ").eq("character_id",e).not("spell_id","is",null).order("slot_position");if(t.aborted)throw new Error("Request cancelado");if(s)throw s;return{data:(a||[]).map((e=>{const t=Array.isArray(e.spell)?e.spell[0]:e.spell;return{id:t.id,name:t.name,description:t.description,mana_cost:t.mana_cost,cooldown:t.cooldown,current_cooldown:0,effect_type:t.effect_type,effect_value:t.effect_value,duration:t.duration||0,unlocked_at_level:t.unlocked_at_level}})),error:null,success:!0}}}const vh=Object.freeze(Object.defineProperty({__proto__:null,SpellService:bh},Symbol.toStringTag,{value:"Module"}));async function yh(e,t,a){const{loadSpells:s=!0}={},{baseStats:r,totalStats:n,derivedStats:i,equipmentBonuses:o}=await async function(e,t){const a=await hh.calculateDerivedStats(e),s=await gh.getEquipmentBonuses(t),r=s.success&&s.data?s.data:{total_atk_bonus:0,total_def_bonus:0,total_mana_bonus:0,total_speed_bonus:0,total_hp_bonus:0,total_critical_chance_bonus:0,total_critical_damage_bonus:0},n={hp:a.hp,max_hp:a.max_hp,mana:a.mana,max_mana:a.max_mana,atk:a.atk,def:a.def,speed:a.speed};return{baseStats:n,totalStats:{hp:n.hp+r.total_hp_bonus,max_hp:n.max_hp+r.total_hp_bonus,mana:n.mana+r.total_mana_bonus,max_mana:n.max_mana+r.total_mana_bonus,atk:n.atk+r.total_atk_bonus,def:n.def+r.total_def_bonus,speed:n.speed+r.total_speed_bonus},derivedStats:a,equipmentBonuses:r}}(e,t),l={id:e.id,user_id:e.user_id,name:e.name,level:e.level,xp:e.xp,xp_next_level:e.xp_next_level,gold:e.gold,hp:n.hp,max_hp:n.max_hp,mana:n.mana,max_mana:n.max_mana,atk:n.atk,def:n.def,speed:n.speed,created_at:e.created_at,updated_at:e.updated_at,isPlayerTurn:!0,specialCooldown:0,defenseCooldown:0,isDefending:!1,floor:e.floor,spells:[],consumables:[],active_effects:{buffs:[],debuffs:[],dots:[],hots:[],attribute_modifications:[]},strength:e.strength||10,dexterity:e.dexterity||10,intelligence:e.intelligence||10,wisdom:e.wisdom||10,vitality:e.vitality||10,luck:e.luck||10,attribute_points:e.attribute_points||0,sword_mastery:e.sword_mastery||1,axe_mastery:e.axe_mastery||1,blunt_mastery:e.blunt_mastery||1,defense_mastery:e.defense_mastery||1,magic_mastery:e.magic_mastery||1,sword_mastery_xp:e.sword_mastery_xp||0,axe_mastery_xp:e.axe_mastery_xp||0,blunt_mastery_xp:e.blunt_mastery_xp||0,defense_mastery_xp:e.defense_mastery_xp||0,magic_mastery_xp:e.magic_mastery_xp||0,critical_chance:i.critical_chance+o.total_critical_chance_bonus,critical_damage:i.critical_damage+o.total_critical_damage_bonus,magic_damage_bonus:i.magic_damage_bonus,magic_attack:i.magic_attack,double_attack_chance:i.double_attack_chance,base_hp:r.hp,base_max_hp:r.max_hp,base_mana:r.mana,base_max_mana:r.max_mana,base_atk:r.atk,base_def:r.def,base_speed:r.speed,equipment_hp_bonus:o.total_hp_bonus,equipment_mana_bonus:o.total_mana_bonus,equipment_atk_bonus:o.total_atk_bonus,equipment_def_bonus:o.total_def_bonus,equipment_speed_bonus:o.total_speed_bonus};if(s)try{const e=await bh.getCharacterEquippedSpells(t);l.spells=e.success&&e.data?e.data:[]}catch(c){l.spells=[]}return l}const jh=new class{characterCache=new Map;cacheTimestamps=new Map;userCharactersCache=new Map;userCacheTimestamps=new Map;pendingRequests=new Map;getCachedCharacter(e){return this.characterCache.get(e)||null}getCacheTimestamp(e){return this.cacheTimestamps.get(e)||null}setCachedCharacter(e,t){this.characterCache.set(e,t),this.cacheTimestamps.set(e,Date.now())}invalidateCharacterCache(e){this.characterCache.delete(e),this.cacheTimestamps.delete(e)}getCachedUserCharacters(e){const t=this.userCharactersCache.get(e),a=this.userCacheTimestamps.get(e);if(!t||!a)return{isValid:!1,characters:[]};return{isValid:Date.now()-a<15e3,characters:t}}setCachedUserCharacters(e,t){this.userCharactersCache.set(e,t),this.userCacheTimestamps.set(e,Date.now())}invalidateUserCache(e){this.userCharactersCache.delete(e),this.userCacheTimestamps.delete(e)}getPendingRequest(e){return this.pendingRequests.get(e)||null}setPendingRequest(e,t){this.pendingRequests.set(e,t),t.finally((()=>this.pendingRequests.delete(e)))}clearAll(){this.characterCache.clear(),this.cacheTimestamps.clear(),this.userCharactersCache.clear(),this.userCacheTimestamps.clear(),this.pendingRequests.clear()}};class Nh{static async getUserCharacters(e){try{const t=jh.getCachedUserCharacters(e);if(t.isValid)return{data:t.characters,error:null,success:!0};const{data:a,error:s}=await Aa.rpc("get_user_characters",{p_user_id:e});if(s)throw s;const r=a;return jh.setCachedUserCharacters(e,r),{data:r,error:null,success:!0}}catch(t){return{data:null,error:t instanceof Error?t.message:"Erro ao buscar personagens",success:!1}}}static async getCharacter(e){try{const t=jh.getCachedCharacter(e);if(t)return{data:t,error:null,success:!0};const a=jh.getPendingRequest(e);if(a){return await a}const s=this.fetchCharacterFromServer(e);jh.setPendingRequest(e,s);return await s}catch(t){return{data:null,error:t instanceof Error?t.message:"Erro ao buscar personagem",success:!1}}}static async fetchCharacterFromServer(e){try{const a=new Promise(((e,t)=>{setTimeout((()=>t(new Error("Timeout ao buscar personagem"))),8e3)})),s=Aa.rpc("get_character_full_stats",{p_character_id:e}).single();try{const{data:t,error:r}=await Promise.race([s,a]);if(r)return await this.fetchCharacterFromServerFallback(e);if(!t)return await this.fetchCharacterFromServerFallback(e);if(!t||"object"!=typeof t||!("character_id"in t))return await this.fetchCharacterFromServerFallback(e);const n=await this.convertRPCDataToCharacter(t,e);return jh.setCachedCharacter(e,n),{data:n,error:null,success:!0}}catch(t){return await this.fetchCharacterFromServerFallback(e)}}catch(a){return{data:null,error:a instanceof Error?a.message:"Erro ao buscar personagem",success:!1}}}static async fetchCharacterFromServerFallback(e){try{const{data:t,error:a}=await Aa.from("characters").select("*").eq("id",e).maybeSingle();if(a)throw a;if(!t)return{data:null,error:"Personagem não encontrado",success:!1};const s=await hh.calculateDerivedStats(t),r={id:t.id,user_id:t.user_id,name:t.name,level:t.level,xp:t.xp,xp_next_level:t.xp_next_level,gold:t.gold,hp:s.hp,max_hp:s.max_hp,mana:s.mana,max_mana:s.max_mana,atk:s.atk,def:s.def,speed:s.speed,floor:t.floor,strength:t.strength||10,dexterity:t.dexterity||10,intelligence:t.intelligence||10,wisdom:t.wisdom||10,vitality:t.vitality||10,luck:t.luck||10,attribute_points:t.attribute_points||0,critical_chance:s.critical_chance,critical_damage:s.critical_damage,sword_mastery:t.sword_mastery||1,axe_mastery:t.axe_mastery||1,blunt_mastery:t.blunt_mastery||1,defense_mastery:t.defense_mastery||1,magic_mastery:t.magic_mastery||1,sword_mastery_xp:t.sword_mastery_xp||0,axe_mastery_xp:t.axe_mastery_xp||0,blunt_mastery_xp:t.blunt_mastery_xp||0,defense_mastery_xp:t.defense_mastery_xp||0,magic_mastery_xp:t.magic_mastery_xp||0,is_alive:!0,created_at:t.created_at,updated_at:t.updated_at,last_activity:t.last_activity};return jh.setCachedCharacter(e,r),{data:r,error:null,success:!0}}catch(t){return{data:null,error:t instanceof Error?t.message:"Erro ao buscar personagem",success:!1}}}static async convertRPCDataToCharacter(e,t){if(!e.character_id||!e.name||null===e.level||void 0===e.level)throw new Error("RPC retornou dados incompletos do personagem: faltam id, name ou level");if(e.level<1||e.level>100)throw new Error(`RPC retornou nível inválido: ${e.level}`);const a={id:e.character_id,user_id:"",name:e.name,level:e.level,xp:e.xp,xp_next_level:e.xp_next_level,gold:e.gold,hp:e.hp,max_hp:e.max_hp,mana:e.mana,max_mana:e.max_mana,atk:e.atk,def:e.def,speed:e.speed,floor:1,strength:e.strength,dexterity:e.dexterity,intelligence:e.intelligence,wisdom:e.wisdom,vitality:e.vitality,luck:e.luck,attribute_points:e.attribute_points||0,critical_chance:e.critical_chance,critical_damage:e.critical_damage,sword_mastery:e.sword_mastery,axe_mastery:e.axe_mastery,blunt_mastery:e.blunt_mastery,defense_mastery:e.defense_mastery,magic_mastery:e.magic_mastery,sword_mastery_xp:e.sword_mastery_xp,axe_mastery_xp:e.axe_mastery_xp,blunt_mastery_xp:e.blunt_mastery_xp,defense_mastery_xp:e.defense_mastery_xp,magic_mastery_xp:e.magic_mastery_xp,is_alive:!0,created_at:"",updated_at:"",last_activity:void 0},{data:s,error:r}=await Aa.from("characters").select("user_id, floor, created_at, updated_at, last_activity").eq("id",a.id).maybeSingle();if(r)throw new Error(`Erro ao buscar dados adicionais do personagem: ${r.message}`);if(!s)throw new Error(`Personagem ${a.id} não encontrado na tabela characters`);return a.user_id=s.user_id,a.floor=Math.max(1,s.floor||1),a.created_at=s.created_at,a.updated_at=s.updated_at,a.last_activity=s.last_activity,jh.setCachedCharacter(t,a),a}static async createCharacter(e){try{const t=xh.validateCharacterName(e.name);if(!t.isValid)return{data:null,error:t.error||"Nome inválido",success:!1};const a=await uh.checkCharacterLimit(e.user_id);if(!a.success||!a.data?.can_create){const e=a.data?.next_slot_required_level||0;return{data:null,error:`Limite de personagens atingido. Para criar o ${(a.data?.available_slots||3)+1}º personagem, você precisa de ${e} níveis totais entre todos os seus personagens.`,success:!1}}const s=xh.formatCharacterName(e.name),r=await async function(e,t){const a=xh.formatCharacterName(e),s=await Nh.getUserCharacters(t),r=s.success&&s.data?s.data:[];if(0===r.length)return{isValid:!0};const n=r.map((e=>e.name));if(xh.isTooSimilar(a,n)){const e=xh.generateNameSuggestions(a);return{isValid:!1,error:`Nome muito similar a um personagem existente. Sugestões: ${e.join(", ")}`,suggestions:e}}return{isValid:!0}}(s,e.user_id);if(!r.isValid)return{data:null,error:r.error||"Nome inválido",success:!1};const{data:n,error:i}=await Aa.rpc("create_character",{p_user_id:e.user_id,p_name:s});if(i){if(i.message.includes("Nome"))return{data:null,error:i.message,success:!1};if(i.message.includes("Limite")||i.message.includes("personagem"))return{data:null,error:i.message,success:!1};throw i}return jh.invalidateUserCache(e.user_id),{data:{id:n},error:null,success:!0}}catch(t){return{data:null,error:t instanceof Error?t.message:"Erro ao criar personagem",success:!1}}}static async deleteCharacter(e){try{const a=await this.getCharacter(e);let s=null;if(a.success&&a.data&&a.data.floor>0){s=a.data.user_id;try{const{error:t}=await Aa.rpc("save_ranking_entry_on_death",{p_character_id:e})}catch(t){}}const{error:r}=await Aa.rpc("delete_character",{p_character_id:e});if(r)throw r;return jh.invalidateCharacterCache(e),s&&jh.invalidateUserCache(s),{error:null}}catch(a){return{error:a instanceof Error?a.message:"Erro ao deletar personagem"}}}static async getCharacterStats(e){try{const t=await this.getCharacterForGame(e);if(!t.success||!t.data)return{success:!1,error:t.error||"Erro ao carregar dados do personagem",data:null};const a=t.data;return{success:!0,error:null,data:{level:a.level,xp:a.xp,xp_next_level:a.xp_next_level,gold:a.gold,hp:a.hp,max_hp:a.max_hp,mana:a.mana,max_mana:a.max_mana,atk:a.atk,def:a.def,speed:a.speed,strength:a.strength||10,dexterity:a.dexterity||10,intelligence:a.intelligence||10,wisdom:a.wisdom||10,vitality:a.vitality||10,luck:a.luck||10,attribute_points:a.attribute_points||0,critical_chance:a.critical_chance||0,critical_damage:a.critical_damage||0,magic_damage_bonus:a.magic_damage_bonus||0,magic_attack:a.magic_attack||0,sword_mastery:a.sword_mastery||1,axe_mastery:a.axe_mastery||1,blunt_mastery:a.blunt_mastery||1,defense_mastery:a.defense_mastery||1,magic_mastery:a.magic_mastery||1,sword_mastery_xp:a.sword_mastery_xp||0,axe_mastery_xp:a.axe_mastery_xp||0,blunt_mastery_xp:a.blunt_mastery_xp||0,defense_mastery_xp:a.defense_mastery_xp||0,magic_mastery_xp:a.magic_mastery_xp||0,base_hp:a.base_hp||a.base_max_hp,base_max_hp:a.base_max_hp,base_mana:a.base_mana||a.base_max_mana,base_max_mana:a.base_max_mana,base_atk:a.base_atk,base_def:a.base_def,base_speed:a.base_speed,equipment_hp_bonus:a.equipment_hp_bonus||0,equipment_mana_bonus:a.equipment_mana_bonus||0,equipment_atk_bonus:a.equipment_atk_bonus||0,equipment_def_bonus:a.equipment_def_bonus||0,equipment_speed_bonus:a.equipment_speed_bonus||0}}}catch(t){return{success:!1,error:t instanceof Error?t.message:"Erro desconhecido",data:null}}}static async getCharacterForGame(e,t=!1,a=!0){try{if(!t){const t=jh.getCachedCharacter(e),a=jh.getCacheTimestamp(e);if(t&&a&&Date.now()-a<3e5){return{success:!0,error:null,data:await yh(t,e)}}}const{data:r,error:n}=await Aa.from("characters").select("*").eq("id",e).maybeSingle();if(n)throw n;if(!r)return{success:!1,error:"Personagem não encontrado",data:null};if(a)try{const t=await dh.applyAutoHeal(r,!0);t.success&&t.data&&t.data.healed&&(r.hp=t.data.newHp,r.mana=t.data.character.mana,jh.invalidateCharacterCache(e))}catch(s){}const i=await yh(r,e),o={...r,hp:i.hp,max_hp:i.max_hp,mana:i.mana,max_mana:i.max_mana,atk:i.base_atk,def:i.base_def,speed:i.base_speed,critical_chance:i.critical_chance,critical_damage:i.critical_damage};return jh.setCachedCharacter(e,o),{success:!0,error:null,data:i}}catch(r){return{success:!1,error:r instanceof Error?r.message:"Erro desconhecido",data:null}}}static invalidateCharacterCache(e){jh.invalidateCharacterCache(e)}static async debugForceFullHeal(e){try{const t=await this.getCharacter(e);if(!t.success||!t.data)return{success:!1,message:"Personagem não encontrado"};const a=t.data,s=await dh.updateCharacterHpMana(e,a.max_hp,a.max_mana);return s.success?(this.invalidateCharacterCache(e),{success:!0,message:`Cura forçada aplicada: ${a.hp} -> ${a.max_hp} HP, ${a.mana} -> ${a.max_mana} Mana`}):{success:!1,message:s.error||"Erro ao atualizar HP/Mana"}}catch(t){return{success:!1,message:t instanceof Error?t.message:"Erro desconhecido"}}}static getUnlockedCheckpoints=mh.getUnlockedCheckpoints;static startFromCheckpoint=mh.startFromCheckpoint;static resetCharacterProgress=mh.resetCharacterProgress;static updateCharacterFloor=mh.updateCharacterFloor;static updateCharacterHpMana=dh.updateCharacterHpMana;static applyAutoHeal=dh.applyAutoHeal;static forceFullHealForHub=dh.forceFullHealForHub;static updateLastActivity=dh.updateLastActivity;static getUserCharacterProgression=uh.getUserCharacterProgression;static checkCharacterLimit=uh.checkCharacterLimit;static grantSecureXP=uh.grantSecureXP;static grantSecureGold=uh.grantSecureGold;static addSkillXp=uh.addSkillXp;static updateGold=uh.updateGold;static calculateDerivedStats=hh.calculateDerivedStats;static distributeAttributePoints=ph.distributeAttributePoints;static recalculateCharacterStats=ph.recalculateCharacterStats}const _h=W,wh=U,Ch=e.forwardRef((({className:e,...a},s)=>t.jsx(B,{ref:s,className:Ga("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",e),...a})));Ch.displayName=B.displayName;const Sh=e.forwardRef((({className:e,children:a,...s},r)=>t.jsxs(wh,{children:[t.jsx(Ch,{}),t.jsxs(z,{ref:r,className:Ga("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",e),...s,children:[a,t.jsxs(H,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[t.jsx(G,{className:"h-4 w-4"}),t.jsx("span",{className:"sr-only",children:"Close"})]})]})]})));Sh.displayName=z.displayName;const Eh=({className:e,...a})=>t.jsx("div",{className:Ga("flex flex-col space-y-1.5 text-center sm:text-left",e),...a});Eh.displayName="DialogHeader";const kh=({className:e,...a})=>t.jsx("div",{className:Ga("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",e),...a});kh.displayName="DialogFooter";const Ah=e.forwardRef((({className:e,...a},s)=>t.jsx(X,{ref:s,className:Ga("text-lg font-semibold leading-none tracking-tight",e),...a})));Ah.displayName=X.displayName;const Ph=e.forwardRef((({className:e,...a},s)=>t.jsx(Xe,{ref:s,className:Ga("text-sm text-muted-foreground",e),...a})));Ph.displayName=Xe.displayName;var Mh="Progress",[Th,qh]=Ne(Mh),[Dh,Lh]=Th(Mh),$h=e.forwardRef(((e,a)=>{const{__scopeProgress:s,value:r=null,max:n,getValueLabel:i=Fh,...o}=e;(n||0===n)&&Bh(n);const l=Bh(n)?n:100;null!==r&&Uh(r,l);const c=Uh(r,l)?r:null,d=Oh(c)?i(c,l):void 0;return t.jsx(Dh,{scope:s,value:c,max:l,children:t.jsx(re.div,{"aria-valuemax":l,"aria-valuemin":0,"aria-valuenow":Oh(c)?c:void 0,"aria-valuetext":d,role:"progressbar","data-state":Vh(c,l),"data-value":c??void 0,"data-max":l,...o,ref:a})})}));$h.displayName=Mh;var Rh="ProgressIndicator",Ih=e.forwardRef(((e,a)=>{const{__scopeProgress:s,...r}=e,n=Lh(Rh,s);return t.jsx(re.div,{"data-state":Vh(n.value,n.max),"data-value":n.value??void 0,"data-max":n.max,...r,ref:a})}));function Fh(e,t){return`${Math.round(e/t*100)}%`}function Vh(e,t){return null==e?"indeterminate":e===t?"complete":"loading"}function Oh(e){return"number"==typeof e}function Bh(e){return Oh(e)&&!isNaN(e)&&e>0}function Uh(e,t){return Oh(e)&&!isNaN(e)&&e<=t&&e>=0}Ih.displayName=Rh;var zh=$h,Hh=Ih;const Gh=e.forwardRef((({className:e,value:a,...s},r)=>t.jsx(zh,{ref:r,className:Ga("relative h-2 w-full overflow-hidden rounded-full bg-secondary",e),...s,children:t.jsx(Hh,{className:"h-full w-full flex-1 bg-primary transition-all",style:{transform:`translateX(-${100-(a||0)}%)`}})})));Gh.displayName=zh.displayName;const Xh=I("relative w-full rounded-lg border px-4 py-3 text-sm [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground [&>svg~*]:pl-7",{variants:{variant:{default:"bg-background text-foreground",destructive:"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive"}},defaultVariants:{variant:"default"}}),Wh=e.forwardRef((({className:e,variant:a,...s},r)=>t.jsx("div",{ref:r,role:"alert",className:Ga(Xh({variant:a}),e),...s})));Wh.displayName="Alert";e.forwardRef((({className:e,...a},s)=>t.jsx("h5",{ref:s,className:Ga("mb-1 font-medium leading-none tracking-tight",e),...a}))).displayName="AlertTitle";const Yh=e.forwardRef((({className:e,...a},s)=>t.jsx("div",{ref:s,className:Ga("text-sm [&_p]:leading-relaxed",e),...a})));Yh.displayName="AlertDescription";const Kh=l("/_authenticated/game/play")({component:function(){if("/game/play"===n().pathname)return t.jsx(Jh,{});return t.jsx(s,{})}});function Jh(){const a=r(),{user:s}=Oa(),[n,i]=e.useState([]),[o,l]=e.useState(null),[c,d]=e.useState([]),[m,u]=e.useState(!0),[h,p]=e.useState(!1),[x,f]=e.useState(""),[g,b]=e.useState({isValid:!0}),[v,y]=e.useState(!1),[j,N]=e.useState(!1),[w,C]=e.useState(null);e.useEffect((()=>{s?.id&&S()}),[s?.id]),e.useEffect((()=>{if(x.trim()){const e=xh.validateCharacterName(x);if(e.isValid&&n.length>0){const t=n.map((e=>e.name)),a=xh.formatCharacterName(x);if(xh.isTooSimilar(a,t)){const e=xh.generateNameSuggestions(a);b({isValid:!1,error:"Nome muito similar a um personagem existente",suggestions:e})}else b(e)}else b(e)}else b({isValid:!0})}),[x,n]);const S=async()=>{try{u(!0);const e=await Nh.getUserCharacters(s.id);e.success&&e.data&&i(e.data);const t=await Nh.getUserCharacterProgression(s.id);t.success&&t.data&&l(t.data)}catch(e){_.error("Erro ao carregar dados dos personagens")}finally{u(!1)}};e.useEffect((()=>{if(o&&void 0!==n){const e=[];for(let t=1;t<=20;t++){const a=n.find((e=>n.indexOf(e)+1===t))||null,s=t<=o.max_character_slots,r=E(t);e.push({slotNumber:t,character:a,isUnlocked:s,requiredTotalLevel:r})}d(e)}}),[o,n]);const E=e=>e<=3?0:15*(e-3),k=()=>{p(!1),f(""),b({isValid:!0})},A=e=>{const a=(s=e.level,Math.floor(100*Math.pow(1.1,s-1)));var s;const r=e.xp/a*100;return t.jsxs("div",{className:"space-y-2 text-sm",children:[t.jsxs("div",{className:"flex justify-between",children:[t.jsx("span",{children:"Nível:"}),t.jsx("span",{className:"font-medium",children:e.level})]}),t.jsxs("div",{className:"space-y-1",children:[t.jsxs("div",{className:"flex justify-between",children:[t.jsx("span",{children:"XP:"}),t.jsxs("span",{className:"font-medium",children:[e.xp,"/",a]})]}),t.jsx(Gh,{value:r,className:"h-2"})]}),t.jsxs("div",{className:"flex justify-between",children:[t.jsx("span",{children:"Andar Máximo:"}),t.jsx("span",{className:"font-medium",children:e.floor})]}),t.jsxs("div",{className:"flex justify-between",children:[t.jsx("span",{children:"Ouro:"}),t.jsx("span",{className:"font-medium text-yellow-600",children:e.gold})]})]})};return m?t.jsx("div",{className:"container mx-auto p-2 md:p-4",children:t.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:t.jsxs("div",{className:"text-center",children:[t.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary mx-auto mb-4"}),t.jsx("p",{children:"Carregando personagens..."})]})})}):t.jsxs("div",{className:"container mx-auto p-2 md:p-4 max-w-6xl",children:[t.jsxs("div",{className:"flex items-center justify-between mb-4 md:mb-6",children:[t.jsxs("div",{className:"flex items-center gap-4",children:[t.jsxs(Wa,{variant:"ghost",size:"sm",onClick:()=>a({to:"/game"}),children:[t.jsx(Pe,{className:"h-4 w-4 mr-2"}),"Voltar"]}),t.jsxs("div",{children:[t.jsx("h1",{className:"text-2xl font-bold",children:"Selecionar Personagem"}),t.jsx("p",{className:"text-muted-foreground",children:"Escolha um personagem para jogar"})]})]}),o&&t.jsxs("div",{className:"text-right",children:[t.jsx("div",{className:"text-sm text-muted-foreground",children:"Progressão Total"}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(Oe,{className:"h-4 w-4"}),t.jsx("span",{className:"font-medium",children:o.total_character_level}),t.jsx("span",{className:"text-muted-foreground",children:"nível"})]}),t.jsxs("div",{className:"text-xs text-muted-foreground",children:[o.max_character_slots,"/",20," slots"]})]})]}),t.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4",children:c.map((e=>{if(!e.isUnlocked)return t.jsx(pu,{className:"opacity-50",children:t.jsxs(bu,{className:"p-4 text-center",children:[t.jsx(Ye,{className:"h-8 w-8 mx-auto mb-2 text-muted-foreground"}),t.jsxs("p",{className:"text-sm text-muted-foreground",children:["Slot ",e.slotNumber]}),t.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:["Requer nível total ",e.requiredTotalLevel]})]})},e.slotNumber);if(!e.character)return t.jsx(pu,{className:"cursor-pointer hover:bg-accent/50 border-dashed",children:t.jsxs(bu,{className:"p-4 text-center",onClick:()=>{p(!0)},children:[t.jsx(Ke,{className:"h-8 w-8 mx-auto mb-2 text-muted-foreground"}),t.jsx("p",{className:"text-sm text-muted-foreground",children:"Criar Personagem"}),t.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:["Slot ",e.slotNumber]})]})},e.slotNumber);const a=e.character,s=a.hp>0;return t.jsxs(pu,{className:"cursor-pointer hover:bg-accent/50 "+(s?"":"border-red-500/50 bg-red-500/5"),onClick:()=>s&&(e=>{C(e),N(!0)})(a),style:{cursor:s?"pointer":"not-allowed"},children:[t.jsx(xu,{className:"pb-2",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs(fu,{className:"text-base flex items-center gap-2",children:[a.name,!s&&t.jsx($e,{className:"h-4 w-4 text-red-500"}),a.floor>=100&&t.jsx(Je,{className:"h-4 w-4 text-yellow-500"})]}),t.jsxs("div",{className:"text-xs text-muted-foreground",children:["Slot ",e.slotNumber]})]})}),t.jsxs(bu,{className:"pt-0",children:[A(a),!s&&t.jsxs(Wh,{className:"mt-3 border-red-500/50 bg-red-500/10",children:[t.jsx($e,{className:"h-4 w-4 text-red-500"}),t.jsx(Yh,{className:"text-red-700",children:"Este personagem morreu permanentemente"})]})]})]},e.slotNumber)}))}),t.jsx(_h,{open:h,onOpenChange:p,children:t.jsxs(Sh,{children:[t.jsxs(Eh,{children:[t.jsx(Ah,{children:"Criar Novo Personagem"}),t.jsx(Ph,{children:"Escolha um nome para seu novo personagem. Lembre-se: a morte é permanente!"})]}),t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{children:[t.jsx(Ms,{placeholder:"Nome do personagem",value:x,onChange:e=>f(e.target.value),className:g.isValid?"":"border-red-500"}),!g.isValid&&g.error&&t.jsxs(Wh,{className:"mt-2 border-red-500/50 bg-red-500/10",children:[t.jsx(We,{className:"h-4 w-4 text-red-500"}),t.jsx(Yh,{className:"text-red-700",children:g.error})]}),g.suggestions&&g.suggestions.length>0&&t.jsxs("div",{className:"mt-2",children:[t.jsx("p",{className:"text-sm text-muted-foreground mb-2",children:"Sugestões:"}),t.jsx("div",{className:"flex flex-wrap gap-2",children:g.suggestions.map(((e,a)=>t.jsx(Wa,{variant:"outline",size:"sm",onClick:()=>(e=>{f(e)})(e),children:e},a)))})]})]}),t.jsxs(Wh,{children:[t.jsx($e,{className:"h-4 w-4"}),t.jsxs(Yh,{children:[t.jsx("strong",{children:"Aviso:"})," Este jogo possui morte permanente (permadeath). Se seu personagem morrer, ele será perdido para sempre!"]})]}),t.jsxs("div",{className:"flex justify-end gap-2",children:[t.jsx(Wa,{variant:"outline",onClick:k,children:"Cancelar"}),t.jsx(Wa,{onClick:async()=>{if(s?.id&&x.trim()&&g.isValid){y(!0);try{const e=await Nh.createCharacter({user_id:s.id,name:x.trim()});e.success&&e.data?(_.success("Personagem criado com sucesso!",{description:`${xh.formatCharacterName(x)} foi criado!`}),await S(),k()):_.error("Erro ao criar personagem",{description:e.error})}catch(e){_.error("Erro ao criar personagem")}finally{y(!1)}}},disabled:!x.trim()||!g.isValid||v,children:v?"Criando...":"Criar Personagem"})]})]})]})}),t.jsx(_h,{open:j,onOpenChange:N,children:t.jsxs(Sh,{children:[t.jsxs(Eh,{children:[t.jsx(Ah,{children:"Confirmar Seleção"}),t.jsxs(Ph,{children:["Você está prestes a jogar com ",w?.name]})]}),t.jsxs(Wh,{children:[t.jsx(te,{className:"h-4 w-4"}),t.jsxs(Yh,{children:[t.jsx("strong",{children:"Lembrete:"})," Este jogo possui morte permanente. Se seu personagem morrer durante a aventura, ele será perdido para sempre!"]})]}),t.jsxs("div",{className:"flex justify-end gap-2",children:[t.jsx(Wa,{variant:"outline",onClick:()=>N(!1),className:"cursor-pointer",children:"Cancelar"}),t.jsxs(Wa,{onClick:async()=>{if(w)try{const e=await Nh.getCharacter(w.id);e.success&&e.data?a({to:"/game/play/hub",search:{character:w.id}}):_.error("Erro ao selecionar personagem",{description:e.error})}catch(e){_.error("Erro ao selecionar personagem")}},className:"cursor-pointer",children:[t.jsx(ke,{className:"h-4 w-4 mr-2"}),"Confirmar e Jogar"]})]})]})})]})}const Qh=tt,Zh=e.forwardRef((({className:e,...a},s)=>t.jsx(Qe,{ref:s,className:Ga("inline-flex h-9 items-center justify-center rounded-lg bg-muted p-1 text-muted-foreground",e),...a})));Zh.displayName=Qe.displayName;const ep=e.forwardRef((({className:e,...a},s)=>t.jsx(Ze,{ref:s,className:Ga("inline-flex items-center justify-center whitespace-nowrap rounded-md px-3 py-1 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow",e),...a})));ep.displayName=Ze.displayName;const tp=e.forwardRef((({className:e,...a},s)=>t.jsx(et,{ref:s,className:Ga("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",e),...a})));function ap({className:e,children:a,...s}){return t.jsxs(at,{"data-slot":"scroll-area",className:Ga("relative",e),...s,children:[t.jsx(st,{"data-slot":"scroll-area-viewport",className:"focus-visible:ring-ring/50 size-full rounded-[inherit] transition-[color,box-shadow] outline-none focus-visible:ring-[3px] focus-visible:outline-1",children:a}),t.jsx(sp,{}),t.jsx(rt,{})]})}function sp({className:e,orientation:a="vertical",...s}){return t.jsx(nt,{"data-slot":"scroll-area-scrollbar",orientation:a,className:Ga("flex touch-none p-px transition-colors select-none","vertical"===a&&"h-full w-2.5 border-l border-l-transparent","horizontal"===a&&"h-2.5 flex-col border-t border-t-transparent",e),...s,children:t.jsx(it,{"data-slot":"scroll-area-thumb",className:"bg-border relative flex-1 rounded-full"})})}tp.displayName=et.displayName;const rp=l("/_authenticated/game/guide")({component:function(){const e=r();return t.jsxs("div",{className:"container mx-auto p-2 md:p-4 max-w-6xl",children:[t.jsx("div",{className:"flex items-center justify-between mb-4 md:mb-6",children:t.jsxs("div",{className:"flex items-center gap-4",children:[t.jsxs(Wa,{variant:"ghost",size:"sm",onClick:()=>e({to:"/game"}),children:[t.jsx(Pe,{className:"h-4 w-4 mr-2"}),"Voltar"]}),t.jsxs("div",{children:[t.jsx("h1",{className:"text-2xl font-bold",children:"Guia do Jogo"}),t.jsx("p",{className:"text-muted-foreground",children:"Aprenda a jogar Tower Trials"})]})]})}),t.jsxs(Qh,{defaultValue:"basics",className:"w-full",children:[t.jsxs(Zh,{className:"grid w-full grid-cols-2 lg:grid-cols-4",children:[t.jsx(ep,{value:"basics",children:"Básico"}),t.jsx(ep,{value:"combat",children:"Combate"}),t.jsx(ep,{value:"progression",children:"Progressão"}),t.jsx(ep,{value:"items",children:"Itens"})]}),t.jsx(tp,{value:"basics",children:t.jsx(pu,{className:"p-6",children:t.jsx(ap,{className:"h-[600px] pr-4",children:t.jsxs("section",{className:"space-y-4",children:[t.jsx("h2",{className:"text-2xl font-bold",children:"Conceitos Básicos"}),t.jsxs("div",{className:"space-y-4",children:[t.jsx("h3",{className:"text-xl font-semibold",children:"Sobre o Jogo"}),t.jsx("p",{children:"Tower Trials é um jogo de RPG roguelike onde você sobe uma torre misteriosa, enfrentando monstros cada vez mais fortes a cada andar. Sua missão é subir o máximo possível, fortalecendo seu personagem e coletando equipamentos poderosos."}),t.jsx("h3",{className:"text-xl font-semibold",children:"Personagens"}),t.jsx("p",{children:"Cada jogador pode ter até 3 personagens ativos. Quando um personagem morre, ele é permanentemente deletado (sistema Permadeath). Os personagens possuem os seguintes atributos base:"}),t.jsxs("ul",{className:"list-disc list-inside space-y-2 ml-4",children:[t.jsxs("li",{children:[t.jsx("strong",{children:"HP (Pontos de Vida):"})," Determina quanto dano você pode receber"]}),t.jsxs("li",{children:[t.jsx("strong",{children:"Mana:"})," Recurso usado para lançar magias"]}),t.jsxs("li",{children:[t.jsx("strong",{children:"ATK (Ataque):"})," Determina o dano base dos seus ataques"]}),t.jsxs("li",{children:[t.jsx("strong",{children:"DEF (Defesa):"})," Reduz o dano recebido"]}),t.jsxs("li",{children:[t.jsx("strong",{children:"Speed (Velocidade):"})," Afeta suas chances de fuga e ordem de ações"]})]}),t.jsx("h3",{className:"text-xl font-semibold",children:"A Torre"}),t.jsx("p",{children:"A torre é dividida em andares com diferentes características:"}),t.jsxs("ul",{className:"list-disc list-inside space-y-2 ml-4",children:[t.jsxs("li",{children:[t.jsx("strong",{children:"Andares Comuns:"})," Encontros normais com monstros"]}),t.jsxs("li",{children:[t.jsx("strong",{children:"Andares de Elite (a cada 5 andares):"})," Monstros mais fortes com melhores recompensas"]}),t.jsxs("li",{children:[t.jsx("strong",{children:"Andares de Evento (a cada 7 andares):"})," Eventos especiais e encontros únicos"]}),t.jsxs("li",{children:[t.jsx("strong",{children:"Andares de Chefe (a cada 10 andares):"})," Batalhas desafiadoras contra chefes poderosos"]})]})]})]})})})}),t.jsx(tp,{value:"combat",children:t.jsx(pu,{className:"p-6",children:t.jsx(ap,{className:"h-[600px] pr-4",children:t.jsxs("section",{className:"space-y-4",children:[t.jsx("h2",{className:"text-2xl font-bold",children:"Sistema de Combate"}),t.jsxs("div",{className:"space-y-4",children:[t.jsx("h3",{className:"text-xl font-semibold",children:"Ações de Combate"}),t.jsx("p",{children:"Durante o combate, você pode realizar as seguintes ações:"}),t.jsxs("ul",{className:"list-disc list-inside space-y-2 ml-4",children:[t.jsxs("li",{children:[t.jsx("strong",{children:"Ataque:"})," Causa dano baseado no seu ATK menos a DEF do inimigo"]}),t.jsxs("li",{children:[t.jsx("strong",{children:"Defesa:"})," Aumenta temporariamente sua DEF por um turno"]}),t.jsxs("li",{children:[t.jsx("strong",{children:"Magias:"})," Efeitos variados que consomem Mana"]}),t.jsxs("li",{children:[t.jsx("strong",{children:"Itens:"})," Usar poções e outros consumíveis"]}),t.jsxs("li",{children:[t.jsx("strong",{children:"Fuga:"})," Tenta escapar do combate (chance baseada na velocidade)"]})]}),t.jsx("h3",{className:"text-xl font-semibold",children:"Sistema de Magias"}),t.jsx("p",{children:"As magias são divididas em diferentes tipos de efeito:"}),t.jsxs("ul",{className:"list-disc list-inside space-y-2 ml-4",children:[t.jsxs("li",{children:[t.jsx("strong",{children:"Dano (Damage):"})," Causa dano direto ao inimigo"]}),t.jsxs("li",{children:[t.jsx("strong",{children:"Cura (Heal):"})," Recupera HP"]}),t.jsxs("li",{children:[t.jsx("strong",{children:"Buff:"})," Aumenta temporariamente seus atributos"]}),t.jsxs("li",{children:[t.jsx("strong",{children:"Debuff:"})," Reduz temporariamente os atributos do inimigo"]}),t.jsxs("li",{children:[t.jsx("strong",{children:"DoT (Damage over Time):"})," Causa dano ao longo do tempo"]}),t.jsxs("li",{children:[t.jsx("strong",{children:"HoT (Heal over Time):"})," Cura ao longo do tempo"]})]}),t.jsx("h3",{className:"text-xl font-semibold",children:"Comportamento dos Monstros"}),t.jsx("p",{children:"Os monstros possuem diferentes padrões de comportamento:"}),t.jsxs("ul",{className:"list-disc list-inside space-y-2 ml-4",children:[t.jsxs("li",{children:[t.jsx("strong",{children:"Agressivo:"})," Foca em causar dano"]}),t.jsxs("li",{children:[t.jsx("strong",{children:"Defensivo:"})," Alterna entre ataques e defesa"]}),t.jsxs("li",{children:[t.jsx("strong",{children:"Balanceado:"})," Mistura diferentes estratégias"]})]})]})]})})})}),t.jsx(tp,{value:"progression",children:t.jsx(pu,{className:"p-6",children:t.jsx(ap,{className:"h-[600px] pr-4",children:t.jsxs("section",{className:"space-y-4",children:[t.jsx("h2",{className:"text-2xl font-bold",children:"Progressão"}),t.jsxs("div",{className:"space-y-4",children:[t.jsx("h3",{className:"text-xl font-semibold",children:"Sistema de Níveis"}),t.jsx("p",{children:"Ao derrotar monstros, você ganha XP. A quantidade de XP necessária para subir de nível aumenta em 50% a cada nível. Ao subir de nível:"}),t.jsxs("ul",{className:"list-disc list-inside space-y-2 ml-4",children:[t.jsx("li",{children:"Seus atributos base aumentam"}),t.jsx("li",{children:"HP e Mana são completamente restaurados"}),t.jsx("li",{children:"Você pode desbloquear novas magias"})]}),t.jsx("h3",{className:"text-xl font-semibold",children:"Recompensas"}),t.jsx("p",{children:"Ao derrotar monstros, você pode receber:"}),t.jsxs("ul",{className:"list-disc list-inside space-y-2 ml-4",children:[t.jsxs("li",{children:[t.jsx("strong",{children:"Gold:"})," Usado para comprar equipamentos e consumíveis"]}),t.jsxs("li",{children:[t.jsx("strong",{children:"Drops:"})," Itens que podem ser usados para crafting"]}),t.jsxs("li",{children:[t.jsx("strong",{children:"XP:"})," Para subir de nível"]})]}),t.jsx("h3",{className:"text-xl font-semibold",children:"Checkpoints"}),t.jsx("p",{children:"A cada 10 andares existe um checkpoint. Estes são pontos seguros onde você pode:"}),t.jsxs("ul",{className:"list-disc list-inside space-y-2 ml-4",children:[t.jsx("li",{children:"Salvar seu progresso"}),t.jsx("li",{children:"Retornar ao hub para comprar itens"}),t.jsx("li",{children:"Reorganizar seu equipamento"})]})]})]})})})}),t.jsx(tp,{value:"items",children:t.jsx(pu,{className:"p-6",children:t.jsx(ap,{className:"h-[600px] pr-4",children:t.jsxs("section",{className:"space-y-4",children:[t.jsx("h2",{className:"text-2xl font-bold",children:"Itens e Equipamentos"}),t.jsxs("div",{className:"space-y-4",children:[t.jsx("h3",{className:"text-xl font-semibold",children:"Equipamentos"}),t.jsx("p",{children:"Os equipamentos são divididos em três categorias:"}),t.jsxs("ul",{className:"list-disc list-inside space-y-2 ml-4",children:[t.jsxs("li",{children:[t.jsx("strong",{children:"Armas (Weapons):"})," Aumentam principalmente ATK"]}),t.jsxs("li",{children:[t.jsx("strong",{children:"Armaduras (Armor):"})," Aumentam principalmente DEF"]}),t.jsxs("li",{children:[t.jsx("strong",{children:"Acessórios (Accessory):"})," Efeitos variados"]})]}),t.jsx("p",{children:"E em cinco raridades:"}),t.jsxs("ul",{className:"list-disc list-inside space-y-2 ml-4",children:[t.jsxs("li",{children:[t.jsx("strong",{children:"Comum (Common):"})," Equipamentos básicos"]}),t.jsxs("li",{children:[t.jsx("strong",{children:"Incomum (Uncommon):"})," Melhorias moderadas"]}),t.jsxs("li",{children:[t.jsx("strong",{children:"Raro (Rare):"})," Requer pergaminho especial para desbloquear"]}),t.jsxs("li",{children:[t.jsx("strong",{children:"Épico (Epic):"})," Requer pergaminho épico para desbloquear"]}),t.jsxs("li",{children:[t.jsx("strong",{children:"Lendário (Legendary):"})," Os mais poderosos do jogo"]})]}),t.jsx("h3",{className:"text-xl font-semibold",children:"Consumíveis"}),t.jsx("p",{children:"Existem diferentes tipos de consumíveis:"}),t.jsxs("ul",{className:"list-disc list-inside space-y-2 ml-4",children:[t.jsxs("li",{children:[t.jsx("strong",{children:"Poções:"})," Recuperam HP ou Mana"]}),t.jsxs("li",{children:[t.jsx("strong",{children:"Antídotos:"})," Removem efeitos negativos"]}),t.jsxs("li",{children:[t.jsx("strong",{children:"Elixires:"})," Proporcionam buffs temporários"]}),t.jsxs("li",{children:[t.jsx("strong",{children:"Pergaminhos:"})," Desbloqueiam equipamentos especiais"]})]}),t.jsx("h3",{className:"text-xl font-semibold",children:"Sistema de Crafting"}),t.jsx("p",{children:"Você pode criar itens usando materiais obtidos como drops dos monstros. Alguns consumíveis e equipamentos só podem ser obtidos através de crafting."})]})]})})})})]})]})}});const np=e=>{let t;const a=new Set,s=(e,s)=>{const r="function"==typeof e?e(t):e;if(!Object.is(r,t)){const e=t;t=(null!=s?s:"object"!=typeof r||null===r)?r:Object.assign({},t,r),a.forEach((a=>a(t,e)))}},r=()=>t,n={setState:s,getState:r,getInitialState:()=>i,subscribe:e=>(a.add(e),()=>a.delete(e))},i=t=e(s,r,n);return n},ip=e=>e;const op=e=>{const t=(e=>e?np(e):np)(e),a=e=>function(e,t=ip){const a=m.useSyncExternalStore(e.subscribe,(()=>t(e.getState())),(()=>t(e.getInitialState())));return m.useDebugValue(a),a}(t,e);return Object.assign(a,t),a},lp=e=>op,cp={BASE_URL:"/",DEV:!1,MODE:"production",PROD:!0,SSR:!1,VITE_BASE_URL:"http://tower-trials.vercel.app",VITE_ENV:"DEV",VITE_LOGIN_URL:"http://tower-trials.vercel.app/login",VITE_SERVICE_ROLE:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImJrcXpudGxra2JlcHp2b2VzcXhoIiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTc2MTI3MjY1MiwiZXhwIjoyMDc2ODQ4NjUyfQ.lzOfCWvDf9JpqLngMosX1LeG7S-PUmHaXHEDBWvfLuI",VITE_SUPABASE_ANON_KEY:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImJrcXpudGxra2JlcHp2b2VzcXhoIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjEyNzI2NTIsImV4cCI6MjA3Njg0ODY1Mn0.Tr1UdumfKh8k8S6YaLFVS49rfXylQcyaU-O7qpynrK4",VITE_SUPABASE_URL:"https://bkqzntlkkbepzvoesqxh.supabase.co"},dp=new Map,mp=e=>{const t=dp.get(e);return t?Object.fromEntries(Object.entries(t.stores).map((([e,t])=>[e,t.getState()]))):{}},up=(e,t={})=>(a,s,r)=>{const{enabled:n,anonymousActionType:i,store:o,...l}=t;let c;try{c=(null!=n?n:"production"!==(cp?"production":void 0))&&window.__REDUX_DEVTOOLS_EXTENSION__}catch(x){}if(!c)return e(a,s,r);const{connection:d,...m}=((e,t,a)=>{if(void 0===e)return{type:"untracked",connection:t.connect(a)};const s=dp.get(a.name);if(s)return{type:"tracked",store:e,...s};const r={connection:t.connect(a),stores:{}};return dp.set(a.name,r),{type:"tracked",store:e,...r}})(o,c,l);let u=!0;r.setState=(e,t,n)=>{const c=a(e,t);if(!u)return c;const m=(e=>{var t,a;if(!e)return;const s=e.split("\n"),r=s.findIndex((e=>e.includes("api.setState")));if(r<0)return;const n=(null==(t=s[r+1])?void 0:t.trim())||"";return null==(a=/.+ (.+) .+/.exec(n))?void 0:a[1]})((new Error).stack),h=void 0===n?{type:i||m||"anonymous"}:"string"==typeof n?{type:n}:n;return void 0===o?(null==d||d.send(h,s()),c):(null==d||d.send({...h,type:`${o}/${h.type}`},{...mp(l.name),[o]:r.getState()}),c)},r.devtools={cleanup:()=>{d&&"function"==typeof d.unsubscribe&&d.unsubscribe(),((e,t)=>{if(void 0===t)return;const a=dp.get(e);a&&(delete a.stores[t],0===Object.keys(a.stores).length&&dp.delete(e))})(l.name,o)}};const h=(...e)=>{const t=u;u=!1,a(...e),u=t},p=e(r.setState,s,r);if("untracked"===m.type?null==d||d.init(p):(m.stores[m.store]=r,null==d||d.init(Object.fromEntries(Object.entries(m.stores).map((([e,t])=>[e,e===m.store?p:t.getState()]))))),r.dispatchFromDevtools&&"function"==typeof r.dispatch){let e=!1;const t=r.dispatch;r.dispatch=(...a)=>{"production"===(cp?"production":void 0)||"__setState"!==a[0].type||e||(e=!0),t(...a)}}return d.subscribe((e=>{var t;switch(e.type){case"ACTION":if("string"!=typeof e.payload)return;return hp(e.payload,(e=>{if("__setState"!==e.type)r.dispatchFromDevtools&&"function"==typeof r.dispatch&&r.dispatch(e);else{if(void 0===o)return void h(e.state);Object.keys(e.state).length;const t=e.state[o];if(null==t)return;JSON.stringify(r.getState())!==JSON.stringify(t)&&h(t)}}));case"DISPATCH":switch(e.payload.type){case"RESET":return h(p),void 0===o?null==d?void 0:d.init(r.getState()):null==d?void 0:d.init(mp(l.name));case"COMMIT":return void 0===o?void(null==d||d.init(r.getState())):null==d?void 0:d.init(mp(l.name));case"ROLLBACK":return hp(e.state,(e=>{if(void 0===o)return h(e),void(null==d||d.init(r.getState()));h(e[o]),null==d||d.init(mp(l.name))}));case"JUMP_TO_STATE":case"JUMP_TO_ACTION":return hp(e.state,(e=>{void 0!==o?JSON.stringify(r.getState())!==JSON.stringify(e[o])&&h(e[o]):h(e)}));case"IMPORT_STATE":{const{nextLiftedState:a}=e.payload,s=null==(t=a.computedStates.slice(-1)[0])?void 0:t.state;if(!s)return;return h(void 0===o?s:s[o]),void(null==d||d.send(null,a))}case"PAUSE_RECORDING":return u=!u}return}})),p},hp=(e,t)=>{let a;try{a=JSON.parse(e)}catch(s){}void 0!==a&&t(a)},pp=e=>(t,a,s)=>{const r=s.subscribe;s.subscribe=(e,t,a)=>{let n=e;if(t){const r=(null==a?void 0:a.equalityFn)||Object.is;let i=e(s.getState());n=a=>{const s=e(a);if(!r(i,s)){const e=i;t(i=s,e)}},(null==a?void 0:a.fireImmediately)&&t(i,i)}return r(n)};return e(t,a,s)};function xp(e,t){let a;try{a=e()}catch(s){return}return{getItem:e=>{var t;const s=e=>null===e?null:JSON.parse(e,void 0),r=null!=(t=a.getItem(e))?t:null;return r instanceof Promise?r.then(s):s(r)},setItem:(e,t)=>a.setItem(e,JSON.stringify(t,void 0)),removeItem:e=>a.removeItem(e)}}const fp=e=>t=>{try{const a=e(t);return a instanceof Promise?a:{then:e=>fp(e)(a),catch(e){return this}}}catch(a){return{then(e){return this},catch:e=>fp(e)(a)}}},gp=(e,t)=>(a,s,r)=>{let n={storage:xp((()=>localStorage)),partialize:e=>e,version:0,merge:(e,t)=>({...t,...e}),...t},i=!1;const o=new Set,l=new Set;let c=n.storage;if(!c)return e(((...e)=>{a(...e)}),s,r);const d=()=>{const e=n.partialize({...s()});return c.setItem(n.name,{state:e,version:n.version})},m=r.setState;r.setState=(e,t)=>{m(e,t),d()};const u=e(((...e)=>{a(...e),d()}),s,r);let h;r.getInitialState=()=>u;const p=()=>{var e,t;if(!c)return;i=!1,o.forEach((e=>{var t;return e(null!=(t=s())?t:u)}));const r=(null==(t=n.onRehydrateStorage)?void 0:t.call(n,null!=(e=s())?e:u))||void 0;return fp(c.getItem.bind(c))(n.name).then((e=>{if(e){if("number"!=typeof e.version||e.version===n.version)return[!1,e.state];if(n.migrate){const t=n.migrate(e.state,e.version);return t instanceof Promise?t.then((e=>[!0,e])):[!0,t]}}return[!1,void 0]})).then((e=>{var t;const[r,i]=e;if(h=n.merge(i,null!=(t=s())?t:u),a(h,!0),r)return d()})).then((()=>{null==r||r(h,void 0),h=s(),i=!0,l.forEach((e=>e(h)))})).catch((e=>{null==r||r(void 0,e)}))};return r.persist={setOptions:e=>{n={...n,...e},e.storage&&(c=e.storage)},clearStorage:()=>{null==c||c.removeItem(n.name)},getOptions:()=>n,rehydrate:()=>p(),hasHydrated:()=>i,onHydrate:e=>(o.add(e),()=>{o.delete(e)}),onFinishHydration:e=>(l.add(e),()=>{l.delete(e)})},n.skipHydration||p(),h||u};var bp=Symbol.for("immer-nothing"),vp=Symbol.for("immer-draftable"),yp=Symbol.for("immer-state");function jp(e,...t){throw new Error(`[Immer] minified error nr: ${e}. Full error at: https://bit.ly/3cXEKWf`)}var Np=Object.getPrototypeOf;function _p(e){return!!e&&!!e[yp]}function wp(e){return!!e&&(Sp(e)||Array.isArray(e)||!!e[vp]||!!e.constructor?.[vp]||Mp(e)||Tp(e))}var Cp=Object.prototype.constructor.toString();function Sp(e){if(!e||"object"!=typeof e)return!1;const t=Np(e);if(null===t)return!0;const a=Object.hasOwnProperty.call(t,"constructor")&&t.constructor;return a===Object||"function"==typeof a&&Function.toString.call(a)===Cp}function Ep(e,t){0===kp(e)?Reflect.ownKeys(e).forEach((a=>{t(a,e[a],e)})):e.forEach(((a,s)=>t(s,a,e)))}function kp(e){const t=e[yp];return t?t.type_:Array.isArray(e)?1:Mp(e)?2:Tp(e)?3:0}function Ap(e,t){return 2===kp(e)?e.has(t):Object.prototype.hasOwnProperty.call(e,t)}function Pp(e,t,a){const s=kp(e);2===s?e.set(t,a):3===s?e.add(a):e[t]=a}function Mp(e){return e instanceof Map}function Tp(e){return e instanceof Set}function qp(e){return e.copy_||e.base_}function Dp(e,t){if(Mp(e))return new Map(e);if(Tp(e))return new Set(e);if(Array.isArray(e))return Array.prototype.slice.call(e);const a=Sp(e);if(!0===t||"class_only"===t&&!a){const t=Object.getOwnPropertyDescriptors(e);delete t[yp];let a=Reflect.ownKeys(t);for(let s=0;s<a.length;s++){const r=a[s],n=t[r];!1===n.writable&&(n.writable=!0,n.configurable=!0),(n.get||n.set)&&(t[r]={configurable:!0,writable:!0,enumerable:n.enumerable,value:e[r]})}return Object.create(Np(e),t)}{const t=Np(e);if(null!==t&&a)return{...e};const s=Object.create(t);return Object.assign(s,e)}}function Lp(e,t=!1){return Rp(e)||_p(e)||!wp(e)||(kp(e)>1&&(e.set=e.add=e.clear=e.delete=$p),Object.freeze(e),t&&Object.entries(e).forEach((([e,t])=>Lp(t,!0)))),e}function $p(){jp(2)}function Rp(e){return Object.isFrozen(e)}var Ip,Fp={};function Vp(e){const t=Fp[e];return t||jp(0),t}function Op(){return Ip}function Bp(e,t){t&&(Vp("Patches"),e.patches_=[],e.inversePatches_=[],e.patchListener_=t)}function Up(e){zp(e),e.drafts_.forEach(Gp),e.drafts_=null}function zp(e){e===Ip&&(Ip=e.parent_)}function Hp(e){return Ip={drafts_:[],parent_:Ip,immer_:e,canAutoFreeze_:!0,unfinalizedDrafts_:0}}function Gp(e){const t=e[yp];0===t.type_||1===t.type_?t.revoke_():t.revoked_=!0}function Xp(e,t){t.unfinalizedDrafts_=t.drafts_.length;const a=t.drafts_[0];return void 0!==e&&e!==a?(a[yp].modified_&&(Up(t),jp(4)),wp(e)&&(e=Wp(t,e),t.parent_||Kp(t,e)),t.patches_&&Vp("Patches").generateReplacementPatches_(a[yp].base_,e,t.patches_,t.inversePatches_)):e=Wp(t,a,[]),Up(t),t.patches_&&t.patchListener_(t.patches_,t.inversePatches_),e!==bp?e:void 0}function Wp(e,t,a){if(Rp(t))return t;const s=t[yp];if(!s)return Ep(t,((r,n)=>Yp(e,s,t,r,n,a))),t;if(s.scope_!==e)return t;if(!s.modified_)return Kp(e,s.base_,!0),s.base_;if(!s.finalized_){s.finalized_=!0,s.scope_.unfinalizedDrafts_--;const t=s.copy_;let r=t,n=!1;3===s.type_&&(r=new Set(t),t.clear(),n=!0),Ep(r,((r,i)=>Yp(e,s,t,r,i,a,n))),Kp(e,t,!1),a&&e.patches_&&Vp("Patches").generatePatches_(s,a,e.patches_,e.inversePatches_)}return s.copy_}function Yp(e,t,a,s,r,n,i){if(_p(r)){const i=Wp(e,r,n&&t&&3!==t.type_&&!Ap(t.assigned_,s)?n.concat(s):void 0);if(Pp(a,s,i),!_p(i))return;e.canAutoFreeze_=!1}else i&&a.add(r);if(wp(r)&&!Rp(r)){if(!e.immer_.autoFreeze_&&e.unfinalizedDrafts_<1)return;Wp(e,r),t&&t.scope_.parent_||"symbol"==typeof s||!Object.prototype.propertyIsEnumerable.call(a,s)||Kp(e,r)}}function Kp(e,t,a=!1){!e.parent_&&e.immer_.autoFreeze_&&e.canAutoFreeze_&&Lp(t,a)}var Jp={get(e,t){if(t===yp)return e;const a=qp(e);if(!Ap(a,t))return function(e,t,a){const s=ex(t,a);return s?"value"in s?s.value:s.get?.call(e.draft_):void 0}(e,a,t);const s=a[t];return e.finalized_||!wp(s)?s:s===Zp(e.base_,t)?(ax(e),e.copy_[t]=sx(s,e)):s},has:(e,t)=>t in qp(e),ownKeys:e=>Reflect.ownKeys(qp(e)),set(e,t,a){const s=ex(qp(e),t);if(s?.set)return s.set.call(e.draft_,a),!0;if(!e.modified_){const s=Zp(qp(e),t),r=s?.[yp];if(r&&r.base_===a)return e.copy_[t]=a,e.assigned_[t]=!1,!0;if(function(e,t){return e===t?0!==e||1/e==1/t:e!=e&&t!=t}(a,s)&&(void 0!==a||Ap(e.base_,t)))return!0;ax(e),tx(e)}return e.copy_[t]===a&&(void 0!==a||t in e.copy_)||Number.isNaN(a)&&Number.isNaN(e.copy_[t])||(e.copy_[t]=a,e.assigned_[t]=!0),!0},deleteProperty:(e,t)=>(void 0!==Zp(e.base_,t)||t in e.base_?(e.assigned_[t]=!1,ax(e),tx(e)):delete e.assigned_[t],e.copy_&&delete e.copy_[t],!0),getOwnPropertyDescriptor(e,t){const a=qp(e),s=Reflect.getOwnPropertyDescriptor(a,t);return s?{writable:!0,configurable:1!==e.type_||"length"!==t,enumerable:s.enumerable,value:a[t]}:s},defineProperty(){jp(11)},getPrototypeOf:e=>Np(e.base_),setPrototypeOf(){jp(12)}},Qp={};function Zp(e,t){const a=e[yp];return(a?qp(a):e)[t]}function ex(e,t){if(!(t in e))return;let a=Np(e);for(;a;){const e=Object.getOwnPropertyDescriptor(a,t);if(e)return e;a=Np(a)}}function tx(e){e.modified_||(e.modified_=!0,e.parent_&&tx(e.parent_))}function ax(e){e.copy_||(e.copy_=Dp(e.base_,e.scope_.immer_.useStrictShallowCopy_))}Ep(Jp,((e,t)=>{Qp[e]=function(){return arguments[0]=arguments[0][0],t.apply(this,arguments)}})),Qp.deleteProperty=function(e,t){return Qp.set.call(this,e,t,void 0)},Qp.set=function(e,t,a){return Jp.set.call(this,e[0],t,a,e[0])};function sx(e,t){const a=Mp(e)?Vp("MapSet").proxyMap_(e,t):Tp(e)?Vp("MapSet").proxySet_(e,t):function(e,t){const a=Array.isArray(e),s={type_:a?1:0,scope_:t?t.scope_:Op(),modified_:!1,finalized_:!1,assigned_:{},parent_:t,base_:e,draft_:null,copy_:null,revoke_:null,isManual_:!1};let r=s,n=Jp;a&&(r=[s],n=Qp);const{revoke:i,proxy:o}=Proxy.revocable(r,n);return s.draft_=o,s.revoke_=i,o}(e,t);return(t?t.scope_:Op()).drafts_.push(a),a}function rx(e){if(!wp(e)||Rp(e))return e;const t=e[yp];let a;if(t){if(!t.modified_)return t.base_;t.finalized_=!0,a=Dp(e,t.scope_.immer_.useStrictShallowCopy_)}else a=Dp(e,!0);return Ep(a,((e,t)=>{Pp(a,e,rx(t))})),t&&(t.finalized_=!1),a}var nx=new class{constructor(e){this.autoFreeze_=!0,this.useStrictShallowCopy_=!1,this.produce=(e,t,a)=>{if("function"==typeof e&&"function"!=typeof t){const a=t;t=e;const s=this;return function(e=a,...r){return s.produce(e,(e=>t.call(this,e,...r)))}}let s;if("function"!=typeof t&&jp(6),void 0!==a&&"function"!=typeof a&&jp(7),wp(e)){const r=Hp(this),n=sx(e,void 0);let i=!0;try{s=t(n),i=!1}finally{i?Up(r):zp(r)}return Bp(r,a),Xp(s,r)}if(!e||"object"!=typeof e){if(s=t(e),void 0===s&&(s=e),s===bp&&(s=void 0),this.autoFreeze_&&Lp(s,!0),a){const t=[],r=[];Vp("Patches").generateReplacementPatches_(e,s,t,r),a(t,r)}return s}jp(1)},this.produceWithPatches=(e,t)=>{if("function"==typeof e)return(t,...a)=>this.produceWithPatches(t,(t=>e(t,...a)));let a,s;const r=this.produce(e,t,((e,t)=>{a=e,s=t}));return[r,a,s]},"boolean"==typeof e?.autoFreeze&&this.setAutoFreeze(e.autoFreeze),"boolean"==typeof e?.useStrictShallowCopy&&this.setUseStrictShallowCopy(e.useStrictShallowCopy)}createDraft(e){wp(e)||jp(8),_p(e)&&(e=function(e){_p(e)||jp(10);return rx(e)}(e));const t=Hp(this),a=sx(e,void 0);return a[yp].isManual_=!0,zp(t),a}finishDraft(e,t){const a=e&&e[yp];a&&a.isManual_||jp(9);const{scope_:s}=a;return Bp(s,t),Xp(void 0,s)}setAutoFreeze(e){this.autoFreeze_=e}setUseStrictShallowCopy(e){this.useStrictShallowCopy_=e}applyPatches(e,t){let a;for(a=t.length-1;a>=0;a--){const s=t[a];if(0===s.path.length&&"replace"===s.op){e=s.value;break}}a>-1&&(t=t.slice(a+1));const s=Vp("Patches").applyPatches_;return _p(e)?s(e,t):this.produce(e,(e=>s(e,t)))}},ix=nx.produce;nx.produceWithPatches.bind(nx),nx.setAutoFreeze.bind(nx),nx.setUseStrictShallowCopy.bind(nx),nx.applyPatches.bind(nx),nx.createDraft.bind(nx),nx.finishDraft.bind(nx);const ox={mode:"menu",player:null,currentEnemy:null,currentFloor:null,currentSpecialEvent:null,isPlayerTurn:!0,gameMessage:"",highestFloor:1,selectedSpell:null,battleRewards:null},lx=lp()(pp((e=>({gameState:ox,loading:{loadProgress:!1,startGame:!1,performAction:!1,saveProgress:!1},error:null,setGameState:t=>{e(ix((e=>{e.gameState=t})))},updateGameState:t=>{e(ix((e=>{t(e.gameState)})))},resetGameState:()=>{e(ix((e=>{e.gameState=structuredClone(ox),e.error=null})))},updateLoading:(t,a)=>{e(ix((e=>{e.loading[t]=a})))},setAllLoading:t=>{e(ix((e=>{e.loading=t})))},setError:t=>{e(ix((e=>{e.error=t}))),t&&_.error("Erro",{description:t})},resetError:()=>{e(ix((e=>{e.error=null})))},setGameMode:t=>{e(ix((e=>{e.gameState.mode=t})))},setGameMessage:t=>{e(ix((e=>{e.gameState.gameMessage=t})))},setPlayerTurn:t=>{e(ix((e=>{e.gameState.isPlayerTurn=t})))},updatePlayerStats:(t,a)=>{e(ix((e=>{e.gameState.player&&(e.gameState.player.hp=Math.max(0,t),e.gameState.player.mana=Math.max(0,a))})))},updatePlayerGold:t=>{e(ix((e=>{e.gameState.player&&(e.gameState.player.gold=Math.max(0,t))})))},updatePlayerFloor:t=>{e(ix((e=>{e.gameState.player&&(e.gameState.player.floor=t,e.gameState.highestFloor=Math.max(e.gameState.highestFloor,t))})))}})))),cx={types:new Set(["system","battle","lore","skill_xp","level_up","equipment","enemy_action","player_action","damage","healing"]),categories:new Set(["game"])},dx={gameMessage:"",gameLogs:[],debugLogs:[],maxGameLogs:1e3,maxDebugLogs:500,enableDebugLogs:!1,currentFilter:cx,filteredLogs:[],logStats:{totalLogsToday:0,lastLogTime:null,logsByType:{system:0,battle:0,lore:0,skill_xp:0,level_up:0,equipment:0,enemy_action:0,player_action:0,damage:0,healing:0}},isLogVisible:!0,autoScroll:!0},mx=()=>`log-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,ux=e=>{if(e instanceof Date&&!isNaN(e.getTime()))return e;if("string"==typeof e||"number"==typeof e){const t=new Date(e);if(!isNaN(t.getTime()))return t}return new Date},hx=e=>({id:e.id||mx(),text:e.text||"",type:e.type||"system",category:e.category||"game",metadata:e.metadata?{...e.metadata}:{},timestamp:ux(e.timestamp)}),px=lp()(up(gp(((e,t)=>({...dx,addGameLogMessage:(a,s="system",r={})=>{if(t().gameLogs.slice(-5).some((e=>e.text===a&&e.type===s)))return;const n={id:mx(),text:a,type:s,timestamp:ux(new Date),category:"game",metadata:r?{...r}:{}};e(ix((e=>{var t,a;e.gameLogs.push(n),e.gameLogs.length>e.maxGameLogs&&(e.gameLogs=e.gameLogs.slice(-e.maxGameLogs)),e.logStats.lastLogTime=n.timestamp,e.logStats.logsByType[s]++,e.logStats.lastLogTime&&(t=e.logStats.lastLogTime,a=n.timestamp,t.toDateString()===a.toDateString())?e.logStats.totalLogsToday++:e.logStats.totalLogsToday=1}))),t().applyFilter()},addDebugLog:(a,s,r={})=>{if(!t().enableDebugLogs)return;const n={id:mx(),text:`[${s.toUpperCase()}] ${a}`,type:"system",timestamp:ux(new Date),category:"debug",metadata:{level:s,...r?{...r}:{}}};e(ix((e=>{e.debugLogs.push(n),e.debugLogs.length>e.maxDebugLogs&&(e.debugLogs=e.debugLogs.slice(-e.maxDebugLogs))}))),t().applyFilter()},setGameMessage:t=>{e({gameMessage:t})},clearGameLogs:()=>{e(ix((e=>{e.gameLogs=[],e.logStats.logsByType={system:0,battle:0,lore:0,skill_xp:0,level_up:0,equipment:0,enemy_action:0,player_action:0,damage:0,healing:0}}))),t().applyFilter()},clearDebugLogs:()=>{e({debugLogs:[]}),t().applyFilter()},clearAllLogs:()=>{t().clearGameLogs(),t().clearDebugLogs()},removeLogs:a=>{e(ix((e=>{e.gameLogs=e.gameLogs.filter((e=>!a.includes(e.id))),e.debugLogs=e.debugLogs.filter((e=>!a.includes(e.id)))}))),t().applyFilter()},setFilter:a=>{e(ix((e=>{Object.assign(e.currentFilter,a)}))),t().applyFilter()},resetFilter:()=>{e({currentFilter:cx}),t().applyFilter()},applyFilter:()=>{const a=t(),{currentFilter:s,gameLogs:r,debugLogs:n}=a,i=[...r.filter((()=>s.categories.has("game"))),...a.enableDebugLogs?n.filter((()=>s.categories.has("debug"))):[]].filter((e=>{const t=ux(e.timestamp);if(!s.types.has(e.type))return!1;if(s.timeRange){const e=t.getTime(),a=s.timeRange.start.getTime(),r=s.timeRange.end.getTime();if(e<a||e>r)return!1}if(s.searchTerm){const t=s.searchTerm.toLowerCase();return e.text.toLowerCase().includes(t)}return!0})).map((e=>({...e,timestamp:ux(e.timestamp)})));i.sort(((e,t)=>t.timestamp.getTime()-e.timestamp.getTime())),e({filteredLogs:i})},searchLogs:e=>{t().setFilter({searchTerm:e})},setMaxGameLogs:t=>{e({maxGameLogs:Math.max(10,Math.min(1e4,t))})},setMaxDebugLogs:t=>{e({maxDebugLogs:Math.max(10,Math.min(5e3,t))})},toggleDebugLogs:()=>{e(ix((e=>{e.enableDebugLogs=!e.enableDebugLogs,e.enableDebugLogs?e.currentFilter.categories.add("debug"):e.currentFilter.categories.delete("debug")}))),t().applyFilter()},setAutoScroll:t=>{e({autoScroll:t})},toggleLogVisibility:()=>{e(ix((e=>{e.isLogVisible=!e.isLogVisible})))},exportLogs:e=>{const a=t(),s=e?a.filteredLogs.filter((t=>t.category===e)):a.filteredLogs,r={exportedAt:(new Date).toISOString(),category:e,logs:s,stats:a.logStats};return JSON.stringify(r,null,2)},importLogs:a=>{try{const s=JSON.parse(a);return!(!s.logs||!Array.isArray(s.logs))&&(e(ix((e=>{for(const t of s.logs){const a=hx(t);"game"===a.category?e.gameLogs.push(a):"debug"===a.category&&e.enableDebugLogs&&e.debugLogs.push(a)}e.gameLogs.length>e.maxGameLogs&&(e.gameLogs=e.gameLogs.slice(-e.maxGameLogs)),e.debugLogs.length>e.maxDebugLogs&&(e.debugLogs=e.debugLogs.slice(-e.maxDebugLogs))}))),t().applyFilter(),!0)}catch(s){return!1}},getLogsByType:e=>{const a=t();return[...a.gameLogs,...a.debugLogs].filter((t=>t.type===e))},getLogsByCategory:e=>{const a=t();return"game"===e?a.gameLogs:"debug"===e?a.debugLogs:[]}})),{name:"log-store",partialize:e=>({gameLogs:e.gameLogs.slice(-100),maxGameLogs:e.maxGameLogs,enableDebugLogs:e.enableDebugLogs,autoScroll:e.autoScroll,logStats:e.logStats}),onRehydrateStorage:()=>e=>{if(e)try{e.gameLogs&&Array.isArray(e.gameLogs)?e.gameLogs=e.gameLogs.map((e=>hx(e))):e.gameLogs=[],e.debugLogs&&Array.isArray(e.debugLogs)?e.debugLogs=e.debugLogs.map((e=>hx(e))):e.debugLogs=[],e.logStats?.lastLogTime&&(e.logStats.lastLogTime=ux(e.logStats.lastLogTime)),e.filteredLogs=[]}catch(t){e.gameLogs=[],e.debugLogs=[],e.filteredLogs=[]}},version:1}),{name:"log-store"})),xx=()=>{const t=px(),a=e.useCallback(((e,a,s)=>{t.addGameLogMessage(e,a,s)}),[t.addGameLogMessage]),s=e.useCallback((e=>{t.setGameMessage(e)}),[t.setGameMessage]),r=e.useCallback((()=>{t.clearGameLogs()}),[t.clearGameLogs]),n=e.useCallback((e=>{t.searchLogs(e)}),[t.searchLogs]),i=e.useCallback((e=>{t.setFilter(e)}),[t.setFilter]),o=e.useCallback((()=>{t.toggleLogVisibility()}),[t.toggleLogVisibility]);return{gameMessage:t.gameMessage,gameLog:t.filteredLogs.map((e=>({text:e.text,type:e.type}))),addGameLogMessage:a,setGameMessage:s,clearGameLogs:r,searchLogs:n,setFilter:i,logStats:t.logStats,isLogVisible:t.isLogVisible,toggleLogVisibility:o}},fx=lp()(pp(gp(((e,t)=>({characters:[],hasLoadedCharacters:!1,isLoading:!1,currentUserId:null,selectedCharacterId:null,selectedCharacterName:null,selectedCharacter:null,cacheTimestamps:{},cacheDurations:{character:3e4,userList:15e3},lastUserListFetch:null,loadCharacters:async(a,s)=>{const r=t();if(r.currentUserId!==a&&e(ix((e=>{e.characters=[],e.hasLoadedCharacters=!1,e.currentUserId=a,e.isLoading=!1,e.selectedCharacterId&&(e.selectedCharacterId=null,e.selectedCharacterName=null,e.selectedCharacter=null)}))),a&&!r.hasLoadedCharacters&&!r.isLoading)try{e(ix((e=>{e.isLoading=!0})));const t=await Nh.getUserCharacters(a);if(t.success&&t.data){const a=Date.now();e(ix((e=>{if(e.characters=t.data,e.hasLoadedCharacters=!0,e.lastUserListFetch=a,t.data.forEach((t=>{e.cacheTimestamps[t.id]=a})),e.selectedCharacterId){const a=t.data.find((t=>t.id===e.selectedCharacterId));a?(e.selectedCharacter=a,e.selectedCharacterName=a.name):(e.selectedCharacterId=null,e.selectedCharacterName=null,e.selectedCharacter=null)}})));const r=s||(()=>{});t.data.length>0?r("Selecione um personagem para jogar!"):r("Você ainda não tem personagens. Crie um para começar!")}else t.error&&_.error("Erro",{description:t.error})}catch(n){_.error("Erro",{description:n instanceof Error?n.message:"Erro ao carregar personagens"})}finally{e(ix((e=>{e.isLoading=!1})))}},createCharacter:async(t,a,s)=>{if(a){e(ix((e=>{e.isLoading=!0})));try{const r=await Nh.createCharacter({user_id:a,name:t});if(r.success&&r.data){const r=await Nh.getUserCharacters(a);if(r.success&&r.data){e(ix((e=>{e.characters=r.data})));const a=r.data.find((e=>e.name===t));a&&(_.success("Sucesso",{description:"Personagem criado com sucesso!"}),s?.(`${a.name} foi criado!`))}}else if(r.error)throw new Error(r.error)}catch(r){_.error("Erro",{description:r instanceof Error?r.message:"Erro ao criar personagem"})}finally{e(ix((e=>{e.isLoading=!1})))}}else _.error("Erro",{description:"Você precisa estar logado para criar um personagem."})},reloadCharacters:()=>{e(ix((e=>{e.hasLoadedCharacters=!1})))},selectCharacter:(t,a)=>{e(ix((e=>{e.selectedCharacterId=t,e.selectedCharacterName=a;const s=e.characters.find((e=>e.id===t));e.selectedCharacter=s||null})))},clearSelection:()=>{e(ix((e=>{e.selectedCharacterId=null,e.selectedCharacterName=null,e.selectedCharacter=null})))},setSelectedCharacter:t=>{e(ix((e=>{e.selectedCharacter=t})))},loadSelectedCharacter:async t=>{try{const a=await Nh.getCharacter(t);a.success&&a.data&&e(ix((e=>{e.selectedCharacter=a.data;const s=e.characters.findIndex((e=>e.id===t));-1!==s&&(e.characters[s]=a.data)})))}catch(a){}},getCachedCharacter:e=>{const a=t(),s=a.characters.find((t=>t.id===e));return s?a.isCacheValid(e)?s:null:a.selectedCharacter?.id===e?a.selectedCharacter:null},isCacheValid:e=>{const a=t(),s=a.cacheTimestamps[e];if(!s)return!1;return Date.now()-s<=a.cacheDurations.character},isUserListCacheValid:()=>{const e=t();if(!e.lastUserListFetch)return!1;return Date.now()-e.lastUserListFetch<=e.cacheDurations.userList},invalidateCharacterCache:t=>{e(ix((e=>{delete e.cacheTimestamps[t]})))},invalidateUserListCache:()=>{e(ix((e=>{e.lastUserListFetch=null,e.hasLoadedCharacters=!1})))},invalidateAllCache:()=>{e(ix((e=>{e.cacheTimestamps={},e.lastUserListFetch=null,e.hasLoadedCharacters=!1})))},reset:()=>{e(ix((e=>{e.characters=[],e.hasLoadedCharacters=!1,e.isLoading=!1,e.currentUserId=null,e.selectedCharacterId=null,e.selectedCharacterName=null,e.selectedCharacter=null,e.cacheTimestamps={},e.lastUserListFetch=null})))},resetForUser:t=>{e(ix((e=>{e.characters=[],e.hasLoadedCharacters=!1,e.isLoading=!1,e.currentUserId=t,e.selectedCharacterId=null,e.selectedCharacterName=null,e.selectedCharacter=null,e.cacheTimestamps={},e.lastUserListFetch=null})))}})),{name:"character-storage",storage:xp((()=>localStorage)),partialize:e=>({selectedCharacterId:e.selectedCharacterId,selectedCharacterName:e.selectedCharacterName})})));function gx(){const{user:t}=Oa(),{addGameLogMessage:a,setGameMessage:s}=xx(),{characters:r,hasLoadedCharacters:n,isLoading:i,currentUserId:o,selectedCharacterId:l,selectedCharacterName:c,selectedCharacter:d,loadCharacters:m,createCharacter:u,reloadCharacters:h,selectCharacter:p,clearSelection:x,loadSelectedCharacter:f,setSelectedCharacter:g,reset:b,resetForUser:v}=fx(),y=e.useCallback(((e,t)=>m(e,t)),[m]),j=e.useCallback(((e,t,a)=>u(e,t,a)),[u]);return e.useEffect((()=>{t?.id?m(t.id,s):b()}),[t?.id,m,s,b]),{characters:r,hasLoadedCharacters:n,isLoading:i,currentUserId:o,selectedCharacterId:l,selectedCharacterName:c,selectedCharacter:d,loadCharacters:y,reloadCharacters:h,selectCharacter:p,clearSelection:x,loadSelectedCharacter:f,setSelectedCharacter:g,reset:b,resetForUser:v,user:t,createCharacter:e.useCallback((e=>t?.id?j(e,t.id,a):Promise.resolve()),[t?.id,j,a])}}function bx(){const t=fx((e=>e.selectedCharacterId)),a=fx((e=>e.selectedCharacterName)),s=fx((e=>e.selectedCharacter)),r=fx((e=>e.selectCharacter)),n=fx((e=>e.clearSelection)),i=fx((e=>e.loadSelectedCharacter));return e.useEffect((()=>{t&&!s&&i(t)}),[t,s,i]),{selectedCharacterId:t,selectedCharacterName:a,selectedCharacter:s,selectCharacter:r,clearSelection:n,loadSelectedCharacter:i}}function vx(){const e=gx(),t=bx();return{characters:e.characters,hasLoadedCharacters:e.hasLoadedCharacters,isLoading:e.isLoading,selectedCharacterId:t.selectedCharacterId,selectedCharacterName:t.selectedCharacterName,selectedCharacter:t.selectedCharacter,createCharacter:e.createCharacter,reloadCharacters:e.reloadCharacters,selectCharacter:t.selectCharacter,clearSelection:t.clearSelection,reset:e.reset,user:e.user}}const yx=Object.freeze(Object.defineProperty({__proto__:null,useCharacterManagement:vx,useCharacterSelectionWithCache:bx,useCharacterStore:fx,useCharacterWithAuth:gx},Symbol.toStringTag,{value:"Module"}));function jx(){const t=lx((e=>e.setGameState)),a=fx((e=>e.selectCharacter)),{addGameLogMessage:s}=xx(),r=e.useRef(!1);return{loadCharacterForHub:e.useCallback((async e=>{if(!r.current)try{r.current=!0;const s=await Nh.getCharacterForGame(e.id,!1,!0);if(!s.success||!s.data)throw new Error(s.error||"Erro ao carregar dados do personagem");const n=s.data;a(e.id,e.name);const i={mode:"hub",player:n,currentFloor:null,currentEnemy:null,currentSpecialEvent:null,isPlayerTurn:!0,gameMessage:`Bem-vindo ao hub, ${n.name}!`,highestFloor:Math.max(1,n.floor),selectedSpell:null,battleRewards:null,fleeSuccessful:!1,characterDeleted:!1};t(i)}catch(s){throw _.error("Erro",{description:s instanceof Error?s.message:"Erro ao carregar personagem"}),s}finally{r.current=!1}}),[t,a,s])}}const Nx=({isOpen:a,onClose:s,character:r,onStartFromCheckpoint:n})=>{const[i,o]=e.useState([]),[l,c]=e.useState(!1),[d,m]=e.useState(null);e.useEffect((()=>{a&&u()}),[a,r.id]);const u=async()=>{c(!0);try{const e=await Nh.getUnlockedCheckpoints(r.id);if(e.success&&e.data){if(o(e.data),e.data.length>0){const t=e.data.find((e=>e.floor===r.floor)),a=t?t.floor:e.data[e.data.length-1].floor;m(a)}}else _.error("Erro ao carregar checkpoints",{description:e.error})}catch(e){_.error("Erro ao carregar checkpoints")}finally{c(!1)}},h=e=>1===e?t.jsx(lt,{className:"h-5 w-5"}):5===e||e>10&&(e-1)%10==0?t.jsx(Je,{className:"h-5 w-5"}):t.jsx(ot,{className:"h-5 w-5"}),p=e=>1===e?"Início da aventura":5===e?"Primeiro Desafio":e>10&&(e-1)%10==0?"Santuário Pós-Boss":"Checkpoint";return t.jsx(_h,{open:a,onOpenChange:s,children:t.jsxs(Sh,{className:"sm:max-w-2xl max-h-[80vh] overflow-y-auto",children:[t.jsxs(Eh,{children:[t.jsxs(Ah,{className:"flex items-center gap-2",children:[t.jsx(ot,{className:"h-6 w-6"}),"Mapa da Torre - Checkpoints Desbloqueados"]}),t.jsx(Ph,{children:"Escolha de qual andar você deseja iniciar sua aventura. Você só pode acessar checkpoints que já alcançou antes."})]}),t.jsx("div",{className:"space-y-4",children:l?t.jsx("div",{className:"flex items-center justify-center py-8",children:t.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-t-2 border-b-2 border-primary"})}):t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3",children:i.map((e=>{return t.jsxs(pu,{className:"cursor-pointer transition-all hover:shadow-md "+(d===e.floor?"ring-2 ring-primary bg-primary/5":"hover:bg-accent/50"),onClick:()=>m(e.floor),children:[t.jsx(xu,{className:"pb-2",children:t.jsxs(fu,{className:"text-sm flex items-center gap-2",children:[t.jsx("div",{className:"p-1 rounded-full text-white "+(a=e.floor,1===a?"bg-green-500":5===a?"bg-purple-500":a>10&&(a-1)%10==0?"bg-yellow-500":"bg-blue-500"),children:h(e.floor)}),e.description,d===e.floor&&t.jsx(ge,{className:"h-4 w-4 text-primary ml-auto"})]})}),t.jsxs(bu,{className:"pt-0",children:[t.jsx("div",{className:"text-xs text-muted-foreground",children:p(e.floor)}),r.floor===e.floor&&t.jsx("div",{className:"text-xs text-green-600 font-medium mt-1",children:"Posição Atual"})]})]},e.floor);var a}))}),t.jsx(pu,{className:"bg-muted/30",children:t.jsxs(bu,{className:"p-4",children:[t.jsxs("div",{className:"flex items-center justify-between text-sm",children:[t.jsx("span",{children:"Andar Atual:"}),t.jsx("span",{className:"font-bold",children:r.floor})]}),t.jsxs("div",{className:"flex items-center justify-between text-sm mt-1",children:[t.jsx("span",{children:"Checkpoints Desbloqueados:"}),t.jsx("span",{className:"font-bold",children:i.length})]})]})}),t.jsxs("div",{className:"flex gap-3 pt-4",children:[t.jsx(Wa,{variant:"outline",onClick:s,className:"flex-1",disabled:l,children:"Cancelar"}),t.jsxs(Wa,{onClick:async()=>{if(null!==d)try{c(!0),n(d),s()}catch(e){_.error("Erro ao iniciar aventura")}finally{c(!1)}else _.error("Selecione um checkpoint")},className:"flex-1",disabled:l||null===d,children:[l?t.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-t-2 border-b-2 border-white mr-2"}):t.jsx(lt,{className:"h-4 w-4 mr-2"}),"Iniciar Aventura"]})]})]})})]})})},_x=dt,wx=mt,Cx=ut,Sx=e.forwardRef((({className:e,sideOffset:a=4,...s},r)=>t.jsx(ct,{ref:r,sideOffset:a,className:Ga("z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",e),...s})));function Ex({value:e,baseValue:a,equipmentBonus:s=0,modifications:r=[],size:n="md",showTooltip:i=!1,label:o,icon:l,className:c=""}){const d=isNaN(e)||null==e?0:e,m=isNaN(a||0)||null==a?0:a||0,u=isNaN(s)||void 0===s?0:s,h=r.reduce(((e,t)=>{if("flat"===t.type)return e+(isNaN(t.value)?0:t.value);return e+(m||d)*((isNaN(t.value)?0:t.value)/100)}),0),p=r.length>0,x=t.jsxs("div",{className:`inline-flex items-center gap-1 ${{sm:"text-xs",md:"text-sm",lg:"text-base"}[n]} ${c}`,children:[l&&t.jsx("span",{className:"inline-flex",children:l}),t.jsx("span",{className:"font-bold transition-all duration-300 "+(p?"text-purple-400 animate-pulse drop-shadow-[0_0_6px_rgba(168,85,247,0.4)]":u>0?"text-green-400":""),children:Math.round(d)}),p&&t.jsxs("div",{className:"inline-flex items-center",children:[t.jsx("div",{className:"w-1 h-1 bg-purple-400 rounded-full animate-pulse"}),t.jsxs("div",{className:"ml-1 text-purple-300 text-xs animate-bounce",children:[h>0?"+":"",Math.round(h)]})]}),o&&t.jsx("span",{className:"text-muted-foreground ml-1",children:o})]});return i?t.jsx(_x,{children:t.jsxs(wx,{children:[t.jsx(Cx,{asChild:!0,children:x}),t.jsx(Sx,{className:"max-w-xs p-3",children:t.jsxs("div",{className:"space-y-2",children:[t.jsx("div",{className:"font-semibold text-sm",children:"Detalhes da Estatística"}),void 0!==a&&!isNaN(m)&&t.jsxs("div",{className:"flex justify-between text-xs",children:[t.jsx("span",{className:"text-muted-foreground",children:"Base:"}),t.jsx("span",{children:Math.round(m)})]}),u>0&&t.jsxs("div",{className:"flex justify-between text-xs",children:[t.jsx("span",{className:"text-muted-foreground",children:"Equipamentos:"}),t.jsxs("span",{className:"text-green-400 flex items-center gap-1",children:[t.jsx(Ke,{className:"h-3 w-3"}),Math.round(u)]})]}),r.length>0&&t.jsxs("div",{className:"space-y-1",children:[t.jsx("div",{className:"text-xs font-medium text-purple-400 border-t border-border pt-2",children:"Efeitos Mágicos:"}),r.map(((e,a)=>t.jsxs("div",{className:"flex justify-between text-xs",children:[t.jsxs("span",{className:"text-purple-300 flex items-center gap-1",children:[t.jsx("div",{className:"w-2 h-2 bg-purple-400 rounded-full animate-pulse"}),e.source_spell]}),t.jsxs("span",{className:"text-purple-400 flex items-center gap-1",children:[e.value>0?t.jsx(Fe,{className:"h-3 w-3"}):t.jsx(ht,{className:"h-3 w-3"}),e.value>0?"+":"",e.value,"percentage"===e.type?"%":""]})]},a))),t.jsxs("div",{className:"flex justify-between text-xs pt-1 border-t border-purple-500/20",children:[t.jsx("span",{className:"text-purple-300",children:"Total Mágico:"}),t.jsxs("span",{className:"text-purple-400 font-medium",children:[h>0?"+":"",Math.round(h)]})]})]}),t.jsxs("div",{className:"flex justify-between text-xs font-medium pt-2 border-t border-border",children:[t.jsx("span",{children:"Total:"}),t.jsx("span",{className:""+(p?"text-purple-400":"text-foreground"),children:Math.round(d)})]})]})})]})}):x}Sx.displayName=ct.displayName;const kx=e.memo((function({player:a}){const s=r(),[n,i]=e.useState(!1),[o,l]=e.useState(!1),c=e.useMemo((()=>{const e=(t=a.level)<=1?0:Math.floor(100*Math.pow(1.5,t-2));var t;const s=a.xp_next_level,r=a.xp-e,n=s-e;return{xpInCurrentLevel:r,xpNeededForNextLevel:n,xpProgress:Math.max(0,Math.min(100,r/n*100)),hpProgress:a.hp/a.max_hp*100,manaProgress:a.mana/a.max_mana*100}}),[a.level,a.xp,a.xp_next_level,a.hp,a.max_hp,a.mana,a.max_mana]),d=e.useMemo((()=>[{name:"FOR",fullName:"Força",value:a.strength||10,icon:qe,color:"text-red-400"},{name:"AGI",fullName:"Agilidade",value:a.dexterity||10,icon:Le,color:"text-green-400"},{name:"INT",fullName:"Inteligência",value:a.intelligence||10,icon:pt,color:"text-blue-400"},{name:"SAB",fullName:"Sabedoria",value:a.wisdom||10,icon:xt,color:"text-purple-400"},{name:"VIT",fullName:"Vitalidade",value:a.vitality||10,icon:Be,color:"text-pink-400"},{name:"SOR",fullName:"Sorte",value:a.luck||10,icon:Je,color:"text-yellow-400"}]),[a.strength,a.dexterity,a.intelligence,a.wisdom,a.vitality,a.luck]),m=e.useMemo((()=>[{key:"sword_mastery",level:a.sword_mastery||1,xp:a.sword_mastery_xp||0},{key:"axe_mastery",level:a.axe_mastery||1,xp:a.axe_mastery_xp||0},{key:"blunt_mastery",level:a.blunt_mastery||1,xp:a.blunt_mastery_xp||0},{key:"defense_mastery",level:a.defense_mastery||1,xp:a.defense_mastery_xp||0},{key:"magic_mastery",level:a.magic_mastery||1,xp:a.magic_mastery_xp||0}].filter((e=>e.level>1||e.xp>0))),[a.sword_mastery,a.sword_mastery_xp,a.axe_mastery,a.axe_mastery_xp,a.blunt_mastery,a.blunt_mastery_xp,a.defense_mastery,a.defense_mastery_xp,a.magic_mastery,a.magic_mastery_xp]),u=e=>{switch(e){case"sword_mastery":return t.jsx(qe,{className:"h-4 w-4 text-red-400"});case"axe_mastery":return t.jsx(yt,{className:"h-4 w-4 text-orange-400"});case"blunt_mastery":return t.jsx(vt,{className:"h-4 w-4 text-yellow-400"});case"defense_mastery":return t.jsx(De,{className:"h-4 w-4 text-blue-400"});case"magic_mastery":return t.jsx(pt,{className:"h-4 w-4 text-purple-400"});default:return t.jsx(bt,{className:"h-4 w-4 text-gray-400"})}},h=e=>{switch(e){case"sword_mastery":return"Maestria com Espadas";case"axe_mastery":return"Maestria com Machados";case"blunt_mastery":return"Maestria com Armas Pesadas";case"defense_mastery":return"Maestria em Defesa";case"magic_mastery":return"Maestria Mágica";default:return e}};return t.jsxs(pu,{className:"w-full bg-slate-900/80 border-slate-700 shadow-xl",children:[t.jsx(xu,{className:"pb-3",children:t.jsxs(fu,{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-3",children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("div",{className:"p-2 bg-slate-700 rounded-lg",children:t.jsx(K,{className:"h-5 w-5 text-slate-300"})}),t.jsxs("div",{children:[t.jsx("h2",{className:"text-xl font-bold text-slate-100",children:a.name}),t.jsx("p",{className:"text-sm text-slate-400",children:"Aventureiro"})]})]}),t.jsxs("div",{className:"flex items-center gap-2 sm:gap-3 flex-wrap",children:[t.jsxs(Wa,{onClick:async()=>{try{l(!0);const e=await Nh.getUnlockedCheckpoints(a.id);if(!e.success||!e.data||0===e.data.length)return;const t=e.data.sort(((e,t)=>t.floor-e.floor)),r=t[0];if(!(await Nh.startFromCheckpoint(a.id,r.floor)).success)return;s({to:"/game/play/hub/battle/$character",params:{character:a.id},search:{character:a.id}})}catch(e){}finally{l(!1)}},disabled:o,size:"sm",className:"quick-play-button relative overflow-hidden bg-gradient-to-r from-violet-600 via-purple-600 to-indigo-600 hover:from-violet-500 hover:via-purple-500 hover:to-indigo-500 text-white border border-violet-500/20 shadow-lg transition-all duration-300 hover:shadow-violet-500/25 hover:shadow-xl hover:-translate-y-0.5 flex-shrink-0 group disabled:opacity-60 disabled:cursor-not-allowed disabled:hover:transform-none",children:[t.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-violet-600/50 via-purple-600/50 to-indigo-600/50 opacity-0 group-hover:opacity-100 transition-opacity duration-300"}),!o&&t.jsx("div",{className:"quick-start-indicator absolute -top-1 -right-1 w-2 h-2 bg-amber-400 rounded-full shadow-sm shadow-amber-400/50"}),t.jsx(lt,{className:"h-3 w-3 mr-1.5 relative z-10 transition-transform duration-300 "+(o?"animate-spin":"group-hover:scale-110 group-hover:drop-shadow-lg")}),t.jsx("span",{className:"relative z-10 font-medium tracking-wide",children:o?"Iniciando...":"Jogar"}),!o&&t.jsx("div",{className:"absolute inset-0 opacity-0 group-hover:opacity-30 transition-opacity duration-500",children:t.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-transparent via-white/30 to-transparent -skew-x-12 group-hover:animate-pulse"})})]}),t.jsxs(Nu,{variant:"outline",className:"border-amber-500 text-amber-400 bg-amber-500/10 flex-shrink-0",children:[t.jsx(ft,{className:"h-3 w-3 mr-1"}),"Nível ",a.level]}),t.jsx(Wa,{variant:"ghost",size:"sm",onClick:()=>i(!n),className:"text-slate-400 hover:text-slate-200 flex-shrink-0",children:n?t.jsx(ce,{className:"h-4 w-4"}):t.jsx(oe,{className:"h-4 w-4"})})]})]})}),t.jsxs(bu,{className:"space-y-4",children:[t.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[t.jsxs("div",{className:"space-y-3",children:[t.jsx("h3",{className:"text-sm font-semibold text-slate-300 uppercase tracking-wide",children:"Status"}),t.jsxs("div",{className:"space-y-1",children:[t.jsxs("div",{className:"flex justify-between items-center text-sm",children:[t.jsxs("span",{className:"flex items-center gap-2 font-medium text-slate-300",children:[t.jsx(Be,{className:"h-4 w-4 text-red-400"}),"HP",a.hp<a.max_hp&&t.jsx("div",{className:"h-2 w-2 bg-green-400 rounded-full animate-pulse"})]}),t.jsxs("div",{className:"text-right",children:[t.jsx(Ex,{value:a.max_hp,baseValue:a.base_max_hp,equipmentBonus:a.equipment_hp_bonus,className:"text-red-400 font-medium",size:"sm",showTooltip:!0}),t.jsxs("div",{className:"text-xs text-slate-400",children:[a.hp,"/",a.max_hp]})]})]}),t.jsxs("div",{className:"relative",children:[t.jsx(Gh,{value:c.hpProgress,className:"h-2"}),t.jsx("div",{className:"absolute top-0 left-0 h-2 rounded-full transition-all duration-300 "+(c.hpProgress>=70?"bg-green-500":c.hpProgress>=40?"bg-yellow-500":c.hpProgress>=20?"bg-orange-500":"bg-red-500"),style:{width:`${c.hpProgress}%`}})]})]}),t.jsxs("div",{className:"space-y-1",children:[t.jsxs("div",{className:"flex justify-between items-center text-sm",children:[t.jsxs("span",{className:"flex items-center gap-2 font-medium text-slate-300",children:[t.jsx(pt,{className:"h-4 w-4 text-blue-400"}),"Mana"]}),t.jsxs("div",{className:"text-right",children:[t.jsx(Ex,{value:a.max_mana,baseValue:a.base_max_mana,equipmentBonus:a.equipment_mana_bonus,className:"text-blue-400 font-medium",size:"sm",showTooltip:!0}),t.jsxs("div",{className:"text-xs text-slate-400",children:[a.mana,"/",a.max_mana]})]})]}),t.jsxs("div",{className:"relative",children:[t.jsx(Gh,{value:c.manaProgress,className:"h-2"}),t.jsx("div",{className:"absolute top-0 left-0 h-2 rounded-full transition-all duration-300 "+(c.manaProgress>=70?"bg-blue-500":c.manaProgress>=40?"bg-cyan-500":c.manaProgress>=20?"bg-indigo-500":"bg-purple-500"),style:{width:`${c.manaProgress}%`}})]})]}),t.jsxs("div",{className:"space-y-1",children:[t.jsxs("div",{className:"flex justify-between items-center text-sm",children:[t.jsxs("span",{className:"flex items-center gap-2 font-medium text-slate-300",children:[t.jsx(ft,{className:"h-4 w-4 text-yellow-400"}),"XP"]}),t.jsxs("span",{className:"text-slate-400",children:[c.xpInCurrentLevel.toLocaleString(),"/",c.xpNeededForNextLevel.toLocaleString()]})]}),t.jsxs("div",{className:"relative",children:[t.jsx(Gh,{value:c.xpProgress,className:"h-2"}),t.jsx("div",{className:"absolute top-0 left-0 h-2 bg-gradient-to-r from-amber-400 via-yellow-500 to-orange-400 rounded-full transition-all duration-300",style:{width:`${c.xpProgress}%`}})]})]})]}),t.jsxs("div",{className:"space-y-3",children:[t.jsx("h3",{className:"text-sm font-semibold text-slate-300 uppercase tracking-wide",children:"Combat Stats"}),t.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[t.jsxs("div",{className:"space-y-2",children:[t.jsxs("div",{className:"flex items-center justify-between text-sm",children:[t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(qe,{className:"h-4 w-4 text-red-400"}),t.jsx("span",{className:"text-muted-foreground",children:"ATK"})]}),t.jsx(Ex,{value:a.atk,baseValue:a.base_atk,equipmentBonus:a.equipment_atk_bonus,modifications:a.active_effects?.attribute_modifications?.filter((e=>"atk"===e.attribute))||[],className:"text-red-400 font-bold",size:"sm",showTooltip:!0})]}),Boolean(a.magic_attack&&a.magic_attack>0)&&t.jsxs("div",{className:"flex items-center justify-between text-sm",children:[t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(pt,{className:"h-4 w-4 text-purple-400"}),t.jsx("span",{className:"text-muted-foreground",children:"M.ATK"})]}),t.jsx(Ex,{value:a.magic_attack||0,modifications:a.active_effects?.attribute_modifications?.filter((e=>"magic_attack"===e.attribute))||[],className:"text-purple-400 font-bold",size:"sm",showTooltip:!0})]}),t.jsxs("div",{className:"flex items-center justify-between text-sm",children:[t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(De,{className:"h-4 w-4 text-blue-400"}),t.jsx("span",{className:"text-muted-foreground",children:"DEF"})]}),t.jsx(Ex,{value:a.def,baseValue:a.base_def,equipmentBonus:a.equipment_def_bonus,modifications:a.active_effects?.attribute_modifications?.filter((e=>"def"===e.attribute))||[],className:"text-blue-400 font-bold",size:"sm",showTooltip:!0})]})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsxs("div",{className:"flex items-center justify-between text-sm",children:[t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(Le,{className:"h-4 w-4 text-yellow-400"}),t.jsx("span",{className:"text-muted-foreground",children:"SPD"})]}),t.jsx(Ex,{value:a.speed,baseValue:a.base_speed,equipmentBonus:a.equipment_speed_bonus,modifications:a.active_effects?.attribute_modifications?.filter((e=>"speed"===e.attribute))||[],className:"text-yellow-400 font-bold",size:"sm",showTooltip:!0})]}),t.jsxs("div",{className:"flex items-center justify-between text-sm",children:[t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(ft,{className:"h-4 w-4 text-amber-400"}),t.jsx("span",{className:"text-muted-foreground",children:"CRIT"})]}),t.jsxs("span",{className:"font-bold text-amber-400",children:[(a.critical_chance||0).toFixed(1),"%"]})]}),Boolean(a.magic_damage_bonus&&a.magic_damage_bonus>0)&&t.jsxs("div",{className:"flex items-center justify-between text-sm",children:[t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(pt,{className:"h-4 w-4 text-purple-400"}),t.jsx("span",{className:"text-muted-foreground",children:"M.BONUS"})]}),t.jsxs("span",{className:"font-bold text-purple-400",children:["+",Math.round(a.magic_damage_bonus||0),"%"]})]})]})]}),t.jsx("div",{className:"bg-slate-800/50 p-3 rounded-lg border border-slate-700",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(gt,{className:"h-4 w-4 text-yellow-400"}),t.jsx("span",{className:"text-sm font-medium text-slate-300",children:"Gold"})]}),t.jsx("p",{className:"text-lg font-bold text-yellow-400",children:a.gold.toLocaleString("pt-BR")})]})})]}),t.jsxs("div",{className:"space-y-3",children:[t.jsx("h3",{className:"text-sm font-semibold text-slate-300 uppercase tracking-wide",children:"Atributos"}),t.jsx("div",{className:"grid grid-cols-3 gap-2",children:d.map((e=>{const a=e.icon;return t.jsx("div",{className:"bg-slate-800/50 p-2 rounded-lg border border-slate-700 hover:bg-slate-700/50 transition-colors",title:e.fullName,children:t.jsxs("div",{className:"flex flex-col items-center gap-1",children:[t.jsx(a,{className:`h-3 w-3 ${e.color}`}),t.jsx("span",{className:"text-xs font-medium text-slate-400",children:e.name}),t.jsx("span",{className:`text-sm font-bold ${e.color}`,children:e.value})]})},e.name)}))}),Boolean(a.attribute_points&&a.attribute_points>0)&&t.jsx("div",{className:"bg-yellow-500/10 p-3 rounded-lg border border-yellow-500/30",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(Fe,{className:"h-4 w-4 text-yellow-400"}),t.jsx("span",{className:"text-sm font-medium text-yellow-300",children:"Pontos Disponíveis"})]}),t.jsx("p",{className:"text-lg font-bold text-yellow-400",children:a.attribute_points})]})})]})]}),n&&t.jsxs("div",{className:"border-t border-slate-700 pt-4 space-y-3",children:[t.jsx("h3",{className:"text-sm font-semibold text-slate-300 uppercase tracking-wide",children:"Habilidades de Combate"}),t.jsx("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-3",children:m.map((e=>{const a=100*e.level,s=100*(e.level-1),r=e.xp-s,n=a-s,i=Math.max(0,Math.min(100,r/n*100));return t.jsx("div",{className:"bg-slate-700/50 p-3 rounded-lg border border-slate-600 hover:border-slate-500 transition-colors",children:t.jsxs("div",{className:"flex flex-col items-center gap-2",children:[t.jsx("div",{className:"flex items-center justify-center",children:u(e.key)}),t.jsx("span",{className:"text-xs font-medium text-slate-400 text-center",children:h(e.key)}),t.jsxs(Nu,{variant:"outline",className:"border-current bg-transparent text-xs",children:["Nv. ",e.level]}),Boolean(e.xp>0)&&t.jsxs("div",{className:"w-full",children:[t.jsx("div",{className:"w-full h-1 bg-slate-600 rounded-full overflow-hidden",children:t.jsx("div",{className:"h-full bg-gradient-to-r from-blue-500 to-purple-500 transition-all duration-300",style:{width:`${i}%`}})}),t.jsxs("div",{className:"text-xs text-slate-500 mt-1 text-center",children:[r,"/",n," XP"]})]})]})},e.key)}))})]})]})]})}));function Ax({title:e,description:a,icon:s,onClick:r,badge:n,badgeColor:i="secondary",accent:o,isPrimary:l=!1}){return t.jsx(pu,{className:"group relative overflow-hidden border-slate-700 bg-slate-900/80 hover:bg-slate-800/80 transition-all duration-300 hover:border-slate-600 cursor-pointer "+(l?"ring-2 ring-red-600/30":""),children:t.jsxs(Wa,{variant:"ghost",className:"w-full h-full p-3 flex flex-col items-center justify-center space-y-2 hover:bg-transparent min-h-[120px] cursor-pointer",onClick:r,children:[t.jsxs("div",{className:"relative",children:[t.jsx("div",{className:`p-3 rounded-lg bg-slate-800 group-hover:bg-slate-700 transition-colors duration-300 ${o}`,children:t.jsx(s,{className:"h-5 w-5 text-slate-300 group-hover:text-white transition-colors duration-300"})}),n&&t.jsx(Nu,{variant:i,className:"absolute -top-2 -right-2 h-5 w-5 p-0 flex items-center justify-center text-xs font-bold bg-red-600 text-white border-red-500",children:n})]}),t.jsxs("div",{className:"text-center space-y-1 max-w-full",children:[t.jsx("h3",{className:"font-semibold text-sm text-slate-200 group-hover:text-white transition-colors duration-300 leading-tight",children:e}),t.jsx("p",{className:"text-xs text-slate-400 group-hover:text-slate-300 transition-colors duration-300 leading-tight px-1 break-words",children:a})]})]})})}function Px({player:e,onStartAdventure:a,onOpenMap:s,onOpenCharacterStats:r,onOpenShop:n,onOpenInventory:i,onOpenEquipment:o,onOpenSpells:l,onOpenCrafting:c,onOpenCemetery:d,onReturnToSelection:m}){const u=[{title:"Entrar na Torre",description:"Nova aventura",icon:te,onClick:a,accent:"border-red-600/30",isPrimary:!0},{title:"Mapa da Torre",description:"Usar checkpoint",icon:ot,onClick:s,accent:"border-blue-600/30"},{title:"Atributos",description:"Evoluir personagem",icon:Fe,onClick:r,badge:e.attribute_points&&e.attribute_points>0?e.attribute_points:void 0,badgeColor:"destructive",accent:"border-purple-600/30"},{title:"Grimório",description:"Gerenciar magias",icon:pt,onClick:l,accent:"border-violet-600/30"},{title:"Loja",description:"Comprar itens",icon:jt,onClick:n,accent:"border-green-600/30"},{title:"Inventário",description:"Consumíveis",icon:Nt,onClick:i,accent:"border-orange-600/30"},{title:"Equipamentos",description:"Armas e armaduras",icon:De,onClick:o,accent:"border-amber-600/30"},{title:"Forja",description:"Crafting de itens",icon:vt,onClick:c,accent:"border-cyan-600/30"},{title:"Cemitério",description:"Personagens mortos",icon:$e,onClick:d,accent:"border-red-600/30"},{title:"Trocar",description:"Outro personagem",icon:Pe,onClick:m,accent:"border-slate-600/30"}];return t.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-10 gap-3",children:u.map(((e,a)=>t.jsx(Ax,{title:e.title,description:e.description,icon:e.icon,onClick:e.onClick,badge:e.badge,badgeColor:e.badgeColor,accent:e.accent,isPrimary:e.isPrimary},a)))})}function Mx({player:e,showHealNotification:a,healInfo:s,onDismissHealNotification:r}){const n=e.attribute_points&&e.attribute_points>0;return a||n?t.jsxs("div",{className:"space-y-3",children:[n&&t.jsx(pu,{className:"bg-amber-950/50 border-amber-700/50 shadow-lg backdrop-blur-sm",children:t.jsx(bu,{className:"p-3",children:t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("div",{className:"p-2 bg-amber-600/20 rounded-lg",children:t.jsx(ft,{className:"h-4 w-4 text-amber-400"})}),t.jsxs("div",{className:"flex-1",children:[t.jsx("h3",{className:"font-semibold text-amber-200 text-sm",children:"Pontos de Atributo Disponíveis"}),t.jsxs("div",{className:"text-xs text-amber-300/80",children:["Você tem"," ",t.jsx(Nu,{variant:"outline",className:"mx-1 text-amber-200 bg-amber-600/20 border-amber-500/50 text-xs px-1.5 py-0.5",children:e.attribute_points}),'ponto(s) para distribuir em "Atributos".']})]}),t.jsx(We,{className:"h-4 w-4 text-amber-500 animate-pulse"})]})})}),a&&s&&t.jsx("div",{className:"fixed top-4 right-4 z-50 max-w-sm animate-in slide-in-from-top-2 duration-500",children:t.jsx(pu,{className:"bg-emerald-950/80 border-emerald-700/50 shadow-xl backdrop-blur-md",children:t.jsx(bu,{className:"p-3",children:t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("div",{className:"p-2 bg-emerald-600/20 rounded-lg",children:t.jsx(Be,{className:"h-4 w-4 text-emerald-400"})}),t.jsxs("div",{className:"flex-1",children:[t.jsxs("h3",{className:"font-semibold text-emerald-200 text-sm",children:[s.character," foi curado!"]}),t.jsxs("div",{className:"flex items-center gap-2 text-xs text-emerald-300",children:[t.jsx("span",{children:"HP:"}),t.jsxs("span",{className:"font-mono bg-emerald-900/50 px-2 py-0.5 rounded text-xs",children:[s.oldHp," → ",s.newHp]}),t.jsxs(Nu,{variant:"outline",className:"text-emerald-300 border-emerald-500/50 bg-emerald-600/20 text-xs px-1.5 py-0.5",children:["+",s.newHp-s.oldHp]})]})]}),t.jsx(Wa,{variant:"ghost",size:"sm",onClick:r,className:"h-6 w-6 p-0 text-emerald-400 hover:text-emerald-300 hover:bg-emerald-800/50",children:t.jsx(G,{className:"h-3 w-3"})})]})})})})]}):null}const Tx=l("/_authenticated/game/play/hub")({component:function(){const e=n(),{character:a}=Tx.useSearch();if("/game/play/hub"===e.pathname)return t.jsx(Dx,{characterId:a});return t.jsx(s,{})},validateSearch:e=>({character:e.character})});function qx({message:a="Carregando personagem..."}){const[s,r]=e.useState("");return e.useEffect((()=>{const e=setInterval((()=>{r((e=>"..."===e?"":e+"."))}),500);return()=>clearInterval(e)}),[]),t.jsx("div",{className:"flex items-center justify-center min-h-screen w-full bg-gradient-to-b from-slate-950 to-slate-900",children:t.jsxs("div",{className:"text-center text-white space-y-4",children:[t.jsx("div",{className:"animate-spin rounded-full h-16 w-16 border-t-2 border-b-2 border-blue-500 mx-auto"}),t.jsxs("p",{className:"text-lg font-medium",children:[a,t.jsx("span",{className:"inline-block w-8 text-left",children:s})]}),t.jsx("div",{className:"w-64 bg-slate-800 rounded-full h-2 mx-auto",children:t.jsx("div",{className:"bg-blue-500 h-2 rounded-full animate-pulse",style:{width:"60%"}})})]})})}function Dx({characterId:a}){const s=r(),{loadCharacterForHub:n}=jx(),i=lx((e=>e.gameState.mode)),o=lx((e=>e.gameState.player?.id)),l=lx((e=>e.gameState.player?.name)),c=lx((e=>e.gameState.player)),d=e.useCallback((async e=>{try{await n(e)}catch(t){throw t}}),[n]),[m,u]=e.useState("initial"),[h,p]=e.useState(null),[x,f]=e.useState(!1),g=e.useRef(!0),b=e.useRef(!1),v=e.useRef(null),y=e.useRef(null);if(e.useEffect((()=>(g.current=!0,()=>{g.current=!1,y.current&&clearTimeout(y.current)})),[]),e.useEffect((()=>{(async()=>{if(!a||""===a.trim())return u("error"),void p("ID do personagem inválido");if(g.current)if("hub"===i&&o===a&&l&&"initial"!==m)"loaded"!==m&&u("loaded");else if(!b.current||v.current!==a){b.current=!0,v.current=a,u("loading"),p(null),y.current=setTimeout((()=>{b.current&&g.current&&(u("error"),p("Timeout ao carregar personagem. Tente novamente."),b.current=!1)}),15e3);try{const e=lx.getState().gameState,t=e.player,s=!t?.id||t.id!==a||"hub"!==e.mode,r=await Nh.getCharacterForGame(a,s,!0);if(!r.success||!r.data)throw new Error(r.error||"Erro ao carregar personagem");const n=r.data;if(!g.current)return;await d(n),g.current&&(u("loaded"),y.current&&(clearTimeout(y.current),y.current=null))}catch(e){g.current&&(u("error"),p(e instanceof Error?e.message:"Erro desconhecido"),_.error("Erro ao carregar personagem",{description:e instanceof Error?e.message:"Erro desconhecido"}))}finally{b.current=!1,y.current&&(clearTimeout(y.current),y.current=null)}}})()}),[a,d]),e.useEffect((()=>{"hub"===i&&o===a&&l&&"loading"===m&&u("loaded")}),[i,o,l,a,m]),"initial"===m||"loading"===m)return t.jsx(qx,{message:"Carregando personagem..."});if("error"===m)return t.jsx("div",{className:"flex items-center justify-center min-h-screen w-full bg-gradient-to-b from-slate-950 to-slate-900",children:t.jsxs("div",{className:"text-center text-white space-y-4 max-w-md mx-auto p-6",children:[t.jsx("div",{className:"w-16 h-16 mx-auto bg-red-500/20 rounded-full flex items-center justify-center",children:t.jsx("svg",{className:"w-8 h-8 text-red-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"})})}),t.jsx("h2",{className:"text-xl font-bold text-red-400",children:"Erro no Carregamento"}),t.jsx("p",{className:"text-slate-300",children:h||"Erro ao carregar dados do personagem"}),t.jsxs("div",{className:"space-y-2",children:[t.jsx(Wa,{onClick:()=>{u("initial"),p(null)},className:"w-full",children:"Tentar Novamente"}),t.jsxs(Wa,{variant:"outline",onClick:()=>s({to:"/game/play"}),className:"w-full",children:[t.jsx(Pe,{className:"h-4 w-4 mr-2"}),"Voltar à Seleção"]})]})]})});if(!c?.id)return t.jsx("div",{className:"flex items-center justify-center min-h-screen w-full bg-gradient-to-b from-slate-950 to-slate-900",children:t.jsxs("div",{className:"text-center text-white space-y-4 max-w-md mx-auto p-6",children:[t.jsx("div",{className:"w-16 h-16 mx-auto bg-yellow-500/20 rounded-full flex items-center justify-center",children:t.jsx("svg",{className:"w-8 h-8 text-yellow-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"})})}),t.jsx("h2",{className:"text-xl font-bold text-yellow-400",children:"Personagem não carregado"}),t.jsx("p",{className:"text-slate-300",children:"Os dados do personagem não puderam ser carregados."}),t.jsxs(Wa,{onClick:()=>s({to:"/game/play"}),className:"w-full",children:[t.jsx(Pe,{className:"h-4 w-4 mr-2"}),"Voltar à Seleção"]})]})});return t.jsx("div",{className:"min-h-screen w-full bg-gradient-to-b from-slate-950 to-slate-900 p-2 md:p-4",children:t.jsxs("div",{className:"w-full max-w-7xl mx-auto space-y-4",children:[t.jsx("div",{className:"space-y-3 sm:space-y-4",children:t.jsxs("div",{className:"flex flex-col gap-3",children:[t.jsxs("div",{className:"flex flex-wrap gap-2",children:[t.jsxs(Wa,{variant:"outline",size:"sm",onClick:()=>s({to:"/game/play"}),className:"flex-shrink-0",children:[t.jsx(Pe,{className:"h-4 w-4 mr-2"}),t.jsx("span",{className:"hidden sm:inline",children:"Trocar Personagem"}),t.jsx("span",{className:"sm:hidden",children:"Trocar"})]}),t.jsxs(Wa,{variant:"ghost",size:"sm",onClick:()=>s({to:"/game"}),className:"flex-shrink-0",children:[t.jsx("span",{className:"hidden sm:inline",children:"Menu Principal"}),t.jsx("span",{className:"sm:hidden",children:"Menu"})]})]}),t.jsxs("div",{children:[t.jsxs("h1",{className:"text-2xl sm:text-3xl font-bold text-white",children:["Hub de ",c.name||"Carregando..."]}),t.jsxs("p",{className:"text-sm sm:text-base text-slate-300",children:["Andar ",Math.max(1,c.floor||1)," • Nível ",c.level||1," •"," ",(c.gold||0).toLocaleString("pt-BR")," Gold"]})]})]})}),t.jsx(Mx,{player:c,showHealNotification:!1,healInfo:null,onDismissHealNotification:()=>{}}),t.jsxs("div",{className:"space-y-4",children:[t.jsx(kx,{player:c}),t.jsx(Px,{player:c,onStartAdventure:async()=>{if(c?.id)try{await Nh.updateCharacterFloor(c.id,1),s({to:"/game/play/hub/battle/$character",params:{character:c.id},search:{character:c.id}})}catch{_.error("Erro ao iniciar aventura")}else _.error("Erro: Personagem não carregado")},onOpenMap:()=>f(!0),onOpenCharacterStats:()=>window.location.href=`/game/play/hub/character-stats?character=${c.id}`,onOpenShop:()=>window.location.href=`/game/play/hub/shop?character=${c.id}`,onOpenInventory:()=>window.location.href=`/game/play/hub/inventory?character=${c.id}`,onOpenEquipment:()=>window.location.href=`/game/play/hub/equipment?character=${c.id}`,onOpenSpells:()=>window.location.href=`/game/play/hub/spells?character=${c.id}`,onOpenCrafting:()=>window.location.href=`/game/play/hub/crafting?character=${c.id}`,onOpenCemetery:()=>window.location.href="/game/play/hub/cemetery",onReturnToSelection:()=>s({to:"/game/play"})})]}),t.jsx(Nx,{isOpen:x,onClose:()=>f(!1),character:{id:c.id,floor:c.floor},onStartFromCheckpoint:async e=>{if(c?.id)try{const t=await Nh.startFromCheckpoint(c.id,e);t.success?s({to:"/game/play/hub/battle/$character",params:{character:c.id},search:{character:c.id}}):_.error("Erro ao iniciar do checkpoint",{description:t.error})}catch{_.error("Erro ao iniciar do checkpoint")}else _.error("Erro: Personagem não carregado")}})]})})}const Lx=e.lazy((()=>u((()=>import("./SpellsPage-BOKD9Y3K.js")),__vite__mapDeps([0,1,2,3,4,5])))),$x=l("/_authenticated/game/play/hub/spells")({component:Lx,validateSearch:e=>({character:e.character||""})}),Rx="/assets",Ix={"poção de vida pequena":"small_health_potion.png","pequena poção de vida":"small_health_potion.png","small health potion":"small_health_potion.png","poção de hp pequena":"small_health_potion.png","poção de mana pequena":"small_mana_potion.png","pequena poção de mana":"small_mana_potion.png","small mana potion":"small_mana_potion.png","poção de mp pequena":"small_mana_potion.png",potion_hp_small:"small_health_potion.png",potion_mana_small:"small_mana_potion.png"};class Fx{static iconCache=new Map;static preloadedAnimations=new Map;static loadingPromises=new Map;static getConsumableIcon(e){const t=`consumable-${e.id}`;if(this.iconCache.has(t))return this.iconCache.get(t);let a;const s=e.name.toLowerCase().trim();return a=Ix[s]?`${Rx}/icons/consumables/${Ix[s]}`:this.getConsumableIconByType(e),this.iconCache.set(t,a),a}static getConsumableIconByType(e){const t=`${Rx}/icons/consumables`;return"potion"===e.type?e.description.includes("HP")||e.description.includes("Vida")?e.effect_value<=30?`${t}/small_health_potion.png`:e.effect_value<=60?`${t}/health-potion-medium.png`:`${t}/health-potion-large.png`:e.description.includes("Mana")?e.effect_value<=15?`${t}/small_mana_potion.png`:e.effect_value<=30?`${t}/mana-potion-medium.png`:`${t}/mana-potion-large.png`:`${t}/small_health_potion.png`:"buff"===e.type||"elixir"===e.type?e.description.includes("Força")||e.description.includes("ataque")?`${t}/strength-elixir.png`:e.description.includes("Defesa")?`${t}/defense-elixir.png`:`${t}/strength-elixir.png`:"antidote"===e.type?`${t}/antidote.png`:`${t}/small_health_potion.png`}static addConsumableMapping(e,t){Ix[e.toLowerCase().trim()]=t}static async preloadCharacterAnimation(e,t,a=3){const s=`${e}-${t}`;if(this.loadingPromises.has(s))return void(await this.loadingPromises.get(s));if(this.preloadedAnimations.has(s))return;const r=this.loadAnimationFrames(e,t,a);this.loadingPromises.set(s,r);try{await r}finally{this.loadingPromises.delete(s)}}static async loadAnimationFrames(e,t,a){const s=`${e}-${t}`,r=new Map,n=[];for(let i=1;i<=a;i++){const a=i.toString().padStart(2,"0"),s=`${Rx}/characters/${e}/${t}/${e}-${t}-${a}.png`,o={element:new Image,loaded:!1,path:s};r.set(i,o);const l=new Promise((e=>{o.element.onload=()=>{o.loaded=!0,e()},o.element.onerror=()=>{e()},o.element.src=s}));n.push(l)}await Promise.all(n),this.preloadedAnimations.set(s,r)}static getCharacterAnimationFrame(e,t,a){const s=a.toString().padStart(2,"0"),r=`${Rx}/characters/${e}/${t}/${e}-${t}-${s}.png`,n=`character-${e}-${t}-${a}`;return this.iconCache.set(n,r),r}static getPreloadedAnimationFrame(e,t,a){const s=`${e}-${t}`,r=this.preloadedAnimations.get(s);if(!r)return null;const n=r.get(a);return n?.loaded?n.element:null}static isAnimationPreloaded(e,t){const a=`${e}-${t}`;return this.preloadedAnimations.has(a)}static getEquipmentIcon(e){const t=`equipment-${e.id}`;if(this.iconCache.has(t))return this.iconCache.get(t);let a;const s=`${Rx}/icons/equipment`;switch(e.type){case"weapon":a=e.name.toLowerCase().includes("espada")||e.name.toLowerCase().includes("sword")?e.level_requirement<=5?`${s}/weapons/swords/wooden-sword.png`:e.level_requirement<=15?`${s}/weapons/swords/iron-sword.png`:`${s}/weapons/swords/steel-sword.png`:e.name.toLowerCase().includes("cajado")||e.name.toLowerCase().includes("staff")?e.level_requirement<=10?`${s}/weapons/staffs/basic-staff.png`:`${s}/weapons/staffs/magic-staff.png`:e.name.toLowerCase().includes("arco")||e.name.toLowerCase().includes("bow")?`${s}/weapons/bows/wooden-bow.png`:`${s}/weapons/swords/iron-sword.png`;break;case"armor":a=e.level_requirement<=5?`${s}/armor/chest/leather-armor.png`:e.level_requirement<=15?`${s}/armor/chest/iron-armor.png`:`${s}/armor/chest/steel-armor.png`;break;case"ring":case"necklace":case"amulet":a="ring"===e.type?`${s}/accessories/rings/basic-ring.png`:"necklace"===e.type?`${s}/accessories/necklaces/basic-necklace.png`:`${s}/accessories/amulets/basic-amulet.png`;break;default:a=`${s}/weapons/swords/iron-sword.png`}return this.iconCache.set(t,a),a}static getMaterialIcon(e,t){const a=`material-${e}-${t}`;if(this.iconCache.has(a))return this.iconCache.get(a);const s=`${Rx}/icons/materials/${e}/${t.toLowerCase().replace(/\s+/g,"-")}.png`;return this.iconCache.set(a,s),s}static getMonsterPortrait(e,t){const a=`monster-portrait-${e}-${t}`;if(this.iconCache.has(a))return this.iconCache.get(a);const s=e.toLowerCase().replace(/\s+/g,"-"),r=`${Rx}/monsters/portraits/floor-${t}/${s}.png`;return this.iconCache.set(a,r),r}static getEnvironmentBackground(e,t){const a=`bg-${e}-${t}`;if(this.iconCache.has(a))return this.iconCache.get(a);const s=`${Rx}/environments/backgrounds/${e}/${t}-bg.png`;return this.iconCache.set(a,s),s}static getStatusIcon(e,t){const a=`status-${e}-${t}`;if(this.iconCache.has(a))return this.iconCache.get(a);const s=t.toLowerCase().replace(/\s+/g,"-"),r=`${Rx}/icons/status/${e}s/${s}.png`;return this.iconCache.set(a,r),r}static getUIIcon(e,t){const a=`ui-${e}-${t}`;if(this.iconCache.has(a))return this.iconCache.get(a);const s=`${Rx}/icons/ui/${e}/${t}.png`;return this.iconCache.set(a,s),s}static clearCache(){this.iconCache.clear(),this.preloadedAnimations.clear(),this.loadingPromises.clear()}static async preloadCriticalAssets(){const e=[`${Rx}/icons/consumables/small_health_potion.png`,`${Rx}/icons/consumables/small_mana_potion.png`,`${Rx}/icons/equipment/weapons/swords/wooden-sword.png`,`${Rx}/icons/equipment/armor/chest/leather-armor.png`,`${Rx}/icons/ui/buttons/primary-button.png`,`${Rx}/icons/ui/frames/inventory-frame.png`].map((e=>new Promise(((t,a)=>{const s=new Image;s.onload=()=>t(),s.onerror=()=>a(new Error(`Failed to load ${e}`)),s.src=e})))),t=[this.preloadCharacterAnimation("thief","idle",3)];try{await Promise.all([...e,...t])}catch(a){}}static async assetExists(e){return new Promise((t=>{const a=new Image;a.onload=()=>t(!0),a.onerror=()=>t(!1),a.src=e}))}static getFallbackAsset(e){return{icons:`${Rx}/icons/ui/placeholder.png`,characters:`${Rx}/characters/player/portraits/default.png`,monsters:`${Rx}/monsters/portraits/placeholder.png`,environments:`${Rx}/environments/backgrounds/default-bg.png`,effects:`${Rx}/effects/placeholder.png`,audio:""}[e]}}function Vx(e){if(!e.effect_value||e.effect_value<=0)return"";switch(e.type){case"potion":return e.description.includes("HP")||e.description.includes("Vida")?`+${e.effect_value} HP`:e.description.includes("Mana")?`+${e.effect_value} Mana`:`+${e.effect_value}`;case"buff":case"elixir":return e.description.includes("Força")||e.description.includes("ataque")?`+${e.effect_value} Ataque por 3 turnos`:e.description.includes("Defesa")?`+${e.effect_value} Defesa por 3 turnos`:`+${e.effect_value} por 3 turnos`;case"antidote":return"Remove efeitos negativos";default:return`+${e.effect_value}`}}function Ox(e,t){if(e&&"object"==typeof e){if("message"in e&&"string"==typeof e.message)return e.message;if(e instanceof Error)return e.message}return t}class Bx{static consumableCache=new Map;static dropCache=new Map;static recipeCache=new Map;static lastFetchTimestamp=0;static CACHE_DURATION=3e5;static async getAvailableConsumables(){try{const e=Date.now();if(e-this.lastFetchTimestamp<this.CACHE_DURATION&&this.consumableCache.size>0){return{data:Array.from(this.consumableCache.values()),error:null,success:!0}}const{data:t,error:a}=await Aa.from("consumables").select("*").order("price");if(a)throw a;return this.consumableCache.clear(),t.forEach((e=>{this.consumableCache.set(e.id,e)})),this.lastFetchTimestamp=e,{data:t,error:null,success:!0}}catch(e){return{data:null,error:"Erro ao buscar consumíveis",success:!1}}}static async getCharacterConsumables(e){try{const{data:t,error:a}=await Aa.from("character_consumables").select("\n          *,\n          consumable:consumable_id (*)\n        ").eq("character_id",e);if(a)throw a;return{data:t,error:null,success:!0}}catch(t){return{data:null,error:"Erro ao buscar consumíveis do personagem",success:!1}}}static async buyConsumable(e,t,a=1){try{const{data:s,error:r}=await Aa.rpc("buy_consumable",{p_character_id:e,p_consumable_id:t,p_quantity:a}).single();if(r)throw r;return{data:{newGold:s},error:null,success:!0}}catch(s){return{data:null,error:Ox(s,"Erro ao comprar consumível"),success:!1}}}static async consumeItem(e,t,a){try{const{data:s,error:r}=await Aa.from("character_consumables").select("\n          *,\n          consumable:consumable_id (*)\n        ").eq("character_id",e).eq("consumable_id",t).single();if(r)throw r;const n=s;if(!n||n.quantity<=0)return{data:null,error:"Você não possui este item",success:!1};const i=n.consumable;let o="";const l={};switch(i.type){case"potion":if(function(e){if("potion"!==e.type)return!1;const t=`${e.name} ${e.description}`.toLowerCase();return t.includes("vida")||t.includes("hp")||t.includes("health")||t.includes("cura")||t.includes("heal")||t.includes("restaura hp")||t.includes("recupera hp")}(i)){const e=Math.floor(Number(a.hp)||0),t=Math.floor(Number(a.max_hp)||1),s=Math.floor(Number(i.effect_value)||0),r=Math.min(t,e+s),n=r-e;a.hp=r,l.hp=r,o=n>0?`Recuperou ${n} HP!`:"HP já estava no máximo!"}else if(function(e){if("potion"!==e.type)return!1;const t=`${e.name} ${e.description}`.toLowerCase();return t.includes("mana")||t.includes("mp")||t.includes("magia")||t.includes("magic")||t.includes("energia")||t.includes("restaura mana")||t.includes("recupera mana")}(i)){const e=Math.floor(Number(a.mana)||0),t=Math.floor(Number(a.max_mana)||1),s=Math.floor(Number(i.effect_value)||0),r=Math.min(t,e+s),n=r-e;a.mana=r,l.mana=r,o=n>0?`Recuperou ${n} Mana!`:"Mana já estava no máximo!"}break;case"antidote":"active_effects"in a?(a.active_effects.debuffs=[],a.active_effects.dots=[],o="Todos os efeitos negativos foram removidos!"):o="Antídoto só pode ser usado durante batalhas!";break;case"buff":"active_effects"in a?i.description.includes("Força")||i.description.includes("ataque")?(a.atk+=i.effect_value,a.active_effects.buffs.push({type:"buff",value:i.effect_value,duration:3,source_spell:"elixir_strength"}),o=`Ataque aumentado em ${i.effect_value} por 3 turnos!`):(i.description.includes("Defesa")||i.description.includes("defesa"))&&(a.def+=i.effect_value,a.active_effects.buffs.push({type:"buff",value:i.effect_value,duration:3,source_spell:"elixir_defense"}),o=`Defesa aumentada em ${i.effect_value} por 3 turnos!`):o="Elixires só podem ser usados durante batalhas!"}const{error:c}=await Aa.rpc("use_consumable",{p_character_id:e,p_consumable_id:t});if(c)throw c;if(Object.keys(l).length>0){const{error:t}=await Aa.from("characters").update(l).eq("id",e);if(t)throw t}return{data:{message:o},error:null,success:!0}}catch(s){return{data:null,error:Ox(s,"Erro ao usar consumível"),success:!1}}}static async getMonsterDrops(){try{if(Date.now()-this.lastFetchTimestamp<this.CACHE_DURATION&&this.dropCache.size>0){return{data:Array.from(this.dropCache.values()),error:null,success:!0}}const{data:e,error:t}=await Aa.from("monster_drops").select("*").order("rarity");if(t)throw t;return this.dropCache.clear(),e.forEach((e=>{this.dropCache.set(e.id,e)})),{data:e,error:null,success:!0}}catch(e){return{data:null,error:"Erro ao buscar drops",success:!1}}}static processMonsterDrops(e,t,a=1){const s=[];return t.forEach((t=>{const r=t.drop_chance*(1+.02*e)*a;if(Math.random()<=Math.min(.95,r)){const e=Math.floor(Math.random()*(t.max_quantity-t.min_quantity+1)+t.min_quantity);e>0&&s.push({drop_id:t.drop_id,quantity:e})}})),s}static async addDropsToInventory(e,t){try{if(0===t.length)return{data:0,error:null,success:!0};const a=t.map((e=>({drop_id:e.drop_id,quantity:e.quantity}))),{supabaseAdmin:s}=await u((async()=>{const{supabaseAdmin:e}=await Promise.resolve().then((()=>Ma));return{supabaseAdmin:e}}),void 0),{data:r,error:n}=await s.rpc("secure_process_combat_drops",{p_character_id:e,p_drops:a}).single();if(n)throw n;return{data:r,error:null,success:!0}}catch(a){return{data:null,error:Ox(a,"Erro ao processar drops"),success:!1}}}static async getCraftingRecipes(){try{if(Date.now()-this.lastFetchTimestamp<this.CACHE_DURATION&&this.recipeCache.size>0){return{data:Array.from(this.recipeCache.values()),error:null,success:!0}}const{data:e,error:t}=await Aa.from("crafting_recipes").select("\n          *,\n          ingredients:crafting_ingredients (*)\n        ");if(t)throw t;return this.recipeCache.clear(),e.forEach((e=>{this.recipeCache.set(e.result_id,e)})),{data:e,error:null,success:!0}}catch(e){return{data:null,error:"Erro ao buscar receitas",success:!1}}}static async canCraftItem(e,t){try{const{data:a,error:s}=await Aa.rpc("check_can_craft",{p_character_id:e,p_recipe_id:t});if(s)throw s;return{data:a,error:null,success:!0}}catch(a){return{data:null,error:Ox(a,"Erro ao verificar crafting"),success:!1}}}static async craftItem(e,t){try{const{error:a}=await Aa.rpc("craft_item",{p_character_id:e,p_recipe_id:t});if(a)throw a;return{data:{message:"Item criado com sucesso!"},error:null,success:!0}}catch(a){return{data:null,error:Ox(a,"Erro ao criar item"),success:!1}}}static async getCharacterDrops(e){try{const{data:t,error:a}=await Aa.from("character_drops").select("\n          *,\n          drop:drop_id (*)\n        ").eq("character_id",e);if(a)throw a;return{data:t,error:null,success:!0}}catch(t){return{data:null,error:"Erro ao buscar drops do personagem",success:!1}}}static async checkIngredients(e,t){try{const a=[];let s=!0;const[r,n]=await Promise.all([this.getCharacterConsumables(e),this.getCharacterDrops(e)]),i=r.success?r.data:[],o=n.success?n.data:[];for(const e of t)if("monster_drop"===e.item_type){const t=o?.find((t=>t.drop_id===e.item_id));if(!t||t.quantity<e.quantity){s=!1;const e=t?.drop?.name||"Item desconhecido";a.push(e)}}else if("consumable"===e.item_type){const t=i?.find((t=>t.consumable_id===e.item_id));if(!t||t.quantity<e.quantity){s=!1;const e=t?.consumable?.name||"Item desconhecido";a.push(e)}}return{data:{hasAll:s,missing:a},error:null,success:!0}}catch(a){return{data:null,error:"Erro ao verificar ingredientes",success:!1}}}static async getDropInfoByIds(e){try{if(0===e.length)return{data:[],error:null,success:!0};const{data:t,error:a}=await Aa.from("monster_drops").select("id, name, description, rarity, value").in("id",e);return a?{data:null,error:a.message,success:!1}:{data:t||[],error:null,success:!0}}catch(t){return{data:null,error:"Erro ao buscar informações dos drops",success:!1}}}static async sellConsumablesBatch(e,t){try{const{data:a,error:s}=await Aa.rpc("sell_character_consumables_batch",{p_character_id:e,p_consumable_sales:t}).single();if(s)throw s;const r=a;return{data:{totalGoldEarned:r.total_gold_earned,itemsSold:r.items_sold,newGold:r.new_character_gold},error:null,success:!0}}catch(a){return{data:null,error:Ox(a,"Erro ao vender consumíveis"),success:!1}}}static async sellDropsBatch(e,t){try{const{data:a,error:s}=await Aa.rpc("sell_character_drops_batch",{p_character_id:e,p_drop_sales:t}).single();if(s)throw s;const r=a;return{data:{totalGoldEarned:r.total_gold_earned,itemsSold:r.items_sold,newGold:r.new_character_gold},error:null,success:!0}}catch(a){return{data:null,error:Ox(a,"Erro ao vender materiais"),success:!1}}}static async calculateConsumableSellPrice(e,t,a=1){try{const{data:s,error:r}=await Aa.rpc("calculate_sell_prices",{p_character_id:e,p_item_type:"consumable",p_item_id:t,p_quantity:a}).single();if(r)throw r;const n=s;return{data:{canSell:n.can_sell,availableQuantity:n.available_quantity,unitSellPrice:n.unit_sell_price,totalSellPrice:n.total_sell_price,originalPrice:n.original_price},error:null,success:!0}}catch(s){return{data:null,error:Ox(s,"Erro ao calcular preço"),success:!1}}}static async calculateDropSellPrice(e,t,a=1){try{const{data:s,error:r}=await Aa.rpc("calculate_sell_prices",{p_character_id:e,p_item_type:"drop",p_item_id:t,p_quantity:a}).single();if(r)throw r;const n=s;return{data:{canSell:n.can_sell,availableQuantity:n.available_quantity,unitSellPrice:n.unit_sell_price,totalSellPrice:n.total_sell_price,originalPrice:n.original_price},error:null,success:!0}}catch(s){return{data:null,error:Ox(s,"Erro ao calcular preço"),success:!1}}}}var Ux="horizontal",zx=["horizontal","vertical"],Hx=e.forwardRef(((e,a)=>{const{decorative:s,orientation:r=Ux,...n}=e,i=function(e){return zx.includes(e)}(r)?r:Ux,o=s?{role:"none"}:{"aria-orientation":"vertical"===i?i:void 0,role:"separator"};return t.jsx(re.div,{"data-orientation":i,...o,...n,ref:a})}));Hx.displayName="Separator";var Gx=Hx;const Xx=e.forwardRef((({className:e,orientation:a="horizontal",decorative:s=!0,...r},n)=>t.jsx(Gx,{ref:n,decorative:s,orientation:a,className:Ga("shrink-0 bg-border","horizontal"===a?"h-[1px] w-full":"h-full w-[1px]",e),...r})));Xx.displayName=Gx.displayName;const Wx=({characterId:a,newEquipment:s,slotType:r,currentEquipment:n,showTitle:i=!0,compact:o=!1})=>{const[l,c]=e.useState([]),[d,m]=e.useState(!0),[u,h]=e.useState(null);e.useEffect((()=>{(async()=>{m(!0),h(null);try{const e=await Nh.getCharacterForGame(a,!0,!1);if(e.success&&e.data){const t=e.data,a=[];[{name:"Ataque",current:t.atk,bonus:s.atk_bonus},{name:"Defesa",current:t.def,bonus:s.def_bonus},{name:"Mana",current:t.max_mana,bonus:s.mana_bonus},{name:"Velocidade",current:t.speed,bonus:s.speed_bonus},{name:"HP",current:t.max_hp,bonus:s.hp_bonus},{name:"Chance Crítica",current:t.critical_chance||0,bonus:s.critical_chance_bonus},{name:"Dano Crítico",current:t.critical_damage||130,bonus:s.critical_damage_bonus},{name:"Duplo Ataque",current:t.double_attack_chance||0,bonus:s.double_attack_chance_bonus},{name:"Dano Mágico",current:t.magic_damage_bonus||0,bonus:s.magic_damage_bonus}].forEach((e=>{e.bonus>0&&a.push({stat_name:e.name,current_value:e.current,new_value:e.current+e.bonus,difference:e.bonus,is_improvement:e.bonus>0})})),c(a)}else h("Erro ao carregar stats do personagem")}catch(e){h("Erro ao carregar comparação")}finally{m(!1)}})()}),[a,s.id,r,n]);const p=e=>{const a=e.toLowerCase();return a.includes("attack")||a.includes("dano")?t.jsx(te,{className:"w-3 h-3"}):a.includes("defense")||a.includes("defesa")?t.jsx(De,{className:"w-3 h-3"}):a.includes("speed")||a.includes("velocidade")?t.jsx(Le,{className:"w-3 h-3"}):a.includes("hp")||a.includes("vida")?t.jsx(Be,{className:"w-3 h-3"}):t.jsx(pt,{className:"w-3 h-3"})},x=(e,a)=>0===a?t.jsx(_t,{className:"w-4 h-4 text-muted-foreground/60"}):e?t.jsx(Fe,{className:"w-4 h-4 text-emerald-400 drop-shadow-[0_0_6px_rgba(16,185,129,0.4)]"}):t.jsx(ht,{className:"w-4 h-4 text-red-400 drop-shadow-[0_0_6px_rgba(239,68,68,0.4)]"}),f=(e,t)=>{if(0===e)return"—";return`${t?"+":""}${e.toFixed(e%1==0?0:2)}`},g=(e,t)=>0===t?"text-muted-foreground/60":e?"text-emerald-400 drop-shadow-[0_0_6px_rgba(16,185,129,0.3)]":"text-red-400 drop-shadow-[0_0_6px_rgba(239,68,68,0.3)]";return d?t.jsx("div",{className:(o?"p-3":"p-6")+" border border-border/50 rounded-xl bg-card/40 backdrop-blur-sm",children:t.jsxs("div",{className:"flex items-center justify-center space-x-3",children:[t.jsx(D,{className:"w-5 h-5 animate-spin text-primary/70"}),t.jsx("span",{className:"text-sm text-muted-foreground font-medium",children:"Analisando modificações mágicas..."})]})}):u?t.jsx("div",{className:(o?"p-3":"p-6")+" border border-destructive/30 rounded-xl bg-destructive/5 backdrop-blur-sm",children:t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(Le,{className:"w-4 h-4 text-destructive/70"}),t.jsx("p",{className:"text-sm text-destructive font-medium",children:u})]})}):0===l.length?t.jsx("div",{className:(o?"p-3":"p-6")+" border border-border/50 rounded-xl bg-card/30 backdrop-blur-sm",children:t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(pt,{className:"w-4 h-4 text-muted-foreground/60"}),t.jsx("p",{className:"text-sm text-muted-foreground font-medium",children:null===n?"Slot vazio — equipamento será adicionado":"Atributos inalterados"})]})}):t.jsxs("div",{className:`\n      ${o?"p-3":"p-6"} \n      border border-border/50 rounded-xl \n      bg-gradient-to-br from-card/80 to-card/40 \n      backdrop-blur-sm\n      transition-all duration-300 \n      hover:border-border/70 hover:shadow-lg hover:shadow-primary/5\n      card-enhanced\n    `,children:[i&&t.jsxs("div",{className:"flex items-center space-x-2 mb-4",children:[t.jsx(pt,{className:"w-4 h-4 text-primary/70"}),t.jsx("h4",{className:(o?"text-sm":"text-base")+" font-semibold text-foreground",children:"Modificações Mágicas"})]}),t.jsx("div",{className:"space-y-2",children:l.map(((e,a)=>{return t.jsxs("div",{className:`\n              relative overflow-hidden\n              rounded-lg border p-3\n              ${s=e.is_improvement,r=e.difference,0===r?"bg-muted/30 border-muted/40":s?"bg-emerald-500/10 border-emerald-500/30 magical-border":"bg-red-500/10 border-red-500/30"}\n              transition-all duration-200 hover:scale-[1.02]\n              ${o?"text-xs":"text-sm"}\n            `,children:[t.jsxs("div",{className:"flex items-center justify-between relative z-10",children:[t.jsxs("div",{className:"flex items-center space-x-2",children:[p(e.stat_name),t.jsx("span",{className:"font-medium text-foreground/90",children:e.stat_name})]}),t.jsxs("div",{className:"flex items-center space-x-3",children:[t.jsxs("div",{className:"text-right",children:[t.jsx("div",{className:"text-xs text-muted-foreground/70 font-medium uppercase tracking-wide",children:"Atual"}),t.jsx("div",{className:"font-mono font-semibold text-foreground/80",children:e.current_value.toFixed(e.current_value%1==0?0:2)})]}),t.jsxs("div",{className:"flex items-center space-x-1 min-w-[60px] justify-center",children:[x(e.is_improvement,e.difference),t.jsx("span",{className:`font-mono font-bold ${g(e.is_improvement,e.difference)}`,children:f(e.difference,e.is_improvement)})]}),t.jsxs("div",{className:"text-right",children:[t.jsx("div",{className:"text-xs text-muted-foreground/70 font-medium uppercase tracking-wide",children:"Novo"}),t.jsx("div",{className:"font-mono font-bold text-foreground",children:e.new_value.toFixed(e.new_value%1==0?0:2)})]})]})]}),0!==e.difference&&t.jsx("div",{className:"absolute inset-0 opacity-10",children:t.jsx("div",{className:`\n                  w-full h-full rounded-lg\n                  ${e.is_improvement?"bg-gradient-to-r from-emerald-500/20 to-emerald-400/10":"bg-gradient-to-r from-red-500/20 to-red-400/10"}\n                `})})]},a);var s,r}))}),!o&&t.jsx("div",{className:"mt-4 pt-3 border-t border-border/30",children:t.jsxs("div",{className:"flex items-center justify-center space-x-6 text-xs",children:[t.jsxs("div",{className:"flex items-center space-x-1.5 text-emerald-400/80",children:[t.jsx(Fe,{className:"w-3 h-3"}),t.jsx("span",{className:"font-medium",children:"Aprimoramento"})]}),t.jsxs("div",{className:"flex items-center space-x-1.5 text-red-400/80",children:[t.jsx(ht,{className:"w-3 h-3"}),t.jsx("span",{className:"font-medium",children:"Redução"})]}),t.jsxs("div",{className:"flex items-center space-x-1.5 text-muted-foreground/60",children:[t.jsx(_t,{className:"w-3 h-3"}),t.jsx("span",{className:"font-medium",children:"Inalterado"})]})]})})]})},Yx=[{value:"all",label:"Todos",icon:wt,color:"text-slate-400"},{value:"weapon",label:"Armas",icon:qe,color:"text-red-400"},{value:"helmet",label:"Capacete",icon:Je,color:"text-yellow-400"},{value:"chest",label:"Peitoral",icon:Ct,color:"text-green-400"},{value:"legs",label:"Perneiras",icon:De,color:"text-cyan-400"},{value:"boots",label:"Botas",icon:St,color:"text-orange-400"},{value:"armor",label:"Escudos",icon:De,color:"text-blue-400"},{value:"ring",label:"Anéis",icon:gt,color:"text-purple-400"},{value:"necklace",label:"Colar",icon:gt,color:"text-pink-400"},{value:"amulet",label:"Amuleto",icon:gt,color:"text-indigo-400"}],Kx=[{value:"name",label:"Nome",icon:Et,color:"text-slate-400"},{value:"level",label:"Nível",icon:kt,color:"text-blue-400"},{value:"rarity",label:"Raridade",icon:ft,color:"text-amber-400"},{value:"attack",label:"Ataque",icon:qe,color:"text-red-400"},{value:"defense",label:"Defesa",icon:De,color:"text-blue-400"}],Jx=({filterType:e,onFilterChange:a,sortType:s,onSortChange:r,compact:n=!1})=>t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{className:"space-y-2",children:[t.jsx("label",{className:"text-xs font-medium text-slate-400",children:"Tipo"}),t.jsx("div",{className:"grid gap-2 "+(n?"grid-cols-5 sm:grid-cols-10":"grid-cols-3 sm:grid-cols-5 lg:grid-cols-10"),children:Yx.map((s=>{const r=s.icon,i=e===s.value;return t.jsxs(Wa,{variant:"ghost",size:n?"sm":"default",onClick:()=>a(s.value),className:`${i?`bg-slate-800/80 ${s.color} border border-slate-700`:`text-slate-500 hover:${s.color} hover:bg-slate-800/50`} ${n?"px-2 py-1.5":"px-3 py-2"} transition-all duration-200 flex items-center justify-center gap-1.5`,title:s.label,children:[t.jsx(r,{className:n?"h-3 w-3":"h-4 w-4"}),!n&&t.jsx("span",{className:"text-xs hidden sm:inline",children:s.label})]},s.value)}))})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsx("label",{className:"text-xs font-medium text-slate-400",children:"Ordenar por"}),t.jsx("div",{className:"grid gap-2 "+(n?"grid-cols-5":"grid-cols-2 sm:grid-cols-5"),children:Kx.map((e=>{const a=e.icon,i=s===e.value;return t.jsxs(Wa,{variant:"ghost",size:n?"sm":"default",onClick:()=>r(e.value),className:`${i?`bg-slate-800/80 ${e.color} border border-slate-700`:`text-slate-500 hover:${e.color} hover:bg-slate-800/50`} ${n?"px-2 py-1.5":"px-3 py-2"} transition-all duration-200 flex items-center justify-center gap-1.5`,title:e.label,children:[t.jsx(a,{className:n?"h-3 w-3":"h-4 w-4"}),t.jsx("span",{className:"text-xs "+(n?"hidden lg:inline":"hidden sm:inline"),children:e.label})]},e.value)}))})]})]}),Qx=({character:a,availableEquipment:s,availableConsumables:r,onEquipmentPurchase:n,onConsumablePurchase:i,onOpenInventory:o})=>{const[l,c]=e.useState("equipment"),[d,m]=e.useState(null),[u,h]=e.useState("all"),[p,x]=e.useState("name"),[f,g]=e.useState("all"),b=s.filter((e=>"all"===u||e.type===u)).sort(((e,t)=>{switch(p){case"name":return e.name.localeCompare(t.name);case"level":return(t.level_requirement||0)-(e.level_requirement||0);case"rarity":{const a={common:1,uncommon:2,rare:3,epic:4,legendary:5};return(a[t.rarity]||0)-(a[e.rarity]||0)}case"attack":return t.atk_bonus-e.atk_bonus;case"defense":return t.def_bonus-e.def_bonus;default:return 0}})),v=r.filter((e=>"all"===f||e.type===f)),y=e=>{const t={common:"bg-slate-800/80 text-slate-300 border-slate-600",uncommon:"bg-emerald-900/80 text-emerald-300 border-emerald-600",rare:"bg-blue-900/80 text-blue-300 border-blue-600",epic:"bg-purple-900/80 text-purple-300 border-purple-600",legendary:"bg-amber-900/80 text-amber-300 border-amber-600"};return t[e]||t.common},j=e=>{switch(e){case"weapon":return t.jsx(qe,{className:"h-4 w-4 text-red-400"});case"armor":return t.jsx(De,{className:"h-4 w-4 text-blue-400"});case"chest":return t.jsx(Ct,{className:"h-4 w-4 text-green-400"});case"helmet":return t.jsx(Je,{className:"h-4 w-4 text-yellow-400"});case"legs":return t.jsx(De,{className:"h-4 w-4 text-cyan-400"});case"boots":return t.jsx(St,{className:"h-4 w-4 text-orange-400"});case"ring":return t.jsx(gt,{className:"h-4 w-4 text-purple-400"});case"necklace":return t.jsx(gt,{className:"h-4 w-4 text-pink-400"});case"amulet":return t.jsx(gt,{className:"h-4 w-4 text-indigo-400"});default:return t.jsx(At,{className:"h-4 w-4 text-slate-400"})}},N=e=>{switch(e){case"potion":return t.jsx(pt,{className:"h-4 w-4 text-blue-500"});case"antidote":return t.jsx(De,{className:"h-4 w-4 text-green-500"});case"buff":return t.jsx(Le,{className:"h-4 w-4 text-purple-500"});default:return t.jsx(At,{className:"h-4 w-4"})}};return t.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-4 h-full",children:[t.jsxs("div",{className:"lg:col-span-1 space-y-4",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center gap-2 bg-amber-900/20 border border-amber-700/30 px-3 py-1.5 rounded-lg",children:[t.jsx(Ve,{className:"h-4 w-4 text-amber-400"}),t.jsx("span",{className:"font-medium text-amber-300",children:a.gold})]}),t.jsxs(Wa,{variant:"outline",size:"sm",onClick:o,className:"border-slate-700 bg-slate-800/30 hover:bg-slate-700/50",children:[t.jsx(At,{className:"h-4 w-4 mr-2"}),"Inventário"]})]}),t.jsxs("div",{className:"flex gap-2 p-1 bg-slate-800/30 rounded-lg border border-slate-700/30",children:[t.jsx(Wa,{variant:"equipment"===l?"default":"ghost",size:"sm",onClick:()=>{c("equipment"),m(null)},className:"flex-1 "+("equipment"===l?"bg-slate-700/50 text-slate-100":"text-slate-400 hover:text-slate-200 hover:bg-slate-700/30"),children:t.jsx(Pt,{className:"h-4 w-4"})}),t.jsx(Wa,{variant:"consumables"===l?"default":"ghost",size:"sm",onClick:()=>{c("consumables"),m(null)},className:"flex-1 "+("consumables"===l?"bg-slate-700/50 text-slate-100":"text-slate-400 hover:text-slate-200 hover:bg-slate-700/30"),children:t.jsx(jt,{className:"h-4 w-4"})})]}),"equipment"===l&&t.jsx("div",{className:"bg-slate-800/30 p-3 rounded-lg border border-slate-700/30",children:t.jsx(Jx,{filterType:u,onFilterChange:h,sortType:p,onSortChange:x,compact:!0})}),"consumables"===l&&t.jsxs("div",{className:"flex gap-1 p-1 bg-slate-800/30 rounded-lg border border-slate-700/30",children:[t.jsx(Wa,{variant:"ghost",size:"sm",onClick:()=>g("all"),className:""+("all"===f?"bg-slate-700/50 text-slate-200":"text-slate-500 hover:text-slate-300 hover:bg-slate-700/30"),children:t.jsx(wt,{className:"h-3 w-3"})}),t.jsx(Wa,{variant:"ghost",size:"sm",onClick:()=>g("potion"),className:""+("potion"===f?"bg-blue-900/30 text-blue-400 border border-blue-800/50":"text-slate-500 hover:text-blue-400 hover:bg-blue-900/20"),children:t.jsx(pt,{className:"h-3 w-3"})}),t.jsx(Wa,{variant:"ghost",size:"sm",onClick:()=>g("antidote"),className:""+("antidote"===f?"bg-emerald-900/30 text-emerald-400 border border-emerald-800/50":"text-slate-500 hover:text-emerald-400 hover:bg-emerald-900/20"),children:t.jsx(De,{className:"h-3 w-3"})}),t.jsx(Wa,{variant:"ghost",size:"sm",onClick:()=>g("buff"),className:""+("buff"===f?"bg-purple-900/30 text-purple-400 border border-purple-800/50":"text-slate-500 hover:text-purple-400 hover:bg-purple-900/20"),children:t.jsx(Le,{className:"h-3 w-3"})})]}),t.jsx("div",{className:"max-h-[60vh] overflow-y-auto",children:"equipment"===l?0===b.length?t.jsxs("div",{className:"text-center py-8 text-slate-500",children:[t.jsx(At,{className:"h-8 w-8 mx-auto mb-2 opacity-50"}),t.jsx("p",{className:"text-sm",children:"Nenhum equipamento encontrado"})]}):t.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-2 gap-2",children:b.map((e=>{const s=a.gold>=e.price,r=a.level>=e.level_requirement,n=s&&r&&e.is_unlocked,i=d?.id===e.id;return t.jsx(pu,{className:`cursor-pointer transition-all duration-200 hover:shadow-lg hover:shadow-primary/20 border-slate-700/50 bg-slate-800/50 backdrop-blur-sm ${i?"ring-2 ring-primary/60 shadow-lg shadow-primary/30":""} ${n?"hover:bg-slate-800/70":"opacity-60 grayscale"}`,onClick:()=>m(e),children:t.jsx(bu,{className:"p-1.5",children:t.jsxs("div",{className:"flex flex-col items-center text-center gap-1",children:[t.jsx("div",{className:"p-1.5 rounded bg-slate-700/50",children:j(e.type)}),t.jsxs("div",{className:"w-full",children:[t.jsx("h3",{className:"font-medium text-xs truncate text-slate-100",title:e.name,children:e.name.length>10?`${e.name.substring(0,10)}...`:e.name}),t.jsx(Nu,{variant:"outline",className:`text-xs border ${y(e.rarity)} mt-1`,children:e.rarity}),t.jsxs("div",{className:"flex items-center justify-center gap-1 mt-1",children:[t.jsx(Ve,{className:"h-3 w-3 text-amber-400"}),t.jsx("span",{className:"text-xs font-medium text-amber-300",children:e.price})]}),e.atk_bonus>0?t.jsxs("div",{className:"text-xs text-red-400 mt-1",children:["+",e.atk_bonus," ATK"]}):e.def_bonus>0?t.jsxs("div",{className:"text-xs text-blue-400 mt-1",children:["+",e.def_bonus," DEF"]}):e.mana_bonus>0?t.jsxs("div",{className:"text-xs text-purple-400 mt-1",children:["+",e.mana_bonus," MP"]}):e.speed_bonus>0?t.jsxs("div",{className:"text-xs text-green-400 mt-1",children:["+",e.speed_bonus," SPD"]}):null]})]})})},e.id)}))}):0===v.length?t.jsxs("div",{className:"text-center py-8 text-slate-500",children:[t.jsx(jt,{className:"h-8 w-8 mx-auto mb-2 opacity-50"}),t.jsx("p",{className:"text-sm",children:"Nenhum consumível encontrado"})]}):t.jsx("div",{className:"space-y-2",children:v.map((e=>{const s=a.gold>=e.price,r=a.level>=(e.level_requirement||1),n=s&&r,i=d?.id===e.id;return t.jsx(pu,{className:`cursor-pointer transition-all duration-200 hover:shadow-lg hover:shadow-primary/20 border-slate-700/50 bg-slate-800/50 backdrop-blur-sm ${i?"ring-2 ring-primary/60 shadow-lg shadow-primary/30":""} ${n?"hover:bg-slate-800/70":"opacity-60 grayscale"}`,onClick:()=>m(e),children:t.jsx(bu,{className:"p-3",children:t.jsxs("div",{className:"flex items-start gap-3",children:[t.jsx("div",{className:"flex-shrink-0 p-2 rounded-lg bg-slate-700/50",children:N(e.type)}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsx("h3",{className:"font-medium text-sm truncate text-slate-100",children:e.name}),t.jsx("p",{className:"text-xs text-slate-400 mt-1",children:"potion"===e.type?`+${e.effect_value}`:"antidote"===e.type?"Remove debuffs":`+${e.effect_value} por 3 turnos`}),t.jsxs("div",{className:"flex items-center gap-1 mt-2",children:[t.jsx(Ve,{className:"h-3 w-3 text-amber-400"}),t.jsx("span",{className:"text-xs font-medium text-amber-300",children:e.price})]})]})]})})},e.id)}))})})]}),t.jsx("div",{className:"lg:col-span-2",children:t.jsx(pu,{className:"h-full border-slate-700/50 bg-slate-800/30",children:t.jsx(bu,{className:"p-4 h-full",children:(()=>{if(!d)return t.jsx("div",{className:"flex items-center justify-center h-full text-slate-500",children:t.jsxs("div",{className:"text-center",children:[t.jsx(At,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),t.jsx("p",{className:"text-lg",children:"Selecione um item para ver os detalhes"}),t.jsx("p",{className:"text-sm mt-2 opacity-75",children:"Clique em qualquer item da lista para visualizar suas informações completas"})]})});const e=d;if("atk_bonus"in d){const s=e,r=a.gold>=s.price,i=a.level>=s.level_requirement,o=r&&i&&s.is_unlocked;return t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{children:[t.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[t.jsx("div",{className:"p-3 rounded-lg bg-slate-700/50 border border-slate-600/50",children:j(s.type)}),t.jsx("h2",{className:"text-xl font-bold text-slate-100",children:s.name})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(Nu,{className:`border ${y(s.rarity)}`,children:s.rarity}),t.jsx("span",{className:"text-sm text-slate-400",children:"weapon"===s.type?"Arma":"armor"===s.type?"Armadura":"Acessório"})]})]}),t.jsx(Xx,{}),t.jsxs("div",{children:[t.jsx("h3",{className:"font-semibold mb-2 text-slate-200",children:"Descrição"}),t.jsx("p",{className:"text-sm text-slate-400 leading-relaxed",children:s.description})]}),t.jsxs("div",{children:[t.jsx("h3",{className:"font-semibold mb-3 text-slate-200",children:"Atributos"}),t.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[s.atk_bonus>0&&t.jsxs("div",{className:"flex items-center gap-2 p-3 bg-red-900/30 border border-red-800/50 rounded-lg backdrop-blur-sm",children:[t.jsx(qe,{className:"h-4 w-4 text-red-400"}),t.jsxs("span",{className:"text-sm text-red-300 font-medium",children:["+",s.atk_bonus]})]}),s.def_bonus>0&&t.jsxs("div",{className:"flex items-center gap-2 p-3 bg-blue-900/30 border border-blue-800/50 rounded-lg backdrop-blur-sm",children:[t.jsx(De,{className:"h-4 w-4 text-blue-400"}),t.jsxs("span",{className:"text-sm text-blue-300 font-medium",children:["+",s.def_bonus]})]}),s.mana_bonus>0&&t.jsxs("div",{className:"flex items-center gap-2 p-3 bg-purple-900/30 border border-purple-800/50 rounded-lg backdrop-blur-sm",children:[t.jsx(gt,{className:"h-4 w-4 text-purple-400"}),t.jsxs("span",{className:"text-sm text-purple-300 font-medium",children:["+",s.mana_bonus]})]}),s.speed_bonus>0&&t.jsxs("div",{className:"flex items-center gap-2 p-3 bg-amber-900/30 border border-amber-800/50 rounded-lg backdrop-blur-sm",children:[t.jsx(Le,{className:"h-4 w-4 text-amber-400"}),t.jsxs("span",{className:"text-sm text-amber-300 font-medium",children:["+",s.speed_bonus]})]})]})]}),t.jsxs("div",{children:[t.jsx("h3",{className:"font-semibold mb-2 text-slate-200",children:"Comparação com Equipamento Atual"}),t.jsx(Wx,{characterId:a.id,newEquipment:s,slotType:s.type,showTitle:!1,compact:!0})]}),t.jsxs("div",{children:[t.jsx("h3",{className:"font-semibold mb-2 text-slate-200",children:"Requisitos"}),t.jsxs("div",{className:"space-y-2",children:[t.jsxs("div",{className:"flex justify-between items-center p-2 bg-slate-700/30 rounded border border-slate-600/30",children:[t.jsx("span",{className:"text-sm text-slate-300",children:"Nível:"}),t.jsx("span",{className:"text-sm font-medium "+(i?"text-emerald-400":"text-red-400"),children:s.level_requirement})]}),t.jsxs("div",{className:"flex justify-between items-center p-2 bg-slate-700/30 rounded border border-slate-600/30",children:[t.jsx("span",{className:"text-sm text-slate-300",children:"Preço:"}),t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(Ve,{className:"h-3 w-3 text-amber-400"}),t.jsx("span",{className:"text-sm font-medium "+(r?"text-emerald-400":"text-red-400"),children:s.price})]})]})]})]}),t.jsx(Wa,{onClick:()=>n(s),disabled:!o,className:"w-full font-semibold "+(o?"bg-gradient-to-r from-primary to-primary/80 hover:from-primary/90 hover:to-primary/70 shadow-lg shadow-primary/25":"bg-slate-700/50 text-slate-400 cursor-not-allowed"),children:s.is_unlocked?i?r?"Comprar":"Gold Insuficiente":`Requer Nível ${s.level_requirement}`:"Item Bloqueado"})]})}{const s=e,r=a.gold>=s.price,n=a.level>=(s.level_requirement||1),o=r&&n;return t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{children:[t.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[t.jsx("div",{className:"p-3 rounded-lg bg-slate-700/50 border border-slate-600/50",children:N(s.type)}),t.jsx("h2",{className:"text-xl font-bold text-slate-100",children:s.name})]}),t.jsx("span",{className:"text-sm text-slate-400",children:"potion"===s.type?"Poção":"antidote"===s.type?"Antídoto":"Fortalecimento"})]}),t.jsx(Xx,{}),t.jsxs("div",{children:[t.jsx("h3",{className:"font-semibold mb-2 text-slate-200",children:"Descrição"}),t.jsx("p",{className:"text-sm text-slate-400 leading-relaxed",children:s.description})]}),t.jsxs("div",{children:[t.jsx("h3",{className:"font-semibold mb-2 text-slate-200",children:"Efeito"}),t.jsx("div",{className:"p-3 bg-emerald-900/30 border border-emerald-800/50 rounded-lg backdrop-blur-sm",children:t.jsx("span",{className:"text-sm text-emerald-300",children:"potion"===s.type?`Restaura ${s.effect_value} pontos`:"antidote"===s.type?"Remove todos os efeitos negativos":`Aumenta atributo em ${s.effect_value} por 3 turnos`})})]}),t.jsxs("div",{children:[t.jsx("h3",{className:"font-semibold mb-2 text-slate-200",children:"Preço"}),t.jsxs("div",{className:"flex items-center gap-2 p-3 bg-slate-700/30 rounded-lg border border-slate-600/30",children:[t.jsx(Ve,{className:"h-4 w-4 text-amber-400"}),t.jsxs("span",{className:"font-medium "+(r?"text-emerald-400":"text-red-400"),children:[s.price," gold cada"]})]})]}),t.jsxs("div",{className:"space-y-3",children:[t.jsx("h3",{className:"font-semibold text-slate-200",children:"Comprar"}),t.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[t.jsx(Wa,{onClick:()=>i(s,1),disabled:!o,size:"sm",className:""+(o?"bg-gradient-to-r from-primary to-primary/80 hover:from-primary/90 hover:to-primary/70 shadow-md shadow-primary/20":"bg-slate-700/50 text-slate-400 cursor-not-allowed"),children:"1x"}),t.jsx(Wa,{onClick:()=>i(s,5),disabled:!o||a.gold<5*s.price,size:"sm",variant:"outline",className:"border-slate-600 "+(!o||a.gold<5*s.price?"bg-slate-700/50 text-slate-400 cursor-not-allowed border-slate-700":"bg-slate-800/50 text-slate-300 hover:bg-slate-700/50 hover:text-slate-100"),children:"5x"}),t.jsx(Wa,{onClick:()=>i(s,10),disabled:!o||a.gold<10*s.price,size:"sm",variant:"outline",className:"border-slate-600 "+(!o||a.gold<10*s.price?"bg-slate-700/50 text-slate-400 cursor-not-allowed border-slate-700":"bg-slate-800/50 text-slate-300 hover:bg-slate-700/50 hover:text-slate-100"),children:"10x"})]})]})]})}})()})})})]})},Zx=({isOpen:a,onClose:s,onConfirm:r,itemName:n,itemIcon:i,itemRarity:o,availableQuantity:l,unitSellPrice:c,originalPrice:d,isLoading:m=!1})=>{const[u,h]=e.useState(1),[p,x]=e.useState(!1);e.useEffect((()=>{a&&h(1)}),[a]);const f=u*c,g=d?Math.round(100*(1-c/d)):0,b=e=>{const t=Math.max(1,Math.min(e,l));h(t)};return a?t.jsx(_h,{open:a,onOpenChange:s,children:t.jsxs(Sh,{className:"max-w-md bg-slate-900/95 border-slate-700/50",children:[t.jsx(Eh,{children:t.jsxs(Ah,{className:"flex items-center gap-2 text-slate-100",children:[t.jsx(At,{className:"h-5 w-5 text-amber-400"}),"Vender Item"]})}),t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"flex items-center gap-4 p-4 rounded-lg border border-slate-700/50 bg-slate-800/30",children:[t.jsx("div",{className:"flex-shrink-0",children:i||t.jsx(At,{className:"h-8 w-8 text-slate-400"})}),t.jsxs("div",{className:"flex-1",children:[t.jsx("h3",{className:"font-semibold text-slate-100",children:n}),t.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[o&&t.jsx(Nu,{className:`text-xs ${(e=>{const t={common:"border-slate-600 bg-slate-800/30 text-slate-300",uncommon:"border-emerald-600 bg-emerald-900/30 text-emerald-300",rare:"border-blue-600 bg-blue-900/30 text-blue-300",epic:"border-purple-600 bg-purple-900/30 text-purple-300",legendary:"border-amber-600 bg-amber-900/30 text-amber-300"};return t[e]||t.common})(o)}`,children:o}),t.jsxs("span",{className:"text-xs text-slate-400",children:["Disponível: ",l]})]})]})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsx(Ls,{htmlFor:"quantity",className:"text-sm font-medium text-slate-300",children:"Quantidade"}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(Wa,{variant:"outline",size:"sm",onClick:()=>b(u-1),disabled:u<=1||m,className:"h-8 w-8 p-0 border-slate-600",children:t.jsx(_t,{className:"h-3 w-3"})}),t.jsx(Ms,{id:"quantity",type:"number",min:1,max:l,value:u,onChange:e=>b(parseInt(e.target.value)||1),disabled:m,className:"text-center bg-slate-800/50 border-slate-600 text-slate-100"}),t.jsx(Wa,{variant:"outline",size:"sm",onClick:()=>b(u+1),disabled:u>=l||m,className:"h-8 w-8 p-0 border-slate-600",children:t.jsx(Ke,{className:"h-3 w-3"})}),t.jsx(Wa,{variant:"outline",size:"sm",onClick:()=>h(l),disabled:u===l||m,className:"text-xs px-2 border-slate-600",children:"Máx"})]})]}),t.jsxs("div",{className:"space-y-3 p-4 rounded-lg border border-slate-700/50 bg-slate-800/20",children:[t.jsxs("div",{className:"flex items-center justify-between text-sm",children:[t.jsx("span",{className:"text-slate-400",children:"Preço unitário:"}),t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(Ve,{className:"h-3 w-3 text-amber-400"}),t.jsx("span",{className:"text-amber-300 font-medium",children:c})]})]}),d&&g>0&&t.jsxs("div",{className:"flex items-center justify-between text-sm",children:[t.jsx("span",{className:"text-slate-400",children:"Preço original:"}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("span",{className:"text-slate-500 line-through",children:d}),t.jsxs(Nu,{variant:"outline",className:"text-xs text-red-400 border-red-400/30",children:["-",g,"%"]})]})]}),t.jsx("div",{className:"border-t border-slate-700/50 pt-3",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("span",{className:"font-medium text-slate-200",children:"Total:"}),t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(Ve,{className:"h-4 w-4 text-amber-400"}),t.jsx("span",{className:"text-lg font-bold text-amber-300",children:f})]})]})})]}),g>=70&&t.jsxs("div",{className:"flex items-start gap-2 p-3 rounded-lg bg-amber-900/20 border border-amber-600/30",children:[t.jsx(Mt,{className:"h-4 w-4 text-amber-400 mt-0.5 flex-shrink-0"}),t.jsxs("div",{className:"text-xs text-amber-300",children:[t.jsx("p",{className:"font-medium",children:"Preço baixo de venda"}),t.jsxs("p",{className:"text-amber-400/80",children:["Você receberá apenas ",100-g,"% do valor original."]})]})]}),t.jsxs("div",{className:"flex gap-3",children:[t.jsx(Wa,{variant:"outline",onClick:s,disabled:p||m,className:"flex-1 border-slate-600 text-slate-300 hover:bg-slate-700/50",children:"Cancelar"}),t.jsx(Wa,{onClick:async()=>{if(u<=0||u>l)_.error("Quantidade inválida");else{x(!0);try{await r(u),s()}catch(e){}finally{x(!1)}}},disabled:p||m||u<=0,className:"flex-1 bg-amber-600 hover:bg-amber-700 text-white",children:p?t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-t border-b border-current"}),"Vendendo..."]}):`Vender por ${f} gold`})]})]})]})}):null},ef={sm:"h-4 w-4",md:"h-6 w-6",lg:"h-8 w-8",xl:"h-12 w-12"};function tf({consumable:a,size:s="md",className:r="",showFallback:n=!0}){const[i,o]=e.useState(!1),[l,c]=e.useState(!0),d=(e=>{const t=e.name.toLowerCase().trim();return t.includes("vida")||t.includes("hp")||t.includes("health")?"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAAAAXNSR0IArs4c6QAAA2tJREFUeJztms9rE1EQx7+zkeSg/ZF4EFsisSS997SHtrRQyF9QEHqqCILXglQQRcSLCAUPPSgU2ktB6F/QU4t6yMmj0EgNhPbY2FQPe8g+D9vZvCTb2oM7E+N+YGH37bLvzbyZefN2B0hISEhISEj4XyGtjo0xpruNiMTHc026QyAQPpPJRLZLK0FcASz8kjuF8nQZu593w3uZTEZFCWIYY0w6nTbbT56Z4u1bPcfyrGvS6bSJco+4ENM0z/zmyiqeb70HAMwUC+H9T99qYdt25Qs8zxOJCU7cHXTDJs/C24LbCpFCJQjOFAsdgmsi4gJs/uO5LABgrlS49HlJF1CxgI/V7wAAFo9Dnq+QlojGgLlSAQ7aAb5lCMa0BXdg4MAgnxsNl8S4xyTqAgCw5E5hv1oD0OkKbBVM/eSHiBuIuYDneQCCZGfJnQIA7B0cAgCIHMyV7gIA9qs1pAQ9Ifau7Nn3PA8cDI3x24MgB8b4IHLgwMAH4eikIWIBYjFgPJftEJ6o3XX3tSSiq0A+N4rZc7/fr9bUhLZRyQPIIRj/4gDP5g/Ev0UWmQIiIs/zcHTS+OOztu8P1F7AVsKr+49ADoUHECyJL5cfSg2nPS6pjtgNNlZWcbC23nO/7pYAAAvTZTxYez24u8FU6uK4m69UBUcSILIKhN8CHj/F1zdvI5/JV6qBFaytY2NlVezrkMo6tDg03NPGLiCNuAKihNdEPxM5R8P/gT5QgG0RGkpQU8Di0HCPO2i4h8oXISblBzvCe9dvBA2+f8nT8aDuAlFcliv8bdQUkFKY7Sj60gIkEVfAzlmzb2YfULKAltM/hqcykp2zJj78+qnRdQ8qCuC8vx+UoKKAcOeHQAl8aKBmAbYSNFGNRlobIBuVVJgFD1NgBCtDS2EsqpshRnNZVLEAFr4f8gG1POAqbRKIK4Ajvy0wn++cNcVXBtFfY3duZjFTLFwY/etuCQvTZbzYfDd49QEAwAUfnAfY1N3Seb1AUEU2lh0R+TQuVh8wlh0J/wZzZYidDO0dHGJ+ciIsmjhunA5GfQD/EzxunAIIagFYyCjh5ycnAHRaQKzji/PlQKcFXJUUkViViLgFAOg4774+bpyiZYxYiYwYXCjNxdB83n3N51IF06LaZaGIiGwB7euBmfGEhISEhH+A382gtA6Q1PYKAAAAAElFTkSuQmCC":t.includes("mana")||t.includes("mp")?"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAAAAXNSR0IArs4c6QAAAoVJREFUeJztmj9r20AYxp+3EhmCIVBK6ZS5m7wEigul9lDI0jX5CMUe2obgrVPAS4u3QD5Ah7ZjVg/yEi0e2myZC4YEQsCQChokrkN7qmwsxSm9xyJ5f8v5z8l3z3PvvTrfCVAURVEURVGUO4kso1FjjCn6TkSoffKZjVnhnueV1mGaQDPAGGOs8EGvVVjP8zyqCfcYjVjxg14rE797mMwtB70WRKR0mvxPKC5bA4Inz/DhZXnQ7R4m+BoNYYyh5ANqDgD+jnRVcD4F7Og/+vx94Wsetr/QpgElBwBAJ6jh7O1HjOvtwjrjehvjeht+s8HqFjcHLBoFp1vrSNOUkgMoESAikqYpTrfWS+slYUQVDywhCSZhBL/ZQBJG7KbnQl0HAEC3uwkA8JuNwrluF0OMvjmPACv+watP6HY30R9NpjuQMyEJI+ydXADgrQidRsCseADY2VibW3aCGl6/eZFdu3dyQYkEZ+7OEw8A/dEEOxtrU2UnqBX+zrvH950mRec54Drxy4a2ECoS3wlq2D++BADsH19OvWZAMaBM/PtvP7LSfsY0wbkBP6/SrMyLj41kom0ZG8lEs9YJzg3Ij2J/NEFsBLEpzmdl37mAMgXsaLLFLQItCVaVyhrA+ktcSQOYU4VmwE1vabfmLmApW+4uE4oBfrNBW9ndlErmACaVNeDW3AWSMPqnrB4boSTCykYACzWA0cjK8AixEazK9btbts7K8Mhtp/5Ai4C8CbNG2PerYhAbAUs84PhkKL8vaLl6/rQwEmbFnx9sOz8kcb7ozp8J5I0o4/xgGwAoJ0S0s0Gg/NGYPGn6exeJcTxG3aFYdI+f/aCUoiiKoiiKoiiKotwxfgG1P0Ut6qsoewAAAABJRU5ErkJggg==":function(e){return Fx.getConsumableIcon(e)}(e)})(a),m=function(e){switch(e.type){case"potion":return e.description.includes("HP")||e.description.includes("Vida")?"❤️":e.description.includes("Mana")?"💙":"🧪";case"buff":case"elixir":return e.description.includes("Força")||e.description.includes("ataque")?"⚔️":e.description.includes("Defesa")?"🛡️":"✨";case"antidote":return"🌿";default:return"📦"}}(a),u=`${ef[s]} ${r}`;return i&&n?t.jsx("div",{className:`${u} flex items-center justify-center text-slate-500`,title:`${a.name} (fallback)`,children:t.jsx("span",{className:"text-sm",children:m})}):t.jsxs("div",{className:`${u} relative`,children:[l&&t.jsx("div",{className:"absolute inset-0 bg-slate-700/50 animate-pulse rounded"}),t.jsx("img",{src:d,alt:a.name,className:`${u} object-contain ${l?"opacity-0":"opacity-100"} transition-opacity duration-200`,onLoad:()=>{c(!1),o(!1)},onError:()=>{c(!1),o(!0)},loading:"lazy"})]})}const af=({character:a,isOpen:s,onClose:r,onItemSold:n})=>{const[i,o]=e.useState([]),[l,c]=e.useState([]),[d,m]=e.useState([]),[u,h]=e.useState(!1),[p,x]=e.useState(null),[f,g]=e.useState({isOpen:!1,type:null,item:null,sellPrice:null});e.useEffect((()=>{s&&a.id&&b()}),[s,a.id]);const b=async()=>{h(!0);try{const[e,t,s]=await Promise.all([gh.getCharacterEquipment(a.id),Bx.getCharacterConsumables(a.id),Bx.getCharacterDrops(a.id)]);o(e||[]),c(t.success&&t.data||[]),m(s.success&&s.data||[])}catch(e){_.error("Erro ao carregar inventário")}finally{h(!1)}},v=async(e,t)=>{if(e.equipment){try{if("toggle"===t){(await gh.toggleEquipment(a.id,e.equipment.id,!e.is_equipped)).success&&(_.success(e.is_equipped?"Item desequipado!":"Item equipado!"),b())}else if("sell"===t){const t=await gh.sellEquipment(a.id,e.equipment.id);t.success&&void 0!==t.data?.newGold?(_.success(`${e.equipment.name} vendido!`),n(t.data.newGold),b()):_.error(t.error||"Erro ao vender equipamento")}}catch(s){_.error("Erro ao executar ação")}x(null)}},y=e=>{const t={common:"text-slate-400",uncommon:"text-emerald-400",rare:"text-blue-400",epic:"text-purple-400",legendary:"text-amber-400"};return t[e]||t.common},j=e=>Math.floor(e.price*{common:.3,uncommon:.35,rare:.4,epic:.45,legendary:.5}[e.rarity]),N=e=>{const a={equipment:{icon:t.jsx(At,{className:"h-12 w-12 mx-auto mb-3 opacity-40"}),title:"Nenhum equipamento",description:"Visite a loja ou derrote monstros para obter equipamentos"},consumables:{icon:t.jsx(pt,{className:"h-12 w-12 mx-auto mb-3 opacity-40"}),title:"Nenhum consumível",description:"Compre poções na loja para ajudar em suas aventuras"},drops:{icon:t.jsx(ft,{className:"h-12 w-12 mx-auto mb-3 opacity-40"}),title:"Nenhum material",description:"Derrote monstros para coletar materiais valiosos"}}[e];return t.jsxs("div",{className:"text-center py-12 text-slate-500",children:[a.icon,t.jsx("p",{className:"font-medium text-slate-400 mb-1",children:a.title}),t.jsx("p",{className:"text-sm opacity-75",children:a.description})]})};return u?t.jsx(_h,{open:s,onOpenChange:r,children:t.jsxs(Sh,{className:"max-w-md",children:[t.jsx(Tt,{children:t.jsx(Ah,{children:"Carregando Inventário"})}),t.jsxs("div",{className:"flex items-center justify-center p-8",children:[t.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-t-2 border-b-2 border-primary"}),t.jsx("span",{className:"ml-2 text-slate-300",children:"Carregando..."})]})]})}):t.jsxs(t.Fragment,{children:[t.jsx(_h,{open:s,onOpenChange:r,children:t.jsxs(Sh,{className:"max-w-md max-h-[80vh] bg-slate-900/95 border-slate-700/50",onClick:e=>{e.target===e.currentTarget&&x(null)},children:[t.jsx(Eh,{className:"pb-2",children:t.jsxs(Ah,{className:"flex items-center justify-between text-slate-100",children:[t.jsx("span",{children:"Inventário"}),t.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[t.jsx(Ve,{className:"h-4 w-4 text-amber-400"}),t.jsx("span",{className:"text-amber-300",children:(a.gold||0).toLocaleString()})]})]})}),t.jsxs(Qh,{defaultValue:"equipment",className:"w-full",children:[t.jsxs(Zh,{className:"grid w-full grid-cols-3 bg-slate-800/50",children:[t.jsxs(ep,{value:"equipment",className:"text-xs",children:["Equipamentos (",i.length,")"]}),t.jsxs(ep,{value:"consumables",className:"text-xs",children:["Consumíveis (",l.filter((e=>e.quantity>0)).length,")"]}),t.jsxs(ep,{value:"drops",className:"text-xs",children:["Materiais (",d.filter((e=>e.quantity>0)).length,")"]})]}),t.jsx(tp,{value:"equipment",className:"mt-4",children:t.jsx("div",{className:"space-y-2 max-h-[50vh] overflow-y-auto",children:0===i.length?N("equipment"):i.map((e=>{if(!e.equipment)return null;const s=p===e.id;return t.jsxs("div",{className:"relative",children:[t.jsxs("div",{className:`flex items-center gap-3 p-3 rounded-lg border transition-all cursor-pointer ${e.is_equipped?"bg-primary/10 border-primary/30":"bg-slate-800/30 border-slate-700/30 hover:bg-slate-700/30"} ${s?"ring-2 ring-primary/50":""}`,onClick:()=>x(s?null:e.id),children:[t.jsx("div",{className:"flex-shrink-0",children:(r=e.equipment.type,"weapon"===r?t.jsx(qe,{className:"h-4 w-4"}):"armor"===r?t.jsx(De,{className:"h-4 w-4"}):"accessory"===r?t.jsx(gt,{className:"h-4 w-4"}):"potion"===r?t.jsx(Be,{className:"h-4 w-4"}):t.jsx(At,{className:"h-4 w-4"}))}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("span",{className:"text-sm font-medium text-slate-200 truncate",children:e.equipment.name}),e.is_equipped&&t.jsx("span",{className:"text-xs bg-primary/20 text-primary px-1.5 py-0.5 rounded",children:"Equipado"})]}),t.jsxs("div",{className:"flex items-center gap-2 text-xs text-slate-400",children:[t.jsx("span",{className:y(e.equipment.rarity),children:e.equipment.rarity}),e.equipment.atk_bonus>0&&t.jsxs("span",{className:"text-red-400",children:["+",e.equipment.atk_bonus," ATK"]}),e.equipment.def_bonus>0&&t.jsxs("span",{className:"text-blue-400",children:["+",e.equipment.def_bonus," DEF"]})]})]}),t.jsxs("div",{className:"text-xs text-amber-400",children:[t.jsx(Ve,{className:"h-3 w-3 inline mr-1"}),j(e.equipment)]})]}),s&&t.jsxs("div",{className:"absolute top-full left-0 right-0 z-10 mt-1 bg-slate-800 border border-slate-600 rounded-lg p-3 shadow-lg space-y-3",children:[!e.is_equipped&&t.jsxs("div",{children:[t.jsx("h4",{className:"text-xs font-semibold text-slate-200 mb-2",children:"Comparação se Equipado"}),t.jsx(Wx,{characterId:a.id,newEquipment:e.equipment,slotType:e.equipment.type,showTitle:!1,compact:!0})]}),t.jsxs("div",{className:"flex gap-2",children:[t.jsx(Wa,{size:"sm",variant:e.is_equipped?"secondary":"default",onClick:()=>v(e,"toggle"),className:"flex-1 text-xs",children:e.is_equipped?"Desequipar":"Equipar"}),!e.is_equipped&&t.jsxs(Wa,{size:"sm",variant:"destructive",onClick:()=>v(e,"sell"),className:"flex-1 text-xs",children:[t.jsx(qt,{className:"h-3 w-3 mr-1"}),"Vender"]})]})]})]},e.id);var r}))})}),t.jsx(tp,{value:"consumables",className:"mt-4",children:t.jsx("div",{className:"space-y-2 max-h-[50vh] overflow-y-auto",children:0===l.filter((e=>e.quantity>0)).length?N("consumables"):l.filter((e=>e.quantity>0)).map((e=>{if(!e.consumable)return null;const s=p===e.id,r=(e=>{if(!e.consumable)return!1;if("potion"===e.consumable.type){if(e.consumable.description.includes("HP")&&a.hp>=a.max_hp)return!1;if(e.consumable.description.includes("Mana")&&a.mana>=a.max_mana)return!1}return!0})(e);return t.jsxs("div",{className:"relative",children:[t.jsxs("div",{className:`flex items-center gap-3 p-3 rounded-lg border transition-all cursor-pointer ${r?"bg-slate-800/30 border-slate-700/30 hover:bg-slate-700/30":"bg-slate-800/20 border-slate-700/20 opacity-60"} ${s?"ring-2 ring-primary/50":""}`,onClick:()=>x(s?null:e.id),children:[t.jsx("div",{className:"flex-shrink-0",children:"potion"===e.consumable.type&&e.consumable.description.includes("HP")?t.jsx(Be,{className:"h-5 w-5 text-red-400"}):"potion"===e.consumable.type&&e.consumable.description.includes("Mana")?t.jsx(Le,{className:"h-5 w-5 text-blue-400"}):t.jsx(pt,{className:"h-5 w-5 text-purple-400"})}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("span",{className:"text-sm font-medium text-slate-200 truncate",children:e.consumable.name}),t.jsxs("span",{className:"text-xs bg-slate-700/50 text-slate-300 px-1.5 py-0.5 rounded",children:["x",e.quantity]})]}),t.jsx("div",{className:"text-xs text-slate-400",children:Vx(e.consumable)})]})]}),s&&t.jsx("div",{className:"absolute top-full left-0 right-0 z-10 mt-1 bg-slate-800 border border-slate-600 rounded-lg p-2 shadow-lg",children:t.jsxs("div",{className:"flex gap-2",children:[r&&t.jsx(Wa,{size:"sm",onClick:()=>(async e=>{if(e.consumable){try{const t=await Bx.consumeItem(a.id,e.consumable_id,a);t.success?(_.success("Item usado com sucesso!"),b(),n(a.gold||0)):_.error(t.error||"Erro ao usar item")}catch(t){_.error("Erro ao usar item")}x(null)}})(e),className:"flex-1 text-xs",children:"Usar Agora"}),t.jsxs(Wa,{size:"sm",variant:"outline",onClick:()=>(async e=>{if(e.consumable){try{const t=await Bx.calculateConsumableSellPrice(a.id,e.consumable_id,1);if(!t.success||!t.data?.canSell)return void _.error("Este item não pode ser vendido");g({isOpen:!0,type:"consumable",item:e,sellPrice:t.data})}catch(t){_.error("Erro ao calcular preço de venda")}x(null)}})(e),className:"flex-1 text-xs border-slate-600 text-slate-300",children:[t.jsx(qt,{className:"h-3 w-3 mr-1"}),"Vender"]})]})})]},e.id)}))})}),t.jsx(tp,{value:"drops",className:"mt-4",children:t.jsx("div",{className:"space-y-2 max-h-[50vh] overflow-y-auto",children:0===d.filter((e=>e.quantity>0)).length?N("drops"):d.filter((e=>e.quantity>0)).map((e=>{if(!e.drop)return null;const s=p===e.id;return t.jsxs("div",{className:"relative",children:[t.jsxs("div",{className:"flex items-center gap-3 p-3 rounded-lg border transition-all cursor-pointer bg-slate-800/30 border-slate-700/30 hover:bg-slate-700/30 "+(s?"ring-2 ring-primary/50":""),onClick:()=>x(s?null:e.id),children:[t.jsx("div",{className:"flex-shrink-0",children:t.jsx(ft,{className:"h-5 w-5 text-amber-400"})}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("span",{className:"text-sm font-medium text-slate-200 truncate",children:e.drop.name}),t.jsxs("span",{className:"text-xs bg-slate-700/50 text-slate-300 px-1.5 py-0.5 rounded",children:["x",e.quantity]})]}),t.jsxs("div",{className:"flex items-center gap-2 text-xs",children:[t.jsx("span",{className:y(e.drop.rarity),children:e.drop.rarity}),t.jsxs("span",{className:"text-amber-400",children:[e.drop.value," gold cada"]})]})]})]}),s&&t.jsx("div",{className:"absolute top-full left-0 right-0 z-10 mt-1 bg-slate-800 border border-slate-600 rounded-lg p-2 shadow-lg",children:t.jsxs(Wa,{size:"sm",variant:"outline",onClick:()=>(async e=>{if(e.drop){try{const t=await Bx.calculateDropSellPrice(a.id,e.drop_id,1);if(!t.success||!t.data?.canSell)return void _.error("Este material não pode ser vendido");g({isOpen:!0,type:"drop",item:e,sellPrice:t.data})}catch(t){_.error("Erro ao calcular preço de venda")}x(null)}})(e),className:"w-full text-xs border-slate-600 text-slate-300",children:[t.jsx(qt,{className:"h-3 w-3 mr-1"}),"Vender Material"]})})]},e.id)}))})})]})]})}),t.jsx(Zx,{isOpen:f.isOpen,onClose:()=>g({isOpen:!1,type:null,item:null,sellPrice:null}),onConfirm:async e=>{if(f.item&&f.type){try{if("consumable"===f.type){const t=f.item,s=await Bx.sellConsumablesBatch(a.id,[{consumable_id:t.consumable_id,quantity:e}]);s.success&&s.data?(_.success(`Vendido ${e}x ${t.consumable?.name} por ${s.data.totalGoldEarned} gold!`),n(s.data.newGold),b()):_.error(s.error||"Erro ao vender consumível")}else if("drop"===f.type){const t=f.item,s=await Bx.sellDropsBatch(a.id,[{drop_id:t.drop_id,quantity:e}]);s.success&&s.data?(_.success(`Vendido ${e}x ${t.drop?.name} por ${s.data.totalGoldEarned} gold!`),n(s.data.newGold),b()):_.error(s.error||"Erro ao vender material")}}catch(t){_.error("Erro ao vender item")}g({isOpen:!1,type:null,item:null,sellPrice:null})}},itemName:"consumable"===f.type?f.item?.consumable?.name||"":"drop"===f.type&&f.item?.drop?.name||"",itemIcon:"consumable"===f.type&&f.item&&f.item.consumable?t.jsx(tf,{consumable:f.item.consumable,size:"lg"}):t.jsx(ft,{className:"h-8 w-8 text-amber-400"}),itemRarity:"drop"===f.type?f.item?.drop?.rarity:void 0,availableQuantity:f.sellPrice?.availableQuantity||0,unitSellPrice:f.sellPrice?.unitSellPrice||0,originalPrice:f.sellPrice?.originalPrice})]})},sf=({character:a,onPurchase:s})=>{const[r,n]=e.useState([]),[i,o]=e.useState([]),[l,c]=e.useState(!0),[d,m]=e.useState(!1);e.useEffect((()=>{u()}),[a.level]);const u=async(e=!1)=>{try{let t=0;e?t=window.scrollY||document.documentElement.scrollTop:c(!0);const s=await gh.getAvailableEquipment(a.level);n(s);const r=await Bx.getAvailableConsumables();if(r.success&&r.data){const e=r.data.filter((e=>e.price>0&&!e.name.includes("Elixir")));o(e)}e&&requestAnimationFrame((()=>{window.scrollTo(0,t)}))}catch(t){_.error("Erro ao carregar itens da loja")}finally{e||c(!1)}};return l?t.jsxs("div",{className:"flex items-center justify-center p-8",children:[t.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-t-2 border-b-2 border-primary mr-4"}),t.jsx("span",{children:"Carregando loja..."})]}):t.jsxs(t.Fragment,{children:[t.jsx(Qx,{character:a,availableEquipment:r,availableConsumables:i,onEquipmentPurchase:async e=>{if(a.gold<e.price)_.error("Gold insuficiente para comprar este item!");else try{const t=await gh.buyEquipment(a.id,e.id);t.success&&void 0!==t.data?.newGold?(_.success(`${e.name} comprado com sucesso!`),s(t.data.newGold)):_.error(t.error||"Erro ao comprar equipamento!")}catch(t){_.error("Erro ao comprar equipamento!")}},onConsumablePurchase:async(e,t=1)=>{const r=e.price*t;if(a.gold<r)_.error("Gold insuficiente para comprar este item!");else try{const r=await Bx.buyConsumable(a.id,e.id,t);r.success&&r.data?(_.success(`${t}x ${e.name} comprado com sucesso!`),s(r.data.newGold)):_.error(r.error||"Erro ao comprar consumível!")}catch(n){_.error("Erro ao comprar consumível!")}},onOpenInventory:()=>m(!0)}),t.jsx(af,{character:a,isOpen:d,onClose:()=>m(!1),onItemSold:e=>{s(e)}})]})};const rf=l("/_authenticated/game/play/hub/shop")({component:function(){const a=r(),{character:s}=rf.useSearch(),[n,i]=e.useState(null),[o,l]=e.useState(!0),[c,d]=e.useState(null);e.useEffect((()=>{m()}),[s]);const m=async()=>{if(s)try{l(!0),d(null);const e=await Nh.getCharacter(s);if(e.success&&e.data)i(e.data);else{const t=e.error||"Erro desconhecido ao carregar personagem";d(t),_.error("Erro ao carregar personagem",{description:t})}}catch(e){const t=e instanceof Error?e.message:"Erro desconhecido";d(t),_.error("Erro ao carregar personagem",{description:t})}finally{l(!1)}else a({to:"/game/play"})};return o?t.jsx("div",{className:"min-h-screen flex flex-col items-center justify-center bg-gradient-to-b from-background to-secondary p-4",children:t.jsxs("div",{className:"text-center",children:[t.jsx("div",{className:"inline-block animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-primary mb-4"}),t.jsx("h2",{className:"text-2xl font-bold mb-2",children:"Carregando Loja"}),t.jsx("p",{className:"text-muted-foreground",children:"Aguarde enquanto carregamos os itens..."})]})}):c||!n?t.jsx("div",{className:"min-h-screen flex flex-col items-center justify-center bg-gradient-to-b from-background to-secondary p-4",children:t.jsx("div",{className:"w-full max-w-md text-center",children:t.jsxs(pu,{className:"p-6",children:[t.jsx(xu,{children:t.jsx(fu,{className:"text-red-500",children:"Erro ao Carregar Loja"})}),t.jsxs(bu,{className:"space-y-4",children:[t.jsx("p",{className:"text-muted-foreground",children:c||"Não foi possível carregar o personagem selecionado."}),t.jsxs("div",{className:"flex gap-2",children:[t.jsxs(Wa,{onClick:m,className:"flex-1",children:[t.jsx(Dt,{className:"h-4 w-4 mr-2"}),"Tentar Novamente"]}),t.jsxs(Wa,{variant:"outline",onClick:()=>a({to:"/game/play"}),className:"flex-1",children:[t.jsx(Pe,{className:"h-4 w-4 mr-2"}),"Voltar"]})]})]})]})})}):t.jsx("div",{className:"min-h-screen flex flex-col items-center justify-center bg-gradient-to-b from-background to-secondary p-4",children:t.jsxs("div",{className:"w-full max-w-7xl",children:[t.jsx("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-4 mb-6",children:t.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center gap-2 sm:gap-4",children:[t.jsxs(Wa,{variant:"outline",size:"sm",onClick:()=>{a(s?{to:"/game/play/hub",search:{character:s}}:{to:"/game/play"})},className:"w-fit",children:[t.jsx(Pe,{className:"h-4 w-4 mr-2"}),"Voltar ao Hub"]}),t.jsxs("div",{className:"mt-2 sm:mt-0",children:[t.jsx("h1",{className:"text-2xl sm:text-3xl font-bold",children:"Loja"}),t.jsxs("p",{className:"text-sm sm:text-base text-muted-foreground",children:[n.name," • Nível ",n.level," • Andar ",n.floor]})]})]})}),t.jsx(sf,{character:n,onPurchase:async e=>{n&&i((t=>({...t,gold:e})))}})]})})},validateSearch:e=>({character:e.character||""})});class nf{static potionSlotsCache=new Map;static spellSlotsCache=new Map;static pendingPotionRequests=new Map;static pendingSpellRequests=new Map;static CACHE_DURATION=3e5;static REQUEST_TIMEOUT=8e3;static isCacheValid(e){if(!e)return!1;const t=Date.now();return e.isValid&&t-e.timestamp<this.CACHE_DURATION}static cancelPendingRequest(e,t){const a=e.get(t);a&&(a.abortController.abort(),e.delete(t))}static invalidateCache(e){this.cancelPendingRequest(this.pendingPotionRequests,e),this.cancelPendingRequest(this.pendingSpellRequests,e);const t=this.potionSlotsCache.get(e);t&&(t.isValid=!1);const a=this.spellSlotsCache.get(e);a&&(a.isValid=!1)}static async getCharacterPotionSlots(e){try{const a=this.potionSlotsCache.get(e);if(this.isCacheValid(a))return{data:a.data,error:null,success:!0};const s=this.pendingPotionRequests.get(e);if(s)try{return await s.promise}catch(t){if(!s.abortController.signal.aborted)throw t}const r=new AbortController,n=this.fetchPotionSlotsFromServer(e,r.signal);this.pendingPotionRequests.set(e,{promise:n,abortController:r});try{const t=await n;return t.success&&t.data&&this.potionSlotsCache.set(e,{data:t.data,timestamp:Date.now(),isValid:!0}),t}finally{this.pendingPotionRequests.delete(e)}}catch(t){return this.getFallbackPotionSlots()}}static async fetchPotionSlotsFromServer(e,t){const a=new Promise(((e,a)=>{const s=setTimeout((()=>{a(new Error("Timeout ao carregar slots de poção"))}),this.REQUEST_TIMEOUT);t.addEventListener("abort",(()=>{clearTimeout(s),a(new Error("Request cancelado"))}))})),s=Aa.rpc("get_character_potion_slots",{p_character_id:e});try{const{data:e,error:r}=await Promise.race([s,a]);if(t.aborted)throw new Error("Request cancelado");if(r)throw r;const n=[];for(let t=1;t<=3;t++){const a=e?.find((e=>e.slot_position===t));n.push(a||{slot_position:t,consumable_id:null,consumable_name:null,consumable_description:null,effect_value:null,consumable_type:null,available_quantity:0,consumable_price:null})}return{data:n,error:null,success:!0}}catch(r){if(t.aborted)throw r;throw r}}static getFallbackPotionSlots(){const e=[];for(let t=1;t<=3;t++)e.push({slot_position:t,consumable_id:null,consumable_name:null,consumable_description:null,effect_value:null,consumable_type:null,available_quantity:0,consumable_price:null});return{data:e,error:null,success:!0}}static async getCharacterSpellSlots(e){try{const t=this.spellSlotsCache.get(e);if(this.isCacheValid(t))return{data:t.data,error:null,success:!0};const a=this.pendingSpellRequests.get(e);if(a)return await a.promise;const s=new AbortController,r=this.fetchSpellSlotsFromServer(e,s.signal);this.pendingSpellRequests.set(e,{promise:r,abortController:s});try{const t=await r;return t.success&&t.data&&this.spellSlotsCache.set(e,{data:t.data,timestamp:Date.now(),isValid:!0}),t}finally{this.pendingSpellRequests.delete(e)}}catch(t){return{data:null,error:"Erro ao buscar slots de spell",success:!1}}}static async fetchSpellSlotsFromServer(e,t){const{data:a,error:s}=await Aa.rpc("get_character_spell_slots",{p_character_id:e});if(t.aborted)throw new Error("Request cancelado");if(s)throw s;const r=[];for(let n=1;n<=3;n++){const e=a?.find((e=>e.slot_position===n));r.push(e||{slot_position:n,spell_id:null,spell_name:null,spell_description:null,mana_cost:null,damage:null,spell_type:null})}return{data:r,error:null,success:!0}}static async setPotionSlot(e,t,a){try{const{data:s,error:r}=await Aa.rpc("set_potion_slot",{p_character_id:e,p_slot_position:t,p_consumable_id:a}).single();if(r)throw r;const n=s;return n.success?(this.invalidateCache(e),{data:null,error:null,success:!0}):{data:null,error:n.error||"Erro ao configurar slot de poção",success:!1}}catch(s){return{data:null,error:s instanceof Error?s.message:"Erro ao configurar slot de poção",success:!1}}}static async clearPotionSlot(e,t){try{const{data:a,error:s}=await Aa.rpc("clear_potion_slot",{p_character_id:e,p_slot_position:t}).single();if(s)throw s;const r=a;return r.success?(this.invalidateCache(e),{data:null,error:null,success:!0}):{data:null,error:r.error||"Erro ao limpar slot de poção",success:!1}}catch(a){return{data:null,error:a instanceof Error?a.message:"Erro ao limpar slot de poção",success:!1}}}static async setSpellSlot(e,t,a){try{const{error:s}=await Aa.rpc("set_spell_slot",{p_character_id:e,p_slot_position:t,p_spell_id:a});if(s)throw s;return this.invalidateCache(e),{data:null,error:null,success:!0}}catch(s){return{data:null,error:s instanceof Error?s.message:"Erro ao configurar slot de spell",success:!1}}}static async consumePotionFromSlot(e,t){try{if(!e)return{success:!1,error:"ID do personagem é obrigatório",data:null};if(t<1||t>3)return{success:!1,error:"Posição do slot inválida (1-3)",data:null};const{supabaseAdmin:a}=await u((async()=>{const{supabaseAdmin:e}=await Promise.resolve().then((()=>Ma));return{supabaseAdmin:e}}),void 0),{data:s,error:r}=await a.rpc("consume_potion_from_slot",{p_character_id:e,p_slot_position:t});if(r)return{success:!1,error:r.message||"Erro ao usar poção",data:null};if(!s||!Array.isArray(s)||0===s.length)return{success:!1,error:"Nenhum resultado retornado da função",data:null};const n=s[0];if(!n)return{success:!1,error:"Resultado vazio da função",data:null};const i=n.success,o=n.message,l=n.new_hp,c=n.new_mana;let d=!1;d="boolean"==typeof i?i:"string"==typeof i?"true"===i.toLowerCase()||"t"===i:Boolean(i);const m=Math.floor(Number(l)||0),h=Math.floor(Number(c)||0);if(isNaN(m)||isNaN(h))return{success:!1,error:"Erro nos valores de HP/Mana retornados",data:null};const p={success:d,message:String(o||"Poção usada"),new_hp:m,new_mana:h};return this.invalidateCache(e),p.success?{success:!0,error:null,data:p}:{success:!1,error:p.message,data:null}}catch(a){return this.invalidateCache(e),{success:!1,error:a instanceof Error?a.message:"Erro desconhecido",data:null}}}static async clearSpellSlot(e,t){return this.setSpellSlot(e,t,null)}static clearAllCache(){for(const[,e]of this.pendingPotionRequests)e.abortController.abort();for(const[,e]of this.pendingSpellRequests)e.abortController.abort();this.potionSlotsCache.clear(),this.spellSlotsCache.clear(),this.pendingPotionRequests.clear(),this.pendingSpellRequests.clear()}}const of=Object.freeze(Object.defineProperty({__proto__:null,SlotService:nf},Symbol.toStringTag,{value:"Module"}));function lf({characterId:a,consumables:s,onSlotsUpdate:r}){const[n,i]=e.useState([]),[o,l]=e.useState(!0),[c,d]=e.useState(null),m=e.useRef(null),u=async()=>{try{const e=await nf.getCharacterPotionSlots(a);e.success&&e.data&&i(e.data)}catch(e){}finally{l(!1)}};e.useEffect((()=>{a&&u()}),[a]),e.useEffect((()=>{const e=e=>{m.current&&!m.current.contains(e.target)&&d(null)},t=()=>{d(null)};if(null!==c)return document.addEventListener("mousedown",e),document.addEventListener("touchstart",e),window.addEventListener("scroll",t,!0),()=>{document.removeEventListener("mousedown",e),document.removeEventListener("touchstart",e),window.removeEventListener("scroll",t,!0)}}),[c]);const h=e=>{if(!e.consumable_id)return t.jsx(Lt,{className:"h-4 w-4 text-slate-500"});const a=s.find((t=>t.consumable_id===e.consumable_id));return a?.consumable?t.jsx(tf,{consumable:a.consumable,size:"lg"}):e.consumable_description?e.consumable_description.includes("HP")||e.consumable_description.includes("Vida")?t.jsx(Be,{className:"h-4 w-4 text-red-400"}):e.consumable_description.includes("Mana")?t.jsx(Le,{className:"h-4 w-4 text-blue-400"}):t.jsx(Lt,{className:"h-4 w-4 text-purple-400"}):t.jsx(Lt,{className:"h-4 w-4 text-slate-500"})},p=e=>{if(!e.consumable_id)return 0;const t=s.find((t=>t.consumable_id===e.consumable_id));return t?.quantity||0},x=e=>{return e.effect_value&&e.consumable_description?(t=e.effect_value,a=e.consumable_description,!t||t<=0?"":a.includes("HP")||a.includes("Vida")?`+${t} HP`:a.includes("Mana")?`+${t} Mana`:`+${t}`):"";var t,a};return o?t.jsxs("div",{className:"space-y-2",children:[t.jsx("div",{className:"text-xs text-slate-500 font-medium",children:"Atalhos Rápidos"}),t.jsx("div",{className:"flex gap-2",children:[1,2,3].map((e=>t.jsx("div",{className:"w-12 h-12 bg-slate-700/20 rounded border border-slate-700/30 animate-pulse"},`loading-slot-${e}`)))})]}):t.jsxs("div",{className:"space-y-2",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("div",{className:"text-xs text-slate-500 font-medium",children:"Atalhos Rápidos"}),t.jsx("div",{className:"text-xs text-slate-600",children:"Q • W • E"})]}),t.jsxs("div",{className:"space-y-3",children:[t.jsx("div",{className:"flex gap-2",children:n.map((e=>{const s=(e=>{switch(e){case 1:return"Q";case 2:return"W";case 3:return"E";default:return""}})(e.slot_position),n=!e.consumable_id,i=c===e.slot_position;return t.jsx("div",{className:"relative",children:t.jsxs("div",{className:"relative group",children:[t.jsx(Wa,{variant:"outline",className:`w-12 h-12 p-1 border transition-all duration-200 ${n?"border-slate-600/50 bg-slate-800/20 hover:border-slate-500/70 hover:bg-slate-700/30":"border-blue-500/60 bg-blue-900/20 hover:border-blue-400/80 hover:bg-blue-800/30"} ${i?"ring-1 ring-blue-400/50":""}`,onClick:()=>{return t=e.slot_position,void d(c===t?null:t);var t},children:t.jsx("div",{className:"flex flex-col items-center justify-center",children:n?t.jsxs("div",{className:"flex items-center",children:[t.jsx(Ke,{className:"h-3 w-3 text-slate-500"}),t.jsx(oe,{className:"h-2 w-2 text-slate-500 transition-transform "+(i?"rotate-180":"")})]}):h(e)})}),t.jsx(Nu,{className:"absolute -top-1 -right-1 h-4 w-4 p-0 flex items-center justify-center bg-slate-600 text-white text-xs font-medium border border-slate-700 text-[10px]",children:s}),!n&&t.jsx(Wa,{variant:"destructive",size:"sm",className:"absolute -top-1 -left-1 h-4 w-4 p-0 rounded-full opacity-0 group-hover:opacity-100 transition-opacity",onClick:t=>{t.stopPropagation(),(async e=>{try{const t=await nf.clearPotionSlot(a,e);t.success?(await u(),r?.(),_.success("Slot limpo!")):_.error(t.error||"Erro ao limpar slot")}catch(t){_.error("Erro ao limpar slot")}})(e.slot_position)},children:t.jsx(G,{className:"h-2 w-2"})}),t.jsx("div",{className:"absolute -bottom-8 left-1/2 transform -translate-x-1/2 opacity-0 group-hover:opacity-100 transition-opacity duration-200 z-10 pointer-events-none",children:t.jsxs("div",{className:"bg-slate-900/95 text-slate-300 text-xs px-2 py-1 rounded border border-slate-700/50 whitespace-nowrap",children:[n?`Slot ${s}`:e.consumable_name||"Poção",!n&&e.effect_value&&t.jsx("div",{className:"text-emerald-300 text-[10px]",children:x(e)}),!n&&p(e)>0&&t.jsxs("div",{className:"text-blue-300 text-[10px]",children:["x",p(e)]})]})})]})},`potion-slot-${e.slot_position}`)}))}),null!==c&&t.jsx("div",{ref:m,className:"relative",children:t.jsx("div",{className:"bg-slate-800/95 backdrop-blur-sm border border-slate-600/50 rounded-lg shadow-xl max-h-48 overflow-y-auto",children:(()=>{const e=n.find((e=>e.slot_position===c));if(!e)return null;const i=(e=>{const t=n.filter((t=>t.consumable_id&&t.slot_position!==e)).map((e=>e.consumable_id)),a=s.filter((e=>{const a=e.consumable&&"potion"===e.consumable.type&&e.quantity>0,s=!t.includes(e.consumable_id);return a&&s}));return a})(e.slot_position);return i.length>0?t.jsx("div",{className:"p-2 space-y-1",children:i.map((s=>t.jsxs("button",{className:"w-full text-left px-3 py-2 rounded hover:bg-slate-700/50 transition-colors flex items-center gap-3 text-sm",onClick:()=>(async(e,t)=>{try{const s=await nf.setPotionSlot(a,e,t);s.success?(await u(),r?.(),_.success("Poção atribuída ao slot!"),d(null)):_.error(s.error||"Erro ao atribuir poção")}catch(s){_.error("Erro ao configurar slot")}})(e.slot_position,s.consumable_id),children:[t.jsx("div",{className:"flex-shrink-0",children:t.jsx(tf,{consumable:s.consumable,size:"sm"})}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsx("div",{className:"text-xs font-medium text-slate-200 truncate",children:s.consumable.name}),t.jsxs("div",{className:"text-xs text-slate-400",children:[Vx(s.consumable)," • x",s.quantity]})]})]},`dropdown-${s.id}`)))}):t.jsx("div",{className:"p-4 text-center",children:t.jsx("div",{className:"text-slate-400 text-xs",children:"Nenhuma poção disponível"})})})()})})]})]})}const cf=({character:a,onInventoryChange:s})=>{const[r,n]=e.useState([]),[i,o]=e.useState([]),[l,c]=e.useState(!0),[d,m]=e.useState(null),[u,h]=e.useState(null),[p,x]=e.useState(null),[f,g]=e.useState({isOpen:!1,type:null,item:null,sellPrice:null}),[b,v]=e.useState(a.gold),y=e.useCallback((async()=>{try{c(!0);const[e,t]=await Promise.all([Bx.getCharacterConsumables(a.id),Bx.getCharacterDrops(a.id)]);n(e.success&&e.data||[]),o(t.success&&t.data||[])}catch(e){_.error("Erro ao carregar inventário"),n([]),o([])}finally{c(!1)}}),[a.id]);e.useEffect((()=>{y()}),[y]),e.useEffect((()=>{v(a.gold)}),[a.gold]);const j=e=>{if(!e.consumable)return!1;if("potion"===e.consumable.type){if(e.consumable.description.includes("HP")&&a.hp>=a.max_hp)return!1;if(e.consumable.description.includes("Mana")&&a.mana>=a.max_mana)return!1}return!0},N=e=>{const t={common:"border-slate-600 bg-slate-800/30",uncommon:"border-emerald-600 bg-emerald-900/30",rare:"border-blue-600 bg-blue-900/30",epic:"border-purple-600 bg-purple-900/30",legendary:"border-amber-600 bg-amber-900/30"};return t[e]||t.common};return l?t.jsxs("div",{className:"grid grid-cols-1 xl:grid-cols-3 gap-6 h-[70vh]",children:[t.jsx("div",{className:"xl:col-span-2 space-y-6",children:t.jsx(pu,{className:"bg-slate-800/50 border-slate-700/50",children:t.jsx(bu,{className:"p-4 sm:p-6",children:t.jsxs("div",{className:"animate-pulse space-y-4",children:[t.jsx("div",{className:"h-6 bg-slate-700 rounded w-32"}),t.jsx("div",{className:"grid grid-cols-4 sm:grid-cols-6 md:grid-cols-8 lg:grid-cols-10 gap-2 sm:gap-3",children:Array.from({length:16}).map(((e,a)=>t.jsx("div",{className:"aspect-square bg-slate-700 rounded"},a)))})]})})})}),t.jsx("div",{className:"xl:col-span-1",children:t.jsx(pu,{className:"bg-slate-800/50 border-slate-700/50 h-full min-h-[400px]",children:t.jsx(bu,{className:"p-4 sm:p-6",children:t.jsxs("div",{className:"animate-pulse space-y-4",children:[t.jsx("div",{className:"h-6 bg-slate-700 rounded w-24"}),t.jsx("div",{className:"h-32 bg-slate-700 rounded"})]})})})})]}):t.jsxs("div",{className:"grid grid-cols-1 xl:grid-cols-3 gap-6",children:[t.jsxs("div",{className:"xl:col-span-2 space-y-6",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("h2",{className:"text-xl sm:text-2xl font-bold text-slate-100",children:"Inventário"}),t.jsxs("div",{className:"flex items-center gap-2 text-amber-400 bg-slate-800/30 px-3 py-1 rounded-lg border border-slate-700/50",children:[t.jsx(Ve,{className:"h-4 w-4"}),t.jsx("span",{className:"font-medium text-sm sm:text-base",children:b.toLocaleString()})]})]}),t.jsx(pu,{className:"bg-slate-800/50 border-slate-700/50",children:t.jsxs(bu,{className:"p-4 sm:p-6",children:[t.jsxs("h3",{className:"text-base sm:text-lg font-bold text-slate-100 mb-4 flex items-center gap-2",children:[t.jsx(pt,{className:"h-4 w-4 sm:h-5 sm:w-5 text-purple-400"}),"Consumíveis (",r.filter((e=>e.quantity>0)).length,")"]}),t.jsx("div",{className:"mb-6",children:t.jsx(lf,{characterId:a.id,consumables:r,onSlotsUpdate:()=>{y()}})}),(()=>{const e=r.filter((e=>e.consumable&&e.quantity>0));return 0===e.length?t.jsxs("div",{className:"text-center py-12",children:[t.jsx(At,{className:"h-16 w-16 mx-auto mb-4 text-slate-600 opacity-50"}),t.jsx("p",{className:"text-slate-500",children:"Nenhum consumível disponível"})]}):t.jsx("div",{className:"grid grid-cols-4 sm:grid-cols-6 md:grid-cols-8 lg:grid-cols-10 gap-2 sm:gap-3",children:e.map((e=>{const a=d?.id===e.id,s=j(e);return t.jsxs("div",{className:`relative aspect-square border-2 rounded-lg cursor-pointer transition-all duration-200 hover:scale-105 ${a?"border-amber-400 bg-amber-900/30 shadow-lg shadow-amber-400/20":"border-slate-600 bg-slate-800/30 hover:border-slate-400"} ${s?"":"opacity-50"}`,onClick:()=>{m(e),h(null)},children:[t.jsx("div",{className:"absolute inset-0 flex items-center justify-center p-1.5",children:t.jsx(tf,{consumable:e.consumable,size:"xl"})}),e.quantity>1&&t.jsx("div",{className:"absolute bottom-1 right-1 bg-slate-900/80 text-slate-200 text-xs px-1 rounded min-w-[16px] text-center",children:e.quantity}),!s&&t.jsx("div",{className:"absolute top-1 left-1 w-2 h-2 bg-red-500 rounded-full"})]},`consumable-${e.id}`)}))})})()]})}),t.jsx(pu,{className:"bg-slate-800/50 border-slate-700/50",children:t.jsxs(bu,{className:"p-4 sm:p-6",children:[t.jsxs("h3",{className:"text-base sm:text-lg font-bold text-slate-100 mb-4 flex items-center gap-2",children:[t.jsx(ft,{className:"h-4 w-4 sm:h-5 sm:w-5 text-amber-400"}),"Materiais (",i.filter((e=>e.quantity>0)).length,")"]}),(()=>{const e=i.filter((e=>e.drop&&e.quantity>0));return 0===e.length?t.jsxs("div",{className:"text-center py-12",children:[t.jsx(At,{className:"h-16 w-16 mx-auto mb-4 text-slate-600 opacity-50"}),t.jsx("p",{className:"text-slate-500",children:"Nenhum material disponível"})]}):t.jsx("div",{className:"grid grid-cols-4 sm:grid-cols-6 md:grid-cols-8 lg:grid-cols-10 gap-2 sm:gap-3",children:e.map((e=>{const a=u?.id===e.id,s=e.drop?.rarity||"common";return t.jsxs("div",{className:"relative aspect-square border-2 rounded-lg cursor-pointer transition-all duration-200 hover:scale-105 "+(a?"border-amber-400 bg-amber-900/30 shadow-lg shadow-amber-400/20":`${N(s)} hover:border-slate-400`),onClick:()=>{h(e),m(null)},children:[t.jsx("div",{className:"absolute inset-0 flex items-center justify-center p-1.5",children:t.jsx(ft,{className:"h-7 w-7 text-amber-400"})}),e.quantity>1&&t.jsx("div",{className:"absolute bottom-1 right-1 bg-slate-900/80 text-slate-200 text-xs px-1 rounded min-w-[16px] text-center",children:e.quantity})]},`drop-${e.id}`)}))})})()]})})]}),t.jsx("div",{className:"xl:col-span-1",children:t.jsx(pu,{className:"bg-slate-800/50 border-slate-700/50 h-full min-h-[400px]",children:t.jsx(bu,{className:"p-4 sm:p-6 h-full",children:(()=>{if(d?.consumable){const e=d,r=e.consumable,n=j(e);return t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"flex items-start gap-4",children:[t.jsx("div",{className:"p-4 rounded-lg border-2 border-slate-600 bg-slate-800/30",children:t.jsx(tf,{consumable:r,size:"xl"})}),t.jsxs("div",{className:"flex-1",children:[t.jsx("h2",{className:"text-2xl font-bold text-slate-100 mb-2",children:r.name}),t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx(Nu,{className:"bg-slate-700/50 text-slate-200 border-0",children:r.type}),t.jsxs("span",{className:"text-slate-400",children:["Quantidade: ",e.quantity]})]})]})]}),t.jsx("div",{className:"bg-slate-800/30 border border-slate-700/50 rounded-lg p-4",children:t.jsx("p",{className:"text-slate-300 leading-relaxed",children:r.description})}),r.effect_value>0&&t.jsxs("div",{className:"bg-emerald-900/30 border border-emerald-700/50 rounded-lg p-4",children:[t.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[t.jsx(pt,{className:"h-4 w-4 text-emerald-400"}),t.jsx("span",{className:"text-emerald-300 font-medium",children:"Efeito"})]}),t.jsx("p",{className:"text-emerald-200",children:Vx(r)})]}),t.jsxs("div",{className:"space-y-3",children:[t.jsx(Wa,{onClick:()=>(async e=>{if(!e.consumable||e.quantity<=0)_.error("Consumível não disponível");else{x(e.consumable_id);try{const t=await Bx.consumeItem(a.id,e.consumable_id,a);t.success&&t.data?(await y(),s(),_.success(t.data.message)):_.error(t.error||"Erro ao usar consumível")}catch(t){_.error("Erro ao usar consumível")}finally{x(null)}}})(e),disabled:!n||p===e.consumable_id,className:"w-full "+(n?"bg-amber-600 hover:bg-amber-700 text-white":"bg-slate-700 text-slate-400 cursor-not-allowed"),children:p===e.consumable_id?t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-t border-b border-current"}),"Usando..."]}):n?"Usar Item":"potion"===r.type&&r.description.includes("HP")&&a.hp>=a.max_hp?"HP já está no máximo":"potion"===r.type&&r.description.includes("Mana")&&a.mana>=a.max_mana?"Mana já está no máximo":"Não pode ser usado agora"}),t.jsxs(Wa,{onClick:()=>(async e=>{if(e.consumable)try{const t=await Bx.calculateConsumableSellPrice(a.id,e.consumable_id,1);if(!t.success||!t.data?.canSell)return void _.error("Este item não pode ser vendido");g({isOpen:!0,type:"consumable",item:e,sellPrice:t.data})}catch(t){_.error("Erro ao calcular preço de venda")}})(e),variant:"outline",className:"w-full border-slate-600 text-slate-300 hover:bg-slate-700/50",children:[t.jsx(qt,{className:"h-4 w-4 mr-2"}),"Vender Item"]})]})]})}if(u?.drop){const e=u,s=e.drop;return t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"flex items-start gap-4",children:[t.jsx("div",{className:`p-4 rounded-lg border-2 ${N(s.rarity)}`,children:t.jsx(ft,{className:"h-6 w-6 text-amber-400"})}),t.jsxs("div",{className:"flex-1",children:[t.jsx("h2",{className:"text-2xl font-bold text-slate-100 mb-2",children:s.name}),t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx(Nu,{className:`${N(s.rarity)} border-0 text-slate-200`,children:s.rarity}),t.jsxs("span",{className:"text-slate-400",children:["Quantidade: ",e.quantity]})]})]})]}),t.jsx("div",{className:"bg-slate-800/30 border border-slate-700/50 rounded-lg p-4",children:t.jsx("p",{className:"text-slate-300 leading-relaxed",children:s.description})}),t.jsxs("div",{className:"bg-amber-900/30 border border-amber-700/50 rounded-lg p-4",children:[t.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[t.jsx(Ve,{className:"h-4 w-4 text-amber-400"}),t.jsx("span",{className:"text-amber-300 font-medium",children:"Valor"})]}),t.jsxs("p",{className:"text-amber-200",children:[s.value," gold por unidade"]})]}),t.jsxs(Wa,{onClick:()=>(async e=>{if(e.drop)try{const t=await Bx.calculateDropSellPrice(a.id,e.drop_id,1);if(!t.success||!t.data?.canSell)return void _.error("Este material não pode ser vendido");g({isOpen:!0,type:"drop",item:e,sellPrice:t.data})}catch(t){_.error("Erro ao calcular preço de venda")}})(e),variant:"outline",className:"w-full border-slate-600 text-slate-300 hover:bg-slate-700/50",children:[t.jsx(qt,{className:"h-4 w-4 mr-2"}),"Vender Material"]})]})}return t.jsx("div",{className:"flex items-center justify-center h-full text-slate-500",children:t.jsxs("div",{className:"text-center",children:[t.jsx(At,{className:"h-16 w-16 mx-auto mb-4 opacity-50"}),t.jsx("p",{className:"text-lg",children:"Selecione um item"}),t.jsx("p",{className:"text-sm mt-2 opacity-75",children:"Clique em um item para ver os detalhes"})]})})})()})})}),t.jsx(Zx,{isOpen:f.isOpen,onClose:()=>g({isOpen:!1,type:null,item:null,sellPrice:null}),onConfirm:async e=>{if(f.item&&f.type)try{if("consumable"===f.type){const t=f.item,r=await Bx.sellConsumablesBatch(a.id,[{consumable_id:t.consumable_id,quantity:e}]);r.success&&r.data?(_.success(`Vendido ${e}x ${t.consumable?.name} por ${r.data.totalGoldEarned} gold!`),await y(),s(),v(r.data.newGold)):_.error(r.error||"Erro ao vender consumível")}else if("drop"===f.type){const t=f.item,r=await Bx.sellDropsBatch(a.id,[{drop_id:t.drop_id,quantity:e}]);r.success&&r.data?(_.success(`Vendido ${e}x ${t.drop?.name} por ${r.data.totalGoldEarned} gold!`),await y(),s(),v(r.data.newGold)):_.error(r.error||"Erro ao vender material")}}catch(t){_.error("Erro ao vender item")}},itemName:"consumable"===f.type?f.item?.consumable?.name||"":f.item?.drop?.name||"",itemIcon:"consumable"===f.type&&f.item&&f.item.consumable?t.jsx(tf,{consumable:f.item.consumable,size:"lg"}):t.jsx(ft,{className:"h-8 w-8 text-amber-400"}),itemRarity:"consumable"===f.type?void 0:f.item?.drop?.rarity,availableQuantity:f.sellPrice?.availableQuantity||0,unitSellPrice:f.sellPrice?.unitSellPrice||0,originalPrice:f.sellPrice?.originalPrice})]})},df=l("/_authenticated/game/play/hub/inventory")({component:function(){const a=r(),{character:s}=df.useSearch(),{loadCharacterForHub:n}=jx(),[i,o]=e.useState(null),[l,c]=e.useState(!0),[d,m]=e.useState(null),[u,h]=e.useState(!1),p=async(e=!0,t=!1)=>{if(s){if(t||!u||i?.id!==s||e){e&&c(!0),m(null);try{const e=await Nh.getCharacter(s);if(e.success&&e.data)o(e.data),await n(e.data),h(!0);else{const t=e.error||"Erro desconhecido ao carregar personagem";m(t),_.error("Erro ao carregar personagem",{description:t})}}catch(r){const e=r instanceof Error?r.message:"Erro desconhecido";m(e),_.error("Erro ao carregar personagem",{description:e})}finally{c(!1)}}}else a({to:"/game/play"})};e.useEffect((()=>{p(!0)}),[s]);if(l)return t.jsx("div",{className:"min-h-screen flex flex-col items-center justify-center bg-gradient-to-b from-slate-900 to-black p-4",children:t.jsxs("div",{className:"text-center",children:[t.jsx("div",{className:"inline-block animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-amber-400 mb-4"}),t.jsx("h2",{className:"text-2xl font-bold mb-2 text-slate-100",children:"Carregando Inventário"}),t.jsx("p",{className:"text-slate-400",children:"Aguarde enquanto carregamos seus itens..."})]})});if(d||!i)return t.jsx("div",{className:"min-h-screen flex flex-col items-center justify-center bg-gradient-to-b from-slate-900 to-black p-4",children:t.jsx("div",{className:"w-full max-w-md text-center",children:t.jsxs(pu,{className:"p-6 bg-slate-800/50 border-slate-700/50",children:[t.jsx(xu,{children:t.jsx(fu,{className:"text-red-400",children:"Erro ao Carregar Inventário"})}),t.jsxs(bu,{className:"space-y-4",children:[t.jsx("p",{className:"text-slate-400",children:d||"Não foi possível carregar o personagem selecionado."}),t.jsxs("div",{className:"flex gap-2",children:[t.jsx(Wa,{onClick:()=>p(),className:"flex-1 bg-amber-600 hover:bg-amber-700",children:"Tentar Novamente"}),t.jsxs(Wa,{variant:"outline",onClick:()=>a({to:"/game/play"}),className:"flex-1 border-slate-600 text-slate-300",children:[t.jsx(Pe,{className:"h-4 w-4 mr-2"}),"Voltar"]})]})]})]})})});return t.jsx("div",{className:"min-h-screen bg-gradient-to-b from-slate-900 to-black",children:t.jsxs("div",{className:"container mx-auto px-2 sm:px-3 md:px-4 py-2 sm:py-4 md:py-6",children:[t.jsx("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-3 sm:gap-4 mb-4 sm:mb-6",children:t.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center gap-2 sm:gap-4",children:[t.jsxs(Wa,{variant:"outline",size:"sm",onClick:()=>{a(s?{to:"/game/play/hub",search:{character:s}}:{to:"/game/play"})},className:"border-slate-600 text-slate-300 hover:bg-slate-700 w-fit",children:[t.jsx(Pe,{className:"h-4 w-4 mr-2"}),"Voltar ao Hub"]}),t.jsxs("div",{className:"mt-1 sm:mt-0",children:[t.jsx("h1",{className:"text-xl sm:text-2xl lg:text-3xl font-bold text-slate-100",children:"Inventário"}),t.jsxs("p",{className:"text-sm sm:text-base text-slate-400",children:[i.name," • Nível ",i.level]})]})]})}),t.jsx(cf,{character:i,onInventoryChange:()=>{p(!1,!0)}})]})})},validateSearch:e=>({character:e.character||""})});const mf=({selectedItem:e,selectedSlot:a,character:s,onEquipmentChange:r})=>{const n=e=>{const t={common:"bg-slate-800/80 text-slate-300 border-slate-600",uncommon:"bg-emerald-900/80 text-emerald-300 border-emerald-600",rare:"bg-blue-900/80 text-blue-300 border-blue-600",epic:"bg-purple-900/80 text-purple-300 border-purple-600",legendary:"bg-amber-900/80 text-amber-300 border-amber-600"};return t[e]||t.common};return e?t.jsxs(pu,{className:"bg-slate-800/50 border-slate-700/50 h-full",children:[t.jsx(xu,{children:t.jsx(fu,{className:"text-slate-100",children:"Detalhes do Item"})}),t.jsxs(bu,{className:"space-y-6",children:[t.jsxs("div",{className:"flex items-start gap-4",children:[t.jsx("div",{className:`p-4 rounded-lg border-2 ${n(e.rarity)}`,children:(e=>{switch(e.type){case"weapon":return t.jsx(qe,{className:"h-12 w-12 text-red-400"});case"armor":return t.jsx(De,{className:"h-12 w-12 text-blue-400"});case"chest":return t.jsx(Ct,{className:"h-12 w-12 text-emerald-400"});case"helmet":return t.jsx(De,{className:"h-12 w-12 text-yellow-400"});case"legs":return t.jsx(De,{className:"h-12 w-12 text-cyan-400"});case"boots":return t.jsx(De,{className:"h-12 w-12 text-orange-400"});case"ring":return t.jsx(gt,{className:"h-12 w-12 text-purple-400"});case"necklace":return t.jsx(gt,{className:"h-12 w-12 text-pink-400"});case"amulet":return t.jsx(gt,{className:"h-12 w-12 text-indigo-400"});default:return t.jsx(De,{className:"h-12 w-12 text-slate-400"})}})(e)}),t.jsxs("div",{className:"flex-1",children:[t.jsx("h2",{className:"text-2xl font-bold text-slate-100 mb-2",children:e.name}),t.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[t.jsx(Nu,{className:`border ${n(e.rarity)}`,children:e.rarity}),t.jsx(Nu,{variant:"outline",className:"text-slate-300",children:"weapon"===e.type?"Arma":"armor"===e.type?"Escudo":"chest"===e.type?"Peitoral":"helmet"===e.type?"Capacete":"legs"===e.type?"Perneiras":"boots"===e.type?"Botas":"ring"===e.type?"Anel":"necklace"===e.type?"Colar":"amulet"===e.type?"Amuleto":e.type}),"legendary"===e.rarity&&t.jsx(ft,{className:"h-4 w-4 text-amber-400 animate-pulse"})]}),a&&t.jsxs("p",{className:"text-sm text-slate-400",children:["Equipado em: ",(e=>{switch(e){case"main_hand":return"Mão Principal";case"off_hand":return"Mão Secundária";case"armor":return"Escudo";case"chest":return"Peitoral";case"helmet":return"Capacete";case"legs":return"Perneiras";case"boots":return"Botas";case"ring_1":return"Anel 1";case"ring_2":return"Anel 2";case"necklace":return"Colar";case"amulet":return"Amuleto";case"accessory":return"Acessório";default:return e}})(a)]})]})]}),t.jsx("div",{className:"bg-slate-800/30 border border-slate-700/50 rounded-lg p-4",children:t.jsx("p",{className:"text-slate-300 leading-relaxed",children:e.description})}),t.jsxs("div",{className:"space-y-3",children:[t.jsx("h3",{className:"text-lg font-semibold text-slate-200",children:"Atributos"}),t.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.atk_bonus>0&&t.jsxs("div",{className:"bg-red-900/30 border border-red-700/50 rounded-lg p-3",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(qe,{className:"h-4 w-4 text-red-400"}),t.jsx("span",{className:"text-red-300 font-medium",children:"Ataque"})]}),t.jsxs("p",{className:"text-red-200 text-lg font-bold",children:["+",e.atk_bonus]})]}),e.def_bonus>0&&t.jsxs("div",{className:"bg-blue-900/30 border border-blue-700/50 rounded-lg p-3",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(De,{className:"h-4 w-4 text-blue-400"}),t.jsx("span",{className:"text-blue-300 font-medium",children:"Defesa"})]}),t.jsxs("p",{className:"text-blue-200 text-lg font-bold",children:["+",e.def_bonus]})]}),e.speed_bonus>0&&t.jsxs("div",{className:"bg-yellow-900/30 border border-yellow-700/50 rounded-lg p-3",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(Le,{className:"h-4 w-4 text-yellow-400"}),t.jsx("span",{className:"text-yellow-300 font-medium",children:"Velocidade"})]}),t.jsxs("p",{className:"text-yellow-200 text-lg font-bold",children:["+",e.speed_bonus]})]}),e.hp_bonus>0&&t.jsxs("div",{className:"bg-green-900/30 border border-green-700/50 rounded-lg p-3",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(Be,{className:"h-4 w-4 text-green-400"}),t.jsx("span",{className:"text-green-300 font-medium",children:"HP"})]}),t.jsxs("p",{className:"text-green-200 text-lg font-bold",children:["+",e.hp_bonus]})]}),e.mana_bonus>0&&t.jsxs("div",{className:"bg-purple-900/30 border border-purple-700/50 rounded-lg p-3",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(pt,{className:"h-4 w-4 text-purple-400"}),t.jsx("span",{className:"text-purple-300 font-medium",children:"Mana"})]}),t.jsxs("p",{className:"text-purple-200 text-lg font-bold",children:["+",e.mana_bonus]})]}),e.critical_chance_bonus>0&&t.jsxs("div",{className:"bg-orange-900/30 border border-orange-700/50 rounded-lg p-3",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(ft,{className:"h-4 w-4 text-orange-400"}),t.jsx("span",{className:"text-orange-300 font-medium",children:"Crit. Chance"})]}),t.jsxs("p",{className:"text-orange-200 text-lg font-bold",children:["+",e.critical_chance_bonus.toFixed(1),"%"]})]}),e.critical_damage_bonus>0&&t.jsxs("div",{className:"bg-red-900/30 border border-red-700/50 rounded-lg p-3",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(bt,{className:"h-4 w-4 text-red-400"}),t.jsx("span",{className:"text-red-300 font-medium",children:"Crit. Dano"})]}),t.jsxs("p",{className:"text-red-200 text-lg font-bold",children:["+",e.critical_damage_bonus.toFixed(0),"%"]})]}),e.double_attack_chance_bonus>0&&t.jsxs("div",{className:"bg-cyan-900/30 border border-cyan-700/50 rounded-lg p-3",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(Fe,{className:"h-4 w-4 text-cyan-400"}),t.jsx("span",{className:"text-cyan-300 font-medium",children:"Duplo Ataque"})]}),t.jsxs("p",{className:"text-cyan-200 text-lg font-bold",children:["+",e.double_attack_chance_bonus.toFixed(1),"%"]})]}),e.magic_damage_bonus>0&&t.jsxs("div",{className:"bg-indigo-900/30 border border-indigo-700/50 rounded-lg p-3",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(pt,{className:"h-4 w-4 text-indigo-400"}),t.jsx("span",{className:"text-indigo-300 font-medium",children:"Dano Mágico"})]}),t.jsxs("p",{className:"text-indigo-200 text-lg font-bold",children:["+",e.magic_damage_bonus.toFixed(1),"%"]})]})]})]}),e.level_requirement>1&&t.jsxs("div",{className:"bg-slate-700/30 border border-slate-600/50 rounded-lg p-3",children:[t.jsx("h4",{className:"text-sm font-medium text-slate-300 mb-2",children:"Requisitos"}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("span",{className:"text-slate-400",children:"Nível mínimo:"}),t.jsx("span",{className:"font-bold "+(s.level>=e.level_requirement?"text-green-400":"text-red-400"),children:e.level_requirement})]})]}),e.weapon_subtype&&t.jsxs("div",{className:"bg-slate-700/30 border border-slate-600/50 rounded-lg p-3",children:[t.jsx("h4",{className:"text-sm font-medium text-slate-300 mb-2",children:"Tipo de Arma"}),t.jsx("p",{className:"text-slate-400 capitalize",children:e.weapon_subtype})]}),a&&t.jsx("div",{className:"pt-4 border-t border-slate-700/50",children:t.jsxs(Wa,{onClick:async()=>{if(e&&a)try{const t=await gh.toggleEquipment(s.id,e.id,!1);t.success?(_.success("Item desequipado com sucesso!"),r()):_.error(t.error||"Erro ao desequipar item")}catch(t){_.error("Erro ao desequipar item")}},variant:"outline",className:"w-full bg-slate-800/50 border-slate-600 text-slate-300 hover:bg-slate-700/50 hover:border-slate-500 hover:text-slate-200 transition-all duration-200",children:[t.jsx(At,{className:"h-4 w-4 mr-2"}),"Desequipar Item"]})})]})]}):t.jsxs(pu,{className:"bg-slate-800/50 border-slate-700/50 h-full",children:[t.jsx(xu,{children:t.jsx(fu,{className:"text-slate-100",children:"Detalhes do Item"})}),t.jsx(bu,{className:"flex items-center justify-center h-64",children:t.jsxs("div",{className:"text-center text-slate-500",children:[t.jsx(At,{className:"h-16 w-16 mx-auto mb-4 opacity-50"}),t.jsx("p",{className:"text-lg",children:"Nenhum item selecionado"}),t.jsx("p",{className:"text-sm mt-2 opacity-75",children:"Clique em um slot para ver os detalhes do equipamento"})]})})]})},uf=({equippedSlots:a,onSlotClick:s,onSlotLongPress:r})=>{const[n,i]=e.useState(null),[o,l]=e.useState(!1),c=e.useCallback((e=>{l(!1);const t=setTimeout((()=>{l(!0),r(e)}),800);i(t)}),[r]),d=e.useCallback(((e,t)=>{n&&(clearTimeout(n),i(null)),o||s(e,t),setTimeout((()=>l(!1)),100)}),[n,o,s]),m=e.useCallback((()=>{n&&(clearTimeout(n),i(null)),l(!1)}),[n]),u=(e,a)=>{if(a)switch(a.type){case"weapon":return t.jsx(qe,{className:"h-8 w-8 text-red-400"});case"armor":case"chest":return t.jsx(Ct,{className:"h-8 w-8 text-blue-400"});case"helmet":return t.jsx(Je,{className:"h-8 w-8 text-amber-400"});case"legs":return t.jsx(Ct,{className:"h-8 w-8 text-green-400"});case"boots":return t.jsx(St,{className:"h-8 w-8 text-brown-400"});case"ring":return t.jsx(gt,{className:"h-8 w-8 text-purple-400"});case"necklace":return t.jsx(Be,{className:"h-8 w-8 text-pink-400"});case"amulet":return t.jsx(Le,{className:"h-8 w-8 text-yellow-400"});default:return t.jsx(De,{className:"h-8 w-8 text-slate-400"})}switch(e){case"main_hand":case"off_hand":return t.jsx(qe,{className:"h-8 w-8 text-slate-500"});case"armor":case"chest":case"legs":return t.jsx(Ct,{className:"h-8 w-8 text-slate-500"});case"helmet":return t.jsx(Je,{className:"h-8 w-8 text-slate-500"});case"boots":return t.jsx(St,{className:"h-8 w-8 text-slate-500"});case"ring_1":case"ring_2":return t.jsx(gt,{className:"h-8 w-8 text-slate-500"});case"necklace":return t.jsx(Be,{className:"h-8 w-8 text-slate-500"});case"amulet":return t.jsx(Le,{className:"h-8 w-8 text-slate-500"});default:return t.jsx(Ke,{className:"h-8 w-8 text-slate-500"})}},h=e=>{if(!e)return"border-slate-600 bg-slate-800/30";const t={common:"border-slate-600 bg-slate-800/30",uncommon:"border-emerald-600 bg-emerald-900/30",rare:"border-blue-600 bg-blue-900/30",epic:"border-purple-600 bg-purple-900/30",legendary:"border-amber-600 bg-amber-900/30"};return t[e]||t.common},p=(e,s)=>{const r=a[e],n=!r;return t.jsxs("div",{className:"space-y-3",children:[t.jsx("label",{className:"text-sm font-medium text-slate-300 block text-center",children:s}),t.jsxs("div",{className:"relative group",children:[t.jsx(Wa,{variant:"outline",className:`w-full h-32 p-4 border-2 transition-all duration-300 ${n?"border-dashed border-slate-600 bg-gradient-to-br from-slate-800/40 to-slate-900/60 hover:border-slate-500 hover:from-slate-700/50 hover:to-slate-800/70":`${h(r.rarity)} hover:brightness-110 shadow-lg`} hover:scale-[1.02] active:scale-[0.98] select-none`,onMouseDown:()=>c(e),onMouseUp:()=>d(e,r??null),onMouseLeave:m,onTouchStart:()=>c(e),onTouchEnd:()=>d(e,r??null),onTouchCancel:m,onContextMenu:e=>e.preventDefault(),children:t.jsxs("div",{className:"flex flex-col items-center justify-center gap-3 h-full",children:[t.jsx("div",{className:"p-3 rounded-lg "+(n?"bg-slate-700/30":"bg-black/20"),children:u(e,r??null)}),r?t.jsxs("div",{className:"text-center space-y-1",children:[t.jsx("div",{className:"text-sm font-medium text-slate-200 leading-tight max-w-full",children:r.name.length>12?`${r.name.substring(0,12)}...`:r.name}),t.jsx(Nu,{variant:"outline",className:"text-xs px-2 py-0.5",children:r.rarity})]}):t.jsx("div",{className:"text-sm text-slate-500 font-medium",children:"Vazio"})]})}),t.jsx("div",{className:"absolute inset-0 rounded-lg border-2 border-transparent group-active:border-amber-400/50 transition-colors duration-200 pointer-events-none"}),t.jsx("div",{className:"absolute -bottom-2 left-1/2 transform -translate-x-1/2 opacity-0 group-hover:opacity-100 transition-opacity duration-200 z-10",children:t.jsx("div",{className:"bg-slate-900/90 text-slate-300 text-xs px-2 py-1 rounded border border-slate-700/50 shadow-lg whitespace-nowrap",children:n?"Toque e segure para equipar":"Toque para ver detalhes"})})]})]})},x=e=>{const t={0:{slotType:"chest",label:"Peitoral"},1:{slotType:"helmet",label:"Capacete"},2:{slotType:"legs",label:"Pernas"},3:{slotType:"boots",label:"Botas"}}[e];return t?p(t.slotType,t.label):null},f=e=>{const t={0:{slotType:"ring_1",label:"Anel 1"},1:{slotType:"ring_2",label:"Anel 2"},2:{slotType:"necklace",label:"Colar"},3:{slotType:"amulet",label:"Amuleto"}}[e];return t?p(t.slotType,t.label):null};return t.jsxs(pu,{className:"bg-slate-800/50 border-slate-700/50",children:[t.jsx(xu,{children:t.jsxs(fu,{className:"text-slate-100 flex items-center gap-2",children:[t.jsx(De,{className:"h-5 w-5 text-amber-400"}),"Equipamentos"]})}),t.jsxs(bu,{className:"space-y-8",children:[t.jsxs("div",{children:[t.jsx("h3",{className:"text-lg font-semibold text-slate-200 mb-6",children:"Armas"}),t.jsxs("div",{className:"grid grid-cols-2 gap-6",children:[p("main_hand","Mão Principal"),p("off_hand","Mão Secundária")]})]}),t.jsxs("div",{children:[t.jsx("h3",{className:"text-lg font-semibold text-slate-200 mb-6",children:"Armaduras"}),t.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-3 gap-6",children:[p("armor","Escudo"),[0,1,2,3].map((e=>t.jsx("div",{children:x(e)},`armor-slot-${e}`)))]})]}),t.jsxs("div",{children:[t.jsx("h3",{className:"text-lg font-semibold text-slate-200 mb-6",children:"Acessórios"}),t.jsx("div",{className:"grid grid-cols-2 gap-6",children:[0,1,2,3].map((e=>t.jsx("div",{children:f(e)},`accessory-slot-${e}`)))})]}),t.jsxs("div",{className:"bg-slate-700/30 p-4 rounded-lg",children:[t.jsx("p",{className:"text-sm text-slate-400 text-center",children:"Toque para ver detalhes • Toque e segure para selecionar/equipar"}),t.jsx("div",{className:"mt-2 text-xs text-slate-500 text-center",children:"✨ Todos os slots de equipamento estão disponíveis!"})]})]})]})},hf=l("/_authenticated/game/play/hub/equipment")({component:function(){if("/game/play/hub/equipment"===n().pathname)return t.jsx(pf,{});return t.jsx(s,{})},validateSearch:e=>({character:e.character||""})});function pf(){const a=r(),{character:s}=hf.useSearch(),[n,i]=e.useState(null),[o,l]=e.useState([]),[c,d]=e.useState(null),[m,u]=e.useState(null),{equippedSlots:h,loading:p,refresh:x}=function(t){const[a,s]=e.useState([]),[r,n]=e.useState({}),[i,o]=e.useState(!0),[l,c]=e.useState(null),d=e.useCallback((async()=>{if(!t?.trim())return c("ID do personagem não fornecido"),s([]),n({}),void o(!1);o(!0),c(null);try{const e=await gh.getCharacterEquipmentComplete(t);if(!e)throw new Error("Falha ao carregar equipamentos");s(e.allEquipment),n(e.equippedSlots)}catch(e){const t=e instanceof Error?e.message:"Erro ao carregar equipamentos";c(t),s([]),n({})}finally{o(!1)}}),[t]);return e.useEffect((()=>{d()}),[d]),{allEquipment:a,equippedSlots:r,loading:i,error:l,refresh:d}}(s);e.useEffect((()=>{(async()=>{if(s)try{const e=await Nh.getCharacter(s);e.success&&e.data&&i(e.data);const t=await Bx.getCharacterConsumables(s);t.success&&t.data?l(t.data):l([])}catch(e){_.error("Erro ao carregar equipamentos")}})()}),[s]);return p?t.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900 p-4",children:t.jsx("div",{className:"max-w-7xl mx-auto",children:t.jsxs("div",{className:"animate-pulse space-y-6",children:[t.jsx("div",{className:"h-8 bg-slate-700 rounded w-64"}),t.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[t.jsx("div",{className:"h-96 bg-slate-700 rounded"}),t.jsx("div",{className:"h-96 bg-slate-700 rounded"})]})]})})}):n?t.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900 p-4",children:t.jsxs("div",{className:"max-w-7xl mx-auto space-y-6",children:[t.jsx("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-4",children:t.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center gap-2 sm:gap-4",children:[t.jsxs(Wa,{variant:"outline",size:"sm",onClick:()=>a({to:"/game/play/hub",search:{character:s}}),className:"w-fit",children:[t.jsx(Pe,{className:"h-4 w-4 mr-2"}),"Voltar"]}),t.jsxs("div",{className:"mt-2 sm:mt-0",children:[t.jsxs("h1",{className:"text-2xl sm:text-3xl font-bold text-slate-100 flex items-center gap-2",children:[t.jsx(De,{className:"h-6 sm:h-8 w-6 sm:w-8 text-amber-400"}),"Equipamentos"]}),t.jsxs("p",{className:"text-sm sm:text-base text-slate-400",children:[n.name," - Nível ",n.level]})]})]})}),t.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[t.jsxs("div",{className:"space-y-6",children:[t.jsx(uf,{equippedSlots:h,onSlotClick:(e,t)=>{d(e),u(t)},onSlotLongPress:e=>{a({to:"/game/play/hub/equipment/select",search:{character:s,slot:e}})}}),t.jsxs(pu,{className:"bg-slate-800/50 border-slate-700/50",children:[t.jsx(xu,{children:t.jsxs(fu,{className:"text-slate-100 flex items-center gap-2",children:[t.jsx(qe,{className:"h-5 w-5 text-blue-400"}),"Slots de Poções"]})}),t.jsx(bu,{children:t.jsx(lf,{characterId:s,consumables:o,onSlotsUpdate:async()=>{if(!s)return;const e=await Bx.getCharacterConsumables(s);e.success&&e.data&&l(e.data)}})})]})]}),t.jsx("div",{children:t.jsx(mf,{selectedItem:m,selectedSlot:c,character:n,onEquipmentChange:x})})]})]})}):t.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900 p-4",children:t.jsx("div",{className:"max-w-7xl mx-auto",children:t.jsxs("div",{className:"text-center py-12",children:[t.jsx("h1",{className:"text-2xl font-bold text-slate-100 mb-4",children:"Personagem não encontrado"}),t.jsxs(Wa,{onClick:()=>a({to:"/game/play/hub",search:{character:s}}),children:[t.jsx(Pe,{className:"h-4 w-4 mr-2"}),"Voltar ao Hub"]})]})})})}class xf{static calculateAttackSkillXp(e,t){const a=[];if(!e)return a;const s=(r=e,"weapon"===r.main_hand?.type?r.main_hand:void 0);var r;const n=function(e){return!("weapon"!==e.main_hand?.type||"weapon"!==e.off_hand?.type)}(e),i=Math.max(1,Math.floor(t/10));if(s){const e=this.getWeaponSkill(s);if(e){let t=i;n?(t=Math.floor(1.25*t),a.push({skill:e,xp:t,reason:`Ataque com ${s.name} (Dual-wield)`,isOffHand:!1})):a.push({skill:e,xp:t,reason:`Ataque com ${s.name}`,isOffHand:!1})}}if(n&&e.off_hand){const t=this.getWeaponSkill(e.off_hand);if(t){const s=Math.floor(.75*i);a.push({skill:t,xp:s,reason:`Ataque com ${e.off_hand.name} (Mão secundária)`,isOffHand:!0})}}return a}static calculateDefenseSkillXp(e,t=0){let a=Math.max(2,Math.floor(t/5)),s="Ação de defesa";var r;t<=0&&(a=3),e&&(r=e,"armor"===r.off_hand?.type&&!r.off_hand?.weapon_subtype)&&(a=Math.floor(2.5*a),s="Defesa com escudo equipado");const n=Math.max(1,Math.floor(a));return[{skill:ih.DEFENSE_MASTERY,xp:n,reason:s,isOffHand:!1}]}static calculateMagicSkillXp(e,t=0,a=0,s=null){const r=[],n=Math.floor(e/2);let i=0;a>0?i=Math.floor(a/8):t>0&&(i=Math.floor(t/8));const o=Math.max(2,n+i);if(r.push({skill:ih.MAGIC_MASTERY,xp:o,reason:`Uso de magia (${e} mana, ${a||t} efeito)`,isOffHand:!1}),"staff"===s?.off_hand?.weapon_subtype){const e=Math.max(1,Math.floor(.2*o));r.push({skill:ih.MAGIC_MASTERY,xp:e,reason:`Bônus por ${s.off_hand.name} (off-hand)`,isOffHand:!0})}return r}static getWeaponSkill(e){const t=e.name.toLowerCase(),a=[{keywords:["espada","sword","rapier","lâmina","adaga","dagger","punhal","fang"],skill:ih.SWORD_MASTERY},{keywords:["machado","axe","machadinha"],skill:ih.AXE_MASTERY},{keywords:["martelo","mace","clava","maça","porrete","hammer"],skill:ih.BLUNT_MASTERY},{keywords:["cajado","staff","varinha","orbe","bastão","cetro"],skill:ih.MAGIC_MASTERY}];for(const{keywords:s,skill:r}of a)if(s.some((e=>t.includes(e))))return r;return ih.SWORD_MASTERY}static async applySkillXp(e,t){const a=[],s=[];if(0===t.length)return{messages:a,skillLevelUps:s};const{gameState:r,updateGameState:n}=lx.getState(),{setSelectedCharacter:i}=fx.getState();for(const l of t)try{const t=await Nh.addSkillXp(e,l.skill,l.xp);if(t.success&&t.data){const c=this.getSkillDisplayName(l.skill),d=l.isOffHand?" (off-hand)":"";if(t.data.skill_leveled_up){const e=`🎉 ${c} subiu para nível ${t.data.new_skill_level}!${d}`;a.push(e),s.push({skill:l.skill,newLevel:t.data.new_skill_level})}else{const e=`+${l.xp} XP em ${c}${d}`;a.push(e)}if(r.player?.id===e){n((e=>{if(e.player&&t.data){const a=this.getSkillKey(l.skill);if(a&&a in e.player){e.player[a]=t.data.new_skill_level;const s=`${a}_xp`;s in e.player&&(e.player[s]=t.data.new_skill_xp)}}}));try{const t=await Nh.getCharacter(e);t.success&&t.data&&i(t.data)}catch(o){}}}}catch(o){}return{messages:a,skillLevelUps:s}}static getSkillKey(e){return{[ih.SWORD_MASTERY]:"sword_mastery",[ih.AXE_MASTERY]:"axe_mastery",[ih.BLUNT_MASTERY]:"blunt_mastery",[ih.DEFENSE_MASTERY]:"defense_mastery",[ih.MAGIC_MASTERY]:"magic_mastery"}[e]||null}static getSkillDisplayName(e){return{[ih.SWORD_MASTERY]:"Maestria em Espadas",[ih.AXE_MASTERY]:"Maestria em Machados",[ih.BLUNT_MASTERY]:"Maestria em Armas de Concussão",[ih.DEFENSE_MASTERY]:"Maestria em Defesa",[ih.MAGIC_MASTERY]:"Maestria em Magia"}[e]||e}static calculateSkillDamageBonus(e){return Math.min(100,2*e)}static calculateSkillDefenseBonus(e){return Math.min(50,1*e)}static calculateManaEfficiency(e){return Math.min(40,1*e)}static async applySkillXpToCurrentPlayer(e){const{gameState:t}=lx.getState();if(!t.player?.id)return[];return(await this.applySkillXp(t.player.id,e)).messages}static getCurrentPlayerSkillLevels(){const{gameState:e}=lx.getState(),t=e.player;return t?{[ih.SWORD_MASTERY]:t.sword_mastery||1,[ih.AXE_MASTERY]:t.axe_mastery||1,[ih.BLUNT_MASTERY]:t.blunt_mastery||1,[ih.DEFENSE_MASTERY]:t.defense_mastery||1,[ih.MAGIC_MASTERY]:t.magic_mastery||1}:{[ih.SWORD_MASTERY]:1,[ih.AXE_MASTERY]:1,[ih.BLUNT_MASTERY]:1,[ih.DEFENSE_MASTERY]:1,[ih.MAGIC_MASTERY]:1}}}const ff=Object.freeze(Object.defineProperty({__proto__:null,SkillXpService:xf},Symbol.toStringTag,{value:"Module"})),gf=lp()(pp(((e,t)=>({monsterCache:{},loading:{fetchingMonster:!1,loadingDrops:!1},error:null,cacheDuration:3e4,cacheMonster:(t,a)=>{e(ix((e=>{const s=Date.now();e.monsterCache[t]={enemy:{...a,active_effects:a.active_effects||{buffs:[],debuffs:[],dots:[],hots:[],attribute_modifications:[]}},expiry:s+e.cacheDuration}})))},getCachedMonster:a=>{const s=t().monsterCache[a];if(!s)return null;return Date.now()>=s.expiry?(e(ix((e=>{delete e.monsterCache[a]}))),null):s.enemy},clearCache:()=>{e(ix((e=>{e.monsterCache={}})))},setFetchingMonster:t=>{e(ix((e=>{e.loading.fetchingMonster=t})))},setLoadingDrops:t=>{e(ix((e=>{e.loading.loadingDrops=t})))},setError:t=>{e(ix((e=>{e.error=t}))),t&&_.error("Erro ao carregar monstro",{description:t})},setCacheDuration:t=>{e(ix((e=>{e.cacheDuration=t})))}}))));function bf(e,t,a,s="normal"){let r,n,i;switch(1===t?(r=1,n=1+.015*a):(r=Math.pow(1.3,Math.max(0,t-1)),n=1+.025*a),s){case"hp":i=e*r*n*1.1;break;case"attack":default:i=e*r*n;break;case"defense":i=e*r*n*.9}return Math.max(1,Math.floor(i))}function vf(e){const t=Math.max(1,Math.floor(e/20)+1),a=e-20*(t-1),s=Math.max(1,Math.floor(e/3)),r=[5,10,15,20].includes(e)||e>20&&e%10==0,n=function(e,t){let a,s,r,n,i;if(e<=3)1===e?(a=45,s=8,r=2):2===e?(a=55,s=10,r=3):(a=65,s=12,r=4),n=12+2*e,i=18+4*e+Math.floor(8*Math.random());else if(e<=10){const t=e-3;a=75+10*t,s=14+2*t,r=5+t,e<=5?(n=16+3*e,i=25+6*e+Math.floor(12*Math.random())):(n=20+4*e,i=35+8*e+Math.floor(16*Math.random()))}else e<=20?(a=140+15*(e-10),s=28+3*(e-10),r=12+2*(e-10),e<=15?(n=30+6*e,i=50+12*e+Math.floor(20*Math.random())):(n=50+8*e,i=80+15*e+Math.floor(25*Math.random()))):(a=300+25*(e-20),s=60+5*(e-20),r=35+3*(e-20),n=80+12*e,i=120+20*e+Math.floor(30*Math.random()));return t&&(a=Math.floor(1.5*a),s=Math.floor(1.4*s),r=Math.floor(1.3*r),n=Math.floor(2.2*n),i=Math.floor(1.8*i)),{hp:a,atk:s,def:r,rewardXp:n,rewardGold:i}}(e,r),i=function(e,t){if(5===t||t%10==0||Math.random()>.15)return{isNemesis:!1};const a=[{name:"Berserker",description:"Ataque devastador, mas defesa baixa",modifiers:{hp:.8,atk:2.5,def:.4,rewardXp:1.8,rewardGold:1.5}},{name:"Fortress",description:"Defesa impenetrável, mas ataque baixo",modifiers:{hp:2,atk:.6,def:3,rewardXp:1.6,rewardGold:1.3}},{name:"Specter",description:"Muito HP, ataque e defesa normais",modifiers:{hp:3.5,atk:1,def:1,rewardXp:2.2,rewardGold:1.8}},{name:"Assassin",description:"Balanceado mas com stats altos",modifiers:{hp:1.8,atk:1.8,def:1.8,rewardXp:2,rewardGold:1.6}}],s=a[Math.floor(Math.random()*a.length)],r={hp:Math.floor(e.hp*s.modifiers.hp),atk:Math.floor(e.atk*s.modifiers.atk),def:Math.floor(e.def*s.modifiers.def),rewardXp:Math.floor(e.rewardXp*s.modifiers.rewardXp),rewardGold:Math.floor(e.rewardGold*s.modifiers.rewardGold)};return{isNemesis:!0,nemesisType:s.name,modifiedStats:r}}(n,e),o=i.modifiedStats||n,l=i.isNemesis,c=i.nemesisType,d=bf(o.hp,t,a,"hp"),m=bf(o.atk,t,a,"attack"),u=bf(o.def,t,a,"defense"),h=bf(8+s+t,t,a),p=["Slime","Goblin","Orc","Skeleton","Wolf","Spider","Troll","Dragon"],x=["","Greater","Elder","Ancient","Legendary","Mythic","Cosmic","Void"],f=p[Math.floor(a/3)%p.length];let g=f;t>1&&(g=`${t>1&&t<=x.length?x[t-1]:`T${t}`} ${f}`),r?g=`Boss ${g}`:l&&(g=`${c} ${g}`);const b=8+2*t+Math.floor(a/5),v=Math.floor(bf(b,t,a)*(r?1.2:1)),y=Math.floor(bf(.7*b,t,a)*(l?1.2:1)),j=Math.floor(bf(.5*b,t,a)),N=Math.floor(bf(.5*b,t,a)),_=Math.floor(bf(b,t,a)*(r?1.3:1.1)),w=Math.floor(bf(.4*b,t,a)),C=Math.min(.25,.02+.01*t+.003*a),S=Math.min(1.8,1.1+.05*t+.01*a),E=Math.min(.2,.01*t+(r?.08:.03));return{id:crypto.randomUUID(),name:g,level:s,hp:d,maxHp:d,attack:m,defense:u,speed:h,image:r?"👑":l?"💀":"👾",behavior:l?"aggressive":r?"defensive":"balanced",mana:Math.floor((20+4*s+5*t)*(1+.03*a)),reward_xp:o.rewardXp,reward_gold:o.rewardGold,possible_drops:[],active_effects:{buffs:[],debuffs:[],dots:[],hots:[],attribute_modifications:[]},tier:t,base_tier:Math.max(1,Math.floor(e/20)+1),cycle_position:a,is_boss:r,strength:v,dexterity:y,intelligence:j,wisdom:N,vitality:_,luck:w,critical_chance:C,critical_damage:S,critical_resistance:E,physical_resistance:Math.min(.25,.015*t+(r?.05:.02)),magical_resistance:Math.min(.25,.015*t+(l?.05:.02)),debuff_resistance:Math.min(.4,.025*t+(r?.15:.05)),physical_vulnerability:Math.max(.8,1-.01*t),magical_vulnerability:Math.max(.8,1-.01*t),primary_trait:r?"boss":l?"nemesis":t>3?"veteran":"common",secondary_trait:l?c?.toLowerCase():t>5?"ancient":t>2?"experienced":"basic",special_abilities:[...r?["Powerful Strike","Boss Aura"]:[],...l?[`${c} Mastery`]:[],...t>3?["Tier Mastery"]:[],...t>6?["Ancient Power"]:[]]}}class yf{static async getEnemyForFloor(e){if(e<=0)return{data:null,error:`Andar inválido: ${e}`,success:!1};const{getCachedMonster:t,cacheMonster:a,setFetchingMonster:s,setError:r}=gf.getState(),{updateGameState:n}=lx.getState(),i=t(e);if(i)return n((e=>{e.currentEnemy=i})),{data:i,error:null,success:!0};s(!0),r(null);try{let{data:t,error:r}=await Promise.race([Aa.rpc("get_monster_for_floor_with_initiative",{p_floor:e}),new Promise(((e,t)=>setTimeout((()=>t({data:null,error:{message:"Timeout na RPC principal"}})),3e3)))]).catch((e=>({data:null,error:e})));if("42804"===r?.code||r?.message?.includes("does not match function result type")||r?.message?.includes("structure of query does not match")||r){const a=await Promise.race([Aa.rpc("get_monster_for_floor_simple",{p_floor:e}),new Promise(((e,t)=>setTimeout((()=>t({data:null,error:{message:"Timeout alternativo"}})),2e3)))]).catch((e=>({data:null,error:e})));a.data&&!a.error&&(t=a.data,r=a.error)}let i;if(t&&!r){const a=Array.isArray(t)?t[0]:t;i=this.isValidMonsterData(a)?this.convertToEnemyUnified(a,e):vf(e)}else i=vf(e);try{await this.loadPossibleDrops(i)}catch(o){}return a(e,i),n((e=>{e.currentEnemy=i})),s(!1),{data:i,error:null,success:!0}}catch(l){const t=vf(e);return a(e,t),n((e=>{e.currentEnemy=t})),s(!1),{data:t,error:null,success:!0}}}static isValidMonsterData(e){if(!e||"object"!=typeof e)return!1;const t=["hp","attack","defense","level"];for(const a of t){const t=e[a];if("number"!=typeof t||t<=0)return!1}return!(!e.name||"string"!=typeof e.name)}static convertToEnemyUnified(e,t){const a=Math.max(1,Math.floor(t/20)+1),s=(t-1)%20+1,r=5===t||t%10==0,n="string"==typeof e.id?e.id:crypto.randomUUID(),i="string"==typeof e.name?e.name:`Monster Floor ${t}`,o="number"==typeof e.level?e.level:Math.max(1,Math.floor(t/3)),l="number"==typeof e.hp&&e.hp>0?e.hp:vf(t).hp,c="number"==typeof e.attack&&e.attack>0?e.attack:vf(t).attack,d="number"==typeof e.defense&&e.defense>=0?e.defense:vf(t).defense,m="number"==typeof e.speed&&e.speed>0?e.speed:vf(t).speed,u="number"==typeof e.reward_xp?e.reward_xp:50,h="number"==typeof e.reward_gold?e.reward_gold:25,p=Math.floor(u*(t<=10?.4:.3)),x=Math.floor(h*(t<=10?.4:.3));var f;return{id:n,name:i,level:o,hp:l,maxHp:l,attack:c,defense:d,speed:m,image:r?"👑":"👾",behavior:"string"==typeof e.behavior&&(f=e.behavior,["aggressive","defensive","balanced"].includes(f))?e.behavior:"balanced",mana:"number"==typeof e.mana?e.mana:Math.floor(5*o),reward_xp:p,reward_gold:x,possible_drops:[],active_effects:{buffs:[],debuffs:[],dots:[],hots:[],attribute_modifications:[]},tier:a,base_tier:Math.max(1,Math.floor(t/20)+1),cycle_position:s,is_boss:r,strength:"number"==typeof e.strength?e.strength:10+o,dexterity:"number"==typeof e.dexterity?e.dexterity:8+o,intelligence:"number"==typeof e.intelligence?e.intelligence:6+o,wisdom:"number"==typeof e.wisdom?e.wisdom:6+o,vitality:"number"==typeof e.vitality?e.vitality:12+o,luck:"number"==typeof e.luck?e.luck:5+o,critical_chance:"number"==typeof e.critical_chance?Math.min(.5,e.critical_chance):.05+.005*o,critical_damage:"number"==typeof e.critical_damage?e.critical_damage:1.5+.05*o,critical_resistance:"number"==typeof e.critical_resistance?Math.min(.5,e.critical_resistance):.1,physical_resistance:"number"==typeof e.physical_resistance?Math.max(0,Math.min(.9,e.physical_resistance)):0,magical_resistance:"number"==typeof e.magical_resistance?Math.max(0,Math.min(.9,e.magical_resistance)):0,debuff_resistance:"number"==typeof e.debuff_resistance?Math.max(0,Math.min(.9,e.debuff_resistance)):0,physical_vulnerability:"number"==typeof e.physical_vulnerability?Math.max(.5,Math.min(3,e.physical_vulnerability)):1,magical_vulnerability:"number"==typeof e.magical_vulnerability?Math.max(.5,Math.min(3,e.magical_vulnerability)):1,primary_trait:"string"==typeof e.primary_trait?e.primary_trait:r?"boss":"common",secondary_trait:"string"==typeof e.secondary_trait?e.secondary_trait:"basic",special_abilities:Array.isArray(e.special_abilities)?e.special_abilities.filter((e=>"string"==typeof e)):[]}}static async loadPossibleDrops(e){const{setLoadingDrops:t,setError:a}=gf.getState();t(!0);try{const{data:t,error:s}=await Aa.rpc("get_monster_possible_drops_with_info",{p_monster_id:e.id});if(s)return void a(`Drops não carregados: ${s.message}`);t&&Array.isArray(t)&&(e.possible_drops=t.map((e=>({drop_id:e.drop_id,drop_chance:e.drop_chance,min_quantity:e.min_quantity,max_quantity:e.max_quantity,drop_info:{id:e.drop_id,name:e.drop_name,description:e.drop_description,rarity:e.rarity,value:e.value}}))))}catch(s){a(`Drops não carregados: ${s instanceof Error?s.message:"Erro ao carregar drops"}`)}finally{t(!1)}}static updateCurrentEnemy(e){const{updateGameState:t}=lx.getState();t((t=>{t.currentEnemy=e}))}static getCurrentEnemy(){return lx.getState().gameState.currentEnemy}static clearCache(){const{clearCache:e}=gf.getState();e()}static isEnemyCached(e){const{getCachedMonster:t}=gf.getState();return null!==t(e)}static async preloadNearbyFloors(e,t=2){const a=[];for(let s=e+1;s<=e+t;s++)this.isEnemyCached(s)||a.push(this.getEnemyForFloor(s));a.length>0&&await Promise.allSettled(a)}}const jf=Object.freeze(Object.defineProperty({__proto__:null,MonsterService:yf},Symbol.toStringTag,{value:"Module"})),Nf=lp()(pp(((e,t)=>({isProcessingAction:!1,lastActionTimestamp:0,lastAction:"",currentTurnType:null,battlePhase:"idle",actionQueue:[],currentBattleId:null,turnCount:0,showPlayerActionFeedback:!1,showEnemyActionFeedback:!1,lastPlayerActionMessage:"",lastEnemyActionMessage:"",performAction:async(a,s,r)=>{const n=t(),i=lx.getState(),o=i.gameState;if(!o.player)return;if(n.isProcessingAction)return;if("gameover"===o.mode)return;const l=Date.now(),c=l-n.lastActionTimestamp;if(!(n.lastAction===a&&c<2e3||c<500)){e(ix((e=>{e.isProcessingAction=!0,e.lastActionTimestamp=l,e.lastAction=a,e.battlePhase="processing"}))),i.updateLoading("performAction",!0);try{await t().processPlayerTurn(a,s,r)}catch(d){t().resetBattleState()}}},processPlayerTurn:async(a,s,r)=>{const n=lx.getState(),i=px.getState(),o=n.gameState,l=(e,t)=>{i.addGameLogMessage(e,t)};try{e(ix((e=>{e.currentTurnType="player",e.battlePhase="player_action"})));const i=await Lf.processPlayerAction(a,o,s,r),{newState:d,skipTurn:m,message:h,skillXpGains:p,gameLogMessages:x}=i;if(x?.length&&x.forEach((e=>{l(e.message,e.type)})),p?.length&&o.player?.id)try{const{messages:e,skillLevelUps:t}=await u((async()=>{const{messages:e,skillLevelUps:t}=await Promise.resolve().then((()=>ff));return{messages:e,skillLevelUps:t}}),void 0).then((e=>e.SkillXpService.applySkillXp(o.player.id,p)));for(const a of e)a.includes("subiu para nível")?l(a,"level_up"):l(a,"skill_xp");for(const a of t){const e=await u((()=>Promise.resolve().then((()=>ff))),void 0).then((e=>e.SkillXpService.getSkillDisplayName(a.skill)));l(`🎉 ${e} subiu para nível ${a.newLevel}!`,"level_up")}}catch(c){l("Erro ao aplicar experiência de habilidade","system")}if(n.setGameState(d),e(ix((e=>{e.showPlayerActionFeedback=!0,e.lastPlayerActionMessage=h}))),h&&h.trim()){l(h,"attack"===a||"defend"===a||"spell"===a?"player_action":"system")}if("flee"===a&&(!0===d.fleeSuccessful||"fled"===d.mode))return l(h,"system"),void t().endBattle();if(m)return l(h,"system"),void t().endBattle();if(d.currentEnemy&&d.currentEnemy.hp<=0){const e=await Lf.processEnemyDefeat();return n.setGameState(e),l(`${d.currentEnemy.name} foi derrotado!`,"battle"),void t().endBattle()}if("continue"===a&&null===d.battleRewards&&d.currentEnemy||"interact_event"===a&&"battle"===d.mode&&d.currentEnemy)return l(h,"system"),void t().endBattle();m||!d.currentEnemy||d.fleeSuccessful?t().endBattle():setTimeout((()=>{t().processEnemyTurn(a,"defend"===a)}),1e3)}catch(d){throw l("Erro durante ação do jogador","system"),d}},processEnemyTurn:async(a,s)=>{const r=lx.getState(),n=px.getState(),i=r.gameState,o=(e,t)=>{n.addGameLogMessage(e,t)};try{e(ix((e=>{e.currentTurnType="enemy",e.battlePhase="enemy_action",e.showPlayerActionFeedback=!1}))),r.updateGameState((e=>{e.isPlayerTurn=!1}));const a=await Lf.processEnemyActionWithDelay(i,s,1500),{newState:n,skillXpGains:c}=a;if(c?.length&&i.player?.id)try{const{messages:e,skillLevelUps:t}=await u((async()=>{const{messages:e,skillLevelUps:t}=await Promise.resolve().then((()=>ff));return{messages:e,skillLevelUps:t}}),void 0).then((e=>e.SkillXpService.applySkillXp(i.player.id,c)));for(const a of e)a.includes("subiu para nível")?o(a,"level_up"):o(a,"skill_xp");for(const a of t){const e=await u((()=>Promise.resolve().then((()=>ff))),void 0).then((e=>e.SkillXpService.getSkillDisplayName(a.skill)));o(`🎉 ${e} subiu para nível ${a.newLevel}!`,"level_up")}}catch(l){}if("gameover"===n.mode)return r.setGameState(n),o("Você foi derrotado!","battle"),void t().endBattle();if(i.player?.id&&await Nh.updateCharacterHpMana(i.player.id,n.player.hp,n.player.mana),n.gameMessage?.trim()){const t=n.gameMessage.includes("causou")&&n.gameMessage.includes("dano")?"damage":"enemy_action";o(n.gameMessage,t),e(ix((e=>{e.showEnemyActionFeedback=!0,e.lastEnemyActionMessage=n.gameMessage})))}r.setGameState({...n,isPlayerTurn:!0}),e(ix((e=>{e.turnCount+=1}))),t().endBattle()}catch(c){o("Erro durante turno do inimigo","system"),t().endBattle()}},startBattle:t=>{e(ix((e=>{e.currentBattleId=t||`battle-${Date.now()}`,e.battlePhase="idle",e.currentTurnType="player",e.turnCount=0,e.isProcessingAction=!1,e.actionQueue=[],e.showPlayerActionFeedback=!1,e.showEnemyActionFeedback=!1})))},endBattle:()=>{const t=lx.getState();e(ix((e=>{e.isProcessingAction=!1,e.battlePhase="ended",e.currentTurnType=null,e.showPlayerActionFeedback=!1,e.showEnemyActionFeedback=!1}))),t.updateLoading("performAction",!1),setTimeout((()=>{e(ix((e=>{e.battlePhase="idle",e.currentBattleId=null})))}),2e3)},resetBattleState:()=>{const t=lx.getState();e(ix((e=>{e.isProcessingAction=!1,e.lastActionTimestamp=0,e.lastAction="",e.currentTurnType=null,e.battlePhase="idle",e.actionQueue=[],e.currentBattleId=null,e.turnCount=0,e.showPlayerActionFeedback=!1,e.showEnemyActionFeedback=!1,e.lastPlayerActionMessage="",e.lastEnemyActionMessage=""}))),t.updateLoading("performAction",!1)},setTurnType:t=>{e(ix((e=>{e.currentTurnType=t})))},setBattlePhase:t=>{e(ix((e=>{e.battlePhase=t})))},incrementTurnCount:()=>{e(ix((e=>{e.turnCount+=1})))},setPlayerActionFeedback:(t,a="")=>{e(ix((e=>{e.showPlayerActionFeedback=t,a&&(e.lastPlayerActionMessage=a)})))},setEnemyActionFeedback:(t,a="")=>{e(ix((e=>{e.showEnemyActionFeedback=t,a&&(e.lastEnemyActionMessage=a)})))},setProcessingAction:t=>{e(ix((e=>{e.isProcessingAction=t})))},updateLastAction:(t,a)=>{e(ix((e=>{e.lastAction=t,e.lastActionTimestamp=a})))},clearActionQueue:()=>{e(ix((e=>{e.actionQueue=[]})))}}))));class _f{static clearAllGameCaches(){try{const e=lx.getState(),t=fx.getState(),a=Nf.getState(),s=px.getState();e.resetGameState(),t.setSelectedCharacter(null),a.resetBattleState(),s.clearAllLogs()}catch(e){}Promise.all([u((()=>Promise.resolve().then((()=>Tf))),void 0).then((e=>e.FloorService.clearCache())),u((()=>Promise.resolve().then((()=>jf))),void 0).then((e=>e.MonsterService.clearCache()))]).catch((e=>{}))}static clearCharacterCache(e){}static clearUserCache(e){try{const t=fx.getState(),a=lx.getState(),s=px.getState();t.selectedCharacter?.user_id===e&&(t.setSelectedCharacter(null),a.resetGameState()),s.clearAllLogs()}catch(t){}}static clearStoresOnly(){try{const e=lx.getState(),t=fx.getState(),a=Nf.getState(),s=px.getState();e.resetGameState(),t.setSelectedCharacter(null),a.resetBattleState(),s.clearAllLogs()}catch(e){}}static getStoresDebugInfo(){try{const e=lx.getState(),t=fx.getState(),a=Nf.getState(),s=px.getState();return{gameState:{mode:e.gameState.mode,hasPlayer:Boolean(e.gameState.player),hasEnemy:Boolean(e.gameState.currentEnemy)},character:{hasSelected:Boolean(t.selectedCharacter),selectedName:t.selectedCharacter?.name},battle:{isProcessing:a.isProcessingAction,phase:a.battlePhase},logs:{count:s.gameLogs.length}}}catch(e){return{gameState:{mode:"error",hasPlayer:!1,hasEnemy:!1},character:{hasSelected:!1},battle:{isProcessing:!1,phase:"error"},logs:{count:0}}}}}class wf{static async killCharacter(e,t="Battle defeat",a){try{const s=fx.getState(),r=lx.getState(),n=px.getState(),i=e||s.selectedCharacter?.id;if(!i)throw new Error("Nenhum personagem especificado para morte");const o=s.selectedCharacter?.name||"Personagem";n.addGameLogMessage(`💀 ${o} morreu: ${this.formatDeathCause(t,a)}`,"system");const{data:l,error:c}=await Aa.rpc("process_character_death_simple",{p_character_id:i,p_death_cause:t,p_killed_by_monster:a||null});if(c)throw c;s.selectedCharacter?.id===i&&(r.updateGameState((e=>{e.mode="gameover",e.characterDeleted=!0,e.gameMessage=`${o} morreu e foi enviado ao cemitério.`})),setTimeout((()=>{s.setSelectedCharacter(null),_f.clearStoresOnly()}),3e3));const d=Array.isArray(l)&&l.length>0?l[0]:null;return{success:!0,data:d?.success||!1?"character_moved_to_cemetery":"unknown",error:null}}catch(s){return px.getState().addGameLogMessage(`❌ Erro ao processar morte do personagem: ${s instanceof Error?s.message:"Erro desconhecido"}`,"system"),{success:!1,data:null,error:s instanceof Error?s.message:"Erro desconhecido ao matar personagem"}}}static async killSelectedCharacter(e="Battle defeat",t){const a=fx.getState().selectedCharacter;return a?this.killCharacter(a.id,e,t):{success:!1,data:null,error:"Nenhum personagem selecionado para morte"}}static async getUserCemetery(e,t={}){try{const a=px.getState(),s=e;if(!s)throw new Error("ID do usuário é obrigatório para buscar cemitério");const{page:r=1,limit:n=10}=t,i=(r-1)*n;a.addGameLogMessage(`🪦 Consultando cemitério (página ${r})`,"system");const{data:o,error:l}=await Aa.rpc("get_user_cemetery",{p_user_id:s,p_limit:n,p_offset:i});if(l)throw l;const{data:c,error:d}=await Aa.rpc("count_user_cemetery",{p_user_id:s});if(d)throw d;const{data:m,error:u}=await Aa.rpc("get_cemetery_stats",{p_user_id:s});if(u)throw u;const h=o,p=c,x=m?.[0]||{total_deaths:0,highest_level_reached:0,highest_floor_reached:0,total_survival_time_hours:0,most_common_death_cause:"N/A",deadliest_monster:"N/A"},f=i+h.length<p;return a.addGameLogMessage(`📊 Cemitério carregado: ${h.length} personagens, ${p} total`,"system"),{success:!0,data:{characters:h,total:p,stats:x,hasMore:f},error:null}}catch(a){return{success:!1,data:null,error:a instanceof Error?a.message:"Erro ao buscar cemitério"}}}static async getCemeteryStats(e){try{const{data:t,error:a}=await Aa.rpc("get_cemetery_stats",{p_user_id:e});if(a)throw a;return{success:!0,data:t?.[0]||{total_deaths:0,highest_level_reached:0,highest_floor_reached:0,total_survival_time_hours:0,most_common_death_cause:"N/A",deadliest_monster:"N/A"},error:null}}catch(t){return{success:!1,data:null,error:t instanceof Error?t.message:"Erro ao buscar estatísticas"}}}static async hasCemetery(e){try{const{data:t,error:a}=await Aa.rpc("count_user_cemetery",{p_user_id:e});if(a)throw a;return{success:!0,data:t>0,error:null}}catch(t){return{success:!1,data:!1,error:t instanceof Error?t.message:"Erro ao verificar cemitério"}}}static formatSurvivalTime(e){if(e<60)return`${e} min`;if(e<1440){const t=Math.floor(e/60),a=e%60;return a>0?`${t}h ${a}min`:`${t}h`}{const t=Math.floor(e/1440),a=Math.floor(e%1440/60);return a>0?`${t}d ${a}h`:`${t}d`}}static formatDeathCause(e,t){return{"Battle defeat":t?`Morto por ${t}`:"Morto em batalha","Player quit":"Abandonou a jornada","System error":"Erro do sistema"}[e]||e}static isSelectedCharacterDead(){try{const e=lx.getState();return"gameover"===e.gameState.mode&&Boolean(e.gameState.characterDeleted)}catch(e){return!1}}static async getQuickCemeteryInfo(e){try{const t=await this.getCemeteryStats(e);return t.success&&t.data?{totalDeaths:t.data.total_deaths,highestLevel:t.data.highest_level_reached,deadliestMonster:t.data.deadliest_monster}:{totalDeaths:0,highestLevel:0,deadliestMonster:"N/A"}}catch(t){return{totalDeaths:0,highestLevel:0,deadliestMonster:"N/A"}}}}class Cf{static validateNumber(e,t=0,a,s){let r=Number(e);return!isNaN(r)&&isFinite(r)&&null!=e||(r=t),void 0!==a&&(r=Math.max(a,r)),void 0!==s&&(r=Math.min(s,r)),Math.floor(r)}static validateHP(e,t){const a=this.validateNumber(t,1,1);return this.validateNumber(e,1,0,a)}static validateMana(e,t){const a=this.validateNumber(t,1,0);return this.validateNumber(e,0,0,a)}static validateAttack(e){return this.validateNumber(e,1,1)}static validateDefense(e){return this.validateNumber(e,0,0)}static validateSpeed(e){return this.validateNumber(e,1,1)}static validatePlayerStats(e){return{...e,hp:this.validateHP(e.hp,e.max_hp),max_hp:this.validateNumber(e.max_hp,1,1),mana:this.validateMana(e.mana,e.max_mana),max_mana:this.validateNumber(e.max_mana,1,0),atk:this.validateAttack(e.atk),def:this.validateDefense(e.def),speed:this.validateSpeed(e.speed),level:this.validateNumber(e.level,1,1),xp:this.validateNumber(e.xp,0,0),gold:this.validateNumber(e.gold,0,0),floor:this.validateNumber(e.floor,1,1)}}static validateEnemyStats(e){return{...e,hp:this.validateHP(e.hp,e.maxHp),maxHp:this.validateNumber(e.maxHp,1,1),attack:this.validateAttack(e.attack),defense:this.validateDefense(e.defense),speed:this.validateSpeed(e.speed),level:this.validateNumber(e.level,1,1),mana:this.validateNumber(e.mana,0,0),reward_xp:this.validateNumber(e.reward_xp,1,0),reward_gold:this.validateNumber(e.reward_gold,0,0)}}static logValidation(e,t,a){Number(t)!==a||isNaN(Number(t))}}class Sf{static logs=[];static MAX_LOGS=100;static currentBattleId=null;static startBattle(e,t){this.currentBattleId&&this.endBattle("error",{reason:"Batalha interrompida por nova inicialização"}),this.clearOldLogs();const a=`battle_${e}_${t}_${Date.now()}`;return this.currentBattleId=a,this.log("info","BattleLogger","=== NOVA BATALHA INICIADA ===",{battleId:a,playerId:e,floorNumber:t,timestamp:(new Date).toISOString()}),a}static endBattle(e,t){this.currentBattleId&&(this.log("info","BattleLogger",`=== BATALHA FINALIZADA: ${e.toUpperCase()} ===`,{battleId:this.currentBattleId,result:e,details:t,timestamp:(new Date).toISOString()}),this.currentBattleId=null)}static log(e,t,a,s){const r={timestamp:Date.now(),battleId:this.currentBattleId,service:t,level:e,message:a,data:s};this.logs.push(r),this.logs.length>this.MAX_LOGS&&this.logs.shift();const n=`${this.currentBattleId?`[${this.currentBattleId}]`:""}[${t}] ${a}`;({debug:console.debug,info:console.log,warn:console.warn,error:console.error})[e](n,s)}static logPlayerAction(e,t){this.log("info","PlayerAction",`Jogador executou: ${e}`,t)}static logEnemyAction(e,t){this.log("info","EnemyAction",`Inimigo executou: ${e}`,t)}static logDamage(e,t,a,s,r){this.log("info","Damage",`${e} causou ${a} de dano ${s} em ${t}`,{source:e,target:t,damage:a,type:s,...r})}static logStateChange(e,t,a){this.log("info","StateChange",`Estado mudou de ${e} para ${t}`,a)}static logError(e,t,a){this.log("error",e,`Erro: ${t instanceof Error?t.message:t}`,{error:t instanceof Error?t.stack:t,context:a})}static logPerformance(e,t,a,s){this.log("debug","Performance",`${e}.${t} levou ${a}ms`,s)}static getCurrentBattleLogs(){return this.currentBattleId?this.logs.filter((e=>e.battleId===this.currentBattleId)):[]}static getAllLogs(){return[...this.logs]}static getLogStats(){const e=this.getCurrentBattleLogs();return{totalLogs:this.logs.length,currentBattleLogs:e.length,errorCount:this.logs.filter((e=>"error"===e.level)).length,warnCount:this.logs.filter((e=>"warn"===e.level)).length,currentBattleId:this.currentBattleId}}static exportCurrentBattleLogs(){const e=this.getCurrentBattleLogs();return JSON.stringify(e,null,2)}static clearOldLogs(){this.currentBattleId?this.logs=this.logs.filter((e=>e.battleId===this.currentBattleId)):this.logs=[],this.log("info","BattleLogger","Logs antigos foram limpos")}}const Ef=Object.freeze(Object.defineProperty({__proto__:null,BattleLoggerService:Sf},Symbol.toStringTag,{value:"Module"}));class kf{static logStore=px.getState();static logGameEvent(e,t){const{message:a,type:s,metadata:r={},importance:n="normal"}=e;Sf.log("critical"===n?"error":"high"===n?"warn":"info","GameEvent",a,{type:s,...r,...t}),this.logStore.addGameLogMessage(a,s,{...r,...t})}static logPlayerAction(e,t,a){this.logGameEvent({message:`${t} ${e}`,type:"player_action",importance:"normal"},a)}static logPlayerAttack(e,t,a,s=!1,r=!1,n){let i="";r&&(i+="ataque duplo "),s&&(i+="CRÍTICO ");const o=`${e} ${i}atacou ${t} causando ${a} de dano!`;this.logGameEvent({message:o,type:"player_action",importance:s?"high":"normal",metadata:{damage:a,isCritical:s,isDoubleAttack:r}},{playerName:e,enemyName:t,damage:a,...n}),this.logDamage("player","enemy",a,s?"critical":"physical",{playerName:e,enemyName:t,...n})}static logEnemyAction(e,t,a){this.logGameEvent({message:`${t} ${e}`,type:"enemy_action",importance:"normal"},a)}static logEnemyAttack(e,t,a,s=!1,r=!1,n){let i="";i=r?`${e} usou uma habilidade especial`:`${e} atacou ${t}`,i+=s?` mas o dano foi reduzido para ${a}`:` causando ${a} de dano`,i+="!",this.logGameEvent({message:i,type:"enemy_action",importance:r?"high":"normal",metadata:{damage:a,wasDefended:s,isSpecial:r}},{enemyName:e,playerName:t,damage:a,...n}),this.logDamage("enemy","player",a,r?"special":"physical",{enemyName:e,playerName:t,...n})}static logSpellCast(e,t,a,s,r,n){let i="";switch(r){case"damage":i=`causando ${s} de dano mágico`;break;case"heal":i=`restaurando ${s} de vida`;break;case"buff":i="aplicando efeito positivo";break;case"debuff":i="aplicando efeito negativo"}const o=`${e} lançou ${t} em ${a}, ${i}!`;this.logGameEvent({message:o,type:"player_action",importance:"damage"===r&&s>100?"high":"normal",metadata:{spellName:t,effectValue:s,effectType:r}},{spellName:t,...n})}static logConsumableUse(e,t,a,s,r){let n=`${e} usou ${t}`;if(s){n+=` (${this.getKeyBinding(s)})`}n+=` - ${a}!`,this.logGameEvent({message:n,type:"player_action",importance:"normal",metadata:{consumableName:t,effect:a,slotPosition:s}},{playerName:e,consumableName:t,...r})}static logXpGain(e,t,a,s,r){let n="";n="skill"===a&&s?`${e} ganhou ${t} XP em ${s}!`:`${e} ganhou ${t} XP!`,this.logGameEvent({message:n,type:"skill"===a?"skill_xp":"system",importance:t>=100?"high":"normal",metadata:{xpAmount:t,source:a,skillName:s}},{playerName:e,xpGained:t,skillName:s,...r})}static logLevelUp(e,t,a,s){const r=`🎉 ${e} subiu para o nível ${t}!`;this.logGameEvent({message:r,type:"level_up",importance:"critical",metadata:{newLevel:t,oldLevel:a}},{playerName:e,levelBefore:a,levelAfter:t,...s})}static logDamage(e,t,a,s,r){Sf.logDamage(e,t,a,s,r)}static logHealing(e,t,a,s,r){const n=`${e} ${e===t?"recuperou":`curou ${t}, restaurando`} ${a} de vida!`;this.logGameEvent({message:n,type:"healing",importance:"normal",metadata:{healAmount:a,source:s}},{healing:a,...r})}static logBattleStart(e,t,a,s){const r=`Batalha iniciada: ${e} vs ${t} (Andar ${a})`;this.clearUILogs(),Sf.startBattle(e,a),this.logGameEvent({message:r,type:"battle",importance:"high",metadata:{playerName:e,enemyName:t,floorNumber:a}},{playerName:e,enemyName:t,floorNumber:a,...s})}static logBattleEnd(e,t,a,s,r){let n="";switch(e){case"victory":n=`✅ ${t} venceu a batalha!`,s&&(n+=` (+${s.xp} XP, +${s.gold} gold)`);break;case"defeat":n=`💀 ${t} foi derrotado...`;break;case"flee":n=`🏃 ${t} fugiu da batalha!`}Sf.endBattle(e,{rewards:s,...r}),this.logGameEvent({message:n,type:"victory"===e?"battle":"system",importance:"defeat"===e?"critical":"high",metadata:{result:e,rewards:s}},{playerName:t,enemyName:a,...s,...r}),"victory"===e&&s&&this.logBattleRewards(t,s.xp,s.gold,s.drops,r)}static logBattleRewards(e,t,a,s,r){if(t>0&&this.logXpGain(e,t,"combat",void 0,r),a>0&&this.logGameEvent({message:`${e} obteve ${a} moedas de ouro!`,type:"system",importance:"normal",metadata:{goldGained:a}},{playerName:e,goldGained:a,...r}),s.length>0)for(const n of s)this.logGameEvent({message:`${e} obteve ${n.quantity}x ${n.name}!`,type:"system",importance:"normal",metadata:{dropName:n.name,dropQuantity:n.quantity}},{playerName:e,dropsObtained:s,...r})}static logSpecialEvent(e,t,a){this.logGameEvent({message:t,type:"system",importance:{flee_success:"normal",flee_failure:"normal",critical_hit:"high",level_checkpoint:"high",rare_drop:"critical",boss_encounter:"critical"}[e],metadata:{eventType:e}},a)}static logBattleError(e,t,a){Sf.logError("BattleSystem",e,{context:t,...a});const s=t?`⚠️ Erro [${t}]: ${e}`:`⚠️ Erro: ${e}`;this.logGameEvent({message:s,type:"system",importance:"critical",metadata:{error:e,context:t}},a)}static getKeyBinding(e){return{1:"Q",2:"W",3:"E"}[e]||`Slot ${e}`}static updateStoreReference(){this.logStore=px.getState()}static getBattleLogStats(){return Sf.getLogStats()}static exportCurrentBattleLogs(){return Sf.exportCurrentBattleLogs()}static clearOldLogs(){Sf.clearOldLogs()}static clearUILogs(){px.getState().clearAllLogs()}static clearAllLogs(){this.clearOldLogs(),this.clearUILogs()}}const Af=Object.freeze(Object.defineProperty({__proto__:null,LoggingUtils:kf},Symbol.toStringTag,{value:"Module"}));class Pf{static async processPlayerActionFromStores(e,t,a){const s=Nf.getState();try{if(s.setProcessingAction(!0),s.isProcessingAction)return!1;const r=await this.processPlayerAction(e,void 0,t,a);return Sf.log("info","BattleService",`Ação processada via stores: ${e}`,{success:!0,skipTurn:r.skipTurn}),!0}catch(r){return Sf.logError("BattleService",r,{action:e,spellId:t,consumableId:a}),!1}finally{s.setProcessingAction(!1)}}static calculateInitiative(e,t){const a=e,s=Math.floor(.5*t),r=.9+.2*Math.random(),n=Math.floor((a+s)*r);return Math.max(1,n)}static calculateExtraTurns(e,t){if(t<=0)return 2;const a=e/t;let s=0;return a>=3.5?s=3:a>=2.5?s=2:a>=1.8&&(s=1),s<3&&Math.random()<.2&&(s+=1),Math.min(s,3)}static calculateDamage(e,t,a=10,s=10){const r=hh.calculateEffectiveStats(e),n=hh.calculateEffectiveStats(t),i=r.atk||0,o=n.def||0,l=r.critical_chance||0,c=r.critical_damage||110;if(i<=0)return{damage:1,isCritical:!1,isDoubleAttack:!1,totalAttacks:1,damageBreakdown:"Dano mínimo: 1"};const d=Math.max(1,Math.floor(i-.5*o)),m=100*Math.random()<l,u=(("double_attack_chance"in e?e.double_attack_chance:0)||0)+Math.floor(.5*(a-10))+Math.floor(.3*(s-10)),h=100*Math.random()<Math.min(35,u);let p=d,x=`Base: ${d}`;if(m){const e=c/100;p=Math.floor(p*e),x+=` → Crítico (${c}%): ${p}`}let f=1;return h&&(p*=2,f=2,x+=` → Duplo Ataque (DEX: ${a}, SPD: ${s}): ${p}`),{damage:p,isCritical:m,isDoubleAttack:h,totalAttacks:f,damageBreakdown:x}}static async processPlayerAction(e,t,a,s){const r=lx.getState(),n=px.getState(),i=t||r.gameState;Sf.logPlayerAction(e,{spellId:a,consumableId:s});const o={...i,player:{...i.player},currentEnemy:i.currentEnemy?{...i.currentEnemy}:null},l=[],c=[];let d=!1,m="",u=0;if(o.player.active_effects){const e=bh.processOverTimeEffects(o.player);e.length>0&&l.push(...e.map((e=>({message:e,type:"system"}))))}if(o.currentEnemy?.active_effects){const e=bh.processOverTimeEffects(o.currentEnemy);e.length>0&&l.push(...e.map((e=>({message:e,type:"system"}))))}switch(e){case"attack":if(o.currentEnemy&&o.currentEnemy.hp>0){const e=await this.getPlayerEquipmentSlots(o.player.id),t=this.calculateDamage(o.player,o.currentEnemy,o.player.dexterity||10,o.player.speed||10);u=t.damage;const a=t.isCritical,s=t.isDoubleAttack,r=t.totalAttacks;o.currentEnemy.hp=Math.max(0,o.currentEnemy.hp-u),o.player.isDefending&&(o.player.isDefending=!1),d=!1;let n=`${o.player.name} atacou ${o.currentEnemy.name}`;if(s&&(n+=` com duplo ataque (${r}x)`),a&&(n+=" causando dano crítico"),n+=` causando ${u} de dano!`,l.push({message:n,type:"player_action"}),s&&a?l.push({message:`💥 Duplo ataque crítico! ${u} de dano total!`,type:"damage"}):s?l.push({message:`⚔️ Duplo ataque! ${u} de dano total!`,type:"damage"}):a?l.push({message:`💥 Ataque crítico! ${u} de dano!`,type:"damage"}):l.push({message:`⚔️ ${u} de dano causado`,type:"damage"}),e){const t=xf.calculateAttackSkillXp(e,u);if(t.length>0){c.push(...t);for(const e of t){const t=xf.getSkillDisplayName(e.skill);l.push({message:`+${e.xp} XP em ${t}${e.isOffHand?" (off-hand)":""}`,type:"skill_xp"})}}}if(o.currentEnemy.hp<=0)l.push({message:`${o.currentEnemy.name} foi derrotado!`,type:"system"}),m=`Você derrotou ${o.currentEnemy.name}!`;else{let e="";s&&(e+="duplo "),a&&(e+="crítico "),m=`Ataque ${e}realizado com sucesso!`}}break;case"defend":if(0===o.player.defenseCooldown){o.player.isDefending=!0,o.player.defenseCooldown=3,d=!1;const e=`${o.player.name} assumiu postura defensiva.`;l.push({message:e,type:"player_action"});const t=await this.getPlayerEquipmentSlots(o.player.id);if(t){const e=xf.calculateDefenseSkillXp(t,0);if(e.length>0){c.push(...e);for(const t of e){const e=xf.getSkillDisplayName(t.skill);l.push({message:`+${t.xp} XP em ${e}`,type:"skill_xp"})}}}m=e}else{const e=`Defesa está em cooldown por mais ${o.player.defenseCooldown} turnos.`;l.push({message:e,type:"system"}),m=e,d=!0}break;case"spell":if(a){const e=o.player.spells.find((e=>e.id===a));if(e&&o.player.mana>=e.mana_cost&&0===e.current_cooldown){o.player.mana=Math.max(0,o.player.mana-e.mana_cost),o.player.spells=o.player.spells.map((e=>e.id===a?{...e,current_cooldown:e.cooldown}:{...e}));let t="";const s=0,r="damage"===e.effect_type?o.currentEnemy:o.player;if(r){const a=bh.applySpellEffect(e,o.player,r);if(a.success){d=a.endsTurn,t=a.message,m=t,l.push({message:`${o.player.name} lançou ${e.name}`,type:"player_action"}),l.push({message:t,type:"damage"===e.effect_type?"damage":"system"});const r=await this.getPlayerEquipmentSlots(o.player.id),n=xf.calculateMagicSkillXp(e.mana_cost,"damage"===e.effect_type?e.effect_value:0,s,r);if(n.length>0){c.push(...n);for(const e of n){const t=xf.getSkillDisplayName(e.skill);l.push({message:`+${e.xp} XP em ${t}${e.isOffHand?" (off-hand)":""}`,type:"skill_xp"})}}}else t="A magia falhou!",m=t,d=!1,l.push({message:`${o.player.name} tentou lançar ${e.name}, mas a magia falhou!`,type:"system"})}}else e?o.player.mana<e.mana_cost?m=`Mana insuficiente! Necessário: ${e.mana_cost}, Atual: ${o.player.mana}`:e.current_cooldown>0&&(m=`${e.name} está em recarga por mais ${e.current_cooldown} turnos.`):m="Magia não encontrada!",l.push({message:m,type:"system"}),d=!0}break;case"flee":return this.processFleeResult(t||r.gameState);case"consumable":if(s)try{if(s.startsWith("slot_")){const e=parseInt(s.replace("slot_","")),t=await nf.consumePotionFromSlot(o.player.id,e);t.success&&t.data?(o.player={...o.player,hp:Math.floor(Number(t.data.new_hp)||o.player.hp),mana:Math.floor(Number(t.data.new_mana)||o.player.mana)},m=t.data.message,kf.logConsumableUse(o.player.name,"Poção",t.data.message.replace(`${o.player.name} `,""),e,{playerId:o.player.id,playerName:o.player.name,floorNumber:o.player.floor}),d=!1):(m=t.error||"Erro ao usar poção do slot.",d=!0)}else{const e={...o.player},t=await Bx.consumeItem(o.player.id,s,e);t.success&&t.data?(o.player={...o.player,hp:Math.floor(Number(e.hp)||o.player.hp),mana:Math.floor(Number(e.mana)||o.player.mana),atk:Math.floor(Number(e.atk)||o.player.atk),def:Math.floor(Number(e.def)||o.player.def)},m=t.data.message,kf.logConsumableUse(o.player.name,"Consumível",t.data.message.replace(`${o.player.name} `,""),void 0,{playerId:o.player.id,playerName:o.player.name,consumableId:s,floorNumber:o.player.floor}),d=!1):(m=t.error||"Erro ao usar item consumível.",d=!0)}}catch(h){m="Erro ao usar item consumível.",d=!0}else m="Item consumível não especificado.",d=!0;break;case"special":m="Habilidade especial ainda não implementada.",d=!0;break;case"continue":try{const e=await Lf.advanceToNextFloor(o);Object.assign(o,e),m=e.gameMessage||"Avançando para o próximo andar...",d=!1}catch(h){m="Erro ao avançar para o próximo andar",d=!0}break;case"interact_event":try{const e=await Lf.processSpecialEventInteraction(o);Object.assign(o,e),m=e.gameMessage||"Evento especial processado com sucesso!",d=!1}catch(h){m="Erro ao processar evento especial",d=!0}break;default:m="Ação não reconhecida.",d=!0}return o.player.defenseCooldown>0&&o.player.defenseCooldown--,"consumable"!==e&&(o.player.potionUsedThisTurn=!1),o.player=Cf.validatePlayerStats(o.player),o.currentEnemy&&(o.currentEnemy=Cf.validateEnemyStats(o.currentEnemy)),t||(r.setGameState(o),l.forEach((e=>{n.addGameLogMessage(e.message,e.type)}))),Sf.log("info","BattleService",`Ação processada: ${e}, skipTurn: ${d}`,{playerHp:o.player.hp,playerMana:o.player.mana,skillXpGains:c.length}),{newState:o,skipTurn:d,message:m,skillXpGains:c,skillMessages:[],gameLogMessages:l}}static async processFleeResult(e){const t=await this.processFleeAttempt(e);return{newState:t,skipTurn:t.fleeSuccessful||!1,message:t.gameMessage||"Tentativa de fuga processada",skillXpGains:[],skillMessages:[],gameLogMessages:[]}}static async getPlayerEquipmentSlots(e){try{return await gh.getEquippedItems(e)}catch(t){return null}}static async processPlayerDeath(e,t,a,s){try{const r=await wf.killCharacter(t.id,"Battle defeat",a.name),n={...t,hp:0,isDefending:!1};return r.success?{...e,player:n,mode:"gameover",isPlayerTurn:!0,gameMessage:`${s} Você foi derrotado! Seu personagem foi perdido permanentemente.`,characterDeleted:!0}:{...e,player:n,mode:"gameover",isPlayerTurn:!0,gameMessage:`${s} Você foi derrotado!`}}catch(r){return{...e,player:{...t,hp:0,isDefending:!1},mode:"gameover",isPlayerTurn:!0,gameMessage:`${s} Você foi derrotado!`}}}static async processFleeAttempt(e){const{player:t,currentEnemy:a}=e;if(!a)return e;const s=(t.speed||10)-(a.speed||10);let r=70+Math.floor(2*s);r=Math.max(15,Math.min(95,r));if(100*Math.random()<r)return kf.logSpecialEvent("flee_success",`${t.name} fugiu da batalha com sucesso!`,{playerId:t.id,playerName:t.name,floorNumber:t.floor}),Sf.endBattle("flee",{reason:"Fuga bem-sucedida pelo sistema",playerName:t.name}),{...e,fleeSuccessful:!0,currentEnemy:null,mode:"fled",battleRewards:null,isPlayerTurn:!0,gameMessage:`${t.name} fugiu da batalha com sucesso!`};{const s=Math.floor(.3*(a.attack||10)),r=Math.max(0,t.hp-s);return r<=0?this.processPlayerDeath(e,t,a,`${t.name} tentou fugir mas falhou!`):{...e,player:{...t,hp:r},fleeSuccessful:!1,gameMessage:`${t.name} tentou fugir mas falhou! Sofreu ${s} de dano.`}}}static async processEnemyAction(e,t){if(!e.currentEnemy||e.currentEnemy.hp<=0)return{newState:{...e,isPlayerTurn:!0}};const a={...e.currentEnemy},s={...e.player},r=[];if(a.hp<=0)return{newState:{...e,isPlayerTurn:!0,gameMessage:`${a.name} foi derrotado por efeitos ao longo do tempo!`}};let n="attack";const i=a.special_abilities&&a.special_abilities.length>0,o=(a.intelligence||10)>(a.strength||10);let l=.15,c=.2;switch(a.behavior){case"aggressive":l=.25,c=.1;break;case"defensive":l=.3,c=.15;break;case"balanced":o?(c=.35,l=.2):(c=.2,l=.2)}i&&(l+=.1),i&&Math.random()<l?n="special":a.mana>=10&&Math.random()<c&&(n="spell");let d="",m=0,u=0;switch(n){case"attack":{const n=this.calculateDamage(a,s,a.dexterity||10,a.speed||10);if(m=n.damage,s.isDefending||t){u=Math.floor(.15*m),kf.logEnemyAttack(a.name,s.name,u,!0,!1,{enemyName:a.name,playerName:s.name,damage:u,floorNumber:s.floor});let e=`${a.name} atacou`;n.isCritical&&(e+=" com golpe crítico"),n.isDoubleAttack&&(e+=` ${n.totalAttacks}x`),e+=`, mas você reduziu o dano de ${m} para ${u} com sua defesa!`,d=e;try{const e=m-u,t=xf.calculateDefenseSkillXp(null,e);r.push(...t)}catch(h){}}else{u=m,kf.logEnemyAttack(a.name,s.name,u,!1,!1,{enemyName:a.name,playerName:s.name,damage:u,floorNumber:s.floor});let e=`${a.name} atacou`;n.isCritical&&(e+=" com golpe crítico"),n.isDoubleAttack&&(e+=` ${n.totalAttacks}x`),e+=` e causou ${u} de dano!`,d=e;try{const e=xf.calculateDefenseSkillXp(null,Math.floor(.3*u));r.push(...e)}catch(h){}}const i=Math.max(0,s.hp-u);if(i<=0)return{newState:await this.processPlayerDeath(e,s,a,d)};const o={...e,player:{...s,hp:i,isDefending:!1,potionUsedThisTurn:!1},isPlayerTurn:!0,gameMessage:d},l=r.length>0?r.map((e=>`+${e.xp} XP em ${xf.getSkillDisplayName(e.skill)}`)):void 0;return{newState:bh.updateSpellCooldowns(o),skillXpGains:r,skillMessages:l}}case"spell":{const n=Math.floor(1.2*a.attack),i=10;if(s.isDefending||t){u=Math.floor(.15*n),kf.logSpellCast(a.name,"Magia",s.name,u,"damage",{enemyName:a.name,playerName:s.name,damage:u,floorNumber:s.floor}),d=`${a.name} lançou uma magia, mas você reduziu o dano de ${n} para ${u} com sua defesa!`;try{const e=await gh.getEquippedItems(s.id)||null,t=Math.floor(.5*(n-u)),a=xf.calculateDefenseSkillXp(e,t);r.push(...a)}catch(h){}}else u=n,kf.logSpellCast(a.name,"Magia",s.name,u,"damage",{enemyName:a.name,playerName:s.name,damage:u,floorNumber:s.floor}),d=`${a.name} lançou uma magia e causou ${u} de dano mágico!`;const o=Math.max(0,s.hp-u);if(o<=0)return{newState:await this.processPlayerDeath(e,s,a,d)};const l={...e,player:{...s,hp:o,isDefending:!1,potionUsedThisTurn:!1},currentEnemy:{...a,mana:Math.max(0,a.mana-i)},isPlayerTurn:!0,gameMessage:d},c=r.length>0?r.map((e=>`+${e.xp} XP em ${xf.getSkillDisplayName(e.skill)}`)):void 0;return{newState:bh.updateSpellCooldowns(l),skillXpGains:r,skillMessages:c}}case"special":{const n=a.special_abilities||[];if(n.length>0){const r=n[Math.floor(Math.random()*n.length)],i=r.split(":")[0].trim();if(r.includes("Regenera")||r.includes("Recupera")||r.includes("cura")){const t=Math.floor(a.maxHp*(.1+.15*Math.random())),r=Math.min(a.maxHp,a.hp+t),n={...e,player:{...s,potionUsedThisTurn:!1},currentEnemy:{...a,hp:r},isPlayerTurn:!0,gameMessage:`${a.name} usou ${i} e recuperou ${t} HP!`};return{newState:bh.updateSpellCooldowns(n)}}r.includes("dano")||r.includes("ATK")||r.includes("Ataque")?(m=Math.floor(a.attack*(1.3+.7*Math.random())),u=s.isDefending||t?Math.floor(.15*m):m,d=`${a.name} usou ${i} e causou ${u} de dano!`):r.includes("crítico")||r.includes("Crítico")?(m=Math.floor(2*a.attack),u=s.isDefending||t?Math.floor(.15*m):m,d=`${a.name} usou ${i} com um golpe crítico devastador! ${u} de dano!`):r.includes("área")||r.includes("todos")?(m=Math.floor(1.2*a.attack),u=s.isDefending||t?Math.floor(.15*m):m,d=`${a.name} usou ${i} em área! ${u} de dano!`):(m=Math.floor(a.attack*(1.2+.5*Math.random())),u=s.isDefending||t?Math.floor(.15*m):m,d=`${a.name} usou ${i}! ${u} de dano!`)}else switch(a.behavior){case"aggressive":m=Math.floor(1.5*a.attack),u=s.isDefending||t?Math.floor(.15*m):m,d=`${a.name} usou Ataque Furioso e causou ${u} de dano!`;break;case"defensive":{const t=Math.floor(.15*a.maxHp),r=Math.min(a.maxHp,a.hp+t),n={...e,player:{...s,potionUsedThisTurn:!1},currentEnemy:{...a,hp:r},isPlayerTurn:!0,gameMessage:`${a.name} se concentrou e recuperou ${t} HP!`};return{newState:bh.updateSpellCooldowns(n)}}default:m=Math.floor(1.3*a.attack),u=s.isDefending||t?Math.floor(.15*m):m,d=`${a.name} usou uma habilidade especial e causou ${u} de dano!`}if(u>0)try{const e=await gh.getEquippedItems(s.id)||null;if(s.isDefending||t){const t=m-u,a=xf.calculateDefenseSkillXp(e,t);r.push(...a)}else{const t=xf.calculateDefenseSkillXp(e,Math.floor(.2*u));r.push(...t)}}catch(h){}const i=Math.max(0,s.hp-u);if(i<=0)return{newState:await this.processPlayerDeath(e,s,a,d)};const o={...e,player:{...s,hp:i,isDefending:!1,potionUsedThisTurn:!1},isPlayerTurn:!0,gameMessage:d},l=r.length>0?r.map((e=>`+${e.xp} XP em ${xf.getSkillDisplayName(e.skill)}`)):void 0;return{newState:bh.updateSpellCooldowns(o),skillXpGains:r,skillMessages:l}}default:{const t={...e,player:{...e.player,potionUsedThisTurn:!1},isPlayerTurn:!0};return{newState:bh.updateSpellCooldowns(t)}}}}}class Mf{static floorCache=new Map;static cacheExpiry=new Map;static CACHE_DURATION=3e4;static clearCache(){this.floorCache.clear(),this.cacheExpiry.clear()}static async getFloorData(e){let t=e;if(e<=0&&(t=1),t<1||t>1e3)return null;const a=Date.now(),s=this.floorCache.get(t),r=this.cacheExpiry.get(t);if(s&&r&&a<r)return s;try{const{data:e,error:a}=await Aa.rpc("get_floor_data",{p_floor_number:t});if(a||!e){const e=this.generateBasicFloorData(t);return this.cacheFloor(t,e),e}const s=Array.isArray(e)?e[0]:e,r={floorNumber:s.floor_number||t,type:s.type||"common",isCheckpoint:s.is_checkpoint||!1,minLevel:s.min_level||1,description:s.description||`Andar ${t}`};return this.cacheFloor(t,r),r}catch(n){const e=this.generateBasicFloorData(t);return this.cacheFloor(t,e),e}}static cacheFloor(e,t){const a=Date.now();this.floorCache.set(e,t),this.cacheExpiry.set(e,a+this.CACHE_DURATION)}static generateBasicFloorData(e){let t="common";5===e||e%10==0?t="boss":e%5==0&&e>5?t="elite":e%7==0&&(t="event");const a=1===e||5===e||e>10&&(e-1)%10==0,s=Math.max(1,Math.floor(e/3));let r="";switch(t){case"boss":r=5===e?`Primeiro Desafio - Andar ${e}`:`Covil do Chefe - Andar ${e}`;break;case"elite":r=`Domínio de Elite - Andar ${e}`;break;case"event":r=`Câmara de Eventos - Andar ${e}`;break;default:r=1===e?"Entrada da Torre":a?`Santuário Seguro - Andar ${e}`:`Corredor Sombrio - Andar ${e}`}return{floorNumber:e,type:t,isCheckpoint:a,minLevel:s,description:r}}static calculateFloorRewards(e,t,a){const s={boss:2.5,elite:1.8,event:1.2,common:1}[a]||1;return{xp:Math.floor(e*s),gold:Math.floor(t*s)}}static async checkForSpecialEvent(e){try{const{data:t,error:a}=await Aa.rpc("get_special_event_for_floor",{p_floor:e});return a||!t?null:t}catch(t){return null}}static async processSpecialEventInteraction(e){const{currentSpecialEvent:t,player:a}=e;if(!t)return e;let s=a.hp,r=a.mana,n=a.gold,i="";switch(t.type){case"magic_fountain":s=a.max_hp,r=a.max_mana,i="Fonte mágica! HP e Mana restaurados.";break;case"treasure_chest":{const e=Math.floor(50*Math.random())+25;n+=e,i=`Baú do tesouro! Ganhou ${e} de ouro.`;break}case"bonfire":{const e=Math.floor(.5*a.max_hp);s=Math.min(a.max_hp,a.hp+e),i=`Fogueira! Recuperou ${e} HP.`;break}default:i=`Evento ${t.name} processado.`}try{const t=await yf.getEnemyForFloor(a.floor);if(!t.success||!t.data)throw new Error("Falha ao gerar inimigo após evento");const l=t.data;if(s!==a.hp||r!==a.mana||n!==a.gold)try{s===a.hp&&r===a.mana||await Nh.updateCharacterHpMana(a.id,s,r),n!==a.gold&&await Nh.grantSecureGold(a.id,n-a.gold)}catch(o){}return{...e,player:{...a,hp:s,mana:r,gold:n,isPlayerTurn:!0,isDefending:!1},currentEnemy:l,gameMessage:`${i} ${l.name} apareceu!`,currentSpecialEvent:null,mode:"battle",isPlayerTurn:!0}}catch(o){return{...e,player:{...a,hp:s,mana:r,gold:n,isPlayerTurn:!0,isDefending:!1},gameMessage:`${i} Preparando próximo desafio...`,currentSpecialEvent:null,currentEnemy:null,mode:"battle",isPlayerTurn:!0}}}}const Tf=Object.freeze(Object.defineProperty({__proto__:null,FloorService:Mf},Symbol.toStringTag,{value:"Module"}));class qf{static async processEnemyDefeat(){const{gameState:e,updateGameState:t,setError:a}=lx.getState();try{const{player:s,currentEnemy:r,currentFloor:n}=e;if(!r||!n)return void a("Estado inválido para processar recompensas");if(!s?.id)return void a("Jogador não encontrado");if(e.battleRewards)return;const i=r.reward_xp||10,o=r.reward_gold||5,{xp:l,gold:c}=Mf.calculateFloorRewards(i,o,n.type),d=await Nh.grantSecureXP(s.id,l,"combat");if(!d.success)throw new Error(`Falha ao conceder XP: ${d.error}`);const m=d.data,u=await Nh.grantSecureGold(s.id,c);if(!u.success)throw new Error(`Falha ao conceder gold: ${u.error}`);const h=u.data,p=await this.processMonsterDrops(r,n,s.id),x={xp:l,gold:c,drops:p,leveledUp:m.leveled_up,newLevel:m.leveled_up?m.new_level:void 0},f={...s,xp:m.new_xp,level:m.new_level,gold:h};t((e=>{e.player=f,e.battleRewards=x,e.isPlayerTurn=!0,e.gameMessage=`Inimigo derrotado! +${l} XP, +${c} Gold${x.leveledUp?" - LEVEL UP!":""}`}))}catch(s){const e=s instanceof Error?s.message:"Erro desconhecido";a(`Erro ao processar recompensas: ${e}`),t((t=>{t.isPlayerTurn=!0,t.gameMessage=`Erro ao processar derrota: ${e}`}))}}static async processMonsterDrops(e,t,a){let s=[];if(e.possible_drops&&e.possible_drops.length>0){const r=Bx.processMonsterDrops(e.level,e.possible_drops,"boss"===t.type?1.5:1);if(r.length>0){const e=r.map((e=>e.drop_id)),t=await Bx.getDropInfoByIds(e);if(t.success&&t.data){s=r.map((e=>{const a=t.data.find((t=>t.id===e.drop_id));return{name:a?.name||`Item Desconhecido (${e.drop_id})`,quantity:e.quantity}}));const e=await Bx.addDropsToInventory(a,r);if(!e.success)throw new Error(`Falha ao persistir drops: ${e.error}`)}else s=r.map((e=>({name:`Item ${e.drop_id.substring(0,8)}...`,quantity:e.quantity})))}}return s}static clearBattleRewards(){const{updateGameState:e}=lx.getState();e((e=>{e.battleRewards=null}))}static hasPendingRewards(){const{gameState:e}=lx.getState();return null!==e.battleRewards}static getCurrentRewards(){const{gameState:e}=lx.getState();return e.battleRewards}static calculateTotalRewardValue(e){let t=e.gold;return t+=e.drops.reduce(((e,t)=>e+10*t.quantity),0),t}static formatRewardsMessage(e){const t=[];if(t.push(`+${e.xp} XP`),t.push(`+${e.gold} Gold`),e.drops.length>0){const a=e.drops.map((e=>`${e.name} (${e.quantity})`)).join(", ");t.push(`Items: ${a}`)}return e.leveledUp&&t.push(`🎉 LEVEL UP! Nível ${e.newLevel}!`),t.join(" • ")}}class Df{static async loadPlayerForGame(e,t=!1){try{const a=await Nh.getCharacterForGame(e,t,!0);if(!a.success||!a.data)throw new Error(a.error||"Personagem não encontrado");const s=a.data,r=await bh.getCharacterEquippedSpells(e),n=r.success&&r.data?r.data:[],i=await Bx.getCharacterConsumables(e),o=i.success&&i.data?i.data.filter((e=>e.quantity>0)):[];return{...s,spells:n,consumables:o,active_effects:{buffs:[],debuffs:[],dots:[],hots:[],attribute_modifications:[]}}}catch(a){throw a}}static async advanceToNextFloor(e){const{player:t}=e,a=t.floor+1;try{const s=await Nh.updateCharacterFloor(t.id,a);if(!s.success)throw new Error(s.error||"Erro ao atualizar andar");const r=await Mf.getFloorData(a);if(!r)throw new Error(`Erro ao carregar andar ${a}`);const n=Math.random()<.01?await Mf.checkForSpecialEvent(a):null;let i=null;if(!n){const e=await yf.getEnemyForFloor(a);if(!e.success||!e.data)throw new Error(`Falha ao gerar inimigo para andar ${a}`);i=e.data}const o={...e,mode:n?"special_event":"battle",player:{...t,floor:a,isPlayerTurn:!0,isDefending:!1,potionUsedThisTurn:!1,defenseCooldown:Math.max(0,(t.defenseCooldown||0)-1)},currentFloor:r,currentEnemy:i,currentSpecialEvent:n,gameMessage:n?`Evento especial: ${n.name}!`:`Andar ${a}: ${i?.name} apareceu!`,isPlayerTurn:!0,battleRewards:null,selectedSpell:null,characterDeleted:!1,fleeSuccessful:!1,highestFloor:Math.max(e.highestFloor||0,a)};return bh.resetSpellCooldowns(o)}catch(s){try{const s=await yf.getEnemyForFloor(a);if(s.success&&s.data){const r=s.data,n={floorNumber:a,type:"common",isCheckpoint:a%10==0,minLevel:Math.max(1,Math.floor(a/5)),description:`Andar ${a} - Área Desconhecida`},i={...e,player:{...t,floor:a,isPlayerTurn:!0,isDefending:!1,potionUsedThisTurn:!1},currentFloor:n,currentEnemy:r,currentSpecialEvent:null,gameMessage:`Andar ${a}: ${r.name} apareceu!`,isPlayerTurn:!0,battleRewards:null,mode:"battle",selectedSpell:null};return bh.resetSpellCooldowns(i)}}catch(r){}return{...e,gameMessage:`Erro ao avançar para andar ${a}. Retorne ao hub.`}}}}class Lf{static clearAllCaches(){_f.clearAllGameCaches()}static async generateEnemy(e){try{const{data:t,success:a}=await yf.getEnemyForFloor(e);return a&&t?t:null}catch(t){return null}}static async saveGameProgress(e,t){const{player:a,currentFloor:s}=e,r={user_id:t,player_name:a.name,current_floor:a.floor,hp:a.hp,max_hp:a.max_hp,attack:a.atk,defense:a.def,highest_floor:Math.max(a.floor,s?.floorNumber||1)};try{const{data:e,error:t}=await Aa.from("game_progress").upsert(r).select();return t?{success:!1,error:t.message,data:null}:{success:!0,error:void 0,data:e[0]}}catch(n){return{success:!1,error:n instanceof Error?n.message:"Erro desconhecido",data:null}}}static async loadGameProgress(e){try{const{data:t,error:a}=await Aa.from("game_progress").select("*").eq("user_id",e).order("updated_at",{ascending:!1}).limit(1);return a?{success:!1,error:a.message,data:null}:{success:!0,error:void 0,data:t[0]||null}}catch(t){return{success:!1,error:t instanceof Error?t.message:"Erro desconhecido",data:null}}}static async processPlayerAction(e,t,a,s){return Pf.processPlayerAction(e,t,a,s)}static async processEnemyDefeat(){return await qf.processEnemyDefeat(),lx.getState().gameState}static async processEnemyActionWithDelay(e,t,a){if(!e.currentEnemy||e.currentEnemy.hp<=0)return{newState:e};const s=a??1500+1e3*Math.random();return await new Promise((e=>setTimeout(e,s))),!e.currentEnemy||e.currentEnemy.hp<=0?{newState:e}:Pf.processEnemyAction(e,t)}static async advanceToNextFloor(e){return Df.advanceToNextFloor(e)}static async processSpecialEventInteraction(e){return Mf.processSpecialEventInteraction(e)}static async loadPlayerForGame(e,t=!1){return Df.loadPlayerForGame(e,t)}static calculateInitiative=Pf.calculateInitiative;static calculateExtraTurns=Pf.calculateExtraTurns;static calculateDamage=Pf.calculateDamage;static processEnemyAction=Pf.processEnemyAction}class $f{static async getSpecialEventForFloor(e){try{if(!this.isFloorEligibleForEvent(e))return{data:null,error:"Andar não elegível para eventos especiais",success:!1};const t=If.getState(),a=.03*t.eventChanceMultiplier;if(Math.random()>a)return{data:null,error:"Evento especial não gerado por chance",success:!1};if(!t.canProcessEvent("special_event"))return{data:null,error:"Eventos especiais em cooldown",success:!1};const{data:s,error:r}=await Aa.rpc("get_special_event_for_floor",{p_floor:e}).single();if(r)throw r;if(!s)throw new Error("Nenhum evento encontrado para este andar");const n=s;t.setCurrentEvent(n);return lx.getState().updateGameState((e=>{e.currentSpecialEvent=n,e.mode="special_event",e.gameMessage=`Você encontrou: ${n.name}!`})),{data:n,error:null,success:!0}}catch(t){return If.getState().setError(t instanceof Error?t.message:"Erro ao buscar evento especial"),{data:null,error:t instanceof Error?t.message:"Erro ao buscar evento especial",success:!1}}}static async processSpecialEvent(e,t){try{const a=If.getState(),s=lx.getState(),r=a.currentEvent||s.gameState.currentSpecialEvent;if(!r||r.id!==t)throw new Error("Evento não encontrado ou não está ativo");if(!a.canProcessEvent("special_event",e))throw new Error("Evento não pode ser processado (cooldown ou já processando)");a.setError(null);const{data:n,error:i}=await Aa.rpc("process_special_event",{p_character_id:e,p_event_id:t}).single();if(i)throw i;if(!n)throw new Error("Resposta inválida do servidor");const o=n;return this.updateStoresAfterEventProcessing(t,e,r,o),{data:o,error:null,success:!0}}catch(a){return If.getState().setError(a instanceof Error?a.message:"Erro ao processar evento especial"),{data:null,error:a instanceof Error?a.message:"Erro ao processar evento especial",success:!1}}}static updateStoresAfterEventProcessing(e,t,a,s){const r=If.getState(),n=lx.getState();try{r.addToHistory(e,a.type,t,s),r.addCooldown("special_event",r.globalEventCooldownMs,t,`Cooldown após evento ${a.name}`),r.setCurrentEvent(null),n.updateGameState((e=>{e.currentSpecialEvent=null,e.gameMessage=s.message,e.mode="hub",e.player&&s.success&&(s.hp_restored>0&&(e.player.hp=Math.min(e.player.max_hp,e.player.hp+s.hp_restored)),s.mana_restored>0&&(e.player.mana=Math.min(e.player.max_mana,e.player.mana+s.mana_restored)),s.gold_gained>0&&(e.player.gold+=s.gold_gained))}))}catch(i){r.setError("Erro ao atualizar estado após evento")}}static isFloorEligibleForEvent(e){return e>1&&e%5!=0&&e%10!=0}static shouldGenerateSpecialEvent(e){const t=("event"===e?.7:.03)*If.getState().eventChanceMultiplier;return Math.random()<t}static getEventIcon(e){return{bonfire:"🔥",treasure_chest:"📦",magic_fountain:"⛲"}[e]||"✨"}static getEventColor(e){return{bonfire:"text-orange-500",treasure_chest:"text-yellow-500",magic_fountain:"text-blue-500"}[e]||"text-purple-500"}static getEventStatus(e){const t=If.getState(),a=lx.getState();return{hasActiveEvent:!(!t.currentEvent&&!a.gameState.currentSpecialEvent),isProcessing:t.isProcessingEvent,canProcessEvents:t.canProcessEvent("special_event",e),activeCooldowns:t.eventCooldowns.length,lastError:t.lastError}}static clearEventState(){const e=If.getState(),t=lx.getState();e.setCurrentEvent(null),e.clearError(),e.clearEventQueue(),t.updateGameState((e=>{e.currentSpecialEvent=null,"special_event"===e.mode&&(e.mode="hub")}))}static syncEventsBetweenStores(){const e=If.getState(),t=lx.getState(),a=t.gameState.currentSpecialEvent,s=e.currentEvent;a&&!s?e.setCurrentEvent(a):s&&!a&&t.updateGameState((e=>{e.currentSpecialEvent=s,"special_event"!==e.mode&&(e.mode="special_event")}))}static setEventChanceMultiplier(e){If.getState().setEventChanceMultiplier(e)}static getEventHistory(e){let t=If.getState().eventHistory;return e&&(t=t.filter((t=>t.characterId===e))),t}}const Rf={currentEvent:null,eventQueue:[],eventCooldowns:[],isProcessingEvent:!1,eventHistory:[],eventChanceMultiplier:1,globalEventCooldownMs:5e3,maxQueueSize:10,lastError:null,processingEventId:null},If=lp()(up(((e,t)=>({...Rf,interactWithEvent:async(a,s)=>{const r=t();if(r.isProcessingEvent)return;if("special_event"!==a.mode||!a.currentSpecialEvent)return;const n=a.currentSpecialEvent;if(r.canProcessEvent(n.type,s)){e({isProcessingEvent:!0,processingEventId:n.id,lastError:null});try{const i=await Lf.processSpecialEventInteraction(a);if(i.player){i.player.hp===a.player.hp&&i.player.mana===a.player.mana||await Nh.updateCharacterHpMana(s,i.player.hp,i.player.mana);const e=i.player.gold-a.player.gold;e>0&&await Nh.grantSecureGold(s,e)}t().addToHistory(n.id,n.type,s),t().addCooldown("global",r.globalEventCooldownMs,s,"Cooldown global após evento"),e({currentEvent:null})}catch(i){const t=i instanceof Error?i.message:"Erro desconhecido";e({lastError:t})}finally{e({isProcessingEvent:!1,processingEventId:null})}}else e({lastError:"Evento em cooldown ou não pode ser processado"})},processEvent:async(a,s)=>{if(t().isProcessingEvent)return null;try{e({isProcessingEvent:!0,processingEventId:a});const r=await $f.processSpecialEvent(s,a);if(r.success&&r.data)return t().addToHistory(a,"special_event",s,r.data),r.data;throw new Error(r.error||"Falha ao processar evento")}catch(r){const t=r instanceof Error?r.message:"Erro desconhecido";return e({lastError:t}),null}finally{e({isProcessingEvent:!1,processingEventId:null})}},queueEvent:t=>{e(ix((e=>{e.eventQueue.length>=e.maxQueueSize&&e.eventQueue.shift();const a=e.eventQueue.findIndex((e=>e.priority<t.priority||e.priority===t.priority&&e.scheduledFor>t.scheduledFor));-1===a?e.eventQueue.push(t):e.eventQueue.splice(a,0,t)})))},processEventQueue:async()=>{const e=t(),a=new Date;if(e.isProcessingEvent||0===e.eventQueue.length)return;t().clearExpiredCooldowns();const s=e.eventQueue.filter((e=>e.scheduledFor<=a&&t().canProcessEvent(e.type,e.characterId)));for(const n of s.slice(0,3))try{if("special_event"===n.type&&n.characterId){const e=n.eventData;await t().processEvent(e.id,n.characterId)}t().removeEventFromQueue(n.id)}catch(r){t().removeEventFromQueue(n.id)}},clearEventQueue:()=>{e({eventQueue:[]})},removeEventFromQueue:t=>{e(ix((e=>{e.eventQueue=e.eventQueue.filter((e=>e.id!==t))})))},addCooldown:(t,a,s,r="Cooldown padrão")=>{const n=new Date(Date.now()+a);e(ix((e=>{e.eventCooldowns=e.eventCooldowns.filter((e=>!(e.eventType===t&&e.characterId===s))),e.eventCooldowns.push({eventType:t,characterId:s,expiresAt:n,reason:r})})))},removeCooldown:(t,a)=>{e(ix((e=>{e.eventCooldowns=e.eventCooldowns.filter((e=>!(e.eventType===t&&e.characterId===a)))})))},checkCooldown:(e,a)=>{const s=t(),r=new Date;return s.eventCooldowns.some((t=>t.eventType===e&&t.characterId===a&&t.expiresAt>r))},clearExpiredCooldowns:()=>{const t=new Date;e(ix((e=>{e.eventCooldowns=e.eventCooldowns.filter((e=>e.expiresAt>t))})))},canProcessEvent:(e,a)=>!t().isProcessingEvent&&(!t().checkCooldown(e,a)&&!t().checkCooldown("global",a)),setCurrentEvent:t=>{e({currentEvent:t})},setError:t=>{e({lastError:t})},clearError:()=>{e({lastError:null})},setEventChanceMultiplier:t=>{e({eventChanceMultiplier:Math.max(.1,Math.min(5,t))})},addToHistory:(t,a,s,r)=>{e(ix((e=>{e.eventHistory.unshift({eventId:t,eventType:a,characterId:s,result:r,processedAt:new Date}),e.eventHistory.length>50&&(e.eventHistory=e.eventHistory.slice(0,50))})))},clearHistory:()=>{e({eventHistory:[]})},resetEventState:()=>{e({...Rf})}})),{name:"event-store"}));function Ff(){const{interactWithEvent:e,isProcessingEvent:t,lastError:a}=(()=>{const e=If();return{currentEvent:e.currentEvent,isProcessingEvent:e.isProcessingEvent,eventQueue:e.eventQueue,eventCooldowns:e.eventCooldowns,eventHistory:e.eventHistory,lastError:e.lastError,interactWithEvent:e.interactWithEvent,processEvent:e.processEvent,canProcessEvent:e.canProcessEvent,setCurrentEvent:e.setCurrentEvent,clearError:e.clearError,queueEvent:e.queueEvent,processEventQueue:e.processEventQueue,addCooldown:e.addCooldown,checkCooldown:e.checkCooldown}})(),{selectedCharacter:s}=vx(),{gameState:r}=lx();return{interactWithEvent:async()=>{s&&await e(r,s.id)},isProcessingEvent:t,lastError:a}}function Vf(){const e=lx(),t=xx(),a=vx(),s=Ff();return{gameState:e.gameState,loading:e.loading,error:e.error,setGameState:e.setGameState,updateLoading:e.updateLoading,setError:e.setError,resetError:e.resetError,gameMessage:t.gameMessage,gameLog:t.gameLog,addGameLogMessage:t.addGameLogMessage,setGameMessage:t.setGameMessage,characters:a.characters,selectedCharacter:a.selectedCharacter,createCharacter:a.createCharacter,selectCharacter:a.selectCharacter,reloadCharacters:a.reloadCharacters,interactWithEvent:s.interactWithEvent,startGame:a.createCharacter,clearGameState:()=>{e.setGameState({mode:"menu",player:{id:"",user_id:"",name:"",level:1,xp:0,xp_next_level:150,gold:0,hp:50,max_hp:50,mana:20,max_mana:20,atk:10,def:5,speed:10,created_at:"",updated_at:"",isPlayerTurn:!0,specialCooldown:0,defenseCooldown:0,isDefending:!1,floor:1,spells:[],consumables:[],potionUsedThisTurn:!1,active_effects:{buffs:[],debuffs:[],dots:[],hots:[],attribute_modifications:[]},strength:10,dexterity:10,intelligence:10,wisdom:10,vitality:10,luck:10,critical_chance:0,critical_damage:110,double_attack_chance:0,magic_attack:0,magic_mastery:1,magic_damage_bonus:0},currentEnemy:null,currentFloor:null,currentSpecialEvent:null,isPlayerTurn:!0,gameMessage:"",highestFloor:1,selectedSpell:null,battleRewards:null,fleeSuccessful:!1,characterDeleted:!1})},returnToMenu:()=>{e.setGameState({...e.gameState,mode:"menu"})},saveProgress:async()=>{},updatePlayerConsumables:t=>{e.setGameState({...e.gameState,player:{...e.gameState.player,consumables:t}})}}}const Of=({recipe:e,onCraft:a,isCrafting:s,selectedCharacter:r})=>{if(!e)return t.jsxs("div",{className:"h-full flex flex-col items-center justify-center text-center p-6 bg-muted/10 rounded-lg border-2 border-dashed border-muted",children:[t.jsx(At,{className:"h-16 w-16 text-muted-foreground mb-4"}),t.jsx("h3",{className:"text-lg font-semibold text-muted-foreground mb-2",children:"Selecione uma Receita"}),t.jsx("p",{className:"text-sm text-muted-foreground",children:"Escolha uma receita da lista para ver os detalhes e ingredientes necessários."})]});const n=()=>{if("equipment"===e.craftType){switch(e.result.rarity){case"legendary":return"text-orange-400 bg-orange-500/10 border-orange-500/20";case"epic":return"text-purple-400 bg-purple-500/10 border-purple-500/20";case"rare":return"text-blue-400 bg-blue-500/10 border-blue-500/20";case"uncommon":return"text-green-400 bg-green-500/10 border-green-500/20";default:return"text-gray-400 bg-gray-500/10 border-gray-500/20"}}else{switch(e.result.type){case"elixir":return"text-purple-400 bg-purple-500/10 border-purple-500/20";case"potion":return"text-red-400 bg-red-500/10 border-red-500/20";case"antidote":return"text-green-400 bg-green-500/10 border-green-500/20";default:return"text-blue-400 bg-blue-500/10 border-blue-500/20"}}};return t.jsxs("div",{className:"min-h-full flex flex-col",children:[t.jsxs("div",{className:"flex items-start gap-4 p-6 border-b shrink-0",children:[t.jsx("div",{className:Ga("p-3 rounded-lg border",n()),children:(()=>{if("equipment"===e.craftType){switch(e.result.type){case"weapon":return t.jsx(qe,{className:"h-6 w-6"});case"armor":return t.jsx(De,{className:"h-6 w-6"});case"accessory":return t.jsx(gt,{className:"h-6 w-6"});default:return t.jsx(vt,{className:"h-6 w-6"})}}return t.jsx(pt,{className:"h-6 w-6"})})()}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsxs("div",{className:"flex items-start justify-between gap-2 mb-2",children:[t.jsx("h2",{className:"text-xl font-bold truncate",children:e.result.name}),t.jsxs("div",{className:"flex items-center gap-2 shrink-0",children:[t.jsx(Nu,{className:Ga("",n()),children:"equipment"===e.craftType?e.result.rarity:e.result.type}),"equipment"===e.craftType&&e.result.level_requirement&&t.jsxs(Nu,{variant:"outline",children:["Nível ",e.result.level_requirement]})]})]}),t.jsx("p",{className:"text-sm text-muted-foreground leading-relaxed mb-3",children:e.result.description}),"equipment"===e.craftType&&t.jsx("div",{className:"flex items-center gap-2 flex-wrap",children:t.jsx(Nu,{variant:"secondary",className:"text-xs",children:(()=>{const t=e,a=t.result.type,s=t.result.weapon_subtype;if("weapon"===a&&s)switch(s){case"sword":return"Espada";case"axe":return"Machado";case"blunt":return"Maça";case"staff":return"Cajado";case"dagger":return"Adaga";default:return"Arma"}else{if("armor"===a)return"Armadura";if("accessory"===a)return"Acessório"}return a})()})})]})]}),"equipment"===e.craftType&&(()=>{const a=e;return(a.result.atk_bonus||0)>0||(a.result.def_bonus||0)>0||(a.result.mana_bonus||0)>0||(a.result.speed_bonus||0)>0||(a.result.hp_bonus||0)>0?t.jsxs("div",{className:"p-6 border-b bg-muted/20 shrink-0",children:[t.jsxs("h3",{className:"text-base font-semibold mb-3 flex items-center gap-2",children:[t.jsx(Fe,{className:"h-4 w-4"}),"Atributos do Equipamento"]}),t.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-3 gap-2",children:[(a.result.atk_bonus||0)>0&&t.jsxs("div",{className:"flex items-center gap-2 p-2 bg-red-500/10 border border-red-500/20 rounded-lg",children:[t.jsx(qe,{className:"w-4 h-4 text-red-400"}),t.jsxs("span",{className:"text-sm font-medium",children:["+",a.result.atk_bonus," ATK"]})]}),(a.result.def_bonus||0)>0&&t.jsxs("div",{className:"flex items-center gap-2 p-2 bg-blue-500/10 border border-blue-500/20 rounded-lg",children:[t.jsx(De,{className:"w-4 h-4 text-blue-400"}),t.jsxs("span",{className:"text-sm font-medium",children:["+",a.result.def_bonus," DEF"]})]}),(a.result.mana_bonus||0)>0&&t.jsxs("div",{className:"flex items-center gap-2 p-2 bg-purple-500/10 border border-purple-500/20 rounded-lg",children:[t.jsx(pt,{className:"w-4 h-4 text-purple-400"}),t.jsxs("span",{className:"text-sm font-medium",children:["+",a.result.mana_bonus," MANA"]})]}),(a.result.speed_bonus||0)>0&&t.jsxs("div",{className:"flex items-center gap-2 p-2 bg-green-500/10 border border-green-500/20 rounded-lg",children:[t.jsx(Le,{className:"w-4 h-4 text-green-400"}),t.jsxs("span",{className:"text-sm font-medium",children:["+",a.result.speed_bonus," VEL"]})]}),(a.result.hp_bonus||0)>0&&t.jsxs("div",{className:"flex items-center gap-2 p-2 bg-pink-500/10 border border-pink-500/20 rounded-lg",children:[t.jsx(Be,{className:"w-4 h-4 text-pink-400"}),t.jsxs("span",{className:"text-sm font-medium",children:["+",a.result.hp_bonus," HP"]})]})]})]}):null})(),"equipment"===e.craftType&&(()=>{const a=e,s={id:a.result_equipment_id,name:a.result.name,description:a.result.description,type:a.result.type,rarity:a.result.rarity,weapon_subtype:a.result.weapon_subtype,atk_bonus:a.result.atk_bonus||0,def_bonus:a.result.def_bonus||0,mana_bonus:a.result.mana_bonus||0,speed_bonus:a.result.speed_bonus||0,hp_bonus:a.result.hp_bonus||0,level_requirement:a.result.level_requirement||1,price:0,is_unlocked:!0};return t.jsxs("div",{className:"p-6 border-b bg-muted/10 shrink-0",children:[t.jsx("h3",{className:"text-base font-semibold mb-3",children:"Comparação com Equipamento Atual"}),t.jsx(Wx,{characterId:r?.id||"",newEquipment:s,slotType:a.result.type,showTitle:!1,compact:!0})]})})(),t.jsxs("div",{className:"flex-1 min-h-0 p-6",children:[t.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[t.jsx("h3",{className:"text-lg font-semibold",children:"equipment"===e.craftType?"Materiais Necessários":"Ingredientes Necessários"}),t.jsxs(Nu,{variant:"outline",className:"ml-auto",children:[e.ingredients.length," itens"]})]}),t.jsx("div",{className:"space-y-3 pr-2 max-h-[300px] overflow-y-auto ingredients-scroll",children:e.ingredients.map(((e,a)=>{const s=e.have>=e.quantity;return t.jsxs("div",{className:Ga("flex items-center justify-between p-3 rounded-lg border transition-colors",s?"bg-green-500/5 border-green-500/20":"bg-red-500/5 border-red-500/20"),children:[t.jsxs("div",{className:"flex items-center gap-2",children:["equipment"===e.type&&t.jsx(vt,{className:"h-4 w-4 text-blue-400"}),"drop"===e.type&&t.jsx(gt,{className:"h-4 w-4 text-orange-400"}),"consumable"===e.type&&t.jsx(pt,{className:"h-4 w-4 text-purple-400"}),t.jsx("span",{className:"font-medium",children:e.name})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsxs("span",{className:Ga("text-sm font-mono",s?"text-green-400":"text-red-400"),children:[e.have,"/",e.quantity]}),s?t.jsx($t,{className:"h-4 w-4 text-green-400"}):t.jsx(Ae,{className:"h-4 w-4 text-red-400"})]})]},a)}))})]}),t.jsx("div",{className:"p-6 border-t bg-card/50 mt-auto shrink-0",children:t.jsx(Wa,{onClick:async()=>{e.canCraft&&!s&&await a(e.id,e.craftType)},disabled:!e.canCraft||s,className:Ga("w-full h-12 text-base font-semibold transition-all",e.canCraft&&!s?"bg-emerald-600 hover:bg-emerald-700 text-white":"bg-muted text-muted-foreground cursor-not-allowed"),children:s?t.jsxs(t.Fragment,{children:[t.jsx(Rt,{className:"h-4 w-4 mr-2 animate-spin"}),"equipment"===e.craftType?"Forjando...":"Criando..."]}):e.canCraft?t.jsxs(t.Fragment,{children:[t.jsx(vt,{className:"h-4 w-4 mr-2"}),"equipment"===e.craftType?"Forjar Item":"Criar Item"]}):t.jsxs(t.Fragment,{children:[t.jsx(Ae,{className:"h-4 w-4 mr-2"}),"Materiais Insuficientes"]})})})]})},Bf=({recipe:e,isSelected:a,onClick:s})=>t.jsx("div",{onClick:s,className:Ga("p-4 border rounded-lg cursor-pointer transition-all border-l-4",(()=>{if("equipment"===e.craftType){switch(e.result.rarity){case"legendary":return"border-l-orange-500 bg-orange-500/5";case"epic":return"border-l-purple-500 bg-purple-500/5";case"rare":return"border-l-blue-500 bg-blue-500/5";case"uncommon":return"border-l-green-500 bg-green-500/5";default:return"border-l-gray-500 bg-gray-500/5"}}else{switch(e.result.type){case"elixir":return"border-l-purple-500 bg-purple-500/5";case"potion":return"border-l-red-500 bg-red-500/5";case"antidote":return"border-l-green-500 bg-green-500/5";default:return"border-l-blue-500 bg-blue-500/5"}}})(),a?"ring-2 ring-primary border-primary bg-primary/5":"hover:bg-accent/50 hover:border-accent"),children:t.jsxs("div",{className:"flex items-start gap-3",children:[t.jsx("div",{className:"shrink-0 mt-1",children:"equipment"===e.craftType?t.jsx(vt,{className:"h-4 w-4 text-blue-400"}):t.jsx(pt,{className:"h-4 w-4 text-purple-400"})}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[t.jsx("h3",{className:"font-semibold truncate",children:e.result.name}),e.canCraft?t.jsx($t,{className:"h-4 w-4 text-green-400 shrink-0"}):t.jsx(Ae,{className:"h-4 w-4 text-red-400 shrink-0"})]}),t.jsx("p",{className:"text-sm text-muted-foreground line-clamp-2 mb-2",children:e.result.description}),t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx(Nu,{variant:"outline",className:"text-xs",children:"equipment"===e.craftType?e.result.rarity:e.result.type}),t.jsxs("span",{className:"text-xs text-muted-foreground",children:[e.ingredients.length," ingredientes"]})]})]})]})});const Uf=l("/_authenticated/game/play/hub/crafting")({component:function(){const a=r(),{character:s}=Uf.useSearch(),{characters:n,selectedCharacter:i,selectCharacter:o}=Vf(),[l,c]=e.useState(!1),[d,m]=e.useState(!1),[u,h]=e.useState([]),[p,x]=e.useState([]),[f,g]=e.useState({consumables:[],drops:[],equipment:[]}),[b,v]=e.useState([]),[y,j]=e.useState([]),[N,w]=e.useState([]),[C,S]=e.useState([]),[E,k]=e.useState(null),[A,P]=e.useState(!1),[M,T]=e.useState(""),[q,D]=e.useState("all"),[L,$]=e.useState("all"),[R,I]=e.useState("all"),[F,V]=e.useState("all"),[O,B]=e.useState("all");e.useEffect((()=>{P(!0)}),[]),e.useEffect((()=>{if(A&&s&&n.length>0){const e=n.find((e=>e.id===s));!e||i&&i.id===s||o(e.id,e.name)}}),[A,s,n.length]),e.useEffect((()=>{if(!A||!i)return;(async()=>{c(!0);try{const[e,t,a,s,r,n,o,l]=await Promise.all([Bx.getCraftingRecipes(),gh.getEquipmentCraftingRecipes(),Bx.getCharacterConsumables(i.id),Bx.getCharacterDrops(i.id),gh.getCharacterEquipment(i.id),Bx.getAvailableConsumables(),Bx.getMonsterDrops(),gh.getAllEquipments()]);e.success&&e.data&&h(e.data),t.success&&t.data&&x(t.data),g({consumables:a.success&&a.data||[],drops:s.success&&s.data||[],equipment:r||[]}),n.success&&n.data&&v(n.data),o.success&&o.data&&j(o.data),l&&Array.isArray(l)&&w(l)}catch(e){_.error("Erro ao carregar receitas e inventário")}finally{c(!1)}})()}),[A,i]),e.useEffect((()=>{if(!A||!u.length&&!p.length||!i)return;(()=>{const e=[];for(const a of u)try{const t=f.consumables.find((e=>e.consumable_id===a.result_id))?.consumable,s={name:a.name,description:a.description,type:"potion"};t&&(s.name=t.name,s.description=t.description,s.type=t.type);const r=a.ingredients.map((e=>{let t="",a=0,s="drop";if("monster_drop"===e.item_type){const r=f.drops.find((t=>t.drop_id===e.item_id));if(a=r?.quantity||0,s="drop",r?.drop?.name)t=r.drop.name;else{const a=y.find((t=>t.id===e.item_id));t=a?.name||`Drop ID: ${e.item_id}`}}else if("consumable"===e.item_type){const r=f.consumables.find((t=>t.consumable_id===e.item_id));if(a=r?.quantity||0,s="consumable",r?.consumable?.name)t=r.consumable.name;else{const a=b.find((t=>t.id===e.item_id));t=a?.name||`Consumível ID: ${e.item_id}`}}else if("equipment"===e.item_type){const r=f.equipment.filter((t=>t.equipment_id===e.item_id&&!t.is_equipped));if(a=r.length,s="equipment",r[0]?.equipment?.name)t=r[0].equipment.name;else{const a=N.find((t=>t.id===e.item_id));t=a?.name||`Equipamento ID: ${e.item_id}`}}return{name:t,quantity:e.quantity,have:a,type:s}})),n=r.every((e=>e.have>=e.quantity));e.push({id:a.id,result_id:a.result_id,result:s,ingredients:r,canCraft:n,craftType:"consumable"})}catch(t){}for(const a of p)try{if(a.equipment){const t=a.ingredients.map((e=>{let t="",a=0,s="drop";if("monster_drop"===e.item_type){const r=f.drops.find((t=>t.drop_id===e.item_id));if(a=r?.quantity||0,s="drop",r?.drop?.name)t=r.drop.name;else{const a=y.find((t=>t.id===e.item_id));t=a?.name||`Drop ID: ${e.item_id}`}}else if("consumable"===e.item_type){const r=f.consumables.find((t=>t.consumable_id===e.item_id));if(a=r?.quantity||0,s="consumable",r?.consumable?.name)t=r.consumable.name;else{const a=b.find((t=>t.id===e.item_id));t=a?.name||`Consumível ID: ${e.item_id}`}}else if("equipment"===e.item_type){const r=f.equipment.filter((t=>t.equipment_id===e.item_id&&!t.is_equipped));if(a=r.length,s="equipment",r[0]?.equipment?.name)t=r[0].equipment.name;else{const a=N.find((t=>t.id===e.item_id));t=a?.name||`Equipamento ID: ${e.item_id}`}}return{name:t,quantity:e.quantity,have:a,type:s}})),s=t.every((e=>e.have>=e.quantity));e.push({id:a.id,result_equipment_id:a.result_equipment_id,result:{name:a.equipment.name,description:a.equipment.description,type:a.equipment.type,rarity:a.equipment.rarity,weapon_subtype:a.equipment.weapon_subtype||void 0,atk_bonus:a.equipment.atk_bonus||0,def_bonus:a.equipment.def_bonus||0,mana_bonus:a.equipment.mana_bonus||0,speed_bonus:a.equipment.speed_bonus||0,hp_bonus:0,level_requirement:a.equipment.level_requirement||1},ingredients:t,canCraft:s,craftType:"equipment"})}}catch(t){}if(S(e),E){const t=e.find((e=>e.id===E.id));t&&k(t)}})()}),[A,u,p,f,i,E?.id,b,y,N]);const U=e.useMemo((()=>{let e=C;return M&&(e=e.filter((e=>e.result.name.toLowerCase().includes(M.toLowerCase())||e.result.description.toLowerCase().includes(M.toLowerCase())))),"all"!==q&&(e=e.filter((e=>e.craftType===q))),"all"!==R&&(e=e.filter((e=>{if("equipment"===e.craftType){return e.result.type===R}return!0}))),"all"!==F&&(e=e.filter((e=>{if("equipment"===e.craftType){return e.result.weapon_subtype===F}return!0}))),"all"!==O&&(e=e.filter((e=>{if("equipment"===e.craftType){return e.result.rarity===O}return e.result.type===O}))),"craftable"===L?e=e.filter((e=>e.canCraft)):"missing"===L&&(e=e.filter((e=>!e.canCraft))),e}),[C,M,q,L,R,F,O]);return A?s&&""!==s.trim()?i?t.jsxs("div",{className:"container mx-auto py-6 px-4 max-w-7xl",children:[t.jsx("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-4 mb-6",children:t.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center gap-2 sm:gap-4",children:[t.jsxs(Wa,{variant:"outline",size:"sm",onClick:()=>a({to:"/game/play/hub",search:{character:i.id}}),className:"w-fit",children:[t.jsx(Pe,{className:"h-4 w-4 mr-2"}),"Voltar ao Hub"]}),t.jsxs("div",{className:"mt-2 sm:mt-0",children:[t.jsx("h1",{className:"text-2xl sm:text-3xl font-bold",children:"Forja de Artefatos"}),t.jsx("p",{className:"text-sm sm:text-base text-muted-foreground",children:"Crie poções, elixires e forje equipamentos únicos com materiais raros"})]})]})}),t.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-12 gap-6",children:[t.jsx("div",{className:"lg:col-span-5",children:t.jsxs(pu,{className:"h-full max-h-[calc(100vh-280px)]",children:[t.jsxs(xu,{className:"pb-4",children:[t.jsxs("div",{className:"flex items-center justify-between mb-4",children:[t.jsxs(fu,{className:"flex items-center gap-2",children:[t.jsx(vt,{className:"h-5 w-5"}),"Receitas Disponíveis"]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsxs(Nu,{variant:"outline",children:[U.length," de ",C.length]}),(M||"all"!==q||"all"!==L||"all"!==R||"all"!==F||"all"!==O)&&t.jsx(Wa,{variant:"ghost",size:"sm",onClick:()=>{T(""),D("all"),$("all"),I("all"),V("all"),B("all")},className:"h-6 px-2 text-xs",children:"Limpar Filtros"})]})]}),t.jsxs("div",{className:"space-y-3",children:[t.jsxs("div",{className:"relative",children:[t.jsx(Ue,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),t.jsx(Ms,{placeholder:"Buscar receita...",value:M,onChange:e=>T(e.target.value),className:"pl-9"})]}),t.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[t.jsxs(ou,{value:q,onValueChange:e=>{D(e),"equipment"!==e&&(I("all"),V("all"),B("all"))},children:[t.jsx(cu,{children:t.jsx(lu,{placeholder:"Tipo"})}),t.jsxs(uu,{children:[t.jsx(hu,{value:"all",children:"Todos os Tipos"}),t.jsx(hu,{value:"equipment",children:"Equipamentos"}),t.jsx(hu,{value:"consumable",children:"Consumíveis"})]})]}),t.jsxs(ou,{value:L,onValueChange:e=>$(e),children:[t.jsx(cu,{children:t.jsx(lu,{placeholder:"Status"})}),t.jsxs(uu,{children:[t.jsx(hu,{value:"all",children:"Todos"}),t.jsx(hu,{value:"craftable",children:"Criáveis"}),t.jsx(hu,{value:"missing",children:"Faltam Materiais"})]})]})]}),"equipment"===q&&t.jsxs("div",{className:"space-y-2",children:[t.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[t.jsxs(ou,{value:R,onValueChange:e=>{I(e),"weapon"!==e&&V("all")},children:[t.jsx(cu,{children:t.jsx(lu,{placeholder:"Tipo de Equipamento"})}),t.jsxs(uu,{children:[t.jsx(hu,{value:"all",children:"Todos Equipamentos"}),t.jsx(hu,{value:"weapon",children:"Armas"}),t.jsx(hu,{value:"armor",children:"Armaduras"}),t.jsx(hu,{value:"accessory",children:"Acessórios"})]})]}),t.jsxs(ou,{value:O,onValueChange:e=>B(e),children:[t.jsx(cu,{children:t.jsx(lu,{placeholder:"Raridade"})}),t.jsxs(uu,{children:[t.jsx(hu,{value:"all",children:"Todas Raridades"}),t.jsx(hu,{value:"common",children:"Comum"}),t.jsx(hu,{value:"uncommon",children:"Incomum"}),t.jsx(hu,{value:"rare",children:"Raro"}),t.jsx(hu,{value:"epic",children:"Épico"}),t.jsx(hu,{value:"legendary",children:"Lendário"})]})]})]}),"weapon"===R&&t.jsxs(ou,{value:F,onValueChange:e=>V(e),children:[t.jsx(cu,{children:t.jsx(lu,{placeholder:"Tipo de Arma"})}),t.jsxs(uu,{children:[t.jsx(hu,{value:"all",children:"Todas as Armas"}),t.jsx(hu,{value:"sword",children:"Espadas"}),t.jsx(hu,{value:"axe",children:"Machados"}),t.jsx(hu,{value:"blunt",children:"Maças"}),t.jsx(hu,{value:"staff",children:"Cajados"}),t.jsx(hu,{value:"dagger",children:"Adagas"})]})]})]})]})]}),t.jsx(bu,{className:"flex-1 overflow-hidden",children:l?t.jsxs("div",{className:"flex items-center justify-center h-64",children:[t.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-2 border-primary border-t-transparent"}),t.jsx("span",{className:"ml-2 text-muted-foreground",children:"Carregando receitas..."})]}):U.length>0?t.jsx("div",{className:"space-y-2 h-full max-h-96 overflow-y-auto pr-2 scrollbar-thin scrollbar-thumb-border scrollbar-track-transparent",children:U.map((e=>t.jsx(Bf,{recipe:e,isSelected:E?.id===e.id,onClick:()=>k(e)},e.id)))}):t.jsxs("div",{className:"flex flex-col items-center justify-center h-64 text-center",children:[t.jsx(wt,{className:"h-12 w-12 text-muted-foreground mb-3"}),t.jsx("p",{className:"text-muted-foreground text-lg",children:"Nenhuma receita encontrada"}),t.jsx("p",{className:"text-muted-foreground text-sm mt-1",children:"Tente ajustar os filtros ou explore a torre para encontrar novas receitas"})]})})]})}),t.jsx("div",{className:"lg:col-span-7",children:t.jsx(pu,{className:"h-full max-h-[calc(100vh-280px)] overflow-hidden",children:t.jsx("div",{className:"h-full overflow-y-auto",children:t.jsx(Of,{recipe:E,onCraft:async(e,t)=>{if(i&&!d){m(!0);try{let a;if(a="consumable"===t?await Bx.craftItem(i.id,e):await gh.craftEquipment(i.id,e),a.success){_.success("Item criado com sucesso!",{description:a.data?.message});const[e,t,s]=await Promise.all([Bx.getCharacterConsumables(i.id),Bx.getCharacterDrops(i.id),gh.getCharacterEquipment(i.id)]);g({consumables:e.success?e.data||[]:f.consumables,drops:t.success?t.data||[]:f.drops,equipment:s||f.equipment})}else _.error("Erro ao criar item",{description:a.error})}catch(a){_.error("Erro ao criar item")}finally{m(!1)}}},isCrafting:d,selectedCharacter:i})})})})]})]}):t.jsx("div",{className:"container mx-auto py-6 text-center",children:t.jsx("p",{children:"Carregando personagem..."})}):t.jsxs("div",{className:"container mx-auto py-6 text-center",children:[t.jsx("p",{children:"Redirecionando para seleção de personagem..."}),t.jsx(Wa,{onClick:()=>a({to:"/game/play"}),children:"Selecionar Personagem"})]}):t.jsx("div",{className:"container mx-auto py-6 text-center",children:t.jsx("p",{children:"Carregando..."})})},validateSearch:e=>{const t=e.character;return t&&"string"==typeof t?{character:t.trim()}:{character:""}}});function zf(){const[t,a]=e.useState(!1);return e.useEffect((()=>{if("undefined"==typeof window)return;const e=()=>{const e=window.innerWidth,t=window.innerHeight;a(e>t&&t<=500&&e<=1024)};return e(),window.addEventListener("resize",e),window.addEventListener("orientationchange",(()=>{setTimeout(e,100)})),()=>{window.removeEventListener("resize",e),window.removeEventListener("orientationchange",e)}}),[]),t}function Hf(){const[t,a]=e.useState(!1);return e.useEffect((()=>{if("undefined"==typeof window)return;const e=()=>{const e=window.innerWidth,t=window.innerHeight;a(e>t&&(e>=480&&e<=1024)&&(t>=320&&t<=600))};return e(),window.addEventListener("resize",e),window.addEventListener("orientationchange",(()=>{setTimeout(e,100)})),()=>{window.removeEventListener("resize",e),window.removeEventListener("orientationchange",e)}}),[]),t}function Gf({icon:a,label:s,value:r,color:n,bgColor:i,borderColor:o,tooltipData:l}){const[c,d]=e.useState(!1),m=function(t){const[a,s]=e.useState(!1);return e.useEffect((()=>{if("undefined"==typeof window)return;const e=window.matchMedia(t);s(e.matches);const a=e=>{s(e.matches)};return e.addEventListener?e.addEventListener("change",a):e.addListener(a),()=>{e.removeEventListener?e.removeEventListener("change",a):e.removeListener(a)}}),[t]),a}("(max-width: 768px)"),{elementRef:u,tooltipPosition:h,updatePosition:p}=function(){const t=e.useRef(null),[a,s]=e.useState("right"),r=e.useCallback((()=>{if(!t.current)return;const e=t.current,a=e.getBoundingClientRect();let r=e.parentElement;for(;r&&!r.classList.contains("grid");)r=r.parentElement;if(!r)return void s("right");const n=r.getBoundingClientRect(),i=n.width,o=a.left+a.width/2-n.left;s(o<i/3?"right":o>2*i/3?"left":"bottom")}),[]);return e.useEffect((()=>{r();const e=()=>r();return window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)}),[r]),{elementRef:t,tooltipPosition:a,updatePosition:r}}(),x=()=>t.jsxs("div",{className:"bg-slate-900 border border-slate-700 rounded-lg p-3 shadow-xl",children:[t.jsx("div",{className:"text-sm font-medium text-slate-200 mb-2",children:l.title}),t.jsxs("div",{className:"text-xs text-slate-300 font-mono space-y-1",children:[l.calculations.map(((e,a)=>t.jsxs("div",{className:"flex justify-between",children:[t.jsx("span",{children:e.label}),t.jsx("span",{className:e.color,children:e.value})]},a))),t.jsxs("div",{className:"border-t border-slate-600 pt-1 mt-1 flex justify-between font-bold",children:[t.jsx("span",{children:l.total.label}),t.jsx("span",{className:l.total.color,children:l.total.value})]})]})]});return t.jsxs(t.Fragment,{children:[t.jsxs("div",{ref:u,className:`p-3 rounded-lg border ${i} ${o} ${m?"cursor-pointer":"cursor-help group"} relative`,onClick:()=>{m&&d(!0)},onMouseEnter:()=>{m||p()},title:m?`Toque para ver a fórmula de ${s}`:"Clique para ver a fórmula",children:[t.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[t.jsx(a,{className:`h-4 w-4 ${n}`}),t.jsx("span",{className:`text-sm font-medium ${n}`,children:s})]}),t.jsx("div",{className:`text-2xl font-bold ${n}`,children:"number"==typeof r?r.toLocaleString():r}),!m&&t.jsx("div",{className:"absolute z-50 invisible group-hover:visible min-w-[280px] "+("left"===h?"right-full mr-2 -top-2":"right"===h?"left-full ml-2 -top-2":"top-full mt-2 left-1/2 transform -translate-x-1/2"),children:t.jsx(x,{})})]}),m&&t.jsx(_h,{open:c,onOpenChange:d,children:t.jsxs(Sh,{className:"max-w-sm",children:[t.jsx(Eh,{children:t.jsxs(Ah,{className:"flex items-center gap-2",children:[t.jsx(a,{className:`h-5 w-5 ${n}`}),"Fórmula de ",s]})}),t.jsxs("div",{className:"space-y-2",children:[l.calculations.map(((e,a)=>t.jsxs("div",{className:"flex justify-between text-sm",children:[t.jsx("span",{className:"text-muted-foreground",children:e.label}),t.jsx("span",{className:`font-mono ${e.color}`,children:e.value})]},a))),t.jsxs("div",{className:"border-t pt-2 flex justify-between font-bold",children:[t.jsx("span",{children:l.total.label}),t.jsx("span",{className:`${l.total.color}`,children:l.total.value})]})]})]})})]})}class Xf{static async convertToGamePlayer(e){const t=await hh.calculateDerivedStats(e);return{id:e.id,user_id:e.user_id,name:e.name,level:e.level,xp:e.xp,xp_next_level:e.xp_next_level,gold:e.gold,hp:e.hp||t.hp,max_hp:e.max_hp||t.max_hp,mana:e.mana||t.mana,max_mana:e.max_mana||t.max_mana,atk:e.atk||t.atk,def:e.def||t.def,speed:e.speed||t.speed,created_at:e.created_at,updated_at:e.updated_at,floor:e.floor,strength:e.strength||10,dexterity:e.dexterity||10,intelligence:e.intelligence||10,wisdom:e.wisdom||10,vitality:e.vitality||10,luck:e.luck||10,attribute_points:e.attribute_points||0,sword_mastery:e.sword_mastery||1,axe_mastery:e.axe_mastery||1,blunt_mastery:e.blunt_mastery||1,defense_mastery:e.defense_mastery||1,magic_mastery:e.magic_mastery||1,sword_mastery_xp:e.sword_mastery_xp||0,axe_mastery_xp:e.axe_mastery_xp||0,blunt_mastery_xp:e.blunt_mastery_xp||0,defense_mastery_xp:e.defense_mastery_xp||0,magic_mastery_xp:e.magic_mastery_xp||0,critical_chance:t.critical_chance,critical_damage:t.critical_damage,magic_damage_bonus:t.magic_damage_bonus,magic_attack:t.magic_attack,double_attack_chance:t.double_attack_chance,base_hp:e.hp||t.hp,base_max_hp:e.max_hp||t.max_hp,base_mana:e.mana||t.mana,base_max_mana:e.max_mana||t.max_mana,base_atk:e.atk||t.atk,base_def:e.def||t.def,base_speed:e.speed||t.speed,equipment_hp_bonus:0,equipment_mana_bonus:0,equipment_atk_bonus:0,equipment_def_bonus:0,equipment_speed_bonus:0,isPlayerTurn:!0,specialCooldown:0,defenseCooldown:0,isDefending:!1,spells:[],consumables:[],active_effects:{buffs:[],debuffs:[],dots:[],hots:[],attribute_modifications:[]}}}static convertToCharacterStats(e){return{level:e.level,xp:e.xp,xp_next_level:e.xp_next_level,gold:e.gold,hp:e.hp,max_hp:e.max_hp,mana:e.mana,max_mana:e.max_mana,atk:e.atk,def:e.def,speed:e.speed,strength:e.strength||10,dexterity:e.dexterity||10,intelligence:e.intelligence||10,wisdom:e.wisdom||10,vitality:e.vitality||10,luck:e.luck||10,attribute_points:e.attribute_points||0,critical_chance:e.critical_chance||0,critical_damage:e.critical_damage||0,magic_damage_bonus:e.magic_damage_bonus||0,magic_attack:e.magic_attack||0,sword_mastery:e.sword_mastery||1,axe_mastery:e.axe_mastery||1,blunt_mastery:e.blunt_mastery||1,defense_mastery:e.defense_mastery||1,magic_mastery:e.magic_mastery||1,sword_mastery_xp:e.sword_mastery_xp||0,axe_mastery_xp:e.axe_mastery_xp||0,blunt_mastery_xp:e.blunt_mastery_xp||0,defense_mastery_xp:e.defense_mastery_xp||0,magic_mastery_xp:e.magic_mastery_xp||0,base_hp:e.base_hp||e.hp,base_max_hp:e.base_max_hp||e.max_hp,base_mana:e.base_mana||e.mana,base_max_mana:e.base_max_mana||e.max_mana,base_atk:e.base_atk||e.atk,base_def:e.base_def||e.def,base_speed:e.base_speed||e.speed,equipment_hp_bonus:e.equipment_hp_bonus||0,equipment_mana_bonus:e.equipment_mana_bonus||0,equipment_atk_bonus:e.equipment_atk_bonus||0,equipment_def_bonus:e.equipment_def_bonus||0,equipment_speed_bonus:e.equipment_speed_bonus||0}}static async getDerivedStats(e){return await hh.calculateDerivedStats(e)}static async calculatePreviewImprovements(e,t){const a=await hh.calculateDerivedStats(e),s={...e,strength:(e.strength||10)+t.strength,dexterity:(e.dexterity||10)+t.dexterity,intelligence:(e.intelligence||10)+t.intelligence,wisdom:(e.wisdom||10)+t.wisdom,vitality:(e.vitality||10)+t.vitality,luck:(e.luck||10)+t.luck},r=await hh.calculateDerivedStats(s);return{hp:r.max_hp-a.max_hp,mana:r.max_mana-a.max_mana,atk:r.atk-a.atk,speed:r.speed-a.speed,critChance:r.critical_chance-a.critical_chance}}static async getStatsBreakdown(e){const t=e.level,a=e.strength||10,s=e.dexterity||10,r=e.intelligence||10,n=e.wisdom||10,i=e.vitality||10,o=e.luck||10,l=Math.pow(a,1.1),c=Math.pow(s,1.1),d=Math.pow(r,1.1),m=Math.pow(n,1.05),u=Math.pow(i,1.2),h=o,p=e.sword_mastery||1,x=e.axe_mastery||1,f=e.blunt_mastery||1,g=e.defense_mastery||1,b=e.magic_mastery||1,v=Math.pow(Math.max(p,x,f),1.05),y=Math.pow(g,1.1),j=Math.pow(b,1.05),N=50+2*t,_=Math.floor(1.5*u),w=Math.floor(.2*l),C=e.equipment_hp_bonus||0,S=20+1*t,E=Math.floor(1*d),k=Math.floor(.8*m),A=Math.floor(.5*j),P=e.equipment_mana_bonus||0,M=2+t,T=Math.floor(.8*l),q=Math.floor(.4*v),D=Math.floor(.1*c),L=e.equipment_atk_bonus||0,$=1+t,R=Math.floor(.4*u),I=Math.floor(.3*m),F=Math.floor(.8*y),V=e.equipment_def_bonus||0,O=3+t,B=Math.floor(.8*c),U=Math.floor(.1*h),z=e.equipment_speed_bonus||0,H=.15*c,G=.25*h,X=.05*l,W=.1*v,Y=.3*l,K=.2*h,J=.4*v,Q=.8*d,Z=.4*m,ee=1*j;return{hp:{base:N,fromAttributes:_+w,fromMasteries:0,fromEquipment:C,total:N+_+w+C},mana:{base:S,fromAttributes:E+k,fromMasteries:A,fromEquipment:P,total:S+E+k+A+P},atk:{base:M,fromAttributes:T+D,fromMasteries:q,fromEquipment:L,total:M+T+q+D+L},def:{base:$,fromAttributes:R+I,fromMasteries:F,fromEquipment:V,total:$+R+I+F+V},speed:{base:O,fromAttributes:B+U,fromMasteries:0,fromEquipment:z,total:O+B+U+z},criticalChance:{base:1,fromAttributes:H+G+X,fromMasteries:W,fromEquipment:0,total:Math.min(60,1+H+G+X+W)},criticalDamage:{base:102,fromAttributes:Y+K,fromMasteries:J,fromEquipment:0,total:Math.min(200,102+Y+K+J)},magicDamage:{base:2,fromAttributes:Q+Z,fromMasteries:ee,fromEquipment:0,total:Math.min(150,2+Q+Z+ee)}}}static formatValueWithEquipmentBonus(e,t){const a=t||0,s=e+a;return{totalValue:s,baseValue:e,equipmentBonus:a,hasBonus:a>0,formattedTotal:s.toLocaleString(),formattedBonus:a>0?`(+${a})`:""}}static calculateXpProgress(e){const t=(a=e.level)<=1?0:Math.floor(100*Math.pow(1.5,a-2));var a;const s=e.xp_next_level,r=e.xp-t,n=s-t;return{xpInCurrentLevel:r,xpNeededForNextLevel:n,xpProgress:Math.max(0,Math.min(100,r/n*100))}}static calculateHealthProgress(e){return{hpProgress:e.max_hp>0?Math.max(0,Math.min(100,e.hp/e.max_hp*100)):0,manaProgress:e.max_mana>0?Math.max(0,Math.min(100,e.mana/e.max_mana*100)):0}}static validateCharacterConsistency(e){const t=[];e.hp>e.max_hp&&t.push(`HP atual (${e.hp}) maior que HP máximo (${e.max_hp})`),e.mana>e.max_mana&&t.push(`Mana atual (${e.mana}) maior que Mana máximo (${e.max_mana})`);return[e.strength||10,e.dexterity||10,e.intelligence||10,e.wisdom||10,e.vitality||10,e.luck||10].some((e=>e<1||e>100))&&t.push("Atributos fora do range válido (1-100)"),(e.level<1||e.level>100)&&t.push(`Nível inválido: ${e.level}`),{isValid:0===t.length,issues:t}}}function Wf({characterStats:e}){const[a,s]=m.useState(null);if(m.useEffect((()=>{Xf.getStatsBreakdown(e).then(s)}),[e.strength,e.dexterity,e.intelligence,e.wisdom,e.vitality,e.luck,e.level]),!a)return t.jsxs(pu,{children:[t.jsx(xu,{children:t.jsxs(fu,{className:"flex items-center gap-2",children:[t.jsx(It,{className:"h-5 w-5"}),"Stats Derivados"]})}),t.jsx(bu,{children:t.jsx("div",{className:"animate-pulse space-y-4",children:[1,2,3,4].map((e=>t.jsx("div",{className:"h-16 bg-muted/20 rounded-lg"},e)))})})]});const r=(e,t,a=0,s)=>{const r=[{label:"Base:",value:t.base,color:"text-blue-400"},{label:"Atributos:",value:`+${t.fromAttributes}`,color:"text-green-400"}];return t.fromMasteries>0&&r.push({label:"Maestrias:",value:`+${t.fromMasteries}`,color:"text-purple-400"}),a>0&&r.push({label:"Equipamentos:",value:`+${a}`,color:"text-orange-400"}),{title:e,calculations:r,total:{label:"Total (Sistema):",value:s.toLocaleString(),color:"text-green-400"}}},n=[{icon:Be,label:"HP Máximo",value:(()=>{const a=Xf.formatValueWithEquipmentBonus(e.max_hp-(e.equipment_hp_bonus||0),e.equipment_hp_bonus||0);return a.hasBonus?t.jsxs("span",{children:[a.formattedTotal,t.jsx("span",{className:"text-orange-400 text-sm ml-1 font-medium",children:a.formattedBonus})]}):t.jsx("span",{children:a.formattedTotal})})(),color:"text-red-400",bgColor:"bg-red-500/5",borderColor:"border-red-500/20",tooltipData:r("Cálculo do HP:",a.hp,e.equipment_hp_bonus||0,e.max_hp)},{icon:Ft,label:"Mana Máxima",value:(()=>{const a=Xf.formatValueWithEquipmentBonus(e.max_mana-(e.equipment_mana_bonus||0),e.equipment_mana_bonus||0);return a.hasBonus?t.jsxs("span",{children:[a.formattedTotal,t.jsx("span",{className:"text-orange-400 text-sm ml-1 font-medium",children:a.formattedBonus})]}):t.jsx("span",{children:a.formattedTotal})})(),color:"text-blue-400",bgColor:"bg-blue-500/5",borderColor:"border-blue-500/20",tooltipData:r("Cálculo da Mana:",a.mana,e.equipment_mana_bonus||0,e.max_mana)},{icon:qe,label:"ATK Físico",value:(()=>{const a=Xf.formatValueWithEquipmentBonus(e.atk-(e.equipment_atk_bonus||0),e.equipment_atk_bonus||0);return a.hasBonus?t.jsxs("span",{children:[a.formattedTotal,t.jsx("span",{className:"text-orange-400 text-sm ml-1 font-medium",children:a.formattedBonus})]}):t.jsx("span",{children:a.formattedTotal})})(),color:"text-red-400",bgColor:"bg-red-500/5",borderColor:"border-red-500/20",tooltipData:r("Cálculo do ATK Físico:",a.atk,e.equipment_atk_bonus||0,e.atk)},...e.magic_attack&&e.magic_attack>0?[{icon:pt,label:"ATK Mágico",value:t.jsx("span",{children:e.magic_attack.toLocaleString()}),color:"text-purple-400",bgColor:"bg-purple-500/5",borderColor:"border-purple-500/20",tooltipData:r("Cálculo do ATK Mágico:",a.atk,0,e.magic_attack)}]:[],{icon:De,label:"Defesa",value:(()=>{const a=Xf.formatValueWithEquipmentBonus(e.def-(e.equipment_def_bonus||0),e.equipment_def_bonus||0);return a.hasBonus?t.jsxs("span",{children:[a.formattedTotal,t.jsx("span",{className:"text-orange-400 text-sm ml-1 font-medium",children:a.formattedBonus})]}):t.jsx("span",{children:a.formattedTotal})})(),color:"text-blue-400",bgColor:"bg-blue-500/5",borderColor:"border-blue-500/20",tooltipData:r("Cálculo da Defesa:",a.def,e.equipment_def_bonus||0,e.def)},{icon:Le,label:"Velocidade",value:(()=>{const a=Xf.formatValueWithEquipmentBonus(e.speed-(e.equipment_speed_bonus||0),e.equipment_speed_bonus||0);return a.hasBonus?t.jsxs("span",{children:[a.formattedTotal,t.jsx("span",{className:"text-orange-400 text-sm ml-1 font-medium",children:a.formattedBonus})]}):t.jsx("span",{children:a.formattedTotal})})(),color:"text-yellow-400",bgColor:"bg-yellow-500/5",borderColor:"border-yellow-500/20",tooltipData:r("Cálculo da Velocidade:",a.speed,e.equipment_speed_bonus||0,e.speed)},{icon:ft,label:"Chance Crítica",value:t.jsxs("span",{children:[e.critical_chance.toFixed(1),"%"]}),color:"text-yellow-400",bgColor:"bg-yellow-500/5",borderColor:"border-yellow-500/20",tooltipData:r("Cálculo da Chance Crítica:",a.criticalChance,0,e.critical_chance)},{icon:bt,label:"Dano Crítico",value:t.jsxs("span",{children:[e.critical_damage.toFixed(0),"%"]}),color:"text-orange-400",bgColor:"bg-orange-500/5",borderColor:"border-orange-500/20",tooltipData:r("Cálculo do Dano Crítico:",a.criticalDamage,0,e.critical_damage)},{icon:pt,label:"Bônus Mágico",value:t.jsxs("span",{children:[e.magic_damage_bonus?.toFixed(1)||"0.0","%"]}),color:"text-purple-400",bgColor:"bg-purple-500/5",borderColor:"border-purple-500/20",tooltipData:r("Cálculo do Bônus Mágico:",a.magicDamage,0,e.magic_damage_bonus||0)}];return t.jsxs(pu,{children:[t.jsx(xu,{children:t.jsxs(fu,{className:"flex items-center gap-2",children:[t.jsx(It,{className:"h-5 w-5"}),"Stats Derivados"]})}),t.jsx(bu,{children:t.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:n.map(((e,a)=>t.jsx(Gf,{icon:e.icon,label:e.label,value:e.value,color:e.color,bgColor:e.bgColor,borderColor:e.borderColor,tooltipData:e.tooltipData},a)))})})]})}const Yf=l("/_authenticated/game/play/hub/character-stats")({component:function(){const a=r(),{character:s}=Yf.useSearch(),[n,i]=e.useState(null),[o,l]=e.useState(!0),[c,d]=e.useState(!1),[m,u]=e.useState({strength:0,dexterity:0,intelligence:0,wisdom:0,vitality:0,luck:0}),h=e.useCallback((async(e=!1)=>{if(s&&""!==s.trim())try{l(!0);const t=e||!0,r=await Nh.getCharacterForGame(s,t,!0);if(r.success&&r.data){const e=r.data,t={level:e.level,xp:e.xp,xp_next_level:e.xp_next_level,gold:e.gold,hp:e.hp,max_hp:e.max_hp,mana:e.mana,max_mana:e.max_mana,atk:e.atk,magic_attack:e.magic_attack,def:e.def,speed:e.speed,strength:e.strength||10,dexterity:e.dexterity||10,intelligence:e.intelligence||10,wisdom:e.wisdom||10,vitality:e.vitality||10,luck:e.luck||10,attribute_points:e.attribute_points||0,critical_chance:e.critical_chance||0,critical_damage:e.critical_damage||130,magic_damage_bonus:e.magic_damage_bonus||0,sword_mastery:e.sword_mastery||1,axe_mastery:e.axe_mastery||1,blunt_mastery:e.blunt_mastery||1,defense_mastery:e.defense_mastery||1,magic_mastery:e.magic_mastery||1,sword_mastery_xp:e.sword_mastery_xp||0,axe_mastery_xp:e.axe_mastery_xp||0,blunt_mastery_xp:e.blunt_mastery_xp||0,defense_mastery_xp:e.defense_mastery_xp||0,magic_mastery_xp:e.magic_mastery_xp||0,base_hp:e.base_hp,base_max_hp:e.base_max_hp,base_mana:e.base_mana,base_max_mana:e.base_max_mana,base_atk:e.base_atk,base_def:e.base_def,base_speed:e.base_speed,equipment_hp_bonus:e.equipment_hp_bonus,equipment_mana_bonus:e.equipment_mana_bonus,equipment_atk_bonus:e.equipment_atk_bonus,equipment_def_bonus:e.equipment_def_bonus,equipment_speed_bonus:e.equipment_speed_bonus};i(t)}else _.error("Erro ao carregar stats do personagem",{description:r.error}),a({to:"/game/play/hub",search:{character:s}})}catch(t){_.error("Erro ao carregar stats do personagem"),a({to:"/game/play/hub",search:{character:s}})}finally{l(!1)}else a({to:"/game/play"})}),[s,a]);e.useEffect((()=>{s&&h()}),[s]);const p=Object.values(m).reduce(((e,t)=>e+t),0),x=(n?.attribute_points||0)-p,f=()=>{u({strength:0,dexterity:0,intelligence:0,wisdom:0,vitality:0,luck:0})},[g,b]=e.useState(null);e.useEffect((()=>{n&&p>0?Xf.calculatePreviewImprovements(n,m).then(b).catch((e=>{b(null)})):b(null)}),[n,m,p]);const v={strength:{label:"Força",icon:Fe,color:"text-red-400",bgColor:"bg-red-500/10",borderColor:"border-red-500/20",description:"Aumenta dano físico e capacidade de carga"},dexterity:{label:"Destreza",icon:Le,color:"text-green-400",bgColor:"bg-green-500/10",borderColor:"border-green-500/20",description:"Aumenta velocidade e chance de crítico"},intelligence:{label:"Inteligência",icon:pt,color:"text-purple-400",bgColor:"bg-purple-500/10",borderColor:"border-purple-500/20",description:"Aumenta dano mágico e pontos de mana"},wisdom:{label:"Sabedoria",icon:xt,color:"text-blue-400",bgColor:"bg-blue-500/10",borderColor:"border-blue-500/20",description:"Aumenta regeneração de mana e resistência"},vitality:{label:"Vitalidade",icon:Be,color:"text-pink-400",bgColor:"bg-pink-500/10",borderColor:"border-pink-500/20",description:"Aumenta pontos de vida e regeneração"},luck:{label:"Sorte",icon:ft,color:"text-yellow-400",bgColor:"bg-yellow-500/10",borderColor:"border-yellow-500/20",description:"Aumenta chance de drops raros e críticos"}};if(o)return t.jsx("div",{className:"flex items-center justify-center min-h-screen",children:t.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-purple-500"})});if(!n)return t.jsx("div",{className:"flex items-center justify-center min-h-screen",children:t.jsxs("div",{className:"text-center",children:[t.jsx("h2",{className:"text-2xl font-bold mb-2",children:"Erro ao carregar"}),t.jsx("p",{className:"text-muted-foreground mb-4",children:"Não foi possível carregar os stats do personagem"}),t.jsx(Wa,{onClick:()=>a({to:"/game/play/hub",search:{character:s}}),children:"Voltar ao Hub"})]})});return t.jsx("div",{className:"min-h-screen bg-gradient-to-b from-background to-secondary p-4 overflow-visible",children:t.jsxs("div",{className:"max-w-6xl mx-auto space-y-6",children:[t.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[t.jsxs("div",{className:"flex flex-col items-start gap-4",children:[t.jsxs(Wa,{variant:"outline",size:"sm",onClick:()=>a({to:"/game/play/hub",search:{character:s}}),className:"w-fit",children:[t.jsx(Pe,{className:"h-4 w-4 mr-2"}),"Voltar ao Hub"]}),t.jsxs("div",{children:[t.jsx("h1",{className:"text-2xl sm:text-3xl font-bold",children:"Atributos & Habilidades"}),t.jsx("p",{className:"text-sm text-muted-foreground",children:"Gerencie os stats do seu personagem"})]})]}),n.attribute_points>0&&t.jsxs(Nu,{variant:"outline",className:"bg-yellow-500/10 border-yellow-500/30 text-yellow-400 px-3 py-1",children:[t.jsx(ft,{className:"h-4 w-4 mr-2"}),x," pontos disponíveis"]})]}),t.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 overflow-visible",children:[t.jsxs(pu,{children:[t.jsx(xu,{children:t.jsxs(fu,{className:"flex items-center gap-2",children:[t.jsx(Fe,{className:"h-5 w-5"}),"Atributos Primários"]})}),t.jsxs(bu,{className:"space-y-4",children:[Object.entries(v).map((([e,a])=>{const s=e,r=n[s]||0,i=a.icon;return t.jsxs(Jm.div,{className:`flex items-center gap-4 p-4 rounded-lg border ${a.bgColor} ${a.borderColor}`,whileHover:{scale:1.01},children:[t.jsxs("div",{className:"flex items-center gap-3 flex-1",children:[t.jsx(i,{className:`h-5 w-5 ${a.color}`}),t.jsxs("div",{className:"flex-1",children:[t.jsx("div",{className:"font-semibold text-sm",children:a.label}),t.jsx("div",{className:"text-xs text-muted-foreground",children:a.description})]})]}),t.jsxs("div",{className:"text-center min-w-[80px]",children:[t.jsxs("div",{className:"text-lg font-bold",children:[r,m[s]>0&&t.jsxs("span",{className:"text-green-400 ml-1 text-sm",children:["+",m[s]]})]}),t.jsxs("div",{className:"text-xs text-muted-foreground",children:[r+m[s],"/50"]})]}),n.attribute_points>0&&t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(Wa,{size:"icon",variant:"ghost",className:"h-8 w-8 rounded-full",onClick:()=>(e=>{m[e]>0&&u((t=>({...t,[e]:t[e]-1})))})(s),disabled:0===m[s],children:t.jsx(_t,{className:"h-4 w-4"})}),t.jsx("div",{className:"w-8 text-center text-sm font-mono",children:m[s]}),t.jsx(Wa,{size:"icon",variant:"ghost",className:"h-8 w-8 rounded-full",onClick:()=>(e=>{x>0&&u((t=>({...t,[e]:t[e]+1})))})(s),disabled:0===x,children:t.jsx(Ke,{className:"h-4 w-4"})})]})]},s)})),n.attribute_points>0&&p>0&&t.jsx(Qo,{children:t.jsxs(Jm.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},className:"border-t pt-4 mt-4",children:[t.jsxs("div",{className:"bg-primary/5 border border-primary/20 rounded-lg p-3 mb-4",children:[t.jsxs("div",{className:"text-sm font-medium mb-2 flex items-center gap-2",children:[t.jsx(pt,{className:"h-4 w-4 text-primary"}),"Preview dos Melhoramentos (Sistema Real)"]}),t.jsx("div",{className:"grid grid-cols-2 gap-2 text-xs",children:(()=>{if(!g)return t.jsx("div",{className:"col-span-2 text-center text-muted-foreground",children:"Calculando melhoramentos..."});const e=g;return e.hp>0||e.mana>0||e.atk>0||e.speed>0||e.critChance>0?t.jsxs(t.Fragment,{children:[e.hp>0&&t.jsxs("div",{className:"flex justify-between",children:[t.jsx("span",{children:"HP:"}),t.jsxs("span",{className:"text-green-400",children:["+",e.hp]})]}),e.mana>0&&t.jsxs("div",{className:"flex justify-between",children:[t.jsx("span",{children:"Mana:"}),t.jsxs("span",{className:"text-blue-400",children:["+",e.mana]})]}),e.atk>0&&t.jsxs("div",{className:"flex justify-between",children:[t.jsx("span",{children:"Ataque:"}),t.jsxs("span",{className:"text-red-400",children:["+",e.atk]})]}),e.speed>0&&t.jsxs("div",{className:"flex justify-between",children:[t.jsx("span",{children:"Velocidade:"}),t.jsxs("span",{className:"text-green-400",children:["+",e.speed]})]}),e.critChance>0&&t.jsxs("div",{className:"flex justify-between",children:[t.jsx("span",{children:"Crítico:"}),t.jsxs("span",{className:"text-yellow-400",children:["+",e.critChance.toFixed(1),"%"]})]})]}):t.jsx("div",{className:"col-span-2 text-center text-muted-foreground",children:"Nenhum melhoramento detectado"})})()})]}),t.jsxs("div",{className:"flex gap-2",children:[t.jsxs(Wa,{variant:"outline",onClick:f,className:"flex-1",children:[t.jsx(Vt,{className:"h-4 w-4 mr-2"}),"Resetar"]}),t.jsxs(Wa,{onClick:async()=>{if(0!==p&&s){d(!0);try{const e=await Nh.distributeAttributePoints(s,m);e.success?(_.success("Pontos distribuídos com sucesso!"),f(),i(null),await h(!0)):_.error("Erro ao distribuir pontos",{description:e.error})}catch(e){_.error("Erro ao distribuir pontos")}finally{d(!1)}}},disabled:c,className:"flex-1 bg-emerald-500 hover:bg-emerald-600",children:[c?t.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-2 border-white border-t-transparent mr-2"}):t.jsx(Ot,{className:"h-4 w-4 mr-2"}),"Confirmar"]})]})]})})]})]}),t.jsx(Wf,{characterStats:n},`${n.strength}-${n.dexterity}-${n.intelligence}-${n.wisdom}-${n.vitality}-${n.luck}-${n.attribute_points}`),t.jsxs(pu,{className:"lg:col-span-2",children:[t.jsx(xu,{children:t.jsxs(fu,{className:"flex items-center gap-2",children:[t.jsx(pt,{className:"h-5 w-5"}),"Habilidades de Combate"]})}),t.jsx(bu,{children:t.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:Object.values(ih).map((e=>{const a=(e=>{switch(e){case ih.SWORD_MASTERY:return qe;case ih.AXE_MASTERY:return Le;case ih.BLUNT_MASTERY:return bt;case ih.DEFENSE_MASTERY:return De;case ih.MAGIC_MASTERY:return pt}})(e),s=n[`${e}_mastery`],r=n[`${e}_mastery_xp`],i=(o=s,Math.floor(50*Math.pow(1.4,o-1)));var o;const l=r/i*100;return t.jsxs("div",{className:"bg-card p-4 rounded-lg border",children:[t.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[t.jsx(a,{className:"h-5 w-5 text-primary"}),t.jsxs("div",{className:"flex-1",children:[t.jsx("h3",{className:"font-semibold capitalize",children:e.replace("_"," ")}),t.jsxs("div",{className:"text-sm text-muted-foreground",children:["Nível ",s]})]})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsxs("div",{className:"flex justify-between text-sm",children:[t.jsxs("span",{children:["XP: ",r,"/",i]}),t.jsxs("span",{children:[Math.round(l),"%"]})]}),t.jsx(Gh,{value:l,className:"h-2"})]}),t.jsx("p",{className:"text-xs text-muted-foreground mt-2",children:oh(e)})]},e)}))})})]})]})]})})},validateSearch:e=>{const t=e.character;return t&&"string"==typeof t&&""!==t.trim()?{character:t.trim()}:{character:""}}});function Kf({className:a="",showHeader:s=!0,collapsible:r=!1}){const{user:n}=Oa(),[i,o]=e.useState([]),[l,c]=e.useState(null),[d,m]=e.useState(!0),[u,h]=e.useState(1),[p,x]=e.useState(!1),[f,g]=e.useState(0),[b,v]=e.useState(!1),[y,j]=e.useState(null);e.useEffect((()=>{n?.id&&N()}),[n?.id,u]);const N=async()=>{if(n?.id){m(!0);try{const e=await wf.getUserCemetery(n.id,{page:u,limit:6});e.success&&e.data?(o(e.data.characters),c(e.data.stats),g(e.data.total),x(e.data.hasMore)):_.error("Erro ao carregar cemitério",{description:e.error||"Erro desconhecido"})}catch(e){_.error("Erro ao carregar cemitério")}finally{m(!1)}}},w=e=>wf.formatSurvivalTime(e),C=(e,t)=>wf.formatDeathCause(e,t),S=e=>new Date(e).toLocaleDateString("pt-BR",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"});return d&&0===i.length?t.jsxs(pu,{className:a,children:[s&&t.jsx(xu,{className:"pb-4",children:t.jsxs(fu,{className:"flex items-center gap-2",children:[t.jsx($e,{className:"h-5 w-5 text-red-500"}),"Cemitério"]})}),t.jsx(bu,{children:t.jsx("div",{className:"flex items-center justify-center py-8",children:t.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-red-500"})})})]}):l&&0!==l.total_deaths?t.jsxs(pu,{className:a,children:[s&&t.jsx(xu,{className:"pb-4",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs(fu,{className:"flex items-center gap-2",children:[t.jsx($e,{className:"h-5 w-5 text-red-500"}),"Cemitério",t.jsxs(Nu,{variant:"destructive",className:"ml-2",children:[l.total_deaths," mort",1===l.total_deaths?"e":"es"]})]}),r&&t.jsx(Wa,{variant:"ghost",size:"sm",onClick:()=>v(!b),children:b?t.jsx(xt,{className:"h-4 w-4"}):t.jsx(ze,{className:"h-4 w-4"})})]})}),(!r||!b)&&t.jsxs(bu,{className:"space-y-6",children:[t.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[t.jsxs("div",{className:"bg-red-500/10 border border-red-500/20 rounded-lg p-3 text-center",children:[t.jsx(ae,{className:"h-6 w-6 mx-auto mb-2 text-red-400"}),t.jsx("div",{className:"text-sm text-muted-foreground",children:"Maior Nível"}),t.jsx("div",{className:"text-xl font-bold text-red-400",children:l.highest_level_reached})]}),t.jsxs("div",{className:"bg-orange-500/10 border border-orange-500/20 rounded-lg p-3 text-center",children:[t.jsx(bt,{className:"h-6 w-6 mx-auto mb-2 text-orange-400"}),t.jsx("div",{className:"text-sm text-muted-foreground",children:"Maior Andar"}),t.jsx("div",{className:"text-xl font-bold text-orange-400",children:l.highest_floor_reached})]}),t.jsxs("div",{className:"bg-blue-500/10 border border-blue-500/20 rounded-lg p-3 text-center",children:[t.jsx(Bt,{className:"h-6 w-6 mx-auto mb-2 text-blue-400"}),t.jsx("div",{className:"text-sm text-muted-foreground",children:"Tempo Total"}),t.jsxs("div",{className:"text-xl font-bold text-blue-400",children:[l.total_survival_time_hours,"h"]})]}),t.jsxs("div",{className:"bg-purple-500/10 border border-purple-500/20 rounded-lg p-3 text-center",children:[t.jsx(Mt,{className:"h-6 w-6 mx-auto mb-2 text-purple-400"}),t.jsx("div",{className:"text-sm text-muted-foreground",children:"Maior Ameaça"}),t.jsx("div",{className:"text-xs font-bold text-purple-400 truncate",title:l.deadliest_monster,children:l.deadliest_monster})]})]}),t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("h3",{className:"text-lg font-semibold",children:"Personagens Perdidos"}),t.jsxs("div",{className:"text-sm text-muted-foreground",children:[i.length," de ",f]})]}),d?t.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[1,2,3].map((e=>t.jsxs("div",{className:"bg-muted/20 rounded-lg p-4 animate-pulse",children:[t.jsx("div",{className:"h-6 bg-muted/40 rounded w-24 mb-3"}),t.jsxs("div",{className:"space-y-2",children:[t.jsx("div",{className:"h-4 bg-muted/30 rounded w-full"}),t.jsx("div",{className:"h-4 bg-muted/30 rounded w-3/4"})]})]},e)))}):t.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:i.map((e=>t.jsx(pu,{className:"cursor-pointer transition-all duration-200 hover:shadow-lg hover:scale-105 bg-red-500/5 border-red-500/20",onClick:()=>j(e),children:t.jsx(bu,{className:"p-4",children:t.jsxs("div",{className:"space-y-3",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("h4",{className:"font-semibold text-lg truncate",children:e.name}),t.jsxs(Nu,{variant:"outline",className:"bg-background/50",children:["Nv ",e.level]})]}),t.jsxs("div",{className:"grid grid-cols-3 gap-2 text-xs",children:[t.jsxs("div",{className:"text-center",children:[t.jsx(qe,{className:"h-3 w-3 mx-auto mb-1 text-red-400"}),t.jsx("div",{className:"text-red-400 font-medium",children:e.atk})]}),t.jsxs("div",{className:"text-center",children:[t.jsx(De,{className:"h-3 w-3 mx-auto mb-1 text-blue-400"}),t.jsx("div",{className:"text-blue-400 font-medium",children:e.def})]}),t.jsxs("div",{className:"text-center",children:[t.jsx(Le,{className:"h-3 w-3 mx-auto mb-1 text-yellow-400"}),t.jsx("div",{className:"text-yellow-400 font-medium",children:e.speed})]})]}),t.jsxs("div",{className:"space-y-2 text-xs text-muted-foreground",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("span",{children:"Andar alcançado:"}),t.jsx("span",{className:"font-medium text-orange-400",children:e.floor_reached})]}),t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("span",{children:"Tempo de vida:"}),t.jsx("span",{className:"font-medium text-blue-400",children:w(e.survival_time_minutes)})]}),t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("span",{children:"Gold acumulado:"}),t.jsx("span",{className:"font-medium text-yellow-400",children:ah(e.gold)})]})]}),t.jsxs("div",{className:"bg-red-500/10 border border-red-500/20 rounded p-2",children:[t.jsx("div",{className:"text-xs text-red-400 font-medium",children:C(e.death_cause,e.killed_by_monster)}),t.jsx("div",{className:"text-xs text-muted-foreground mt-1",children:S(e.died_at)})]})]})})},e.id)))})]}),f>6&&t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs(Wa,{variant:"outline",size:"sm",onClick:()=>h((e=>Math.max(1,e-1))),disabled:1===u||d,children:[t.jsx(ze,{className:"h-4 w-4 mr-1"}),"Anterior"]}),t.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:["Página ",u," de ",Math.ceil(f/6)]}),t.jsxs(Wa,{variant:"outline",size:"sm",onClick:()=>h((e=>e+1)),disabled:!p||d,children:["Próxima",t.jsx(He,{className:"h-4 w-4 ml-1"})]})]})]}),y&&t.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:t.jsxs(pu,{className:"w-full max-w-2xl max-h-[80vh] overflow-y-auto",children:[t.jsx(xu,{children:t.jsxs(fu,{className:"flex items-center gap-2",children:[t.jsx($e,{className:"h-5 w-5 text-red-500"}),y.name,t.jsxs(Nu,{variant:"outline",className:"ml-2",children:["Nível ",y.level]})]})}),t.jsxs(bu,{className:"space-y-6",children:[t.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4",children:[t.jsxs("div",{className:"bg-red-500/10 border border-red-500/20 rounded p-3 text-center",children:[t.jsx(qe,{className:"h-5 w-5 mx-auto mb-2 text-red-400"}),t.jsx("div",{className:"text-sm text-muted-foreground",children:"Ataque"}),t.jsx("div",{className:"text-xl font-bold text-red-400",children:y.atk})]}),t.jsxs("div",{className:"bg-blue-500/10 border border-blue-500/20 rounded p-3 text-center",children:[t.jsx(De,{className:"h-5 w-5 mx-auto mb-2 text-blue-400"}),t.jsx("div",{className:"text-sm text-muted-foreground",children:"Defesa"}),t.jsx("div",{className:"text-xl font-bold text-blue-400",children:y.def})]}),t.jsxs("div",{className:"bg-yellow-500/10 border border-yellow-500/20 rounded p-3 text-center",children:[t.jsx(Le,{className:"h-5 w-5 mx-auto mb-2 text-yellow-400"}),t.jsx("div",{className:"text-sm text-muted-foreground",children:"Velocidade"}),t.jsx("div",{className:"text-xl font-bold text-yellow-400",children:y.speed})]}),t.jsxs("div",{className:"bg-green-500/10 border border-green-500/20 rounded p-3 text-center",children:[t.jsx(ft,{className:"h-5 w-5 mx-auto mb-2 text-green-400"}),t.jsx("div",{className:"text-sm text-muted-foreground",children:"HP Máximo"}),t.jsx("div",{className:"text-xl font-bold text-green-400",children:y.max_hp})]}),t.jsxs("div",{className:"bg-purple-500/10 border border-purple-500/20 rounded p-3 text-center",children:[t.jsx(ft,{className:"h-5 w-5 mx-auto mb-2 text-purple-400"}),t.jsx("div",{className:"text-sm text-muted-foreground",children:"Mana Máxima"}),t.jsx("div",{className:"text-xl font-bold text-purple-400",children:y.max_mana})]}),t.jsxs("div",{className:"bg-orange-500/10 border border-orange-500/20 rounded p-3 text-center",children:[t.jsx(bt,{className:"h-5 w-5 mx-auto mb-2 text-orange-400"}),t.jsx("div",{className:"text-sm text-muted-foreground",children:"Andar Alcançado"}),t.jsx("div",{className:"text-xl font-bold text-orange-400",children:y.floor_reached})]})]}),t.jsxs("div",{children:[t.jsx("h3",{className:"text-lg font-semibold mb-3",children:"Atributos Primários"}),t.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[t.jsxs("div",{className:"bg-background/50 rounded p-2 text-center",children:[t.jsx("div",{className:"text-sm text-muted-foreground",children:"Força"}),t.jsx("div",{className:"text-lg font-bold",children:y.strength})]}),t.jsxs("div",{className:"bg-background/50 rounded p-2 text-center",children:[t.jsx("div",{className:"text-sm text-muted-foreground",children:"Destreza"}),t.jsx("div",{className:"text-lg font-bold",children:y.dexterity})]}),t.jsxs("div",{className:"bg-background/50 rounded p-2 text-center",children:[t.jsx("div",{className:"text-sm text-muted-foreground",children:"Inteligência"}),t.jsx("div",{className:"text-lg font-bold",children:y.intelligence})]}),t.jsxs("div",{className:"bg-background/50 rounded p-2 text-center",children:[t.jsx("div",{className:"text-sm text-muted-foreground",children:"Sabedoria"}),t.jsx("div",{className:"text-lg font-bold",children:y.wisdom})]}),t.jsxs("div",{className:"bg-background/50 rounded p-2 text-center",children:[t.jsx("div",{className:"text-sm text-muted-foreground",children:"Vitalidade"}),t.jsx("div",{className:"text-lg font-bold",children:y.vitality})]}),t.jsxs("div",{className:"bg-background/50 rounded p-2 text-center",children:[t.jsx("div",{className:"text-sm text-muted-foreground",children:"Sorte"}),t.jsx("div",{className:"text-lg font-bold",children:y.luck})]})]})]}),t.jsxs("div",{children:[t.jsx("h3",{className:"text-lg font-semibold mb-3",children:"Resumo da Jornada"}),t.jsxs("div",{className:"space-y-3",children:[t.jsxs("div",{className:"flex items-center justify-between p-3 bg-background/50 rounded",children:[t.jsxs("span",{className:"flex items-center gap-2",children:[t.jsx(Rt,{className:"h-4 w-4 text-blue-400"}),"Tempo de sobrevivência"]}),t.jsx("span",{className:"font-medium text-blue-400",children:w(y.survival_time_minutes)})]}),t.jsxs("div",{className:"flex items-center justify-between p-3 bg-background/50 rounded",children:[t.jsxs("span",{className:"flex items-center gap-2",children:[t.jsx(ft,{className:"h-4 w-4 text-yellow-400"}),"XP acumulado"]}),t.jsx("span",{className:"font-medium text-yellow-400",children:ah(y.xp)})]}),t.jsxs("div",{className:"flex items-center justify-between p-3 bg-background/50 rounded",children:[t.jsxs("span",{className:"flex items-center gap-2",children:[t.jsx(Ve,{className:"h-4 w-4 text-yellow-400"}),"Gold acumulado"]}),t.jsx("span",{className:"font-medium text-yellow-400",children:ah(y.gold)})]})]})]}),t.jsxs("div",{className:"bg-red-500/10 border border-red-500/20 rounded p-4",children:[t.jsx("h3",{className:"text-lg font-semibold mb-2 text-red-400",children:"Fim da Jornada"}),t.jsxs("div",{className:"space-y-2",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx($e,{className:"h-4 w-4 text-red-400"}),t.jsx("span",{className:"font-medium",children:C(y.death_cause,y.killed_by_monster)})]}),t.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[t.jsx(Ge,{className:"h-4 w-4"}),t.jsx("span",{children:S(y.died_at)})]})]})]}),t.jsx("div",{className:"flex justify-end",children:t.jsx(Wa,{onClick:()=>j(null),children:"Fechar"})})]})]})})]}):t.jsxs(pu,{className:a,children:[s&&t.jsx(xu,{className:"pb-4",children:t.jsxs(fu,{className:"flex items-center gap-2",children:[t.jsx($e,{className:"h-5 w-5 text-red-500"}),"Cemitério"]})}),t.jsx(bu,{children:t.jsxs("div",{className:"text-center py-8 space-y-4",children:[t.jsx("div",{className:"text-6xl opacity-50",children:"⚰️"}),t.jsxs("div",{className:"space-y-2",children:[t.jsx("h3",{className:"text-lg font-medium text-muted-foreground",children:"Cemitério Vazio"}),t.jsx("p",{className:"text-sm text-muted-foreground",children:"Nenhum personagem foi perdido ainda. Que a sorte continue com você!"})]})]})})]})}const Jf=l("/_authenticated/game/play/hub/cemetery")({component:function(){const e=r();return t.jsx("div",{className:"min-h-screen bg-gradient-to-b from-background to-secondary",children:t.jsxs("div",{className:"container mx-auto p-4 max-w-6xl",children:[t.jsx("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-4 mb-6",children:t.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center gap-2 sm:gap-4",children:[t.jsxs(Wa,{variant:"ghost",onClick:()=>e({to:"/game/play"}),className:"w-fit",children:[t.jsx(Pe,{className:"h-4 w-4 mr-2"}),"Voltar à Seleção"]}),t.jsxs("div",{className:"text-center sm:text-left mt-2 sm:mt-0",children:[t.jsx("h1",{className:"text-2xl sm:text-3xl font-bold bg-gradient-to-r from-red-500 to-orange-500 bg-clip-text text-transparent",children:"Cemitério do Tower Trials"}),t.jsx("p",{className:"text-sm sm:text-base text-muted-foreground",children:"Honre a memória dos bravos aventureiros que caíram nas trevas da torre"})]})]})}),t.jsx(Kf,{className:"w-full",showHeader:!1,collapsible:!1})]})})}});const Qf=l("/_authenticated/game/play/hub/equipment/select")({component:function(){const a=r(),{character:s,slot:n}=Qf.useSearch(),[i,o]=e.useState(null),[l,c]=e.useState([]),[d,m]=e.useState([]),[u,h]=e.useState(null),[p,x]=e.useState(!0),[f,g]=e.useState("all"),[b,v]=e.useState("name"),[y,j]=e.useState(!1);e.useEffect((()=>{(async()=>{if(s&&n)try{x(!0);const e=await Nh.getCharacter(s);e.success&&e.data&&o(e.data);const t=await gh.getCharacterEquipment(s);c(t)}catch(e){_.error("Erro ao carregar equipamentos")}finally{x(!1)}else a({to:"/game/play/hub",search:{character:s}})})()}),[s,n,a]),e.useEffect((()=>{const e=l.filter((e=>{if(!e.equipment)return!1;const t=e.equipment;return!!N(t,n)&&("all"===f||t.type===f)}));e.sort(((e,t)=>{const a=e.equipment,s=t.equipment;switch(b){case"name":return a.name.localeCompare(s.name);case"level":return(s.level_requirement||0)-(a.level_requirement||0);case"rarity":{const e={common:1,uncommon:2,rare:3,epic:4,legendary:5};return(e[s.rarity]||0)-(e[a.rarity]||0)}case"attack":return s.atk_bonus-a.atk_bonus;case"defense":return s.def_bonus-a.def_bonus;default:return 0}})),m(e)}),[l,f,b,n]);const N=(e,t)=>{const a={main_hand:["weapon"],off_hand:["weapon","armor"],armor:["armor"],chest:["chest"],helmet:["helmet"],legs:["legs"],boots:["boots"],ring_1:["ring"],ring_2:["ring"],necklace:["necklace"],amulet:["amulet"]}[t];return a?.includes(e.type)||!1},w=e=>({main_hand:"Mão Principal",off_hand:"Mão Secundária",armor:"Armadura",chest:"Peitoral",helmet:"Capacete",legs:"Perneiras",boots:"Botas",ring_1:"Anel 1",ring_2:"Anel 2",necklace:"Colar",amulet:"Amuleto"}[e]||e),C=e=>({weapon:t.jsx(qe,{className:"h-6 w-6 text-red-400"}),armor:t.jsx(De,{className:"h-6 w-6 text-blue-400"}),chest:t.jsx(Ct,{className:"h-6 w-6 text-green-400"}),helmet:t.jsx(Je,{className:"h-6 w-6 text-yellow-400"}),legs:t.jsx(De,{className:"h-6 w-6 text-cyan-400"}),boots:t.jsx(St,{className:"h-6 w-6 text-orange-400"}),ring:t.jsx(gt,{className:"h-6 w-6 text-purple-400"}),necklace:t.jsx(gt,{className:"h-6 w-6 text-pink-400"}),amulet:t.jsx(gt,{className:"h-6 w-6 text-indigo-400"})}[e.type]||t.jsx(De,{className:"h-6 w-6 text-slate-400"})),S=e=>{const t={common:"border-slate-600 bg-slate-800/30 text-slate-300",uncommon:"border-emerald-600 bg-emerald-900/30 text-emerald-300",rare:"border-blue-600 bg-blue-900/30 text-blue-300",epic:"border-purple-600 bg-purple-900/30 text-purple-300",legendary:"border-amber-600 bg-amber-900/30 text-amber-300"};return t[e]||t.common};if(p)return t.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900 p-4",children:t.jsx("div",{className:"max-w-7xl mx-auto",children:t.jsxs("div",{className:"animate-pulse space-y-6",children:[t.jsx("div",{className:"h-8 bg-slate-700 rounded w-64"}),t.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[t.jsx("div",{className:"h-96 bg-slate-700 rounded"}),t.jsx("div",{className:"lg:col-span-2 h-96 bg-slate-700 rounded"})]})]})})});if(!i)return t.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900 p-4",children:t.jsx("div",{className:"max-w-7xl mx-auto",children:t.jsxs("div",{className:"text-center py-12",children:[t.jsx("h1",{className:"text-2xl font-bold text-slate-100 mb-4",children:"Personagem não encontrado"}),t.jsxs(Wa,{onClick:()=>a({to:"/game/play/hub",search:{character:s}}),children:[t.jsx(Pe,{className:"h-4 w-4 mr-2"}),"Voltar ao Hub"]})]})})});return t.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900 p-2 sm:p-4",children:t.jsxs("div",{className:"max-w-7xl mx-auto space-y-4",children:[t.jsx("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:t.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center gap-2 sm:gap-4",children:[t.jsxs(Wa,{variant:"outline",size:"sm",onClick:()=>a({to:"/game/play/hub/equipment",search:{character:s}}),className:"w-fit",children:[t.jsx(Pe,{className:"h-4 w-4 mr-2"}),"Voltar"]}),t.jsxs("div",{children:[t.jsxs("h1",{className:"text-xl sm:text-2xl font-bold text-slate-100 flex items-center gap-2",children:[t.jsx(qe,{className:"h-5 sm:h-6 w-5 sm:w-6 text-amber-400"}),"Selecionar Equipamento"]}),t.jsxs("p",{className:"text-sm text-slate-400",children:[i.name," • ",w(n)]})]})]})}),t.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-4",children:[t.jsxs("div",{className:"space-y-4",children:[t.jsxs(pu,{className:"bg-slate-800/50 border-slate-700/50",children:[t.jsx(xu,{className:"pb-2",children:t.jsxs(fu,{className:"text-slate-100 flex items-center gap-2 text-base",children:[t.jsx(At,{className:"h-4 w-4 text-amber-400"}),"Filtros"]})}),t.jsx(bu,{children:t.jsx(Jx,{filterType:f,onFilterChange:g,sortType:b,onSortChange:v,compact:!0})})]}),t.jsxs(pu,{className:"bg-slate-800/50 border-slate-700/50",children:[t.jsx(xu,{className:"pb-2",children:t.jsxs(fu,{className:"text-slate-100 text-base",children:["Equipamentos (",d.length,")"]})}),t.jsx(bu,{className:"space-y-2 max-h-[400px] sm:max-h-[500px] lg:max-h-[600px] overflow-y-auto",children:0===d.length?t.jsxs("div",{className:"text-center py-8",children:[t.jsx(At,{className:"h-12 w-12 mx-auto mb-3 text-slate-600 opacity-50"}),t.jsx("p",{className:"text-slate-500",children:"Nenhum equipamento encontrado"})]}):t.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-2 gap-2",children:d.map((e=>{if(!e.equipment)return null;const a=e.equipment,s=u?.id===a.id;return t.jsx("div",{className:"relative cursor-pointer transition-all duration-200 "+(s?"transform scale-[1.02]":"hover:transform hover:scale-[1.01]"),onClick:()=>h(a),children:t.jsx(pu,{className:"border-2 transition-all duration-200 "+(s?"border-amber-400 bg-amber-900/20 shadow-lg shadow-amber-400/20":`${S(a.rarity)} hover:brightness-110`),children:t.jsx(bu,{className:"p-4",children:t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("div",{className:`p-2 rounded-lg ${S(a.rarity)}`,children:C(a)}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsx("h3",{className:"font-medium text-slate-200 truncate",children:a.name}),t.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[t.jsx(Nu,{variant:"outline",className:"text-xs",children:a.rarity}),a.level_requirement&&a.level_requirement>1&&t.jsxs(Nu,{variant:"outline",className:"text-xs",children:["Nv. ",a.level_requirement]})]}),t.jsxs("div",{className:"flex items-center gap-3 mt-2 text-xs text-slate-400",children:[a.atk_bonus>0&&t.jsxs("span",{className:"flex items-center gap-1",children:[t.jsx(qe,{className:"h-3 w-3 text-red-400"}),"+",a.atk_bonus]}),a.def_bonus>0&&t.jsxs("span",{className:"flex items-center gap-1",children:[t.jsx(De,{className:"h-3 w-3 text-blue-400"}),"+",a.def_bonus]}),a.mana_bonus>0&&t.jsxs("span",{className:"flex items-center gap-1",children:[t.jsx(Le,{className:"h-3 w-3 text-purple-400"}),"+",a.mana_bonus]}),a.speed_bonus&&a.speed_bonus>0&&t.jsxs("span",{className:"flex items-center gap-1",children:[t.jsx(Le,{className:"h-3 w-3 text-yellow-400"}),"+",a.speed_bonus]})]})]})]})})})},a.id)}))})})]})]}),t.jsx("div",{className:"lg:col-span-2",children:t.jsxs(pu,{className:"bg-slate-800/50 border-slate-700/50 h-full",children:[t.jsx(xu,{className:"pb-2",children:t.jsx(fu,{className:"text-slate-100 text-base",children:"Detalhes do Equipamento"})}),t.jsx(bu,{className:"h-full",children:(()=>{if(!u)return t.jsx("div",{className:"flex items-center justify-center h-full text-slate-500",children:t.jsxs("div",{className:"text-center",children:[t.jsx(At,{className:"h-16 w-16 mx-auto mb-4 opacity-50"}),t.jsx("p",{className:"text-lg",children:"Selecione um equipamento"}),t.jsx("p",{className:"text-sm mt-2 opacity-75",children:"Clique em um item para ver os detalhes"})]})});const e=!!i&&i.level>=(u.level_requirement||1);return t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"flex items-start gap-4",children:[t.jsx("div",{className:`p-4 rounded-lg border-2 ${S(u.rarity)}`,children:C(u)}),t.jsxs("div",{className:"flex-1",children:[t.jsx("h2",{className:"text-2xl font-bold text-slate-100 mb-2",children:u.name}),t.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[t.jsx(Nu,{className:`border ${S(u.rarity)}`,children:u.rarity}),t.jsx(Nu,{variant:"outline",className:"text-slate-300",children:u.type}),"legendary"===u.rarity&&t.jsx(ft,{className:"h-4 w-4 text-amber-400 animate-pulse"})]})]})]}),t.jsx("div",{className:"bg-slate-800/30 border border-slate-700/50 rounded-lg p-4",children:t.jsx("p",{className:"text-slate-300 leading-relaxed",children:u.description})}),t.jsxs("div",{className:"space-y-3",children:[t.jsx("h3",{className:"text-lg font-semibold text-slate-200",children:"Atributos"}),t.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[u.atk_bonus>0&&t.jsxs("div",{className:"bg-red-900/30 border border-red-700/50 rounded-lg p-3",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(qe,{className:"h-4 w-4 text-red-400"}),t.jsx("span",{className:"text-red-300 font-medium",children:"Ataque"})]}),t.jsxs("p",{className:"text-red-200 text-lg font-bold",children:["+",u.atk_bonus]})]}),u.def_bonus>0&&t.jsxs("div",{className:"bg-blue-900/30 border border-blue-700/50 rounded-lg p-3",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(De,{className:"h-4 w-4 text-blue-400"}),t.jsx("span",{className:"text-blue-300 font-medium",children:"Defesa"})]}),t.jsxs("p",{className:"text-blue-200 text-lg font-bold",children:["+",u.def_bonus]})]}),u.mana_bonus>0&&t.jsxs("div",{className:"bg-purple-900/30 border border-purple-700/50 rounded-lg p-3",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(Le,{className:"h-4 w-4 text-purple-400"}),t.jsx("span",{className:"text-purple-300 font-medium",children:"Mana"})]}),t.jsxs("p",{className:"text-purple-200 text-lg font-bold",children:["+",u.mana_bonus]})]}),u.speed_bonus&&u.speed_bonus>0&&t.jsxs("div",{className:"bg-yellow-900/30 border border-yellow-700/50 rounded-lg p-3",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(Le,{className:"h-4 w-4 text-yellow-400"}),t.jsx("span",{className:"text-yellow-300 font-medium",children:"Velocidade"})]}),t.jsxs("p",{className:"text-yellow-200 text-lg font-bold",children:["+",u.speed_bonus]})]})]})]}),u.level_requirement&&u.level_requirement>1&&t.jsxs("div",{className:"bg-slate-700/30 border border-slate-600/50 rounded-lg p-3",children:[t.jsx("h4",{className:"text-sm font-medium text-slate-300 mb-2",children:"Requisitos"}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("span",{className:"text-slate-400",children:"Nível mínimo:"}),t.jsx("span",{className:"font-bold "+(e?"text-green-400":"text-red-400"),children:u.level_requirement})]})]}),u.weapon_subtype&&t.jsxs("div",{className:"bg-slate-700/30 border border-slate-600/50 rounded-lg p-3",children:[t.jsx("h4",{className:"text-sm font-medium text-slate-300 mb-2",children:"Tipo de Arma"}),t.jsx("p",{className:"text-slate-400 capitalize",children:u.weapon_subtype})]}),t.jsx("div",{className:"pt-4 border-t border-slate-700/50",children:t.jsx(Wa,{onClick:()=>(async e=>{if(s&&!y)try{j(!0);const t=await gh.toggleEquipment(s,e.id,!0);t.success?(_.success(`${e.name} equipado com sucesso!`),a({to:"/game/play/hub/equipment",search:{character:s}})):_.error(t.error||"Erro ao equipar item")}catch(t){_.error("Erro ao equipar item")}finally{j(!1)}})(u),disabled:!e||y,className:"w-full "+(e?"bg-amber-600 hover:bg-amber-700 text-white":"bg-slate-700 text-slate-400 cursor-not-allowed"),children:y?t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-t border-b border-current"}),"Equipando..."]}):e?`Equipar em ${w(n)}`:`Nível ${u.level_requirement} necessário`})})]})})()})]})})]})]})})},validateSearch:e=>({character:e.character||"",slot:e.slot||"main_hand"})});function Zf({className:a="",size:s=64}){const[r,n]=e.useState(1),[i,o]=e.useState(!0),l={1:"/assets/thief-idle-01-Cg6afdQr.png",2:"/assets/thief-idle-02-Des9M6g7.png",3:"/assets/thief-idle-03-zEN7iEdx.png"};e.useEffect((()=>{if(!i)return;const e=setInterval((()=>{n((e=>e%3+1))}),600);return()=>clearInterval(e)}),[i]);const c=l[r];return t.jsx("div",{className:`relative ${a}`,style:{width:s,height:s},onMouseEnter:()=>o(!0),onMouseLeave:()=>o(!0),children:t.jsx("img",{src:c,alt:`Thief idle animation frame ${r}`,className:"w-full h-full object-contain transition-opacity duration-150",style:{imageRendering:"pixelated"}})})}function eg({activeEffects:a,size:s="md",maxVisible:r=6,className:n=""}){const i=e.useCallback((e=>({atk:"Ataque",def:"Defesa",speed:"Velocidade",magic_attack:"Ataque Mágico",critical_chance:"Chance Crítica",critical_damage:"Dano Crítico"}[e]||e)),[]),o=()=>{switch(s){case"sm":return"w-6 h-6 text-xs";case"lg":return"w-10 h-10 text-sm";default:return"w-8 h-8 text-xs"}},l=e.useMemo((()=>{const e=[],t=new Set;return a.attribute_modifications?.forEach((a=>{const s=a.value>0?"buff":"debuff",r=a.value>0?"+":"",n="percentage"===a.type?"%":"";var o;t.add(a.source_spell),e.push({type:"attribute_mod",icon:(o=a.attribute,{atk:"⚔️",def:"🛡️",speed:"💨",magic_attack:"🔮",critical_chance:"🎯",critical_damage:"💥",strength:"💪",dexterity:"🏃",intelligence:"🧠",wisdom:"📚",vitality:"❤️",luck:"🍀"}[o]||"📊"),color:ch(s),name:a.source_spell,description:`${r}${a.value}${n} ${i(a.attribute)}`,duration:a.duration,isExpiring:a.duration<=1})})),a.buffs?.forEach((a=>{t.has(a.source_spell)||e.push({type:a.type,icon:lh(a.type),color:ch(a.type),name:a.source_spell,description:`Efeito benéfico (+${a.value})`,duration:a.duration,isExpiring:a.duration<=1})})),a.debuffs?.forEach((a=>{t.has(a.source_spell)||e.push({type:a.type,icon:lh(a.type),color:ch(a.type),name:a.source_spell,description:`Efeito prejudicial (-${a.value})`,duration:a.duration,isExpiring:a.duration<=1})})),a.dots?.forEach((t=>{e.push({type:t.type,icon:lh(t.type),color:ch(t.type),name:t.source_spell,description:`${t.value} dano por turno`,duration:t.duration,isExpiring:t.duration<=1})})),a.hots?.forEach((t=>{e.push({type:t.type,icon:lh(t.type),color:ch(t.type),name:t.source_spell,description:`${t.value} cura por turno`,duration:t.duration,isExpiring:t.duration<=1})})),e.slice(0,r)}),[a,r,i]);return 0===l.length?null:t.jsx("div",{className:`flex flex-wrap gap-1 ${n}`,children:t.jsxs(_x,{children:[l.map(((e,a)=>t.jsxs(wx,{children:[t.jsx(Cx,{asChild:!0,children:t.jsx("div",{className:"relative",children:t.jsxs(Nu,{variant:"outline",className:`\n                    ${o()} \n                    ${e.color} \n                    flex items-center justify-center \n                    border-2 cursor-help\n                    ${e.isExpiring?"animate-pulse":""}\n                  `,children:[t.jsx("span",{className:"text-sm",children:e.icon}),t.jsx("div",{className:"absolute -top-1 -right-1 min-w-[16px] h-4 bg-background border border-border rounded-full flex items-center justify-center text-[10px] font-bold",children:e.isExpiring?t.jsx(Rt,{className:"w-2 h-2"}):e.duration})]})})}),t.jsx(Sx,{side:"top",className:"max-w-xs bg-background border border-border shadow-xl",children:t.jsxs("div",{className:"p-2",children:[t.jsx("div",{className:"font-semibold text-foreground mb-1",children:e.name}),t.jsx("div",{className:"text-sm text-muted-foreground mb-2",children:e.description}),t.jsxs("div",{className:"flex items-center gap-1 text-xs text-muted-foreground",children:[t.jsx(Rt,{className:"w-3 h-3"}),t.jsx("span",{children:1===e.duration?"Expira no próximo turno":`${e.duration} turnos restantes`})]})]})})]},`${e.name}-${a}`))),(a.buffs?.length||0)+(a.debuffs?.length||0)+(a.dots?.length||0)+(a.hots?.length||0)+(a.attribute_modifications?.length||0)>r&&t.jsx(Nu,{variant:"outline",className:`\n              ${o()}\n              bg-gray-500/20 text-gray-400 border-gray-500/30\n              flex items-center justify-center\n            `,children:t.jsx("span",{className:"text-xs",children:"+"})})]})})}function tg({player:a,currentEnemy:s,playerHpPercentage:r,playerManaPercentage:n,enemyHpPercentage:i,isPlayerTurn:o,gameLogs:l,onOpenLogModal:c}){const[d,m]=e.useState(!1),[u,h]=e.useState(!1),[p,x]=e.useState([]),[f,g]=e.useState(!1),b=e.useRef(null),v=Hf(),[y,j]=e.useState({playerHp:a?.hp||0,enemyHp:s?.hp||0,battleId:`${a?.floor||0}-${s?.name||"unknown"}-${Date.now()}`});e.useEffect((()=>{const e=e=>{b.current&&!b.current.contains(e.target)&&g(!1)};return f&&(document.addEventListener("mousedown",e),document.addEventListener("touchstart",e)),()=>{document.removeEventListener("mousedown",e),document.removeEventListener("touchstart",e)}}),[f]);const N=()=>{g(!f)};e.useEffect((()=>{if(!a||!s)return;const e=`${a.floor}-${s.name}`;if(!y.battleId.includes(e))return void j({playerHp:a.hp,enemyHp:s.hp,battleId:e});let t=!1;if(a.hp<y.playerHp&&y.playerHp-a.hp>=1){const e=y.playerHp-a.hp;_(e,!0,!1,"physical"),t=!0}if(s.hp<y.enemyHp&&y.enemyHp-s.hp>=1){const e=y.enemyHp-s.hp,r=e>1.5*(a.atk||0);_(e,!1,r,"physical"),t=!0}t&&j({playerHp:a.hp,enemyHp:s.hp,battleId:e})}),[a?.hp,s?.hp,a?.atk,a?.floor,s?.name,y]);const _=(e,t,a,s)=>{const r=`${Date.now()}-${Math.random()}`,n={id:r,damage:e,isPlayer:t,isCritical:a,damageType:s,timestamp:Date.now()};x((e=>[...e,n])),setTimeout((()=>{x((e=>e.filter((e=>e.id!==r))))}),2e3)};if(!a||!s)return t.jsx("div",{className:"min-h-[400px] flex items-center justify-center",children:t.jsx("div",{className:"text-muted-foreground",children:"Carregando dados da batalha..."})});const w=e=>({armored:"Blindado",swift:"Veloz",magical:"Mágico",brutish:"Brutal",resilient:"Resistente",berserker:"Berserker",ethereal:"Etéreo",venomous:"Venenoso"}[e]||e),C=e=>{switch(e){case"armored":return t.jsx(De,{className:"h-3 w-3"});case"swift":return t.jsx(Le,{className:"h-3 w-3"});case"magical":return t.jsx(pt,{className:"h-3 w-3"});case"brutish":return t.jsx(qe,{className:"h-3 w-3"});case"resilient":return t.jsx(Xt,{className:"h-3 w-3"});case"berserker":return t.jsx(bt,{className:"h-3 w-3"});case"ethereal":return t.jsx(xt,{className:"h-3 w-3"});case"venomous":return t.jsx(Yt,{className:"h-3 w-3"});default:return t.jsx(Wt,{className:"h-3 w-3"})}};return t.jsxs("div",{className:"relative",children:[t.jsx("div",{className:"absolute inset-0 bg-gradient-to-b from-slate-900/30 via-transparent to-slate-900/30 rounded-xl"}),t.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-blue-500/5 via-transparent to-red-500/5 rounded-xl"}),t.jsx(pu,{className:`relative border-2 backdrop-blur-sm overflow-hidden transition-all duration-500 ${r>=70?"battle-card-healthy":r>=30?"battle-card-wounded":"battle-card-critical"} ${v?"transform scale-90 origin-top-left":""}`,children:t.jsxs(bu,{className:""+(v?"p-2 md:p-3":"p-3 md:p-6"),children:[t.jsx("div",{className:"text-center "+(v?"mb-2 md:mb-3":"mb-3 md:mb-6"),children:t.jsxs("div",{className:"flex items-center justify-center gap-2 md:gap-3 mb-2",children:[t.jsxs(Nu,{variant:"outline",className:"px-2 py-1 text-xs bg-background/50",children:[t.jsx(qe,{className:"h-3 w-3 mr-1"}),"Andar ",a.floor]}),t.jsx("div",{className:"h-1.5 w-1.5 md:h-2 md:w-2 rounded-full bg-primary animate-pulse"}),t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(Nu,{variant:o?"default":"secondary",className:"px-2 py-1 text-xs "+(o?"bg-primary text-primary-foreground border-primary":"bg-secondary text-secondary-foreground border-secondary"),children:o?"Seu Turno":"Turno do Inimigo"}),v&&c&&t.jsx("div",{className:"relative",children:t.jsxs("button",{onClick:c,className:"ml-1 text-muted-foreground hover:text-primary transition-colors touch-manipulation bg-background/50 rounded-full p-1.5 border border-border/50 shadow-sm relative","aria-label":"Abrir log de batalha",children:[t.jsx(Ut,{className:"h-3 w-3 md:h-4 md:w-4"}),l&&l.length>0&&t.jsx("div",{className:"absolute -top-1 -right-1 bg-primary text-primary-foreground text-xs rounded-full h-4 w-4 flex items-center justify-center min-w-[16px]",children:l.length>99?"99+":l.length})]})}),o&&t.jsxs("div",{className:"relative",ref:b,children:[t.jsx("button",{className:"ml-1 text-muted-foreground hover:text-foreground transition-colors touch-manipulation",onClick:N,onTouchStart:N,"aria-label":"Mostrar atalhos de teclado",children:t.jsx(zt,{className:"h-3 w-3 md:h-4 md:w-4"})}),f&&t.jsxs("div",{className:"absolute top-full left-1/2 transform -translate-x-1/2 mt-2 z-50 bg-background border border-border rounded-lg shadow-xl p-4 w-72 md:w-80 max-w-[90vw]",children:[t.jsxs("div",{className:"text-sm",children:[t.jsx("div",{className:"font-semibold mb-3 text-center text-foreground",children:"Atalhos de Teclado"}),t.jsxs("div",{className:"space-y-2.5",children:[t.jsxs("div",{className:"flex items-center justify-between gap-3",children:[t.jsxs("div",{className:"flex gap-1",children:[t.jsx("span",{className:"font-mono bg-primary/20 text-primary px-2 py-1 rounded text-xs border",children:"A"}),t.jsx("span",{className:"font-mono bg-primary/20 text-primary px-2 py-1 rounded text-xs border",children:"S"}),t.jsx("span",{className:"font-mono bg-primary/20 text-primary px-2 py-1 rounded text-xs border",children:"D"})]}),t.jsx("span",{className:"text-xs text-muted-foreground flex-1 text-right",children:"Atacar, Defender, Fugir"})]}),t.jsxs("div",{className:"flex items-center justify-between gap-3",children:[t.jsxs("div",{className:"flex gap-1",children:[t.jsx("span",{className:"font-mono bg-blue-500/20 text-blue-400 px-2 py-1 rounded text-xs border border-blue-500/30",children:"1"}),t.jsx("span",{className:"font-mono bg-blue-500/20 text-blue-400 px-2 py-1 rounded text-xs border border-blue-500/30",children:"2"}),t.jsx("span",{className:"font-mono bg-blue-500/20 text-blue-400 px-2 py-1 rounded text-xs border border-blue-500/30",children:"3"})]}),t.jsx("span",{className:"text-xs text-muted-foreground flex-1 text-right",children:"Magias 1, 2, 3"})]}),t.jsxs("div",{className:"flex items-center justify-between gap-3",children:[t.jsxs("div",{className:"flex gap-1",children:[t.jsx("span",{className:"font-mono bg-green-500/20 text-green-400 px-2 py-1 rounded text-xs border border-green-500/30",children:"Q"}),t.jsx("span",{className:"font-mono bg-green-500/20 text-green-400 px-2 py-1 rounded text-xs border border-green-500/30",children:"W"}),t.jsx("span",{className:"font-mono bg-green-500/20 text-green-400 px-2 py-1 rounded text-xs border border-green-500/30",children:"E"})]}),t.jsx("span",{className:"text-xs text-muted-foreground flex-1 text-right",children:"Poções 1, 2, 3"})]})]})]}),t.jsx("div",{className:"absolute bottom-full left-1/2 transform -translate-x-1/2 w-0 h-0 border-l-4 border-r-4 border-b-4 border-l-transparent border-r-transparent border-b-border"}),t.jsx("div",{className:"absolute bottom-full left-1/2 transform -translate-x-1/2 translate-y-px w-0 h-0 border-l-4 border-r-4 border-b-4 border-l-transparent border-r-transparent border-b-background"})]})]})]})]})}),t.jsxs("div",{className:"grid grid-cols-2 items-start "+(v?"gap-2 md:gap-4":"gap-3 md:gap-8"),children:[t.jsxs("div",{className:""+(v?"space-y-1 md:space-y-2":"space-y-2 md:space-y-4"),children:[t.jsxs("div",{className:"text-center relative",children:[t.jsxs("div",{className:"relative inline-block mb-2 md:mb-4",children:[t.jsx("div",{className:"w-16 h-16 md:w-24 md:h-24 lg:w-28 lg:h-28 rounded-full bg-gradient-to-br from-blue-500/20 to-purple-500/20 border-2 md:border-3 flex items-center justify-center transition-all duration-500 overflow-hidden "+(o?"border-blue-500 shadow-xl md:shadow-2xl shadow-blue-500/40 scale-105 md:scale-110":"border-blue-500/30 scale-100"),children:t.jsx(Zf,{size:64,className:"scale-75 md:scale-100 lg:scale-110"})}),o&&t.jsxs("div",{className:"absolute -top-1 -right-1 md:-top-2 md:-right-2",children:[t.jsx("div",{className:"w-3 h-3 md:w-5 md:h-5 bg-blue-500 rounded-full animate-ping"}),t.jsx("div",{className:"absolute top-0 right-0 w-3 h-3 md:w-5 md:h-5 bg-blue-500 rounded-full"})]}),a.isDefending&&t.jsx("div",{className:"absolute -bottom-1 -left-1 md:-bottom-2 md:-left-2",children:t.jsx("div",{className:"w-6 h-6 md:w-8 md:h-8 bg-blue-600/90 rounded-full flex items-center justify-center border-2 border-background",children:t.jsx(De,{className:"h-3 w-3 md:h-4 md:w-4 text-white"})})})]}),t.jsxs("div",{className:"space-y-1 md:space-y-2",children:[t.jsxs("h3",{className:"font-bold text-sm md:text-lg lg:text-xl flex items-center justify-center gap-1 md:gap-2",children:[t.jsx(Je,{className:"h-3 w-3 md:h-5 md:w-5 text-yellow-500"}),t.jsx("span",{className:"truncate",children:a.name})]}),t.jsxs("div",{className:"flex items-center justify-center gap-1 md:gap-2 flex-wrap",children:[t.jsxs(Nu,{variant:"outline",className:"bg-background/50 text-xs px-1 md:px-2",children:[t.jsx(ft,{className:"h-2 w-2 md:h-3 md:w-3 mr-1"}),"Nv ",a.level]}),t.jsxs(Nu,{variant:"outline",className:"bg-background/50 text-yellow-400 text-xs px-1 md:px-2",children:[a.gold.toLocaleString("pt-BR"),"G"]})]})]}),p.filter((e=>e.isPlayer)).map((e=>t.jsxs("div",{className:"absolute pointer-events-none z-20 font-bold text-lg animate-damage-float "+(e.isCritical?"text-red-400 text-2xl animate-damage-critical":"text-red-300"),style:{left:"50%",top:"20%",transform:"translateX(-50%)",textShadow:"2px 2px 4px rgba(0,0,0,0.8)"},children:["-",e.damage,e.isCritical&&t.jsx("span",{className:"ml-1 text-yellow-400 text-sm",children:"CRÍTICO!"})]},e.id)))]}),t.jsxs("div",{className:"space-y-2 md:space-y-3",children:[t.jsxs("div",{children:[t.jsxs("div",{className:"flex justify-between items-center mb-1",children:[t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(Be,{className:"h-3 w-3 md:h-4 md:w-4 text-red-500"}),t.jsx("span",{className:"font-medium text-xs md:text-sm",children:"HP"})]}),t.jsxs("span",{className:"text-xs md:text-sm font-bold",children:[a.hp,"/",a.max_hp]})]}),t.jsxs("div",{className:"relative",children:[t.jsx(Gh,{value:r,className:"h-2 md:h-3",style:{background:"rgba(0,0,0,0.2)"}}),t.jsx("div",{className:"absolute top-0 left-0 h-2 md:h-3 rounded-full transition-all duration-300 "+(r>=70?"bg-green-500":r>=40?"bg-yellow-500":r>=20?"bg-orange-500":"bg-red-500"),style:{width:`${r}%`}})]})]}),t.jsxs("div",{children:[t.jsxs("div",{className:"flex justify-between items-center mb-1",children:[t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(pt,{className:"h-3 w-3 md:h-4 md:w-4 text-blue-500"}),t.jsx("span",{className:"font-medium text-xs md:text-sm",children:"MP"})]}),t.jsxs("span",{className:"text-xs md:text-sm font-bold",children:[a.mana,"/",a.max_mana]})]}),t.jsxs("div",{className:"relative",children:[t.jsx(Gh,{value:n,className:"h-2 md:h-3",style:{background:"rgba(0,0,0,0.2)"}}),t.jsx("div",{className:"absolute top-0 left-0 h-2 md:h-3 rounded-full transition-all duration-300 "+(n>=70?"bg-blue-500":n>=40?"bg-cyan-500":n>=20?"bg-indigo-500":"bg-purple-500"),style:{width:`${n}%`}})]})]})]}),t.jsxs("div",{className:"grid gap-1 md:gap-2 "+(a.magic_attack&&!isNaN(a.magic_attack)&&a.magic_attack>0?"grid-cols-4":"grid-cols-3"),children:[t.jsxs("div",{className:"bg-red-500/10 border border-red-500/20 rounded p-1 md:p-2 text-center",children:[t.jsx(qe,{className:"h-3 w-3 md:h-4 md:w-4 mx-auto mb-1 text-red-400"}),t.jsx("div",{className:"text-xs text-red-300 mb-1",children:"ATK"}),t.jsx("div",{className:"text-xs font-bold text-red-400",children:t.jsx(Ex,{value:a.atk||0,baseValue:a.base_atk,equipmentBonus:a.equipment_atk_bonus,modifications:a.active_effects?.attribute_modifications?.filter((e=>"atk"===e.attribute))||[],size:"sm",showTooltip:!0})})]}),a.magic_attack&&!isNaN(a.magic_attack)&&a.magic_attack>0&&t.jsxs("div",{className:"bg-purple-500/10 border border-purple-500/20 rounded p-1 md:p-2 text-center",children:[t.jsx(pt,{className:"h-3 w-3 md:h-4 md:w-4 mx-auto mb-1 text-purple-400"}),t.jsx("div",{className:"text-xs text-purple-300 mb-1",children:"MAG"}),t.jsx("div",{className:"text-xs font-bold text-purple-400",children:t.jsx(Ex,{value:a.magic_attack,modifications:a.active_effects?.attribute_modifications?.filter((e=>"magic_attack"===e.attribute))||[],size:"sm",showTooltip:!0})})]}),t.jsxs("div",{className:"bg-blue-500/10 border border-blue-500/20 rounded p-1 md:p-2 text-center",children:[t.jsx(De,{className:"h-3 w-3 md:h-4 md:w-4 mx-auto mb-1 text-blue-400"}),t.jsx("div",{className:"text-xs text-blue-300 mb-1",children:"DEF"}),t.jsx("div",{className:"text-xs font-bold text-blue-400",children:t.jsx(Ex,{value:a.def||0,baseValue:a.base_def,equipmentBonus:a.equipment_def_bonus,modifications:a.active_effects?.attribute_modifications?.filter((e=>"def"===e.attribute))||[],size:"sm",showTooltip:!0})})]}),t.jsxs("div",{className:"bg-yellow-500/10 border border-yellow-500/20 rounded p-1 md:p-2 text-center",children:[t.jsx(Le,{className:"h-3 w-3 md:h-4 md:w-4 mx-auto mb-1 text-yellow-400"}),t.jsx("div",{className:"text-xs text-yellow-300 mb-1",children:"SPD"}),t.jsx("div",{className:"text-xs font-bold text-yellow-400",children:t.jsx(Ex,{value:a.speed||0,baseValue:a.base_speed,equipmentBonus:a.equipment_speed_bonus,modifications:a.active_effects?.attribute_modifications?.filter((e=>"speed"===e.attribute))||[],size:"sm",showTooltip:!0})})]})]}),a.active_effects&&t.jsx("div",{className:"flex justify-center mb-2 md:mb-3",children:t.jsx(eg,{activeEffects:a.active_effects,size:"sm",maxVisible:4})}),t.jsxs("div",{className:"hidden md:block",children:[t.jsxs(Wa,{variant:"ghost",size:"sm",onClick:()=>m(!d),className:"w-full h-8 text-xs bg-background/30 hover:bg-background/50",children:[d?t.jsx(ce,{className:"h-3 w-3 mr-1"}):t.jsx(oe,{className:"h-3 w-3 mr-1"}),d?"Menos":"Mais"," Detalhes"]}),d&&t.jsxs("div",{className:"space-y-3 pt-2 border-t border-border/50 animate-in slide-in-from-top-2 duration-300",children:[t.jsx("div",{className:"space-y-2",children:(()=>{const e=(s=a.level)<=1?0:Math.floor(100*Math.pow(1.5,s-2));var s;const r=a.xp_next_level,n=a.xp-e,i=r-e,o=Math.max(0,Math.min(100,n/i*100));return t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"flex justify-between items-center",children:[t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(ft,{className:"h-3 w-3 text-yellow-500"}),t.jsx("span",{className:"font-medium text-xs text-muted-foreground",children:"Experiência"})]}),t.jsxs("div",{className:"text-xs font-bold",children:[t.jsx("span",{className:"text-yellow-400",children:ah(n)}),t.jsx("span",{className:"text-muted-foreground mx-1",children:"/"}),t.jsx("span",{className:"text-muted-foreground",children:ah(i)})]})]}),t.jsxs("div",{className:"relative",children:[t.jsxs("div",{className:"relative",children:[t.jsx(Gh,{value:o,className:"h-2",style:{background:"rgba(0,0,0,0.2)"}}),t.jsx("div",{className:"absolute top-0 left-0 h-2 bg-gradient-to-r from-amber-400 via-yellow-500 to-orange-400 rounded-full transition-all duration-300",style:{width:`${o}%`}})]}),t.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-yellow-500/10 via-yellow-500/5 to-yellow-500/10 rounded-full pointer-events-none"})]}),t.jsxs("div",{className:"flex justify-between text-xs",children:[t.jsxs("span",{className:"text-muted-foreground",children:["Nível ",a.level]}),t.jsxs("span",{className:"text-yellow-400 font-medium",children:[ah(i-n)," para nv"," ",a.level+1]})]})]})})()}),(a.strength||a.dexterity||a.intelligence||a.wisdom||a.vitality||a.luck)&&t.jsxs("div",{className:"space-y-2",children:[t.jsx("div",{className:"text-xs font-medium text-muted-foreground",children:"Atributos Primários:"}),t.jsxs("div",{className:"grid grid-cols-3 gap-2 text-xs",children:[a.strength&&t.jsxs("div",{className:"bg-red-500/10 rounded p-1 text-center",children:[t.jsx(Fe,{className:"h-3 w-3 mx-auto mb-1 text-red-400"}),t.jsx("div",{className:"text-muted-foreground",children:"FOR"}),t.jsx("div",{className:"font-medium",children:a.strength})]}),a.dexterity&&t.jsxs("div",{className:"bg-green-500/10 rounded p-1 text-center",children:[t.jsx(Le,{className:"h-3 w-3 mx-auto mb-1 text-green-400"}),t.jsx("div",{className:"text-muted-foreground",children:"DES"}),t.jsx("div",{className:"font-medium",children:a.dexterity})]}),a.intelligence&&t.jsxs("div",{className:"bg-purple-500/10 rounded p-1 text-center",children:[t.jsx(pt,{className:"h-3 w-3 mx-auto mb-1 text-purple-400"}),t.jsx("div",{className:"text-muted-foreground",children:"INT"}),t.jsx("div",{className:"font-medium",children:a.intelligence})]}),a.wisdom&&t.jsxs("div",{className:"bg-blue-500/10 rounded p-1 text-center",children:[t.jsx(xt,{className:"h-3 w-3 mx-auto mb-1 text-blue-400"}),t.jsx("div",{className:"text-muted-foreground",children:"SAB"}),t.jsx("div",{className:"font-medium",children:a.wisdom})]}),a.vitality&&t.jsxs("div",{className:"bg-pink-500/10 rounded p-1 text-center",children:[t.jsx(Be,{className:"h-3 w-3 mx-auto mb-1 text-pink-400"}),t.jsx("div",{className:"text-muted-foreground",children:"VIT"}),t.jsx("div",{className:"font-medium",children:a.vitality})]}),a.luck&&t.jsxs("div",{className:"bg-yellow-500/10 rounded p-1 text-center",children:[t.jsx(ft,{className:"h-3 w-3 mx-auto mb-1 text-yellow-400"}),t.jsx("div",{className:"text-muted-foreground",children:"SOR"}),t.jsx("div",{className:"font-medium",children:a.luck})]})]})]}),(a.critical_chance||a.critical_damage)&&t.jsxs("div",{className:"space-y-2",children:[t.jsx("div",{className:"text-xs font-medium text-muted-foreground",children:"Combate Avançado:"}),t.jsxs("div",{className:"grid grid-cols-2 gap-2 text-xs",children:[a.critical_chance&&t.jsxs("div",{className:"bg-background/20 rounded p-2",children:[t.jsxs("div",{className:"flex items-center gap-1 text-muted-foreground",children:[t.jsx(Ht,{className:"h-3 w-3"}),t.jsx("span",{children:"Crítico"})]}),t.jsx("div",{className:"font-medium text-yellow-400",children:t.jsx(Ex,{value:a.critical_chance,modifications:a.active_effects?.attribute_modifications?.filter((e=>"critical_chance"===e.attribute))||[],size:"sm",showTooltip:!0,label:"%"})})]}),a.critical_damage&&t.jsxs("div",{className:"bg-background/20 rounded p-2",children:[t.jsxs("div",{className:"flex items-center gap-1 text-muted-foreground",children:[t.jsx(bt,{className:"h-3 w-3"}),t.jsx("span",{children:"Dano Crit"})]}),t.jsx("div",{className:"font-medium text-orange-400",children:t.jsx(Ex,{value:a.critical_damage,modifications:a.active_effects?.attribute_modifications?.filter((e=>"critical_damage"===e.attribute))||[],size:"sm",showTooltip:!0,label:"%"})})]})]})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsx("div",{className:"text-xs font-medium text-muted-foreground",children:"Habilidades:"}),t.jsxs("div",{className:"grid grid-cols-2 gap-2 text-xs",children:[(a.sword_mastery||0)>1&&t.jsxs("div",{className:"bg-red-500/10 rounded p-1 text-center",children:[t.jsx(qe,{className:"h-3 w-3 mx-auto mb-1 text-red-400"}),t.jsx("div",{className:"text-muted-foreground",children:"Espada"}),t.jsxs("div",{className:"font-medium",children:["Lv ",a.sword_mastery]}),t.jsxs("div",{className:"text-xs text-muted-foreground",children:[a.sword_mastery_xp||0," XP"]})]}),(a.axe_mastery||0)>1&&t.jsxs("div",{className:"bg-orange-500/10 rounded p-1 text-center",children:[t.jsx(bt,{className:"h-3 w-3 mx-auto mb-1 text-orange-400"}),t.jsx("div",{className:"text-muted-foreground",children:"Machado"}),t.jsxs("div",{className:"font-medium",children:["Lv ",a.axe_mastery]}),t.jsxs("div",{className:"text-xs text-muted-foreground",children:[a.axe_mastery_xp||0," XP"]})]}),(a.blunt_mastery||0)>1&&t.jsxs("div",{className:"bg-brown-500/10 rounded p-1 text-center",children:[t.jsx(Gt,{className:"h-3 w-3 mx-auto mb-1 text-brown-400"}),t.jsx("div",{className:"text-muted-foreground",children:"Concussão"}),t.jsxs("div",{className:"font-medium",children:["Lv ",a.blunt_mastery]}),t.jsxs("div",{className:"text-xs text-muted-foreground",children:[a.blunt_mastery_xp||0," XP"]})]}),(a.defense_mastery||0)>1&&t.jsxs("div",{className:"bg-blue-500/10 rounded p-1 text-center",children:[t.jsx(De,{className:"h-3 w-3 mx-auto mb-1 text-blue-400"}),t.jsx("div",{className:"text-muted-foreground",children:"Defesa"}),t.jsxs("div",{className:"font-medium",children:["Lv ",a.defense_mastery]}),t.jsxs("div",{className:"text-xs text-muted-foreground",children:[a.defense_mastery_xp||0," XP"]})]}),(a.magic_mastery||0)>1&&t.jsxs("div",{className:"bg-purple-500/10 rounded p-1 text-center",children:[t.jsx(pt,{className:"h-3 w-3 mx-auto mb-1 text-purple-400"}),t.jsx("div",{className:"text-muted-foreground",children:"Magia"}),t.jsxs("div",{className:"font-medium",children:["Lv ",a.magic_mastery]}),t.jsxs("div",{className:"text-xs text-muted-foreground",children:[a.magic_mastery_xp||0," XP"]})]})]})]}),Boolean(a.attribute_points&&a.attribute_points>0)&&t.jsxs("button",{onClick:()=>{window.dispatchEvent(new CustomEvent("openAttributeModal"))},className:"w-full bg-yellow-500/10 border border-yellow-500/20 rounded p-2 hover:bg-yellow-500/20 hover:border-yellow-500/40 transition-all duration-200 cursor-pointer relative overflow-hidden",children:[t.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-yellow-500/5 via-yellow-500/10 to-yellow-500/5 animate-pulse"}),t.jsxs("div",{className:"relative flex items-center gap-2 text-yellow-400",children:[t.jsx(ft,{className:"h-4 w-4 animate-pulse"}),t.jsxs("span",{className:"text-sm font-medium",children:[a.attribute_points," pontos de atributo disponíveis"]})]})]}),Boolean(a.isDefending)&&t.jsxs("div",{className:"flex items-center gap-2 text-blue-400 bg-blue-500/10 rounded p-2",children:[t.jsx(De,{className:"h-4 w-4"}),t.jsx("span",{className:"text-sm font-medium",children:"Postura Defensiva Ativa"})]}),Boolean(a.defenseCooldown>0)&&t.jsxs("div",{className:"flex items-center gap-2 text-orange-400 bg-orange-500/10 rounded p-2",children:[t.jsx(Gt,{className:"h-4 w-4"}),t.jsxs("span",{className:"text-sm",children:["Defesa em Cooldown: ",a.defenseCooldown," turnos"]})]})]})]})]}),t.jsxs("div",{className:""+(v?"space-y-1 md:space-y-2":"space-y-2 md:space-y-4"),children:[t.jsxs("div",{className:"text-center relative",children:[t.jsxs("div",{className:"relative inline-block mb-2 md:mb-4",children:[t.jsx("div",{className:"w-16 h-16 md:w-24 md:h-24 lg:w-28 lg:h-28 rounded-full bg-gradient-to-br from-red-500/20 to-orange-500/20 border-2 md:border-3 flex items-center justify-center text-2xl md:text-4xl lg:text-5xl transition-all duration-500 "+(o?"border-red-500/30 scale-100":"border-red-500 shadow-xl md:shadow-2xl shadow-red-500/40 scale-105 md:scale-110"),children:s.image||"👾"}),!o&&t.jsxs("div",{className:"absolute -top-1 -right-1 md:-top-2 md:-right-2",children:[t.jsx("div",{className:"w-3 h-3 md:w-5 md:h-5 bg-red-500 rounded-full animate-ping"}),t.jsx("div",{className:"absolute top-0 right-0 w-3 h-3 md:w-5 md:h-5 bg-red-500 rounded-full"})]})]}),t.jsxs("div",{className:"space-y-1 md:space-y-2",children:[t.jsxs("h3",{className:"font-bold text-sm md:text-lg lg:text-xl flex items-center justify-center gap-1 md:gap-2",children:[t.jsx($e,{className:"h-3 w-3 md:h-5 md:w-5 text-red-500"}),t.jsx("span",{className:"truncate",children:s.name})]}),t.jsxs("div",{className:"flex items-center justify-center gap-1 md:gap-2 flex-wrap",children:[t.jsxs(Nu,{variant:"outline",className:"bg-background/50 text-xs px-1 md:px-2",children:[t.jsx(xt,{className:"h-2 w-2 md:h-3 md:w-3 mr-1"}),"Nv ",s.level]}),s.tier&&s.tier>1&&t.jsxs(Nu,{variant:"outline",className:"bg-purple-500/20 text-purple-400 border-purple-500/30 text-xs px-1 md:px-2",children:[t.jsx(ft,{className:"h-2 w-2 md:h-3 md:w-3 mr-1"}),"Tier ",s.tier]}),s.is_boss&&t.jsxs(Nu,{className:"bg-red-500/20 text-red-400 border-red-500/30 text-xs px-1 md:px-2",children:[t.jsx(Je,{className:"h-2 w-2 md:h-3 md:w-3 mr-1"}),"BOSS"]}),t.jsx(Nu,{className:`text-xs border px-1 md:px-2 ${(e=>{switch(e){case"aggressive":return"bg-red-500/20 text-red-400 border-red-500/30";case"defensive":return"bg-blue-500/20 text-blue-400 border-blue-500/30";case"balanced":return"bg-green-500/20 text-green-400 border-green-500/30";default:return"bg-gray-500/20 text-gray-400 border-gray-500/30"}})(s.behavior)}`,children:(S=s.behavior,{aggressive:"Agressivo",defensive:"Defensivo",balanced:"Equilibrado"}[S]||S)})]})]}),p.filter((e=>!e.isPlayer)).map((e=>t.jsxs("div",{className:"absolute pointer-events-none z-20 font-bold text-lg animate-damage-float "+(e.isCritical?"text-orange-400 text-2xl animate-damage-critical":"text-orange-300"),style:{left:"50%",top:"20%",transform:"translateX(-50%)",textShadow:"2px 2px 4px rgba(0,0,0,0.8)"},children:["-",e.damage,e.isCritical&&t.jsx("span",{className:"ml-1 text-yellow-400 text-sm",children:"CRÍTICO!"})]},e.id)))]}),t.jsxs("div",{className:"space-y-2 md:space-y-3",children:[t.jsxs("div",{children:[t.jsxs("div",{className:"flex justify-between items-center mb-1",children:[t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(Be,{className:"h-3 w-3 md:h-4 md:w-4 text-red-500"}),t.jsx("span",{className:"font-medium text-xs md:text-sm",children:"HP"})]}),t.jsxs("span",{className:"text-xs md:text-sm font-bold",children:[s.hp,"/",s.maxHp]})]}),t.jsxs("div",{className:"relative",children:[t.jsx(Gh,{value:i,className:"h-2 md:h-3",style:{background:"rgba(0,0,0,0.2)"}}),t.jsx("div",{className:"absolute top-0 left-0 h-2 md:h-3 rounded-full transition-all duration-300 "+(i>=70?"bg-green-500":i>=40?"bg-yellow-500":i>=20?"bg-orange-500":"bg-red-500"),style:{width:`${i}%`}})]})]}),Boolean(s.mana>0)&&t.jsxs("div",{children:[t.jsxs("div",{className:"flex justify-between items-center mb-1",children:[t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(pt,{className:"h-3 w-3 md:h-4 md:w-4 text-purple-500"}),t.jsx("span",{className:"font-medium text-xs md:text-sm",children:"MP"})]}),t.jsx("span",{className:"text-xs md:text-sm font-bold",children:s.mana})]}),t.jsxs("div",{className:"relative",children:[t.jsx("div",{className:"h-2 md:h-3 bg-black/20 rounded-full"}),t.jsx("div",{className:"absolute top-0 left-0 h-2 md:h-3 bg-gradient-to-r from-blue-500 via-cyan-500 to-purple-500 rounded-full transition-all duration-300",style:{width:`${Math.min(100,s.mana/Math.max(s.mana,100)*100)}%`}})]})]})]}),s.active_effects&&t.jsx("div",{className:"flex justify-center mb-2 md:mb-3",children:t.jsx(eg,{activeEffects:s.active_effects,size:"sm",maxVisible:4})}),t.jsxs("div",{className:"grid grid-cols-3 gap-1 md:gap-2",children:[t.jsxs("div",{className:"bg-red-500/10 border border-red-500/20 rounded p-1 md:p-2 text-center",children:[t.jsx(qe,{className:"h-3 w-3 md:h-4 md:w-4 mx-auto mb-1 text-red-400"}),t.jsx("div",{className:"text-xs font-bold text-red-400",children:s.attack})]}),t.jsxs("div",{className:"bg-blue-500/10 border border-blue-500/20 rounded p-1 md:p-2 text-center",children:[t.jsx(De,{className:"h-3 w-3 md:h-4 md:w-4 mx-auto mb-1 text-blue-400"}),t.jsx("div",{className:"text-xs font-bold text-blue-400",children:s.defense})]}),t.jsxs("div",{className:"bg-yellow-500/10 border border-yellow-500/20 rounded p-1 md:p-2 text-center",children:[t.jsx(Le,{className:"h-3 w-3 md:h-4 md:w-4 mx-auto mb-1 text-yellow-400"}),t.jsx("div",{className:"text-xs font-bold text-yellow-400",children:s.speed})]})]}),t.jsxs("div",{className:"hidden md:block",children:[t.jsxs(Wa,{variant:"ghost",size:"sm",onClick:()=>h(!u),className:"w-full h-8 text-xs bg-background/30 hover:bg-background/50",children:[u?t.jsx(ce,{className:"h-3 w-3 mr-1"}):t.jsx(oe,{className:"h-3 w-3 mr-1"}),u?"Menos":"Mais"," Detalhes"]}),u&&t.jsxs("div",{className:"space-y-3 pt-2 border-t border-border/50 animate-in slide-in-from-top-2 duration-300",children:[t.jsxs("div",{className:"grid grid-cols-2 gap-3 text-xs",children:[t.jsxs("div",{className:"bg-background/20 rounded p-2",children:[t.jsx("div",{className:"text-muted-foreground",children:"Recompensa XP"}),t.jsx("div",{className:"font-medium text-blue-400",children:s.reward_xp})]}),t.jsxs("div",{className:"bg-background/20 rounded p-2",children:[t.jsx("div",{className:"text-muted-foreground",children:"Recompensa Gold"}),t.jsx("div",{className:"font-medium text-yellow-400",children:s.reward_gold})]})]}),Boolean(s.strength||s.dexterity||s.intelligence)&&t.jsxs("div",{className:"space-y-2",children:[t.jsx("div",{className:"text-xs font-medium text-muted-foreground",children:"Atributos Primários:"}),t.jsxs("div",{className:"grid grid-cols-3 gap-2 text-xs",children:[Boolean(s.strength)&&t.jsxs("div",{className:"bg-red-500/10 rounded p-1 text-center",children:[t.jsx(Fe,{className:"h-3 w-3 mx-auto mb-1 text-red-400"}),t.jsx("div",{className:"text-muted-foreground",children:"FOR"}),t.jsx("div",{className:"font-medium",children:s.strength})]}),Boolean(s.dexterity)&&t.jsxs("div",{className:"bg-green-500/10 rounded p-1 text-center",children:[t.jsx(Le,{className:"h-3 w-3 mx-auto mb-1 text-green-400"}),t.jsx("div",{className:"text-muted-foreground",children:"DES"}),t.jsx("div",{className:"font-medium",children:s.dexterity})]}),Boolean(s.intelligence)&&t.jsxs("div",{className:"bg-purple-500/10 rounded p-1 text-center",children:[t.jsx(pt,{className:"h-3 w-3 mx-auto mb-1 text-purple-400"}),t.jsx("div",{className:"text-muted-foreground",children:"INT"}),t.jsx("div",{className:"font-medium",children:s.intelligence})]})]})]}),Boolean(s.critical_chance||s.critical_damage)&&t.jsxs("div",{className:"space-y-2",children:[t.jsx("div",{className:"text-xs font-medium text-muted-foreground",children:"Combate Avançado:"}),t.jsxs("div",{className:"grid grid-cols-2 gap-2 text-xs",children:[Boolean(s.critical_chance)&&t.jsxs("div",{className:"bg-background/20 rounded p-2",children:[t.jsxs("div",{className:"flex items-center gap-1 text-muted-foreground",children:[t.jsx(Ht,{className:"h-3 w-3"}),t.jsx("span",{children:"Crítico"})]}),t.jsxs("div",{className:"font-medium text-yellow-400",children:[(s.critical_chance||0).toFixed(1),"%"]})]}),Boolean(s.critical_damage)&&t.jsxs("div",{className:"bg-background/20 rounded p-2",children:[t.jsxs("div",{className:"flex items-center gap-1 text-muted-foreground",children:[t.jsx(bt,{className:"h-3 w-3"}),t.jsx("span",{children:"Dano Crit"})]}),t.jsxs("div",{className:"font-medium text-orange-400",children:[(s.critical_damage||0).toFixed(0),"%"]})]})]})]}),Boolean(s.physical_resistance||s.magical_resistance||s.debuff_resistance)&&t.jsxs("div",{className:"space-y-2",children:[t.jsx("div",{className:"text-xs font-medium text-muted-foreground",children:"Resistências:"}),t.jsxs("div",{className:"space-y-1",children:[Boolean(s.physical_resistance&&s.physical_resistance>0)&&t.jsxs("div",{className:"flex justify-between items-center text-xs",children:[t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(De,{className:"h-3 w-3 text-red-400"}),t.jsx("span",{children:"Física"})]}),t.jsxs("span",{className:"text-red-400",children:[(100*(s.physical_resistance||0)).toFixed(0),"%"]})]}),Boolean(s.magical_resistance&&s.magical_resistance>0)&&t.jsxs("div",{className:"flex justify-between items-center text-xs",children:[t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(pt,{className:"h-3 w-3 text-blue-400"}),t.jsx("span",{children:"Mágica"})]}),t.jsxs("span",{className:"text-blue-400",children:[(100*(s.magical_resistance||0)).toFixed(0),"%"]})]}),Boolean(s.debuff_resistance&&s.debuff_resistance>0)&&t.jsxs("div",{className:"flex justify-between items-center text-xs",children:[t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(Xt,{className:"h-3 w-3 text-green-400"}),t.jsx("span",{children:"Debuffs"})]}),t.jsxs("span",{className:"text-green-400",children:[(100*(s.debuff_resistance||0)).toFixed(0),"%"]})]})]})]}),Boolean(s.physical_vulnerability&&s.physical_vulnerability>1||s.magical_vulnerability&&s.magical_vulnerability>1)&&t.jsxs("div",{className:"space-y-2",children:[t.jsx("div",{className:"text-xs font-medium text-muted-foreground",children:"Vulnerabilidades:"}),t.jsxs("div",{className:"space-y-1",children:[Boolean(s.physical_vulnerability&&s.physical_vulnerability>1)&&t.jsxs("div",{className:"flex justify-between items-center text-xs",children:[t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(ht,{className:"h-3 w-3 text-red-400"}),t.jsx("span",{children:"Física"})]}),t.jsxs("span",{className:"text-red-400",children:["+",(100*((s.physical_vulnerability||1)-1)).toFixed(0),"%"]})]}),Boolean(s.magical_vulnerability&&s.magical_vulnerability>1)&&t.jsxs("div",{className:"flex justify-between items-center text-xs",children:[t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(ht,{className:"h-3 w-3 text-blue-400"}),t.jsx("span",{children:"Mágica"})]}),t.jsxs("span",{className:"text-blue-400",children:["+",(100*((s.magical_vulnerability||1)-1)).toFixed(0),"%"]})]})]})]}),Boolean(s.primary_trait||s.secondary_trait)&&t.jsxs("div",{className:"space-y-2",children:[t.jsx("div",{className:"text-xs font-medium text-muted-foreground",children:"Características:"}),t.jsxs("div",{className:"space-y-1",children:[Boolean(s.primary_trait)&&t.jsxs("div",{className:"flex items-center gap-2 text-xs",children:[C(s.primary_trait),t.jsx("span",{className:"text-purple-400",children:w(s.primary_trait)})]}),Boolean(s.secondary_trait)&&t.jsxs("div",{className:"flex items-center gap-2 text-xs",children:[C(s.secondary_trait),t.jsx("span",{className:"text-blue-400",children:w(s.secondary_trait)})]})]})]})]})]})]})]})]})})]});var S}function ag({handleAction:a,isPlayerTurn:s,loading:r,player:n,onPlayerStatsUpdate:i,currentEnemy:o,battleRewards:l,potionSlots:c,loadingPotionSlots:d,onSlotsChange:m}){const[h,p]=e.useState(null),[x,f]=e.useState(null),[g,b]=e.useState(null),[v,y]=e.useState(null),[j,N]=e.useState(!1),w=e.useRef(!1),C=e.useRef(0),S=e.useRef(null),E=e.useMemo((()=>!s||r.performAction),[s,r.performAction]),k=e.useMemo((()=>n?.potionUsedThisTurn||!1),[n?.potionUsedThisTurn]),A=e.useMemo((()=>void 0!==n?.hp&&n.hp<=0),[n?.hp]),P=e.useMemo((()=>r.performAction||A),[r.performAction,A]),M=e.useMemo((()=>Boolean(l&&!r.performAction&&!A&&!j&&(!o||void 0!==o.hp&&o.hp<=0))),[l,r.performAction,A,j,o]),T=e.useCallback((async()=>{if(!j&&l){N(!0);try{a("continue"),_.success("Avançando para o próximo andar!",{description:"Preparando nova batalha...",duration:2e3})}catch{_.error("Erro ao avançar para o próximo andar"),N(!1)}}}),[j,l,a]),q=e.useCallback((()=>{const e=Date.now()-C.current;return!w.current&&!(e<300)}),[]),D=e.useCallback((async(e,t,s)=>{if(q()){s?.preventDefault?.(),w.current=!0,C.current=Date.now();try{await a(e,t)}finally{setTimeout((()=>{w.current=!1}),300)}}}),[q,a]),L=e.useCallback((async e=>{const t=n,a=t?.potionUsedThisTurn||!1,o=void 0!==t?.hp&&t.hp<=0,l=!s||r.performAction;if(o||l||null!==h||!t?.id)return;const d=c.find((t=>t.slot_position===e));if(d?.consumable_id)if(a)_.error("Você já usou uma poção neste turno!",{description:"Você só pode usar uma poção por turno",duration:3e3});else if(d.available_quantity<=0)_.error("Poção não disponível!",{description:"Você não possui esta poção no inventário",duration:3e3});else{p(e);try{const{SlotService:a}=await u((async()=>{const{SlotService:e}=await Promise.resolve().then((()=>of));return{SlotService:e}}),void 0),s=await a.consumePotionFromSlot(t.id,e);if(s.success&&s.data){const{message:a,new_hp:r,new_mana:n}=s.data;i(r,n),t&&(t.potionUsedThisTurn=!0),y(e),setTimeout((()=>y(null)),2e3),await m(),_.success(a,{description:`HP: ${r} | Mana: ${n}`,duration:4e3})}else{await m();const t=s.error||"Erro desconhecido ao usar poção";_.error(t,{description:`Slot ${e} - Verifique os logs do console para mais detalhes`,duration:5e3})}}catch(x){try{await m()}catch(f){}_.error("Erro ao usar poção")}finally{p(null)}}else _.warning(`Slot ${$(e)} está vazio`)}),[n,s,r.performAction,h,c,i,m]),$=e=>{switch(e){case 1:return"Q";case 2:return"W";case 3:return"E";default:return""}},R=e.useCallback((e=>{e.preventDefault(),D("attack",void 0,e)}),[D]),I=e.useCallback((e=>{e.preventDefault(),D("defend",void 0,e)}),[D]),F=e.useCallback((e=>{e.preventDefault(),D("flee")}),[D]),V=e.useCallback(((e,t)=>{e.preventDefault(),D("spell",t,e)}),[D]),O=e.useCallback(((e,t)=>{f({...e,position:t})}),[]),B=e.useCallback((()=>{S.current&&clearTimeout(S.current),S.current=setTimeout((()=>{f(null)}),150)}),[]),U=e.useCallback(((e,t)=>{const a=t.currentTarget.getBoundingClientRect(),s={x:a.left+a.width/2,y:a.top-10},r=setTimeout((()=>{O(e,s)}),500);b(r)}),[O]),z=e.useCallback((()=>{g&&(clearTimeout(g),b(null))}),[g]),H=e.useCallback((()=>{g&&(clearTimeout(g),b(null)),B()}),[g,B]),G=e.useCallback(((e,t)=>{t.preventDefault();const a=t.currentTarget.getBoundingClientRect(),s={x:a.left+a.width/2,y:a.top-10},r=setTimeout((()=>{O(e,s)}),500);b(r)}),[O]),X=e.useCallback((()=>{g&&(clearTimeout(g),b(null))}),[g]);e.useEffect((()=>{const e=e=>{const t=n,i=void 0!==t?.hp&&t.hp<=0,o=!s||r.performAction,l=r.performAction||i;if(i||null!==h)return;const c=e.target;if("INPUT"===c.tagName||"TEXTAREA"===c.tagName||"true"===c.contentEditable)return;const d=e.key.toLowerCase();switch(d){case"a":if(o)return;return e.preventDefault(),void a("attack");case"s":if(o||t?.defenseCooldown&&t.defenseCooldown>0)return;return e.preventDefault(),void a("defend");case"d":if(l)return;return e.preventDefault(),void D("flee")}if(o)return;let m=0;switch(d){case"q":m=1;break;case"w":m=2;break;case"e":m=3;break;default:{const s=parseInt(d)-1;if(t&&s>=0&&s<Math.min(3,t.spells.length)){const r=t.spells[s];t.mana>=r.mana_cost&&0===r.current_cooldown&&(e.preventDefault(),a("spell",r.id))}return}}m>0&&(e.preventDefault(),L(m))};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)}),[n,s,r.performAction,h,a,D,L]);const W=e.useMemo((()=>n?.spells?.slice(0,3)||[]),[n?.spells]);return n?t.jsxs(t.Fragment,{children:[A&&t.jsx("div",{className:"absolute inset-0 bg-black/60 backdrop-blur-sm z-50 flex items-center justify-center rounded-xl",children:t.jsxs("div",{className:"text-center space-y-3",children:[t.jsx("div",{className:"text-red-400 text-2xl animate-pulse",children:"💀"}),t.jsx("div",{className:"text-red-400 font-bold text-lg",children:"Personagem Morto"}),t.jsx("div",{className:"text-muted-foreground text-sm",children:"Interface bloqueada"})]})}),t.jsx(pu,{className:"border-0 bg-card/50 backdrop-blur-sm relative",children:t.jsxs(bu,{className:"p-3 md:p-3 space-y-3 md:space-y-2",children:[M&&!A&&t.jsx("div",{className:"mb-4 p-4 bg-gradient-to-r from-green-500/10 via-emerald-500/10 to-teal-500/10 border border-green-500/20 rounded-xl animate-in slide-in-from-top-2 duration-500",children:t.jsxs("div",{className:"text-center space-y-3",children:[t.jsxs("div",{className:"flex items-center justify-center gap-2",children:[t.jsx("div",{className:"text-lg",children:"⚔️"}),t.jsx("div",{className:"text-sm text-green-400 font-medium",children:"Inimigo derrotado - Pronto para avançar"}),t.jsx("div",{className:"text-lg",children:"⚔️"})]}),t.jsxs("div",{className:"bg-background/30 rounded-lg p-3 border border-green-500/10",children:[t.jsx("div",{className:"text-xs text-green-300 font-medium mb-1",children:"Recompensas Obtidas:"}),t.jsxs("div",{className:"flex justify-center items-center gap-4 text-sm",children:[t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(ft,{className:"h-4 w-4 text-blue-400"}),t.jsxs("span",{className:"text-blue-400 font-semibold",children:["+",l?.xp," XP"]})]}),t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx("span",{className:"text-yellow-400 text-lg",children:"💰"}),t.jsxs("span",{className:"text-yellow-400 font-semibold",children:["+",l?.gold," Gold"]})]}),l?.drops&&l.drops.length>0&&t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx("span",{className:"text-purple-400 text-lg",children:"📦"}),t.jsxs("span",{className:"text-purple-400 font-semibold",children:["+",l.drops.length," item",l.drops.length>1?"s":""]})]})]}),l?.leveledUp&&t.jsx("div",{className:"mt-2 text-center",children:t.jsxs(Nu,{className:"bg-yellow-500/20 text-yellow-400 border-yellow-500/30 animate-pulse",children:["🎊 LEVEL UP! Nível ",l.newLevel]})})]}),t.jsx(Wa,{onClick:T,disabled:r.performAction||A||j,size:"lg",className:"bg-gradient-to-r from-green-600 to-emerald-600 hover:from-green-700 hover:to-emerald-700 text-white font-semibold px-6 py-3 rounded-xl shadow-lg shadow-green-500/20 transition-all duration-200 transform hover:scale-105 w-full md:w-auto cursor-pointer",children:r.performAction||j?t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-2 border-white border-t-transparent mr-2"}),"Avançando..."]}):t.jsxs(t.Fragment,{children:[t.jsx(Kt,{className:"h-4 w-4 mr-2"}),"Continuar Aventura"]})}),t.jsx("div",{className:"text-xs text-muted-foreground",children:"Continue para o próximo andar da torre"})]})}),t.jsxs("div",{className:"flex flex-col md:flex-row md:justify-center md:items-start gap-3 md:gap-4",children:[t.jsxs("div",{className:"flex-1 md:max-w-xs md:flex-none",children:[t.jsx("div",{className:"text-xs font-medium text-muted-foreground/80 mb-2 text-center md:text-left",children:"Ações de Combate"}),t.jsxs("div",{className:"flex justify-center md:justify-start gap-2",children:[t.jsxs("div",{className:"relative",children:[t.jsx(Wa,{onClick:R,disabled:E||M||A,variant:"ghost",size:"lg",className:"h-12 w-12 md:h-14 md:w-14 rounded-xl p-0 border-2 border-red-500/30 bg-red-500/5 hover:bg-red-500/10 hover:border-red-500/50 shadow-lg shadow-red-500/10 transition-all duration-200 cursor-pointer "+(A?"opacity-30 cursor-not-allowed":""),children:t.jsx(qe,{className:"h-4 w-4 md:h-5 md:w-5 text-red-500/80"})}),t.jsx(Nu,{variant:"outline",className:"absolute -top-1 -right-1 md:-top-2 md:-right-2 h-4 w-4 md:h-5 md:w-5 p-0 text-xs font-medium flex items-center justify-center bg-background/90 border-muted-foreground/30 hidden md:flex",children:"A"})]}),t.jsxs("div",{className:"relative",children:[t.jsx(Wa,{onClick:I,disabled:E||n.defenseCooldown>0||M||A,variant:"ghost",size:"lg",className:"h-12 w-12 md:h-14 md:w-14 rounded-xl p-0 border-2 border-blue-500/30 bg-blue-500/5 hover:bg-blue-500/10 hover:border-blue-500/50 shadow-lg shadow-blue-500/10 transition-all duration-200 cursor-pointer "+(A?"opacity-30 cursor-not-allowed":""),children:t.jsx(De,{className:"h-4 w-4 md:h-5 md:w-5 text-blue-500/80"})}),t.jsx(Nu,{variant:"outline",className:"absolute -top-1 -right-1 md:-top-2 md:-right-2 h-4 w-4 md:h-5 md:w-5 p-0 text-xs font-medium flex items-center justify-center bg-background/90 border-muted-foreground/30 hidden md:flex",style:{display:n.defenseCooldown>0?"none":"flex"},children:"S"})]}),t.jsxs("div",{className:"relative",children:[t.jsx(Wa,{onClick:F,disabled:P,variant:"ghost",size:"lg",className:"h-12 w-12 md:h-14 md:w-14 rounded-xl p-0 border-2 border-amber-500/30 bg-amber-500/5 hover:bg-amber-500/10 hover:border-amber-500/50 shadow-lg shadow-amber-500/10 transition-all duration-200 cursor-pointer "+(A?"opacity-30 cursor-not-allowed":r.performAction?"opacity-50 animate-pulse":""),children:t.jsx(Pe,{className:"h-4 w-4 md:h-5 md:w-5 text-amber-500/80"})}),t.jsx(Nu,{variant:"outline",className:"absolute -top-1 -right-1 md:-top-2 md:-right-2 h-4 w-4 md:h-5 md:w-5 p-0 text-xs font-medium flex items-center justify-center bg-background/90 border-muted-foreground/30 hidden md:flex",children:"D"})]})]})]}),t.jsxs("div",{className:"flex-1 md:max-w-xs md:flex-none",children:[t.jsx("div",{className:"text-xs font-medium text-muted-foreground/80 mb-2 text-center md:text-right",children:"Poções Rápidas"}),t.jsx("div",{className:"flex justify-center md:justify-end gap-1 md:gap-2",children:d?[1,2,3].map((e=>t.jsxs("div",{className:"relative",children:[t.jsx("div",{className:"h-12 w-12 md:h-14 md:w-14 rounded-xl border-2 border-dashed border-muted-foreground/20 bg-muted/10 animate-pulse"}),t.jsx(Nu,{variant:"outline",className:"absolute -top-1 -right-1 md:-top-2 md:-right-2 h-4 w-4 md:h-5 md:w-5 p-0 text-xs font-medium flex items-center justify-center bg-background/90 border-muted-foreground/30",children:$(e)})]},e))):(()=>{const e=[1,2,3].map((e=>{const t=c.find((t=>t.slot_position===e));return t&&t.consumable_id?t.available_quantity<=0?{slot_position:e,consumable_id:null,consumable_name:null,consumable_description:null,effect_value:null,consumable_type:null,available_quantity:0,consumable_price:null}:t:{slot_position:e,consumable_id:null,consumable_name:null,consumable_description:null,effect_value:null,consumable_type:null,available_quantity:0,consumable_price:null}}));return e.map((e=>{const a=$(e.slot_position),s=!e.consumable_id||e.available_quantity<=0,r=h===e.slot_position,n=v===e.slot_position,i=k&&!s,o=s?0:Math.max(0,e.available_quantity),l=s?{title:`Slot ${a}`,description:"Slot vazio - arraste uma poção aqui",stats:[{label:"Tecla de atalho",value:a}]}:{title:e.consumable_name||"Poção",description:e.consumable_description||"",stats:[{label:"Efeito",value:`+${e.effect_value}`},{label:"Quantidade",value:`${o}`},{label:"Tecla",value:a},...i?[{label:"Status",value:"Já usada neste turno"}]:[]]},c=!s&&0===o;return t.jsxs("div",{className:"relative",children:[t.jsxs(Wa,{onClick:()=>L(e.slot_position),disabled:E||s||r||M||i||c||A,variant:"ghost",className:`h-12 w-12 md:h-14 md:w-14 rounded-xl p-2 relative border-2 transition-all duration-200 cursor-pointer ${s?"border-dashed border-muted-foreground/20 bg-transparent hover:bg-muted/10 hover:border-muted-foreground/30":c?"border-red-500/30 bg-red-500/5 opacity-50 cursor-not-allowed":i?"border-orange-500/30 bg-orange-500/5 opacity-50 cursor-not-allowed":"border-emerald-500/30 bg-emerald-500/5 hover:bg-emerald-500/10 hover:border-emerald-500/50 shadow-lg shadow-emerald-500/10"} ${r?"opacity-50":""} ${n?"animate-pulse scale-110":""} ${A?"opacity-30 cursor-not-allowed":""}`,onMouseDown:e=>U(l,e),onMouseUp:z,onMouseLeave:H,onTouchStart:e=>G(l,e),onTouchEnd:X,children:[s?t.jsx(Ke,{className:"h-4 w-4 md:h-5 md:w-5 text-muted-foreground/40"}):e.consumable_id?t.jsxs("div",{className:"flex items-center justify-center",children:[t.jsx(tf,{consumable:{id:e.consumable_id,name:e.consumable_name||"Poção",description:e.consumable_description||"",type:e.consumable_type||"potion",effect_value:e.effect_value||0,price:e.consumable_price||0,level_requirement:1,created_at:"",updated_at:""},size:"lg",className:"h-5 w-5",showFallback:!0}),(i||c)&&t.jsxs("div",{className:"absolute inset-0 flex items-center justify-center",children:[t.jsx("div",{className:"w-6 h-0.5 bg-red-500 rotate-45 absolute"}),t.jsx("div",{className:"w-6 h-0.5 bg-red-500 -rotate-45 absolute"})]})]}):null,r&&t.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-background/80 rounded-xl",children:t.jsx("div",{className:"animate-spin rounded-full h-3 w-3 md:h-4 md:w-4 border-2 border-primary border-t-transparent"})}),n&&t.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:t.jsx("div",{className:"text-green-400 font-bold text-xs animate-bounce",children:"✓"})})]}),!s&&o>0&&t.jsx("div",{className:"absolute -bottom-1 -left-1 text-white text-xs rounded-full h-5 w-5 flex items-center justify-center border border-background font-semibold "+(o<5?"bg-orange-500/90":"bg-emerald-500/90"),children:o}),t.jsx(Nu,{variant:"outline",className:"absolute -top-1 -right-1 md:-top-2 md:-right-2 h-4 w-4 md:h-5 md:w-5 p-0 text-xs font-medium flex items-center justify-center border-muted-foreground/30 "+(i?"bg-orange-500/20 text-orange-400 border-orange-500/30":c?"bg-red-500/20 text-red-400 border-red-500/30":"bg-background/90"),children:a}),i&&!s&&t.jsx("div",{className:"absolute top-0 left-0 bg-orange-500 text-white text-xs rounded-full h-4 w-4 flex items-center justify-center border border-background",children:"✗"})]},e.slot_position)}))})()})]})]}),W.length>0&&t.jsx(t.Fragment,{children:t.jsxs("div",{className:"border-t border-border/50 pt-2",children:[t.jsx("div",{className:"text-xs font-medium text-muted-foreground/80 mb-2 text-center",children:"Magias"}),t.jsx("div",{className:"flex justify-center gap-2 md:max-w-md md:mx-auto",children:W.map(((e,a)=>{const s=!!n&&(n.mana>=e.mana_cost&&0===e.current_cooldown),r=(e=>{const a=e.name.toLowerCase(),s=e.description.toLowerCase();return a.includes("bola de fogo")||a.includes("fireball")||s.includes("fogo")?t.jsx(Yt,{className:"h-4 w-4"}):a.includes("raio de gelo")||a.includes("ice")||s.includes("gelo")?t.jsx(Jt,{className:"h-4 w-4"}):a.includes("cura")||a.includes("heal")||s.includes("restaura")?t.jsx(Be,{className:"h-4 w-4"}):a.includes("raio")||a.includes("bolt")||s.includes("raio")?t.jsx(Le,{className:"h-4 w-4"}):a.includes("escudo")||a.includes("shield")||s.includes("defesa")?t.jsx(Xt,{className:"h-4 w-4"}):a.includes("dano")||s.includes("damage")||s.includes("dano")?t.jsx(bt,{className:"h-4 w-4"}):s.includes("overtime")||s.includes("tempo")?t.jsx(Gt,{className:"h-4 w-4"}):t.jsx(pt,{className:"h-4 w-4"})})(e),i=(a+1).toString(),o={title:e.name,description:e.description,stats:[{label:"Custo de Mana",value:`${e.mana_cost}`},{label:"Cooldown",value:e.current_cooldown>0?`${e.current_cooldown} turnos`:"Disponível"},{label:"Dano/Efeito",value:`${e.effect_value}`},{label:"Tecla",value:i}]};return t.jsxs("div",{className:"relative",children:[t.jsxs(Wa,{onClick:t=>V(t,e.id),onMouseDown:e=>U(o,e),onMouseUp:z,onMouseLeave:H,onTouchStart:e=>G(o,e),onTouchEnd:X,disabled:E||!s||M||A||!n,variant:"ghost",size:"lg",className:`h-12 w-12 md:h-14 md:w-14 rounded-xl p-0 relative border-2 transition-all duration-200 cursor-pointer ${s?"border-violet-500/30 bg-violet-500/5 hover:bg-violet-500/10 hover:border-violet-500/50 shadow-lg shadow-violet-500/10":"border-muted-foreground/10 bg-muted/5 opacity-50 cursor-not-allowed"} ${A?"opacity-30 cursor-not-allowed":""}`,children:[t.jsx("div",{className:s?"text-violet-500/80":"text-muted-foreground/50",children:r}),e.current_cooldown>0&&t.jsx("div",{className:"absolute -top-1 -right-1 bg-red-500/90 text-white text-xs rounded-full h-4 w-4 flex items-center justify-center border border-background",children:e.current_cooldown}),t.jsx("div",{className:"absolute -bottom-1 -right-1 text-white text-xs rounded-full h-4 w-4 flex items-center justify-center border border-background "+(s?"bg-blue-500/90":"bg-muted-foreground/70"),children:e.mana_cost})]}),t.jsx(Nu,{variant:"outline",className:"absolute -top-1 -left-1 md:-top-2 md:-left-2 h-4 w-4 md:h-5 md:w-5 p-0 text-xs font-medium flex items-center justify-center bg-background/90 border-muted-foreground/30 hidden md:flex",children:i})]},e.id)}))})]})}),t.jsx("div",{className:"hidden md:block text-center",children:t.jsx("div",{className:"text-xs text-muted-foreground/60",children:A?"Interface bloqueada - Personagem morto":"Atalhos: A/S/D (Combate) • Q/W/E (Poções) • 1/2/3 (Magias)"})})]})}),x&&t.jsx("div",{className:"fixed z-50 pointer-events-none",style:{left:x.position.x,top:x.position.y,transform:"translate(-50%, -100%)"},children:t.jsxs("div",{className:"bg-background/95 backdrop-blur-sm border border-border/50 rounded-lg p-3 shadow-xl max-w-xs",children:[t.jsx("h4",{className:"font-medium text-sm mb-1",children:x.title}),t.jsx("p",{className:"text-xs text-muted-foreground mb-2 leading-relaxed",children:x.description}),x.stats.length>0&&t.jsx("div",{className:"space-y-1",children:x.stats.map(((e,a)=>t.jsxs("div",{className:"flex justify-between text-xs",children:[t.jsxs("span",{className:"text-muted-foreground",children:[e.label,":"]}),t.jsx("span",{className:"font-medium",children:e.value})]},a)))})]})})]}):t.jsx("div",{className:"min-h-[200px] flex items-center justify-center",children:t.jsx("div",{className:"text-muted-foreground",children:"Carregando interface de batalha..."})})}function sg({isOpen:a,onContinue:s,onReturnToHub:r,onOpenAttributeModal:n,rewards:i,leveledUp:o,newLevel:l,hasAttributePoints:c}){const d=zf();e.useEffect((()=>{if(d){const e=document.createElement("style");return e.textContent="\n        .victory-modal-landscape .scroll-area {\n          max-height: calc(90vh - 140px);\n          overflow-y: auto;\n          -webkit-overflow-scrolling: touch;\n        }\n        .victory-modal-buttons {\n          min-height: 24px !important;\n          padding: 0.15rem 0.3rem !important;\n          font-size: 0.65rem !important;\n          font-weight: 600 !important;\n          line-height: 1 !important;\n        }\n        .victory-modal-landscape [data-radix-dialog-content] {\n          max-height: 90vh !important;\n        }\n      ",document.head.appendChild(e),()=>{document.head.removeChild(e)}}}),[d]);return t.jsx(Qo,{children:a&&t.jsx(_h,{open:a,children:t.jsxs(Sh,{className:"overflow-hidden "+(d?"max-w-[98vw] max-h-[98vh] p-2 victory-modal-landscape w-[98vw]":"sm:max-w-[425px]"),children:[t.jsxs(Eh,{className:"relative "+(d?"pb-2":""),children:[!d&&t.jsx(Jm.div,{initial:{scale:0},animate:{scale:1},transition:{type:"spring",duration:.5},className:"absolute -top-12 left-1/2 -translate-x-1/2 w-24 h-24 bg-yellow-500/20 rounded-full flex items-center justify-center",children:t.jsx(ae,{className:"h-12 w-12 text-yellow-500"})}),t.jsxs(Jm.div,{initial:{y:20,opacity:0},animate:{y:0,opacity:1},transition:{delay:.3},className:"flex items-center gap-3 "+(d?"justify-start":"flex-col text-center pt-12"),children:[d&&t.jsx(Jm.div,{initial:{scale:0},animate:{scale:1},transition:{type:"spring",duration:.5},className:"w-10 h-10 bg-yellow-500/20 rounded-full flex items-center justify-center flex-shrink-0",children:t.jsx(ae,{className:"h-5 w-5 text-yellow-500"})}),t.jsxs("div",{className:d?"text-left":"text-center",children:[t.jsx(Ah,{className:"font-bold "+(d?"text-base":"text-2xl"),children:"Vitória!"}),t.jsx(Ph,{className:""+(d?"text-xs":""),children:"Você derrotou o inimigo e avançou para o próximo andar!"})]})]})]}),t.jsx("div",{className:d?"scroll-area overflow-y-auto max-h-[calc(98vh-100px)]":"",children:t.jsxs(Jm.div,{className:""+(d?"py-1 space-y-1":"space-y-4 py-4"),initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.5},children:[t.jsxs("div",{className:""+(d?"grid grid-cols-2 gap-1 mb-1":"space-y-4"),children:[t.jsxs(Jm.div,{className:"flex items-center gap-2 bg-primary/10 rounded-lg "+(d?"p-1":"p-3 text-lg"),whileHover:{scale:1.02},children:[t.jsx(ft,{className:"text-yellow-500 "+(d?"h-3 w-3":"h-6 w-6")}),t.jsxs("div",{className:"min-w-0 flex-1",children:[t.jsx("div",{className:"font-semibold "+(d?"text-xs":""),children:"Experiência"}),t.jsxs("div",{className:"font-bold text-primary "+(d?"text-xs":"text-2xl"),children:["+",i.xp," XP"]})]})]}),t.jsxs(Jm.div,{className:"flex items-center gap-2 bg-primary/10 rounded-lg "+(d?"p-1":"p-3 text-lg"),whileHover:{scale:1.02},children:[t.jsx(Ve,{className:"text-yellow-400 "+(d?"h-3 w-3":"h-6 w-6")}),t.jsxs("div",{className:"min-w-0 flex-1",children:[t.jsx("div",{className:"font-semibold "+(d?"text-xs":""),children:"Ouro"}),t.jsxs("div",{className:"font-bold text-primary "+(d?"text-xs":"text-2xl"),children:["+",ah(i.gold)," Gold"]})]})]})]}),o&&l&&c&&t.jsxs(Jm.div,{className:"rounded-lg bg-gradient-to-r from-primary/20 to-primary/30 text-center "+(d?"p-2 mt-2":"p-4 mt-2"),initial:{scale:.8,opacity:0},animate:{scale:1,opacity:1},transition:{delay:.7,type:"spring"},children:[t.jsxs("div",{className:"flex items-center gap-2 "+(d?"justify-start mb-1":"justify-center mb-2"),children:[t.jsx(pt,{className:"text-primary "+(d?"h-4 w-4":"h-6 w-6")}),t.jsxs("div",{className:"font-bold "+(d?"text-sm":"text-xl"),children:["Nível ",l,"!"]})]}),t.jsx("div",{className:"opacity-80 "+(d?"text-xs mb-1":"text-sm mb-2"),children:"Seu personagem evoluiu e ficou mais forte!"}),t.jsxs("div",{className:"grid gap-1 "+(d?"grid-cols-4 text-xs":"grid-cols-2 gap-2 text-sm"),children:[t.jsx("div",{className:"bg-background/50 rounded "+(d?"p-1":"p-2"),children:"HP +10"}),t.jsx("div",{className:"bg-background/50 rounded "+(d?"p-1":"p-2"),children:"Mana +5"}),t.jsx("div",{className:"bg-background/50 rounded "+(d?"p-1":"p-2"),children:"Ataque +2"}),t.jsx("div",{className:"bg-background/50 rounded "+(d?"p-1":"p-2"),children:"Defesa +1"})]})]}),i.drops.length>0&&t.jsxs(Jm.div,{className:"bg-primary/10 rounded-lg "+(d?"mt-2 p-2":"mt-4 p-4"),initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.9},children:[t.jsxs("h4",{className:"font-semibold flex items-center gap-2 "+(d?"mb-1 text-xs":"mb-3"),children:[t.jsx(jt,{className:d?"h-3 w-3":"h-5 w-5"}),"Itens Obtidos"]}),t.jsx("div",{className:""+(d?"grid grid-cols-2 gap-1":"space-y-2"),children:i.drops.map(((e,a)=>t.jsxs(Jm.div,{className:"flex items-center gap-2 bg-background/50 rounded "+(d?"p-1 text-xs":"p-2"),initial:{x:-20,opacity:0},animate:{x:0,opacity:1},transition:{delay:1+.1*a},children:[t.jsx("span",{className:d?"text-xs":"text-xl",children:"🎁"}),t.jsx("span",{className:"flex-1 truncate",children:e.name}),t.jsxs("span",{className:"font-mono flex-shrink-0",children:["x",e.quantity]})]},a)))})]})]})}),t.jsx(kh,{className:"flex flex-col gap-1 "+(d?"mt-1":"mt-4"),children:t.jsxs("div",{className:"w-full "+(d?"grid grid-cols-3 gap-1":"flex flex-col gap-2"),children:[c&&t.jsxs(Wa,{onClick:()=>{n()},className:"bg-gradient-to-r from-purple-500 to-purple-600 hover:from-purple-600 hover:to-purple-700 text-white shadow-lg "+(d?"victory-modal-buttons text-xs":"w-full"),children:[t.jsx(Fe,{className:""+(d?"h-3 w-3":"h-4 w-4 mr-2")}),d?"Pts":"Distribuir Pontos de Atributo"]}),t.jsxs(Wa,{onClick:()=>{r()},variant:"outline",className:"items-center justify-center "+(d?"victory-modal-buttons text-xs":"flex-1"),children:[t.jsx(Qt,{className:""+(d?"h-3 w-3":"h-4 w-4 mr-2")}),d?"":"Voltar ao Hub"]}),t.jsxs(Wa,{onClick:()=>{s()},className:"bg-emerald-500 hover:bg-emerald-600 "+(d?"victory-modal-buttons text-xs":"flex-1"),children:[t.jsx(Kt,{className:""+(d?"h-3 w-3":"h-4 w-4 mr-2")}),"Continuar"]})]})})]})})})}function rg({isOpen:a,onClose:s,player:n,gameMessage:i=`${n.name} foi derrotado no Andar ${n.floor}...`,highestFloor:o=n.floor,isCharacterDeleted:l=!1,userId:c,onReturnToCharacterSelect:d,onViewCemetery:m}){const u=r(),[h,p]=e.useState(!1),[x,f]=e.useState(!1),g=zf();return t.jsx(_h,{open:a,onOpenChange:s,children:t.jsxs(Sh,{className:"overflow-hidden "+(g?"max-w-[95vw] max-h-[95vh] w-[95vw] p-3":"sm:max-w-md"),children:[t.jsx(Eh,{className:"text-center "+(g?"pb-2":""),children:t.jsxs(Ah,{className:"flex items-center justify-center gap-2 "+(g?"text-lg":"text-2xl"),children:[t.jsx($e,{className:"text-red-500 "+(g?"h-5 w-5":"h-8 w-8")}),l?"Permadeath - Personagem Perdido":"Fim de Jogo"]})}),t.jsxs("div",{className:""+(g?"space-y-2 max-h-[calc(95vh-140px)] overflow-y-auto":"space-y-4"),children:[t.jsxs("div",{className:"text-center",children:[t.jsx("p",{className:"mb-2 "+(g?"text-sm":"text-lg"),children:i}),t.jsxs("div",{className:"flex items-center justify-center gap-2 mb-2 "+(g?"mb-2":"mb-4"),children:[t.jsx(ae,{className:"text-yellow-500 "+(g?"h-4 w-4":"h-6 w-6")}),t.jsxs("span",{className:"font-bold "+(g?"text-lg":"text-2xl"),children:["Andar ",n.floor-1]})]}),t.jsxs("p",{className:"text-muted-foreground "+(g?"text-xs":"text-sm"),children:["Seu recorde atual: Andar ",o]})]}),t.jsxs("div",{className:g?"grid grid-cols-2 gap-2":"space-y-3",children:[t.jsxs("div",{className:"bg-muted rounded-lg "+(g?"p-2":"p-4"),children:[t.jsx("h3",{className:"font-medium mb-2 "+(g?"text-sm":""),children:"Estatísticas Finais"}),t.jsxs("div",{className:"grid grid-cols-2 gap-1 "+(g?"text-xs":"gap-2 text-sm"),children:[t.jsx("div",{children:"Personagem:"}),t.jsx("div",{className:"font-medium truncate",children:n.name}),t.jsx("div",{children:"Andares:"}),t.jsx("div",{className:"font-medium",children:n.floor-1}),t.jsx("div",{children:"HP final:"}),t.jsxs("div",{className:"font-medium",children:[n.hp,"/",n.max_hp]}),t.jsx("div",{children:"Nível:"}),t.jsx("div",{className:"font-medium",children:n.level}),t.jsx("div",{children:"Gold:"}),t.jsx("div",{className:"font-medium",children:ah(n.gold)}),t.jsx("div",{children:"XP total:"}),t.jsx("div",{className:"font-medium",children:ah(n.xp)})]})]}),t.jsxs("div",{className:"bg-red-500/10 border border-red-500/20 rounded-lg "+(g?"p-2":"p-4"),children:[t.jsxs("div",{className:"flex items-center gap-2 mb-2 "+(g?"mb-1":""),children:[t.jsx(Mt,{className:"text-red-400 "+(g?"h-3 w-3":"h-5 w-5")}),t.jsx("span",{className:"font-medium text-red-400 "+(g?"text-xs":"text-sm"),children:"Aviso de Permadeath"})]}),t.jsx("p",{className:"text-red-400 mb-2 "+(g?"text-xs mb-1":"text-sm"),children:l?"Este personagem foi permanentemente deletado.":"Este personagem será permanentemente deletado ao continuar."}),t.jsx("p",{className:"text-red-300 text-xs",children:"Suas estatísticas serão salvas no ranking para comparação."})]})]}),l&&t.jsx("div",{className:"bg-blue-500/10 border border-blue-500/20 rounded-lg "+(g?"p-2":"p-3"),children:t.jsxs("div",{className:"text-blue-400 text-xs",children:["💀 ",t.jsx("strong",{children:"Estatísticas da Jornada:"}),t.jsx("br",{}),t.jsxs("div",{className:"mt-1 "+(g?"grid grid-cols-2 gap-1":""),children:[t.jsxs("div",{children:["• Nível alcançado: ",n.level]}),t.jsxs("div",{children:["• Andar mais alto: ",n.floor]}),t.jsxs("div",{children:["• Gold acumulado: ",n.gold]}),t.jsxs("div",{children:["• XP total: ",n.xp]})]})]})})]}),t.jsxs("div",{className:"flex gap-2 "+(g?"flex-row pt-2":"flex-col pt-4"),children:[l&&t.jsxs(Wa,{variant:"outline",onClick:()=>{m?m():u({to:"/game/play/hub/cemetery",search:{character:n.id}})},className:"border-blue-500/30 text-blue-400 hover:bg-blue-500/10 "+(g?"flex-1 text-xs h-8":"w-full"),disabled:h||x,children:[t.jsx(xt,{className:"mr-1 "+(g?"h-3 w-3":"h-4 w-4 mr-2")}),g?"Cemitério":"Ver Cemitério"]}),t.jsx(Wa,{variant:"destructive",onClick:async()=>{if(c&&n.id)try{p(!0),f(!0);const e=await Qu.saveScore({player_name:n.name,floor:n.floor-1,user_id:c,character_level:n.level,character_gold:n.gold,character_alive:!1});if(e.error)throw new Error(e.error);if(!l){const{error:e}=await Nh.deleteCharacter(n.id);if(e)throw new Error(e)}_.success("Fim de jogo",{description:"Pontuação salva e personagem deletado permanentemente."}),d()}catch(e){_.error("Erro ao finalizar jogo",{description:e instanceof Error?e.message:"Erro desconhecido"})}finally{p(!1),f(!1)}},disabled:h||x,className:""+(g?"flex-1 text-xs h-8":"w-full"),children:h||x?t.jsxs("span",{className:"flex items-center gap-1",children:[t.jsx("div",{className:"animate-spin rounded-full border-t-2 border-b-2 border-white "+(g?"h-3 w-3":"h-4 w-4")}),"Finalizando..."]}):t.jsxs("span",{className:"flex items-center gap-1",children:[t.jsx($e,{className:""+(g?"h-3 w-3":"h-4 w-4")}),g?"Aceitar Derrota":l?"Criar Novo Personagem":"Aceitar Derrota e Salvar"]})}),t.jsxs(Wa,{variant:"outline",onClick:()=>{u({to:"/game/ranking"})},className:""+(g?"flex-1 text-xs h-8":"w-full"),disabled:h||x,children:[t.jsx(ae,{className:"mr-1 "+(g?"h-3 w-3":"h-4 w-4 mr-2")}),g?"Ranking":"Ver Ranking"]})]})]})})}function ng({currentFloor:e,playerLevel:a}){const s=e.floorNumber||1,r=Math.ceil(s/20),n=(s-1)%20+1,i=5===s||s%10==0,o=s%5==0&&s>5&&!i,l=r>1;return t.jsx("div",{className:"mb-4",children:t.jsxs("div",{className:"text-center",children:[t.jsxs("div",{className:"flex items-center justify-center gap-2 mb-2 flex-wrap",children:[t.jsxs("h2",{className:"text-2xl font-bold text-primary",children:[(e=>{switch(e){case"boss":return"👑";case"elite":return"⭐";case"event":return"❓";default:return"🗺️"}})(e.type)," ",e.description]}),t.jsxs(Nu,{variant:"outline",className:"bg-background/50",children:[t.jsx(Zt,{className:"h-3 w-3 mr-1"}),"Andar ",s]}),l&&t.jsxs(Nu,{className:"bg-purple-500/20 text-purple-400 border-purple-500/30",children:[t.jsx(Je,{className:"h-3 w-3 mr-1"}),"Tier ",r]}),i&&t.jsxs(Nu,{className:"bg-red-500/20 text-red-400 border-red-500/30 animate-pulse",children:[t.jsx(bt,{className:"h-3 w-3 mr-1"}),"BOSS"]}),o&&t.jsxs(Nu,{className:"bg-orange-500/20 text-orange-400 border-orange-500/30",children:[t.jsx(ft,{className:"h-3 w-3 mr-1"}),"ELITE"]}),e.isCheckpoint&&t.jsxs(Nu,{className:"bg-primary/20 text-primary",children:[t.jsx(ft,{className:"h-3 w-3 mr-1"}),"Checkpoint"]})]}),l&&t.jsx("div",{className:"text-xs text-muted-foreground mb-2",children:t.jsxs("span",{className:"bg-purple-500/10 px-2 py-1 rounded border border-purple-500/20",children:["Sistema Cíclico: Posição ",n,"/20 no Ciclo ",r,i&&" • Monstros Escalados"]})}),a<e.minLevel&&t.jsxs("div",{className:"text-yellow-500 text-sm",children:["⚠️ Nível recomendado: ",e.minLevel]}),l&&t.jsx("div",{className:"text-sm text-purple-400 mt-2",children:"Os monstros foram fortalecidos pelo poder ancestral da torre!"})]})})}var ig="Popover",[og,lg]=Ne(ig,[aa]),cg=aa(),[dg,mg]=og(ig),ug=a=>{const{__scopePopover:s,children:r,open:n,defaultOpen:i,onOpenChange:o,modal:l=!1}=a,c=cg(s),d=e.useRef(null),[m,u]=e.useState(!1),[h,p]=ua({prop:n,defaultProp:i??!1,onChange:o,caller:ig});return t.jsx(ha,{...c,children:t.jsx(dg,{scope:s,contentId:pa(),triggerRef:d,open:h,onOpenChange:p,onOpenToggle:e.useCallback((()=>p((e=>!e))),[p]),hasCustomAnchor:m,onCustomAnchorAdd:e.useCallback((()=>u(!0)),[]),onCustomAnchorRemove:e.useCallback((()=>u(!1)),[]),modal:l,children:r})})};ug.displayName=ig;var hg="PopoverAnchor";e.forwardRef(((a,s)=>{const{__scopePopover:r,...n}=a,i=mg(hg,r),o=cg(r),{onCustomAnchorAdd:l,onCustomAnchorRemove:c}=i;return e.useEffect((()=>(l(),()=>c())),[l,c]),t.jsx(xa,{...o,...n,ref:s})})).displayName=hg;var pg="PopoverTrigger",xg=e.forwardRef(((e,a)=>{const{__scopePopover:s,...r}=e,n=mg(pg,s),i=cg(s),o=sa(a,n.triggerRef),l=t.jsx(re.button,{type:"button","aria-haspopup":"dialog","aria-expanded":n.open,"aria-controls":n.contentId,"data-state":Eg(n.open),...r,ref:o,onClick:oa(e.onClick,n.onOpenToggle)});return n.hasCustomAnchor?l:t.jsx(xa,{asChild:!0,...i,children:l})}));xg.displayName=pg;var fg="PopoverPortal",[gg,bg]=og(fg,{forceMount:void 0}),vg=e=>{const{__scopePopover:a,forceMount:s,children:r,container:n}=e,i=mg(fg,a);return t.jsx(gg,{scope:a,forceMount:s,children:t.jsx(ea,{present:s||i.open,children:t.jsx(ta,{asChild:!0,container:n,children:r})})})};vg.displayName=fg;var yg="PopoverContent",jg=e.forwardRef(((e,a)=>{const s=bg(yg,e.__scopePopover),{forceMount:r=s.forceMount,...n}=e,i=mg(yg,e.__scopePopover);return t.jsx(ea,{present:r||i.open,children:i.modal?t.jsx(_g,{...n,ref:a}):t.jsx(wg,{...n,ref:a})})}));jg.displayName=yg;var Ng=ia("PopoverContent.RemoveScroll"),_g=e.forwardRef(((a,s)=>{const r=mg(yg,a.__scopePopover),n=e.useRef(null),i=sa(s,n),o=e.useRef(!1);return e.useEffect((()=>{const e=n.current;if(e)return ra(e)}),[]),t.jsx(na,{as:Ng,allowPinchZoom:!0,children:t.jsx(Cg,{...a,ref:i,trapFocus:r.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:oa(a.onCloseAutoFocus,(e=>{e.preventDefault(),o.current||r.triggerRef.current?.focus()})),onPointerDownOutside:oa(a.onPointerDownOutside,(e=>{const t=e.detail.originalEvent,a=0===t.button&&!0===t.ctrlKey,s=2===t.button||a;o.current=s}),{checkForDefaultPrevented:!1}),onFocusOutside:oa(a.onFocusOutside,(e=>e.preventDefault()),{checkForDefaultPrevented:!1})})})})),wg=e.forwardRef(((a,s)=>{const r=mg(yg,a.__scopePopover),n=e.useRef(!1),i=e.useRef(!1);return t.jsx(Cg,{...a,ref:s,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:e=>{a.onCloseAutoFocus?.(e),e.defaultPrevented||(n.current||r.triggerRef.current?.focus(),e.preventDefault()),n.current=!1,i.current=!1},onInteractOutside:e=>{a.onInteractOutside?.(e),e.defaultPrevented||(n.current=!0,"pointerdown"===e.detail.originalEvent.type&&(i.current=!0));const t=e.target,s=r.triggerRef.current?.contains(t);s&&e.preventDefault(),"focusin"===e.detail.originalEvent.type&&i.current&&e.preventDefault()}})})),Cg=e.forwardRef(((e,a)=>{const{__scopePopover:s,trapFocus:r,onOpenAutoFocus:n,onCloseAutoFocus:i,disableOutsidePointerEvents:o,onEscapeKeyDown:l,onPointerDownOutside:c,onFocusOutside:d,onInteractOutside:m,...u}=e,h=mg(yg,s),p=cg(s);return la(),t.jsx(ca,{asChild:!0,loop:!0,trapped:r,onMountAutoFocus:n,onUnmountAutoFocus:i,children:t.jsx(da,{asChild:!0,disableOutsidePointerEvents:o,onInteractOutside:m,onEscapeKeyDown:l,onPointerDownOutside:c,onFocusOutside:d,onDismiss:()=>h.onOpenChange(!1),children:t.jsx(ma,{"data-state":Eg(h.open),role:"dialog",id:h.contentId,...p,...u,ref:a,style:{...u.style,"--radix-popover-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-popover-content-available-width":"var(--radix-popper-available-width)","--radix-popover-content-available-height":"var(--radix-popper-available-height)","--radix-popover-trigger-width":"var(--radix-popper-anchor-width)","--radix-popover-trigger-height":"var(--radix-popper-anchor-height)"}})})})})),Sg="PopoverClose";e.forwardRef(((e,a)=>{const{__scopePopover:s,...r}=e,n=mg(Sg,s);return t.jsx(re.button,{type:"button",...r,ref:a,onClick:oa(e.onClick,(()=>n.onOpenChange(!1)))})})).displayName=Sg;function Eg(e){return e?"open":"closed"}e.forwardRef(((e,a)=>{const{__scopePopover:s,...r}=e,n=cg(s);return t.jsx(fa,{...n,...r,ref:a})})).displayName="PopoverArrow";var kg=vg,Ag=jg;const Pg=ug,Mg=xg,Tg=e.forwardRef((({className:e,align:a="center",sideOffset:s=4,...r},n)=>t.jsx(kg,{children:t.jsx(Ag,{ref:n,align:a,sideOffset:s,className:Ga("z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-popover-content-transform-origin]",e),...r})})));Tg.displayName=Ag.displayName;var qg="Checkbox",[Dg,Lg]=Ne(qg),[$g,Rg]=Dg(qg);function Ig(a){const{__scopeCheckbox:s,checked:r,children:n,defaultChecked:i,disabled:o,form:l,name:c,onCheckedChange:d,required:m,value:u="on",internal_do_not_use_render:h}=a,[p,x]=ua({prop:r,defaultProp:i??!1,onChange:d,caller:qg}),[f,g]=e.useState(null),[b,v]=e.useState(null),y=e.useRef(!1),j=!f||(!!l||!!f.closest("form")),N={checked:p,disabled:o,setChecked:x,control:f,setControl:g,name:c,form:l,value:u,hasConsumerStoppedPropagationRef:y,required:m,defaultChecked:!Xg(i)&&i,isFormControl:j,bubbleInput:b,setBubbleInput:v};return t.jsx($g,{scope:s,...N,children:Gg(h)?h(N):n})}var Fg="CheckboxTrigger",Vg=e.forwardRef((({__scopeCheckbox:a,onKeyDown:s,onClick:r,...n},i)=>{const{control:o,value:l,disabled:c,checked:d,required:m,setControl:u,setChecked:h,hasConsumerStoppedPropagationRef:p,isFormControl:x,bubbleInput:f}=Rg(Fg,a),g=sa(i,u),b=e.useRef(d);return e.useEffect((()=>{const e=o?.form;if(e){const t=()=>h(b.current);return e.addEventListener("reset",t),()=>e.removeEventListener("reset",t)}}),[o,h]),t.jsx(re.button,{type:"button",role:"checkbox","aria-checked":Xg(d)?"mixed":d,"aria-required":m,"data-state":Wg(d),"data-disabled":c?"":void 0,disabled:c,value:l,...n,ref:g,onKeyDown:oa(s,(e=>{"Enter"===e.key&&e.preventDefault()})),onClick:oa(r,(e=>{h((e=>!!Xg(e)||!e)),f&&x&&(p.current=e.isPropagationStopped(),p.current||e.stopPropagation())}))})}));Vg.displayName=Fg;var Og=e.forwardRef(((e,a)=>{const{__scopeCheckbox:s,name:r,checked:n,defaultChecked:i,required:o,disabled:l,value:c,onCheckedChange:d,form:m,...u}=e;return t.jsx(Ig,{__scopeCheckbox:s,checked:n,defaultChecked:i,disabled:l,required:o,onCheckedChange:d,name:r,form:m,value:c,internal_do_not_use_render:({isFormControl:e})=>t.jsxs(t.Fragment,{children:[t.jsx(Vg,{...u,ref:a,__scopeCheckbox:s}),e&&t.jsx(Hg,{__scopeCheckbox:s})]})})}));Og.displayName=qg;var Bg="CheckboxIndicator",Ug=e.forwardRef(((e,a)=>{const{__scopeCheckbox:s,forceMount:r,...n}=e,i=Rg(Bg,s);return t.jsx(ea,{present:r||Xg(i.checked)||!0===i.checked,children:t.jsx(re.span,{"data-state":Wg(i.checked),"data-disabled":i.disabled?"":void 0,...n,ref:a,style:{pointerEvents:"none",...e.style}})})}));Ug.displayName=Bg;var zg="CheckboxBubbleInput",Hg=e.forwardRef((({__scopeCheckbox:a,...s},r)=>{const{control:n,hasConsumerStoppedPropagationRef:i,checked:o,defaultChecked:l,required:c,disabled:d,name:m,value:u,form:h,bubbleInput:p,setBubbleInput:x}=Rg(zg,a),f=sa(r,x),g=ga(o),b=ba(n);e.useEffect((()=>{const e=p;if(!e)return;const t=window.HTMLInputElement.prototype,a=Object.getOwnPropertyDescriptor(t,"checked").set,s=!i.current;if(g!==o&&a){const t=new Event("click",{bubbles:s});e.indeterminate=Xg(o),a.call(e,!Xg(o)&&o),e.dispatchEvent(t)}}),[p,g,o,i]);const v=e.useRef(!Xg(o)&&o);return t.jsx(re.input,{type:"checkbox","aria-hidden":!0,defaultChecked:l??v.current,required:c,disabled:d,name:m,value:u,form:h,...s,tabIndex:-1,ref:f,style:{...s.style,...b,position:"absolute",pointerEvents:"none",opacity:0,margin:0,transform:"translateX(-100%)"}})}));function Gg(e){return"function"==typeof e}function Xg(e){return"indeterminate"===e}function Wg(e){return Xg(e)?"indeterminate":e?"checked":"unchecked"}Hg.displayName=zg;const Yg=e.forwardRef((({className:e,...a},s)=>t.jsx(Og,{ref:s,className:Ga("peer h-4 w-4 shrink-0 rounded-sm border border-primary shadow focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground",e),...a,children:t.jsx(Ug,{className:Ga("flex items-center justify-center text-current"),children:t.jsx(ge,{className:"h-4 w-4"})})})));function Kg({gameLog:a}){const s=e.useRef(null),[r,n]=e.useState({system:!0,battle:!0,lore:!0,skill_xp:!0,level_up:!0,equipment:!0,enemy_action:!0,player_action:!0,damage:!0,healing:!0});e.useEffect((()=>{if(s.current){const e=s.current.querySelector("[data-radix-scroll-area-viewport]");e&&(e.scrollTop=e.scrollHeight)}}),[a]);const i=e=>{n({system:e,battle:e,lore:e,skill_xp:e,level_up:e,equipment:e,enemy_action:e,player_action:e,damage:e,healing:e})},o=a.filter((e=>r[e.type])),l=e=>{switch(e){case"system":case"player_action":return"text-blue-400";case"battle":default:return"text-foreground";case"lore":return"text-purple-400 italic";case"skill_xp":return"text-green-400";case"level_up":return"text-yellow-400 font-semibold";case"equipment":return"text-orange-400";case"enemy_action":return"text-red-400";case"damage":return"text-red-300";case"healing":return"text-green-300"}},c=e=>{switch(e){case"enemy_action":return t.jsx(qe,{className:"h-3 w-3 text-red-400 mr-2"});case"player_action":return t.jsx(De,{className:"h-3 w-3 text-blue-400 mr-2"});case"damage":return t.jsx(Le,{className:"h-3 w-3 text-red-300 mr-2"});case"healing":return t.jsx(pt,{className:"h-3 w-3 text-green-300 mr-2"});case"level_up":return t.jsx("span",{className:"mr-2",children:"🌟"});case"equipment":return t.jsx("span",{className:"mr-2",children:"⚔️"});case"skill_xp":return t.jsx("span",{className:"mr-2",children:"📈"});case"lore":return t.jsx("span",{className:"mr-2",children:"📜"});default:return null}},d=e=>{switch(e){case"system":return"Sistema";case"battle":return"Batalha";case"lore":return"História";case"skill_xp":return"XP de Habilidade";case"level_up":return"Level Up";case"equipment":return"Equipamentos";case"enemy_action":return"Ações do Inimigo";case"player_action":return"Ações do Jogador";case"damage":return"Dano";case"healing":return"Cura";default:return e}},m=e=>{let t=e.text;if(t.includes("causou")&&t.includes("de dano")){const e=t.match(/(\d+)\s+de dano/);if(e){const a=e[1];t=t.replace(`${a} de dano`,`**${a}** de dano`)}}if(t.includes("recuperou")&&t.includes("HP")){const e=t.match(/(\d+)\s+HP/);if(e){const a=e[1];t=t.replace(`${a} HP`,`**${a}** HP`)}}return t};return t.jsxs(pu,{className:"mt-6",children:[t.jsxs(xu,{className:"pb-2 flex flex-row items-center justify-between",children:[t.jsxs(fu,{className:"text-lg flex items-center gap-2",children:[t.jsx(Ut,{className:"h-5 w-5"}),"Log de Batalha"]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsxs("span",{className:"text-sm text-muted-foreground",children:[o.length,"/",a.length]}),t.jsxs(Pg,{children:[t.jsx(Mg,{asChild:!0,children:t.jsx(Wa,{variant:"outline",size:"sm",className:"h-8 w-8 p-0",children:t.jsx(wt,{className:"h-4 w-4"})})}),t.jsx(Tg,{className:"w-80",align:"end",children:t.jsxs("div",{className:"space-y-3",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("h4",{className:"font-medium",children:"Filtros do Log"}),t.jsxs("div",{className:"flex gap-1",children:[t.jsxs(Wa,{variant:"ghost",size:"sm",onClick:()=>i(!0),className:"h-6 px-2 text-xs",children:[t.jsx(xt,{className:"h-3 w-3 mr-1"}),"Todos"]}),t.jsxs(Wa,{variant:"ghost",size:"sm",onClick:()=>i(!1),className:"h-6 px-2 text-xs",children:[t.jsx(va,{className:"h-3 w-3 mr-1"}),"Nenhum"]})]})]}),t.jsx("div",{className:"grid grid-cols-2 gap-2",children:Object.entries(r).map((([e,a])=>t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(Yg,{id:e,checked:a,onCheckedChange:t=>((e,t)=>{n((a=>({...a,[e]:t})))})(e,!!t)}),t.jsx("label",{htmlFor:e,className:`text-xs font-medium cursor-pointer ${l(e)}`,children:d(e)})]},e)))})]})})]})]})]}),t.jsx(bu,{children:t.jsx(ap,{ref:s,className:"h-56 rounded border p-3 bg-card/50 backdrop-blur-sm",children:0===o.length?t.jsx("div",{className:"flex items-center justify-center h-full text-muted-foreground",children:t.jsxs("div",{className:"text-center",children:[t.jsx(Ut,{className:"h-8 w-8 mx-auto mb-2 opacity-50"}),t.jsx("p",{className:"text-sm",children:0===a.length?"Nenhum evento ainda":"Nenhum evento corresponde aos filtros"})]})}):t.jsx("div",{className:"space-y-2",children:o.map(((e,a)=>t.jsxs("div",{className:`flex items-start text-sm leading-relaxed ${l(e.type)} transition-all duration-200 hover:bg-muted/20 rounded p-2 -m-2`,children:[c(e.type),t.jsx("span",{className:"flex-1",dangerouslySetInnerHTML:{__html:m(e).replace(/\*\*(.+?)\*\*/g,'<strong class="text-yellow-300">$1</strong>')}}),t.jsx("span",{className:"text-xs text-muted-foreground/60 ml-2 flex-shrink-0",children:(new Date).toLocaleTimeString("pt-BR",{hour:"2-digit",minute:"2-digit",second:"2-digit"})})]},`${a}-${e.text.substring(0,20)}`)))})})})]})}Yg.displayName=Og.displayName;const Jg=({isVisible:a,isSuccess:s,playerName:r,enemyName:n,onComplete:i})=>{const[o,l]=e.useState(!1),[c,d]=e.useState(0);if(e.useEffect((()=>(l(!0),()=>l(!1))),[]),e.useEffect((()=>{if(!a)return;const e=setInterval((()=>{d((e=>{const t=s?2.5:3.3;return Math.min(e+t,100)}))}),50),t=setTimeout((()=>{i()}),s?3e3:2500);return()=>{clearInterval(e),clearTimeout(t)}}),[a,s,r,n,i]),!o||!a)return null;const m=s?{emoji:"🏃‍♂️",title:"Fuga Bem-Sucedida!",subtitle:"Redirecionando para o hub...",description:n?`${r} conseguiu fugir de ${n}!`:`${r} conseguiu escapar!`,bgColor:"bg-gradient-to-r from-green-500/20 via-emerald-500/20 to-teal-500/20",borderColor:"border-green-500/30",textColor:"text-green-400",accentColor:"border-green-400"}:{emoji:"⚔️",title:"Fuga Falhou!",subtitle:"Prepare-se para o contra-ataque...",description:n?`${n} impediu a fuga de ${r}!`:`O inimigo impediu a fuga de ${r}!`,bgColor:"bg-gradient-to-r from-red-500/20 via-orange-500/20 to-yellow-500/20",borderColor:"border-red-500/30",textColor:"text-red-400",accentColor:"border-red-400"};return t.jsxs("div",{className:"fixed inset-0 backdrop-blur-md z-50 flex items-center justify-center",children:[t.jsx("div",{className:"absolute inset-0 bg-black/40"}),t.jsxs("div",{className:`relative ${m.bgColor} border ${m.borderColor} rounded-2xl p-8 shadow-2xl max-w-md mx-4 transform transition-all duration-500 animate-in zoom-in-95 fade-in-0`,children:[t.jsxs("div",{className:"text-center space-y-4",children:[t.jsx("div",{className:`text-6xl ${s?"animate-bounce":"animate-pulse"} transition-all duration-300`,children:m.emoji}),t.jsx("div",{className:`font-bold text-2xl ${m.textColor}`,children:m.title}),t.jsx("div",{className:"text-muted-foreground text-base",children:m.subtitle}),t.jsx("div",{className:"w-full bg-background/30 rounded-full h-2 overflow-hidden",children:t.jsx("div",{className:"h-full transition-all duration-150 ease-out "+(s?"bg-green-400":"bg-red-400"),style:{width:`${c}%`}})}),t.jsx("div",{className:"text-sm text-muted-foreground/90 leading-relaxed px-2",children:m.description}),t.jsxs("div",{className:"flex items-center justify-center gap-3 pt-2",children:[t.jsx("div",{className:`animate-spin rounded-full h-5 w-5 border-2 border-t-transparent ${m.accentColor}`}),t.jsx("span",{className:`text-sm font-medium ${m.textColor}`,children:s?"Redirecionando...":"Retornando..."})]})]}),t.jsx("div",{className:`absolute inset-0 rounded-2xl border-2 ${m.borderColor} animate-pulse pointer-events-none`})]})]})};class Qg{static async initializeBattle(e,t){try{const r=e;if(!r)throw new Error("Nenhum personagem deve ser fornecido para inicializar batalha");t?.({step:"character",progress:25,message:"Carregando personagem..."});const n=await Nh.getCharacterForGame(r.id,!0,!0);if(!n.success||!n.data)throw new Error(n.error||"Falha ao carregar personagem");const i=n.data;if(!i||!i.id)throw new Error("Dados do personagem inválidos ou incompletos");if(i.floor<=0){i.floor=1;try{await Nh.updateCharacterFloor(i.id,1)}catch(a){}}t?.({step:"floor",progress:50,message:`Carregando andar ${i.floor}...`});const o=await Mf.getFloorData(i.floor);if(!o)throw new Error(`Falha ao carregar andar ${i.floor}`);t?.({step:"event",progress:70,message:"Verificando eventos..."});const l=await Mf.checkForSpecialEvent(i.floor);let c=null;t?.({step:"enemy",progress:85,message:"Gerando inimigo..."});const d=await yf.getEnemyForFloor(i.floor);if(d.success&&d.data)c=d.data;else try{c=await this.generateFallbackEnemy(i.floor)}catch(s){throw new Error(`Falha crítica na geração de inimigo: ${s}`)}if(!c||!c.id)throw new Error("Falha crítica: Inimigo não pôde ser gerado");t?.({step:"complete",progress:100,message:"Batalha pronta!"});const m=!l||i.floor%5==0,h={mode:m?"battle":"special_event",player:{...i,isPlayerTurn:!0,isDefending:!1,potionUsedThisTurn:!1,defenseCooldown:Math.max(0,(i.defenseCooldown||0)-1)},currentFloor:o,currentEnemy:c,currentSpecialEvent:m?null:l,isPlayerTurn:!0,gameMessage:m?`Andar ${o.floorNumber}: ${c.name} apareceu!`:`Evento especial: ${l?.name}! Mas ${c.name} também está presente!`,highestFloor:Math.max(i.floor,o.floorNumber),selectedSpell:null,battleRewards:null,fleeSuccessful:!1,characterDeleted:!1},{SpellService:p}=await u((async()=>{const{SpellService:e}=await Promise.resolve().then((()=>vh));return{SpellService:e}}),void 0);return{success:!0,gameState:p.resetSpellCooldowns(h)}}catch(r){return{success:!1,error:r instanceof Error?r.message:"Erro desconhecido"}}}static generateFallbackEnemy(e){const t=Math.max(1,e),a=Math.max(1,Math.floor(t/5)+1),s=Math.max(1,Math.floor(t/20)+1),r=t%10==0,n=["Slime","Goblin","Orc","Skeleton","Wolf","Spider","Troll","Dragon"],i=`${r?"Boss ":""}${n[Math.floor(t/2)%n.length]}${s>1?` T${s}`:""}`,o=r?80:50,l=r?15:10,c=r?8:5,d=Math.floor(o+15*a+25*s),m=Math.floor(l+3*a+5*s),u=Math.floor(c+2*a+3*s),h=Math.floor(10+1*a+2*s),p=Math.floor((5+2*a+2*s)*(r?2.5:1)),x=Math.floor((3+1*a+1*s)*(r?2.5:1));return{id:`fallback_${t}_${Date.now()}`,name:i,level:a,hp:d,maxHp:d,attack:m,defense:u,speed:h,image:r?"👑":"👾",behavior:"balanced",mana:Math.floor(20+5*a),reward_xp:p,reward_gold:x,possible_drops:[],active_effects:{buffs:[],debuffs:[],dots:[],hots:[],attribute_modifications:[]},tier:s,base_tier:1,cycle_position:(t-1)%20+1,is_boss:r,strength:Math.floor(10+2*a),dexterity:Math.floor(10+1*a),intelligence:Math.floor(8+1*a),wisdom:Math.floor(8+1*a),vitality:Math.floor(12+2*a),luck:Math.floor(5+a),critical_chance:.05+.005*a,critical_damage:1.5+.05*a,critical_resistance:.1,physical_resistance:0,magical_resistance:0,debuff_resistance:0,physical_vulnerability:1,magical_vulnerability:1,primary_trait:r?"boss":"common",secondary_trait:"basic",special_abilities:r?["Boss Fury"]:[]}}static async healthCheck(){const e=[],t={};try{try{await yf.getEnemyForFloor(1),t.monster=!0}catch{t.monster=!1,e.push("MonsterService indisponível")}try{await Mf.getFloorData(1),t.floor=!0}catch{t.floor=!1,e.push("FloorService indisponível")}try{await Nh.getUserCharacters("test-health-check"),t.character=!0}catch{t.character=!1,e.push("CharacterService indisponível")}return{healthy:0===e.length,issues:e,services:t}}catch{return{healthy:!1,issues:["Falha crítica no health check"],services:{}}}}}const Zg=e=>{switch(e.effect_type){case"damage":return t.jsx(Yt,{className:"w-3 h-3"});case"heal":return t.jsx(Be,{className:"w-3 h-3"});case"buff":return t.jsx(pt,{className:"w-3 h-3"});case"debuff":return t.jsx(Jt,{className:"w-3 h-3"});default:return t.jsx(Le,{className:"w-3 h-3"})}},eb=e=>{switch(e.effect_type){case"damage":return"bg-red-500/20 hover:bg-red-500/30 border-red-500/50";case"heal":return"bg-green-500/20 hover:bg-green-500/30 border-green-500/50";case"buff":return"bg-blue-500/20 hover:bg-blue-500/30 border-blue-500/50";case"debuff":return"bg-purple-500/20 hover:bg-purple-500/30 border-purple-500/50";default:return"bg-slate-500/20 hover:bg-slate-500/30 border-slate-500/50"}};function tb({handleAction:e,isPlayerTurn:a,loading:s,player:r,potionSlots:n,loadingPotionSlots:i}){if(!r)return t.jsxs("div",{className:"quick-action-panel flex flex-col gap-1 p-2 bg-slate-900/40 rounded-lg border border-slate-700/50 w-16 shadow-lg",children:[t.jsx("div",{className:"w-12 h-12 bg-muted/20 rounded-lg animate-pulse"}),t.jsx("div",{className:"w-12 h-12 bg-muted/20 rounded-lg animate-pulse"}),t.jsx("div",{className:"w-12 h-12 bg-muted/20 rounded-lg animate-pulse"})]});const o=r.spells?.slice(0,3)||[],l=!a||s.performAction;return t.jsxs("div",{className:"quick-action-panel flex flex-col gap-1 p-2 bg-slate-900/40 rounded-lg border border-slate-700/50 w-16 shadow-lg",children:[t.jsxs("div",{className:"flex flex-col gap-1",children:[t.jsxs("div",{className:"relative",children:[t.jsx(Wa,{variant:"outline",size:"sm",onClick:()=>e("attack"),disabled:l,className:"quick-action-button w-12 h-12 p-0 bg-red-500/20 hover:bg-red-500/30 border-red-500/50 text-red-400 transition-all duration-150 cursor-pointer",title:"Atacar (A)",children:t.jsx(qe,{className:"w-4 h-4"})}),t.jsx("span",{className:"absolute -top-1 -left-1 bg-slate-800 text-white text-xs rounded-full w-4 h-4 flex items-center justify-center border border-slate-600",children:"A"})]}),t.jsxs("div",{className:"relative",children:[t.jsxs(Wa,{variant:"outline",size:"sm",onClick:()=>e("defend"),disabled:l||(r?.defenseCooldown||0)>0,className:"quick-action-button w-12 h-12 p-0 bg-blue-500/20 hover:bg-blue-500/30 border-blue-500/50 text-blue-400 transition-all duration-150 relative cursor-pointer "+((r?.defenseCooldown||0)>0?"opacity-50":""),title:"Defender (S)"+((r?.defenseCooldown||0)>0?` - Cooldown: ${r?.defenseCooldown}`:""),children:[t.jsx(De,{className:"w-4 h-4"}),(r?.defenseCooldown||0)>0&&t.jsx("span",{className:"absolute -top-1 -right-1 bg-blue-600 text-white text-xs rounded-full w-4 h-4 flex items-center justify-center",children:r?.defenseCooldown})]}),t.jsx("span",{className:"absolute -top-1 -left-1 bg-slate-800 text-white text-xs rounded-full w-4 h-4 flex items-center justify-center border border-slate-600",children:"S"})]}),t.jsxs("div",{className:"relative",children:[t.jsx(Wa,{variant:"outline",size:"sm",onClick:()=>e("flee"),disabled:l,className:"quick-action-button w-12 h-12 p-0 bg-yellow-500/20 hover:bg-yellow-500/30 border-yellow-500/50 text-yellow-400 transition-all duration-150 cursor-pointer",title:"Fugir (D)",children:t.jsx(Pe,{className:"w-4 h-4"})}),t.jsx("span",{className:"absolute -top-1 -left-1 bg-slate-800 text-white text-xs rounded-full w-4 h-4 flex items-center justify-center border border-slate-600",children:"D"})]})]}),t.jsx("div",{className:"h-px bg-slate-700/50 my-1"}),t.jsx("div",{className:"flex flex-col gap-1",children:o.map(((a,s)=>{const n=(r?.mana||0)>=a.mana_cost&&0===a.current_cooldown;return t.jsxs("div",{className:"relative",children:[t.jsxs(Wa,{variant:"outline",size:"sm",onClick:()=>e("spell",a.id),disabled:l||!n,className:`quick-action-button w-12 h-12 p-0 ${eb(a)} relative transition-all duration-150 cursor-pointer ${n?"":"opacity-50"}`,title:`${a.name} (${1+s}) - ${a.mana_cost} Mana${a.current_cooldown>0?` - Cooldown: ${a.current_cooldown}`:(r?.mana||0)<a.mana_cost?" - Mana insuficiente":""}`,children:[Zg(a),a.current_cooldown>0&&t.jsx("span",{className:"absolute -top-1 -right-1 bg-red-600 text-white text-xs rounded-full w-4 h-4 flex items-center justify-center",children:a.current_cooldown}),t.jsx("span",{className:"absolute -bottom-1 -right-1 text-white text-xs rounded-full w-4 h-4 flex items-center justify-center "+((r?.mana||0)>=a.mana_cost?"bg-blue-600":"bg-red-600"),children:a.mana_cost})]}),t.jsx("span",{className:"absolute -top-1 -left-1 bg-slate-800 text-white text-xs rounded-full w-4 h-4 flex items-center justify-center border border-slate-600",children:1+s})]},a.id)}))}),n.length>0&&t.jsx("div",{className:"h-px bg-slate-700/50 my-1"}),t.jsx("div",{className:"flex flex-col gap-1",children:i?[1,2,3].map((e=>t.jsx("div",{className:"w-12 h-12 bg-muted/20 rounded-lg animate-pulse"},e))):n.map((a=>{const s=!a.consumable_id,n=(e=>{switch(e){case 1:return"Q";case 2:return"W";case 3:return"E";default:return""}})(a.slot_position),i=a.available_quantity,o=!s&&0===i;return t.jsxs("div",{className:"relative",children:[t.jsxs(Wa,{variant:"outline",size:"sm",onClick:()=>e("consumable",a.consumable_id||void 0),disabled:l||r?.potionUsedThisTurn||s||o,className:"quick-action-button w-12 h-12 p-2 relative transition-all duration-150 cursor-pointer "+(s?"border-dashed border-muted-foreground/20 bg-transparent hover:bg-muted/10":o?"border-red-500/30 bg-red-500/5 opacity-50":r.potionUsedThisTurn?"border-orange-500/30 bg-orange-500/5 opacity-50":"border-green-500/30 bg-green-500/20 hover:bg-green-500/30 text-green-400"),title:s?`Slot ${n} - Vazio`:o?`${a.consumable_name} - Sem unidades`:`${a.consumable_name} (${n}) - ${a.effect_value} HP${r?.potionUsedThisTurn?" - Já usou poção neste turno":""}`,children:[s?t.jsx(Ke,{className:"w-4 h-4 text-muted-foreground/40"}):a.consumable_id?t.jsx(tf,{consumable:{id:a.consumable_id,name:a.consumable_name||"Poção",description:a.consumable_description||"",type:a.consumable_type||"potion",effect_value:a.effect_value||0,price:a.consumable_price||0,level_requirement:1,created_at:"",updated_at:""},size:"lg",className:"w-4 h-4",showFallback:!0}):null,(r?.potionUsedThisTurn||o)&&!s&&t.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-orange-500/30 rounded-lg",children:t.jsx("span",{className:"text-orange-400 text-xs font-bold",children:"✗"})})]}),!s&&t.jsx("span",{className:"absolute -bottom-1 -left-1 text-white text-xs rounded-full w-4 h-4 flex items-center justify-center border border-background "+(o?"bg-red-500/90":"bg-slate-800"),children:i}),t.jsx("span",{className:"absolute -top-1 -left-1 bg-slate-800 text-white text-xs rounded-full w-4 h-4 flex items-center justify-center border border-slate-600",children:n})]},`slot-${a.slot_position}`)}))})]})}const ab=({isOpen:a,onClose:s,character:r,onAttributesUpdated:n})=>{const[i,o]=e.useState({strength:0,dexterity:0,intelligence:0,wisdom:0,vitality:0,luck:0}),[l,c]=e.useState(!1),d=zf(),m=Object.values(i).reduce(((e,t)=>e+t),0),u=(r?.attribute_points||0)-m,h=()=>{o({strength:0,dexterity:0,intelligence:0,wisdom:0,vitality:0,luck:0})},p={strength:{label:"Força",icon:Fe,color:"text-red-400",bgColor:"bg-red-500/10",borderColor:"border-red-500/20",benefit:"+2 Ataque + 0.5% Dano Crítico"},dexterity:{label:"Destreza",icon:Le,color:"text-green-400",bgColor:"bg-green-500/10",borderColor:"border-green-500/20",benefit:"+1.5 Velocidade + 0.3% Crítico"},intelligence:{label:"Inteligência",icon:pt,color:"text-purple-400",bgColor:"bg-purple-500/10",borderColor:"border-purple-500/20",benefit:"+5 Mana + 10% Dano Mágico"},wisdom:{label:"Sabedoria",icon:xt,color:"text-blue-400",bgColor:"bg-blue-500/10",borderColor:"border-blue-500/20",benefit:"+1 Def + 5% Magia + 12% Cura"},vitality:{label:"Vitalidade",icon:Be,color:"text-pink-400",bgColor:"bg-pink-500/10",borderColor:"border-pink-500/20",benefit:"+8 HP + 1 Defesa"},luck:{label:"Sorte",icon:ft,color:"text-yellow-400",bgColor:"bg-yellow-500/10",borderColor:"border-yellow-500/20",benefit:"+0.5% Crítico + 1% Dano Crítico"}};return a&&r&&r.attribute_points&&0!==r.attribute_points?t.jsx(_h,{open:a,onOpenChange:s,children:t.jsxs(Sh,{className:"overflow-hidden "+(d?"max-w-[95vw] max-h-[95vh] w-[95vw] p-3":"sm:max-w-2xl max-h-[90vh] overflow-y-auto"),children:[t.jsxs(Eh,{className:""+(d?"pb-2":"text-center"),children:[!d&&t.jsx(Jm.div,{initial:{scale:0},animate:{scale:1},transition:{type:"spring",duration:.5},className:"mx-auto w-16 h-16 bg-yellow-500/20 rounded-full flex items-center justify-center mb-4",children:t.jsx(ft,{className:"h-8 w-8 text-yellow-500"})}),t.jsxs(Jm.div,{initial:{y:20,opacity:0},animate:{y:0,opacity:1},transition:{delay:.3},className:"flex items-center gap-3 "+(d?"justify-start":"flex-col text-center"),children:[d&&t.jsx(Jm.div,{initial:{scale:0},animate:{scale:1},transition:{type:"spring",duration:.5},className:"w-10 h-10 bg-yellow-500/20 rounded-full flex items-center justify-center flex-shrink-0",children:t.jsx(ft,{className:"h-5 w-5 text-yellow-500"})}),t.jsxs("div",{className:d?"text-left flex-1":"text-center",children:[t.jsx(Ah,{className:"font-bold "+(d?"text-lg":"text-xl"),children:"Distribuir Pontos de Atributo"}),t.jsx(Ph,{asChild:!0,children:t.jsxs("div",{className:""+(d?"flex items-center justify-between mt-1":"text-center space-y-3"),children:[t.jsxs(Nu,{variant:"outline",className:"bg-yellow-500/10 border-yellow-500/30 text-yellow-400 "+(d?"px-2 py-1 text-xs":"px-3 py-1"),children:[t.jsx(ft,{className:"mr-2 "+(d?"h-3 w-3":"h-4 w-4")}),u," pontos"]}),!d&&t.jsx("p",{className:"text-sm text-muted-foreground",children:"Distribua seus pontos estrategicamente para fortalecer seu personagem na torre."})]})})]})]})]}),t.jsx("div",{className:""+(d?"overflow-y-auto max-h-[calc(95vh-120px)]":""),children:t.jsxs(Jm.div,{className:""+(d?"py-2":"space-y-4 py-4"),initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.3},children:[t.jsx("div",{className:""+(d?"grid grid-cols-2 gap-2 mb-3":"space-y-3"),children:Object.entries(p).map((([e,a])=>{const s=e,n=r?.[s]||0,l=a.icon;return t.jsxs(Jm.div,{className:`flex items-center gap-2 rounded-lg border ${a.bgColor} ${a.borderColor} ${d?"p-2 text-xs":"gap-3 p-3"}`,whileHover:{scale:1.01},children:[t.jsxs("div",{className:"flex items-center gap-2 flex-1 "+(d?"min-w-0":"gap-3"),children:[t.jsx(l,{className:`flex-shrink-0 ${a.color} ${d?"h-4 w-4":"h-5 w-5"}`}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsx("div",{className:"font-semibold "+(d?"text-xs truncate":"text-sm"),children:a.label}),!d&&t.jsx("div",{className:"text-xs text-muted-foreground",children:a.benefit})]})]}),t.jsx("div",{className:"text-center "+(d?"min-w-[40px]":"min-w-[60px]"),children:t.jsxs("div",{className:"font-bold "+(d?"text-xs":"text-sm"),children:[n,i[s]>0&&t.jsxs("span",{className:"text-green-400 ml-1",children:["+",i[s]]})]})}),t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(Wa,{size:"icon",variant:"ghost",className:"rounded-full "+(d?"h-6 w-6":"h-8 w-8"),onClick:()=>(e=>{i[e]>0&&o((t=>({...t,[e]:t[e]-1})))})(s),disabled:0===i[s],children:t.jsx(_t,{className:d?"h-3 w-3":"h-4 w-4"})}),t.jsx("div",{className:"text-center font-mono "+(d?"w-6 text-xs":"w-8 text-sm"),children:i[s]}),t.jsx(Wa,{size:"icon",variant:"ghost",className:"rounded-full "+(d?"h-6 w-6":"h-8 w-8"),onClick:()=>(e=>{u>0&&o((t=>({...t,[e]:t[e]+1})))})(s),disabled:0===u,children:t.jsx(Ke,{className:d?"h-3 w-3":"h-4 w-4"})})]})]},s)}))}),m>0&&t.jsxs(Jm.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},className:"bg-primary/5 border border-primary/20 rounded-lg "+(d?"p-2 mt-2":"p-3"),children:[t.jsxs("div",{className:"font-medium mb-2 flex items-center gap-2 "+(d?"text-xs":"text-sm"),children:[t.jsx(bt,{className:"text-primary "+(d?"h-3 w-3":"h-4 w-4")}),"Preview dos Melhoramentos"]}),t.jsxs("div",{className:"grid gap-1 "+(d?"grid-cols-4 text-xs":"grid-cols-2 gap-2 text-xs"),children:[i.vitality>0&&t.jsxs("div",{className:"flex justify-between",children:[t.jsx("span",{children:"HP:"}),t.jsxs("span",{className:"text-green-400",children:["+",8*i.vitality]})]}),i.intelligence>0&&t.jsxs("div",{className:"flex justify-between",children:[t.jsx("span",{children:"Mana:"}),t.jsxs("span",{className:"text-blue-400",children:["+",5*i.intelligence]})]}),i.strength>0&&t.jsxs("div",{className:"flex justify-between",children:[t.jsx("span",{children:"Ataque:"}),t.jsxs("span",{className:"text-red-400",children:["+",2*i.strength]})]}),i.dexterity>0&&t.jsxs("div",{className:"flex justify-between",children:[t.jsx("span",{children:"Velocidade:"}),t.jsxs("span",{className:"text-green-400",children:["+",Math.floor(1.5*i.dexterity)]})]})]})]})]})}),t.jsxs("div",{className:"flex gap-2 pt-2",children:[t.jsx(Wa,{variant:"outline",onClick:s,className:"flex-1 "+(d?"text-xs h-8":""),children:"Cancelar"}),m>0&&t.jsxs(Wa,{variant:"outline",onClick:h,className:"flex-1 "+(d?"text-xs h-8":""),children:[t.jsx(Vt,{className:"mr-1 "+(d?"h-3 w-3":"h-4 w-4 mr-2")}),d?"Reset":"Resetar"]}),t.jsxs(Wa,{onClick:async()=>{if(0!==m&&r){c(!0);try{const e=await Nh.distributeAttributePoints(r.id,i);if(e.success&&e.data?.new_stats){if(_.success("Pontos distribuídos com sucesso!"),n){const t={...r,...e.data.new_stats,attribute_points:e.data.new_stats.attribute_points};n(t)}h(),s()}else _.error("Erro ao distribuir pontos",{description:e.error||e.data?.message})}catch(e){_.error("Erro ao distribuir pontos")}finally{c(!1)}}},disabled:l||0===m,className:"flex-1 bg-emerald-500 hover:bg-emerald-600 "+(d?"text-xs h-8":""),children:[l?t.jsx("div",{className:"animate-spin rounded-full border-2 border-white border-t-transparent mr-1 "+(d?"h-3 w-3":"h-4 w-4 mr-2")}):t.jsx(Ot,{className:"mr-1 "+(d?"h-3 w-3":"h-4 w-4 mr-2")}),d?`OK (${m})`:`Confirmar (${m})`]})]})]})}):null};function sb({isOpen:e,onClose:a,gameLogs:s}){return t.jsx(_h,{open:e,onOpenChange:a,children:t.jsxs(Sh,{className:"max-w-2xl max-h-[80vh] flex flex-col",children:[t.jsx(Eh,{className:"flex-shrink-0",children:t.jsxs(Ah,{className:"flex items-center gap-2",children:["💬 Log de Batalha",t.jsxs("span",{className:"text-sm text-muted-foreground",children:["(",s.length," evento",1!==s.length?"s":"",")"]})]})}),t.jsx("div",{className:"flex-1 overflow-auto min-h-0",children:t.jsx(Kg,{gameLog:s})})]})})}function rb(){e.useRef(0).current+=1;const a=r(),{user:s}=Oa(),n=lx((e=>e.gameState.player)),i=lx((e=>e.gameState.currentEnemy)),o=lx((e=>e.gameState.currentFloor)),l=lx((e=>e.gameState.isPlayerTurn)),c=lx((e=>e.gameState.mode)),d=lx((e=>e.gameState.battleRewards)),m=lx((e=>e.gameState.characterDeleted)),p=lx((e=>e.gameState.fleeSuccessful)),x=lx((e=>e.loading)),f=px((e=>e.gameLogs)),g=px((e=>e.addGameLogMessage)),b=Nf((e=>e.performAction)),v=lx((e=>e.updatePlayerStats)),{character:y}=h({from:"/_authenticated/game/play/hub/battle/$character"}),{canInitialize:j,markAsInitialized:N}=function(t){const a=e.useRef({initialized:new Set,lastCharacterId:null,canInitialize:!0});t&&a.current.lastCharacterId!==t&&(a.current.lastCharacterId=t,a.current.canInitialize=!a.current.initialized.has(t));const s=e.useCallback((()=>{t&&(a.current.initialized.add(t),a.current.canInitialize=!1)}),[t]);return{canInitialize:!!t&&a.current.canInitialize,markAsInitialized:s}}(y),{initializeBattle:w,isLoading:C,error:S,progress:E,isInitialized:k}=function(t,a,s){const r=e.useRef({isInitialized:!1,isInitializing:!1,lastCharacterId:null,hasError:!1,errorMessage:null}),n=e.useRef(s);n.current=s;const i=e.useRef(lx.getState().setGameState);i.current=lx.getState().setGameState;const[o,l]=e.useState(!1),[c,d]=e.useState(null),m=e.useCallback((async()=>{const e=r.current;if(t&&a){if(e.isInitialized&&e.lastCharacterId===t)l(!1);else if(!e.isInitializing)try{e.isInitializing=!0,e.lastCharacterId=t,l(!0),d(null);const a=await Nh.getCharacter(t);if(!a.success||!a.data)throw new Error(a.error||"Personagem não encontrado");const{LoggingUtils:s}=await u((async()=>{const{LoggingUtils:e}=await Promise.resolve().then((()=>Af));return{LoggingUtils:e}}),void 0);s.clearAllLogs();const r=await Qg.initializeBattle(a.data);if(!r.success)throw new Error(r.error||"Falha na inicialização da batalha");if(!r.gameState)throw new Error("gameState não foi retornado pelo BattleInitializationService");i.current(r.gameState),e.isInitialized=!0,e.hasError=!1,e.errorMessage=null,n.current&&n.current()}catch(s){e.hasError=!0,e.errorMessage=s instanceof Error?s.message:"Erro desconhecido",d(e.errorMessage)}finally{e.isInitializing=!1,l(!1)}}else l(!1)}),[t,a]);return{initializeBattle:m,isLoading:o,error:c,isInitialized:r.current.isInitialized,progress:{step:"ready",progress:100,message:"Pronto"}}}(y,s?.id,N),A=e.useRef(w);A.current=w;const{potionSlots:P,loadingSlots:M,loadPotionSlots:T,reloadSlots:q}=function(t){const[a,s]=e.useState([]),[r,n]=e.useState(!1),i=e.useRef(!1),o=e.useRef(void 0);i.current=r,o.current=t;const l=e.useCallback((async()=>{const e=o.current,t=i.current;if(e&&!t)try{n(!0);const{SlotService:t}=await u((async()=>{const{SlotService:e}=await Promise.resolve().then((()=>of));return{SlotService:e}}),void 0),a=await t.getCharacterPotionSlots(e);a.success&&a.data?s(a.data):s([{slot_position:1,consumable_id:null,consumable_name:null,consumable_description:null,effect_value:null,consumable_type:null,available_quantity:0,consumable_price:null},{slot_position:2,consumable_id:null,consumable_name:null,consumable_description:null,effect_value:null,consumable_type:null,available_quantity:0,consumable_price:null},{slot_position:3,consumable_id:null,consumable_name:null,consumable_description:null,effect_value:null,consumable_type:null,available_quantity:0,consumable_price:null}])}catch{s([{slot_position:1,consumable_id:null,consumable_name:null,consumable_description:null,effect_value:null,consumable_type:null,available_quantity:0,consumable_price:null},{slot_position:2,consumable_id:null,consumable_name:null,consumable_description:null,effect_value:null,consumable_type:null,available_quantity:0,consumable_price:null},{slot_position:3,consumable_id:null,consumable_name:null,consumable_description:null,effect_value:null,consumable_type:null,available_quantity:0,consumable_price:null}])}finally{n(!1)}}),[]),c=e.useCallback((async()=>{const e=o.current;if(e){const{SlotService:t}=await u((async()=>{const{SlotService:e}=await Promise.resolve().then((()=>of));return{SlotService:e}}),void 0);t.invalidateCache(e),await l()}}),[l]);return{potionSlots:a,loadingSlots:r,loadPotionSlots:l,reloadSlots:c}}(n?.id),D=e.useRef(!0);e.useEffect((()=>(D.current=!0,()=>{D.current=!1})),[]),e.useEffect((()=>{n?.id&&T().catch((e=>{}))}),[n?.id,T]);const[L,$]=e.useState(!1),[R,I]=e.useState(!1),[F,V]=e.useState(!1),[O,B]=e.useState(!1),[U,z]=e.useState(!1),[H,G]=e.useState(!1),[,X]=e.useState(!1),[W,Y]=e.useState(!1),K=Hf(),[J,Q]=e.useState({xp:0,gold:0,drops:[],leveledUp:!1,newLevel:0}),Z=e.useRef(null);e.useEffect((()=>{if(D.current=!0,y&&s?.id&&!Z.current&&j)return Z.current=setTimeout((()=>{D.current&&y&&s?.id&&A.current&&A.current().catch((e=>{})),Z.current=null}),200),()=>{D.current=!1,Z.current&&(clearTimeout(Z.current),Z.current=null)}}),[y,s?.id,j]);const ee=e.useMemo((()=>({enemyHpPercentage:i&&i.maxHp>0?Math.max(0,Math.min(100,i.hp/i.maxHp*100)):0,playerHpPercentage:n?.max_hp&&n.max_hp>0?Math.max(0,Math.min(100,n.hp/n.max_hp*100)):0,playerManaPercentage:n?.max_mana&&n.max_mana>0?Math.max(0,Math.min(100,n.mana/n.max_mana*100)):0})),[i?.hp,i?.maxHp,n?.hp,n?.max_hp,n?.mana,n?.max_mana]),te=e.useMemo((()=>({floorNumber:n?.floor||1,type:o?.type||"common",description:o?.description||`Andar ${n?.floor||1}`,isCheckpoint:o?.isCheckpoint||!1,minLevel:o?.minLevel||1})),[n?.floor,o?.type,o?.description,o?.isCheckpoint,o?.minLevel]),ae=e.useMemo((()=>({id:"placeholder",name:d?"Inimigo derrotado!":"Preparando próximo inimigo...",level:1,hp:0,maxHp:1,attack:0,defense:0,speed:1,image:d?"💀":"⏳",behavior:"balanced",mana:0,reward_xp:0,reward_gold:0,possible_drops:[],active_effects:{buffs:[],debuffs:[],dots:[],hots:[],attribute_modifications:[]}})),[d]),se=e.useMemo((()=>({id:n?.id||"",name:n?.name||"",level:n?.level||1,floor:n?.floor||1,hp:n?.hp||0,max_hp:n?.max_hp||1,xp:n?.xp||0,gold:n?.gold||0})),[n?.id,n?.name,n?.level,n?.floor,n?.hp,n?.max_hp,n?.xp,n?.gold]);e.useEffect((()=>{const e=d?.xp||0,t=d?.gold||0,a=d?.leveledUp||!1,s=d?.newLevel||0;(e||t)&&(L||(Q({xp:e,gold:t,drops:d?.drops||[],leveledUp:a,newLevel:s}),$(!0),g(`Vitória! Você derrotou o inimigo e recebeu ${e} XP e ${t} Gold.`,"system"),a&&s&&g(`Você subiu para o nível ${s}!`,"system")))}),[d?.xp,d?.gold,d?.leveledUp,d?.newLevel]),e.useEffect((()=>{"gameover"===c&&void 0!==n?.hp&&n.hp<=0&&!R&&(I(!0),m&&n?.name&&g(`${n.name} foi perdido permanentemente. O sistema de Permadeath está ativo.`,"system"))}),[c,n?.hp,n?.name,m]),e.useEffect((()=>{if(("fled"===c||!0===p)&&!O){z("fled"===c||!0===p),B(!0)}}),[c,p]),e.useEffect((()=>{const e=()=>{const e=window.innerWidth<=768,t=window.innerHeight>window.innerWidth;G(e&&t)};e();const t=()=>e(),a=()=>e();return window.addEventListener("resize",t),window.addEventListener("orientationchange",a),()=>{window.removeEventListener("resize",t),window.removeEventListener("orientationchange",a)}}),[]),e.useEffect((()=>{const e=()=>V(!0);return window.addEventListener("openAttributeModal",e),()=>window.removeEventListener("openAttributeModal",e)}),[]);const re=e.useCallback((async(e,t,a)=>{try{await b(e,t,a)}catch(s){_.error(`Erro ao executar ação: ${e}`)}}),[]),ne=e.useCallback(((e,t)=>{v(e,t);const a=lx.getState().gameState.player;a?.id&&Nh.updateCharacterHpMana(a.id,e,t).then((e=>{e.success||_.error("Erro ao atualizar status do personagem")})).catch((e=>{_.error("Erro ao atualizar status do personagem")}))}),[v]),ie=e.useCallback((e=>{const t={...lx.getState().gameState,player:e};lx.getState().setGameState(t)}),[n?.attribute_points]),oe=e.useCallback((async()=>{$(!1);try{const e=lx.getState().gameState.player;e?.id&&d&&Nh.invalidateCharacterCache(e.id),await re("continue")}catch(e){_.error("Erro ao avançar para o próximo andar"),$(!0)}}),[re,d]),le=e.useCallback((async()=>{const e=lx.getState().gameState.player;if(e?.id){const{LoggingUtils:t}=await u((async()=>{const{LoggingUtils:e}=await Promise.resolve().then((()=>Af));return{LoggingUtils:e}}),void 0);t.logSpecialEvent("level_checkpoint",`${e.name} retornou ao hub após vitória`,{playerId:e.id,playerName:e.name,floorNumber:e.floor});const{BattleLoggerService:s}=await u((async()=>{const{BattleLoggerService:e}=await Promise.resolve().then((()=>Ef));return{BattleLoggerService:e}}),void 0);s.endBattle("victory",{reason:"Retorno ao hub",playerName:e.name}),Nh.invalidateCharacterCache(e.id);const{useCharacterStore:r}=await u((async()=>{const{useCharacterStore:e}=await Promise.resolve().then((()=>yx));return{useCharacterStore:e}}),void 0),n=r.getState();n.selectedCharacterId===e.id&&n.setSelectedCharacter(null),a({to:"/game/play/hub",search:{character:e.id}})}}),[a]),ce=e.useCallback((()=>{a({to:"/game/play"})}),[a]),de=e.useCallback((()=>{V(!0),$(!1)}),[]),me=e.useCallback((async()=>{B(!1);const e=lx.getState().gameState.player;if(U&&e?.id){const{LoggingUtils:s}=await u((async()=>{const{LoggingUtils:e}=await Promise.resolve().then((()=>Af));return{LoggingUtils:e}}),void 0);s.logSpecialEvent("flee_success",`${e.name} fugiu da batalha com sucesso`,{playerId:e.id,playerName:e.name,floorNumber:e.floor});const{BattleLoggerService:r}=await u((async()=>{const{BattleLoggerService:e}=await Promise.resolve().then((()=>Ef));return{BattleLoggerService:e}}),void 0);r.endBattle("flee",{reason:"Fuga bem-sucedida",playerName:e.name}),_.success("Fuga bem-sucedida!",{description:"Retornando ao hub...",duration:2e3});try{await Nh.updateCharacterFloor(e.id,1)}catch(t){}a({to:"/game/play/hub",search:{character:e.id}})}else{if(e?.id){const{LoggingUtils:t}=await u((async()=>{const{LoggingUtils:e}=await Promise.resolve().then((()=>Af));return{LoggingUtils:e}}),void 0);t.logSpecialEvent("flee_failure",`${e.name} falhou ao tentar fugir`,{playerId:e.id,playerName:e.name,floorNumber:e.floor})}_.warning("Fuga falhou!",{description:"Prepare-se para o contra-ataque...",duration:3e3})}}),[U,a]),ue=e.useCallback((async()=>{X(!1),await w()}),[]),he=e.useCallback((()=>{const e=lx.getState().gameState.player;e?.id&&a({to:"/game/play/hub/cemetery",search:{character:e.id}})}),[a]);return S&&!k?t.jsx("div",{className:"min-h-svh flex flex-col items-center justify-center bg-gradient-to-b from-background to-secondary p-4",children:t.jsxs("div",{className:"text-center "+(K?"max-w-md":"max-w-lg"),children:[t.jsx("div",{className:"text-destructive text-6xl mb-4",children:"⚠️"}),t.jsx("h2",{className:"text-2xl font-bold mb-4",children:"Falha na Inicialização da Batalha"}),t.jsxs("div",{className:"bg-card rounded-lg p-4 mb-6 text-left",children:[t.jsx("h3",{className:"font-semibold mb-2",children:"Detalhes do Erro:"}),t.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:S}),t.jsxs("div",{className:"flex justify-between text-sm",children:[t.jsx("span",{children:"Última etapa:"}),t.jsx("span",{children:E.step})]})]}),t.jsxs("div",{className:"space-y-3",children:[t.jsx(Wa,{onClick:ue,className:"w-full",size:"lg",children:"🔄 Tentar Novamente"}),t.jsx(Wa,{onClick:()=>a({to:"/game/play"}),variant:"secondary",className:"w-full",children:"🏠 Voltar ao Hub"})]})]})}):C||!k&&j?t.jsx("div",{className:"min-h-svh flex flex-col items-center justify-center bg-gradient-to-b from-background to-secondary p-4",children:t.jsxs("div",{className:"text-center "+(K?"max-w-sm":"max-w-md"),children:[t.jsx("div",{className:"inline-block animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-primary mb-4"}),t.jsx("h2",{className:"text-2xl font-bold mb-2",children:"Inicializando Batalha"}),t.jsx("div",{className:"bg-card rounded-lg p-4 mb-4",children:t.jsxs("div",{className:"mb-2",children:[t.jsxs("div",{className:"flex justify-between text-sm mb-1",children:[t.jsx("span",{children:E.message}),t.jsxs("span",{children:[E.progress,"%"]})]}),t.jsx("div",{className:"w-full bg-secondary rounded-full h-2",children:t.jsx("div",{className:"bg-primary h-2 rounded-full transition-all duration-300",style:{width:`${E.progress}%`}})})]})}),t.jsx(Wa,{onClick:()=>a({to:"/game/play"}),variant:"ghost",size:"sm",children:"Cancelar e Voltar"})]})}):!k||"battle"!==c&&"special_event"!==c||i?t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"w-full "+(K?"max-w-4xl mr-16 overflow-y-auto":"max-w-6xl"),children:[t.jsx(ng,{currentFloor:te,playerLevel:n?.level||1}),t.jsxs("div",{className:"mb-6 relative "+(K?"h-full flex flex-col":""),children:[!H&&!K&&n&&t.jsx("div",{className:"absolute left-0 top-1/2 transform -translate-y-1/2 -translate-x-20 z-10 hidden lg:block",children:t.jsx(tb,{handleAction:re,isPlayerTurn:l,loading:x,player:n,potionSlots:P,loadingPotionSlots:M})}),!H&&!K&&n&&t.jsx("div",{className:"fixed bottom-4 left-4 z-20 block lg:hidden",children:t.jsx(tb,{handleAction:re,isPlayerTurn:l,loading:x,player:n,potionSlots:P,loadingPotionSlots:M})}),K&&n&&t.jsx("div",{className:"fixed right-2 top-1/2 transform -translate-y-1/2 z-20 flex flex-col justify-center max-h-screen py-4",children:t.jsx("div",{className:"bg-slate-900/95 rounded-xl border border-slate-700/50 shadow-2xl backdrop-blur-sm",children:t.jsx(tb,{handleAction:re,isPlayerTurn:l,loading:x,player:n,potionSlots:P,loadingPotionSlots:M})})}),t.jsx(tg,{player:n,currentEnemy:i||ae,playerHpPercentage:ee.playerHpPercentage,playerManaPercentage:ee.playerManaPercentage,enemyHpPercentage:ee.enemyHpPercentage,isPlayerTurn:l,gameLogs:f,onOpenLogModal:()=>Y(!0)})]}),!K&&t.jsx("div",{className:"mb-6",children:t.jsx(ag,{handleAction:re,isPlayerTurn:l,loading:x,player:n,onPlayerStatsUpdate:ne,currentEnemy:i,battleRewards:d,potionSlots:P,loadingPotionSlots:M,onSlotsChange:q})}),t.jsx("div",{className:""+(K?"invisible h-0 overflow-hidden":""),children:t.jsx(Kg,{gameLog:f})})]}),t.jsx(sg,{isOpen:L,onContinue:oe,onReturnToHub:le,onOpenAttributeModal:de,rewards:J,leveledUp:J.leveledUp,newLevel:J.newLevel,hasAttributePoints:(n?.attribute_points||0)>0}),t.jsx(rg,{isOpen:R,onClose:()=>I(!1),player:se,gameMessage:`${n?.name||"Personagem"} foi derrotado no Andar ${n?.floor||1}...`,highestFloor:n?.floor||1,isCharacterDeleted:m,userId:s?.id,onReturnToCharacterSelect:ce,onViewCemetery:he}),t.jsx(ab,{isOpen:F,onClose:()=>{V(!1);const e=lx.getState().gameState.player,t=(e?.attribute_points||0)>0;d&&!L&&t&&$(!0)},character:n,onAttributesUpdated:ie}),O&&t.jsx("div",{className:"fixed inset-0 z-50",children:t.jsx(Jg,{isVisible:O,isSuccess:U,playerName:n?.name||"Personagem",enemyName:i?.name,onComplete:me})}),K&&t.jsx(sb,{isOpen:W,onClose:()=>Y(!1),gameLogs:f})]}):t.jsx("div",{className:"min-h-svh flex flex-col items-center justify-center bg-gradient-to-b from-background to-secondary p-4",children:t.jsxs("div",{className:"text-center "+(K?"max-w-md":"max-w-lg"),children:[t.jsx("div",{className:"text-destructive text-6xl mb-4",children:"⚠️"}),t.jsx("h2",{className:"text-2xl font-bold mb-4",children:"Erro na Inicialização"}),t.jsxs("div",{className:"bg-card rounded-lg p-4 mb-6 text-left",children:[t.jsx("h3",{className:"font-semibold mb-2",children:"Problema:"}),t.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"A batalha foi inicializada mas nenhum inimigo foi gerado."}),t.jsxs("div",{className:"space-y-2 text-sm",children:[t.jsxs("div",{className:"flex justify-between",children:[t.jsx("span",{children:"Modo:"}),t.jsx("span",{children:c})]}),t.jsxs("div",{className:"flex justify-between",children:[t.jsx("span",{children:"Andar:"}),t.jsx("span",{children:n?.floor||"N/A"})]}),t.jsxs("div",{className:"flex justify-between",children:[t.jsx("span",{children:"Tem inimigo:"}),t.jsx("span",{className:"text-destructive",children:i?"Sim":"Não"})]})]})]}),t.jsxs("div",{className:"space-y-3",children:[t.jsx(Wa,{onClick:ue,className:"w-full",size:"lg",children:"🔄 Reinicializar Batalha"}),t.jsx(Wa,{onClick:()=>{const e=lx.getState().gameState.player;e?.id&&a({to:"/game/play/hub",search:{character:e.id}})},variant:"secondary",className:"w-full",children:"🏠 Voltar ao Hub"})]})]})})}const nb=l("/_authenticated/game/play/hub/battle/$character")({component:function(){const a=r(),{character:s}=nb.useParams(),{loading:n}=Vf(),[i,o]=e.useState(!0),l=Hf(),c=e.useRef(!1),d=e.useRef(!1),m=e.useMemo((()=>({isGameLoading:n.loadProgress,shouldShowLoading:i||n.loadProgress})),[n.loadProgress,i]);return e.useEffect((()=>(d.current=!0,()=>{d.current=!1,c.current=!1})),[]),e.useEffect((()=>{if(!d.current)return;const e=m.isGameLoading;if(!e&&i){const e=setTimeout((()=>{d.current&&o(!1)}),100);return()=>clearTimeout(e)}e&&!i&&o(!0)}),[m.isGameLoading,i]),e.useEffect((()=>{d.current&&!c.current&&(s?c.current=!0:(c.current=!0,_.error("Personagem não especificado",{description:"Redirecionando para a seleção de personagens"}),a({to:"/game/play"})))}),[s,a]),m.shouldShowLoading?t.jsx("div",{className:"min-h-screen flex flex-col items-center justify-center bg-gradient-to-b from-background to-secondary p-2 md:p-4",children:t.jsxs("div",{className:"w-full max-w-6xl",children:[t.jsxs("div",{className:"text-center mb-8",children:[t.jsx("div",{className:"h-8 w-64 bg-muted/50 animate-pulse rounded mx-auto mb-4"}),t.jsx("div",{className:"h-4 w-48 bg-muted/30 animate-pulse rounded mx-auto"})]}),t.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6 mb-6",children:[1,2,3].map((e=>t.jsxs("div",{className:"bg-card rounded-lg overflow-hidden shadow animate-pulse",children:[t.jsx("div",{className:"p-4 bg-muted/20",children:t.jsx("div",{className:"h-6 bg-muted/40 rounded w-24 mx-auto"})}),t.jsxs("div",{className:"p-6",children:[t.jsx("div",{className:"aspect-square bg-muted/30 rounded-md mb-4"}),t.jsxs("div",{className:"space-y-3",children:[t.jsx("div",{className:"h-4 bg-muted/40 rounded w-full"}),t.jsx("div",{className:"h-2 bg-muted/30 rounded w-full"}),t.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[t.jsx("div",{className:"h-8 bg-muted/20 rounded"}),t.jsx("div",{className:"h-8 bg-muted/20 rounded"})]})]})]})]},e)))}),t.jsxs("div",{className:"bg-card rounded-lg p-4 animate-pulse",children:[t.jsx("div",{className:"h-6 bg-muted/40 rounded w-32 mx-auto mb-4"}),t.jsxs("div",{className:"flex gap-2 justify-center",children:[t.jsx("div",{className:"h-10 bg-muted/30 rounded w-24"}),t.jsx("div",{className:"h-10 bg-muted/30 rounded w-24"}),t.jsx("div",{className:"h-10 bg-muted/30 rounded w-24"})]})]})]})}):t.jsx("div",{className:"min-h-screen w-full flex flex-col bg-gradient-to-b from-background to-secondary m-0 "+(l?"items-start justify-start pl-4 pr-2 py-2":"items-center justify-center p-2 md:p-4"),children:t.jsx(rb,{})})}}),ib=Ka.update({id:"/_public",getParentRoute:()=>Va}),ob=ms.update({id:"/_authenticated",getParentRoute:()=>Va}),lb=hs.update({id:"/",path:"/",getParentRoute:()=>Va}),cb=ps.update({id:"/logout",path:"/logout",getParentRoute:()=>ib}),db=Zm.update({id:"/auth",path:"/auth",getParentRoute:()=>ib}),mb=wu.update({id:"/users",path:"/users",getParentRoute:()=>ob}),ub=Gu.update({id:"/profile",path:"/profile",getParentRoute:()=>ob}),hb=Wu.update({id:"/game",path:"/game",getParentRoute:()=>ob}),pb=Ku.update({id:"/403",path:"/403",getParentRoute:()=>ob}),xb=Ju.update({id:"/verify-email",path:"/verify-email",getParentRoute:()=>db}),fb=eh.update({id:"/$id",path:"/$id",getParentRoute:()=>mb}),gb=nh.update({id:"/ranking",path:"/ranking",getParentRoute:()=>hb}),bb=Kh.update({id:"/play",path:"/play",getParentRoute:()=>hb}),vb=rp.update({id:"/guide",path:"/guide",getParentRoute:()=>hb}),yb=Tx.update({id:"/hub",path:"/hub",getParentRoute:()=>bb}),jb=$x.update({id:"/spells",path:"/spells",getParentRoute:()=>yb}),Nb=rf.update({id:"/shop",path:"/shop",getParentRoute:()=>yb}),_b=df.update({id:"/inventory",path:"/inventory",getParentRoute:()=>yb}),wb=hf.update({id:"/equipment",path:"/equipment",getParentRoute:()=>yb}),Cb=Uf.update({id:"/crafting",path:"/crafting",getParentRoute:()=>yb}),Sb=Yf.update({id:"/character-stats",path:"/character-stats",getParentRoute:()=>yb}),Eb=Jf.update({id:"/cemetery",path:"/cemetery",getParentRoute:()=>yb}),kb=Qf.update({id:"/select",path:"/select",getParentRoute:()=>wb}),Ab=nb.update({id:"/battle/$character",path:"/battle/$character",getParentRoute:()=>yb}),Pb={AuthenticatedGamePlayHubEquipmentSelectRoute:kb},Mb={AuthenticatedGamePlayHubCemeteryRoute:Eb,AuthenticatedGamePlayHubCharacterStatsRoute:Sb,AuthenticatedGamePlayHubCraftingRoute:Cb,AuthenticatedGamePlayHubEquipmentRoute:wb._addFileChildren(Pb),AuthenticatedGamePlayHubInventoryRoute:_b,AuthenticatedGamePlayHubShopRoute:Nb,AuthenticatedGamePlayHubSpellsRoute:jb,AuthenticatedGamePlayHubBattleCharacterRoute:Ab},Tb={AuthenticatedGamePlayHubRoute:yb._addFileChildren(Mb)},qb={AuthenticatedGameGuideRoute:vb,AuthenticatedGamePlayRoute:bb._addFileChildren(Tb),AuthenticatedGameRankingRoute:gb},Db={AuthenticatedUsersIdRoute:fb},Lb={Authenticated403Route:pb,AuthenticatedGameRoute:hb._addFileChildren(qb),AuthenticatedProfileRoute:ub,AuthenticatedUsersRoute:mb._addFileChildren(Db)},$b=ob._addFileChildren(Lb),Rb={PublicAuthVerifyEmailRoute:xb},Ib={PublicAuthRoute:db._addFileChildren(Rb),PublicLogoutRoute:cb},Fb={IndexRoute:lb,AuthenticatedRoute:$b,PublicRoute:ib._addFileChildren(Ib)},Vb=p({routeTree:Va._addFileChildren(Fb)._addFileTypes()});"serviceWorker"in navigator&&window.addEventListener("load",(()=>{navigator.serviceWorker.register("/sw.js").then((e=>{e.addEventListener("updatefound",(()=>{const t=e.installing;t&&t.addEventListener("statechange",(()=>{"installed"===t.state&&navigator.serviceWorker.controller&&confirm("Nova versão disponível! Deseja atualizar?")&&(t.postMessage({type:"SKIP_WAITING"}),window.location.reload())}))})),setInterval((()=>{e.update()}),3e4)})).catch((e=>{})),navigator.serviceWorker.addEventListener("controllerchange",(()=>{window.location.reload()}))})),ya.createRoot(document.getElementById("root")).render(t.jsx(e.StrictMode,{children:t.jsx(x,{router:Vb})}));export{Wa as B,Nh as C,Ms as I,ap as S,pu as a,xu as b,fu as c,bu as d,Nu as e,bh as f};
