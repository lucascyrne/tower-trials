const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["js/SpellsPage-BLb2iUzk.js","js/unknown-BfjI5f1f.js","js/unknown-DE60C25c.js","js/unknown-DMMI-7ec.js","js/unknown-84idxQzC.js","js/unknown-DIU1f-EL.js","js/logging-utils-BzLicWhP.js"])))=>i.map(i=>d[i]);
import{r as e,j as t,d as s,O as a,e as r,u as n,f as i,L as o,g as l,c,_ as d,h as m,i as u,k as h}from"./unknown-BfjI5f1f.js";import{c as p,g as x}from"./unknown-DE60C25c.js";import{o as f,s as g,n as b,Z as v,T as y,t as j,a as N,b as w,c as _,u as C,F as S,C as E,d as k,e as A}from"./unknown-DMMI-7ec.js";import{c as P,A as M}from"./unknown-DIU1f-EL.js";import{L as T,t as q,c as D,S as R,a as L,G as $,T as I,D as F,O as V,P as O,C as B,b as U,X as z,d as G,R as H,e as X,U as W,f as Y,M as K,g as J,h as Q,i as Z,j as ee,k as te,l as se,H as ae,Z as re,m as ne,n as ie,I as oe,o as le,p as ce,q as de,r as me,s as ue,u as he,V as pe,v as xe,w as fe,x as ge,y as be,z as ve,A as ye,B as je,E as Ne,F as we,J as _e,K as Ce,N as Se,W as Ee,Q as ke,Y as Ae,_ as Pe,$ as Me,a0 as Te,a1 as qe,a2 as De,a3 as Re,a4 as Le,a5 as $e,a6 as Ie,a7 as Fe,a8 as Ve,a9 as Oe,aa as Be,ab as Ue,ac as ze,ad as Ge,ae as He,af as Xe,ag as We,ah as Ye,ai as Ke,aj as Je,ak as Qe,al as Ze,am as et,an as tt,ao as st,ap as at,aq as rt,ar as nt,as as it,at as ot,au as lt,av as ct,aw as dt,ax as mt,ay as ut,az as ht,aA as pt,aB as xt,aC as ft,aD as gt,aE as bt,aF as vt,aG as yt,aH as jt,aI as Nt,aJ as wt,aK as _t,aL as Ct,aM as St,aN as Et,aO as kt,aP as At,aQ as Pt,aR as Mt,aS as Tt,aT as qt,aU as Dt,aV as Rt,aW as Lt,aX as $t,aY as It,aZ as Ft,a_ as Vt,a$ as Ot,b0 as Bt,b1 as Ut,b2 as zt,b3 as Gt,b4 as Ht,b5 as Xt,b6 as Wt,b7 as Yt,b8 as Kt,b9 as Jt,ba as Qt,bb as Zt,bc as es,bd as ts,be as ss,bf as as,bg as rs,bh as ns,bi as is,bj as os,bk as ls,bl as cs,bm as ds,bn as ms,bo as us,bp as hs,bq as ps,br as xs,bs as fs,bt as gs}from"./unknown-84idxQzC.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver((e=>{for(const s of e)if("childList"===s.type)for(const e of s.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)})).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();const bs=x(p()),vs=f({email:g().email("Email inválido"),password:g().min(6,"A senha deve ter pelo menos 6 caracteres")}),ys=f({email:g().email("Email inválido"),password:g().min(6,"A senha deve ter pelo menos 6 caracteres"),confirmPassword:g().min(6,"A senha deve ter pelo menos 6 caracteres")}).refine((e=>e.password===e.confirmPassword),{message:"As senhas não coincidem",path:["confirmPassword"]}),js={user:null,session:null,isLoading:!1,isAuthenticated:!1,error:null,loading:{onAuthUserChanged:!1,signIn:!1,signUp:!1,signOut:!1,updateProfile:!1}},Ns=e.createContext({...js,signInWithEmail:async()=>({success:!1}),signUpWithEmail:async()=>({success:!1}),signOut:async()=>{},updateProfile:async()=>({success:!1})});var ws=(e=>(e.LOCAL="LOCAL",e.DEV="DEV",e.PROD="PROD",e))(ws||{});const _s=f({VITE_ENV:b(ws),VITE_BASE_URL:g().url().optional(),VITE_SUPABASE_URL:g().url(),VITE_SUPABASE_ANON_KEY:g(),VITE_SERVICE_ROLE:g().optional(),VITE_LOGIN_URL:g().url().optional(),VITE_SUPABASE_LOCAL_URL:g().url().optional(),VITE_SUPABASE_LOCAL_ANON_KEY:g().optional()});const Cs=function(){const e={VITE_ENV:"DEV",VITE_BASE_URL:"http://tower-trials.vercel.app",VITE_SUPABASE_URL:"https://bkqzntlkkbepzvoesqxh.supabase.co",VITE_SUPABASE_ANON_KEY:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImJrcXpudGxra2JlcHp2b2VzcXhoIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjEyNzI2NTIsImV4cCI6MjA3Njg0ODY1Mn0.Tr1UdumfKh8k8S6YaLFVS49rfXylQcyaU-O7qpynrK4",VITE_SERVICE_ROLE:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImJrcXpudGxra2JlcHp2b2VzcXhoIiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTc2MTI3MjY1MiwiZXhwIjoyMDc2ODQ4NjUyfQ.lzOfCWvDf9JpqLngMosX1LeG7S-PUmHaXHEDBWvfLuI",VITE_LOGIN_URL:"http://tower-trials.vercel.app/login",VITE_SUPABASE_LOCAL_URL:void 0,VITE_SUPABASE_LOCAL_ANON_KEY:void 0};try{return _s.parse(e)}catch(t){throw t instanceof v&&t.errors.forEach((e=>{})),new Error("Configuração de ambiente inválida")}}(),Ss=(()=>{switch(Cs.VITE_ENV){case ws.LOCAL:return{url:Cs.VITE_SUPABASE_LOCAL_URL||"http://127.0.0.1:54321",anonKey:Cs.VITE_SUPABASE_ANON_KEY,serviceRoleKey:Cs.VITE_SERVICE_ROLE};case ws.DEV:case ws.PROD:default:return{url:Cs.VITE_SUPABASE_URL,anonKey:Cs.VITE_SUPABASE_ANON_KEY,serviceRoleKey:Cs.VITE_SERVICE_ROLE}}})(),Es=P(Ss.url,Ss.anonKey,{auth:{persistSession:!0,autoRefreshToken:!0,detectSessionInUrl:!0,storage:localStorage}}),ks=P(Ss.url,Ss.serviceRoleKey||"",{auth:{autoRefreshToken:!1,persistSession:!1}}),As=Object.freeze(Object.defineProperty({__proto__:null,supabase:Es,supabaseAdmin:ks},Symbol.toStringTag,{value:"Module"})),Ps={getSession:async()=>{try{const{data:{session:e},error:t}=await Es.auth.getSession();if(t)throw t;return e}catch(e){return null}},getCurrentUser:async()=>{try{const{data:{user:e},error:t}=await Es.auth.getUser();if(403===t?.status||!e)return null;if(t)throw t;const{data:s,error:a}=await Es.from("users").select("*").eq("uid",e.id).maybeSingle();return a?null:s?{...e,username:s.username,display_name:s.display_name,avatar_url:s.avatar_url,role:s.role,highest_floor:s.highest_floor,total_games:s.total_games,total_victories:s.total_victories,total_character_level:s.total_character_level,max_character_slots:s.max_character_slots,is_active:s.is_active,last_login:s.last_login}:null}catch(e){return e instanceof Error&&e.message.includes("JWT"),null}},signOut:async()=>{try{const{error:e}=await Es.auth.signOut();if(e)throw e}catch(e){throw e}},signInWithEmail:async({email:e,password:t})=>{try{const{data:s,error:a}=await Es.auth.signInWithPassword({email:e,password:t});if(a)throw a;if(!s.user)return{user:null,session:null,error:"Usuário não encontrado"};const{data:r,error:n}=await Es.from("users").select("*").eq("uid",s.user.id).maybeSingle();if(n)return{user:null,session:s.session,error:"Erro ao buscar perfil do usuário"};if(!r)return{user:null,session:s.session,error:"Perfil não encontrado"};await Es.from("users").update({last_login:(new Date).toISOString()}).eq("uid",s.user.id);return{user:{...s.user,username:r.username,display_name:r.display_name,avatar_url:r.avatar_url,role:r.role,highest_floor:r.highest_floor,total_games:r.total_games,total_victories:r.total_victories,total_character_level:r.total_character_level,max_character_slots:r.max_character_slots,is_active:r.is_active,last_login:r.last_login},session:s.session}}catch(s){return{user:null,session:null,error:String(s)}}},signUpWithEmail:async e=>{try{const{email:a,password:r,username:n=a.split("@")[0]}=e,{data:i,error:o}=await Es.auth.signUp({email:a,password:r,options:{data:{username:n},emailRedirectTo:`${window.location.origin}/auth`}});if(o)throw o;if(!i.user)throw new Error("Falha ao criar usuário");await new Promise((e=>setTimeout(e,1e3)));try{await Es.rpc("create_user_profile",{p_uid:i.user.id,p_username:n,p_email:a})}catch(t){try{const{error:e}=await Es.from("users").insert({uid:i.user.id,username:n,email:a,role:"PLAYER",highest_floor:0,total_games:0,total_victories:0,total_character_level:0,max_character_slots:3,is_active:!0,created_at:(new Date).toISOString(),updated_at:(new Date).toISOString()});if(e){if("23505"===e.code)return{user:{...i.user,username:n,role:"PLAYER",highest_floor:0,total_games:0,total_victories:0,total_character_level:0,max_character_slots:3,is_active:!0},session:i.session};throw e}}catch(s){}}return{user:{...i.user,username:n,role:"PLAYER",highest_floor:0,total_games:0,total_victories:0,total_character_level:0,max_character_slots:3,is_active:!0},session:i.session}}catch(a){return{user:null,session:null,error:String(a)}}},updateProfile:async e=>{try{const t=await Ps.getSession();if(!t?.user)throw new Error("Usuário não autenticado");const{error:s}=await Es.from("users").update({display_name:e.display_name,avatar_url:e.avatar_url,updated_at:(new Date).toISOString()}).eq("uid",t.user.id).select().single();if(s)throw s;return{user:await Ps.getCurrentUser(),session:t}}catch(t){return{user:null,session:null,error:String(t)}}},handleAuthError:e=>{if(e instanceof M)switch(e.status){case 400:if(e.message.includes("Email not confirmed"))return new Error("Por favor, confirme seu e-mail antes de fazer login");if(e.message.includes("Invalid login credentials"))return new Error("E-mail ou senha incorretos");if(e.message.includes("Password should be at least 6 characters"))return new Error("A senha deve ter pelo menos 6 caracteres");if(e.message.includes("User already registered"))return new Error("Este e-mail já está cadastrado");break;case 401:return new Error("Sessão expirada. Por favor, faça login novamente");case 422:return new Error("Dados inválidos. Verifique as informações e tente novamente");case 429:return new Error("Muitas tentativas. Por favor, aguarde alguns minutos")}return e instanceof Error?e:new Error("Ocorreu um erro inesperado. Tente novamente mais tarde")}},Ms={onAuthUserChanged:!0,signIn:!1,signUp:!1,signOut:!1,updateProfile:!1},Ts={user:null,session:null,isLoading:!0,isAuthenticated:!1,error:null,loading:Ms};function qs({children:s}){const[a,r]=e.useState(Ts),n=e.useCallback((async()=>{r((e=>e.isLoading?{...e,loading:{...e.loading,onAuthUserChanged:!0}}:e));try{const e=await Ps.getSession();if(!e)return void r({...Ts,isLoading:!1,loading:{...Ms,onAuthUserChanged:!1}});const t=await Ps.getCurrentUser();r({...Ts,user:t,session:e,isAuthenticated:!!t,isLoading:!1,loading:{...Ms,onAuthUserChanged:!1}})}catch(e){r({...Ts,error:e instanceof Error?e.message:String(e),isLoading:!1,loading:{...Ms,onAuthUserChanged:!1}})}}),[]);e.useEffect((()=>{const{data:{subscription:e}}=Es.auth.onAuthStateChange(((e,t)=>{r((e=>JSON.stringify(t)===JSON.stringify(e.session)?e:{...e,session:t,isLoading:!0,loading:{...e.loading,onAuthUserChanged:!0}}))}));return()=>{e.unsubscribe()}}),[]),e.useEffect((()=>{a.isLoading&&n()}),[a.isLoading,n]);const i=e.useCallback((async e=>{r((e=>({...e,loading:{...e.loading,signIn:!0}})));try{const t=await Ps.signInWithEmail(e);return t.error?(r((e=>({...e,error:t.error,loading:{...e.loading,signIn:!1}}))),{success:!1,error:t.error}):(r((e=>({...e,isLoading:!0,loading:{...e.loading,signIn:!1,onAuthUserChanged:!0}}))),{success:!0})}catch(t){const e=t instanceof Error?t.message:"Erro ao fazer login";return r((t=>({...t,error:e,loading:{...t.loading,signIn:!1}}))),{success:!1,error:e}}}),[]),o=e.useCallback((async e=>{r((e=>({...e,loading:{...e.loading,signUp:!0}})));try{const t=await Ps.signUpWithEmail(e);return t.error?(r((e=>({...e,error:t.error,loading:{...e.loading,signUp:!1}}))),{success:!1,error:t.error}):(r((e=>({...e,isLoading:!0,loading:{...e.loading,signUp:!1,onAuthUserChanged:!0}}))),{success:!0})}catch(t){const e=t instanceof Error?t.message:"Erro ao criar conta";return r((t=>({...t,error:e,loading:{...t.loading,signUp:!1}}))),{success:!1,error:e}}}),[]),l=e.useCallback((async()=>{r((e=>({...e,loading:{...e.loading,signOut:!0}})));try{await Ps.signOut(),r({...Ts,isLoading:!1,loading:{...Ms,onAuthUserChanged:!1}}),"undefined"!=typeof window&&(window.location.href="/auth?auth=logout")}catch(e){r((t=>({...t,error:e instanceof Error?e.message:String(e),loading:{...t.loading,signOut:!1}})))}}),[]),c=e.useCallback((async e=>{r((e=>({...e,loading:{...e.loading,updateProfile:!0}})));try{const t=await Ps.updateProfile(e);return t.error?(r((e=>({...e,error:t.error,loading:{...e.loading,updateProfile:!1}}))),{success:!1,error:t.error}):(r((e=>({...e,isLoading:!0,loading:{...e.loading,updateProfile:!1,onAuthUserChanged:!0}}))),{success:!0})}catch(t){const e=t instanceof Error?t.message:"Erro ao atualizar perfil";return r((t=>({...t,error:e,loading:{...t.loading,updateProfile:!1}}))),{success:!1,error:e}}}),[]),d=e.useMemo((()=>({...a,signInWithEmail:i,signUpWithEmail:o,signOut:l,updateProfile:c})),[a,i,o,l,c]);return t.jsx(Ns.Provider,{value:d,children:s})}function Ds(){const[t,s]=e.useState((()=>{if("undefined"==typeof window)return"dark";try{return localStorage.getItem("theme")||"dark"}catch{return"dark"}})),[a,r]=e.useState("dark");e.useEffect((()=>{if("undefined"==typeof window)return;const e=window.document.documentElement,s=t=>{const s="system"===t?(()=>{try{return window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"}catch{return"dark"}})():t;r(s),e.classList.remove("light","dark"),e.classList.add(s)};if(s(t),"system"===t)try{const e=window.matchMedia("(prefers-color-scheme: dark)"),a=()=>s(t);return e.addEventListener?(e.addEventListener("change",a),()=>e.removeEventListener("change",a)):(e.addListener(a),()=>e.removeListener(a))}catch{return}}),[t]);return{theme:t,setTheme:e=>{if(s(e),"undefined"!=typeof window)try{localStorage.setItem("theme",e)}catch{}},resolvedTheme:a}}function Rs({children:e}){return t.jsx(t.Fragment,{children:e})}function Ls(){return e.useEffect((()=>{}),[]),Ds(),null}function $s(){return t.jsx("div",{className:"min-h-screen w-full flex items-center justify-center bg-background",children:t.jsxs("div",{className:"text-center",children:[t.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-primary mx-auto mb-4"}),t.jsx("p",{className:"text-muted-foreground",children:"Carregando página..."})]})})}const Is=s({component:function(){return t.jsxs("div",{className:"font-inter min-h-screen w-full",children:[t.jsx(Ls,{}),t.jsx(y,{richColors:!0,position:"top-right"}),t.jsx(qs,{children:t.jsxs(Rs,{children:[t.jsx(e.Suspense,{fallback:t.jsx($s,{}),children:t.jsx(a,{})}),!1]})})]})}});const Fs=r("/_public")({component:function(){return t.jsx("div",{className:"flex min-h-screen w-full flex-col",children:t.jsx("main",{className:"flex-1 w-full",children:t.jsx(a,{})})})}});const Vs=()=>e.useContext(Ns),Os=()=>t.jsx("div",{className:"flex items-center justify-center min-h-screen w-full",children:t.jsxs("div",{className:"flex flex-col items-center gap-2",children:[t.jsx(T,{className:"h-8 w-8 animate-spin text-primary"}),t.jsx("p",{className:"text-sm text-muted-foreground",children:"Carregando..."})]})});function Bs({children:s}){const{loading:a}=Vs(),[r,n]=e.useState(!1),i=e.useRef(!1),o=e.useRef(null);return e.useEffect((()=>{if("undefined"!=typeof window&&!i.current)return i.current=!0,r||(a.onAuthUserChanged?o.current=setTimeout((()=>{n(!0)}),5e3):n(!0)),()=>{o.current&&clearTimeout(o.current)}}),[a.onAuthUserChanged,r]),e.useEffect((()=>{a.onAuthUserChanged||r||(n(!0),o.current&&(clearTimeout(o.current),o.current=null))}),[a.onAuthUserChanged,r]),r?s:t.jsx(Os,{})}function Us({children:s}){const{user:a,loading:r}=Vs(),o=n(),l=i(),c=e.useRef(!1),d=e.useRef(null);return e.useLayoutEffect((()=>{const e=null!==a;d.current!==e&&(d.current=e,c.current=!1)}),[a]),e.useEffect((()=>{if("undefined"!=typeof window&&!r.onAuthUserChanged&&null===a&&!c.current){if(c.current=!0,l.pathname.startsWith("/auth"))return;const t=`${l.pathname}${l.search||""}`;if(t&&"/auth"!==t)try{const e=encodeURIComponent("string"==typeof t?t:"/game");o({to:"/auth",search:{auth:e},replace:!0})}catch(e){o({to:"/auth",search:{auth:encodeURIComponent("/game")},replace:!0})}else o({to:"/auth",search:{auth:""},replace:!0})}}),[a,r.onAuthUserChanged,l.pathname,l.search]),r.onAuthUserChanged||null==a?t.jsx(Os,{}):s}function zs({children:e}){return t.jsx(Bs,{children:t.jsx(Us,{children:e})})}function Gs({children:s}){const{user:a}=Vs(),r=n(),i=e.useRef(!1),o=e.useRef(null);return e.useLayoutEffect((()=>{if(!a)return o.current=null,void(i.current=!1);const e=!!a.email_confirmed_at;o.current!==e&&(o.current=e,i.current=!1)}),[a?.email_confirmed_at]),e.useEffect((()=>{"undefined"!=typeof window&&a&&(a.email_confirmed_at||i.current||(i.current=!0,r({to:"/auth/verify-email",search:{auth:"true"},replace:!0})))}),[a,r]),a&&a.email_confirmed_at?t.jsx(t.Fragment,{children:s}):null}function Hs(...e){return q(D(e))}const Xs=L("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground shadow hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground shadow-sm hover:bg-destructive/90",outline:"border border-input bg-background shadow-sm hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground shadow-sm hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2",sm:"h-8 rounded-md px-3 text-xs",lg:"h-10 rounded-md px-8",icon:"h-9 w-9"}},defaultVariants:{variant:"default",size:"default"}}),Ws=e.forwardRef((({className:e,variant:s,size:a,asChild:r=!1,...n},i)=>{const o=r?R:"button";return t.jsx(o,{className:Hs(Xs({variant:s,size:a,className:e})),ref:i,...n})}));function Ys(){return t.jsx("footer",{className:"bg-gradient-to-t from-background/90 to-background/70 border-t border-border",children:t.jsxs("section",{className:"py-8 md:py-12",children:[t.jsxs("div",{className:"max-w-5xl mx-auto p-6 sm:p-8 grid gap-12 md:grid-cols-[1.5fr_0.5fr_0.5fr]",children:[t.jsxs("div",{className:"not-prose flex flex-col gap-6",children:[t.jsxs(o,{to:"/",className:"group",children:[t.jsx("h3",{className:"sr-only",children:"Tower Trials"}),t.jsx("h1",{className:"text-2xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-purple-400 to-pink-600 group-hover:from-purple-500 group-hover:to-pink-700 transition-colors",children:"Tower Trials"})]}),t.jsx("p",{className:"text-muted-foreground",children:"Enfrente desafios, suba a torre e torne-se uma lenda neste RPG roguelike épico."})]}),t.jsxs("div",{className:"flex flex-col gap-3",children:[t.jsx("h5",{className:"font-bold text-primary",children:"Links"}),t.jsx(o,{to:"/game/ranking",className:"text-muted-foreground hover:text-primary transition-colors",children:"Ranking Global"}),t.jsx(o,{to:"/game/guide",className:"text-muted-foreground hover:text-primary transition-colors",children:"Guia do Jogo"})]}),t.jsx("div",{className:"flex flex-col gap-3",children:t.jsx("h5",{className:"font-bold text-primary",children:"Legal"})})]}),t.jsxs("div",{className:"max-w-5xl mx-auto p-6 sm:p-8 not-prose mt-8 flex flex-col justify-between gap-6 border-t border-border pt-8 md:flex-row md:items-center md:gap-2",children:[t.jsxs("div",{className:"flex gap-2",children:[t.jsx(Ws,{variant:"ghost",size:"icon",className:"text-muted-foreground hover:text-primary transition-colors",children:t.jsx($,{className:"h-5 w-5"})}),t.jsx(Ws,{variant:"ghost",size:"icon",className:"text-muted-foreground hover:text-primary transition-colors",children:t.jsx(I,{className:"h-5 w-5"})})]}),t.jsx("p",{className:"text-muted-foreground",children:"© 2024 Tower Trials. Todos os direitos reservados."})]})]})})}function Ks(){const[t,s]=e.useState(null),[a,r]=e.useState(!1),[n,i]=e.useState(!1);e.useEffect((()=>{const e=e=>{e.preventDefault(),s(e),r(!0)},t=()=>{i(!0),r(!1),s(null)};return window.addEventListener("beforeinstallprompt",e),window.addEventListener("appinstalled",t),(()=>{const e=window.matchMedia("(display-mode: standalone)").matches,t=window.matchMedia("(display-mode: fullscreen)").matches,s=window.matchMedia("(display-mode: minimal-ui)").matches;(e||t||s)&&i(!0)})(),()=>{window.removeEventListener("beforeinstallprompt",e),window.removeEventListener("appinstalled",t)}}),[]);return{installPWA:async()=>{if(!t)return!1;try{t.prompt();const{outcome:e}=await t.userChoice;return"accepted"===e&&(s(null),r(!1),!0)}catch(e){return!1}},isInstallable:a,isInstalled:n,canInstall:a&&!n}}function Js(){const{installPWA:e,canInstall:s,isInstalled:a}=Ks();return a?t.jsxs("div",{className:"flex items-center gap-2 text-sm text-green-600 dark:text-green-400",children:[t.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full animate-pulse"}),"App Instalado"]}):s?t.jsxs(Ws,{onClick:async()=>{await e()},variant:"outline",size:"sm",className:"flex items-center gap-2 bg-blue-50 hover:bg-blue-100 dark:bg-blue-950 dark:hover:bg-blue-900 border-blue-200 dark:border-blue-800",children:[t.jsx(F,{className:"w-4 h-4"}),"Instalar App"]}):null}Ws.displayName="Button";const Qs=H,Zs=X,ea=O,ta=e.forwardRef((({className:e,...s},a)=>t.jsx(V,{className:Hs("fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",e),...s,ref:a})));ta.displayName=V.displayName;const sa=L("fixed z-50 gap-4 bg-background p-6 shadow-lg transition ease-in-out data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:duration-300 data-[state=open]:duration-500",{variants:{side:{top:"inset-x-0 top-0 border-b data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top",bottom:"inset-x-0 bottom-0 border-t data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom",left:"inset-y-0 left-0 h-full w-3/4 border-r data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left sm:max-w-sm",right:"inset-y-0 right-0 h-full w-3/4 border-l data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right sm:max-w-sm"}},defaultVariants:{side:"right"}}),aa=e.forwardRef((({side:e="right",className:s,children:a,...r},n)=>t.jsxs(ea,{children:[t.jsx(ta,{}),t.jsxs(B,{ref:n,className:Hs(sa({side:e}),s),...r,children:[a,t.jsxs(U,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-secondary",children:[t.jsx(z,{className:"h-4 w-4"}),t.jsx("span",{className:"sr-only",children:"Close"})]})]})]})));aa.displayName=B.displayName;const ra=({className:e,...s})=>t.jsx("div",{className:Hs("flex flex-col space-y-2 text-center sm:text-left",e),...s});ra.displayName="SheetHeader";const na=e.forwardRef((({className:e,...s},a)=>t.jsx(G,{ref:a,className:Hs("text-lg font-semibold text-foreground",e),...s})));na.displayName=G.displayName;function ia({userName:e}){const s=i(),a=n(),r=s.pathname,{user:o}=Vs(),{resolvedTheme:l,setTheme:c}=Ds(),d=r.startsWith("/game/play/"),m=((e,t)=>{const s=[...t?[]:[{href:"/game",icon:Z,label:"Jogar"}],{href:"/game/ranking",icon:ee,label:"Ranking"},{href:"/game/guide",icon:te,label:"Guia"}];return"ADMIN"===e?[...s,{href:"/users",icon:W,label:"Admin"}]:s})(o?.role,d),u=e=>{a({to:e})};return t.jsxs("header",{className:"flex w-full flex-col bg-gradient-to-b from-background/90 to-background/70 border-b border-border",children:[t.jsxs("div",{className:"flex w-full items-center justify-between px-4 py-3",children:[t.jsx("button",{onClick:()=>u("/game"),className:"group cursor-pointer",children:t.jsx("h1",{className:"text-xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-purple-400 to-pink-600 group-hover:from-purple-500 group-hover:to-pink-700 transition-colors",children:"Tower Trials"})}),t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx(Js,{}),t.jsxs("div",{className:"hidden sm:flex items-center gap-2 text-muted-foreground",children:[t.jsx(W,{className:"h-4 w-4"}),t.jsx("span",{className:"text-sm",children:e})]}),t.jsx(Ws,{variant:"ghost",size:"icon",onClick:()=>c("dark"===l?"light":"dark"),className:"text-muted-foreground hover:text-primary transition-colors",title:"dark"===l?"Modo claro":"Modo escuro",children:"dark"===l?t.jsx(Y,{className:"h-5 w-5"}):t.jsx(K,{className:"h-5 w-5"})}),t.jsx(Ws,{variant:"ghost",size:"icon",className:"text-muted-foreground hover:text-primary transition-colors",onClick:()=>u("/profile"),children:t.jsx(W,{className:"h-5 w-5"})}),t.jsx(Ws,{variant:"ghost",size:"icon",className:"text-muted-foreground hover:text-primary transition-colors",onClick:()=>u("/logout"),children:t.jsx(J,{className:"h-5 w-5"})}),t.jsxs(Qs,{children:[t.jsx(Zs,{asChild:!0,children:t.jsx(Ws,{variant:"ghost",size:"icon",className:"text-muted-foreground hover:text-primary transition-colors lg:hidden",children:t.jsx(Q,{className:"h-5 w-5"})})}),t.jsxs(aa,{side:"left",className:"w-[300px] bg-background border-r border-border p-0",children:[t.jsx(ra,{className:"border-b border-border p-4",children:t.jsx(na,{children:"Menu Principal"})}),t.jsxs("div",{className:"flex flex-col py-2",children:[m.map((e=>{const s=e.icon,a=r===e.href;return t.jsxs("button",{onClick:()=>u(e.href),className:"flex items-center gap-3 px-4 py-3 transition-colors hover:bg-accent text-left cursor-pointer "+(a?"bg-accent text-primary":"text-muted-foreground"),children:[t.jsx(s,{className:"h-5 w-5"}),t.jsx("span",{className:"text-sm font-medium",children:e.label})]},e.href)})),t.jsx("button",{onClick:()=>c("dark"===l?"light":"dark"),className:"flex items-center gap-3 px-4 py-3 transition-colors hover:bg-accent text-muted-foreground text-left cursor-pointer",children:"dark"===l?t.jsxs(t.Fragment,{children:[t.jsx(Y,{className:"h-5 w-5"}),t.jsx("span",{className:"text-sm font-medium",children:"Modo Claro"})]}):t.jsxs(t.Fragment,{children:[t.jsx(K,{className:"h-5 w-5"}),t.jsx("span",{className:"text-sm font-medium",children:"Modo Escuro"})]})})]})]})]})]})]}),t.jsx("nav",{className:"hidden border-t border-border lg:block",children:t.jsx("div",{className:"flex items-center justify-center gap-1 px-2",children:m.map((e=>{const s=e.icon,a=r===e.href;return t.jsxs("button",{onClick:()=>u(e.href),className:"flex items-center gap-2 rounded-md px-4 py-3 transition-colors hover:bg-accent cursor-pointer "+(a?"text-primary":"text-muted-foreground"),children:[t.jsx(s,{className:"h-4 w-4"}),t.jsx("span",{className:"text-sm font-medium",children:e.label})]},e.href)}))})})]})}const oa=r("/_authenticated")({component:function(){return t.jsx(zs,{children:t.jsx(Gs,{children:t.jsx(la,{})})})}});function la(){const{user:e}=Vs();return i().pathname.startsWith("/game")?t.jsx("div",{className:"flex min-h-screen w-full flex-col bg-transparent",children:t.jsx("main",{className:"flex-1 w-full p-0 m-0 min-h-screen",children:t.jsx(a,{})})}):t.jsxs("div",{className:"flex min-h-screen w-full flex-col",children:[t.jsx(ia,{userName:e?.username||"Usuário"}),t.jsx("main",{className:"flex-1 w-full",children:t.jsx(a,{})}),t.jsx(Ys,{})]})}function ca(){const{user:s,loading:a}=Vs(),r=n(),i=e.useRef(!1);return e.useEffect((()=>{a.onAuthUserChanged||i.current||(i.current=!0,s?r({to:"/game",replace:!0}):s||r({to:"/home",replace:!0}))}),[s,a.onAuthUserChanged,r]),a.onAuthUserChanged?t.jsx(Os,{}):null}function da(){return t.jsx(Bs,{children:t.jsx(ca,{})})}const ma=r("/")({component:function(){return t.jsx(da,{})}});const ua=r("/_public/logout")({component:function(){const{signOut:s,user:a}=Vs(),r=n();return e.useEffect((()=>{(async()=>{a&&(j.info("Encerrando sessão..."),await s()),setTimeout((()=>{r({to:"/auth",search:{auth:"true"}})}),1e3)})()}),[s,r,a]),t.jsx("div",{className:"flex min-h-screen items-center justify-center",children:t.jsxs("div",{className:"text-center space-y-4",children:[t.jsx(Os,{}),t.jsx("p",{className:"text-muted-foreground",children:"Encerrando sessão..."})]})})}});function ha({children:e}){const{loading:s}=Vs();return s.onAuthUserChanged?t.jsx(Os,{}):e}function pa({children:e}){return t.jsx(Bs,{children:t.jsx(ha,{children:e})})}const xa=r("/_public/home")({component:function(){return t.jsx(pa,{children:t.jsx(fa,{})})}});function fa(){return t.jsxs("div",{className:"min-h-screen w-full bg-gradient-to-b from-slate-950 via-slate-900 to-slate-800 text-white",children:[t.jsxs("section",{className:"relative overflow-hidden pt-20 pb-32 px-4",children:[t.jsx("div",{className:"absolute inset-0 bg-gradient-to-b from-amber-900/20 to-transparent"}),t.jsxs("div",{className:"relative max-w-6xl mx-auto text-center",children:[t.jsx("h1",{className:"text-6xl font-black mb-6 bg-gradient-to-r from-amber-400 via-orange-400 to-red-500 bg-clip-text text-transparent",children:"Tower Trials"}),t.jsx("p",{className:"text-xl text-slate-300 mb-8 max-w-2xl mx-auto",children:"Um jogo roguelike desafiador onde cada morte importa. Ascenda pela torre, enfrente monstros mortais e conquiste a glória eternal."}),t.jsxs("div",{className:"flex gap-4 justify-center",children:[t.jsx("a",{href:"/auth",className:"px-8 py-3 bg-gradient-to-r from-amber-500 to-orange-600 rounded-lg font-bold hover:shadow-lg hover:shadow-amber-500/50 transition",children:"Começar Aventura"}),t.jsx("a",{href:"/guide",className:"px-8 py-3 border-2 border-amber-500 rounded-lg font-bold hover:bg-amber-900/30 transition",children:"Ver Guia"})]})]})]}),t.jsx("section",{className:"py-20 px-4 bg-slate-900/50",children:t.jsxs("div",{className:"max-w-6xl mx-auto",children:[t.jsx("h2",{className:"text-4xl font-black text-center mb-16 text-amber-400",children:"Características"}),t.jsxs("div",{className:"grid md:grid-cols-3 gap-8",children:[t.jsxs("div",{className:"bg-slate-800/50 border border-amber-900/50 rounded-lg p-8 hover:border-amber-500/50 transition",children:[t.jsx(se,{className:"w-12 h-12 text-amber-400 mb-4"}),t.jsx("h3",{className:"text-xl font-bold mb-3",children:"Combat Desafiador"}),t.jsx("p",{className:"text-slate-300",children:"Sistema de combate tático com múltiplas habilidades, estratégias e inimigos únicos em cada andar."})]}),t.jsxs("div",{className:"bg-slate-800/50 border border-amber-900/50 rounded-lg p-8 hover:border-amber-500/50 transition",children:[t.jsx(ae,{className:"w-12 h-12 text-amber-400 mb-4"}),t.jsx("h3",{className:"text-xl font-bold mb-3",children:"Permadeath"}),t.jsx("p",{className:"text-slate-300",children:"Cada morte é permanente. Prepare-se, escolha suas estratégias e enfrente as consequências."})]}),t.jsxs("div",{className:"bg-slate-800/50 border border-amber-900/50 rounded-lg p-8 hover:border-amber-500/50 transition",children:[t.jsx(re,{className:"w-12 h-12 text-amber-400 mb-4"}),t.jsx("h3",{className:"text-xl font-bold mb-3",children:"Progressão Dinâmica"}),t.jsx("p",{className:"text-slate-300",children:"Múltiplas personagens, classes, habilidades e equipamentos para explorar diferentes estratégias."})]})]})]})}),t.jsx("section",{className:"py-20 px-4",children:t.jsxs("div",{className:"max-w-6xl mx-auto",children:[t.jsx("h2",{className:"text-4xl font-black text-center mb-16 text-amber-400",children:"Como Jogar"}),t.jsxs("div",{className:"space-y-12",children:[t.jsxs("div",{className:"flex gap-8 items-start",children:[t.jsx("div",{className:"text-4xl font-black text-amber-500",children:"01"}),t.jsxs("div",{children:[t.jsx("h3",{className:"text-2xl font-bold mb-2",children:"Crie Seu Personagem"}),t.jsx("p",{className:"text-slate-300",children:"Escolha entre diferentes classes com habilidades únicas. Cada personagem tem seu próprio caminho e estilo de jogo."})]})]}),t.jsxs("div",{className:"flex gap-8 items-start",children:[t.jsx("div",{className:"text-4xl font-black text-amber-500",children:"02"}),t.jsxs("div",{children:[t.jsx("h3",{className:"text-2xl font-bold mb-2",children:"Suba a Torre"}),t.jsx("p",{className:"text-slate-300",children:"Enfrente andar após andar, cada um com inimigos mais poderosos e recompensas valiosas. Adapte sua estratégia."})]})]}),t.jsxs("div",{className:"flex gap-8 items-start",children:[t.jsx("div",{className:"text-4xl font-black text-amber-500",children:"03"}),t.jsxs("div",{children:[t.jsx("h3",{className:"text-2xl font-bold mb-2",children:"Colete Equipamentos"}),t.jsx("p",{className:"text-slate-300",children:"Armas, armaduras e itens especiais deixados pelos inimigos vencidos. Planeje suas compras na loja com cuidado."})]})]}),t.jsxs("div",{className:"flex gap-8 items-start",children:[t.jsx("div",{className:"text-4xl font-black text-amber-500",children:"04"}),t.jsxs("div",{children:[t.jsx("h3",{className:"text-2xl font-bold mb-2",children:"Enfrente o Destino"}),t.jsx("p",{className:"text-slate-300",children:"Alcance o topo, derrote o boss final e inscreva seu nome na história. Ou morra tentando."})]})]})]})]})}),t.jsx("section",{className:"py-20 px-4 bg-slate-900/50",children:t.jsxs("div",{className:"max-w-6xl mx-auto",children:[t.jsx("h2",{className:"text-4xl font-black text-center mb-16 text-amber-400",children:"Sistema de Progressão"}),t.jsxs("div",{className:"grid md:grid-cols-2 gap-8",children:[t.jsxs("div",{className:"bg-slate-800/50 rounded-lg p-8 border border-amber-900/50",children:[t.jsx("h3",{className:"text-xl font-bold text-amber-400 mb-4",children:"Atributos"}),t.jsx("p",{className:"text-slate-300 mb-4",children:"Aumente vida, mana, força, inteligência e defesa conforme você progride. Cada escolha afeta seu estilo de jogo."}),t.jsxs("ul",{className:"text-slate-300 space-y-2",children:[t.jsx("li",{children:"• Vida: Resistência ao dano"}),t.jsx("li",{children:"• Mana: Combustível para habilidades"}),t.jsx("li",{children:"• Força: Dano físico aumentado"}),t.jsx("li",{children:"• Inteligência: Dano mágico aumentado"})]})]}),t.jsxs("div",{className:"bg-slate-800/50 rounded-lg p-8 border border-amber-900/50",children:[t.jsx("h3",{className:"text-xl font-bold text-amber-400 mb-4",children:"Habilidades"}),t.jsx("p",{className:"text-slate-300 mb-4",children:"Aprenda novas habilidades e aperfeiçoe as existentes. Cada classe tem seu árbol de habilidades único."}),t.jsxs("ul",{className:"text-slate-300 space-y-2",children:[t.jsx("li",{children:"• Ataques físicos potentes"}),t.jsx("li",{children:"• Magias devastadoras"}),t.jsx("li",{children:"• Suportes defensivos"}),t.jsx("li",{children:"• Utilitários estratégicos"})]})]})]})]})}),t.jsx("section",{className:"py-20 px-4",children:t.jsxs("div",{className:"max-w-6xl mx-auto",children:[t.jsx("h2",{className:"text-4xl font-black text-center mb-16 text-amber-400",children:"Sistema Econômico"}),t.jsx("div",{className:"bg-gradient-to-r from-amber-900/20 to-orange-900/20 border border-amber-900/50 rounded-lg p-12",children:t.jsxs("div",{className:"grid md:grid-cols-3 gap-8 text-center",children:[t.jsxs("div",{children:[t.jsx("div",{className:"text-3xl font-black text-amber-400 mb-2",children:"Ouro"}),t.jsx("p",{className:"text-slate-300",children:"Moeda principal. Obtenha dos inimigos, venda itens e compre equipamentos e consumíveis."})]}),t.jsxs("div",{className:"border-l border-r border-amber-900/50",children:[t.jsx("div",{className:"text-3xl font-black text-amber-400 mb-2",children:"Drops"}),t.jsx("p",{className:"text-slate-300",children:"Itens raros deixados por inimigos. Equipamentos, cristais mágicos e materiais valiosos."})]}),t.jsxs("div",{children:[t.jsx("div",{className:"text-3xl font-black text-amber-400 mb-2",children:"Loja"}),t.jsx("p",{className:"text-slate-300",children:"Compre consumíveis para heal, potências e outros itens. Use sua moeda com sabedoria."})]})]})})]})}),t.jsx("section",{className:"py-32 px-4 bg-gradient-to-b from-transparent to-amber-900/20",children:t.jsxs("div",{className:"max-w-4xl mx-auto text-center",children:[t.jsx("h2",{className:"text-5xl font-black mb-6 text-amber-400",children:"Pronto para a Aventura?"}),t.jsx("p",{className:"text-xl text-slate-300 mb-8",children:"A Tower Trials aguarda. Você tem o que é preciso para chegar ao topo?"}),t.jsx("a",{href:"/auth",className:"inline-block px-12 py-4 bg-gradient-to-r from-amber-500 to-orange-600 rounded-lg font-bold text-lg hover:shadow-lg hover:shadow-amber-500/50 transition",children:"Começar Agora"})]})}),t.jsx("footer",{className:"bg-slate-950 border-t border-slate-800 py-8 px-4",children:t.jsx("div",{className:"max-w-6xl mx-auto text-center text-slate-400 text-sm",children:t.jsx("p",{children:"© 2024 Tower Trials. Todos os direitos reservados."})})})]})}function ga(e,t,s){function a(s,a){var r;Object.defineProperty(s,"_zod",{value:s._zod??{},enumerable:!1}),(r=s._zod).traits??(r.traits=new Set),s._zod.traits.add(e),t(s,a);for(const e in i.prototype)e in s||Object.defineProperty(s,e,{value:i.prototype[e].bind(s)});s._zod.constr=i,s._zod.def=a}const r=s?.Parent??Object;class n extends r{}function i(e){var t;const r=s?.Parent?new n:this;a(r,e),(t=r._zod).deferred??(t.deferred=[]);for(const s of r._zod.deferred)s();return r}return Object.defineProperty(n,"name",{value:e}),Object.defineProperty(i,"init",{value:a}),Object.defineProperty(i,Symbol.hasInstance,{value:t=>!!(s?.Parent&&t instanceof s.Parent)||t?._zod?.traits?.has(e)}),Object.defineProperty(i,"name",{value:e}),i}class ba extends Error{constructor(){super("Encountered Promise during synchronous parse. Use .parseAsync() instead.")}}const va={};function ya(e){return va}function ja(e,t){return"bigint"==typeof t?t.toString():t}function Na(e){return"string"==typeof e?e:e?.message}function wa(e,t,s){const a={...e,path:e.path??[]};if(!e.message){const r=Na(e.inst?._zod.def?.error?.(e))??Na(t?.error?.(e))??Na(s.customError?.(e))??Na(s.localeError?.(e))??"Invalid input";a.message=r}return delete a.inst,delete a.continue,t?.reportInput||delete a.input,a}const _a=(e,t)=>{e.name="$ZodError",Object.defineProperty(e,"_zod",{value:e._zod,enumerable:!1}),Object.defineProperty(e,"issues",{value:t,enumerable:!1}),Object.defineProperty(e,"message",{get:()=>JSON.stringify(t,ja,2),enumerable:!0})},Ca=ga("$ZodError",_a),Sa=ga("$ZodError",_a,{Parent:Error}),Ea=(e=>(t,s,a,r)=>{const n=a?Object.assign(a,{async:!1}):{async:!1},i=t._zod.run({value:s,issues:[]},n);if(i instanceof Promise)throw new ba;if(i.issues.length){const t=new(r?.Err??e)(i.issues.map((e=>wa(e,n,ya()))));throw Error.captureStackTrace(t,r?.callee),t}return i.value})(Sa),ka=(e=>async(t,s,a,r)=>{const n=a?Object.assign(a,{async:!0}):{async:!0};let i=t._zod.run({value:s,issues:[]},n);if(i instanceof Promise&&(i=await i),i.issues.length){const t=new(r?.Err??e)(i.issues.map((e=>wa(e,n,ya()))));throw Error.captureStackTrace(t,r?.callee),t}return i.value})(Sa);function Aa(e,t){try{var s=e()}catch(e){return t(e)}return s&&s.then?s.then(void 0,t):s}function Pa(e,t){for(var s={};e.length;){var a=e[0],r=a.code,n=a.message,i=a.path.join(".");if(!s[i])if("unionErrors"in a){var o=a.unionErrors[0].errors[0];s[i]={message:o.message,type:o.code}}else s[i]={message:n,type:r};if("unionErrors"in a&&a.unionErrors.forEach((function(t){return t.errors.forEach((function(t){return e.push(t)}))})),t){var l=s[i].types,c=l&&l[a.code];s[i]=_(i,t,s,r,c?[].concat(c,a.message):a.message)}e.shift()}return s}function Ma(e,t){for(var s={};e.length;){var a=e[0],r=a.code,n=a.message,i=a.path.join(".");if(!s[i])if("invalid_union"===a.code){var o=a.errors[0][0];s[i]={message:o.message,type:o.code}}else s[i]={message:n,type:r};if("invalid_union"===a.code&&a.errors.forEach((function(t){return t.forEach((function(t){return e.push(t)}))})),t){var l=s[i].types,c=l&&l[a.code];s[i]=_(i,t,s,r,c?[].concat(c,a.message):a.message)}e.shift()}return s}function Ta(e,t,s){if(void 0===s&&(s={}),"_def"in(a=e)&&"object"==typeof a._def&&"typeName"in a._def)return function(r,n,i){try{return Promise.resolve(Aa((function(){return Promise.resolve(e["sync"===s.mode?"parse":"parseAsync"](r,t)).then((function(e){return i.shouldUseNativeValidation&&N({},i),{errors:{},values:s.raw?Object.assign({},r):e}}))}),(function(e){if(function(e){return Array.isArray(null==e?void 0:e.issues)}(e))return{values:{},errors:w(Pa(e.errors,!i.shouldUseNativeValidation&&"all"===i.criteriaMode),i)};throw e})))}catch(a){return Promise.reject(a)}};var a;if(function(e){return"_zod"in e&&"object"==typeof e._zod}(e))return function(r,n,i){try{return Promise.resolve(Aa((function(){return Promise.resolve(("sync"===s.mode?Ea:ka)(e,r,t)).then((function(e){return i.shouldUseNativeValidation&&N({},i),{errors:{},values:s.raw?Object.assign({},r):e}}))}),(function(e){if(function(e){return e instanceof Ca}(e))return{values:{},errors:w(Ma(e.issues,!i.shouldUseNativeValidation&&"all"===i.criteriaMode),i)};throw e})))}catch(a){return Promise.reject(a)}};throw new Error("Invalid input: not a Zod schema")}const qa=e.forwardRef((({className:e,type:s,...a},r)=>t.jsx("input",{type:s,className:Hs("flex h-9 w-full rounded-md border border-neutral-200 bg-white px-3 py-1 text-sm shadow-sm transition-colors file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-neutral-500 focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-neutral-950 disabled:cursor-not-allowed disabled:opacity-50 dark:border-neutral-800 dark:bg-neutral-950 dark:placeholder:text-neutral-400 dark:focus-visible:ring-neutral-300",e),ref:r,...a})));qa.displayName="Input";var Da=e.forwardRef(((e,s)=>t.jsx(ne.label,{...e,ref:s,onMouseDown:t=>{t.target.closest("button, input, select, textarea")||(e.onMouseDown?.(t),!t.defaultPrevented&&t.detail>1&&t.preventDefault())}})));Da.displayName="Label";var Ra=Da;const La=L("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),$a=e.forwardRef((({className:e,...s},a)=>t.jsx(Ra,{ref:a,className:Hs(La(),e),...s})));$a.displayName=Ra.displayName;const Ia=S,Fa=e.createContext({}),Va=({...e})=>t.jsx(Fa.Provider,{value:{name:e.name},children:t.jsx(E,{...e})}),Oa=()=>{const t=e.useContext(Fa),s=e.useContext(Ba),{getFieldState:a,formState:r}=C(),n=a(t.name,r);if(!t)throw new Error("useFormField should be used within <FormField>");const{id:i}=s;return{id:i,name:t.name,formItemId:`${i}-form-item`,formDescriptionId:`${i}-form-item-description`,formMessageId:`${i}-form-item-message`,...n}},Ba=e.createContext({}),Ua=e.forwardRef((({className:s,...a},r)=>{const n=e.useId();return t.jsx(Ba.Provider,{value:{id:n},children:t.jsx("div",{ref:r,className:Hs("space-y-2",s),...a})})}));Ua.displayName="FormItem";const za=e.forwardRef((({className:e,...s},a)=>{const{error:r,formItemId:n}=Oa();return t.jsx($a,{ref:a,className:Hs(r&&"text-destructive",e),htmlFor:n,...s})}));za.displayName="FormLabel";const Ga=e.forwardRef((({...e},s)=>{const{error:a,formItemId:r,formDescriptionId:n,formMessageId:i}=Oa();return t.jsx(R,{ref:s,id:r,"aria-describedby":a?`${n} ${i}`:`${n}`,"aria-invalid":!!a,...e})}));Ga.displayName="FormControl";e.forwardRef((({className:e,...s},a)=>{const{formDescriptionId:r}=Oa();return t.jsx("p",{ref:a,id:r,className:Hs("text-[0.8rem] text-muted-foreground",e),...s})})).displayName="FormDescription";const Ha=e.forwardRef((({className:e,children:s,...a},r)=>{const{error:n,formMessageId:i}=Oa(),o=n?String(n?.message??""):s;return o?t.jsx("p",{ref:r,id:i,className:Hs("text-[0.8rem] font-medium text-destructive",e),...a,children:o}):null}));function Xa({onSubmit:e,isLoading:s}){const a=k({resolver:Ta(vs),defaultValues:{email:"",password:""}});return t.jsx(Ia,{...a,children:t.jsxs("form",{onSubmit:a.handleSubmit(e),className:"space-y-4",children:[t.jsx(Va,{control:a.control,name:"email",render:({field:e})=>t.jsxs(Ua,{children:[t.jsx(za,{children:"Email"}),t.jsx(Ga,{children:t.jsx(qa,{type:"email",placeholder:"seu@email.com",...e})}),t.jsx(Ha,{})]})}),t.jsx(Va,{control:a.control,name:"password",render:({field:e})=>t.jsxs(Ua,{children:[t.jsx(za,{children:"Senha"}),t.jsx(Ga,{children:t.jsx(qa,{type:"password",placeholder:"••••••",...e})}),t.jsx(Ha,{})]})}),t.jsx(Ws,{type:"submit",className:"w-full",disabled:s,children:s?"Processando...":"Entrar"})]})})}function Wa({onSubmit:e,isLoading:s}){const a=k({resolver:Ta(ys),defaultValues:{email:"",password:"",confirmPassword:""}});return t.jsx(Ia,{...a,children:t.jsxs("form",{onSubmit:a.handleSubmit(e),className:"space-y-4",children:[t.jsx(Va,{control:a.control,name:"email",render:({field:e})=>t.jsxs(Ua,{children:[t.jsx(za,{children:"Email"}),t.jsx(Ga,{children:t.jsx(qa,{type:"email",placeholder:"seu@email.com",...e})}),t.jsx(Ha,{})]})}),t.jsx(Va,{control:a.control,name:"password",render:({field:e})=>t.jsxs(Ua,{children:[t.jsx(za,{children:"Senha"}),t.jsx(Ga,{children:t.jsx(qa,{type:"password",placeholder:"••••••",...e})}),t.jsx(Ha,{})]})}),t.jsx(Va,{control:a.control,name:"confirmPassword",render:({field:e})=>t.jsxs(Ua,{children:[t.jsx(za,{children:"Confirmar Senha"}),t.jsx(Ga,{children:t.jsx(qa,{type:"password",placeholder:"••••••",...e})}),t.jsx(Ha,{})]})}),t.jsx(Ws,{type:"submit",className:"w-full",disabled:s,children:s?"Processando...":"Criar Conta"})]})})}Ha.displayName="FormMessage";const Ya=e.createContext({});function Ka(t){const s=e.useRef(null);return null===s.current&&(s.current=t()),s.current}const Ja="undefined"!=typeof window,Qa=Ja?e.useLayoutEffect:e.useEffect,Za=e.createContext(null);function er(e,t){-1===e.indexOf(t)&&e.push(t)}function tr(e,t){const s=e.indexOf(t);s>-1&&e.splice(s,1)}const sr=(e,t,s)=>s>t?t:s<e?e:s;const ar={},rr=e=>/^-?(?:\d+(?:\.\d+)?|\.\d+)$/u.test(e);function nr(e){return"object"==typeof e&&null!==e}const ir=e=>/^0[^.\s]+$/u.test(e);function or(e){let t;return()=>(void 0===t&&(t=e()),t)}const lr=e=>e,cr=(e,t)=>s=>t(e(s)),dr=(...e)=>e.reduce(cr),mr=(e,t,s)=>{const a=t-e;return 0===a?1:(s-e)/a};class ur{constructor(){this.subscriptions=[]}add(e){return er(this.subscriptions,e),()=>tr(this.subscriptions,e)}notify(e,t,s){const a=this.subscriptions.length;if(a)if(1===a)this.subscriptions[0](e,t,s);else for(let r=0;r<a;r++){const a=this.subscriptions[r];a&&a(e,t,s)}}getSize(){return this.subscriptions.length}clear(){this.subscriptions.length=0}}const hr=e=>1e3*e,pr=e=>e/1e3;function xr(e,t){return t?e*(1e3/t):0}const fr=(e,t,s)=>(((1-3*s+3*t)*e+(3*s-6*t))*e+3*t)*e;function gr(e,t,s,a){if(e===t&&s===a)return lr;const r=t=>function(e,t,s,a,r){let n,i,o=0;do{i=t+(s-t)/2,n=fr(i,a,r)-e,n>0?s=i:t=i}while(Math.abs(n)>1e-7&&++o<12);return i}(t,0,1,e,s);return e=>0===e||1===e?e:fr(r(e),t,a)}const br=e=>t=>t<=.5?e(2*t)/2:(2-e(2*(1-t)))/2,vr=e=>t=>1-e(1-t),yr=gr(.33,1.53,.69,.99),jr=vr(yr),Nr=br(jr),wr=e=>(e*=2)<1?.5*jr(e):.5*(2-Math.pow(2,-10*(e-1))),_r=e=>1-Math.sin(Math.acos(e)),Cr=vr(_r),Sr=br(_r),Er=gr(.42,0,1,1),kr=gr(0,0,.58,1),Ar=gr(.42,0,.58,1),Pr=e=>Array.isArray(e)&&"number"==typeof e[0],Mr={linear:lr,easeIn:Er,easeInOut:Ar,easeOut:kr,circIn:_r,circInOut:Sr,circOut:Cr,backIn:jr,backInOut:Nr,backOut:yr,anticipate:wr},Tr=e=>{if(Pr(e)){e.length;const[t,s,a,r]=e;return gr(t,s,a,r)}return"string"==typeof e?Mr[e]:e},qr=["setup","read","resolveKeyframes","preUpdate","update","preRender","render","postRender"],Dr={value:null};function Rr(e,t){let s=!1,a=!0;const r={delta:0,timestamp:0,isProcessing:!1},n=()=>s=!0,i=qr.reduce(((e,s)=>(e[s]=function(e,t){let s=new Set,a=new Set,r=!1,n=!1;const i=new WeakSet;let o={delta:0,timestamp:0,isProcessing:!1},l=0;function c(t){i.has(t)&&(d.schedule(t),e()),l++,t(o)}const d={schedule:(e,t=!1,n=!1)=>{const o=n&&r?s:a;return t&&i.add(e),o.has(e)||o.add(e),e},cancel:e=>{a.delete(e),i.delete(e)},process:e=>{o=e,r?n=!0:(r=!0,[s,a]=[a,s],s.forEach(c),t&&Dr.value&&Dr.value.frameloop[t].push(l),l=0,s.clear(),r=!1,n&&(n=!1,d.process(e)))}};return d}(n,t?s:void 0),e)),{}),{setup:o,read:l,resolveKeyframes:c,preUpdate:d,update:m,preRender:u,render:h,postRender:p}=i,x=()=>{const n=ar.useManualTiming?r.timestamp:performance.now();s=!1,ar.useManualTiming||(r.delta=a?1e3/60:Math.max(Math.min(n-r.timestamp,40),1)),r.timestamp=n,r.isProcessing=!0,o.process(r),l.process(r),c.process(r),d.process(r),m.process(r),u.process(r),h.process(r),p.process(r),r.isProcessing=!1,s&&t&&(a=!1,e(x))};return{schedule:qr.reduce(((t,n)=>{const o=i[n];return t[n]=(t,n=!1,i=!1)=>(s||(s=!0,a=!0,r.isProcessing||e(x)),o.schedule(t,n,i)),t}),{}),cancel:e=>{for(let t=0;t<qr.length;t++)i[qr[t]].cancel(e)},state:r,steps:i}}const{schedule:Lr,cancel:$r,state:Ir,steps:Fr}=Rr("undefined"!=typeof requestAnimationFrame?requestAnimationFrame:lr,!0);let Vr;function Or(){Vr=void 0}const Br={now:()=>(void 0===Vr&&Br.set(Ir.isProcessing||ar.useManualTiming?Ir.timestamp:performance.now()),Vr),set:e=>{Vr=e,queueMicrotask(Or)}},Ur=e=>t=>"string"==typeof t&&t.startsWith(e),zr=Ur("--"),Gr=Ur("var(--"),Hr=e=>!!Gr(e)&&Xr.test(e.split("/*")[0].trim()),Xr=/var\(--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)$/iu,Wr={test:e=>"number"==typeof e,parse:parseFloat,transform:e=>e},Yr={...Wr,transform:e=>sr(0,1,e)},Kr={...Wr,default:1},Jr=e=>Math.round(1e5*e)/1e5,Qr=/-?(?:\d+(?:\.\d+)?|\.\d+)/gu;const Zr=/^(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))$/iu,en=(e,t)=>s=>Boolean("string"==typeof s&&Zr.test(s)&&s.startsWith(e)||t&&!function(e){return null==e}(s)&&Object.prototype.hasOwnProperty.call(s,t)),tn=(e,t,s)=>a=>{if("string"!=typeof a)return a;const[r,n,i,o]=a.match(Qr);return{[e]:parseFloat(r),[t]:parseFloat(n),[s]:parseFloat(i),alpha:void 0!==o?parseFloat(o):1}},sn={...Wr,transform:e=>Math.round((e=>sr(0,255,e))(e))},an={test:en("rgb","red"),parse:tn("red","green","blue"),transform:({red:e,green:t,blue:s,alpha:a=1})=>"rgba("+sn.transform(e)+", "+sn.transform(t)+", "+sn.transform(s)+", "+Jr(Yr.transform(a))+")"};const rn={test:en("#"),parse:function(e){let t="",s="",a="",r="";return e.length>5?(t=e.substring(1,3),s=e.substring(3,5),a=e.substring(5,7),r=e.substring(7,9)):(t=e.substring(1,2),s=e.substring(2,3),a=e.substring(3,4),r=e.substring(4,5),t+=t,s+=s,a+=a,r+=r),{red:parseInt(t,16),green:parseInt(s,16),blue:parseInt(a,16),alpha:r?parseInt(r,16)/255:1}},transform:an.transform},nn=e=>({test:t=>"string"==typeof t&&t.endsWith(e)&&1===t.split(" ").length,parse:parseFloat,transform:t=>`${t}${e}`}),on=nn("deg"),ln=nn("%"),cn=nn("px"),dn=nn("vh"),mn=nn("vw"),un=(()=>({...ln,parse:e=>ln.parse(e)/100,transform:e=>ln.transform(100*e)}))(),hn={test:en("hsl","hue"),parse:tn("hue","saturation","lightness"),transform:({hue:e,saturation:t,lightness:s,alpha:a=1})=>"hsla("+Math.round(e)+", "+ln.transform(Jr(t))+", "+ln.transform(Jr(s))+", "+Jr(Yr.transform(a))+")"},pn={test:e=>an.test(e)||rn.test(e)||hn.test(e),parse:e=>an.test(e)?an.parse(e):hn.test(e)?hn.parse(e):rn.parse(e),transform:e=>"string"==typeof e?e:e.hasOwnProperty("red")?an.transform(e):hn.transform(e)},xn=/(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))/giu;const fn="number",gn="color",bn=/var\s*\(\s*--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)|#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\)|-?(?:\d+(?:\.\d+)?|\.\d+)/giu;function vn(e){const t=e.toString(),s=[],a={color:[],number:[],var:[]},r=[];let n=0;const i=t.replace(bn,(e=>(pn.test(e)?(a.color.push(n),r.push(gn),s.push(pn.parse(e))):e.startsWith("var(")?(a.var.push(n),r.push("var"),s.push(e)):(a.number.push(n),r.push(fn),s.push(parseFloat(e))),++n,"${}"))).split("${}");return{values:s,split:i,indexes:a,types:r}}function yn(e){return vn(e).values}function jn(e){const{split:t,types:s}=vn(e),a=t.length;return e=>{let r="";for(let n=0;n<a;n++)if(r+=t[n],void 0!==e[n]){const t=s[n];r+=t===fn?Jr(e[n]):t===gn?pn.transform(e[n]):e[n]}return r}}const Nn=e=>"number"==typeof e?0:e;const wn={test:function(e){return isNaN(e)&&"string"==typeof e&&(e.match(Qr)?.length||0)+(e.match(xn)?.length||0)>0},parse:yn,createTransformer:jn,getAnimatableNone:function(e){const t=yn(e);return jn(e)(t.map(Nn))}};function _n(e,t,s){return s<0&&(s+=1),s>1&&(s-=1),s<1/6?e+6*(t-e)*s:s<.5?t:s<2/3?e+(t-e)*(2/3-s)*6:e}function Cn(e,t){return s=>s>0?t:e}const Sn=(e,t,s)=>e+(t-e)*s,En=(e,t,s)=>{const a=e*e,r=s*(t*t-a)+a;return r<0?0:Math.sqrt(r)},kn=[rn,an,hn];function An(e){const t=(e=>kn.find((t=>t.test(e))))(e);if(!Boolean(t))return!1;let s=t.parse(e);return t===hn&&(s=function({hue:e,saturation:t,lightness:s,alpha:a}){e/=360,s/=100;let r=0,n=0,i=0;if(t/=100){const a=s<.5?s*(1+t):s+t-s*t,o=2*s-a;r=_n(o,a,e+1/3),n=_n(o,a,e),i=_n(o,a,e-1/3)}else r=n=i=s;return{red:Math.round(255*r),green:Math.round(255*n),blue:Math.round(255*i),alpha:a}}(s)),s}const Pn=(e,t)=>{const s=An(e),a=An(t);if(!s||!a)return Cn(e,t);const r={...s};return e=>(r.red=En(s.red,a.red,e),r.green=En(s.green,a.green,e),r.blue=En(s.blue,a.blue,e),r.alpha=Sn(s.alpha,a.alpha,e),an.transform(r))},Mn=new Set(["none","hidden"]);function Tn(e,t){return s=>Sn(e,t,s)}function qn(e){return"number"==typeof e?Tn:"string"==typeof e?Hr(e)?Cn:pn.test(e)?Pn:Ln:Array.isArray(e)?Dn:"object"==typeof e?pn.test(e)?Pn:Rn:Cn}function Dn(e,t){const s=[...e],a=s.length,r=e.map(((e,s)=>qn(e)(e,t[s])));return e=>{for(let t=0;t<a;t++)s[t]=r[t](e);return s}}function Rn(e,t){const s={...e,...t},a={};for(const r in s)void 0!==e[r]&&void 0!==t[r]&&(a[r]=qn(e[r])(e[r],t[r]));return e=>{for(const t in a)s[t]=a[t](e);return s}}const Ln=(e,t)=>{const s=wn.createTransformer(t),a=vn(e),r=vn(t);return a.indexes.var.length===r.indexes.var.length&&a.indexes.color.length===r.indexes.color.length&&a.indexes.number.length>=r.indexes.number.length?Mn.has(e)&&!r.values.length||Mn.has(t)&&!a.values.length?function(e,t){return Mn.has(e)?s=>s<=0?e:t:s=>s>=1?t:e}(e,t):dr(Dn(function(e,t){const s=[],a={color:0,var:0,number:0};for(let r=0;r<t.values.length;r++){const n=t.types[r],i=e.indexes[n][a[n]],o=e.values[i]??0;s[r]=o,a[n]++}return s}(a,r),r.values),s):Cn(e,t)};function $n(e,t,s){if("number"==typeof e&&"number"==typeof t&&"number"==typeof s)return Sn(e,t,s);return qn(e)(e,t)}const In=e=>{const t=({timestamp:t})=>e(t);return{start:(e=!0)=>Lr.update(t,e),stop:()=>$r(t),now:()=>Ir.isProcessing?Ir.timestamp:Br.now()}},Fn=(e,t,s=10)=>{let a="";const r=Math.max(Math.round(t/s),2);for(let n=0;n<r;n++)a+=e(n/(r-1))+", ";return`linear(${a.substring(0,a.length-2)})`},Vn=2e4;function On(e){let t=0;let s=e.next(t);for(;!s.done&&t<Vn;)t+=50,s=e.next(t);return t>=Vn?1/0:t}function Bn(e,t,s){const a=Math.max(t-5,0);return xr(s-e(a),t-a)}const Un=100,zn=10,Gn=1,Hn=0,Xn=800,Wn=.3,Yn=.3,Kn={granular:.01,default:2},Jn={granular:.005,default:.5},Qn=.01,Zn=10,ei=.05,ti=1,si=.001;function ai({duration:e=Xn,bounce:t=Wn,velocity:s=Hn,mass:a=Gn}){let r,n,i=1-t;i=sr(ei,ti,i),e=sr(Qn,Zn,pr(e)),i<1?(r=t=>{const a=t*i,r=a*e,n=a-s,o=ni(t,i),l=Math.exp(-r);return si-n/o*l},n=t=>{const a=t*i*e,n=a*s+s,o=Math.pow(i,2)*Math.pow(t,2)*e,l=Math.exp(-a),c=ni(Math.pow(t,2),i);return(-r(t)+si>0?-1:1)*((n-o)*l)/c}):(r=t=>Math.exp(-t*e)*((t-s)*e+1)-.001,n=t=>Math.exp(-t*e)*(e*e*(s-t)));const o=function(e,t,s){let a=s;for(let r=1;r<ri;r++)a-=e(a)/t(a);return a}(r,n,5/e);if(e=hr(e),isNaN(o))return{stiffness:Un,damping:zn,duration:e};{const t=Math.pow(o,2)*a;return{stiffness:t,damping:2*i*Math.sqrt(a*t),duration:e}}}const ri=12;function ni(e,t){return e*Math.sqrt(1-t*t)}const ii=["duration","bounce"],oi=["stiffness","damping","mass"];function li(e,t){return t.some((t=>void 0!==e[t]))}function ci(e=Yn,t=Wn){const s="object"!=typeof e?{visualDuration:e,keyframes:[0,1],bounce:t}:e;let{restSpeed:a,restDelta:r}=s;const n=s.keyframes[0],i=s.keyframes[s.keyframes.length-1],o={done:!1,value:n},{stiffness:l,damping:c,mass:d,duration:m,velocity:u,isResolvedFromDuration:h}=function(e){let t={velocity:Hn,stiffness:Un,damping:zn,mass:Gn,isResolvedFromDuration:!1,...e};if(!li(e,oi)&&li(e,ii))if(e.visualDuration){const s=e.visualDuration,a=2*Math.PI/(1.2*s),r=a*a,n=2*sr(.05,1,1-(e.bounce||0))*Math.sqrt(r);t={...t,mass:Gn,stiffness:r,damping:n}}else{const s=ai(e);t={...t,...s,mass:Gn},t.isResolvedFromDuration=!0}return t}({...s,velocity:-pr(s.velocity||0)}),p=u||0,x=c/(2*Math.sqrt(l*d)),f=i-n,g=pr(Math.sqrt(l/d)),b=Math.abs(f)<5;let v;if(a||(a=b?Kn.granular:Kn.default),r||(r=b?Jn.granular:Jn.default),x<1){const e=ni(g,x);v=t=>{const s=Math.exp(-x*g*t);return i-s*((p+x*g*f)/e*Math.sin(e*t)+f*Math.cos(e*t))}}else if(1===x)v=e=>i-Math.exp(-g*e)*(f+(p+g*f)*e);else{const e=g*Math.sqrt(x*x-1);v=t=>{const s=Math.exp(-x*g*t),a=Math.min(e*t,300);return i-s*((p+x*g*f)*Math.sinh(a)+e*f*Math.cosh(a))/e}}const y={calculatedDuration:h&&m||null,next:e=>{const t=v(e);if(h)o.done=e>=m;else{let s=0===e?p:0;x<1&&(s=0===e?hr(p):Bn(v,e,t));const n=Math.abs(s)<=a,l=Math.abs(i-t)<=r;o.done=n&&l}return o.value=o.done?i:t,o},toString:()=>{const e=Math.min(On(y),Vn),t=Fn((t=>y.next(e*t).value),e,30);return e+"ms "+t},toTransition:()=>{}};return y}function di({keyframes:e,velocity:t=0,power:s=.8,timeConstant:a=325,bounceDamping:r=10,bounceStiffness:n=500,modifyTarget:i,min:o,max:l,restDelta:c=.5,restSpeed:d}){const m=e[0],u={done:!1,value:m},h=e=>void 0===o?l:void 0===l||Math.abs(o-e)<Math.abs(l-e)?o:l;let p=s*t;const x=m+p,f=void 0===i?x:i(x);f!==x&&(p=f-m);const g=e=>-p*Math.exp(-e/a),b=e=>f+g(e),v=e=>{const t=g(e),s=b(e);u.done=Math.abs(t)<=c,u.value=u.done?f:s};let y,j;const N=e=>{(e=>void 0!==o&&e<o||void 0!==l&&e>l)(u.value)&&(y=e,j=ci({keyframes:[u.value,h(u.value)],velocity:Bn(b,e,u.value),damping:r,stiffness:n,restDelta:c,restSpeed:d}))};return N(0),{calculatedDuration:null,next:e=>{let t=!1;return j||void 0!==y||(t=!0,v(e),N(e)),void 0!==y&&e>=y?j.next(e-y):(!t&&v(e),u)}}}function mi(e,t,{clamp:s=!0,ease:a,mixer:r}={}){const n=e.length;if(t.length,1===n)return()=>t[0];if(2===n&&t[0]===t[1])return()=>t[1];const i=e[0]===e[1];e[0]>e[n-1]&&(e=[...e].reverse(),t=[...t].reverse());const o=function(e,t,s){const a=[],r=s||ar.mix||$n,n=e.length-1;for(let i=0;i<n;i++){let s=r(e[i],e[i+1]);if(t){const e=Array.isArray(t)?t[i]||lr:t;s=dr(e,s)}a.push(s)}return a}(t,a,r),l=o.length,c=s=>{if(i&&s<e[0])return t[0];let a=0;if(l>1)for(;a<e.length-2&&!(s<e[a+1]);a++);const r=mr(e[a],e[a+1],s);return o[a](r)};return s?t=>c(sr(e[0],e[n-1],t)):c}function ui(e){const t=[0];return function(e,t){const s=e[e.length-1];for(let a=1;a<=t;a++){const r=mr(0,t,a);e.push(Sn(s,1,r))}}(t,e.length-1),t}function hi({duration:e=300,keyframes:t,times:s,ease:a="easeInOut"}){const r=(e=>Array.isArray(e)&&"number"!=typeof e[0])(a)?a.map(Tr):Tr(a),n={done:!1,value:t[0]},i=function(e,t){return e.map((e=>e*t))}(s&&s.length===t.length?s:ui(t),e),o=mi(i,t,{ease:Array.isArray(r)?r:(l=t,c=r,l.map((()=>c||Ar)).splice(0,l.length-1))});var l,c;return{calculatedDuration:e,next:t=>(n.value=o(t),n.done=t>=e,n)}}ci.applyToOptions=e=>{const t=function(e,t=100,s){const a=s({...e,keyframes:[0,t]}),r=Math.min(On(a),Vn);return{type:"keyframes",ease:e=>a.next(r*e).value/t,duration:pr(r)}}(e,100,ci);return e.ease=t.ease,e.duration=hr(t.duration),e.type="keyframes",e};const pi=e=>null!==e;function xi(e,{repeat:t,repeatType:s="loop"},a,r=1){const n=e.filter(pi),i=r<0||t&&"loop"!==s&&t%2==1?0:n.length-1;return i&&void 0!==a?a:n[i]}const fi={decay:di,inertia:di,tween:hi,keyframes:hi,spring:ci};function gi(e){"string"==typeof e.type&&(e.type=fi[e.type])}class bi{constructor(){this.updateFinished()}get finished(){return this._finished}updateFinished(){this._finished=new Promise((e=>{this.resolve=e}))}notifyFinished(){this.resolve()}then(e,t){return this.finished.then(e,t)}}const vi=e=>e/100;class yi extends bi{constructor(e){super(),this.state="idle",this.startTime=null,this.isStopped=!1,this.currentTime=0,this.holdTime=null,this.playbackSpeed=1,this.stop=()=>{const{motionValue:e}=this.options;e&&e.updatedAt!==Br.now()&&this.tick(Br.now()),this.isStopped=!0,"idle"!==this.state&&(this.teardown(),this.options.onStop?.())},this.options=e,this.initAnimation(),this.play(),!1===e.autoplay&&this.pause()}initAnimation(){const{options:e}=this;gi(e);const{type:t=hi,repeat:s=0,repeatDelay:a=0,repeatType:r,velocity:n=0}=e;let{keyframes:i}=e;const o=t||hi;o!==hi&&"number"!=typeof i[0]&&(this.mixKeyframes=dr(vi,$n(i[0],i[1])),i=[0,100]);const l=o({...e,keyframes:i});"mirror"===r&&(this.mirroredGenerator=o({...e,keyframes:[...i].reverse(),velocity:-n})),null===l.calculatedDuration&&(l.calculatedDuration=On(l));const{calculatedDuration:c}=l;this.calculatedDuration=c,this.resolvedDuration=c+a,this.totalDuration=this.resolvedDuration*(s+1)-a,this.generator=l}updateTime(e){const t=Math.round(e-this.startTime)*this.playbackSpeed;null!==this.holdTime?this.currentTime=this.holdTime:this.currentTime=t}tick(e,t=!1){const{generator:s,totalDuration:a,mixKeyframes:r,mirroredGenerator:n,resolvedDuration:i,calculatedDuration:o}=this;if(null===this.startTime)return s.next(0);const{delay:l=0,keyframes:c,repeat:d,repeatType:m,repeatDelay:u,type:h,onUpdate:p,finalKeyframe:x}=this.options;this.speed>0?this.startTime=Math.min(this.startTime,e):this.speed<0&&(this.startTime=Math.min(e-a/this.speed,this.startTime)),t?this.currentTime=e:this.updateTime(e);const f=this.currentTime-l*(this.playbackSpeed>=0?1:-1),g=this.playbackSpeed>=0?f<0:f>a;this.currentTime=Math.max(f,0),"finished"===this.state&&null===this.holdTime&&(this.currentTime=a);let b=this.currentTime,v=s;if(d){const e=Math.min(this.currentTime,a)/i;let t=Math.floor(e),s=e%1;!s&&e>=1&&(s=1),1===s&&t--,t=Math.min(t,d+1);Boolean(t%2)&&("reverse"===m?(s=1-s,u&&(s-=u/i)):"mirror"===m&&(v=n)),b=sr(0,1,s)*i}const y=g?{done:!1,value:c[0]}:v.next(b);r&&(y.value=r(y.value));let{done:j}=y;g||null===o||(j=this.playbackSpeed>=0?this.currentTime>=a:this.currentTime<=0);const N=null===this.holdTime&&("finished"===this.state||"running"===this.state&&j);return N&&h!==di&&(y.value=xi(c,this.options,x,this.speed)),p&&p(y.value),N&&this.finish(),y}then(e,t){return this.finished.then(e,t)}get duration(){return pr(this.calculatedDuration)}get time(){return pr(this.currentTime)}set time(e){e=hr(e),this.currentTime=e,null===this.startTime||null!==this.holdTime||0===this.playbackSpeed?this.holdTime=e:this.driver&&(this.startTime=this.driver.now()-e/this.playbackSpeed),this.driver?.start(!1)}get speed(){return this.playbackSpeed}set speed(e){this.updateTime(Br.now());const t=this.playbackSpeed!==e;this.playbackSpeed=e,t&&(this.time=pr(this.currentTime))}play(){if(this.isStopped)return;const{driver:e=In,startTime:t}=this.options;this.driver||(this.driver=e((e=>this.tick(e)))),this.options.onPlay?.();const s=this.driver.now();"finished"===this.state?(this.updateFinished(),this.startTime=s):null!==this.holdTime?this.startTime=s-this.holdTime:this.startTime||(this.startTime=t??s),"finished"===this.state&&this.speed<0&&(this.startTime+=this.calculatedDuration),this.holdTime=null,this.state="running",this.driver.start()}pause(){this.state="paused",this.updateTime(Br.now()),this.holdTime=this.currentTime}complete(){"running"!==this.state&&this.play(),this.state="finished",this.holdTime=null}finish(){this.notifyFinished(),this.teardown(),this.state="finished",this.options.onComplete?.()}cancel(){this.holdTime=null,this.startTime=0,this.tick(0),this.teardown(),this.options.onCancel?.()}teardown(){this.state="idle",this.stopDriver(),this.startTime=this.holdTime=null}stopDriver(){this.driver&&(this.driver.stop(),this.driver=void 0)}sample(e){return this.startTime=0,this.tick(e,!0)}attachTimeline(e){return this.options.allowFlatten&&(this.options.type="keyframes",this.options.ease="linear",this.initAnimation()),this.driver?.stop(),e.observe(this)}}const ji=e=>180*e/Math.PI,Ni=e=>{const t=ji(Math.atan2(e[1],e[0]));return _i(t)},wi={x:4,y:5,translateX:4,translateY:5,scaleX:0,scaleY:3,scale:e=>(Math.abs(e[0])+Math.abs(e[3]))/2,rotate:Ni,rotateZ:Ni,skewX:e=>ji(Math.atan(e[1])),skewY:e=>ji(Math.atan(e[2])),skew:e=>(Math.abs(e[1])+Math.abs(e[2]))/2},_i=e=>((e%=360)<0&&(e+=360),e),Ci=e=>Math.sqrt(e[0]*e[0]+e[1]*e[1]),Si=e=>Math.sqrt(e[4]*e[4]+e[5]*e[5]),Ei={x:12,y:13,z:14,translateX:12,translateY:13,translateZ:14,scaleX:Ci,scaleY:Si,scale:e=>(Ci(e)+Si(e))/2,rotateX:e=>_i(ji(Math.atan2(e[6],e[5]))),rotateY:e=>_i(ji(Math.atan2(-e[2],e[0]))),rotateZ:Ni,rotate:Ni,skewX:e=>ji(Math.atan(e[4])),skewY:e=>ji(Math.atan(e[1])),skew:e=>(Math.abs(e[1])+Math.abs(e[4]))/2};function ki(e){return e.includes("scale")?1:0}function Ai(e,t){if(!e||"none"===e)return ki(t);const s=e.match(/^matrix3d\(([-\d.e\s,]+)\)$/u);let a,r;if(s)a=Ei,r=s;else{const t=e.match(/^matrix\(([-\d.e\s,]+)\)$/u);a=wi,r=t}if(!r)return ki(t);const n=a[t],i=r[1].split(",").map(Pi);return"function"==typeof n?n(i):i[n]}function Pi(e){return parseFloat(e.trim())}const Mi=["transformPerspective","x","y","z","translateX","translateY","translateZ","scale","scaleX","scaleY","rotate","rotateX","rotateY","rotateZ","skew","skewX","skewY"],Ti=(()=>new Set(Mi))(),qi=e=>e===Wr||e===cn,Di=new Set(["x","y","z"]),Ri=Mi.filter((e=>!Di.has(e)));const Li={width:({x:e},{paddingLeft:t="0",paddingRight:s="0"})=>e.max-e.min-parseFloat(t)-parseFloat(s),height:({y:e},{paddingTop:t="0",paddingBottom:s="0"})=>e.max-e.min-parseFloat(t)-parseFloat(s),top:(e,{top:t})=>parseFloat(t),left:(e,{left:t})=>parseFloat(t),bottom:({y:e},{top:t})=>parseFloat(t)+(e.max-e.min),right:({x:e},{left:t})=>parseFloat(t)+(e.max-e.min),x:(e,{transform:t})=>Ai(t,"x"),y:(e,{transform:t})=>Ai(t,"y")};Li.translateX=Li.x,Li.translateY=Li.y;const $i=new Set;let Ii=!1,Fi=!1,Vi=!1;function Oi(){if(Fi){const e=Array.from($i).filter((e=>e.needsMeasurement)),t=new Set(e.map((e=>e.element))),s=new Map;t.forEach((e=>{const t=function(e){const t=[];return Ri.forEach((s=>{const a=e.getValue(s);void 0!==a&&(t.push([s,a.get()]),a.set(s.startsWith("scale")?1:0))})),t}(e);t.length&&(s.set(e,t),e.render())})),e.forEach((e=>e.measureInitialState())),t.forEach((e=>{e.render();const t=s.get(e);t&&t.forEach((([t,s])=>{e.getValue(t)?.set(s)}))})),e.forEach((e=>e.measureEndState())),e.forEach((e=>{void 0!==e.suspendedScrollY&&window.scrollTo(0,e.suspendedScrollY)}))}Fi=!1,Ii=!1,$i.forEach((e=>e.complete(Vi))),$i.clear()}function Bi(){$i.forEach((e=>{e.readKeyframes(),e.needsMeasurement&&(Fi=!0)}))}class Ui{constructor(e,t,s,a,r,n=!1){this.state="pending",this.isAsync=!1,this.needsMeasurement=!1,this.unresolvedKeyframes=[...e],this.onComplete=t,this.name=s,this.motionValue=a,this.element=r,this.isAsync=n}scheduleResolve(){this.state="scheduled",this.isAsync?($i.add(this),Ii||(Ii=!0,Lr.read(Bi),Lr.resolveKeyframes(Oi))):(this.readKeyframes(),this.complete())}readKeyframes(){const{unresolvedKeyframes:e,name:t,element:s,motionValue:a}=this;if(null===e[0]){const r=a?.get(),n=e[e.length-1];if(void 0!==r)e[0]=r;else if(s&&t){const a=s.readValue(t,n);null!=a&&(e[0]=a)}void 0===e[0]&&(e[0]=n),a&&void 0===r&&a.set(e[0])}!function(e){for(let t=1;t<e.length;t++)e[t]??(e[t]=e[t-1])}(e)}setFinalKeyframe(){}measureInitialState(){}renderEndStyles(){}measureEndState(){}complete(e=!1){this.state="complete",this.onComplete(this.unresolvedKeyframes,this.finalKeyframe,e),$i.delete(this)}cancel(){"scheduled"===this.state&&($i.delete(this),this.state="pending")}resume(){"pending"===this.state&&this.scheduleResolve()}}const zi=or((()=>void 0!==window.ScrollTimeline)),Gi={};function Hi(e,t){const s=or(e);return()=>Gi[t]??s()}const Xi=Hi((()=>{try{document.createElement("div").animate({opacity:0},{easing:"linear(0, 1)"})}catch(e){return!1}return!0}),"linearEasing"),Wi=([e,t,s,a])=>`cubic-bezier(${e}, ${t}, ${s}, ${a})`,Yi={linear:"linear",ease:"ease",easeIn:"ease-in",easeOut:"ease-out",easeInOut:"ease-in-out",circIn:Wi([0,.65,.55,1]),circOut:Wi([.55,0,1,.45]),backIn:Wi([.31,.01,.66,-.59]),backOut:Wi([.33,1.53,.69,.99])};function Ki(e,t){return e?"function"==typeof e?Xi()?Fn(e,t):"ease-out":Pr(e)?Wi(e):Array.isArray(e)?e.map((e=>Ki(e,t)||Yi.easeOut)):Yi[e]:void 0}function Ji(e,t,s,{delay:a=0,duration:r=300,repeat:n=0,repeatType:i="loop",ease:o="easeOut",times:l}={},c=void 0){const d={[t]:s};l&&(d.offset=l);const m=Ki(o,r);Array.isArray(m)&&(d.easing=m);const u={delay:a,duration:r,easing:Array.isArray(m)?"linear":m,fill:"both",iterations:n+1,direction:"reverse"===i?"alternate":"normal"};c&&(u.pseudoElement=c);return e.animate(d,u)}function Qi(e){return"function"==typeof e&&"applyToOptions"in e}class Zi extends bi{constructor(e){if(super(),this.finishedTime=null,this.isStopped=!1,!e)return;const{element:t,name:s,keyframes:a,pseudoElement:r,allowFlatten:n=!1,finalKeyframe:i,onComplete:o}=e;this.isPseudoElement=Boolean(r),this.allowFlatten=n,this.options=e,e.type;const l=function({type:e,...t}){return Qi(e)&&Xi()?e.applyToOptions(t):(t.duration??(t.duration=300),t.ease??(t.ease="easeOut"),t)}(e);this.animation=Ji(t,s,a,l,r),!1===l.autoplay&&this.animation.pause(),this.animation.onfinish=()=>{if(this.finishedTime=this.time,!r){const e=xi(a,this.options,i,this.speed);this.updateMotionValue?this.updateMotionValue(e):function(e,t,s){(e=>e.startsWith("--"))(t)?e.style.setProperty(t,s):e.style[t]=s}(t,s,e),this.animation.cancel()}o?.(),this.notifyFinished()}}play(){this.isStopped||(this.animation.play(),"finished"===this.state&&this.updateFinished())}pause(){this.animation.pause()}complete(){this.animation.finish?.()}cancel(){try{this.animation.cancel()}catch(e){}}stop(){if(this.isStopped)return;this.isStopped=!0;const{state:e}=this;"idle"!==e&&"finished"!==e&&(this.updateMotionValue?this.updateMotionValue():this.commitStyles(),this.isPseudoElement||this.cancel())}commitStyles(){this.isPseudoElement||this.animation.commitStyles?.()}get duration(){const e=this.animation.effect?.getComputedTiming?.().duration||0;return pr(Number(e))}get time(){return pr(Number(this.animation.currentTime)||0)}set time(e){this.finishedTime=null,this.animation.currentTime=hr(e)}get speed(){return this.animation.playbackRate}set speed(e){e<0&&(this.finishedTime=null),this.animation.playbackRate=e}get state(){return null!==this.finishedTime?"finished":this.animation.playState}get startTime(){return Number(this.animation.startTime)}set startTime(e){this.animation.startTime=e}attachTimeline({timeline:e,observe:t}){return this.allowFlatten&&this.animation.effect?.updateTiming({easing:"linear"}),this.animation.onfinish=null,e&&zi()?(this.animation.timeline=e,lr):t(this)}}const eo={anticipate:wr,backInOut:Nr,circInOut:Sr};function to(e){"string"==typeof e.ease&&e.ease in eo&&(e.ease=eo[e.ease])}class so extends Zi{constructor(e){to(e),gi(e),super(e),e.startTime&&(this.startTime=e.startTime),this.options=e}updateMotionValue(e){const{motionValue:t,onUpdate:s,onComplete:a,element:r,...n}=this.options;if(!t)return;if(void 0!==e)return void t.set(e);const i=new yi({...n,autoplay:!1}),o=hr(this.finishedTime??this.time);t.setWithVelocity(i.sample(o-10).value,i.sample(o).value,10),i.stop()}}const ao=(e,t)=>"zIndex"!==t&&(!("number"!=typeof e&&!Array.isArray(e))||!("string"!=typeof e||!wn.test(e)&&"0"!==e||e.startsWith("url(")));function ro(e){return nr(e)&&"offsetHeight"in e}const no=new Set(["opacity","clipPath","filter","transform"]),io=or((()=>Object.hasOwnProperty.call(Element.prototype,"animate")));class oo extends bi{constructor({autoplay:e=!0,delay:t=0,type:s="keyframes",repeat:a=0,repeatDelay:r=0,repeatType:n="loop",keyframes:i,name:o,motionValue:l,element:c,...d}){super(),this.stop=()=>{this._animation&&(this._animation.stop(),this.stopTimeline?.()),this.keyframeResolver?.cancel()},this.createdAt=Br.now();const m={autoplay:e,delay:t,type:s,repeat:a,repeatDelay:r,repeatType:n,name:o,motionValue:l,element:c,...d},u=c?.KeyframeResolver||Ui;this.keyframeResolver=new u(i,((e,t,s)=>this.onKeyframesResolved(e,t,m,!s)),o,l,c),this.keyframeResolver?.scheduleResolve()}onKeyframesResolved(e,t,s,a){this.keyframeResolver=void 0;const{name:r,type:n,velocity:i,delay:o,isHandoff:l,onUpdate:c}=s;this.resolvedAt=Br.now(),function(e,t,s,a){const r=e[0];if(null===r)return!1;if("display"===t||"visibility"===t)return!0;const n=e[e.length-1],i=ao(r,t),o=ao(n,t);return!(!i||!o)&&(function(e){const t=e[0];if(1===e.length)return!0;for(let s=0;s<e.length;s++)if(e[s]!==t)return!0}(e)||("spring"===s||Qi(s))&&a)}(e,r,n,i)||(!ar.instantAnimations&&o||c?.(xi(e,s,t)),e[0]=e[e.length-1],s.duration=0,s.repeat=0);const d={startTime:a?this.resolvedAt&&this.resolvedAt-this.createdAt>40?this.resolvedAt:this.createdAt:void 0,finalKeyframe:t,...s,keyframes:e},m=!l&&function(e){const{motionValue:t,name:s,repeatDelay:a,repeatType:r,damping:n,type:i}=e;if(!ro(t?.owner?.current))return!1;const{onUpdate:o,transformTemplate:l}=t.owner.getProps();return io()&&s&&no.has(s)&&("transform"!==s||!l)&&!o&&!a&&"mirror"!==r&&0!==n&&"inertia"!==i}(d)?new so({...d,element:d.motionValue.owner.current}):new yi(d);m.finished.then((()=>this.notifyFinished())).catch(lr),this.pendingTimeline&&(this.stopTimeline=m.attachTimeline(this.pendingTimeline),this.pendingTimeline=void 0),this._animation=m}get finished(){return this._animation?this.animation.finished:this._finished}then(e,t){return this.finished.finally(e).then((()=>{}))}get animation(){return this._animation||(this.keyframeResolver?.resume(),Vi=!0,Bi(),Oi(),Vi=!1),this._animation}get duration(){return this.animation.duration}get time(){return this.animation.time}set time(e){this.animation.time=e}get speed(){return this.animation.speed}get state(){return this.animation.state}set speed(e){this.animation.speed=e}get startTime(){return this.animation.startTime}attachTimeline(e){return this._animation?this.stopTimeline=this.animation.attachTimeline(e):this.pendingTimeline=e,()=>this.stop()}play(){this.animation.play()}pause(){this.animation.pause()}complete(){this.animation.complete()}cancel(){this._animation&&this.animation.cancel(),this.keyframeResolver?.cancel()}}const lo=/^var\(--(?:([\w-]+)|([\w-]+), ?([a-zA-Z\d ()%#.,-]+))\)/u;function co(e,t,s=1){const[a,r]=function(e){const t=lo.exec(e);if(!t)return[,];const[,s,a,r]=t;return[`--${s??a}`,r]}(e);if(!a)return;const n=window.getComputedStyle(t).getPropertyValue(a);if(n){const e=n.trim();return rr(e)?parseFloat(e):e}return Hr(r)?co(r,t,s+1):r}function mo(e,t){return e?.[t]??e?.default??e}const uo=new Set(["width","height","top","left","right","bottom",...Mi]),ho=e=>t=>t.test(e),po=[Wr,cn,ln,on,mn,dn,{test:e=>"auto"===e,parse:e=>e}],xo=e=>po.find(ho(e));const fo=new Set(["brightness","contrast","saturate","opacity"]);function go(e){const[t,s]=e.slice(0,-1).split("(");if("drop-shadow"===t)return e;const[a]=s.match(Qr)||[];if(!a)return e;const r=s.replace(a,"");let n=fo.has(t)?1:0;return a!==s&&(n*=100),t+"("+n+r+")"}const bo=/\b([a-z-]*)\(.*?\)/gu,vo={...wn,getAnimatableNone:e=>{const t=e.match(bo);return t?t.map(go).join(" "):e}},yo={...Wr,transform:Math.round},jo={borderWidth:cn,borderTopWidth:cn,borderRightWidth:cn,borderBottomWidth:cn,borderLeftWidth:cn,borderRadius:cn,radius:cn,borderTopLeftRadius:cn,borderTopRightRadius:cn,borderBottomRightRadius:cn,borderBottomLeftRadius:cn,width:cn,maxWidth:cn,height:cn,maxHeight:cn,top:cn,right:cn,bottom:cn,left:cn,padding:cn,paddingTop:cn,paddingRight:cn,paddingBottom:cn,paddingLeft:cn,margin:cn,marginTop:cn,marginRight:cn,marginBottom:cn,marginLeft:cn,backgroundPositionX:cn,backgroundPositionY:cn,...{rotate:on,rotateX:on,rotateY:on,rotateZ:on,scale:Kr,scaleX:Kr,scaleY:Kr,scaleZ:Kr,skew:on,skewX:on,skewY:on,distance:cn,translateX:cn,translateY:cn,translateZ:cn,x:cn,y:cn,z:cn,perspective:cn,transformPerspective:cn,opacity:Yr,originX:un,originY:un,originZ:cn},zIndex:yo,fillOpacity:Yr,strokeOpacity:Yr,numOctaves:yo},No={...jo,color:pn,backgroundColor:pn,outlineColor:pn,fill:pn,stroke:pn,borderColor:pn,borderTopColor:pn,borderRightColor:pn,borderBottomColor:pn,borderLeftColor:pn,filter:vo,WebkitFilter:vo},wo=e=>No[e];function _o(e,t){let s=wo(e);return s!==vo&&(s=wn),s.getAnimatableNone?s.getAnimatableNone(t):void 0}const Co=new Set(["auto","none","0"]);class So extends Ui{constructor(e,t,s,a,r){super(e,t,s,a,r,!0)}readKeyframes(){const{unresolvedKeyframes:e,element:t,name:s}=this;if(!t||!t.current)return;super.readKeyframes();for(let o=0;o<e.length;o++){let s=e[o];if("string"==typeof s&&(s=s.trim(),Hr(s))){const a=co(s,t.current);void 0!==a&&(e[o]=a),o===e.length-1&&(this.finalKeyframe=s)}}if(this.resolveNoneKeyframes(),!uo.has(s)||2!==e.length)return;const[a,r]=e,n=xo(a),i=xo(r);if(n!==i)if(qi(n)&&qi(i))for(let o=0;o<e.length;o++){const t=e[o];"string"==typeof t&&(e[o]=parseFloat(t))}else Li[s]&&(this.needsMeasurement=!0)}resolveNoneKeyframes(){const{unresolvedKeyframes:e,name:t}=this,s=[];for(let r=0;r<e.length;r++)(null===e[r]||("number"==typeof(a=e[r])?0===a:null===a||"none"===a||"0"===a||ir(a)))&&s.push(r);var a;s.length&&function(e,t,s){let a,r=0;for(;r<e.length&&!a;){const t=e[r];"string"==typeof t&&!Co.has(t)&&vn(t).values.length&&(a=e[r]),r++}if(a&&s)for(const n of t)e[n]=_o(s,a)}(e,s,t)}measureInitialState(){const{element:e,unresolvedKeyframes:t,name:s}=this;if(!e||!e.current)return;"height"===s&&(this.suspendedScrollY=window.pageYOffset),this.measuredOrigin=Li[s](e.measureViewportBox(),window.getComputedStyle(e.current)),t[0]=this.measuredOrigin;const a=t[t.length-1];void 0!==a&&e.getValue(s,a).jump(a,!1)}measureEndState(){const{element:e,name:t,unresolvedKeyframes:s}=this;if(!e||!e.current)return;const a=e.getValue(t);a&&a.jump(this.measuredOrigin,!1);const r=s.length-1,n=s[r];s[r]=Li[t](e.measureViewportBox(),window.getComputedStyle(e.current)),null!==n&&void 0===this.finalKeyframe&&(this.finalKeyframe=n),this.removedTransforms?.length&&this.removedTransforms.forEach((([t,s])=>{e.getValue(t).set(s)})),this.resolveNoneKeyframes()}}const Eo=(e,t)=>t&&"number"==typeof e?t.transform(e):e;class ko{constructor(e,t={}){this.canTrackVelocity=null,this.events={},this.updateAndNotify=(e,t=!0)=>{const s=Br.now();if(this.updatedAt!==s&&this.setPrevFrameValue(),this.prev=this.current,this.setCurrent(e),this.current!==this.prev&&(this.events.change?.notify(this.current),this.dependents))for(const a of this.dependents)a.dirty();t&&this.events.renderRequest?.notify(this.current)},this.hasAnimated=!1,this.setCurrent(e),this.owner=t.owner}setCurrent(e){var t;this.current=e,this.updatedAt=Br.now(),null===this.canTrackVelocity&&void 0!==e&&(this.canTrackVelocity=(t=this.current,!isNaN(parseFloat(t))))}setPrevFrameValue(e=this.current){this.prevFrameValue=e,this.prevUpdatedAt=this.updatedAt}onChange(e){return this.on("change",e)}on(e,t){this.events[e]||(this.events[e]=new ur);const s=this.events[e].add(t);return"change"===e?()=>{s(),Lr.read((()=>{this.events.change.getSize()||this.stop()}))}:s}clearListeners(){for(const e in this.events)this.events[e].clear()}attach(e,t){this.passiveEffect=e,this.stopPassiveEffect=t}set(e,t=!0){t&&this.passiveEffect?this.passiveEffect(e,this.updateAndNotify):this.updateAndNotify(e,t)}setWithVelocity(e,t,s){this.set(t),this.prev=void 0,this.prevFrameValue=e,this.prevUpdatedAt=this.updatedAt-s}jump(e,t=!0){this.updateAndNotify(e),this.prev=e,this.prevUpdatedAt=this.prevFrameValue=void 0,t&&this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}dirty(){this.events.change?.notify(this.current)}addDependent(e){this.dependents||(this.dependents=new Set),this.dependents.add(e)}removeDependent(e){this.dependents&&this.dependents.delete(e)}get(){return this.current}getPrevious(){return this.prev}getVelocity(){const e=Br.now();if(!this.canTrackVelocity||void 0===this.prevFrameValue||e-this.updatedAt>30)return 0;const t=Math.min(this.updatedAt-this.prevUpdatedAt,30);return xr(parseFloat(this.current)-parseFloat(this.prevFrameValue),t)}start(e){return this.stop(),new Promise((t=>{this.hasAnimated=!0,this.animation=e(t),this.events.animationStart&&this.events.animationStart.notify()})).then((()=>{this.events.animationComplete&&this.events.animationComplete.notify(),this.clearAnimation()}))}stop(){this.animation&&(this.animation.stop(),this.events.animationCancel&&this.events.animationCancel.notify()),this.clearAnimation()}isAnimating(){return!!this.animation}clearAnimation(){delete this.animation}destroy(){this.dependents?.clear(),this.events.destroy?.notify(),this.clearListeners(),this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}}function Ao(e,t){return new ko(e,t)}const{schedule:Po}=Rr(queueMicrotask,!1),Mo={x:!1,y:!1};function To(){return Mo.x||Mo.y}function qo(e,t){const s=function(e,t,s){if(e instanceof EventTarget)return[e];if("string"==typeof e){let t=document;const a=s?.[e]??t.querySelectorAll(e);return a?Array.from(a):[]}return Array.from(e)}(e),a=new AbortController;return[s,{passive:!0,...t,signal:a.signal},()=>a.abort()]}function Do(e){return!("touch"===e.pointerType||To())}const Ro=(e,t)=>!!t&&(e===t||Ro(e,t.parentElement)),Lo=e=>"mouse"===e.pointerType?"number"!=typeof e.button||e.button<=0:!1!==e.isPrimary,$o=new Set(["BUTTON","INPUT","SELECT","TEXTAREA","A"]);const Io=new WeakSet;function Fo(e){return t=>{"Enter"===t.key&&e(t)}}function Vo(e,t){e.dispatchEvent(new PointerEvent("pointer"+t,{isPrimary:!0,bubbles:!0}))}function Oo(e){return Lo(e)&&!To()}function Bo(e,t,s={}){const[a,r,n]=qo(e,s),i=e=>{const a=e.currentTarget;if(!Oo(e))return;Io.add(a);const n=t(a,e),i=(e,t)=>{window.removeEventListener("pointerup",o),window.removeEventListener("pointercancel",l),Io.has(a)&&Io.delete(a),Oo(e)&&"function"==typeof n&&n(e,{success:t})},o=e=>{i(e,a===window||a===document||s.useGlobalTarget||Ro(a,e.target))},l=e=>{i(e,!1)};window.addEventListener("pointerup",o,r),window.addEventListener("pointercancel",l,r)};return a.forEach((e=>{var t;(s.useGlobalTarget?window:e).addEventListener("pointerdown",i,r),ro(e)&&(e.addEventListener("focus",(e=>((e,t)=>{const s=e.currentTarget;if(!s)return;const a=Fo((()=>{if(Io.has(s))return;Vo(s,"down");const e=Fo((()=>{Vo(s,"up")}));s.addEventListener("keyup",e,t),s.addEventListener("blur",(()=>Vo(s,"cancel")),t)}));s.addEventListener("keydown",a,t),s.addEventListener("blur",(()=>s.removeEventListener("keydown",a)),t)})(e,r))),t=e,$o.has(t.tagName)||-1!==t.tabIndex||e.hasAttribute("tabindex")||(e.tabIndex=0))})),n}function Uo(e){return nr(e)&&"ownerSVGElement"in e}const zo=e=>Boolean(e&&e.getVelocity),Go=[...po,pn,wn],Ho=e.createContext({transformPagePoint:e=>e,isStatic:!1,reducedMotion:"never"});class Xo extends e.Component{getSnapshotBeforeUpdate(e){const t=this.props.childRef.current;if(t&&e.isPresent&&!this.props.isPresent){const e=t.offsetParent,s=ro(e)&&e.offsetWidth||0,a=this.props.sizeRef.current;a.height=t.offsetHeight||0,a.width=t.offsetWidth||0,a.top=t.offsetTop,a.left=t.offsetLeft,a.right=s-a.width-a.left}return null}componentDidUpdate(){}render(){return this.props.children}}function Wo({children:s,isPresent:a,anchorX:r}){const n=e.useId(),i=e.useRef(null),o=e.useRef({width:0,height:0,top:0,left:0,right:0}),{nonce:l}=e.useContext(Ho);return e.useInsertionEffect((()=>{const{width:e,height:t,top:s,left:c,right:d}=o.current;if(a||!i.current||!e||!t)return;const m="left"===r?`left: ${c}`:`right: ${d}`;i.current.dataset.motionPopId=n;const u=document.createElement("style");return l&&(u.nonce=l),document.head.appendChild(u),u.sheet&&u.sheet.insertRule(`\n          [data-motion-pop-id="${n}"] {\n            position: absolute !important;\n            width: ${e}px !important;\n            height: ${t}px !important;\n            ${m}px !important;\n            top: ${s}px !important;\n          }\n        `),()=>{document.head.contains(u)&&document.head.removeChild(u)}}),[a]),t.jsx(Xo,{isPresent:a,childRef:i,sizeRef:o,children:e.cloneElement(s,{ref:i})})}const Yo=({children:s,initial:a,isPresent:r,onExitComplete:n,custom:i,presenceAffectsLayout:o,mode:l,anchorX:c})=>{const d=Ka(Ko),m=e.useId();let u=!0,h=e.useMemo((()=>(u=!1,{id:m,initial:a,isPresent:r,custom:i,onExitComplete:e=>{d.set(e,!0);for(const t of d.values())if(!t)return;n&&n()},register:e=>(d.set(e,!1),()=>d.delete(e))})),[r,d,n]);return o&&u&&(h={...h}),e.useMemo((()=>{d.forEach(((e,t)=>d.set(t,!1)))}),[r]),e.useEffect((()=>{!r&&!d.size&&n&&n()}),[r]),"popLayout"===l&&(s=t.jsx(Wo,{isPresent:r,anchorX:c,children:s})),t.jsx(Za.Provider,{value:h,children:s})};function Ko(){return new Map}function Jo(t=!0){const s=e.useContext(Za);if(null===s)return[!0,null];const{isPresent:a,onExitComplete:r,register:n}=s,i=e.useId();e.useEffect((()=>{if(t)return n(i)}),[t]);const o=e.useCallback((()=>t&&r&&r(i)),[i,r,t]);return!a&&r?[!1,o]:[!0]}const Qo=e=>e.key||"";function Zo(t){const s=[];return e.Children.forEach(t,(t=>{e.isValidElement(t)&&s.push(t)})),s}const el=({children:s,custom:a,initial:r=!0,onExitComplete:n,presenceAffectsLayout:i=!0,mode:o="sync",propagate:l=!1,anchorX:c="left"})=>{const[d,m]=Jo(l),u=e.useMemo((()=>Zo(s)),[s]),h=l&&!d?[]:u.map(Qo),p=e.useRef(!0),x=e.useRef(u),f=Ka((()=>new Map)),[g,b]=e.useState(u),[v,y]=e.useState(u);Qa((()=>{p.current=!1,x.current=u;for(let e=0;e<v.length;e++){const t=Qo(v[e]);h.includes(t)?f.delete(t):!0!==f.get(t)&&f.set(t,!1)}}),[v,h.length,h.join("-")]);const j=[];if(u!==g){let e=[...u];for(let t=0;t<v.length;t++){const s=v[t],a=Qo(s);h.includes(a)||(e.splice(t,0,s),j.push(s))}return"wait"===o&&j.length&&(e=j),y(Zo(e)),b(u),null}const{forceRender:N}=e.useContext(Ya);return t.jsx(t.Fragment,{children:v.map((e=>{const s=Qo(e),g=!(l&&!d)&&(u===v||h.includes(s));return t.jsx(Yo,{isPresent:g,initial:!(p.current&&!r)&&void 0,custom:a,presenceAffectsLayout:i,mode:o,onExitComplete:g?void 0:()=>{if(!f.has(s))return;f.set(s,!0);let e=!0;f.forEach((t=>{t||(e=!1)})),e&&(N?.(),y(x.current),l&&m?.(),n&&n())},anchorX:c,children:e},s)}))})},tl=e.createContext({strict:!1}),sl={animation:["animate","variants","whileHover","whileTap","exit","whileInView","whileFocus","whileDrag"],exit:["exit"],drag:["drag","dragControls"],focus:["whileFocus"],hover:["whileHover","onHoverStart","onHoverEnd"],tap:["whileTap","onTap","onTapStart","onTapCancel"],pan:["onPan","onPanStart","onPanSessionStart","onPanEnd"],inView:["whileInView","onViewportEnter","onViewportLeave"],layout:["layout","layoutId"]},al={};for(const zb in sl)al[zb]={isEnabled:e=>sl[zb].some((t=>!!e[t]))};const rl=new Set(["animate","exit","variants","initial","style","values","variants","transition","transformTemplate","custom","inherit","onBeforeLayoutMeasure","onAnimationStart","onAnimationComplete","onUpdate","onDragStart","onDrag","onDragEnd","onMeasureDragConstraints","onDirectionLock","onDragTransitionEnd","_dragX","_dragY","onHoverStart","onHoverEnd","onViewportEnter","onViewportLeave","globalTapTarget","ignoreStrict","viewport"]);function nl(e){return e.startsWith("while")||e.startsWith("drag")&&"draggable"!==e||e.startsWith("layout")||e.startsWith("onTap")||e.startsWith("onPan")||e.startsWith("onLayout")||rl.has(e)}let il=e=>!nl(e);try{(ol=require("@emotion/is-prop-valid").default)&&(il=e=>e.startsWith("on")?!nl(e):ol(e))}catch{}var ol;function ll(e){if("undefined"==typeof Proxy)return e;const t=new Map;return new Proxy(((...t)=>e(...t)),{get:(s,a)=>"create"===a?e:(t.has(a)||t.set(a,e(a)),t.get(a))})}const cl=e.createContext({});function dl(e){return null!==e&&"object"==typeof e&&"function"==typeof e.start}function ml(e){return"string"==typeof e||Array.isArray(e)}const ul=["animate","whileInView","whileFocus","whileHover","whileTap","whileDrag","exit"],hl=["initial",...ul];function pl(e){return dl(e.animate)||hl.some((t=>ml(e[t])))}function xl(e){return Boolean(pl(e)||e.variants)}function fl(t){const{initial:s,animate:a}=function(e,t){if(pl(e)){const{initial:t,animate:s}=e;return{initial:!1===t||ml(t)?t:void 0,animate:ml(s)?s:void 0}}return!1!==e.inherit?t:{}}(t,e.useContext(cl));return e.useMemo((()=>({initial:s,animate:a})),[gl(s),gl(a)])}function gl(e){return Array.isArray(e)?e.join(" "):e}const bl=Symbol.for("motionComponentSymbol");function vl(e){return e&&"object"==typeof e&&Object.prototype.hasOwnProperty.call(e,"current")}function yl(t,s,a){return e.useCallback((e=>{e&&t.onMount&&t.onMount(e),s&&(e?s.mount(e):s.unmount()),a&&("function"==typeof a?a(e):vl(a)&&(a.current=e))}),[s])}const jl=e=>e.replace(/([a-z])([A-Z])/gu,"$1-$2").toLowerCase(),Nl="data-"+jl("framerAppearId"),wl=e.createContext({});function _l(t,s,a,r,n){const{visualElement:i}=e.useContext(cl),o=e.useContext(tl),l=e.useContext(Za),c=e.useContext(Ho).reducedMotion,d=e.useRef(null);r=r||o.renderer,!d.current&&r&&(d.current=r(t,{visualState:s,parent:i,props:a,presenceContext:l,blockInitialAnimation:!!l&&!1===l.initial,reducedMotionConfig:c}));const m=d.current,u=e.useContext(wl);!m||m.projection||!n||"html"!==m.type&&"svg"!==m.type||function(e,t,s,a){const{layoutId:r,layout:n,drag:i,dragConstraints:o,layoutScroll:l,layoutRoot:c,layoutCrossfade:d}=t;e.projection=new s(e.latestValues,t["data-framer-portal-id"]?void 0:Cl(e.parent)),e.projection.setOptions({layoutId:r,layout:n,alwaysMeasureLayout:Boolean(i)||o&&vl(o),visualElement:e,animationType:"string"==typeof n?n:"both",initialPromotionConfig:a,crossfade:d,layoutScroll:l,layoutRoot:c})}(d.current,a,n,u);const h=e.useRef(!1);e.useInsertionEffect((()=>{m&&h.current&&m.update(a,l)}));const p=a[Nl],x=e.useRef(Boolean(p)&&!window.MotionHandoffIsComplete?.(p)&&window.MotionHasOptimisedAnimation?.(p));return Qa((()=>{m&&(h.current=!0,window.MotionIsMounted=!0,m.updateFeatures(),Po.render(m.render),x.current&&m.animationState&&m.animationState.animateChanges())})),e.useEffect((()=>{m&&(!x.current&&m.animationState&&m.animationState.animateChanges(),x.current&&(queueMicrotask((()=>{window.MotionHandoffMarkAsComplete?.(p)})),x.current=!1))})),m}function Cl(e){if(e)return!1!==e.options.allowProjection?e.projection:Cl(e.parent)}function Sl({preloadedFeatures:s,createVisualElement:a,useRender:r,useVisualState:n,Component:i}){function o(s,o){let l;const c={...e.useContext(Ho),...s,layoutId:El(s)},{isStatic:d}=c,m=fl(s),u=n(s,d);if(!d&&Ja){e.useContext(tl).strict;const t=function(e){const{drag:t,layout:s}=al;if(!t&&!s)return{};const a={...t,...s};return{MeasureLayout:t?.isEnabled(e)||s?.isEnabled(e)?a.MeasureLayout:void 0,ProjectionNode:a.ProjectionNode}}(c);l=t.MeasureLayout,m.visualElement=_l(i,u,c,a,t.ProjectionNode)}return t.jsxs(cl.Provider,{value:m,children:[l&&m.visualElement?t.jsx(l,{visualElement:m.visualElement,...c}):null,r(i,s,yl(u,m.visualElement,o),u,d,m.visualElement)]})}s&&function(e){for(const t in e)al[t]={...al[t],...e[t]}}(s),o.displayName=`motion.${"string"==typeof i?i:`create(${i.displayName??i.name??""})`}`;const l=e.forwardRef(o);return l[bl]=i,l}function El({layoutId:t}){const s=e.useContext(Ya).id;return s&&void 0!==t?s+"-"+t:t}const kl={};function Al(e,{layout:t,layoutId:s}){return Ti.has(e)||e.startsWith("origin")||(t||void 0!==s)&&(!!kl[e]||"opacity"===e)}const Pl={x:"translateX",y:"translateY",z:"translateZ",transformPerspective:"perspective"},Ml=Mi.length;function Tl(e,t,s){const{style:a,vars:r,transformOrigin:n}=e;let i=!1,o=!1;for(const l in t){const e=t[l];if(Ti.has(l))i=!0;else if(zr(l))r[l]=e;else{const t=Eo(e,jo[l]);l.startsWith("origin")?(o=!0,n[l]=t):a[l]=t}}if(t.transform||(i||s?a.transform=function(e,t,s){let a="",r=!0;for(let n=0;n<Ml;n++){const i=Mi[n],o=e[i];if(void 0===o)continue;let l=!0;if(l="number"==typeof o?o===(i.startsWith("scale")?1:0):0===parseFloat(o),!l||s){const e=Eo(o,jo[i]);l||(r=!1,a+=`${Pl[i]||i}(${e}) `),s&&(t[i]=e)}}return a=a.trim(),s?a=s(t,r?"":a):r&&(a="none"),a}(t,e.transform,s):a.transform&&(a.transform="none")),o){const{originX:e="50%",originY:t="50%",originZ:s=0}=n;a.transformOrigin=`${e} ${t} ${s}`}}const ql=()=>({style:{},transform:{},transformOrigin:{},vars:{}});function Dl(e,t,s){for(const a in t)zo(t[a])||Al(a,s)||(e[a]=t[a])}function Rl(t,s){const a={};return Dl(a,t.style||{},t),Object.assign(a,function({transformTemplate:t},s){return e.useMemo((()=>{const e={style:{},transform:{},transformOrigin:{},vars:{}};return Tl(e,s,t),Object.assign({},e.vars,e.style)}),[s])}(t,s)),a}function Ll(e,t){const s={},a=Rl(e,t);return e.drag&&!1!==e.dragListener&&(s.draggable=!1,a.userSelect=a.WebkitUserSelect=a.WebkitTouchCallout="none",a.touchAction=!0===e.drag?"none":"pan-"+("x"===e.drag?"y":"x")),void 0===e.tabIndex&&(e.onTap||e.onTapStart||e.whileTap)&&(s.tabIndex=0),s.style=a,s}const $l={offset:"stroke-dashoffset",array:"stroke-dasharray"},Il={offset:"strokeDashoffset",array:"strokeDasharray"};function Fl(e,{attrX:t,attrY:s,attrScale:a,pathLength:r,pathSpacing:n=1,pathOffset:i=0,...o},l,c,d){if(Tl(e,o,c),l)return void(e.style.viewBox&&(e.attrs.viewBox=e.style.viewBox));e.attrs=e.style,e.style={};const{attrs:m,style:u}=e;m.transform&&(u.transform=m.transform,delete m.transform),(u.transform||m.transformOrigin)&&(u.transformOrigin=m.transformOrigin??"50% 50%",delete m.transformOrigin),u.transform&&(u.transformBox=d?.transformBox??"fill-box",delete m.transformBox),void 0!==t&&(m.x=t),void 0!==s&&(m.y=s),void 0!==a&&(m.scale=a),void 0!==r&&function(e,t,s=1,a=0,r=!0){e.pathLength=1;const n=r?$l:Il;e[n.offset]=cn.transform(-a);const i=cn.transform(t),o=cn.transform(s);e[n.array]=`${i} ${o}`}(m,r,n,i,!1)}const Vl=()=>({style:{},transform:{},transformOrigin:{},vars:{},attrs:{}}),Ol=e=>"string"==typeof e&&"svg"===e.toLowerCase();function Bl(t,s,a,r){const n=e.useMemo((()=>{const e={style:{},transform:{},transformOrigin:{},vars:{},attrs:{}};return Fl(e,s,Ol(r),t.transformTemplate,t.style),{...e.attrs,style:{...e.style}}}),[s]);if(t.style){const e={};Dl(e,t.style,t),n.style={...e,...n.style}}return n}const Ul=["animate","circle","defs","desc","ellipse","g","image","line","filter","marker","mask","metadata","path","pattern","polygon","polyline","rect","stop","switch","symbol","svg","text","tspan","use","view"];function zl(e){return"string"==typeof e&&!e.includes("-")&&!!(Ul.indexOf(e)>-1||/[A-Z]/u.test(e))}function Gl(t=!1){return(s,a,r,{latestValues:n},i)=>{const o=(zl(s)?Bl:Ll)(a,n,i,s),l=function(e,t,s){const a={};for(const r in e)"values"===r&&"object"==typeof e.values||(il(r)||!0===s&&nl(r)||!t&&!nl(r)||e.draggable&&r.startsWith("onDrag"))&&(a[r]=e[r]);return a}(a,"string"==typeof s,t),c=s!==e.Fragment?{...l,...o,ref:r}:{},{children:d}=a,m=e.useMemo((()=>zo(d)?d.get():d),[d]);return e.createElement(s,{...c,children:m})}}function Hl(e){const t=[{},{}];return e?.values.forEach(((e,s)=>{t[0][s]=e.get(),t[1][s]=e.getVelocity()})),t}function Xl(e,t,s,a){if("function"==typeof t){const[r,n]=Hl(a);t=t(void 0!==s?s:e.custom,r,n)}if("string"==typeof t&&(t=e.variants&&e.variants[t]),"function"==typeof t){const[r,n]=Hl(a);t=t(void 0!==s?s:e.custom,r,n)}return t}function Wl(e){return zo(e)?e.get():e}const Yl=t=>(s,a)=>{const r=e.useContext(cl),n=e.useContext(Za),i=()=>function({scrapeMotionValuesFromProps:e,createRenderState:t},s,a,r){return{latestValues:Kl(s,a,r,e),renderState:t()}}(t,s,r,n);return a?i():Ka(i)};function Kl(e,t,s,a){const r={},n=a(e,{});for(const u in n)r[u]=Wl(n[u]);let{initial:i,animate:o}=e;const l=pl(e),c=xl(e);t&&c&&!l&&!1!==e.inherit&&(void 0===i&&(i=t.initial),void 0===o&&(o=t.animate));let d=!!s&&!1===s.initial;d=d||!1===i;const m=d?o:i;if(m&&"boolean"!=typeof m&&!dl(m)){const t=Array.isArray(m)?m:[m];for(let s=0;s<t.length;s++){const a=Xl(e,t[s]);if(a){const{transitionEnd:e,transition:t,...s}=a;for(const a in s){let e=s[a];if(Array.isArray(e)){e=e[d?e.length-1:0]}null!==e&&(r[a]=e)}for(const a in e)r[a]=e[a]}}}return r}function Jl(e,t,s){const{style:a}=e,r={};for(const n in a)(zo(a[n])||t.style&&zo(t.style[n])||Al(n,e)||void 0!==s?.getValue(n)?.liveStyle)&&(r[n]=a[n]);return r}const Ql={useVisualState:Yl({scrapeMotionValuesFromProps:Jl,createRenderState:ql})};function Zl(e,t,s){const a=Jl(e,t,s);for(const r in e)if(zo(e[r])||zo(t[r])){a[-1!==Mi.indexOf(r)?"attr"+r.charAt(0).toUpperCase()+r.substring(1):r]=e[r]}return a}const ec={useVisualState:Yl({scrapeMotionValuesFromProps:Zl,createRenderState:Vl})};function tc(e,t){return function(s,{forwardMotionProps:a}={forwardMotionProps:!1}){return Sl({...zl(s)?ec:Ql,preloadedFeatures:e,useRender:Gl(a),createVisualElement:t,Component:s})}}function sc(e,t,s){const a=e.getProps();return Xl(a,t,void 0!==s?s:a.custom,e)}const ac=e=>Array.isArray(e);function rc(e,t,s){e.hasValue(t)?e.getValue(t).set(s):e.addValue(t,Ao(s))}function nc(e){return ac(e)?e[e.length-1]||0:e}function ic(e,t){const s=e.getValue("willChange");if(a=s,Boolean(zo(a)&&a.add))return s.add(t);if(!s&&ar.WillChange){const s=new ar.WillChange("auto");e.addValue("willChange",s),s.add(t)}var a}function oc(e){return e.props[Nl]}const lc=e=>null!==e;const cc={type:"spring",stiffness:500,damping:25,restSpeed:10},dc={type:"keyframes",duration:.8},mc={type:"keyframes",ease:[.25,.1,.35,1],duration:.3},uc=(e,{keyframes:t})=>t.length>2?dc:Ti.has(e)?e.startsWith("scale")?{type:"spring",stiffness:550,damping:0===t[1]?2*Math.sqrt(550):30,restSpeed:10}:cc:mc;const hc=(e,t,s,a={},r,n)=>i=>{const o=mo(a,e)||{},l=o.delay||a.delay||0;let{elapsed:c=0}=a;c-=hr(l);const d={keyframes:Array.isArray(s)?s:[null,s],ease:"easeOut",velocity:t.getVelocity(),...o,delay:-c,onUpdate:e=>{t.set(e),o.onUpdate&&o.onUpdate(e)},onComplete:()=>{i(),o.onComplete&&o.onComplete()},name:e,motionValue:t,element:n?void 0:r};(function({when:e,delay:t,delayChildren:s,staggerChildren:a,staggerDirection:r,repeat:n,repeatType:i,repeatDelay:o,from:l,elapsed:c,...d}){return!!Object.keys(d).length})(o)||Object.assign(d,uc(e,d)),d.duration&&(d.duration=hr(d.duration)),d.repeatDelay&&(d.repeatDelay=hr(d.repeatDelay)),void 0!==d.from&&(d.keyframes[0]=d.from);let m=!1;if((!1===d.type||0===d.duration&&!d.repeatDelay)&&(d.duration=0,0===d.delay&&(m=!0)),(ar.instantAnimations||ar.skipAnimations)&&(m=!0,d.duration=0,d.delay=0),d.allowFlatten=!o.type&&!o.ease,m&&!n&&void 0!==t.get()){const e=function(e,{repeat:t,repeatType:s="loop"}){const a=e.filter(lc);return a[t&&"loop"!==s&&t%2==1?0:a.length-1]}(d.keyframes,o);if(void 0!==e)return void Lr.update((()=>{d.onUpdate(e),d.onComplete()}))}return o.isSync?new yi(d):new oo(d)};function pc({protectedKeys:e,needsAnimating:t},s){const a=e.hasOwnProperty(s)&&!0!==t[s];return t[s]=!1,a}function xc(e,t,{delay:s=0,transitionOverride:a,type:r}={}){let{transition:n=e.getDefaultTransition(),transitionEnd:i,...o}=t;a&&(n=a);const l=[],c=r&&e.animationState&&e.animationState.getState()[r];for(const d in o){const t=e.getValue(d,e.latestValues[d]??null),a=o[d];if(void 0===a||c&&pc(c,d))continue;const r={delay:s,...mo(n||{},d)},i=t.get();if(void 0!==i&&!t.isAnimating&&!Array.isArray(a)&&a===i&&!r.velocity)continue;let m=!1;if(window.MotionHandoffAnimation){const t=oc(e);if(t){const e=window.MotionHandoffAnimation(t,d,Lr);null!==e&&(r.startTime=e,m=!0)}}ic(e,d),t.start(hc(d,t,a,e.shouldReduceMotion&&uo.has(d)?{type:!1}:r,e,m));const u=t.animation;u&&l.push(u)}return i&&Promise.all(l).then((()=>{Lr.update((()=>{i&&function(e,t){const s=sc(e,t);let{transitionEnd:a={},transition:r={},...n}=s||{};n={...n,...a};for(const i in n)rc(e,i,nc(n[i]))}(e,i)}))})),l}function fc(e,t,s={}){const a=sc(e,t,"exit"===s.type?e.presenceContext?.custom:void 0);let{transition:r=e.getDefaultTransition()||{}}=a||{};s.transitionOverride&&(r=s.transitionOverride);const n=a?()=>Promise.all(xc(e,a,s)):()=>Promise.resolve(),i=e.variantChildren&&e.variantChildren.size?(a=0)=>{const{delayChildren:n=0,staggerChildren:i,staggerDirection:o}=r;return function(e,t,s=0,a=0,r=1,n){const i=[],o=(e.variantChildren.size-1)*a,l=1===r?(e=0)=>e*a:(e=0)=>o-e*a;return Array.from(e.variantChildren).sort(gc).forEach(((e,a)=>{e.notify("AnimationStart",t),i.push(fc(e,t,{...n,delay:s+l(a)}).then((()=>e.notify("AnimationComplete",t))))})),Promise.all(i)}(e,t,n+a,i,o,s)}:()=>Promise.resolve(),{when:o}=r;if(o){const[e,t]="beforeChildren"===o?[n,i]:[i,n];return e().then((()=>t()))}return Promise.all([n(),i(s.delay)])}function gc(e,t){return e.sortNodePosition(t)}function bc(e,t){if(!Array.isArray(t))return!1;const s=t.length;if(s!==e.length)return!1;for(let a=0;a<s;a++)if(t[a]!==e[a])return!1;return!0}const vc=hl.length;function yc(e){if(!e)return;if(!e.isControllingVariants){const t=e.parent&&yc(e.parent)||{};return void 0!==e.props.initial&&(t.initial=e.props.initial),t}const t={};for(let s=0;s<vc;s++){const a=hl[s],r=e.props[a];(ml(r)||!1===r)&&(t[a]=r)}return t}const jc=[...ul].reverse(),Nc=ul.length;function wc(e){return t=>Promise.all(t.map((({animation:t,options:s})=>function(e,t,s={}){let a;if(e.notify("AnimationStart",t),Array.isArray(t)){const r=t.map((t=>fc(e,t,s)));a=Promise.all(r)}else if("string"==typeof t)a=fc(e,t,s);else{const r="function"==typeof t?sc(e,t,s.custom):t;a=Promise.all(xc(e,r,s))}return a.then((()=>{e.notify("AnimationComplete",t)}))}(e,t,s))))}function _c(e){let t=wc(e),s=Ec(),a=!0;const r=t=>(s,a)=>{const r=sc(e,a,"exit"===t?e.presenceContext?.custom:void 0);if(r){const{transition:e,transitionEnd:t,...a}=r;s={...s,...a,...t}}return s};function n(n){const{props:i}=e,o=yc(e.parent)||{},l=[],c=new Set;let d={},m=1/0;for(let t=0;t<Nc;t++){const u=jc[t],h=s[u],p=void 0!==i[u]?i[u]:o[u],x=ml(p),f=u===n?h.isActive:null;!1===f&&(m=t);let g=p===o[u]&&p!==i[u]&&x;if(g&&a&&e.manuallyAnimateOnMount&&(g=!1),h.protectedKeys={...d},!h.isActive&&null===f||!p&&!h.prevProp||dl(p)||"boolean"==typeof p)continue;const b=Cc(h.prevProp,p);let v=b||u===n&&h.isActive&&!g&&x||t>m&&x,y=!1;const j=Array.isArray(p)?p:[p];let N=j.reduce(r(u),{});!1===f&&(N={});const{prevResolvedValues:w={}}=h,_={...w,...N},C=t=>{v=!0,c.has(t)&&(y=!0,c.delete(t)),h.needsAnimating[t]=!0;const s=e.getValue(t);s&&(s.liveStyle=!1)};for(const e in _){const t=N[e],s=w[e];if(d.hasOwnProperty(e))continue;let a=!1;a=ac(t)&&ac(s)?!bc(t,s):t!==s,a?null!=t?C(e):c.add(e):void 0!==t&&c.has(e)?C(e):h.protectedKeys[e]=!0}h.prevProp=p,h.prevResolvedValues=N,h.isActive&&(d={...d,...N}),a&&e.blockInitialAnimation&&(v=!1);v&&(!(g&&b)||y)&&l.push(...j.map((e=>({animation:e,options:{type:u}}))))}if(c.size){const t={};if("boolean"!=typeof i.initial){const s=sc(e,Array.isArray(i.initial)?i.initial[0]:i.initial);s&&s.transition&&(t.transition=s.transition)}c.forEach((s=>{const a=e.getBaseTarget(s),r=e.getValue(s);r&&(r.liveStyle=!0),t[s]=a??null})),l.push({animation:t})}let u=Boolean(l.length);return!a||!1!==i.initial&&i.initial!==i.animate||e.manuallyAnimateOnMount||(u=!1),a=!1,u?t(l):Promise.resolve()}return{animateChanges:n,setActive:function(t,a){if(s[t].isActive===a)return Promise.resolve();e.variantChildren?.forEach((e=>e.animationState?.setActive(t,a))),s[t].isActive=a;const r=n(t);for(const e in s)s[e].protectedKeys={};return r},setAnimateFunction:function(s){t=s(e)},getState:()=>s,reset:()=>{s=Ec(),a=!0}}}function Cc(e,t){return"string"==typeof t?t!==e:!!Array.isArray(t)&&!bc(t,e)}function Sc(e=!1){return{isActive:e,protectedKeys:{},needsAnimating:{},prevResolvedValues:{}}}function Ec(){return{animate:Sc(!0),whileInView:Sc(),whileHover:Sc(),whileTap:Sc(),whileDrag:Sc(),whileFocus:Sc(),exit:Sc()}}class kc{constructor(e){this.isMounted=!1,this.node=e}update(){}}let Ac=0;const Pc={animation:{Feature:class extends kc{constructor(e){super(e),e.animationState||(e.animationState=_c(e))}updateAnimationControlsSubscription(){const{animate:e}=this.node.getProps();dl(e)&&(this.unmountControls=e.subscribe(this.node))}mount(){this.updateAnimationControlsSubscription()}update(){const{animate:e}=this.node.getProps(),{animate:t}=this.node.prevProps||{};e!==t&&this.updateAnimationControlsSubscription()}unmount(){this.node.animationState.reset(),this.unmountControls?.()}}},exit:{Feature:class extends kc{constructor(){super(...arguments),this.id=Ac++}update(){if(!this.node.presenceContext)return;const{isPresent:e,onExitComplete:t}=this.node.presenceContext,{isPresent:s}=this.node.prevPresenceContext||{};if(!this.node.animationState||e===s)return;const a=this.node.animationState.setActive("exit",!e);t&&!e&&a.then((()=>{t(this.id)}))}mount(){const{register:e,onExitComplete:t}=this.node.presenceContext||{};t&&t(this.id),e&&(this.unmount=e(this.id))}unmount(){}}}};function Mc(e,t,s,a={passive:!0}){return e.addEventListener(t,s,a),()=>e.removeEventListener(t,s)}function Tc(e){return{point:{x:e.pageX,y:e.pageY}}}function qc(e,t,s,a){return Mc(e,t,(e=>t=>Lo(t)&&e(t,Tc(t)))(s),a)}function Dc({top:e,left:t,right:s,bottom:a}){return{x:{min:t,max:s},y:{min:e,max:a}}}function Rc(e){return e.max-e.min}function Lc(e,t,s,a=.5){e.origin=a,e.originPoint=Sn(t.min,t.max,e.origin),e.scale=Rc(s)/Rc(t),e.translate=Sn(s.min,s.max,e.origin)-e.originPoint,(e.scale>=.9999&&e.scale<=1.0001||isNaN(e.scale))&&(e.scale=1),(e.translate>=-.01&&e.translate<=.01||isNaN(e.translate))&&(e.translate=0)}function $c(e,t,s,a){Lc(e.x,t.x,s.x,a?a.originX:void 0),Lc(e.y,t.y,s.y,a?a.originY:void 0)}function Ic(e,t,s){e.min=s.min+t.min,e.max=e.min+Rc(t)}function Fc(e,t,s){e.min=t.min-s.min,e.max=e.min+Rc(t)}function Vc(e,t,s){Fc(e.x,t.x,s.x),Fc(e.y,t.y,s.y)}const Oc=()=>({x:{min:0,max:0},y:{min:0,max:0}});function Bc(e){return[e("x"),e("y")]}function Uc(e){return void 0===e||1===e}function zc({scale:e,scaleX:t,scaleY:s}){return!Uc(e)||!Uc(t)||!Uc(s)}function Gc(e){return zc(e)||Hc(e)||e.z||e.rotate||e.rotateX||e.rotateY||e.skewX||e.skewY}function Hc(e){return Xc(e.x)||Xc(e.y)}function Xc(e){return e&&"0%"!==e}function Wc(e,t,s){return s+t*(e-s)}function Yc(e,t,s,a,r){return void 0!==r&&(e=Wc(e,r,a)),Wc(e,s,a)+t}function Kc(e,t=0,s=1,a,r){e.min=Yc(e.min,t,s,a,r),e.max=Yc(e.max,t,s,a,r)}function Jc(e,{x:t,y:s}){Kc(e.x,t.translate,t.scale,t.originPoint),Kc(e.y,s.translate,s.scale,s.originPoint)}const Qc=.999999999999,Zc=1.0000000000001;function ed(e,t){e.min=e.min+t,e.max=e.max+t}function td(e,t,s,a,r=.5){Kc(e,t,s,Sn(e.min,e.max,r),a)}function sd(e,t){td(e.x,t.x,t.scaleX,t.scale,t.originX),td(e.y,t.y,t.scaleY,t.scale,t.originY)}function ad(e,t){return Dc(function(e,t){if(!t)return e;const s=t({x:e.left,y:e.top}),a=t({x:e.right,y:e.bottom});return{top:s.y,left:s.x,bottom:a.y,right:a.x}}(e.getBoundingClientRect(),t))}const rd=({current:e})=>e?e.ownerDocument.defaultView:null,nd=(e,t)=>Math.abs(e-t);class id{constructor(e,t,{transformPagePoint:s,contextWindow:a,dragSnapToOrigin:r=!1}={}){if(this.startEvent=null,this.lastMoveEvent=null,this.lastMoveEventInfo=null,this.handlers={},this.contextWindow=window,this.updatePoint=()=>{if(!this.lastMoveEvent||!this.lastMoveEventInfo)return;const e=cd(this.lastMoveEventInfo,this.history),t=null!==this.startEvent,s=function(e,t){const s=nd(e.x,t.x),a=nd(e.y,t.y);return Math.sqrt(s**2+a**2)}(e.offset,{x:0,y:0})>=3;if(!t&&!s)return;const{point:a}=e,{timestamp:r}=Ir;this.history.push({...a,timestamp:r});const{onStart:n,onMove:i}=this.handlers;t||(n&&n(this.lastMoveEvent,e),this.startEvent=this.lastMoveEvent),i&&i(this.lastMoveEvent,e)},this.handlePointerMove=(e,t)=>{this.lastMoveEvent=e,this.lastMoveEventInfo=od(t,this.transformPagePoint),Lr.update(this.updatePoint,!0)},this.handlePointerUp=(e,t)=>{this.end();const{onEnd:s,onSessionEnd:a,resumeAnimation:r}=this.handlers;if(this.dragSnapToOrigin&&r&&r(),!this.lastMoveEvent||!this.lastMoveEventInfo)return;const n=cd("pointercancel"===e.type?this.lastMoveEventInfo:od(t,this.transformPagePoint),this.history);this.startEvent&&s&&s(e,n),a&&a(e,n)},!Lo(e))return;this.dragSnapToOrigin=r,this.handlers=t,this.transformPagePoint=s,this.contextWindow=a||window;const n=od(Tc(e),this.transformPagePoint),{point:i}=n,{timestamp:o}=Ir;this.history=[{...i,timestamp:o}];const{onSessionStart:l}=t;l&&l(e,cd(n,this.history)),this.removeListeners=dr(qc(this.contextWindow,"pointermove",this.handlePointerMove),qc(this.contextWindow,"pointerup",this.handlePointerUp),qc(this.contextWindow,"pointercancel",this.handlePointerUp))}updateHandlers(e){this.handlers=e}end(){this.removeListeners&&this.removeListeners(),$r(this.updatePoint)}}function od(e,t){return t?{point:t(e.point)}:e}function ld(e,t){return{x:e.x-t.x,y:e.y-t.y}}function cd({point:e},t){return{point:e,delta:ld(e,md(t)),offset:ld(e,dd(t)),velocity:ud(t,.1)}}function dd(e){return e[0]}function md(e){return e[e.length-1]}function ud(e,t){if(e.length<2)return{x:0,y:0};let s=e.length-1,a=null;const r=md(e);for(;s>=0&&(a=e[s],!(r.timestamp-a.timestamp>hr(t)));)s--;if(!a)return{x:0,y:0};const n=pr(r.timestamp-a.timestamp);if(0===n)return{x:0,y:0};const i={x:(r.x-a.x)/n,y:(r.y-a.y)/n};return i.x===1/0&&(i.x=0),i.y===1/0&&(i.y=0),i}function hd(e,t,s){return{min:void 0!==t?e.min+t:void 0,max:void 0!==s?e.max+s-(e.max-e.min):void 0}}function pd(e,t){let s=t.min-e.min,a=t.max-e.max;return t.max-t.min<e.max-e.min&&([s,a]=[a,s]),{min:s,max:a}}const xd=.35;function fd(e,t,s){return{min:gd(e,t),max:gd(e,s)}}function gd(e,t){return"number"==typeof e?e:e[t]||0}const bd=new WeakMap;class vd{constructor(e){this.openDragLock=null,this.isDragging=!1,this.currentDirection=null,this.originPoint={x:0,y:0},this.constraints=!1,this.hasMutatedConstraints=!1,this.elastic={x:{min:0,max:0},y:{min:0,max:0}},this.visualElement=e}start(e,{snapToCursor:t=!1}={}){const{presenceContext:s}=this.visualElement;if(s&&!1===s.isPresent)return;const{dragSnapToOrigin:a}=this.getProps();this.panSession=new id(e,{onSessionStart:e=>{const{dragSnapToOrigin:s}=this.getProps();s?this.pauseAnimation():this.stopAnimation(),t&&this.snapToCursor(Tc(e).point)},onStart:(e,t)=>{const{drag:s,dragPropagation:a,onDragStart:r}=this.getProps();if(s&&!a&&(this.openDragLock&&this.openDragLock(),this.openDragLock="x"===(n=s)||"y"===n?Mo[n]?null:(Mo[n]=!0,()=>{Mo[n]=!1}):Mo.x||Mo.y?null:(Mo.x=Mo.y=!0,()=>{Mo.x=Mo.y=!1}),!this.openDragLock))return;var n;this.isDragging=!0,this.currentDirection=null,this.resolveConstraints(),this.visualElement.projection&&(this.visualElement.projection.isAnimationBlocked=!0,this.visualElement.projection.target=void 0),Bc((e=>{let t=this.getAxisMotionValue(e).get()||0;if(ln.test(t)){const{projection:s}=this.visualElement;if(s&&s.layout){const a=s.layout.layoutBox[e];if(a){t=Rc(a)*(parseFloat(t)/100)}}}this.originPoint[e]=t})),r&&Lr.postRender((()=>r(e,t))),ic(this.visualElement,"transform");const{animationState:i}=this.visualElement;i&&i.setActive("whileDrag",!0)},onMove:(e,t)=>{const{dragPropagation:s,dragDirectionLock:a,onDirectionLock:r,onDrag:n}=this.getProps();if(!s&&!this.openDragLock)return;const{offset:i}=t;if(a&&null===this.currentDirection)return this.currentDirection=function(e,t=10){let s=null;Math.abs(e.y)>t?s="y":Math.abs(e.x)>t&&(s="x");return s}(i),void(null!==this.currentDirection&&r&&r(this.currentDirection));this.updateAxis("x",t.point,i),this.updateAxis("y",t.point,i),this.visualElement.render(),n&&n(e,t)},onSessionEnd:(e,t)=>this.stop(e,t),resumeAnimation:()=>Bc((e=>"paused"===this.getAnimationState(e)&&this.getAxisMotionValue(e).animation?.play()))},{transformPagePoint:this.visualElement.getTransformPagePoint(),dragSnapToOrigin:a,contextWindow:rd(this.visualElement)})}stop(e,t){const s=this.isDragging;if(this.cancel(),!s)return;const{velocity:a}=t;this.startAnimation(a);const{onDragEnd:r}=this.getProps();r&&Lr.postRender((()=>r(e,t)))}cancel(){this.isDragging=!1;const{projection:e,animationState:t}=this.visualElement;e&&(e.isAnimationBlocked=!1),this.panSession&&this.panSession.end(),this.panSession=void 0;const{dragPropagation:s}=this.getProps();!s&&this.openDragLock&&(this.openDragLock(),this.openDragLock=null),t&&t.setActive("whileDrag",!1)}updateAxis(e,t,s){const{drag:a}=this.getProps();if(!s||!yd(e,a,this.currentDirection))return;const r=this.getAxisMotionValue(e);let n=this.originPoint[e]+s[e];this.constraints&&this.constraints[e]&&(n=function(e,{min:t,max:s},a){return void 0!==t&&e<t?e=a?Sn(t,e,a.min):Math.max(e,t):void 0!==s&&e>s&&(e=a?Sn(s,e,a.max):Math.min(e,s)),e}(n,this.constraints[e],this.elastic[e])),r.set(n)}resolveConstraints(){const{dragConstraints:e,dragElastic:t}=this.getProps(),s=this.visualElement.projection&&!this.visualElement.projection.layout?this.visualElement.projection.measure(!1):this.visualElement.projection?.layout,a=this.constraints;e&&vl(e)?this.constraints||(this.constraints=this.resolveRefConstraints()):this.constraints=!(!e||!s)&&function(e,{top:t,left:s,bottom:a,right:r}){return{x:hd(e.x,s,r),y:hd(e.y,t,a)}}(s.layoutBox,e),this.elastic=function(e=xd){return!1===e?e=0:!0===e&&(e=xd),{x:fd(e,"left","right"),y:fd(e,"top","bottom")}}(t),a!==this.constraints&&s&&this.constraints&&!this.hasMutatedConstraints&&Bc((e=>{!1!==this.constraints&&this.getAxisMotionValue(e)&&(this.constraints[e]=function(e,t){const s={};return void 0!==t.min&&(s.min=t.min-e.min),void 0!==t.max&&(s.max=t.max-e.min),s}(s.layoutBox[e],this.constraints[e]))}))}resolveRefConstraints(){const{dragConstraints:e,onMeasureDragConstraints:t}=this.getProps();if(!e||!vl(e))return!1;const s=e.current,{projection:a}=this.visualElement;if(!a||!a.layout)return!1;const r=function(e,t,s){const a=ad(e,s),{scroll:r}=t;return r&&(ed(a.x,r.offset.x),ed(a.y,r.offset.y)),a}(s,a.root,this.visualElement.getTransformPagePoint());let n=function(e,t){return{x:pd(e.x,t.x),y:pd(e.y,t.y)}}(a.layout.layoutBox,r);if(t){const e=t(function({x:e,y:t}){return{top:t.min,right:e.max,bottom:t.max,left:e.min}}(n));this.hasMutatedConstraints=!!e,e&&(n=Dc(e))}return n}startAnimation(e){const{drag:t,dragMomentum:s,dragElastic:a,dragTransition:r,dragSnapToOrigin:n,onDragTransitionEnd:i}=this.getProps(),o=this.constraints||{},l=Bc((i=>{if(!yd(i,t,this.currentDirection))return;let l=o&&o[i]||{};n&&(l={min:0,max:0});const c=a?200:1e6,d=a?40:1e7,m={type:"inertia",velocity:s?e[i]:0,bounceStiffness:c,bounceDamping:d,timeConstant:750,restDelta:1,restSpeed:10,...r,...l};return this.startAxisValueAnimation(i,m)}));return Promise.all(l).then(i)}startAxisValueAnimation(e,t){const s=this.getAxisMotionValue(e);return ic(this.visualElement,e),s.start(hc(e,s,0,t,this.visualElement,!1))}stopAnimation(){Bc((e=>this.getAxisMotionValue(e).stop()))}pauseAnimation(){Bc((e=>this.getAxisMotionValue(e).animation?.pause()))}getAnimationState(e){return this.getAxisMotionValue(e).animation?.state}getAxisMotionValue(e){const t=`_drag${e.toUpperCase()}`,s=this.visualElement.getProps(),a=s[t];return a||this.visualElement.getValue(e,(s.initial?s.initial[e]:void 0)||0)}snapToCursor(e){Bc((t=>{const{drag:s}=this.getProps();if(!yd(t,s,this.currentDirection))return;const{projection:a}=this.visualElement,r=this.getAxisMotionValue(t);if(a&&a.layout){const{min:s,max:n}=a.layout.layoutBox[t];r.set(e[t]-Sn(s,n,.5))}}))}scalePositionWithinConstraints(){if(!this.visualElement.current)return;const{drag:e,dragConstraints:t}=this.getProps(),{projection:s}=this.visualElement;if(!vl(t)||!s||!this.constraints)return;this.stopAnimation();const a={x:0,y:0};Bc((e=>{const t=this.getAxisMotionValue(e);if(t&&!1!==this.constraints){const s=t.get();a[e]=function(e,t){let s=.5;const a=Rc(e),r=Rc(t);return r>a?s=mr(t.min,t.max-a,e.min):a>r&&(s=mr(e.min,e.max-r,t.min)),sr(0,1,s)}({min:s,max:s},this.constraints[e])}}));const{transformTemplate:r}=this.visualElement.getProps();this.visualElement.current.style.transform=r?r({},""):"none",s.root&&s.root.updateScroll(),s.updateLayout(),this.resolveConstraints(),Bc((t=>{if(!yd(t,e,null))return;const s=this.getAxisMotionValue(t),{min:r,max:n}=this.constraints[t];s.set(Sn(r,n,a[t]))}))}addListeners(){if(!this.visualElement.current)return;bd.set(this.visualElement,this);const e=qc(this.visualElement.current,"pointerdown",(e=>{const{drag:t,dragListener:s=!0}=this.getProps();t&&s&&this.start(e)})),t=()=>{const{dragConstraints:e}=this.getProps();vl(e)&&e.current&&(this.constraints=this.resolveRefConstraints())},{projection:s}=this.visualElement,a=s.addEventListener("measure",t);s&&!s.layout&&(s.root&&s.root.updateScroll(),s.updateLayout()),Lr.read(t);const r=Mc(window,"resize",(()=>this.scalePositionWithinConstraints())),n=s.addEventListener("didUpdate",(({delta:e,hasLayoutChanged:t})=>{this.isDragging&&t&&(Bc((t=>{const s=this.getAxisMotionValue(t);s&&(this.originPoint[t]+=e[t].translate,s.set(s.get()+e[t].translate))})),this.visualElement.render())}));return()=>{r(),e(),a(),n&&n()}}getProps(){const e=this.visualElement.getProps(),{drag:t=!1,dragDirectionLock:s=!1,dragPropagation:a=!1,dragConstraints:r=!1,dragElastic:n=xd,dragMomentum:i=!0}=e;return{...e,drag:t,dragDirectionLock:s,dragPropagation:a,dragConstraints:r,dragElastic:n,dragMomentum:i}}}function yd(e,t,s){return!(!0!==t&&t!==e||null!==s&&s!==e)}const jd=e=>(t,s)=>{e&&Lr.postRender((()=>e(t,s)))};const Nd={hasAnimatedSinceResize:!0,hasEverUpdated:!1};function wd(e,t){return t.max===t.min?0:e/(t.max-t.min)*100}const _d={correct:(e,t)=>{if(!t.target)return e;if("string"==typeof e){if(!cn.test(e))return e;e=parseFloat(e)}return`${wd(e,t.target.x)}% ${wd(e,t.target.y)}%`}},Cd={correct:(e,{treeScale:t,projectionDelta:s})=>{const a=e,r=wn.parse(e);if(r.length>5)return a;const n=wn.createTransformer(e),i="number"!=typeof r[0]?1:0,o=s.x.scale*t.x,l=s.y.scale*t.y;r[0+i]/=o,r[1+i]/=l;const c=Sn(o,l,.5);return"number"==typeof r[2+i]&&(r[2+i]/=c),"number"==typeof r[3+i]&&(r[3+i]/=c),n(r)}};class Sd extends e.Component{componentDidMount(){const{visualElement:e,layoutGroup:t,switchLayoutGroup:s,layoutId:a}=this.props,{projection:r}=e;!function(e){for(const t in e)kl[t]=e[t],zr(t)&&(kl[t].isCSSVariable=!0)}(kd),r&&(t.group&&t.group.add(r),s&&s.register&&a&&s.register(r),r.root.didUpdate(),r.addEventListener("animationComplete",(()=>{this.safeToRemove()})),r.setOptions({...r.options,onExitComplete:()=>this.safeToRemove()})),Nd.hasEverUpdated=!0}getSnapshotBeforeUpdate(e){const{layoutDependency:t,visualElement:s,drag:a,isPresent:r}=this.props,{projection:n}=s;return n?(n.isPresent=r,a||e.layoutDependency!==t||void 0===t||e.isPresent!==r?n.willUpdate():this.safeToRemove(),e.isPresent!==r&&(r?n.promote():n.relegate()||Lr.postRender((()=>{const e=n.getStack();e&&e.members.length||this.safeToRemove()}))),null):null}componentDidUpdate(){const{projection:e}=this.props.visualElement;e&&(e.root.didUpdate(),Po.postRender((()=>{!e.currentAnimation&&e.isLead()&&this.safeToRemove()})))}componentWillUnmount(){const{visualElement:e,layoutGroup:t,switchLayoutGroup:s}=this.props,{projection:a}=e;a&&(a.scheduleCheckAfterUnmount(),t&&t.group&&t.group.remove(a),s&&s.deregister&&s.deregister(a))}safeToRemove(){const{safeToRemove:e}=this.props;e&&e()}render(){return null}}function Ed(s){const[a,r]=Jo(),n=e.useContext(Ya);return t.jsx(Sd,{...s,layoutGroup:n,switchLayoutGroup:e.useContext(wl),isPresent:a,safeToRemove:r})}const kd={borderRadius:{..._d,applyTo:["borderTopLeftRadius","borderTopRightRadius","borderBottomLeftRadius","borderBottomRightRadius"]},borderTopLeftRadius:_d,borderTopRightRadius:_d,borderBottomLeftRadius:_d,borderBottomRightRadius:_d,boxShadow:Cd};const Ad=(e,t)=>e.depth-t.depth;class Pd{constructor(){this.children=[],this.isDirty=!1}add(e){er(this.children,e),this.isDirty=!0}remove(e){tr(this.children,e),this.isDirty=!0}forEach(e){this.isDirty&&this.children.sort(Ad),this.isDirty=!1,this.children.forEach(e)}}const Md=["TopLeft","TopRight","BottomLeft","BottomRight"],Td=Md.length,qd=e=>"string"==typeof e?parseFloat(e):e,Dd=e=>"number"==typeof e||cn.test(e);function Rd(e,t){return void 0!==e[t]?e[t]:e.borderRadius}const Ld=Id(0,.5,Cr),$d=Id(.5,.95,lr);function Id(e,t,s){return a=>a<e?0:a>t?1:s(mr(e,t,a))}function Fd(e,t){e.min=t.min,e.max=t.max}function Vd(e,t){Fd(e.x,t.x),Fd(e.y,t.y)}function Od(e,t){e.translate=t.translate,e.scale=t.scale,e.originPoint=t.originPoint,e.origin=t.origin}function Bd(e,t,s,a,r){return e=Wc(e-=t,1/s,a),void 0!==r&&(e=Wc(e,1/r,a)),e}function Ud(e,t,[s,a,r],n,i){!function(e,t=0,s=1,a=.5,r,n=e,i=e){ln.test(t)&&(t=parseFloat(t),t=Sn(i.min,i.max,t/100)-i.min);if("number"!=typeof t)return;let o=Sn(n.min,n.max,a);e===n&&(o-=t),e.min=Bd(e.min,t,s,o,r),e.max=Bd(e.max,t,s,o,r)}(e,t[s],t[a],t[r],t.scale,n,i)}const zd=["x","scaleX","originX"],Gd=["y","scaleY","originY"];function Hd(e,t,s,a){Ud(e.x,t,zd,s?s.x:void 0,a?a.x:void 0),Ud(e.y,t,Gd,s?s.y:void 0,a?a.y:void 0)}function Xd(e){return 0===e.translate&&1===e.scale}function Wd(e){return Xd(e.x)&&Xd(e.y)}function Yd(e,t){return e.min===t.min&&e.max===t.max}function Kd(e,t){return Math.round(e.min)===Math.round(t.min)&&Math.round(e.max)===Math.round(t.max)}function Jd(e,t){return Kd(e.x,t.x)&&Kd(e.y,t.y)}function Qd(e){return Rc(e.x)/Rc(e.y)}function Zd(e,t){return e.translate===t.translate&&e.scale===t.scale&&e.originPoint===t.originPoint}class em{constructor(){this.members=[]}add(e){er(this.members,e),e.scheduleRender()}remove(e){if(tr(this.members,e),e===this.prevLead&&(this.prevLead=void 0),e===this.lead){const e=this.members[this.members.length-1];e&&this.promote(e)}}relegate(e){const t=this.members.findIndex((t=>e===t));if(0===t)return!1;let s;for(let a=t;a>=0;a--){const e=this.members[a];if(!1!==e.isPresent){s=e;break}}return!!s&&(this.promote(s),!0)}promote(e,t){const s=this.lead;if(e!==s&&(this.prevLead=s,this.lead=e,e.show(),s)){s.instance&&s.scheduleRender(),e.scheduleRender(),e.resumeFrom=s,t&&(e.resumeFrom.preserveOpacity=!0),s.snapshot&&(e.snapshot=s.snapshot,e.snapshot.latestValues=s.animationValues||s.latestValues),e.root&&e.root.isUpdating&&(e.isLayoutDirty=!0);const{crossfade:a}=e.options;!1===a&&s.hide()}}exitAnimationComplete(){this.members.forEach((e=>{const{options:t,resumingFrom:s}=e;t.onExitComplete&&t.onExitComplete(),s&&s.options.onExitComplete&&s.options.onExitComplete()}))}scheduleRender(){this.members.forEach((e=>{e.instance&&e.scheduleRender(!1)}))}removeLeadSnapshot(){this.lead&&this.lead.snapshot&&(this.lead.snapshot=void 0)}}const tm=["","X","Y","Z"],sm={visibility:"hidden"};let am=0;function rm(e,t,s,a){const{latestValues:r}=t;r[e]&&(s[e]=r[e],t.setStaticValue(e,0),a&&(a[e]=0))}function nm(e){if(e.hasCheckedOptimisedAppear=!0,e.root===e)return;const{visualElement:t}=e.options;if(!t)return;const s=oc(t);if(window.MotionHasOptimisedAnimation(s,"transform")){const{layout:t,layoutId:a}=e.options;window.MotionCancelOptimisedAnimation(s,"transform",Lr,!(t||a))}const{parent:a}=e;a&&!a.hasCheckedOptimisedAppear&&nm(a)}function im({attachResizeListener:e,defaultParent:t,measureScroll:s,checkIsScrollRoot:a,resetTransform:r}){return class{constructor(e={},s=t?.()){this.id=am++,this.animationId=0,this.children=new Set,this.options={},this.isTreeAnimating=!1,this.isAnimationBlocked=!1,this.isLayoutDirty=!1,this.isProjectionDirty=!1,this.isSharedProjectionDirty=!1,this.isTransformDirty=!1,this.updateManuallyBlocked=!1,this.updateBlockedByResize=!1,this.isUpdating=!1,this.isSVG=!1,this.needsReset=!1,this.shouldResetTransform=!1,this.hasCheckedOptimisedAppear=!1,this.treeScale={x:1,y:1},this.eventHandlers=new Map,this.hasTreeAnimated=!1,this.updateScheduled=!1,this.scheduleUpdate=()=>this.update(),this.projectionUpdateScheduled=!1,this.checkUpdateFailed=()=>{this.isUpdating&&(this.isUpdating=!1,this.clearAllSnapshots())},this.updateProjection=()=>{this.projectionUpdateScheduled=!1,this.nodes.forEach(cm),this.nodes.forEach(fm),this.nodes.forEach(gm),this.nodes.forEach(dm)},this.resolvedRelativeTargetAt=0,this.hasProjected=!1,this.isVisible=!0,this.animationProgress=0,this.sharedNodes=new Map,this.latestValues=e,this.root=s?s.root||s:this,this.path=s?[...s.path,s]:[],this.parent=s,this.depth=s?s.depth+1:0;for(let t=0;t<this.path.length;t++)this.path[t].shouldResetTransform=!0;this.root===this&&(this.nodes=new Pd)}addEventListener(e,t){return this.eventHandlers.has(e)||this.eventHandlers.set(e,new ur),this.eventHandlers.get(e).add(t)}notifyListeners(e,...t){const s=this.eventHandlers.get(e);s&&s.notify(...t)}hasListeners(e){return this.eventHandlers.has(e)}mount(t){if(this.instance)return;var s;this.isSVG=Uo(t)&&!(Uo(s=t)&&"svg"===s.tagName),this.instance=t;const{layoutId:a,layout:r,visualElement:n}=this.options;if(n&&!n.current&&n.mount(t),this.root.nodes.add(this),this.parent&&this.parent.children.add(this),this.root.hasTreeAnimated&&(r||a)&&(this.isLayoutDirty=!0),e){let s;const a=()=>this.root.updateBlockedByResize=!1;e(t,(()=>{this.root.updateBlockedByResize=!0,s&&s(),s=function(e,t){const s=Br.now(),a=({timestamp:r})=>{const n=r-s;n>=t&&($r(a),e(n-t))};return Lr.setup(a,!0),()=>$r(a)}(a,250),Nd.hasAnimatedSinceResize&&(Nd.hasAnimatedSinceResize=!1,this.nodes.forEach(xm))}))}a&&this.root.registerSharedNode(a,this),!1!==this.options.animate&&n&&(a||r)&&this.addEventListener("didUpdate",(({delta:e,hasLayoutChanged:t,hasRelativeLayoutChanged:s,layout:a})=>{if(this.isTreeAnimationBlocked())return this.target=void 0,void(this.relativeTarget=void 0);const r=this.options.transition||n.getDefaultTransition()||wm,{onLayoutAnimationStart:i,onLayoutAnimationComplete:o}=n.getProps(),l=!this.targetLayout||!Jd(this.targetLayout,a),c=!t&&s;if(this.options.layoutRoot||this.resumeFrom||c||t&&(l||!this.currentAnimation)){this.resumeFrom&&(this.resumingFrom=this.resumeFrom,this.resumingFrom.resumingFrom=void 0);const t={...mo(r,"layout"),onPlay:i,onComplete:o};(n.shouldReduceMotion||this.options.layoutRoot)&&(t.delay=0,t.type=!1),this.startAnimation(t),this.setAnimationOrigin(e,c)}else t||xm(this),this.isLead()&&this.options.onExitComplete&&this.options.onExitComplete();this.targetLayout=a}))}unmount(){this.options.layoutId&&this.willUpdate(),this.root.nodes.remove(this);const e=this.getStack();e&&e.remove(this),this.parent&&this.parent.children.delete(this),this.instance=void 0,this.eventHandlers.clear(),$r(this.updateProjection)}blockUpdate(){this.updateManuallyBlocked=!0}unblockUpdate(){this.updateManuallyBlocked=!1}isUpdateBlocked(){return this.updateManuallyBlocked||this.updateBlockedByResize}isTreeAnimationBlocked(){return this.isAnimationBlocked||this.parent&&this.parent.isTreeAnimationBlocked()||!1}startUpdate(){this.isUpdateBlocked()||(this.isUpdating=!0,this.nodes&&this.nodes.forEach(bm),this.animationId++)}getTransformTemplate(){const{visualElement:e}=this.options;return e&&e.getProps().transformTemplate}willUpdate(e=!0){if(this.root.hasTreeAnimated=!0,this.root.isUpdateBlocked())return void(this.options.onExitComplete&&this.options.onExitComplete());if(window.MotionCancelOptimisedAnimation&&!this.hasCheckedOptimisedAppear&&nm(this),!this.root.isUpdating&&this.root.startUpdate(),this.isLayoutDirty)return;this.isLayoutDirty=!0;for(let r=0;r<this.path.length;r++){const e=this.path[r];e.shouldResetTransform=!0,e.updateScroll("snapshot"),e.options.layoutRoot&&e.willUpdate(!1)}const{layoutId:t,layout:s}=this.options;if(void 0===t&&!s)return;const a=this.getTransformTemplate();this.prevTransformTemplateValue=a?a(this.latestValues,""):void 0,this.updateSnapshot(),e&&this.notifyListeners("willUpdate")}update(){this.updateScheduled=!1;if(this.isUpdateBlocked())return this.unblockUpdate(),this.clearAllSnapshots(),void this.nodes.forEach(um);this.isUpdating||this.nodes.forEach(hm),this.isUpdating=!1,this.nodes.forEach(pm),this.nodes.forEach(om),this.nodes.forEach(lm),this.clearAllSnapshots();const e=Br.now();Ir.delta=sr(0,1e3/60,e-Ir.timestamp),Ir.timestamp=e,Ir.isProcessing=!0,Fr.update.process(Ir),Fr.preRender.process(Ir),Fr.render.process(Ir),Ir.isProcessing=!1}didUpdate(){this.updateScheduled||(this.updateScheduled=!0,Po.read(this.scheduleUpdate))}clearAllSnapshots(){this.nodes.forEach(mm),this.sharedNodes.forEach(vm)}scheduleUpdateProjection(){this.projectionUpdateScheduled||(this.projectionUpdateScheduled=!0,Lr.preRender(this.updateProjection,!1,!0))}scheduleCheckAfterUnmount(){Lr.postRender((()=>{this.isLayoutDirty?this.root.didUpdate():this.root.checkUpdateFailed()}))}updateSnapshot(){!this.snapshot&&this.instance&&(this.snapshot=this.measure(),!this.snapshot||Rc(this.snapshot.measuredBox.x)||Rc(this.snapshot.measuredBox.y)||(this.snapshot=void 0))}updateLayout(){if(!this.instance)return;if(this.updateScroll(),!(this.options.alwaysMeasureLayout&&this.isLead()||this.isLayoutDirty))return;if(this.resumeFrom&&!this.resumeFrom.instance)for(let s=0;s<this.path.length;s++){this.path[s].updateScroll()}const e=this.layout;this.layout=this.measure(!1),this.layoutCorrected={x:{min:0,max:0},y:{min:0,max:0}},this.isLayoutDirty=!1,this.projectionDelta=void 0,this.notifyListeners("measure",this.layout.layoutBox);const{visualElement:t}=this.options;t&&t.notify("LayoutMeasure",this.layout.layoutBox,e?e.layoutBox:void 0)}updateScroll(e="measure"){let t=Boolean(this.options.layoutScroll&&this.instance);if(this.scroll&&this.scroll.animationId===this.root.animationId&&this.scroll.phase===e&&(t=!1),t&&this.instance){const t=a(this.instance);this.scroll={animationId:this.root.animationId,phase:e,isRoot:t,offset:s(this.instance),wasRoot:this.scroll?this.scroll.isRoot:t}}}resetTransform(){if(!r)return;const e=this.isLayoutDirty||this.shouldResetTransform||this.options.alwaysMeasureLayout,t=this.projectionDelta&&!Wd(this.projectionDelta),s=this.getTransformTemplate(),a=s?s(this.latestValues,""):void 0,n=a!==this.prevTransformTemplateValue;e&&this.instance&&(t||Gc(this.latestValues)||n)&&(r(this.instance,a),this.shouldResetTransform=!1,this.scheduleRender())}measure(e=!0){const t=this.measurePageBox();let s=this.removeElementScroll(t);var a;return e&&(s=this.removeTransform(s)),Sm((a=s).x),Sm(a.y),{animationId:this.root.animationId,measuredBox:t,layoutBox:s,latestValues:{},source:this.id}}measurePageBox(){const{visualElement:e}=this.options;if(!e)return{x:{min:0,max:0},y:{min:0,max:0}};const t=e.measureViewportBox();if(!(this.scroll?.wasRoot||this.path.some(km))){const{scroll:e}=this.root;e&&(ed(t.x,e.offset.x),ed(t.y,e.offset.y))}return t}removeElementScroll(e){const t={x:{min:0,max:0},y:{min:0,max:0}};if(Vd(t,e),this.scroll?.wasRoot)return t;for(let s=0;s<this.path.length;s++){const a=this.path[s],{scroll:r,options:n}=a;a!==this.root&&r&&n.layoutScroll&&(r.wasRoot&&Vd(t,e),ed(t.x,r.offset.x),ed(t.y,r.offset.y))}return t}applyTransform(e,t=!1){const s={x:{min:0,max:0},y:{min:0,max:0}};Vd(s,e);for(let a=0;a<this.path.length;a++){const e=this.path[a];!t&&e.options.layoutScroll&&e.scroll&&e!==e.root&&sd(s,{x:-e.scroll.offset.x,y:-e.scroll.offset.y}),Gc(e.latestValues)&&sd(s,e.latestValues)}return Gc(this.latestValues)&&sd(s,this.latestValues),s}removeTransform(e){const t={x:{min:0,max:0},y:{min:0,max:0}};Vd(t,e);for(let s=0;s<this.path.length;s++){const e=this.path[s];if(!e.instance)continue;if(!Gc(e.latestValues))continue;zc(e.latestValues)&&e.updateSnapshot();const a={x:{min:0,max:0},y:{min:0,max:0}};Vd(a,e.measurePageBox()),Hd(t,e.latestValues,e.snapshot?e.snapshot.layoutBox:void 0,a)}return Gc(this.latestValues)&&Hd(t,this.latestValues),t}setTargetDelta(e){this.targetDelta=e,this.root.scheduleUpdateProjection(),this.isProjectionDirty=!0}setOptions(e){this.options={...this.options,...e,crossfade:void 0===e.crossfade||e.crossfade}}clearMeasurements(){this.scroll=void 0,this.layout=void 0,this.snapshot=void 0,this.prevTransformTemplateValue=void 0,this.targetDelta=void 0,this.target=void 0,this.isLayoutDirty=!1}forceRelativeParentToResolveTarget(){this.relativeParent&&this.relativeParent.resolvedRelativeTargetAt!==Ir.timestamp&&this.relativeParent.resolveTargetDelta(!0)}resolveTargetDelta(e=!1){const t=this.getLead();this.isProjectionDirty||(this.isProjectionDirty=t.isProjectionDirty),this.isTransformDirty||(this.isTransformDirty=t.isTransformDirty),this.isSharedProjectionDirty||(this.isSharedProjectionDirty=t.isSharedProjectionDirty);const s=Boolean(this.resumingFrom)||this!==t;if(!(e||s&&this.isSharedProjectionDirty||this.isProjectionDirty||this.parent?.isProjectionDirty||this.attemptToResolveRelativeTarget||this.root.updateBlockedByResize))return;const{layout:a,layoutId:r}=this.options;if(this.layout&&(a||r)){if(this.resolvedRelativeTargetAt=Ir.timestamp,!this.targetDelta&&!this.relativeTarget){const e=this.getClosestProjectingParent();e&&e.layout&&1!==this.animationProgress?(this.relativeParent=e,this.forceRelativeParentToResolveTarget(),this.relativeTarget={x:{min:0,max:0},y:{min:0,max:0}},this.relativeTargetOrigin={x:{min:0,max:0},y:{min:0,max:0}},Vc(this.relativeTargetOrigin,this.layout.layoutBox,e.layout.layoutBox),Vd(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}var n,i,o;if(this.relativeTarget||this.targetDelta)if(this.target||(this.target={x:{min:0,max:0},y:{min:0,max:0}},this.targetWithTransforms={x:{min:0,max:0},y:{min:0,max:0}}),this.relativeTarget&&this.relativeTargetOrigin&&this.relativeParent&&this.relativeParent.target?(this.forceRelativeParentToResolveTarget(),n=this.target,i=this.relativeTarget,o=this.relativeParent.target,Ic(n.x,i.x,o.x),Ic(n.y,i.y,o.y)):this.targetDelta?(Boolean(this.resumingFrom)?this.target=this.applyTransform(this.layout.layoutBox):Vd(this.target,this.layout.layoutBox),Jc(this.target,this.targetDelta)):Vd(this.target,this.layout.layoutBox),this.attemptToResolveRelativeTarget){this.attemptToResolveRelativeTarget=!1;const e=this.getClosestProjectingParent();e&&Boolean(e.resumingFrom)===Boolean(this.resumingFrom)&&!e.options.layoutScroll&&e.target&&1!==this.animationProgress?(this.relativeParent=e,this.forceRelativeParentToResolveTarget(),this.relativeTarget={x:{min:0,max:0},y:{min:0,max:0}},this.relativeTargetOrigin={x:{min:0,max:0},y:{min:0,max:0}},Vc(this.relativeTargetOrigin,this.target,e.target),Vd(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}}}getClosestProjectingParent(){if(this.parent&&!zc(this.parent.latestValues)&&!Hc(this.parent.latestValues))return this.parent.isProjecting()?this.parent:this.parent.getClosestProjectingParent()}isProjecting(){return Boolean((this.relativeTarget||this.targetDelta||this.options.layoutRoot)&&this.layout)}calcProjection(){const e=this.getLead(),t=Boolean(this.resumingFrom)||this!==e;let s=!0;if((this.isProjectionDirty||this.parent?.isProjectionDirty)&&(s=!1),t&&(this.isSharedProjectionDirty||this.isTransformDirty)&&(s=!1),this.resolvedRelativeTargetAt===Ir.timestamp&&(s=!1),s)return;const{layout:a,layoutId:r}=this.options;if(this.isTreeAnimating=Boolean(this.parent&&this.parent.isTreeAnimating||this.currentAnimation||this.pendingAnimation),this.isTreeAnimating||(this.targetDelta=this.relativeTarget=void 0),!this.layout||!a&&!r)return;Vd(this.layoutCorrected,this.layout.layoutBox);const n=this.treeScale.x,i=this.treeScale.y;!function(e,t,s,a=!1){const r=s.length;if(!r)return;let n,i;t.x=t.y=1;for(let o=0;o<r;o++){n=s[o],i=n.projectionDelta;const{visualElement:r}=n.options;r&&r.props.style&&"contents"===r.props.style.display||(a&&n.options.layoutScroll&&n.scroll&&n!==n.root&&sd(e,{x:-n.scroll.offset.x,y:-n.scroll.offset.y}),i&&(t.x*=i.x.scale,t.y*=i.y.scale,Jc(e,i)),a&&Gc(n.latestValues)&&sd(e,n.latestValues))}t.x<Zc&&t.x>Qc&&(t.x=1),t.y<Zc&&t.y>Qc&&(t.y=1)}(this.layoutCorrected,this.treeScale,this.path,t),!e.layout||e.target||1===this.treeScale.x&&1===this.treeScale.y||(e.target=e.layout.layoutBox,e.targetWithTransforms={x:{min:0,max:0},y:{min:0,max:0}});const{target:o}=e;o?(this.projectionDelta&&this.prevProjectionDelta?(Od(this.prevProjectionDelta.x,this.projectionDelta.x),Od(this.prevProjectionDelta.y,this.projectionDelta.y)):this.createProjectionDeltas(),$c(this.projectionDelta,this.layoutCorrected,o,this.latestValues),this.treeScale.x===n&&this.treeScale.y===i&&Zd(this.projectionDelta.x,this.prevProjectionDelta.x)&&Zd(this.projectionDelta.y,this.prevProjectionDelta.y)||(this.hasProjected=!0,this.scheduleRender(),this.notifyListeners("projectionUpdate",o))):this.prevProjectionDelta&&(this.createProjectionDeltas(),this.scheduleRender())}hide(){this.isVisible=!1}show(){this.isVisible=!0}scheduleRender(e=!0){if(this.options.visualElement?.scheduleRender(),e){const e=this.getStack();e&&e.scheduleRender()}this.resumingFrom&&!this.resumingFrom.instance&&(this.resumingFrom=void 0)}createProjectionDeltas(){this.prevProjectionDelta={x:{translate:0,scale:1,origin:0,originPoint:0},y:{translate:0,scale:1,origin:0,originPoint:0}},this.projectionDelta={x:{translate:0,scale:1,origin:0,originPoint:0},y:{translate:0,scale:1,origin:0,originPoint:0}},this.projectionDeltaWithTransform={x:{translate:0,scale:1,origin:0,originPoint:0},y:{translate:0,scale:1,origin:0,originPoint:0}}}setAnimationOrigin(e,t=!1){const s=this.snapshot,a=s?s.latestValues:{},r={...this.latestValues},n={x:{translate:0,scale:1,origin:0,originPoint:0},y:{translate:0,scale:1,origin:0,originPoint:0}};this.relativeParent&&this.relativeParent.options.layoutRoot||(this.relativeTarget=this.relativeTargetOrigin=void 0),this.attemptToResolveRelativeTarget=!t;const i={x:{min:0,max:0},y:{min:0,max:0}},o=(s?s.source:void 0)!==(this.layout?this.layout.source:void 0),l=this.getStack(),c=!l||l.members.length<=1,d=Boolean(o&&!c&&!0===this.options.crossfade&&!this.path.some(Nm));let m;this.animationProgress=0,this.mixTargetDelta=t=>{const s=t/1e3;ym(n.x,e.x,s),ym(n.y,e.y,s),this.setTargetDelta(n),this.relativeTarget&&this.relativeTargetOrigin&&this.layout&&this.relativeParent&&this.relativeParent.layout&&(Vc(i,this.layout.layoutBox,this.relativeParent.layout.layoutBox),function(e,t,s,a){jm(e.x,t.x,s.x,a),jm(e.y,t.y,s.y,a)}(this.relativeTarget,this.relativeTargetOrigin,i,s),m&&function(e,t){return Yd(e.x,t.x)&&Yd(e.y,t.y)}(this.relativeTarget,m)&&(this.isProjectionDirty=!1),m||(m={x:{min:0,max:0},y:{min:0,max:0}}),Vd(m,this.relativeTarget)),o&&(this.animationValues=r,function(e,t,s,a,r,n){r?(e.opacity=Sn(0,s.opacity??1,Ld(a)),e.opacityExit=Sn(t.opacity??1,0,$d(a))):n&&(e.opacity=Sn(t.opacity??1,s.opacity??1,a));for(let i=0;i<Td;i++){const r=`border${Md[i]}Radius`;let n=Rd(t,r),o=Rd(s,r);void 0===n&&void 0===o||(n||(n=0),o||(o=0),0===n||0===o||Dd(n)===Dd(o)?(e[r]=Math.max(Sn(qd(n),qd(o),a),0),(ln.test(o)||ln.test(n))&&(e[r]+="%")):e[r]=o)}(t.rotate||s.rotate)&&(e.rotate=Sn(t.rotate||0,s.rotate||0,a))}(r,a,this.latestValues,s,d,c)),this.root.scheduleUpdateProjection(),this.scheduleRender(),this.animationProgress=s},this.mixTargetDelta(this.options.layoutRoot?1e3:0)}startAnimation(e){this.notifyListeners("animationStart"),this.currentAnimation?.stop(),this.resumingFrom?.currentAnimation?.stop(),this.pendingAnimation&&($r(this.pendingAnimation),this.pendingAnimation=void 0),this.pendingAnimation=Lr.update((()=>{Nd.hasAnimatedSinceResize=!0,this.motionValue||(this.motionValue=Ao(0)),this.currentAnimation=function(e,t,s){const a=zo(e)?e:Ao(e);return a.start(hc("",a,t,s)),a.animation}(this.motionValue,[0,1e3],{...e,velocity:0,isSync:!0,onUpdate:t=>{this.mixTargetDelta(t),e.onUpdate&&e.onUpdate(t)},onStop:()=>{},onComplete:()=>{e.onComplete&&e.onComplete(),this.completeAnimation()}}),this.resumingFrom&&(this.resumingFrom.currentAnimation=this.currentAnimation),this.pendingAnimation=void 0}))}completeAnimation(){this.resumingFrom&&(this.resumingFrom.currentAnimation=void 0,this.resumingFrom.preserveOpacity=void 0);const e=this.getStack();e&&e.exitAnimationComplete(),this.resumingFrom=this.currentAnimation=this.animationValues=void 0,this.notifyListeners("animationComplete")}finishAnimation(){this.currentAnimation&&(this.mixTargetDelta&&this.mixTargetDelta(1e3),this.currentAnimation.stop()),this.completeAnimation()}applyTransformsToTarget(){const e=this.getLead();let{targetWithTransforms:t,target:s,layout:a,latestValues:r}=e;if(t&&s&&a){if(this!==e&&this.layout&&a&&Em(this.options.animationType,this.layout.layoutBox,a.layoutBox)){s=this.target||{x:{min:0,max:0},y:{min:0,max:0}};const t=Rc(this.layout.layoutBox.x);s.x.min=e.target.x.min,s.x.max=s.x.min+t;const a=Rc(this.layout.layoutBox.y);s.y.min=e.target.y.min,s.y.max=s.y.min+a}Vd(t,s),sd(t,r),$c(this.projectionDeltaWithTransform,this.layoutCorrected,t,r)}}registerSharedNode(e,t){this.sharedNodes.has(e)||this.sharedNodes.set(e,new em);this.sharedNodes.get(e).add(t);const s=t.options.initialPromotionConfig;t.promote({transition:s?s.transition:void 0,preserveFollowOpacity:s&&s.shouldPreserveFollowOpacity?s.shouldPreserveFollowOpacity(t):void 0})}isLead(){const e=this.getStack();return!e||e.lead===this}getLead(){const{layoutId:e}=this.options;return e&&this.getStack()?.lead||this}getPrevLead(){const{layoutId:e}=this.options;return e?this.getStack()?.prevLead:void 0}getStack(){const{layoutId:e}=this.options;if(e)return this.root.sharedNodes.get(e)}promote({needsReset:e,transition:t,preserveFollowOpacity:s}={}){const a=this.getStack();a&&a.promote(this,s),e&&(this.projectionDelta=void 0,this.needsReset=!0),t&&this.setOptions({transition:t})}relegate(){const e=this.getStack();return!!e&&e.relegate(this)}resetSkewAndRotation(){const{visualElement:e}=this.options;if(!e)return;let t=!1;const{latestValues:s}=e;if((s.z||s.rotate||s.rotateX||s.rotateY||s.rotateZ||s.skewX||s.skewY)&&(t=!0),!t)return;const a={};s.z&&rm("z",e,a,this.animationValues);for(let r=0;r<tm.length;r++)rm(`rotate${tm[r]}`,e,a,this.animationValues),rm(`skew${tm[r]}`,e,a,this.animationValues);e.render();for(const r in a)e.setStaticValue(r,a[r]),this.animationValues&&(this.animationValues[r]=a[r]);e.scheduleRender()}getProjectionStyles(e){if(!this.instance||this.isSVG)return;if(!this.isVisible)return sm;const t={visibility:""},s=this.getTransformTemplate();if(this.needsReset)return this.needsReset=!1,t.opacity="",t.pointerEvents=Wl(e?.pointerEvents)||"",t.transform=s?s(this.latestValues,""):"none",t;const a=this.getLead();if(!this.projectionDelta||!this.layout||!a.target){const t={};return this.options.layoutId&&(t.opacity=void 0!==this.latestValues.opacity?this.latestValues.opacity:1,t.pointerEvents=Wl(e?.pointerEvents)||""),this.hasProjected&&!Gc(this.latestValues)&&(t.transform=s?s({},""):"none",this.hasProjected=!1),t}const r=a.animationValues||a.latestValues;this.applyTransformsToTarget(),t.transform=function(e,t,s){let a="";const r=e.x.translate/t.x,n=e.y.translate/t.y,i=s?.z||0;if((r||n||i)&&(a=`translate3d(${r}px, ${n}px, ${i}px) `),1===t.x&&1===t.y||(a+=`scale(${1/t.x}, ${1/t.y}) `),s){const{transformPerspective:e,rotate:t,rotateX:r,rotateY:n,skewX:i,skewY:o}=s;e&&(a=`perspective(${e}px) ${a}`),t&&(a+=`rotate(${t}deg) `),r&&(a+=`rotateX(${r}deg) `),n&&(a+=`rotateY(${n}deg) `),i&&(a+=`skewX(${i}deg) `),o&&(a+=`skewY(${o}deg) `)}const o=e.x.scale*t.x,l=e.y.scale*t.y;return 1===o&&1===l||(a+=`scale(${o}, ${l})`),a||"none"}(this.projectionDeltaWithTransform,this.treeScale,r),s&&(t.transform=s(r,t.transform));const{x:n,y:i}=this.projectionDelta;t.transformOrigin=`${100*n.origin}% ${100*i.origin}% 0`,a.animationValues?t.opacity=a===this?r.opacity??this.latestValues.opacity??1:this.preserveOpacity?this.latestValues.opacity:r.opacityExit:t.opacity=a===this?void 0!==r.opacity?r.opacity:"":void 0!==r.opacityExit?r.opacityExit:0;for(const o in kl){if(void 0===r[o])continue;const{correct:e,applyTo:s,isCSSVariable:n}=kl[o],i="none"===t.transform?r[o]:e(r[o],a);if(s){const e=s.length;for(let a=0;a<e;a++)t[s[a]]=i}else n?this.options.visualElement.renderState.vars[o]=i:t[o]=i}return this.options.layoutId&&(t.pointerEvents=a===this?Wl(e?.pointerEvents)||"":"none"),t}clearSnapshot(){this.resumeFrom=this.snapshot=void 0}resetTree(){this.root.nodes.forEach((e=>e.currentAnimation?.stop())),this.root.nodes.forEach(um),this.root.sharedNodes.clear()}}}function om(e){e.updateLayout()}function lm(e){const t=e.resumeFrom?.snapshot||e.snapshot;if(e.isLead()&&e.layout&&t&&e.hasListeners("didUpdate")){const{layoutBox:s,measuredBox:a}=e.layout,{animationType:r}=e.options,n=t.source!==e.layout.source;"size"===r?Bc((e=>{const a=n?t.measuredBox[e]:t.layoutBox[e],r=Rc(a);a.min=s[e].min,a.max=a.min+r})):Em(r,t.layoutBox,s)&&Bc((a=>{const r=n?t.measuredBox[a]:t.layoutBox[a],i=Rc(s[a]);r.max=r.min+i,e.relativeTarget&&!e.currentAnimation&&(e.isProjectionDirty=!0,e.relativeTarget[a].max=e.relativeTarget[a].min+i)}));const i={x:{translate:0,scale:1,origin:0,originPoint:0},y:{translate:0,scale:1,origin:0,originPoint:0}};$c(i,s,t.layoutBox);const o={x:{translate:0,scale:1,origin:0,originPoint:0},y:{translate:0,scale:1,origin:0,originPoint:0}};n?$c(o,e.applyTransform(a,!0),t.measuredBox):$c(o,s,t.layoutBox);const l=!Wd(i);let c=!1;if(!e.resumeFrom){const a=e.getClosestProjectingParent();if(a&&!a.resumeFrom){const{snapshot:r,layout:n}=a;if(r&&n){const i={x:{min:0,max:0},y:{min:0,max:0}};Vc(i,t.layoutBox,r.layoutBox);const o={x:{min:0,max:0},y:{min:0,max:0}};Vc(o,s,n.layoutBox),Jd(i,o)||(c=!0),a.options.layoutRoot&&(e.relativeTarget=o,e.relativeTargetOrigin=i,e.relativeParent=a)}}}e.notifyListeners("didUpdate",{layout:s,snapshot:t,delta:o,layoutDelta:i,hasLayoutChanged:l,hasRelativeLayoutChanged:c})}else if(e.isLead()){const{onExitComplete:t}=e.options;t&&t()}e.options.transition=void 0}function cm(e){e.parent&&(e.isProjecting()||(e.isProjectionDirty=e.parent.isProjectionDirty),e.isSharedProjectionDirty||(e.isSharedProjectionDirty=Boolean(e.isProjectionDirty||e.parent.isProjectionDirty||e.parent.isSharedProjectionDirty)),e.isTransformDirty||(e.isTransformDirty=e.parent.isTransformDirty))}function dm(e){e.isProjectionDirty=e.isSharedProjectionDirty=e.isTransformDirty=!1}function mm(e){e.clearSnapshot()}function um(e){e.clearMeasurements()}function hm(e){e.isLayoutDirty=!1}function pm(e){const{visualElement:t}=e.options;t&&t.getProps().onBeforeLayoutMeasure&&t.notify("BeforeLayoutMeasure"),e.resetTransform()}function xm(e){e.finishAnimation(),e.targetDelta=e.relativeTarget=e.target=void 0,e.isProjectionDirty=!0}function fm(e){e.resolveTargetDelta()}function gm(e){e.calcProjection()}function bm(e){e.resetSkewAndRotation()}function vm(e){e.removeLeadSnapshot()}function ym(e,t,s){e.translate=Sn(t.translate,0,s),e.scale=Sn(t.scale,1,s),e.origin=t.origin,e.originPoint=t.originPoint}function jm(e,t,s,a){e.min=Sn(t.min,s.min,a),e.max=Sn(t.max,s.max,a)}function Nm(e){return e.animationValues&&void 0!==e.animationValues.opacityExit}const wm={duration:.45,ease:[.4,0,.1,1]},_m=e=>"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().includes(e),Cm=_m("applewebkit/")&&!_m("chrome/")?Math.round:lr;function Sm(e){e.min=Cm(e.min),e.max=Cm(e.max)}function Em(e,t,s){return"position"===e||"preserve-aspect"===e&&(a=Qd(t),r=Qd(s),n=.2,!(Math.abs(a-r)<=n));var a,r,n}function km(e){return e!==e.root&&e.scroll?.wasRoot}const Am=im({attachResizeListener:(e,t)=>Mc(e,"resize",t),measureScroll:()=>({x:document.documentElement.scrollLeft||document.body.scrollLeft,y:document.documentElement.scrollTop||document.body.scrollTop}),checkIsScrollRoot:()=>!0}),Pm={current:void 0},Mm=im({measureScroll:e=>({x:e.scrollLeft,y:e.scrollTop}),defaultParent:()=>{if(!Pm.current){const e=new Am({});e.mount(window),e.setOptions({layoutScroll:!0}),Pm.current=e}return Pm.current},resetTransform:(e,t)=>{e.style.transform=void 0!==t?t:"none"},checkIsScrollRoot:e=>Boolean("fixed"===window.getComputedStyle(e).position)}),Tm={pan:{Feature:class extends kc{constructor(){super(...arguments),this.removePointerDownListener=lr}onPointerDown(e){this.session=new id(e,this.createPanHandlers(),{transformPagePoint:this.node.getTransformPagePoint(),contextWindow:rd(this.node)})}createPanHandlers(){const{onPanSessionStart:e,onPanStart:t,onPan:s,onPanEnd:a}=this.node.getProps();return{onSessionStart:jd(e),onStart:jd(t),onMove:s,onEnd:(e,t)=>{delete this.session,a&&Lr.postRender((()=>a(e,t)))}}}mount(){this.removePointerDownListener=qc(this.node.current,"pointerdown",(e=>this.onPointerDown(e)))}update(){this.session&&this.session.updateHandlers(this.createPanHandlers())}unmount(){this.removePointerDownListener(),this.session&&this.session.end()}}},drag:{Feature:class extends kc{constructor(e){super(e),this.removeGroupControls=lr,this.removeListeners=lr,this.controls=new vd(e)}mount(){const{dragControls:e}=this.node.getProps();e&&(this.removeGroupControls=e.subscribe(this.controls)),this.removeListeners=this.controls.addListeners()||lr}unmount(){this.removeGroupControls(),this.removeListeners()}},ProjectionNode:Mm,MeasureLayout:Ed}};function qm(e,t,s){const{props:a}=e;e.animationState&&a.whileHover&&e.animationState.setActive("whileHover","Start"===s);const r=a["onHover"+s];r&&Lr.postRender((()=>r(t,Tc(t))))}function Dm(e,t,s){const{props:a}=e;if(e.current instanceof HTMLButtonElement&&e.current.disabled)return;e.animationState&&a.whileTap&&e.animationState.setActive("whileTap","Start"===s);const r=a["onTap"+("End"===s?"":s)];r&&Lr.postRender((()=>r(t,Tc(t))))}const Rm=new WeakMap,Lm=new WeakMap,$m=e=>{const t=Rm.get(e.target);t&&t(e)},Im=e=>{e.forEach($m)};function Fm(e,t,s){const a=function({root:e,...t}){const s=e||document;Lm.has(s)||Lm.set(s,{});const a=Lm.get(s),r=JSON.stringify(t);return a[r]||(a[r]=new IntersectionObserver(Im,{root:e,...t})),a[r]}(t);return Rm.set(e,s),a.observe(e),()=>{Rm.delete(e),a.unobserve(e)}}const Vm={some:0,all:1};const Om={inView:{Feature:class extends kc{constructor(){super(...arguments),this.hasEnteredView=!1,this.isInView=!1}startObserver(){this.unmount();const{viewport:e={}}=this.node.getProps(),{root:t,margin:s,amount:a="some",once:r}=e,n={root:t?t.current:void 0,rootMargin:s,threshold:"number"==typeof a?a:Vm[a]};return Fm(this.node.current,n,(e=>{const{isIntersecting:t}=e;if(this.isInView===t)return;if(this.isInView=t,r&&!t&&this.hasEnteredView)return;t&&(this.hasEnteredView=!0),this.node.animationState&&this.node.animationState.setActive("whileInView",t);const{onViewportEnter:s,onViewportLeave:a}=this.node.getProps(),n=t?s:a;n&&n(e)}))}mount(){this.startObserver()}update(){if("undefined"==typeof IntersectionObserver)return;const{props:e,prevProps:t}=this.node;["amount","margin","root"].some(function({viewport:e={}},{viewport:t={}}={}){return s=>e[s]!==t[s]}(e,t))&&this.startObserver()}unmount(){}}},tap:{Feature:class extends kc{mount(){const{current:e}=this.node;e&&(this.unmount=Bo(e,((e,t)=>(Dm(this.node,t,"Start"),(e,{success:t})=>Dm(this.node,e,t?"End":"Cancel"))),{useGlobalTarget:this.node.props.globalTapTarget}))}unmount(){}}},focus:{Feature:class extends kc{constructor(){super(...arguments),this.isActive=!1}onFocus(){let e=!1;try{e=this.node.current.matches(":focus-visible")}catch(t){e=!0}e&&this.node.animationState&&(this.node.animationState.setActive("whileFocus",!0),this.isActive=!0)}onBlur(){this.isActive&&this.node.animationState&&(this.node.animationState.setActive("whileFocus",!1),this.isActive=!1)}mount(){this.unmount=dr(Mc(this.node.current,"focus",(()=>this.onFocus())),Mc(this.node.current,"blur",(()=>this.onBlur())))}unmount(){}}},hover:{Feature:class extends kc{mount(){const{current:e}=this.node;e&&(this.unmount=function(e,t,s={}){const[a,r,n]=qo(e,s),i=e=>{if(!Do(e))return;const{target:s}=e,a=t(s,e);if("function"!=typeof a||!s)return;const n=e=>{Do(e)&&(a(e),s.removeEventListener("pointerleave",n))};s.addEventListener("pointerleave",n,r)};return a.forEach((e=>{e.addEventListener("pointerenter",i,r)})),n}(e,((e,t)=>(qm(this.node,t,"Start"),e=>qm(this.node,e,"End")))))}unmount(){}}}},Bm={layout:{ProjectionNode:Mm,MeasureLayout:Ed}},Um={current:null},zm={current:!1};const Gm=new WeakMap;const Hm=["AnimationStart","AnimationComplete","Update","BeforeLayoutMeasure","LayoutMeasure","LayoutAnimationStart","LayoutAnimationComplete"];class Xm{scrapeMotionValuesFromProps(e,t,s){return{}}constructor({parent:e,props:t,presenceContext:s,reducedMotionConfig:a,blockInitialAnimation:r,visualState:n},i={}){this.current=null,this.children=new Set,this.isVariantNode=!1,this.isControllingVariants=!1,this.shouldReduceMotion=null,this.values=new Map,this.KeyframeResolver=Ui,this.features={},this.valueSubscriptions=new Map,this.prevMotionValues={},this.events={},this.propEventSubscriptions={},this.notifyUpdate=()=>this.notify("Update",this.latestValues),this.render=()=>{this.current&&(this.triggerBuild(),this.renderInstance(this.current,this.renderState,this.props.style,this.projection))},this.renderScheduledAt=0,this.scheduleRender=()=>{const e=Br.now();this.renderScheduledAt<e&&(this.renderScheduledAt=e,Lr.render(this.render,!1,!0))};const{latestValues:o,renderState:l}=n;this.latestValues=o,this.baseTarget={...o},this.initialValues=t.initial?{...o}:{},this.renderState=l,this.parent=e,this.props=t,this.presenceContext=s,this.depth=e?e.depth+1:0,this.reducedMotionConfig=a,this.options=i,this.blockInitialAnimation=Boolean(r),this.isControllingVariants=pl(t),this.isVariantNode=xl(t),this.isVariantNode&&(this.variantChildren=new Set),this.manuallyAnimateOnMount=Boolean(e&&e.current);const{willChange:c,...d}=this.scrapeMotionValuesFromProps(t,{},this);for(const m in d){const e=d[m];void 0!==o[m]&&zo(e)&&e.set(o[m],!1)}}mount(e){this.current=e,Gm.set(e,this),this.projection&&!this.projection.instance&&this.projection.mount(e),this.parent&&this.isVariantNode&&!this.isControllingVariants&&(this.removeFromVariantTree=this.parent.addVariantChild(this)),this.values.forEach(((e,t)=>this.bindToMotionValue(t,e))),zm.current||function(){if(zm.current=!0,Ja)if(window.matchMedia){const e=window.matchMedia("(prefers-reduced-motion)"),t=()=>Um.current=e.matches;e.addListener(t),t()}else Um.current=!1}(),this.shouldReduceMotion="never"!==this.reducedMotionConfig&&("always"===this.reducedMotionConfig||Um.current),this.parent&&this.parent.children.add(this),this.update(this.props,this.presenceContext)}unmount(){this.projection&&this.projection.unmount(),$r(this.notifyUpdate),$r(this.render),this.valueSubscriptions.forEach((e=>e())),this.valueSubscriptions.clear(),this.removeFromVariantTree&&this.removeFromVariantTree(),this.parent&&this.parent.children.delete(this);for(const e in this.events)this.events[e].clear();for(const e in this.features){const t=this.features[e];t&&(t.unmount(),t.isMounted=!1)}this.current=null}bindToMotionValue(e,t){this.valueSubscriptions.has(e)&&this.valueSubscriptions.get(e)();const s=Ti.has(e);s&&this.onBindTransform&&this.onBindTransform();const a=t.on("change",(t=>{this.latestValues[e]=t,this.props.onUpdate&&Lr.preRender(this.notifyUpdate),s&&this.projection&&(this.projection.isTransformDirty=!0)})),r=t.on("renderRequest",this.scheduleRender);let n;window.MotionCheckAppearSync&&(n=window.MotionCheckAppearSync(this,e,t)),this.valueSubscriptions.set(e,(()=>{a(),r(),n&&n(),t.owner&&t.stop()}))}sortNodePosition(e){return this.current&&this.sortInstanceNodePosition&&this.type===e.type?this.sortInstanceNodePosition(this.current,e.current):0}updateFeatures(){let e="animation";for(e in al){const t=al[e];if(!t)continue;const{isEnabled:s,Feature:a}=t;if(!this.features[e]&&a&&s(this.props)&&(this.features[e]=new a(this)),this.features[e]){const t=this.features[e];t.isMounted?t.update():(t.mount(),t.isMounted=!0)}}}triggerBuild(){this.build(this.renderState,this.latestValues,this.props)}measureViewportBox(){return this.current?this.measureInstanceViewportBox(this.current,this.props):{x:{min:0,max:0},y:{min:0,max:0}}}getStaticValue(e){return this.latestValues[e]}setStaticValue(e,t){this.latestValues[e]=t}update(e,t){(e.transformTemplate||this.props.transformTemplate)&&this.scheduleRender(),this.prevProps=this.props,this.props=e,this.prevPresenceContext=this.presenceContext,this.presenceContext=t;for(let s=0;s<Hm.length;s++){const t=Hm[s];this.propEventSubscriptions[t]&&(this.propEventSubscriptions[t](),delete this.propEventSubscriptions[t]);const a=e["on"+t];a&&(this.propEventSubscriptions[t]=this.on(t,a))}this.prevMotionValues=function(e,t,s){for(const a in t){const r=t[a],n=s[a];if(zo(r))e.addValue(a,r);else if(zo(n))e.addValue(a,Ao(r,{owner:e}));else if(n!==r)if(e.hasValue(a)){const t=e.getValue(a);!0===t.liveStyle?t.jump(r):t.hasAnimated||t.set(r)}else{const t=e.getStaticValue(a);e.addValue(a,Ao(void 0!==t?t:r,{owner:e}))}}for(const a in s)void 0===t[a]&&e.removeValue(a);return t}(this,this.scrapeMotionValuesFromProps(e,this.prevProps,this),this.prevMotionValues),this.handleChildMotionValue&&this.handleChildMotionValue()}getProps(){return this.props}getVariant(e){return this.props.variants?this.props.variants[e]:void 0}getDefaultTransition(){return this.props.transition}getTransformPagePoint(){return this.props.transformPagePoint}getClosestVariantNode(){return this.isVariantNode?this:this.parent?this.parent.getClosestVariantNode():void 0}addVariantChild(e){const t=this.getClosestVariantNode();if(t)return t.variantChildren&&t.variantChildren.add(e),()=>t.variantChildren.delete(e)}addValue(e,t){const s=this.values.get(e);t!==s&&(s&&this.removeValue(e),this.bindToMotionValue(e,t),this.values.set(e,t),this.latestValues[e]=t.get())}removeValue(e){this.values.delete(e);const t=this.valueSubscriptions.get(e);t&&(t(),this.valueSubscriptions.delete(e)),delete this.latestValues[e],this.removeValueFromRenderState(e,this.renderState)}hasValue(e){return this.values.has(e)}getValue(e,t){if(this.props.values&&this.props.values[e])return this.props.values[e];let s=this.values.get(e);return void 0===s&&void 0!==t&&(s=Ao(null===t?void 0:t,{owner:this}),this.addValue(e,s)),s}readValue(e,t){let s=void 0===this.latestValues[e]&&this.current?this.getBaseTargetFromProps(this.props,e)??this.readValueFromInstance(this.current,e,this.options):this.latestValues[e];return null!=s&&("string"==typeof s&&(rr(s)||ir(s))?s=parseFloat(s):!(e=>Go.find(ho(e)))(s)&&wn.test(t)&&(s=_o(e,t)),this.setBaseTarget(e,zo(s)?s.get():s)),zo(s)?s.get():s}setBaseTarget(e,t){this.baseTarget[e]=t}getBaseTarget(e){const{initial:t}=this.props;let s;if("string"==typeof t||"object"==typeof t){const a=Xl(this.props,t,this.presenceContext?.custom);a&&(s=a[e])}if(t&&void 0!==s)return s;const a=this.getBaseTargetFromProps(this.props,e);return void 0===a||zo(a)?void 0!==this.initialValues[e]&&void 0===s?void 0:this.baseTarget[e]:a}on(e,t){return this.events[e]||(this.events[e]=new ur),this.events[e].add(t)}notify(e,...t){this.events[e]&&this.events[e].notify(...t)}}class Wm extends Xm{constructor(){super(...arguments),this.KeyframeResolver=So}sortInstanceNodePosition(e,t){return 2&e.compareDocumentPosition(t)?1:-1}getBaseTargetFromProps(e,t){return e.style?e.style[t]:void 0}removeValueFromRenderState(e,{vars:t,style:s}){delete t[e],delete s[e]}handleChildMotionValue(){this.childSubscription&&(this.childSubscription(),delete this.childSubscription);const{children:e}=this.props;zo(e)&&(this.childSubscription=e.on("change",(e=>{this.current&&(this.current.textContent=`${e}`)})))}}function Ym(e,{style:t,vars:s},a,r){Object.assign(e.style,t,r&&r.getProjectionStyles(a));for(const n in s)e.style.setProperty(n,s[n])}class Km extends Wm{constructor(){super(...arguments),this.type="html",this.renderInstance=Ym}readValueFromInstance(e,t){if(Ti.has(t))return this.projection?.isProjecting?ki(t):((e,t)=>{const{transform:s="none"}=getComputedStyle(e);return Ai(s,t)})(e,t);{const a=(s=e,window.getComputedStyle(s)),r=(zr(t)?a.getPropertyValue(t):a[t])||0;return"string"==typeof r?r.trim():r}var s}measureInstanceViewportBox(e,{transformPagePoint:t}){return ad(e,t)}build(e,t,s){Tl(e,t,s.transformTemplate)}scrapeMotionValuesFromProps(e,t,s){return Jl(e,t,s)}}const Jm=new Set(["baseFrequency","diffuseConstant","kernelMatrix","kernelUnitLength","keySplines","keyTimes","limitingConeAngle","markerHeight","markerWidth","numOctaves","targetX","targetY","surfaceScale","specularConstant","specularExponent","stdDeviation","tableValues","viewBox","gradientTransform","pathLength","startOffset","textLength","lengthAdjust"]);class Qm extends Wm{constructor(){super(...arguments),this.type="svg",this.isSVGTag=!1,this.measureInstanceViewportBox=Oc}getBaseTargetFromProps(e,t){return e[t]}readValueFromInstance(e,t){if(Ti.has(t)){const e=wo(t);return e&&e.default||0}return t=Jm.has(t)?t:jl(t),e.getAttribute(t)}scrapeMotionValuesFromProps(e,t,s){return Zl(e,t,s)}build(e,t,s){Fl(e,t,this.isSVGTag,s.transformTemplate,s.style)}renderInstance(e,t,s,a){!function(e,t,s,a){Ym(e,t,void 0,a);for(const r in t.attrs)e.setAttribute(Jm.has(r)?r:jl(r),t.attrs[r])}(e,t,0,a)}mount(e){this.isSVGTag=Ol(e.tagName),super.mount(e)}}const Zm=ll(tc({...Pc,...Om,...Tm,...Bm},((t,s)=>zl(t)?new Qm(s):new Km(s,{allowProjection:t!==e.Fragment}))));function eu({children:e,className:s,...a}){return t.jsx(Zm.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.3},className:Hs("relative overflow-hidden rounded-2xl border bg-card p-8 shadow-xl",'before:absolute before:-left-80 before:-top-80 before:h-[500px] before:w-[500px] before:rounded-full before:bg-primary/20 before:blur-3xl before:content-[""]','after:absolute after:-right-80 after:-top-80 after:h-[500px] after:w-[500px] after:rounded-full after:bg-secondary/20 after:blur-3xl after:content-[""]',s),...a,children:e})}const tu=r("/_public/auth")({component:function(){const[s,a]=e.useState(!0),{signInWithEmail:r,signUpWithEmail:i,loading:o,isAuthenticated:l}=Vs(),c=n(),{auth:d}=tu.useSearch();e.useEffect((()=>{if(l){let t="/game";if(d&&"string"==typeof d&&""!==d.trim()&&"true"!==d)try{const e=decodeURIComponent(d);e&&e.startsWith("/")&&!e.includes("[object")&&!e.startsWith("/auth")&&(t=e)}catch(e){t="/game"}c({to:t})}}),[l,d,c]);return t.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gradient-to-b from-background via-background/95 to-background/90 transition-colors duration-300",children:t.jsx(eu,{className:"w-full max-w-md",children:t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"space-y-2",children:[t.jsx("h1",{className:"text-2xl font-semibold tracking-tight",children:s?"Login":"Criar Conta"}),t.jsx("p",{className:"text-sm text-muted-foreground",children:s?"Entre com suas credenciais para acessar o sistema":"Preencha os dados abaixo para criar sua conta"})]}),s?t.jsx(Xa,{onSubmit:async e=>{try{const t=await r(e);t.success||j.error("Erro ao fazer login",{description:t.error||"Ocorreu um erro inesperado"})}catch(t){j.error("Erro ao fazer login",{description:t instanceof Error?t.message:"Ocorreu um erro inesperado"})}},isLoading:o.signIn}):t.jsx(Wa,{onSubmit:async e=>{try{const t={email:e.email,password:e.password,username:e.email.split("@")[0]},s=await i(t);s.success||s.error&&s.error.includes("Email rate limit")?(j.success("Conta criada com sucesso",{description:"Por favor, verifique seu e-mail para confirmar sua conta."}),c({to:"/auth/verify-email",search:{auth:"true"}})):j.error("Erro ao criar conta",{description:s.error||"Ocorreu um erro inesperado"})}catch(t){j.error("Erro ao criar conta",{description:t instanceof Error?t.message:"Ocorreu um erro inesperado"})}},isLoading:o.signUp}),t.jsx(Ws,{type:"button",variant:"ghost",className:"w-full",onClick:()=>a(!s),disabled:o.signIn||o.signUp,children:s?"Não tem uma conta? Criar conta":"Já tem uma conta? Fazer login"})]})})})},validateSearch:e=>({auth:e.auth||""})});const su=new class{async getUserProfile(){try{const{data:{user:e},error:t}=await Es.auth.getUser();if(t)throw t;if(!e)return{data:null,error:"Usuário não autenticado"};const{data:s,error:a}=await Es.from("users").select("*").eq("uid",e.id).maybeSingle();if(a)throw a;return{data:s,error:null}}catch(e){return{data:null,error:e instanceof Error?e.message:"Erro ao buscar perfil"}}}async searchUsers(e){try{let t=Es.from("users").select("id",{count:"exact"});e.nome&&(t=t.ilike("nome",`%${e.nome}%`)),e.email&&(t=t.ilike("email",`%${e.email}%`)),e.role&&(t=t.eq("role",e.role)),void 0!==e.ativo&&(t=t.eq("ativo",e.ativo));const{count:s,error:a}=await t;if(a)throw a;let r=Es.from("users").select("*").order("created_at",{ascending:!1});e.nome&&(r=r.ilike("nome",`%${e.nome}%`)),e.email&&(r=r.ilike("email",`%${e.email}%`)),e.role&&(r=r.eq("role",e.role)),void 0!==e.ativo&&(r=r.eq("ativo",e.ativo));const{data:n,error:i}=await r.range((e.page-1)*e.limit,e.page*e.limit-1);if(i)throw i;return{data:n,count:s||0,error:null}}catch(t){return{data:null,count:0,error:t instanceof Error?t.message:"Erro ao buscar usuários"}}}async updateUser(e,t){try{let s;if(t.imagemPerfil){const a=t.imagemPerfil.name.split(".").pop(),r=`${e}-${Date.now()}.${a}`,{error:n}=await Es.storage.from("profile-images").upload(r,t.imagemPerfil,{cacheControl:"3600",upsert:!0});if(n)throw n;const{data:{publicUrl:i}}=Es.storage.from("profile-images").getPublicUrl(r);s=i,delete t.imagemPerfil}const{error:a}=await Es.from("users").update({...t,...s&&{imagem_perfil_url:s},updated_at:(new Date).toISOString()}).eq("uid",e);if(a)throw a;return{error:null}}catch(s){return{error:s instanceof Error?s.message:"Erro ao atualizar usuário"}}}};const au=e.forwardRef((({className:e,...s},a)=>t.jsx("div",{className:"relative w-full overflow-auto",children:t.jsx("table",{ref:a,className:Hs("w-full caption-bottom text-sm",e),...s})})));au.displayName="Table";const ru=e.forwardRef((({className:e,...s},a)=>t.jsx("thead",{ref:a,className:Hs("[&_tr]:border-b",e),...s})));ru.displayName="TableHeader";const nu=e.forwardRef((({className:e,...s},a)=>t.jsx("tbody",{ref:a,className:Hs("[&_tr:last-child]:border-0",e),...s})));nu.displayName="TableBody";e.forwardRef((({className:e,...s},a)=>t.jsx("tfoot",{ref:a,className:Hs("border-t bg-muted/50 font-medium [&>tr]:last:border-b-0",e),...s}))).displayName="TableFooter";const iu=e.forwardRef((({className:e,...s},a)=>t.jsx("tr",{ref:a,className:Hs("border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted",e),...s})));iu.displayName="TableRow";const ou=e.forwardRef((({className:e,...s},a)=>t.jsx("th",{ref:a,className:Hs("h-10 px-2 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",e),...s})));ou.displayName="TableHead";const lu=e.forwardRef((({className:e,...s},a)=>t.jsx("td",{ref:a,className:Hs("p-2 align-middle [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",e),...s})));lu.displayName="TableCell";e.forwardRef((({className:e,...s},a)=>t.jsx("caption",{ref:a,className:Hs("mt-4 text-sm text-muted-foreground",e),...s}))).displayName="TableCaption";const cu=je,du=Ne,mu=e.forwardRef((({className:e,children:s,...a},r)=>t.jsxs(ie,{ref:r,className:Hs("flex h-9 w-full items-center justify-between whitespace-nowrap rounded-md border border-input bg-transparent px-3 py-2 text-sm shadow-sm ring-offset-background data-[placeholder]:text-muted-foreground focus:outline-none focus:ring-1 focus:ring-ring disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",e),...a,children:[s,t.jsx(oe,{asChild:!0,children:t.jsx(le,{className:"h-4 w-4 opacity-50"})})]})));mu.displayName=ie.displayName;const uu=e.forwardRef((({className:e,...s},a)=>t.jsx(ce,{ref:a,className:Hs("flex cursor-default items-center justify-center py-1",e),...s,children:t.jsx(de,{className:"h-4 w-4"})})));uu.displayName=ce.displayName;const hu=e.forwardRef((({className:e,...s},a)=>t.jsx(me,{ref:a,className:Hs("flex cursor-default items-center justify-center py-1",e),...s,children:t.jsx(le,{className:"h-4 w-4"})})));hu.displayName=me.displayName;const pu=e.forwardRef((({className:e,children:s,position:a="popper",...r},n)=>t.jsx(ue,{children:t.jsxs(he,{ref:n,className:Hs("relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2","popper"===a&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",e),position:a,...r,children:[t.jsx(uu,{}),t.jsx(pe,{className:Hs("p-1","popper"===a&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:s}),t.jsx(hu,{})]})})));pu.displayName=he.displayName;e.forwardRef((({className:e,...s},a)=>t.jsx(xe,{ref:a,className:Hs("px-2 py-1.5 text-sm font-semibold",e),...s}))).displayName=xe.displayName;const xu=e.forwardRef((({className:e,children:s,...a},r)=>t.jsxs(fe,{ref:r,className:Hs("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-2 pr-8 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",e),...a,children:[t.jsx("span",{className:"absolute right-2 flex h-3.5 w-3.5 items-center justify-center",children:t.jsx(ge,{children:t.jsx(be,{className:"h-4 w-4"})})}),t.jsx(ve,{children:s})]})));xu.displayName=fe.displayName;e.forwardRef((({className:e,...s},a)=>t.jsx(ye,{ref:a,className:Hs("-mx-1 my-1 h-px bg-muted",e),...s}))).displayName=ye.displayName;const fu=e.forwardRef((({className:e,...s},a)=>t.jsx("div",{ref:a,className:Hs("w-full max-w-full rounded-xl border bg-card text-card-foreground shadow",e),...s})));fu.displayName="Card";const gu=e.forwardRef((({className:e,...s},a)=>t.jsx("div",{ref:a,className:Hs("flex flex-col space-y-1.5 p-4 sm:p-6",e),...s})));gu.displayName="CardHeader";const bu=e.forwardRef((({className:e,...s},a)=>t.jsx("div",{ref:a,className:Hs("break-words font-semibold leading-none tracking-tight",e),...s})));bu.displayName="CardTitle";const vu=e.forwardRef((({className:e,...s},a)=>t.jsx("div",{ref:a,className:Hs("break-words text-sm text-muted-foreground",e),...s})));vu.displayName="CardDescription";const yu=e.forwardRef((({className:e,...s},a)=>t.jsx("div",{ref:a,className:Hs("w-full p-4 sm:p-6 overflow-hidden rounded-[calc(0.75rem-1px)]",e),...s})));yu.displayName="CardContent";const ju=e.forwardRef((({className:e,...s},a)=>t.jsx("div",{ref:a,className:Hs("flex flex-wrap items-center gap-2 p-4 pt-0 sm:p-6 sm:pt-0",e),...s})));function Nu({children:s}){const a=n(),{user:r,loading:i}=Vs();return e.useEffect((()=>{!i.onAuthUserChanged&&r&&"ADMIN"!==r.role&&(j.error("Você não tem permissão para acessar esta página"),a({to:"/403"}))}),[r,i.onAuthUserChanged,a]),i.onAuthUserChanged||!r?t.jsx(Os,{}):"ADMIN"!==r.role?t.jsx(t.Fragment,{}):s}ju.displayName="CardFooter";const wu=L("inline-flex items-center rounded-md border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground shadow hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground shadow hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function _u({className:e,variant:s,...a}){return t.jsx("div",{className:Hs(wu({variant:s}),e),...a})}const Cu={ADMIN:"Administrador",PLAYER:"Jogador"},Su=r("/_authenticated/users")({component:function(){const s=n(),{users:a,loading:r,searchUsers:i}=function(){const[t,s]=e.useState(!1),[a,r]=e.useState(null),[n,i]=e.useState(null),[o,l]=e.useState([]);return{user:n,users:o,loading:t,error:a,getUserProfile:e.useCallback((async()=>{try{s(!0),r(null);const{data:e,error:t}=await su.getUserProfile();if(t)throw new Error(t);return e&&i(e),e}catch(e){const t=e instanceof Error?e.message:"Erro ao buscar perfil";return r(t),null}finally{s(!1)}}),[]),searchUsers:e.useCallback((async e=>{try{s(!0),r(null);const{data:t,error:a}=await su.searchUsers(e);if(a)throw new Error(a);t&&l(t)}catch(t){const e=t instanceof Error?t.message:"Erro ao buscar usuários";r(e)}finally{s(!1)}}),[])}}(),[o,l]=e.useState({page:1,limit:10});e.useEffect((()=>{i(o)}),[o,i]);const c=e=>{switch(e){case"ADMIN":return"bg-red-500";case"PLAYER":return"bg-blue-500";default:return"bg-gray-500"}};return t.jsx(Nu,{children:t.jsx("div",{className:"container mx-auto py-8",children:t.jsxs(fu,{children:[t.jsx(gu,{children:t.jsx("div",{className:"flex items-center justify-between",children:t.jsx(bu,{children:"Usuários"})})}),t.jsxs(yu,{children:[t.jsxs("div",{className:"mb-6 grid grid-cols-1 gap-4 md:grid-cols-3",children:[t.jsx(qa,{placeholder:"Nome",value:o.nome||"",onChange:e=>l({...o,nome:e.target.value})}),t.jsx(qa,{placeholder:"Email",value:o.email||"",onChange:e=>l({...o,email:e.target.value})}),t.jsxs(cu,{value:o.role,onValueChange:e=>l({...o,role:e}),children:[t.jsx(mu,{children:t.jsx(du,{placeholder:"Tipo de Usuário"})}),t.jsxs(pu,{children:[t.jsx(xu,{value:"ADMIN",children:"Administrador"}),t.jsx(xu,{value:"PLAYER",children:"Jogador"})]})]})]}),t.jsx("div",{className:"rounded-md border",children:t.jsxs(au,{children:[t.jsx(ru,{children:t.jsxs(iu,{children:[t.jsx(ou,{children:"Nome"}),t.jsx(ou,{children:"Email"}),t.jsx(ou,{children:"Tipo"}),t.jsx(ou,{children:"Maior Andar"}),t.jsx(ou,{children:"Total de Jogos"}),t.jsx(ou,{children:"Vitórias"}),t.jsx(ou,{children:"Ações"})]})}),t.jsx(nu,{children:r?t.jsx(iu,{children:t.jsx(lu,{colSpan:7,className:"text-center",children:"Carregando..."})}):0===a.length?t.jsx(iu,{children:t.jsx(lu,{colSpan:7,className:"text-center",children:"Nenhum usuário encontrado"})}):a.map((e=>t.jsxs(iu,{children:[t.jsx(lu,{children:e.nome}),t.jsx(lu,{children:e.email}),t.jsx(lu,{children:t.jsx(_u,{className:c(e.role),children:Cu[e.role]})}),t.jsx(lu,{children:e.highest_floor}),t.jsx(lu,{children:e.total_games}),t.jsx(lu,{children:e.total_victories}),t.jsx(lu,{children:t.jsx(Ws,{variant:"ghost",onClick:()=>s({to:`/users/${e.id}`}),children:"Visualizar"})})]},e.id)))})]})})]})]})})})}});var Eu=l();function ku(){return()=>{}}var Au="Avatar",[Pu,Mu]=we(Au),[Tu,qu]=Pu(Au),Du=e.forwardRef(((s,a)=>{const{__scopeAvatar:r,...n}=s,[i,o]=e.useState("idle");return t.jsx(Tu,{scope:r,imageLoadingStatus:i,onImageLoadingStatusChange:o,children:t.jsx(ne.span,{...n,ref:a})})}));Du.displayName=Au;var Ru="AvatarImage",Lu=e.forwardRef(((s,a)=>{const{__scopeAvatar:r,src:n,onLoadingStatusChange:i=()=>{},...o}=s,l=qu(Ru,r),c=function(t,{referrerPolicy:s,crossOrigin:a}){const r=Eu.useSyncExternalStore(ku,(()=>!0),(()=>!1)),n=e.useRef(null),i=r?(n.current||(n.current=new window.Image),n.current):null,[o,l]=e.useState((()=>Fu(i,t)));return Ce((()=>{l(Fu(i,t))}),[i,t]),Ce((()=>{const e=e=>()=>{l(e)};if(!i)return;const t=e("loaded"),r=e("error");return i.addEventListener("load",t),i.addEventListener("error",r),s&&(i.referrerPolicy=s),"string"==typeof a&&(i.crossOrigin=a),()=>{i.removeEventListener("load",t),i.removeEventListener("error",r)}}),[i,a,s]),o}(n,o),d=_e((e=>{i(e),l.onImageLoadingStatusChange(e)}));return Ce((()=>{"idle"!==c&&d(c)}),[c,d]),"loaded"===c?t.jsx(ne.img,{...o,ref:a,src:n}):null}));Lu.displayName=Ru;var $u="AvatarFallback",Iu=e.forwardRef(((s,a)=>{const{__scopeAvatar:r,delayMs:n,...i}=s,o=qu($u,r),[l,c]=e.useState(void 0===n);return e.useEffect((()=>{if(void 0!==n){const e=window.setTimeout((()=>c(!0)),n);return()=>window.clearTimeout(e)}}),[n]),l&&"loaded"!==o.imageLoadingStatus?t.jsx(ne.span,{...i,ref:a}):null}));function Fu(e,t){return e?t?(e.src!==t&&(e.src=t),e.complete&&e.naturalWidth>0?"loaded":"loading"):"error":"idle"}Iu.displayName=$u;var Vu=Du,Ou=Lu,Bu=Iu;const Uu=e.forwardRef((({className:e,...s},a)=>t.jsx(Vu,{ref:a,className:Hs("relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full",e),...s})));Uu.displayName=Vu.displayName;const zu=e.forwardRef((({className:e,...s},a)=>t.jsx(Ou,{ref:a,className:Hs("aspect-square h-full w-full",e),...s})));zu.displayName=Ou.displayName;const Gu=e.forwardRef((({className:e,...s},a)=>t.jsx(Bu,{ref:a,className:Hs("flex h-full w-full items-center justify-center rounded-full bg-muted",e),...s})));function Hu(){const{isInstalled:s,canInstall:a}=Ks(),[r,n]=e.useState(!0),[i,o]=e.useState(!1);e.useEffect((()=>{const e=()=>n(navigator.onLine);window.addEventListener("online",e),window.addEventListener("offline",e);return(()=>{const e=window.matchMedia("(display-mode: standalone)").matches,t=window.matchMedia("(display-mode: fullscreen)").matches;o(e||t)})(),()=>{window.removeEventListener("online",e),window.removeEventListener("offline",e)}}),[]);const l=[{name:"Modo Offline",status:"serviceWorker"in navigator,icon:r?Ee:ke,description:r?"Online":"Offline"},{name:"PWA Instalado",status:s,icon:s?Ae:F,description:s?"Instalado":a?"Disponível":"Não disponível"},{name:"Modo Tela Cheia",status:i,icon:Se,description:i?"Ativo":"Navegador"},{name:"Service Worker",status:"serviceWorker"in navigator,icon:"serviceWorker"in navigator?Ae:Pe,description:"serviceWorker"in navigator?"Suportado":"Não suportado"}];return t.jsxs(fu,{className:"w-full max-w-md",children:[t.jsx(gu,{children:t.jsxs(bu,{className:"flex items-center gap-2",children:[t.jsx(Se,{className:"h-5 w-5"}),"Status PWA"]})}),t.jsxs(yu,{className:"space-y-3",children:[l.map((e=>{const s=e.icon;return t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(s,{className:"h-4 w-4 "+(e.status?"text-green-500":"text-red-500")}),t.jsx("span",{className:"text-sm font-medium",children:e.name})]}),t.jsx(_u,{variant:e.status?"default":"secondary",children:e.description})]},e.name)})),!r&&t.jsx("div",{className:"mt-4 p-3 bg-orange-50 dark:bg-orange-950 border border-orange-200 dark:border-orange-800 rounded-md",children:t.jsx("p",{className:"text-sm text-orange-800 dark:text-orange-200",children:"🌐 Você está offline! O jogo ainda pode funcionar com recursos em cache."})})]})]})}Gu.displayName=Bu.displayName;const Xu=f({nome:g().min(3,"Nome deve ter no mínimo 3 caracteres"),tipo_pessoa:A(["PF","PJ"]),documento:g().optional(),telefone:g().optional(),data_nascimento:g().optional()}),Wu=r("/_authenticated/profile")({component:function(){const{user:s}=Vs(),a=n(),[r,i]=e.useState(null),[o,l]=e.useState(!0),c=e.useRef(null),[d,m]=e.useState(null),u=k({resolver:Ta(Xu),defaultValues:{nome:"",tipo_pessoa:"PF"}});e.useEffect((()=>{(async()=>{try{l(!0);const{data:e,error:t}=await su.getUserProfile();if(t)return void j.error("Erro",{description:t});e&&(i(e),u.reset({nome:e.nome,tipo_pessoa:e.tipo_pessoa,documento:e.documento,telefone:e.telefone,data_nascimento:e.data_nascimento}))}catch(e){j.error("Erro",{description:e instanceof Error?e.message:"Não foi possível carregar seu perfil"})}finally{l(!1)}})()}),[u]);if(o)return t.jsx("div",{className:"container mx-auto px-4 py-6",children:t.jsx(fu,{children:t.jsx(gu,{children:t.jsx(bu,{children:"Carregando..."})})})});return t.jsxs("div",{className:"container mx-auto px-4 py-6",children:[t.jsx("div",{className:"space-y-3 sm:space-y-4 mb-6",children:t.jsxs("div",{className:"flex flex-col gap-3",children:[t.jsxs(Ws,{variant:"outline",size:"sm",onClick:()=>a({to:"/game"}),className:"self-start",children:[t.jsx(Me,{className:"h-4 w-4 mr-2"}),t.jsx("span",{className:"hidden sm:inline",children:"Voltar ao Menu"}),t.jsx("span",{className:"sm:hidden",children:"Voltar"})]}),t.jsxs("div",{children:[t.jsx("h1",{className:"text-2xl sm:text-3xl font-bold",children:"Perfil"}),t.jsx("p",{className:"text-sm sm:text-base text-muted-foreground",children:"Gerencie suas informações pessoais"})]})]})}),t.jsxs("div",{className:"grid gap-6",children:[t.jsxs(fu,{children:[t.jsxs(gu,{children:[t.jsx(bu,{children:"Foto de Perfil"}),t.jsx(vu,{children:"Atualize sua foto de perfil"})]}),t.jsx(yu,{children:t.jsxs("div",{className:"flex items-center gap-4",children:[t.jsxs(Uu,{className:"h-24 w-24",children:[t.jsx(zu,{src:r?.imagem_perfil_url}),t.jsx(Gu,{children:r?.nome?.charAt(0)})]}),t.jsx(qa,{type:"file",ref:c,accept:"image/*",onChange:e=>{const t=e.target.files?.[0];t&&m(t)},className:"max-w-xs"})]})})]}),t.jsxs(fu,{children:[t.jsxs(gu,{children:[t.jsx(bu,{children:"Informações Pessoais"}),t.jsx(vu,{children:"Atualize suas informações pessoais"})]}),t.jsx(yu,{children:t.jsx(Ia,{...u,children:t.jsxs("form",{onSubmit:u.handleSubmit((async e=>{if(s?.id&&r)try{const{error:t}=await su.updateUser(s.id,{...e,data_nascimento:e.data_nascimento?new Date(e.data_nascimento):void 0,imagemPerfil:d||void 0});if(t)throw new Error(t);const{data:a,error:r}=await su.getUserProfile();if(r)throw new Error(r);a&&i(a),j.success("Sucesso",{description:"Perfil atualizado com sucesso!"}),m(null)}catch(t){j.error("Erro",{description:t instanceof Error?t.message:"Erro ao atualizar perfil"})}})),className:"space-y-4",children:[t.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[t.jsx(Va,{control:u.control,name:"nome",render:({field:e})=>t.jsxs(Ua,{children:[t.jsx(za,{children:"Nome *"}),t.jsx(Ga,{children:t.jsx(qa,{...e})}),t.jsx(Ha,{})]})}),t.jsx(Va,{control:u.control,name:"tipo_pessoa",render:({field:e})=>t.jsxs(Ua,{children:[t.jsx(za,{children:"Tipo de Pessoa *"}),t.jsxs(cu,{onValueChange:e.onChange,defaultValue:e.value,children:[t.jsx(Ga,{children:t.jsx(mu,{children:t.jsx(du,{placeholder:"Selecione o tipo de pessoa"})})}),t.jsxs(pu,{children:[t.jsx(xu,{value:"PF",children:"Pessoa Física"}),t.jsx(xu,{value:"PJ",children:"Pessoa Jurídica"})]})]}),t.jsx(Ha,{})]})}),t.jsx(Va,{control:u.control,name:"documento",render:({field:e})=>t.jsxs(Ua,{children:[t.jsx(za,{children:"PF"===u.watch("tipo_pessoa")?"CPF":"CNPJ"}),t.jsx(Ga,{children:t.jsx(qa,{...e,value:e.value||""})}),t.jsx(Ha,{})]})}),t.jsx(Va,{control:u.control,name:"telefone",render:({field:e})=>t.jsxs(Ua,{children:[t.jsx(za,{children:"Telefone"}),t.jsx(Ga,{children:t.jsx(qa,{...e,value:e.value||""})}),t.jsx(Ha,{})]})}),t.jsx(Va,{control:u.control,name:"data_nascimento",render:({field:e})=>t.jsxs(Ua,{children:[t.jsx(za,{children:"Data de Nascimento"}),t.jsx(Ga,{children:t.jsx(qa,{type:"date",...e,value:e.value||""})}),t.jsx(Ha,{})]})})]}),t.jsx("div",{className:"flex justify-end",children:t.jsx(Ws,{type:"submit",children:"Salvar"})})]})})})]}),t.jsx(Hu,{})]})]})}});function Yu(){return t.jsxs(fu,{className:"w-full max-w-md",children:[t.jsx(gu,{children:t.jsxs(bu,{className:"flex items-center gap-2",children:[t.jsx(Te,{className:"h-5 w-5 text-primary"}),"Sobre Tower Trials"]})}),t.jsxs(yu,{className:"space-y-4",children:[t.jsx("p",{className:"text-sm text-muted-foreground",children:"Um jogo de aventura em que você sobe uma torre mágica, enfrentando inimigos cada vez mais fortes em cada andar. Quanto mais alto você chegar, melhor será sua posição no ranking."}),t.jsxs("div",{className:"grid grid-cols-1 gap-3 mt-4",children:[t.jsxs("div",{className:"flex items-start gap-3 p-3 bg-muted/50 rounded-md",children:[t.jsx("div",{className:"mt-1",children:t.jsx(qe,{className:"h-5 w-5 text-primary"})}),t.jsxs("div",{children:[t.jsx("h3",{className:"font-medium mb-1",children:"Progressão na Torre"}),t.jsx("p",{className:"text-sm text-muted-foreground",children:"Cada andar apresenta um inimigo mais forte. A dificuldade aumenta conforme você sobe, mas você recupera um pouco de HP a cada inimigo derrotado."})]})]}),t.jsxs("div",{className:"flex items-start gap-3 p-3 bg-muted/50 rounded-md",children:[t.jsx("div",{className:"mt-1",children:t.jsx(se,{className:"h-5 w-5 text-primary"})}),t.jsxs("div",{children:[t.jsx("h3",{className:"font-medium mb-1",children:"Ataque"}),t.jsx("p",{className:"text-sm text-muted-foreground",children:"Ataque direto ao inimigo, causando dano baseado no seu valor de ataque menos a defesa do inimigo."})]})]}),t.jsxs("div",{className:"flex items-start gap-3 p-3 bg-muted/50 rounded-md",children:[t.jsx("div",{className:"mt-1",children:t.jsx(De,{className:"h-5 w-5 text-primary"})}),t.jsxs("div",{children:[t.jsx("h3",{className:"font-medium mb-1",children:"Defesa"}),t.jsx("p",{className:"text-sm text-muted-foreground",children:"Aumenta temporariamente sua defesa, reduzindo o dano recebido no próximo ataque do inimigo."})]})]}),t.jsxs("div",{className:"flex items-start gap-3 p-3 bg-muted/50 rounded-md",children:[t.jsx("div",{className:"mt-1",children:t.jsx(re,{className:"h-5 w-5 text-primary"})}),t.jsxs("div",{children:[t.jsx("h3",{className:"font-medium mb-1",children:"Habilidade Especial"}),t.jsx("p",{className:"text-sm text-muted-foreground",children:"Causa o dobro do seu dano de ataque, mas tem um cooldown de 3 turnos antes de poder ser usada novamente."})]})]})]})]})]})}const Ku=r("/_authenticated/game")({component:function(){if("/game"===i().pathname)return t.jsx(Ju,{});return t.jsx(a,{})}});function Ju(){const s=n(),{user:a}=Vs(),[r,i]=e.useState(!1);return t.jsxs("div",{className:"min-h-screen flex flex-col items-center justify-center bg-gradient-to-b from-background to-secondary p-4",children:[t.jsxs("div",{className:"w-full max-w-md text-center mb-8",children:[t.jsx("h1",{className:"text-4xl font-bold text-primary mb-2",children:"Tower Trials"}),t.jsx("p",{className:"text-foreground/80",children:"Suba a torre mágica, derrote inimigos e alcance o andar mais alto possível!"})]}),r?t.jsxs("div",{className:"w-full max-w-md mb-4",children:[t.jsx("div",{className:"flex justify-end mb-2",children:t.jsx(Ws,{variant:"ghost",size:"sm",className:"p-1 h-8 w-8",onClick:()=>i(!1),children:t.jsx(z,{className:"h-5 w-5"})})}),t.jsx(Yu,{})]}):t.jsxs(fu,{className:"w-full max-w-md mb-4",children:[t.jsx(gu,{children:t.jsx(bu,{className:"text-center",children:"Menu Principal"})}),t.jsxs(yu,{className:"space-y-4",children:[t.jsx(Ws,{onClick:()=>{s(a?{to:"/game/play"}:{to:"/auth",search:{auth:"true"}})},className:"w-full py-6 text-lg cursor-pointer",size:"lg",children:a?"Jogar":"Entrar para Jogar"}),t.jsx(Ws,{onClick:()=>{s({to:"/game/ranking"})},className:"w-full py-6 text-lg cursor-pointer",variant:"outline",size:"lg",children:"Ranking"}),a&&t.jsxs(Ws,{onClick:()=>{s({to:"/game/play/hub/cemetery",search:{character:""}})},className:"w-full py-4 text-base border border-red-500/20 bg-red-500/5 hover:bg-red-500/10 text-red-400 hover:text-red-300 cursor-pointer",variant:"ghost",size:"lg",children:[t.jsx(Re,{className:"h-5 w-5 mr-2"}),"Cemitério"]})]}),t.jsxs(ju,{className:"flex justify-between",children:[t.jsxs(Ws,{variant:"ghost",size:"sm",className:"flex items-center gap-1 cursor-pointer",onClick:()=>i(!0),children:[t.jsx(Le,{className:"h-4 w-4"}),t.jsx("span",{children:"Como Jogar"})]}),a?t.jsxs("div",{className:"text-sm text-muted-foreground",children:[t.jsx("span",{className:"font-medium",children:a.username||a.email})," |",t.jsx(o,{to:"/logout",className:"text-primary ml-1 hover:underline",children:"Sair"})]}):t.jsx(o,{to:"/auth",search:{auth:"true"},children:t.jsx(Ws,{variant:"ghost",size:"sm",className:"cursor-pointer",children:"Entrar / Criar Conta"})})]})]})]})}const Qu=r("/_authenticated/403")({component:function(){return t.jsx("div",{className:"w-full h-full flex items-center justify-center",children:t.jsx("h1",{children:"A página que você tentou acessar não existe ou você não possui a permissão necessária."})})}});const Zu=r("/_public/guide/")({component:function(){return t.jsx(pa,{children:t.jsx(eh,{})})}});function eh(){const[s,a]=e.useState({combat:!0,progression:!0}),r=e=>{a((t=>({...t,[e]:!t[e]})))};return t.jsxs("div",{className:"min-h-screen w-full bg-gradient-to-b from-slate-950 via-slate-900 to-slate-800 text-white",children:[t.jsx("header",{className:"border-b border-slate-700 bg-slate-900/50 backdrop-blur sticky top-0 z-40",children:t.jsxs("div",{className:"max-w-6xl mx-auto px-4 py-6 flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("h1",{className:"text-3xl font-black bg-gradient-to-r from-amber-400 to-orange-500 bg-clip-text text-transparent",children:"Guia Completo"}),t.jsx("p",{className:"text-slate-400 text-sm",children:"Tower Trials - Sistema & Estratégia"})]}),t.jsxs("a",{href:"/home",className:"inline-flex items-center gap-2 px-4 py-2 text-slate-300 hover:text-amber-400 transition-colors",children:[t.jsx(Me,{className:"w-4 h-4"}),"Voltar"]})]})}),t.jsxs("div",{className:"max-w-6xl mx-auto px-4 py-12",children:[t.jsxs("div",{className:"bg-slate-800/50 backdrop-blur border border-slate-700 rounded-lg p-8 mb-12",children:[t.jsx("h2",{className:"text-2xl font-bold mb-6 text-amber-400",children:"Índice"}),t.jsxs("div",{className:"grid md:grid-cols-2 gap-6 text-slate-300",children:[t.jsxs("div",{children:[t.jsx("a",{href:"#combat",className:"hover:text-amber-400 transition-colors cursor-pointer",children:"• Sistema de Combate"}),t.jsx("a",{href:"#progression",className:"hover:text-amber-400 transition-colors block mt-2 cursor-pointer",children:"• Progressão & Níveis"}),t.jsx("a",{href:"#attributes",className:"hover:text-amber-400 transition-colors block mt-2 cursor-pointer",children:"• Atributos Detalhados"}),t.jsx("a",{href:"#equipment",className:"hover:text-amber-400 transition-colors block mt-2 cursor-pointer",children:"• Sistema de Equipamento"})]}),t.jsxs("div",{children:[t.jsx("a",{href:"#spells",className:"hover:text-amber-400 transition-colors cursor-pointer",children:"• Spells & Magias"}),t.jsx("a",{href:"#monsters",className:"hover:text-amber-400 transition-colors block mt-2 cursor-pointer",children:"• Bestiary"}),t.jsx("a",{href:"#economy",className:"hover:text-amber-400 transition-colors block mt-2 cursor-pointer",children:"• Economia & Gold"}),t.jsx("a",{href:"#tips",className:"hover:text-amber-400 transition-colors block mt-2 cursor-pointer",children:"• Dicas & Estratégia"})]})]})]}),t.jsx(th,{id:"combat",title:"Sistema de Combate",expanded:s.combat,onToggle:()=>r("combat"),children:t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"bg-slate-800/30 rounded-lg p-6",children:[t.jsx("h3",{className:"text-xl font-bold mb-4 text-amber-400",children:"Turno a Turno"}),t.jsx("p",{className:"text-slate-300 mb-4",children:"O combate é baseado em turnos. Durante cada turno, você escolhe uma ação: Atacar, Defender, Usar Magia ou Usar Consumível. Após sua ação, o inimigo responde."}),t.jsxs("div",{className:"space-y-3",children:[t.jsx(sh,{title:"Atacar",description:"Causa dano baseado em seu ATK",formula:"Dano = ATK ± 20% (variação)",color:"red"}),t.jsx(sh,{title:"Defender",description:"Aumenta DEF temporariamente e reduz dano",formula:"DEF aumenta 50% por 1 turno",color:"blue"}),t.jsx(sh,{title:"Magia",description:"Lança um spell consumindo Mana",formula:"Baseado no tipo de magia",color:"purple"}),t.jsx(sh,{title:"Consumível",description:"Usa poção ou item especial",formula:"1x por turno máximo",color:"emerald"})]})]}),t.jsxs("div",{className:"bg-gradient-to-r from-slate-800/50 to-slate-700/50 backdrop-blur border border-slate-600 rounded-lg p-6",children:[t.jsx("h3",{className:"text-xl font-bold mb-4 text-amber-400",children:"Cálculo de Dano"}),t.jsxs("div",{className:"space-y-3 font-mono text-sm bg-slate-900/50 p-4 rounded",children:[t.jsxs("div",{children:[t.jsx("span",{className:"text-amber-400",children:"Dano Base:"})," Inimigo ATK - Seu DEF"]}),t.jsxs("div",{children:[t.jsx("span",{className:"text-amber-400",children:"Crítico:"})," 30% chance com Speed"]}),t.jsxs("div",{children:[t.jsx("span",{className:"text-amber-400",children:"Crítico Multiplier:"})," Dano × 1.5-2.0"]}),t.jsx("div",{className:"mt-3 text-slate-400",children:"Exemplo: Inimigo ATK 25, Seu DEF 10 = 15 dano base"})]})]})]})}),t.jsx(th,{id:"progression",title:"Progressão & Níveis",expanded:s.progression,onToggle:()=>r("progression"),children:t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"bg-slate-800/30 rounded-lg p-6",children:[t.jsx("h3",{className:"text-xl font-bold mb-4 text-amber-400",children:"Fórmula de Progressão"}),t.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[t.jsxs("div",{className:"bg-slate-900/50 p-4 rounded-lg",children:[t.jsx("p",{className:"text-slate-300 mb-3 font-semibold",children:"XP Necessário por Nível:"}),t.jsx("div",{className:"font-mono text-amber-400 mb-4",children:"50 × (Nível²)"}),t.jsxs("div",{className:"space-y-2 text-sm text-slate-400",children:[t.jsx("div",{children:"Nível 1→2: 150 XP"}),t.jsx("div",{children:"Nível 5→6: 1,300 XP"}),t.jsx("div",{children:"Nível 10→11: 5,050 XP"}),t.jsx("div",{children:"Nível 20→21: 20,550 XP"})]})]}),t.jsxs("div",{className:"bg-slate-900/50 p-4 rounded-lg",children:[t.jsx("p",{className:"text-slate-300 mb-3 font-semibold",children:"Slots de Personagem:"}),t.jsxs("div",{className:"space-y-2 text-sm text-slate-400",children:[t.jsxs("div",{children:["Nível 1: ",t.jsx("span",{className:"text-amber-400",children:"1 slot"})]}),t.jsxs("div",{children:["Nível 5: ",t.jsx("span",{className:"text-amber-400",children:"2 slots"})]}),t.jsxs("div",{children:["Nível 10: ",t.jsx("span",{className:"text-amber-400",children:"3 slots"})]}),t.jsxs("div",{children:["Nível 20: ",t.jsx("span",{className:"text-amber-400",children:"∞ slots"})]})]})]})]})]}),t.jsxs("div",{className:"bg-slate-800/30 rounded-lg p-6",children:[t.jsx("h3",{className:"text-xl font-bold mb-4 text-amber-400",children:"Desbloques por Nível"}),t.jsx("div",{className:"grid md:grid-cols-2 gap-4 text-sm",children:[{level:1,unlock:"Bola de Fogo (Spell)"},{level:2,unlock:"Cura Menor (Spell)"},{level:5,unlock:"Slot de Personagem #2"},{level:10,unlock:"Slot de Personagem #3, Equipamentos Raros"},{level:15,unlock:"Equipamentos Épicos, Slots de Personagem #4"},{level:20,unlock:"Equipamentos Lendários, Slots Infinitos"}].map(((e,s)=>t.jsxs("div",{className:"bg-slate-900/50 p-3 rounded border border-slate-700",children:[t.jsxs("div",{className:"text-amber-400 font-semibold",children:["Nível ",e.level]}),t.jsx("div",{className:"text-slate-400 text-xs",children:e.unlock})]},s)))})]})]})}),t.jsx(th,{id:"attributes",title:"Atributos Detalhados",children:t.jsx("div",{className:"space-y-6",children:[{name:"HP (Hit Points)",desc:"Saúde total. Quando chega a 0, você morre.",source:"Equipamento + Nível"},{name:"ATK (Attack)",desc:"Dano básico causado em ataques físicos.",source:"Armas + Buffs"},{name:"DEF (Defense)",desc:"Reduz dano recebido. Máx 100 = Imunidade.",source:"Armaduras + Acessórios"},{name:"MANA",desc:"Energia para lançar spells. Regenera com o tempo.",source:"Equipamento + Magias"},{name:"SPD (Speed)",desc:"Chance de ataque crítico e ordem de ação.",source:"Boots + Acessórios"}].map(((e,s)=>t.jsxs("div",{className:"bg-slate-800/30 rounded-lg p-6 border border-slate-700",children:[t.jsx("h3",{className:"text-lg font-bold mb-2 text-amber-400",children:e.name}),t.jsx("p",{className:"text-slate-300 mb-3",children:e.desc}),t.jsxs("div",{className:"text-sm text-slate-400",children:[t.jsx("span",{className:"font-semibold text-slate-300",children:"Fontes:"})," ",e.source]})]},s)))})}),t.jsx(th,{id:"equipment",title:"Sistema de Equipamento",children:t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"bg-slate-800/30 rounded-lg p-6",children:[t.jsx("h3",{className:"text-xl font-bold mb-4 text-amber-400",children:"8 Slots de Equipamento"}),t.jsx("div",{className:"grid md:grid-cols-2 gap-4",children:[{slot:"Weapon",bonus:"+ATK"},{slot:"Shield",bonus:"+DEF"},{slot:"Armor (Chest)",bonus:"+DEF"},{slot:"Helmet",bonus:"+DEF"},{slot:"Legs",bonus:"+DEF"},{slot:"Ring",bonus:"Bônus Variado"},{slot:"Necklace",bonus:"Bônus Variado"},{slot:"Boots",bonus:"+SPD"}].map(((e,s)=>t.jsxs("div",{className:"bg-slate-900/50 p-4 rounded border border-slate-700",children:[t.jsx("div",{className:"font-semibold text-amber-400",children:e.slot}),t.jsx("div",{className:"text-slate-400 text-sm",children:e.bonus})]},s)))})]}),t.jsxs("div",{className:"bg-gradient-to-r from-slate-800/50 to-slate-700/50 backdrop-blur border border-slate-600 rounded-lg p-6",children:[t.jsx("h3",{className:"text-xl font-bold mb-4 text-amber-400",children:"Raridades & Progressão"}),t.jsx("div",{className:"space-y-3",children:[{rarity:"Common",color:"text-emerald-400",floors:"1-5",desc:"Básico, para iniciantes"},{rarity:"Uncommon",color:"text-blue-400",floors:"5-8",desc:"Bom balanceamento"},{rarity:"Rare",color:"text-purple-400",floors:"10-13",desc:"Poder significativo"},{rarity:"Epic",color:"text-orange-400",floors:"15-18",desc:"Muito poderoso"},{rarity:"Legendary",color:"text-yellow-400",floors:"20",desc:"Endgame supremo"}].map(((e,s)=>t.jsxs("div",{className:"flex items-center justify-between bg-slate-900/50 p-3 rounded",children:[t.jsxs("div",{children:[t.jsx("div",{className:`font-bold ${e.color}`,children:e.rarity}),t.jsx("div",{className:"text-xs text-slate-400",children:e.desc})]}),t.jsx("div",{className:"text-right text-xs text-slate-400",children:e.floors})]},s)))})]}),t.jsxs("div",{className:"bg-slate-800/30 rounded-lg p-6",children:[t.jsx("h3",{className:"text-lg font-bold mb-4 text-amber-400",children:"Dica: Build Equilibrado"}),t.jsx("p",{className:"text-slate-300 text-sm",children:"Não foque apenas em ATK. Um personagem bem balanceado com DEF e HP é muito mais sustentável que um vidro de ataque. Considere seus stats contra cada tipo de inimigo."})]})]})}),t.jsx(th,{id:"spells",title:"Spells & Magias",children:t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"bg-slate-800/30 rounded-lg p-6",children:[t.jsx("h3",{className:"text-xl font-bold mb-4 text-amber-400",children:"Tipos de Magias (50+)"}),t.jsx("div",{className:"grid md:grid-cols-2 gap-6",children:[{type:"Damage",examples:"Bola de Fogo, Meteoro, Raio",desc:"Causa dano puro ao inimigo"},{type:"Heal",examples:"Cura Menor, Cura Maior, Ressurreição",desc:"Restaura seu HP"},{type:"DoT",examples:"Veneno, Praga Tóxica, Corrosão",desc:"Dano contínuo por múltiplos turnos"},{type:"Buff",examples:"Força, Defesa, Transcendência",desc:"Aumenta seus stats temporariamente"},{type:"Debuff",examples:"Fraqueza, Silêncio, Maldição",desc:"Reduz stats do inimigo"},{type:"Utility",examples:"Drenar Energia, Vampirismo",desc:"Efeitos especiais únicos"}].map(((e,s)=>t.jsxs("div",{className:"bg-slate-900/50 p-4 rounded border border-slate-700",children:[t.jsx("div",{className:"font-bold text-amber-400 mb-2",children:e.type}),t.jsx("p",{className:"text-xs text-slate-300 mb-2",children:e.examples}),t.jsx("p",{className:"text-xs text-slate-400",children:e.desc})]},s)))})]}),t.jsxs("div",{className:"bg-gradient-to-r from-slate-800/50 to-slate-700/50 backdrop-blur border border-slate-600 rounded-lg p-6",children:[t.jsx("h3",{className:"text-xl font-bold mb-4 text-amber-400",children:"Progressão de Spells"}),t.jsx("p",{className:"text-slate-300 mb-4",children:"Você desbloqueia novos spells ao subir de nível. Combine diferentes tipos para máxima efetividade:"}),t.jsxs("div",{className:"space-y-2 text-sm text-slate-300",children:[t.jsxs("div",{children:["✓ ",t.jsx("span",{className:"font-semibold",children:"Nível Inicial:"})," 1-2 spells básicos"]}),t.jsxs("div",{children:["✓ ",t.jsx("span",{className:"font-semibold",children:"Níveis 5-10:"})," Mais dano, buffs e heals"]}),t.jsxs("div",{children:["✓ ",t.jsx("span",{className:"font-semibold",children:"Níveis 15-20:"})," Spells devastadores e utilitários"]})]})]})]})}),t.jsx(th,{id:"monsters",title:"Bestiary & Monstros",children:t.jsxs("div",{className:"space-y-6",children:[t.jsx("p",{className:"text-slate-300",children:"A torre contém 100+ monstros únicos, cada um com seus próprios stats, ataques e drops."}),[{tier:"Nível 1-5: Os Primeiros Passos",monsters:["Slime Verde","Slime Azul","Rato Gigante","Goblin","Kobold"],xp:"20-45 XP",gold:"10-40 Gold",difficulty:"Fácil"},{tier:"Nível 6-10: Intermediário",monsters:["Orc","Zumbi","Harpia","Golem de Pedra","Mago Corrompido"],xp:"60-140 XP",gold:"50-150 Gold",difficulty:"Médio"},{tier:"Nível 11-15: Avançado",monsters:["Ogro","Quimera","Hidra","Dragão Jovem","Lich"],xp:"140-280 XP",gold:"130-340 Gold",difficulty:"Difícil"},{tier:"Nível 16-20: End-Game",monsters:["Dragão Adulto","Titã de Pedra","Demônio Alado","Dragão Ancião"],xp:"300-800 XP",gold:"200-800 Gold",difficulty:"Extremo"}].map(((e,s)=>t.jsxs("div",{className:"bg-slate-800/30 rounded-lg p-6 border border-slate-700",children:[t.jsx("h3",{className:"text-lg font-bold mb-4 text-amber-400",children:e.tier}),t.jsxs("div",{className:"grid md:grid-cols-2 gap-4 mb-4",children:[t.jsxs("div",{children:[t.jsx("div",{className:"text-sm text-slate-400 mb-2",children:"Monstros:"}),t.jsx("div",{className:"text-slate-300 text-sm space-y-1",children:e.monsters.map(((e,s)=>t.jsxs("div",{children:["• ",e]},s)))})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsxs("div",{children:[t.jsx("div",{className:"text-sm text-slate-400",children:"Recompensas:"}),t.jsx("div",{className:"text-slate-300 text-sm",children:e.xp})]}),t.jsxs("div",{children:[t.jsx("div",{className:"text-sm text-slate-400",children:"Gold:"}),t.jsx("div",{className:"text-slate-300 text-sm",children:e.gold})]}),t.jsxs("div",{children:[t.jsx("div",{className:"text-sm text-slate-400",children:"Dificuldade:"}),t.jsx("div",{className:"text-sm font-semibold "+("Fácil"===e.difficulty?"text-emerald-400":"Médio"===e.difficulty?"text-yellow-400":"Difícil"===e.difficulty?"text-orange-400":"text-red-400"),children:e.difficulty})]})]})]})]},s)))]})}),t.jsx(th,{id:"economy",title:"Economia & Gold",children:t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"bg-slate-800/30 rounded-lg p-6",children:[t.jsx("h3",{className:"text-xl font-bold mb-4 text-amber-400",children:"Fórmula de Venda"}),t.jsxs("div",{className:"space-y-3",children:[t.jsxs("div",{className:"bg-slate-900/50 p-4 rounded",children:[t.jsx("div",{className:"font-semibold text-amber-400 mb-2",children:"Consumíveis"}),t.jsx("div",{className:"font-mono text-sm text-slate-300",children:"Preço × 40%"}),t.jsx("div",{className:"text-xs text-slate-400 mt-1",children:"Ex: Poção de 100 Gold = 40 Gold"})]}),t.jsxs("div",{className:"bg-slate-900/50 p-4 rounded",children:[t.jsx("div",{className:"font-semibold text-amber-400 mb-2",children:"Drops de Monstro"}),t.jsx("div",{className:"font-mono text-sm text-slate-300",children:"Valor Direto"}),t.jsx("div",{className:"text-xs text-slate-400 mt-1",children:"Ex: Drop com valor 50 = 50 Gold"})]}),t.jsxs("div",{className:"bg-slate-900/50 p-4 rounded",children:[t.jsx("div",{className:"font-semibold text-amber-400 mb-2",children:"Equipamentos"}),t.jsx("div",{className:"font-mono text-sm text-slate-300",children:"Raridade × 30-50%"}),t.jsx("div",{className:"text-xs text-slate-400 mt-1",children:"Ex: Common 100 = 30-50 Gold"})]})]})]}),t.jsxs("div",{className:"bg-slate-800/30 rounded-lg p-6",children:[t.jsx("h3",{className:"text-xl font-bold mb-4 text-amber-400",children:"Onde Gastar Gold"}),t.jsx("div",{className:"grid md:grid-cols-2 gap-4",children:[{item:"Consumíveis",price:"15-200 Gold",priority:"Alta"},{item:"Equipamentos",price:"80-5000 Gold",priority:"Média"},{item:"Spells",price:"Desbloqueados por Nível",priority:"Automática"}].map(((e,s)=>t.jsxs("div",{className:"bg-slate-900/50 p-4 rounded border border-slate-700",children:[t.jsx("div",{className:"font-semibold text-amber-400",children:e.item}),t.jsx("div",{className:"text-xs text-slate-400 mt-1",children:e.price}),t.jsxs("div",{className:"text-xs font-semibold mt-2 "+("Alta"===e.priority?"text-red-400":"Média"===e.priority?"text-yellow-400":"text-emerald-400"),children:["Prioridade: ",e.priority]})]},s)))})]}),t.jsxs("div",{className:"bg-gradient-to-r from-slate-800/50 to-slate-700/50 backdrop-blur border border-slate-600 rounded-lg p-6",children:[t.jsx("h3",{className:"text-lg font-bold mb-3 text-amber-400",children:"💡 Dica Econômica"}),t.jsx("p",{className:"text-slate-300 text-sm",children:"Mantenha um fundo de emergência de 500-1000 Gold para consumíveis críticos. Invista extra em equipamentos que aumentam seu nível de poder."})]})]})}),t.jsx(th,{id:"tips",title:"Dicas & Estratégia",children:t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"bg-slate-800/30 rounded-lg p-6",children:[t.jsx("h3",{className:"text-lg font-bold mb-4 text-amber-400",children:"Estratégias Gerais"}),t.jsx("div",{className:"space-y-4",children:[{title:"Conserve Consumíveis",tip:"Use apenas quando crítico. O gold de um consumível comprado é melhor gasto em equipamento."},{title:"Equilíbrio é Rei",tip:"Não ignore DEF por ATK puro. Um personagem com 50/50 é melhor que 80/20."},{title:"Conheça os Inimigos",tip:"Cada monstro tem padrões. Aprenda a evitá-los ou contra-atacá-los."},{title:"Planeje Múltiplos Personagens",tip:"Crie diferentes builds: Tank, DPS, Mago. Cada morte ensina para o próximo."},{title:"Checkpoint Estratégico",tip:"Use checkpoints em andares perigosos. Cada morte de um personagem ruim é progresso."},{title:"Eventos são Presentes",tip:"Fogueiras, baús e fontes são encontrados aleatoriamente. Reconheça-os."}].map(((e,s)=>t.jsxs("div",{className:"bg-slate-900/50 p-4 rounded border border-slate-700",children:[t.jsx("div",{className:"font-semibold text-amber-400 mb-1",children:e.title}),t.jsx("div",{className:"text-slate-300 text-sm",children:e.tip})]},s)))})]}),t.jsxs("div",{className:"bg-gradient-to-r from-slate-800/50 to-slate-700/50 backdrop-blur border border-slate-600 rounded-lg p-6",children:[t.jsx("h3",{className:"text-lg font-bold mb-3 text-amber-400",children:"🎯 Objetivo Filosófico"}),t.jsx("p",{className:"text-slate-300 text-sm leading-relaxed",children:"Tower Trials não é sobre vencer infinitamente. É sobre subir o máximo que pode, aprender do fracasso e tentar novamente com novo conhecimento. Cada morte é mentor. Cada vitória é conquista. A jornada transcende qualquer destino final."})]})]})})]}),t.jsx("footer",{className:"border-t border-slate-700 mt-12 py-8 px-4 bg-slate-900/50",children:t.jsxs("div",{className:"max-w-6xl mx-auto text-center text-slate-400 text-sm",children:[t.jsx("p",{children:"Guia Completo Tower Trials © 2025"}),t.jsx("p",{className:"mt-2",children:"Última atualização: 2025"})]})})]})}function th({id:e,title:s,children:a,expanded:r=!0,onToggle:n}){return t.jsxs("div",{id:e,className:"mb-12",children:[t.jsxs("button",{onClick:n,className:"w-full flex items-center justify-between mb-6 group",children:[t.jsx("h2",{className:"text-4xl font-black bg-gradient-to-r from-amber-400 to-orange-500 bg-clip-text text-transparent",children:s}),n&&t.jsx(le,{className:"w-6 h-6 text-amber-400 transition-transform "+(r?"rotate-180":"")})]}),!1!==r&&t.jsx(t.Fragment,{children:a})]})}function sh({title:e,description:s,formula:a,color:r}){return t.jsxs("div",{className:`border rounded-lg p-4 ${{red:"border-red-500/30 bg-red-500/5",blue:"border-blue-500/30 bg-blue-500/5",purple:"border-purple-500/30 bg-purple-500/5",emerald:"border-emerald-500/30 bg-emerald-500/5"}[r]}`,children:[t.jsx("div",{className:"font-semibold text-slate-200 mb-1",children:e}),t.jsx("div",{className:"text-slate-300 text-sm mb-2",children:s}),t.jsx("div",{className:"text-xs font-mono text-slate-400",children:a})]})}const ah=r("/_public/auth/verify-email")({component:function(){const{user:e}=Vs();return t.jsx("div",{className:"container mx-auto flex min-h-screen items-center justify-center px-4",children:t.jsxs(fu,{className:"w-full max-w-md",children:[t.jsx(gu,{children:t.jsxs("div",{className:"flex items-center space-x-4",children:[t.jsx($e,{className:"h-8 w-8 text-primary"}),t.jsxs("div",{children:[t.jsx(bu,{children:"Verifique seu Email"}),t.jsx(vu,{children:"Enviamos um link de confirmação para seu email"})]})]})}),t.jsxs(yu,{className:"space-y-6",children:[t.jsxs("div",{className:"rounded-lg bg-muted p-4 text-sm",children:[t.jsxs("p",{className:"mb-2",children:["Olá ",t.jsx("span",{className:"font-semibold",children:e?.email}),","]}),t.jsx("p",{className:"mb-2",children:"Para sua segurança, enviamos um email de confirmação para o endereço fornecido."}),t.jsx("p",{children:"Por favor, siga estas etapas:"}),t.jsxs("ol",{className:"ml-4 mt-2 list-decimal space-y-1",children:[t.jsx("li",{children:"Verifique sua caixa de entrada"}),t.jsx("li",{children:"Clique no link de confirmação no email"}),t.jsx("li",{children:"Retorne aqui para fazer login"})]})]}),t.jsx("div",{className:"space-y-4 text-sm text-muted-foreground",children:t.jsx("p",{children:"Não recebeu o email? Verifique sua pasta de spam ou aguarde alguns minutos."})}),t.jsx("div",{className:"flex flex-col space-y-2",children:t.jsx(o,{to:"/auth",search:{auth:"true"},children:t.jsxs(Ws,{variant:"outline",className:"w-full",children:[t.jsx(Me,{className:"mr-2 h-4 w-4"}),"Voltar para o Login"]})})})]})]})})},validateSearch:e=>({auth:e.auth||""})});class rh{static rankingCache=new Map;static userStatsCache=new Map;static userRankingCache=new Map;static CACHE_DURATION=12e4;static USER_CACHE_DURATION=3e5;static isCacheValid(e,t){if(!e)return!1;return Date.now()-e.timestamp<t}static generateCacheKey(e,t,s,a,r){return`${e}-${t}-${s}-${a}-${r}`}static async saveAliveCharacterToRanking(e){try{if(!e)return{data:"",error:"ID do personagem é obrigatório"};const{data:t,error:s}=await Es.rpc("save_alive_character_to_ranking",{p_character_id:e});if(s)throw s;return this.invalidateGlobalCaches(),{data:t,error:null}}catch(t){return{data:"",error:t instanceof Error?t.message:"Erro ao salvar no ranking"}}}static async saveCharacterSnapshotToRanking(e,t=!0){try{if(!e)return{data:"",error:"ID do personagem é obrigatório"};const{data:s,error:a}=await Es.rpc("save_character_snapshot_to_ranking",{p_character_id:e,p_is_alive:t});if(a)throw a;return this.invalidateGlobalCaches(),{data:s,error:null}}catch(s){return{data:"",error:s instanceof Error?s.message:"Erro ao salvar no ranking"}}}static async saveScore(e){try{const t=e;if(!t||!t.user_id||!t.player_name)return{data:"",error:"Dados do ranking são obrigatórios"};const{data:s,error:a}=await Es.rpc("save_ranking_entry",{p_user_id:t.user_id,p_player_name:t.player_name,p_highest_floor:t.floor,p_character_level:t.character_level||1,p_character_gold:t.character_gold||0,p_character_alive:t.character_alive??!0});if(a)throw a;return this.invalidateUserCaches(t.user_id),this.invalidateGlobalCaches(),{data:s,error:null}}catch(t){return{data:"",error:t instanceof Error?t.message:"Erro ao salvar no ranking"}}}static async getGlobalRanking(e="floor",t=10,s="all",a="",r=1){try{const n=this.generateCacheKey(e,t,s,a,r),i=this.rankingCache.get(n);if(this.isCacheValid(i,this.CACHE_DURATION))return{data:i.data,error:null};const o=(r-1)*t,l={floor:"get_dynamic_ranking_by_highest_floor",level:"get_dynamic_ranking_by_level",gold:"get_dynamic_ranking_by_gold"}[e],{data:c,error:d}=await Es.rpc(l,{p_limit:t,p_status_filter:s,p_name_filter:a,p_offset:o});if(d)throw d;const m=c||[];return this.rankingCache.set(n,{data:m,timestamp:Date.now(),params:n}),{data:m,error:null}}catch(n){return{data:[],error:n instanceof Error?n.message:"Erro ao buscar ranking"}}}static async countRankingEntries(e="all",t=""){try{const{data:s,error:a}=await Es.rpc("count_ranking_entries",{p_status_filter:e,p_name_filter:t});if(a)throw a;return{data:s||0,error:null}}catch(s){return{data:0,error:s instanceof Error?s.message:"Erro ao contar entradas"}}}static async getUserRanking(e,t=10){try{let s=e;if(!s){const e=await Ps.getCurrentUser();if(!e?.id)return{data:[],error:"Usuário não encontrado para buscar ranking"};s=e.id}const a=`user-${s}-${t}`,r=this.userRankingCache.get(a);if(this.isCacheValid(r,this.USER_CACHE_DURATION))return{data:r.data,error:null};const{data:n,error:i}=await Es.rpc("get_dynamic_user_ranking_history",{p_user_id:s,p_limit:t});if(i)throw i;const o=n||[];return this.userRankingCache.set(a,{data:o,timestamp:Date.now(),params:a}),{data:o,error:null}}catch(s){return{data:[],error:s instanceof Error?s.message:"Erro ao buscar ranking do usuário"}}}static async getUserStats(e){try{let t=e;if(!t){const e=await Ps.getCurrentUser();if(!e?.id)return{data:{bestFloor:0,bestLevel:1,bestGold:0,totalRuns:0,aliveCharacters:0},error:"Usuário não encontrado para buscar estatísticas"};t=e.id}if(!t)return{data:{bestFloor:0,bestLevel:1,bestGold:0,totalRuns:0,aliveCharacters:0},error:"ID do usuário é obrigatório"};const s=this.userStatsCache.get(t);if(this.isCacheValid(s,this.USER_CACHE_DURATION)){const e=s.data;return{data:{bestFloor:e.best_floor,bestLevel:e.best_level,bestGold:e.best_gold,totalRuns:e.total_runs,aliveCharacters:e.alive_characters},error:null}}const{data:a,error:r}=await Es.rpc("get_dynamic_user_stats",{p_user_id:t}).single();if(r)throw r;const n=a,i={bestFloor:n?.best_floor||0,bestLevel:n?.best_level||1,bestGold:n?.best_gold||0,totalRuns:n?.total_runs||0,aliveCharacters:n?.alive_characters||0};return n&&this.userStatsCache.set(t,{data:n,timestamp:Date.now(),params:t}),{data:i,error:null}}catch(t){return{data:{bestFloor:0,bestLevel:1,bestGold:0,totalRuns:0,aliveCharacters:0},error:t instanceof Error?t.message:"Erro ao buscar estatísticas"}}}static async testRankingSystem(e){try{const{data:t,error:s}=await Es.rpc("test_ranking_system",{p_user_id:e||null});if(s)throw s;return{data:t||[],error:null}}catch(t){return{data:[],error:t instanceof Error?t.message:"Erro ao testar ranking"}}}static async syncAllRankings(){try{const{data:e,error:t}=await Es.rpc("refresh_all_rankings");if(t)throw t;return this.clearAllCaches(),{data:e||"Sincronização concluída",error:null}}catch(e){return{data:"",error:e instanceof Error?e.message:"Erro ao sincronizar rankings"}}}static invalidateUserCaches(e){this.userStatsCache.delete(e);for(const[t]of this.userRankingCache)t.startsWith(`user-${e}-`)&&this.userRankingCache.delete(t)}static invalidateGlobalCaches(){this.rankingCache.clear()}static clearAllCaches(){this.rankingCache.clear(),this.userStatsCache.clear(),this.userRankingCache.clear()}static async getPlayerRankingPosition(e,t,s="floor"){if(!e||!t)return 0;try{const a=await this.getGlobalRanking(s,100);if(a.error||!a.data)return 0;const r=a.data.findIndex((s=>s.user_id===e&&s.player_name===t));return r>=0?r+1:0}catch(a){return 0}}}const nh=Object.freeze(Object.defineProperty({__proto__:null,RankingService:rh},Symbol.toStringTag,{value:"Module"})),ih={ADMIN:"Administrador",PLAYER:"Jogador"},oh=r("/_authenticated/users/$id")({component:function(){const{id:s}=oh.useParams(),[a,r]=e.useState(null),[n,i]=e.useState([]),[o,l]=e.useState(!0),[c,d]=e.useState(null);if(e.useEffect((()=>{(async()=>{try{l(!0),d(null);const{data:e,error:t}=await su.searchUsers({page:1,limit:1,email:s});if(t)return void d(`Erro ao buscar usuário: ${t}`);if(!e||0===e.length)return void d("Usuário não encontrado");const a=e[0];r(a);const{data:n}=await rh.getUserRanking(a.uid);i(n||[])}catch(e){d("Erro ao carregar dados do usuário")}finally{l(!1)}})()}),[s]),o)return t.jsx("div",{children:"Carregando..."});if(c)return t.jsx("div",{className:"text-red-500",children:c});if(!a)return t.jsx("div",{children:"Usuário não encontrado"});return t.jsx(Nu,{children:t.jsxs("div",{className:"container mx-auto py-8",children:[t.jsxs(fu,{className:"mb-8",children:[t.jsx(gu,{children:t.jsx(bu,{children:"Detalhes do Usuário"})}),t.jsx(yu,{children:t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsxs("div",{children:[t.jsx("p",{className:"text-sm font-medium",children:"Nome"}),t.jsx("p",{className:"text-lg",children:a.nome})]}),t.jsxs("div",{children:[t.jsx("p",{className:"text-sm font-medium",children:"Email"}),t.jsx("p",{className:"text-lg",children:a.email})]}),t.jsxs("div",{children:[t.jsx("p",{className:"text-sm font-medium",children:"Tipo"}),t.jsx(_u,{className:"ADMIN"===a.role?"bg-red-500":"bg-blue-500",children:ih[a.role]})]}),t.jsxs("div",{children:[t.jsx("p",{className:"text-sm font-medium",children:"Status"}),t.jsx(_u,{variant:a.ativo?"default":"destructive",children:a.ativo?"Ativo":"Inativo"})]}),t.jsxs("div",{children:[t.jsx("p",{className:"text-sm font-medium",children:"Maior Andar Alcançado"}),t.jsx("p",{className:"text-lg",children:a.highest_floor})]}),t.jsxs("div",{children:[t.jsx("p",{className:"text-sm font-medium",children:"Total de Jogos"}),t.jsx("p",{className:"text-lg",children:a.total_games})]}),t.jsxs("div",{children:[t.jsx("p",{className:"text-sm font-medium",children:"Vitórias"}),t.jsx("p",{className:"text-lg",children:a.total_victories})]})]})})]}),t.jsxs(fu,{children:[t.jsx(gu,{children:t.jsx(bu,{children:"Histórico de Rankings"})}),t.jsx(yu,{children:t.jsx("div",{className:"rounded-md border",children:t.jsxs(au,{children:[t.jsx(ru,{children:t.jsxs(iu,{children:[t.jsx(ou,{children:"Andar Alcançado"}),t.jsx(ou,{children:"Data"})]})}),t.jsx(nu,{children:0===n.length?t.jsx(iu,{children:t.jsx(lu,{colSpan:2,className:"text-center",children:"Nenhum ranking encontrado"})}):n.map((e=>t.jsxs(iu,{children:[t.jsx(lu,{children:e.highest_floor}),t.jsx(lu,{children:e.created_at?new Date(e.created_at).toLocaleDateString("pt-BR"):"-"})]},e.id)))})]})})})]})]})})}});const lh=({activeMode:e,onModeChange:s,statusFilter:a,onStatusFilterChange:r,nameFilter:n,onNameFilterChange:i,currentPage:o,totalPages:l,onPageChange:c,isLoading:d=!1})=>{const m=[{key:"floor",label:"Andar Mais Alto",icon:ee,color:"text-yellow-500"},{key:"level",label:"Maior Nível",icon:Ie,color:"text-blue-500"},{key:"gold",label:"Mais Rico",icon:Fe,color:"text-amber-500"}],u=[{key:"all",label:"Todos",shortLabel:"Todos",icon:Ve,color:"text-gray-500"},{key:"alive",label:"Apenas Vivos",shortLabel:"Vivos",icon:ae,color:"text-green-500"},{key:"dead",label:"Apenas Mortos",shortLabel:"Mortos",icon:Re,color:"text-red-500"}];return t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{children:[t.jsx("h3",{className:"text-sm font-medium mb-2 text-muted-foreground",children:"Modalidade"}),t.jsx("div",{className:"flex flex-wrap gap-2",children:m.map((a=>{const r=a.icon,n=e===a.key;return t.jsxs(Ws,{variant:n?"default":"outline",size:"sm",onClick:()=>s(a.key),disabled:d,className:"flex items-center gap-2 text-xs "+(n?"":"hover:bg-muted"),children:[t.jsx(r,{className:"h-3 w-3 "+(n?"text-white":"text-muted-foreground")}),t.jsx("span",{className:"hidden sm:inline",children:a.label}),t.jsx("span",{className:"sm:hidden",children:"floor"===a.key?"Andar":"level"===a.key?"Nível":"Ouro"})]},a.key)}))})]}),t.jsxs("div",{children:[t.jsx("h3",{className:"text-sm font-medium mb-2 text-muted-foreground",children:"Status"}),t.jsx("div",{className:"flex flex-wrap gap-2",children:u.map((e=>{const s=e.icon,n=a===e.key;return t.jsxs(Ws,{variant:n?"default":"outline",size:"sm",onClick:()=>r(e.key),disabled:d,className:"flex items-center gap-2 text-xs "+(n?"":"hover:bg-muted"),children:[t.jsx(s,{className:"h-3 w-3 "+(n?"text-white":"text-muted-foreground")}),t.jsx("span",{className:"hidden sm:inline",children:e.label}),t.jsx("span",{className:"sm:hidden",children:e.shortLabel})]},e.key)}))})]}),t.jsxs("div",{children:[t.jsx("h3",{className:"text-sm font-medium mb-2 text-muted-foreground",children:"Buscar Jogador"}),t.jsxs("div",{className:"relative",children:[t.jsx(Oe,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),t.jsx(qa,{type:"text",placeholder:"Digite o nome do jogador...",value:n,onChange:e=>i(e.target.value),disabled:d,className:"pl-10 text-sm"})]})]}),l>1&&t.jsxs("div",{children:[t.jsx("h3",{className:"text-sm font-medium mb-2 text-muted-foreground",children:"Páginas"}),t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs(Ws,{variant:"outline",size:"sm",onClick:()=>c(o-1),disabled:o<=1||d,className:"flex items-center gap-2",children:[t.jsx(Be,{className:"h-4 w-4"}),t.jsx("span",{className:"hidden sm:inline",children:"Anterior"})]}),t.jsx("div",{className:"flex items-center gap-2",children:t.jsxs("span",{className:"text-sm text-muted-foreground",children:["Página ",o," de ",l]})}),t.jsxs(Ws,{variant:"outline",size:"sm",onClick:()=>c(o+1),disabled:o>=l||d,className:"flex items-center gap-2",children:[t.jsx("span",{className:"hidden sm:inline",children:"Próxima"}),t.jsx(Ue,{className:"h-4 w-4"})]})]})]})]})},ch=e=>e>=1e6?(e/1e6).toFixed(1)+"M":e>=1e3?(e/1e3).toFixed(1)+"K":e.toString(),dh=({entries:e,mode:s,currentUserId:a})=>{const r=e=>{switch(e){case 0:return"text-yellow-500";case 1:return"text-gray-400";case 2:return"text-amber-700";default:return"text-gray-300"}},n=(e,t)=>{switch(t){case"floor":default:return`Andar ${e.highest_floor}`;case"level":return`Nível ${e.character_level}`;case"gold":return`${ch(e.character_gold)} Gold`}},i=(e,t)=>{switch(t){case"floor":return`Nível ${e.character_level} • ${ch(e.character_gold)} Gold`;case"level":return`Andar ${e.highest_floor} • ${ch(e.character_gold)} Gold`;case"gold":return`Andar ${e.highest_floor} • Nível ${e.character_level}`;default:return`Nível ${e.character_level}`}},o=(e=>{switch(e){case"floor":default:return ee;case"level":return Ie;case"gold":return Fe}})(s);return 0===e.length?t.jsxs("div",{className:"text-center py-8",children:[t.jsx(o,{className:"h-12 w-12 text-muted-foreground mx-auto mb-4"}),t.jsx("p",{className:"text-muted-foreground",children:"Nenhum registro encontrado para esta modalidade."})]}):t.jsxs(au,{children:[t.jsx(ru,{children:t.jsxs(iu,{children:[t.jsx(ou,{className:"w-12 text-center",children:"Pos."}),t.jsx(ou,{children:"Jogador"}),t.jsx(ou,{className:"text-right",children:"Valor Principal"}),t.jsx(ou,{className:"text-right hidden sm:table-cell",children:"Detalhes"}),t.jsx(ou,{className:"text-right",children:"Data"})]})}),t.jsx(nu,{children:e.map(((e,o)=>t.jsxs(iu,{className:e.user_id===a?"bg-primary/5":"",children:[t.jsx(lu,{className:"text-center font-medium",children:o<3?t.jsx(ee,{className:`inline h-4 w-4 ${r(o)}`}):t.jsx("span",{className:"text-muted-foreground",children:o+1})}),t.jsx(lu,{children:t.jsx("div",{className:"flex items-center gap-2",children:t.jsxs("div",{className:"flex flex-col",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("span",{className:"font-medium",children:e.player_name}),e.character_alive?t.jsx(ae,{className:"h-3 w-3 text-green-500"}):t.jsx(Re,{className:"h-3 w-3 text-red-500"}),e.user_id===a&&t.jsx("span",{className:"text-xs bg-primary/20 text-primary px-1.5 py-0.5 rounded",children:"Você"})]}),t.jsx("div",{className:"text-xs text-muted-foreground sm:hidden",children:i(e,s)})]})})}),t.jsx(lu,{className:"text-right font-medium",children:n(e,s)}),t.jsx(lu,{className:"text-right text-muted-foreground hidden sm:table-cell",children:i(e,s)}),t.jsx(lu,{className:"text-right text-muted-foreground",children:e.created_at?new Date(e.created_at).toLocaleDateString("pt-BR",{day:"2-digit",month:"2-digit",year:"2-digit",hour:"2-digit",minute:"2-digit"}):"-"})]},e.id)))})]})},mh=({stats:s,userRanking:a})=>{const[r,n]=e.useState(!0),[i,o]=e.useState(!1),l=a[0];return t.jsxs("div",{className:"space-y-4",children:[t.jsxs(fu,{children:[t.jsx(gu,{className:"pb-3",children:t.jsxs(Ws,{variant:"ghost",className:"w-full justify-between p-0 h-auto hover:bg-transparent",onClick:()=>n(!r),children:[t.jsx(bu,{className:"text-lg font-medium",children:"Suas Conquistas"}),r?t.jsx(de,{className:"h-4 w-4 text-muted-foreground"}):t.jsx(le,{className:"h-4 w-4 text-muted-foreground"})]})}),r&&t.jsx(yu,{className:"pt-0",children:t.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-3",children:[t.jsxs("div",{className:"text-center p-4 bg-muted/30 rounded-lg border",children:[t.jsx(ee,{className:"h-5 w-5 text-muted-foreground mx-auto mb-2"}),t.jsx("div",{className:"text-2xl font-bold mb-1",children:s.bestFloor}),t.jsx("div",{className:"text-xs text-muted-foreground",children:"Melhor Andar"})]}),t.jsxs("div",{className:"text-center p-4 bg-muted/30 rounded-lg border",children:[t.jsx(Ie,{className:"h-5 w-5 text-muted-foreground mx-auto mb-2"}),t.jsx("div",{className:"text-2xl font-bold mb-1",children:s.bestLevel}),t.jsx("div",{className:"text-xs text-muted-foreground",children:"Maior Nível"})]}),t.jsxs("div",{className:"text-center p-4 bg-muted/30 rounded-lg border",children:[t.jsx(Fe,{className:"h-5 w-5 text-muted-foreground mx-auto mb-2"}),t.jsx("div",{className:"text-xl font-bold mb-1",title:`${s.bestGold.toLocaleString("pt-BR")} Gold`,children:ch(s.bestGold)}),t.jsx("div",{className:"text-xs text-muted-foreground",children:"Mais Rico"})]})]})})]}),l&&t.jsxs(fu,{children:[t.jsx(gu,{className:"pb-3",children:t.jsxs(Ws,{variant:"ghost",className:"w-full justify-between p-0 h-auto hover:bg-transparent",onClick:()=>o(!i),children:[t.jsxs(bu,{className:"text-lg font-medium flex items-center gap-2",children:[t.jsx(ze,{className:"h-4 w-4"}),"Última Tentativa"]}),i?t.jsx(de,{className:"h-4 w-4 text-muted-foreground"}):t.jsx(le,{className:"h-4 w-4 text-muted-foreground"})]})}),i&&t.jsx(yu,{className:"pt-0",children:t.jsxs("div",{className:"flex items-center justify-between p-3 bg-muted/30 rounded-lg",children:[t.jsxs("div",{className:"flex items-center gap-3",children:[l.character_alive?t.jsx("span",{className:"text-sm",children:"❤️"}):t.jsx("span",{className:"text-sm",children:"💀"}),t.jsxs("div",{children:[t.jsx("div",{className:"font-medium text-sm",children:l.character_alive?"Vivo":"Morto"}),t.jsx("div",{className:"text-xs text-muted-foreground",children:new Date(l.created_at).toLocaleDateString("pt-BR")})]})]}),t.jsxs("div",{className:"text-right",children:[t.jsxs("div",{className:"font-bold",children:["Andar ",l.highest_floor]}),t.jsxs("div",{className:"text-xs text-muted-foreground",children:["Nível ",l.character_level]})]})]})})]}),t.jsx(fu,{children:t.jsx(yu,{className:"p-4",children:t.jsxs("div",{className:"flex justify-between items-center text-sm",children:[t.jsx("span",{className:"text-muted-foreground",children:"Total de Tentativas:"}),t.jsx("span",{className:"font-medium",children:s.totalRuns})]})})})]})},uh=r("/_authenticated/game/ranking")({component:function(){const s=n(),{user:a}=Vs(),[r,i]=e.useState([]),[o,l]=e.useState([]),[c,d]=e.useState({bestFloor:0,bestLevel:1,bestGold:0,totalRuns:0,aliveCharacters:0}),[m,u]=e.useState(!0),[h,p]=e.useState("floor"),[x,f]=e.useState("all"),[g,b]=e.useState(""),[v,y]=e.useState(1),[j,N]=e.useState(1),[w,_]=e.useState("");e.useEffect((()=>{const e=setTimeout((()=>{_(g)}),500);return()=>clearTimeout(e)}),[g]),e.useEffect((()=>{y(1)}),[h,x,w]),e.useEffect((()=>{S()}),[a?.id,h,x,w,v]);const C=e.useCallback((async()=>{try{const e=await rh.countRankingEntries(x,w);if(null!==e.data){const t=e.data,s=Math.max(1,Math.ceil(t/20));N(s)}}catch(e){N(1)}}),[x,w]),S=async()=>{try{u(!0),await C();const e=await rh.getGlobalRanking(h,20,x,w,v);if(e.error?i([]):(i(e.data||[]),e.data&&e.data.length),a?.id){const[e,t]=await Promise.all([rh.getUserRanking(a.id,15),rh.getUserStats(a.id)]);e.error?l([]):l(e.data||[]),t.error?d({bestFloor:0,bestLevel:1,bestGold:0,totalRuns:0,aliveCharacters:0}):d(t.data||{bestFloor:0,bestLevel:1,bestGold:0,totalRuns:0,aliveCharacters:0})}}catch(e){i([]),l([]),d({bestFloor:0,bestLevel:1,bestGold:0,totalRuns:0,aliveCharacters:0})}finally{u(!1)}},E=e=>{y(e)};return t.jsxs("div",{className:"container mx-auto p-2 md:p-4 max-w-7xl",children:[t.jsxs("div",{className:"flex items-center justify-between mb-4 md:mb-6",children:[t.jsxs("div",{className:"flex items-center gap-4",children:[t.jsxs(Ws,{variant:"ghost",size:"sm",onClick:()=>s({to:"/game"}),children:[t.jsx(Me,{className:"h-4 w-4 mr-2"}),"Voltar"]}),t.jsxs("div",{children:[t.jsx("h1",{className:"text-2xl font-bold",children:(e=>{switch(e){case"floor":return"Ranking por Andar Mais Alto";case"level":return"Ranking por Nível Mais Alto";case"gold":return"Ranking por Mais Ouro";default:return"Ranking"}})(h)}),t.jsxs("p",{className:"text-muted-foreground",children:["Veja os melhores jogadores",(()=>{const e=[];return"all"!==x&&e.push("alive"===x?"vivos":"mortos"),w&&e.push(`nome: "${w}"`),e.length>0?` (${e.join(", ")})`:""})()]})]})]}),t.jsx("div",{className:"flex gap-2",children:t.jsx(Ws,{variant:"outline",size:"sm",onClick:async()=>{await S()},disabled:m,children:"Atualizar"})})]}),t.jsx(fu,{className:"mb-4 md:mb-6",children:t.jsx(gu,{children:t.jsx(lh,{activeMode:h,onModeChange:p,statusFilter:x,onStatusFilterChange:f,nameFilter:g,onNameFilterChange:b,currentPage:v,totalPages:j,onPageChange:E,isLoading:m})})}),t.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-4 gap-4 md:gap-6",children:[a&&t.jsx("div",{className:"lg:col-span-1",children:t.jsx(mh,{stats:c,userRanking:o.map((e=>({highest_floor:e.highest_floor,character_level:e.character_level,character_gold:e.character_gold,character_alive:e.character_alive,created_at:e.created_at})))})}),t.jsx("div",{className:a?"lg:col-span-3":"lg:col-span-4",children:t.jsxs(fu,{children:[t.jsx(yu,{className:"p-0",children:t.jsx(dh,{entries:r,mode:h,currentUserId:a?.id})}),j>1&&t.jsxs(ju,{className:"flex justify-center gap-2",children:[t.jsx(Ws,{variant:"outline",size:"sm",onClick:()=>E(v-1),disabled:v<=1||m,children:"Anterior"}),t.jsxs("span",{className:"flex items-center px-4 text-sm text-muted-foreground",children:["Página ",v," de ",j]}),t.jsx(Ws,{variant:"outline",size:"sm",onClick:()=>E(v+1),disabled:v>=j||m,children:"Próxima"})]})]})})]})]})}});var hh=(e=>(e.SWORD_MASTERY="sword",e.AXE_MASTERY="axe",e.BLUNT_MASTERY="blunt",e.DEFENSE_MASTERY="defense",e.MAGIC_MASTERY="magic",e))(hh||{});function ph(e){return{sword:"Maestria com espadas. Aumenta ataque (+1), chance crítica (+0.2%) e dano crítico (+3%) por nível.",axe:"Maestria com machados. Aumenta ataque (+1), chance crítica (+0.2%) e dano crítico (+3%) por nível.",blunt:"Maestria com armas de concussão. Aumenta ataque (+1), chance crítica (+0.2%) e dano crítico (+3%) por nível.",defense:"Maestria defensiva. Aumenta defesa (+2) por nível e reduz dano recebido.",magic:"Maestria mágica. Aumenta mana (+3), dano mágico (+15%) e cura (+10%) por nível."}[e]}function xh(e){return{buff:"🛡️",debuff:"💀",dot:"🔥",hot:"✨",damage:"⚔️",heal:"❤️"}[e]||"🔮"}function fh(e){return{buff:"text-blue-400 bg-blue-500/20 border-blue-500/30",debuff:"text-red-400 bg-red-500/20 border-red-500/30",dot:"text-orange-400 bg-orange-500/20 border-orange-500/30",hot:"text-green-400 bg-green-500/20 border-green-500/30",damage:"text-purple-400 bg-purple-500/20 border-purple-500/30",heal:"text-emerald-400 bg-emerald-500/20 border-emerald-500/30"}[e]||"text-gray-400 bg-gray-500/20 border-gray-500/30"}class gh{static async updateCharacterHpMana(e,t,s){try{if(!e)return{success:!1,error:"ID do personagem é obrigatório",data:null};const a=void 0!==t?Math.floor(Number(t)):void 0,r=void 0!==s?Math.floor(Number(s)):void 0;if(void 0!==a&&(a<0||a>9999))return{success:!1,error:"Valor de HP inválido",data:null};if(void 0!==r&&(r<0||r>9999))return{success:!1,error:"Valor de Mana inválido",data:null};const{error:n}=await Es.rpc("update_character_stats",{p_character_id:e,p_hp:a,p_mana:r});return n?{success:!1,error:`Erro ao atualizar stats: ${n.message}`,data:null}:{success:!0,error:null,data:null}}catch(a){return{success:!1,error:a instanceof Error?a.message:"Erro desconhecido ao atualizar HP/Mana",data:null}}}static calculateAutoHeal(e,t,s=!1){if(s)return{hp:e.max_hp,mana:e.max_mana};if(!e.last_activity)return{hp:e.hp,mana:e.mana};if(e.hp>=e.max_hp&&e.mana>=e.max_mana)return{hp:e.hp,mana:e.mana};const a=new Date(e.last_activity),r=t.getTime()-a.getTime(),n=Math.floor(r/1e3);if(n<1)return{hp:e.hp,mana:e.mana};const i=100;let o=e.hp;if(e.hp<e.max_hp){const t=Math.max(e.hp,Math.ceil(.001*e.max_hp)),s=t/e.max_hp*100,a=.013875,r=Math.min(a*n,i-s),l=Math.floor(r/100*e.max_hp);o=Math.min(e.max_hp,t+l)}let l=e.mana;if(e.mana<e.max_mana){const t=Math.max(e.mana,Math.ceil(.001*e.max_mana)),s=t/e.max_mana*100,a=.013875,r=Math.min(a*n,i-s),o=Math.floor(r/100*e.max_mana);l=Math.min(e.max_mana,t+o)}return{hp:o,mana:l}}static async applyAutoHeal(e,t=!1){try{const s=new Date,{hp:a,mana:r}=gh.calculateAutoHeal(e,s,t);if(a===e.hp&&r===e.mana)return{data:{healed:!1,oldHp:e.hp,newHp:e.hp,character:e},error:null,success:!0};const n=await gh.updateCharacterHpMana(e.id,a,r);if(!n.success)throw new Error(n.error||"Erro ao atualizar HP/Mana");await gh.updateLastActivity(e.id);const i={...e,hp:a,mana:r,last_activity:s.toISOString()};return{data:{healed:!0,oldHp:e.hp,newHp:a,character:i},error:null,success:!0}}catch(s){return{data:null,error:s instanceof Error?s.message:"Erro ao aplicar cura automática",success:!1}}}static async forceFullHealForHub(e){const{data:t,error:s}=await Es.from("characters").select("*").eq("id",e).single();return s||!t?{data:null,error:s?.message||"Personagem não encontrado",success:!1}:await this.applyAutoHeal(t,!0)}static async updateLastActivity(e){try{const{error:t}=await Es.rpc("update_character_last_activity",{p_character_id:e});if(t)throw t;return{data:null,error:null,success:!0}}catch(t){return{data:null,error:t instanceof Error?t.message:"Erro ao atualizar última atividade",success:!1}}}}class bh{static async updateCharacterFloor(e,t){try{const{error:s}=await Es.rpc("update_character_floor",{p_character_id:e,p_floor:t});if(s)throw s;return{data:null,error:null,success:!0}}catch(s){return{data:null,error:s instanceof Error?s.message:"Erro desconhecido",success:!1}}}static isValidCheckpointFloor(e){return 1===e||5===e||e>=20&&e%10==0}static async getUnlockedCheckpoints(e){try{const{data:t,error:s}=await Es.from("characters").select("*").eq("id",e).single();if(s)throw s;if(!t)return{data:null,error:"Personagem não encontrado",success:!1};const a=Math.max(t.floor,("highest_floor"in t?t.highest_floor:t.floor)||t.floor),r=[];r.push({floor:1,description:"Andar 1 - Início da Torre"}),a>=5&&r.push({floor:5,description:"Andar 5 - Primeiro Desafio"});for(let e=20;e<=a;e+=10)r.push({floor:e,description:`Andar ${e} - Checkpoint Pós-Boss`});return{data:r,error:null,success:!0}}catch(t){return{data:null,error:t instanceof Error?t.message:"Erro ao obter checkpoints",success:!1}}}static async startFromCheckpoint(e,t){try{if(!bh.isValidCheckpointFloor(t))return{data:null,error:"Checkpoint inválido",success:!1};const s=await this.getUnlockedCheckpoints(e);if(!s.success||!s.data)return{data:null,error:"Erro ao verificar checkpoints",success:!1};if(!s.data.some((e=>e.floor===t)))return{data:null,error:"Checkpoint não desbloqueado",success:!1};const a=await this.updateCharacterFloor(e,t);if(!a.success)return a;const{data:r,error:n}=await Es.from("characters").select("max_hp, max_mana").eq("id",e).single();if(n)throw n;return await gh.updateCharacterHpMana(e,r.max_hp,r.max_mana),{data:null,error:null,success:!0}}catch(s){return{data:null,error:s instanceof Error?s.message:"Erro ao iniciar do checkpoint",success:!1}}}static async resetCharacterProgress(e){try{const t=await this.updateCharacterFloor(e,1);if(!t.success)return t;const{data:s,error:a}=await Es.from("characters").select("max_hp, max_mana").eq("id",e).single();if(a)throw a;return await gh.updateCharacterHpMana(e,s.max_hp,s.max_mana),{data:null,error:null,success:!0}}catch(t){return{data:null,error:t instanceof Error?t.message:"Erro ao resetar progresso",success:!1}}}}class vh{static async getUserCharacterProgression(e){try{const{data:t,error:s}=await Es.rpc("get_user_character_progression",{p_user_id:e}).single();if(s)throw s;return{data:t,error:null,success:!0}}catch(t){return{data:null,error:t instanceof Error?t.message:"Erro ao buscar progressão",success:!1}}}static async checkCharacterLimit(e){try{const{data:t,error:s}=await Es.rpc("check_character_limit",{p_user_id:e}).single();if(s)throw s;return{data:t,error:null,success:!0}}catch(t){return{data:null,error:t instanceof Error?t.message:"Erro ao verificar limite",success:!1}}}static async grantSecureXP(e,t,s="combat"){try{"combat"===s||(s.charAt(0).toUpperCase(),s.slice(1));const{data:a,error:r}=await Es.rpc("update_character_stats",{p_character_id:e,p_xp:t}).single();if(r){if(r.message?.includes("suspeita detectada")||"P0001"===r.code){}throw r}const n=a;n.leveled_up?n.new_level:n.new_level,n.slots_unlocked&&n.new_available_slots;return{data:n,error:null,success:!0}}catch(a){const e=a instanceof Error?a.message:"Erro ao conceder XP";return e.includes("suspeita detectada")||e.includes("P0001"),{data:null,error:e,success:!1}}}static async grantSecureGold(e,t){try{const{error:s}=await Es.rpc("update_character_stats",{p_character_id:e,p_gold:t}).single();if(s)throw s;return{data:t,error:null,success:!0}}catch(s){return{data:null,error:s instanceof Error?s.message:"Erro ao conceder gold",success:!1}}}static async addSkillXp(e,t,s){try{const{data:a,error:r}=await Es.rpc("add_skill_xp",{p_character_id:e,p_skill_type:t,p_xp_amount:s}).single();if(r)throw r;return{data:a,error:null,success:!0}}catch(a){return{data:null,error:a instanceof Error?a.message:"Erro ao adicionar XP",success:!1}}}static async updateGold(e,t){try{const{error:s}=await Es.from("characters").update({gold:t}).eq("id",e);if(s)throw s;return{data:null,error:null,success:!0}}catch(s){return{data:null,error:s instanceof Error?s.message:"Erro ao atualizar gold",success:!1}}}static async reloadUserProgression(e){try{const{data:t,error:s}=await Es.rpc("get_user_character_progression",{p_user_id:e}).single();if(s)throw s;return{data:t,error:null,success:!0}}catch(t){return{data:null,error:t instanceof Error?t.message:"Erro ao recarregar progressão",success:!1}}}}class yh{static async calculateDerivedStats(e){const{level:t,strength:s=10,dexterity:a=10,intelligence:r=10,wisdom:n=10,vitality:i=10,luck:o=10,sword_mastery:l=1,axe_mastery:c=1,blunt_mastery:d=1,defense_mastery:m=1,magic_mastery:u=1}=e,h=50+2*t,p=20+1*t,x=2+t,f=1+t,g=3+t,b=Math.pow(s,1.1),v=Math.pow(a,1.1),y=Math.pow(r,1.1),j=Math.pow(n,1.05),N=Math.pow(i,1.2),w=o,_=Math.pow(Math.max(l,c,d),1.05),C=Math.pow(m,1.1),S=Math.pow(u,1.05),E=h+Math.floor(1.5*N)+Math.floor(.2*b),k=p+Math.floor(1*y)+Math.floor(.8*j)+Math.floor(.5*S),A=.15*v,P=.25*w,M=.05*b,T=.1*_,q=.3*b,D=.2*w,R=.4*_;let L=2+.8*y+.4*j+1*S;L>50&&(L=50+.5*(L-50));const $=.05*v,I=.1*w;return{hp:E,max_hp:E,mana:k,max_mana:k,atk:x+Math.floor(.8*b)+Math.floor(.4*_)+Math.floor(.1*v),magic_attack:x+Math.floor(.8*y)+Math.floor(.4*j)+Math.floor(.6*S),def:f+Math.floor(.4*N)+Math.floor(.3*j)+Math.floor(.8*C),speed:g+Math.floor(.8*v)+Math.floor(.1*w),critical_chance:Math.min(60,1+A+P+M+T),critical_damage:Math.min(200,102+q+D+R),magic_damage_bonus:Math.min(150,L),double_attack_chance:Math.min(25,$+I)}}static analyzeBuildDiversity(e){const{strength:t=10,dexterity:s=10,intelligence:a=10,wisdom:r=10,vitality:n=10,luck:i=10}=e,o=[t,s,a,r,n,i],l=o.reduce(((e,t)=>e+t),0),c=Math.max(...o),d=c/l,m=l/6,u=o.reduce(((e,t)=>e+Math.pow(t-m,2)),0)/6,h=Math.sqrt(u),p=Math.max(0,1-h/(l/6));let x="Balanced";if(d>.3){x=["Strength","Dexterity","Intelligence","Wisdom","Vitality","Luck"][o.indexOf(c)]}return{diversity:p,dominantAttribute:x,monoBuild:d>.8}}static calculateEffectiveStats(e){const t=("atk"in e?e.atk:e.attack)||0,s=("def"in e?e.def:e.defense)||0,a=e.speed||0,r=("magic_attack"in e?e.magic_attack:0)||0,n=e.critical_chance||0,i=e.critical_damage||110;if(!e.active_effects?.attribute_modifications?.length)return{atk:t,def:s,speed:a,magic_attack:r,critical_chance:n,critical_damage:i};let o=t,l=s,c=a,d=r,m=n,u=i;for(const h of e.active_effects.attribute_modifications){if(h.duration<=0)continue;const e=h.value,t="percentage"===h.type;switch(h.attribute){case"atk":t?o=Math.floor(o*(1+e/100)):o+=e;break;case"def":t?l=Math.floor(l*(1+e/100)):l+=e;break;case"speed":t?c=Math.floor(c*(1+e/100)):c+=e;break;case"magic_attack":t?d=Math.floor(d*(1+e/100)):d+=e;break;case"critical_chance":t?m*=1+e/100:m+=e;break;case"critical_damage":t?u*=1+e/100:u+=e}}return{atk:Math.max(1,Math.floor(o)),def:Math.max(0,Math.floor(l)),speed:Math.max(1,Math.floor(c)),magic_attack:Math.max(0,Math.floor(d)),critical_chance:Math.max(0,m),critical_damage:Math.max(100,u)}}static getActiveModifiers(e,t){return e.active_effects?.attribute_modifications?.length?e.active_effects.attribute_modifications.filter((e=>e.attribute===t&&e.duration>0)):[]}static hasActiveModifiers(e,t){return this.getActiveModifiers(e,t).length>0}static getTotalModifierValue(e,t){const s=this.getActiveModifiers(e,t);if(!s.length)return 0;let a=0;for(const r of s)r.type,a+=r.value;return a}}class jh{static async distributeAttributePoints(e,t){try{const{data:s,error:a}=await Es.rpc("distribute_attribute_points",{p_character_id:e,p_strength:t.strength,p_dexterity:t.dexterity,p_intelligence:t.intelligence,p_wisdom:t.wisdom,p_vitality:t.vitality,p_luck:t.luck}).single();if(a)throw a;return{data:s,error:null,success:!0}}catch(s){return{data:null,error:s instanceof Error?s.message:"Erro ao distribuir pontos",success:!1}}}static async recalculateCharacterStats(e){try{const{error:t}=await Es.rpc("recalculate_character_stats",{p_character_id:e});if(t)throw t;return{data:null,error:null,success:!0}}catch(t){return{data:null,error:t instanceof Error?t.message:"Erro ao recalcular stats",success:!1}}}}class Nh{static BLACKLIST_WORDS=["porra","merda","caralho","puta","putaria","viado","bicha","cu","buceta","piroca","pinto","rola","foda","foder","fodido","cuzao","cuzão","babaca","otario","otário","idiota","imbecil","retardado","mongoloide","burro","desgraça","desgraçado","filho da puta","fdp","vagabundo","safado","cachorro","cadela","prostituta","vagabunda","piranha","galinha","fuck","shit","bitch","damn","hell","ass","asshole","bastard","crap","piss","dick","cock","pussy","cunt","whore","slut","fag","faggot","nigger","retard","moron","idiot","stupid","gay","lesbian","homo","nazi","hitler","rape","kill","murder","mierda","joder","puta","puto","cabron","cabrón","pendejo","idiota","estupido","estúpido","culo","coño","verga","chingar","pinche","mamada","putada","hijo de puta","hdp","marica","maricon","maricón","droga","cocaina","heroina","crack","cocaine","heroin","drug","dealer","traficante","sexo","sex","porn","porno","nude","naked","xxx","fetish","admin","moderador","mod","gm","gamemaster","suporte","support","oficial","staff","dev","developer","bot","sistema","system"];static RESERVED_WORDS=["admin","administrator","moderador","moderator","mod","gm","gamemaster","suporte","support","help","ajuda","oficial","official","staff","dev","developer","sistema","system","bot","null","undefined","test","teste","demo","sample","example","exemplo","guest","visitante","player","jogador","user","usuario","usuário","npc","monster","monstro"];static INVALID_PATTERNS=[/^[0-9]+$/,/^[^a-zA-ZÀ-ÿ]/,/[^a-zA-ZÀ-ÿ0-9\s'-]/,/\d{3,}/,/(.)\1{3,}/,/^\s|\s$/,/\s{2,}/];static validateCharacterName(e){if(!e||"string"!=typeof e)return{isValid:!1,error:"Nome é obrigatório"};const t=e.trim();if(t.length<3)return{isValid:!1,error:"Nome deve ter pelo menos 3 caracteres"};if(t.length>20)return{isValid:!1,error:"Nome deve ter no máximo 20 caracteres"};for(const n of this.INVALID_PATTERNS)if(n.test(t))return{isValid:!1,error:this.getPatternError(n)};const s=t.toLowerCase().split(/[\s\-']+/);for(const n of s)if(this.BLACKLIST_WORDS.includes(n))return{isValid:!1,error:"Nome contém palavras inadequadas"};const a=t.toLowerCase().replace(/[\s\-']/g,"");for(const n of this.BLACKLIST_WORDS)if(a.includes(n))return{isValid:!1,error:"Nome contém termos inadequados"};for(const n of this.RESERVED_WORDS)if(a.includes(n))return{isValid:!1,error:"Nome contém termos reservados do sistema"};if(!/[a-zA-ZÀ-ÿ]/.test(t))return{isValid:!1,error:"Nome deve conter pelo menos uma letra"};const r=(t.match(/[a-zA-ZÀ-ÿ]/g)||[]).length;return(t.match(/[0-9]/g)||[]).length>r?{isValid:!1,error:"Nome não pode ter mais números que letras"}:{isValid:!0}}static getPatternError(e){const t=e.toString();return t.includes("^[0-9]+$")?"Nome não pode ser apenas números":t.includes("^[^a-zA-ZÀ-ÿ]")?"Nome deve começar com uma letra":t.includes("[^a-zA-ZÀ-ÿ0-9\\s'\\-]")?"Nome contém caracteres especiais não permitidos":t.includes("\\d{3,}")?"Nome não pode ter mais de 2 números consecutivos":t.includes("(.)\\1{3,}")?"Nome não pode ter mais de 3 caracteres iguais seguidos":t.includes("^\\s|\\s$")?"Nome não pode começar ou terminar com espaços":t.includes("\\s{2,}")?"Nome não pode ter espaços múltiplos":"Nome contém formato inválido"}static formatCharacterName(e){if(!e)return"";let t=e.trim().replace(/\s+/g," ");return t=t.replace(/\b\w/g,(e=>e.toUpperCase())),t}static generateNameSuggestions(e){const t=[],s=e.replace(/[^a-zA-ZÀ-ÿ]/g,"");if(s.length>=3){for(let a=1;a<=3;a++){const e=Math.floor(100*Math.random());t.push(this.formatCharacterName(s+e))}const e=["Jr","II","III","X","Prime","Neo"];for(const a of e.slice(0,2))t.push(this.formatCharacterName(s+a))}if(0===t.length){const e=["Aventureiro","Guerreiro","Explorador","Heroi","Campeao","Bravo","Valente","Nobre","Lenda","Mestre"];for(let s=0;s<3;s++){const s=e[Math.floor(Math.random()*e.length)],a=Math.floor(1e3*Math.random());t.push(`${s}${a}`)}}return t.slice(0,3)}static isTooSimilar(e,t){const s=e.toLowerCase().replace(/[^a-zA-ZÀ-ÿ0-9]/g,"");for(const a of t){const e=a.toLowerCase().replace(/[^a-zA-ZÀ-ÿ0-9]/g,"");if(s===e)return!0;if(this.calculateSimilarity(s,e)>.8)return!0}return!1}static calculateSimilarity(e,t){const s=e.length>t.length?e:t,a=e.length>t.length?t:e;if(0===s.length)return 1;const r=this.levenshteinDistance(s,a);return(s.length-r)/s.length}static levenshteinDistance(e,t){const s=Array(t.length+1).fill(null).map((()=>Array(e.length+1).fill(null)));for(let a=0;a<=e.length;a+=1)s[0][a]=a;for(let a=0;a<=t.length;a+=1)s[a][0]=a;for(let a=1;a<=t.length;a+=1)for(let r=1;r<=e.length;r+=1){const n=e[r-1]===t[a-1]?0:1;s[a][r]=Math.min(s[a][r-1]+1,s[a-1][r]+1,s[a-1][r-1]+n)}return s[t.length][e.length]}}function wh(e,t){if(e&&"object"==typeof e){if("message"in e&&"string"==typeof e.message)return e.message;if(e instanceof Error)return e.message}return t}class _h{static equipmentCache=new Map;static lastFetchTimestamp=0;static CACHE_DURATION=3e5;static async getAvailableEquipment(e){try{const t=`level_${e}`,s=Date.now();if(s-this.lastFetchTimestamp<this.CACHE_DURATION&&this.equipmentCache.has(t))return this.equipmentCache.get(t)||[];const{data:a,error:r}=await Es.from("equipment").select("*").lte("level_requirement",e).eq("is_unlocked",!0).order("level_requirement",{ascending:!0});if(r)throw r;const n=a;return this.equipmentCache.set(t,n),this.lastFetchTimestamp=s,n}catch(t){return[]}}static async getAllEquipments(){try{const{data:e,error:t}=await Es.from("equipment").select("*").order("name");if(t)throw t;return e}catch(e){return[]}}static async getCharacterEquipmentComplete(e){try{const{data:t,error:s}=await Es.from("character_equipment").select("\n          *,\n          equipment:equipment_id (\n            id,\n            name,\n            description,\n            type,\n            weapon_subtype,\n            rarity,\n            level_requirement,\n            atk_bonus,\n            def_bonus,\n            mana_bonus,\n            speed_bonus,\n            hp_bonus,\n            critical_chance_bonus,\n            critical_damage_bonus,\n            price,\n            is_unlocked,\n            created_at,\n            updated_at\n          )\n        ").eq("character_id",e).order("created_at",{ascending:!1});if(s)throw s;let a=t;const r={},n=[];for(const e of a){const t=e.quantity||1;for(let s=0;s<t;s++)n.push({...e,id:`${e.id}-${s}`})}return a=n,a.forEach((e=>{if(e.is_equipped&&e.equipment){let t=null;switch(e.equipment.type){case"weapon":t=r.main_hand?r.off_hand?"main_hand":"off_hand":"main_hand";break;case"armor":t=r.armor?r.off_hand?"armor":"off_hand":"armor";break;case"chest":t="chest";break;case"helmet":t="helmet";break;case"legs":t="legs";break;case"boots":t="boots";break;case"ring":t=r.ring_1?r.ring_2?"ring_1":"ring_2":"ring_1";break;case"necklace":t="necklace";break;case"amulet":t="amulet"}t&&(r[t]=e.equipment)}})),{allEquipment:a,equippedSlots:r}}catch{return{allEquipment:[],equippedSlots:{}}}}static async getCharacterEquipment(e){const{allEquipment:t}=await this.getCharacterEquipmentComplete(e);return t}static async getEquippedItems(e){const{equippedSlots:t}=await this.getCharacterEquipmentComplete(e);return t}static async toggleEquipment(e,t,s,a){try{const{error:r}=await Es.rpc("toggle_equipment",{p_character_id:e,p_equipment_id:t,p_slot_type:a||null});if(r)throw r;return{data:s?"Item equipado com sucesso!":"Item desequipado com sucesso!",error:null,success:!0}}catch(r){return{data:null,error:wh(r,"Erro ao equipar/desequipar item"),success:!1}}}static async buyEquipment(e,t){try{const{data:s,error:a}=await Es.rpc("buy_equipment",{p_character_id:e,p_equipment_id:t});if(a)throw a;return{data:{newGold:s},error:null,success:!0}}catch(s){return{data:null,error:wh(s,"Erro ao comprar equipamento"),success:!1}}}static async sellEquipment(e,t){try{const{data:s,error:a}=await Es.rpc("sell_equipment",{p_character_id:e,p_equipment_id:t});if(a)throw a;return{data:{newGold:s},error:null,success:!0}}catch(s){return{data:null,error:wh(s,"Erro ao vender equipamento"),success:!1}}}static async sellEquipmentBatch(e,t){try{const{data:s,error:a}=await Es.rpc("sell_character_equipment_batch",{p_character_id:e,p_equipment_sales:t}).single();if(a)throw a;const r=s;return{data:{totalGoldEarned:r.total_gold_earned,itemsSold:r.items_sold,newGold:r.new_character_gold},error:null,success:!0}}catch(s){return{data:null,error:wh(s,"Erro ao vender equipamentos"),success:!1}}}static async calculateEquipmentSellPrice(e,t,s=1){try{const{data:a,error:r}=await Es.rpc("calculate_sell_prices",{p_character_id:e,p_item_type:"equipment",p_item_id:t,p_quantity:s}).single();if(r)throw r;const n=a;return{data:{canSell:n.can_sell,availableQuantity:n.available_quantity,unitSellPrice:n.unit_sell_price,totalSellPrice:n.total_sell_price,originalPrice:n.original_price},error:null,success:!0}}catch(a){return{data:null,error:wh(a,"Erro ao calcular preço"),success:!1}}}static async getEquipmentCraftingRecipes(){try{const{data:e,error:t}=await Es.from("equipment_crafting_recipes").select("\n          *,\n          equipment:result_equipment_id (*),\n          ingredients:equipment_crafting_ingredients (*)\n        ").order("name");if(t)throw t;return{data:e,error:null,success:!0}}catch(e){return{data:null,error:"Erro ao buscar receitas de equipamentos",success:!1}}}static async canCraftEquipment(e,t){try{const{data:s,error:a}=await Es.rpc("check_can_craft_equipment",{p_character_id:e,p_recipe_id:t});if(a)throw a;return{data:s,error:null,success:!0}}catch(s){return{data:null,error:wh(s,"Erro ao verificar crafting de equipamento"),success:!1}}}static async craftEquipment(e,t){try{const{error:s}=await Es.rpc("craft_equipment",{p_character_id:e,p_recipe_id:t});if(s)throw s;return{data:{message:"Equipamento criado com sucesso!"},error:null,success:!0}}catch(s){return{data:null,error:wh(s,"Erro ao craftar equipamento"),success:!1}}}static async canEquipItem(e,t){try{const{data:s,error:a}=await Es.from("equipment").select("*").eq("id",t).single();if(a||!s)return{data:{canEquip:!1,reason:"Equipamento não encontrado"},error:null,success:!0};const r=await this.getEquippedItems(e);let n=!1,i="",o="";switch(s.type){case"weapon":r.main_hand?r.off_hand?(n=!0,i="Pode substituir equipamento existente",o="main_hand"):(n=!0,i="Pode equipar na mão secundária",o="off_hand"):(n=!0,i="Pode equipar na mão principal",o="main_hand"),s.is_two_handed&&(r.main_hand||r.off_hand?(n=!0,i="Arma two-handed substituirá os equipamentos em ambas as mãos",o="main_hand"):(n=!0,i="Arma two-handed ocupará ambas as mãos",o="main_hand"));break;case"armor":r.armor?r.off_hand?(n=!0,i="Pode substituir equipamento existente",o="armor"):(n=!0,i="Pode equipar como escudo na mão secundária",o="off_hand"):(n=!0,i="Pode equipar como escudo na mão secundária",o="armor");break;case"chest":r.chest?(n=!0,i="Pode substituir peitoral existente",o="chest"):(n=!0,i="Pode equipar como peitoral",o="chest");break;case"helmet":r.helmet?(n=!0,i="Pode substituir capacete existente",o="helmet"):(n=!0,i="Pode equipar como capacete",o="helmet");break;case"legs":r.legs?(n=!0,i="Pode substituir perneiras existentes",o="legs"):(n=!0,i="Pode equipar como perneiras",o="legs");break;case"boots":r.boots?(n=!0,i="Pode substituir botas existentes",o="boots"):(n=!0,i="Pode equipar como botas",o="boots");break;case"ring":r.ring_1?r.ring_2?(n=!0,i="Pode substituir anel existente",o="ring_1"):(n=!0,i="Pode equipar no segundo slot de anel",o="ring_2"):(n=!0,i="Pode equipar no primeiro slot de anel",o="ring_1");break;case"necklace":r.necklace?(n=!0,i="Pode substituir colar existente",o="necklace"):(n=!0,i="Pode equipar como colar",o="necklace");break;case"amulet":r.amulet?(n=!0,i="Pode substituir amuleto existente",o="amulet"):(n=!0,i="Pode equipar como amuleto",o="amulet");break;default:n=!1,i="Tipo de equipamento não reconhecido"}return{data:{canEquip:n,reason:i,suggestedSlot:o},error:null,success:!0}}catch(s){return{data:null,error:wh(s,"Erro ao verificar se pode equipar item"),success:!1}}}static async compareEquipmentStats(e,t,s){try{const{data:a,error:r}=await Es.rpc("compare_equipment_stats",{p_character_id:e,p_new_equipment_id:t,p_slot_type:s});if(r)return{success:!1,error:r.message,data:null};return{success:!0,error:null,data:a||[]}}catch(a){return{success:!1,error:wh(a,"Erro ao comparar equipamentos"),data:null}}}static async getEquipmentBonuses(e){try{const{data:t,error:s}=await Es.rpc("calculate_equipment_bonuses",{p_character_id:e});if(s)return{success:!1,error:s.message,data:null};return{success:!0,error:null,data:t?.[0]||{total_atk_bonus:0,total_def_bonus:0,total_mana_bonus:0,total_speed_bonus:0,total_hp_bonus:0,total_critical_chance_bonus:0,total_critical_damage_bonus:0}}}catch(t){return{success:!1,error:wh(t,"Erro ao obter bônus de equipamentos"),data:null}}}static clearCache(){this.equipmentCache.clear(),this.lastFetchTimestamp=0}static determineEquipmentSlot(e,t){switch(e.type){case"weapon":return e.is_two_handed?"main_hand":t.main_hand?t.off_hand?"main_hand":"off_hand":"main_hand";case"armor":return t.armor?t.off_hand?"armor":"off_hand":"armor";case"chest":return"chest";case"helmet":return"helmet";case"legs":return"legs";case"boots":return"boots";case"ring":return t.ring_1?t.ring_2?"ring_1":"ring_2":"ring_1";case"necklace":return"necklace";case"amulet":return"amulet";default:return null}}static getAvailableSlotsForType(e,t){switch(e){case"weapon":return{availableSlots:[...t.main_hand?[]:["main_hand"],...t.off_hand?[]:["off_hand"]],occupiedSlots:[...t.main_hand?["main_hand"]:[],...t.off_hand?["off_hand"]:[]],maxSlots:2};case"armor":return{availableSlots:[...t.armor?[]:["armor"],...t.off_hand?[]:["off_hand"]],occupiedSlots:[...t.armor?["armor"]:[],...t.off_hand?["off_hand"]:[]],maxSlots:2};case"chest":return{availableSlots:t.chest?[]:["chest"],occupiedSlots:t.chest?["chest"]:[],maxSlots:1};case"helmet":return{availableSlots:t.helmet?[]:["helmet"],occupiedSlots:t.helmet?["helmet"]:[],maxSlots:1};case"legs":return{availableSlots:t.legs?[]:["legs"],occupiedSlots:t.legs?["legs"]:[],maxSlots:1};case"boots":return{availableSlots:t.boots?[]:["boots"],occupiedSlots:t.boots?["boots"]:[],maxSlots:1};case"ring":return{availableSlots:[...t.ring_1?[]:["ring_1"],...t.ring_2?[]:["ring_2"]],occupiedSlots:[...t.ring_1?["ring_1"]:[],...t.ring_2?["ring_2"]:[]],maxSlots:2};case"necklace":return{availableSlots:t.necklace?[]:["necklace"],occupiedSlots:t.necklace?["necklace"]:[],maxSlots:1};case"amulet":return{availableSlots:t.amulet?[]:["amulet"],occupiedSlots:t.amulet?["amulet"]:[],maxSlots:1};default:return{availableSlots:[],occupiedSlots:[],maxSlots:0}}}static extractOriginalEquipmentId(e){const t=e.split("-");return t.length>1&&/^\d+$/.test(t[t.length-1])?t.slice(0,-1).join("-"):e}}class Ch{static spellCache=new Map;static lastFetchTimestamp=0;static CACHE_DURATION=3e5;static characterSpellCache=new Map;static equippedSpellCache=new Map;static pendingAvailableRequests=new Map;static pendingEquippedRequests=new Map;static CHARACTER_CACHE_DURATION=3e5;static REQUEST_TIMEOUT=8e3;static isCacheValid(e){if(!e)return!1;const t=Date.now();return e.isValid&&t-e.timestamp<this.CHARACTER_CACHE_DURATION}static cancelPendingRequest(e,t){const s=e.get(t);s&&(s.abortController.abort(),e.delete(t))}static invalidateCharacterCache(e){this.cancelPendingRequest(this.pendingAvailableRequests,e),this.cancelPendingRequest(this.pendingEquippedRequests,e);const t=this.characterSpellCache.get(e);t&&(t.isValid=!1);const s=this.equippedSpellCache.get(e);s&&(s.isValid=!1)}static clearCache(){this.spellCache.clear(),this.lastFetchTimestamp=0;for(const[,e]of this.pendingAvailableRequests)e.abortController.abort();for(const[,e]of this.pendingEquippedRequests)e.abortController.abort();this.characterSpellCache.clear(),this.equippedSpellCache.clear(),this.pendingAvailableRequests.clear(),this.pendingEquippedRequests.clear()}static async getCharacterAvailableSpells(e,t){try{const a=this.characterSpellCache.get(e);if(this.isCacheValid(a))return{data:a.data,error:null,success:!0};const r=this.pendingAvailableRequests.get(e);if(r)try{return await r.promise}catch(s){if(!r.abortController.signal.aborted)throw s}const n=new AbortController,i=this.fetchCharacterAvailableSpells(e,t,n.signal);this.pendingAvailableRequests.set(e,{promise:i,abortController:n});try{const t=await i;return t.success&&t.data&&this.characterSpellCache.set(e,{data:t.data,timestamp:Date.now(),isValid:!0}),t}finally{this.pendingAvailableRequests.delete(e)}}catch(s){return{data:null,error:s instanceof Error?s.message:"Erro desconhecido",success:!1}}}static async fetchCharacterAvailableSpells(e,t,s){const a=new Promise(((e,t)=>{const a=setTimeout((()=>{t(new Error("Timeout ao carregar magias disponíveis"))}),this.REQUEST_TIMEOUT);s.addEventListener("abort",(()=>{clearTimeout(a),t(new Error("Request cancelado"))}))})),r=Es.rpc("get_available_spells",{p_level:t}),{data:n,error:i}=await Promise.race([r,a]);if(s.aborted)throw new Error("Request cancelado");if(i)throw i;const{data:o,error:l}=await Es.from("spell_slots").select("slot_position, spell_id").eq("character_id",e);if(l)throw l;const c=new Map;(o||[]).forEach((e=>{e.spell_id&&c.set(e.spell_id,e.slot_position)}));return{data:(n||[]).map((e=>({id:e.id,name:e.name,description:e.description,effect_type:e.effect_type,mana_cost:e.mana_cost,cooldown:e.cooldown,effect_value:e.effect_value,duration:e.duration,unlocked_at_level:e.unlocked_at_level||1,is_equipped:c.has(e.id),slot_position:c.get(e.id)||null}))),error:null,success:!0}}static async setCharacterSpells(e,t){try{const[s,a,r]=t,n=await Promise.all([Es.rpc("set_spell_slot",{p_character_id:e,p_slot_position:1,p_spell_id:s||null}),Es.rpc("set_spell_slot",{p_character_id:e,p_slot_position:2,p_spell_id:a||null}),Es.rpc("set_spell_slot",{p_character_id:e,p_slot_position:3,p_spell_id:r||null})]);for(const e of n)if(e.error)throw e.error;return this.invalidateCharacterCache(e),{data:null,error:null,success:!0}}catch(s){return{data:null,error:s instanceof Error?s.message:"Erro desconhecido",success:!1}}}static calculateSpellStats(e){const t=e.filter((e=>e.is_equipped)),s={};e.forEach((e=>{s[e.effect_type]=(s[e.effect_type]||0)+1}));const a={total_available:e.length,total_equipped:t.length,highest_level_unlocked:e.length>0?Math.max(...e.map((e=>e.unlocked_at_level))):1,spells_by_type:s};return a}static async getAvailableSpells(e){const t=Date.now();if(this.spellCache.has(e)&&t-this.lastFetchTimestamp<this.CACHE_DURATION)return{data:this.spellCache.get(e),error:null,success:!0};try{const{data:s,error:a}=await Es.rpc("get_available_spells",{p_level:e});if(a)throw a;return this.spellCache.set(e,s||[]),this.lastFetchTimestamp=t,{data:s||[],error:null,success:!0}}catch(s){return{data:null,error:s instanceof Error?s.message:"Erro desconhecido",success:!1}}}static calculateScaledSpellDamage(e,t){if(!("intelligence"in t)||!("wisdom"in t)||!("magic_mastery"in t))return e;const s=t.intelligence||10,a=t.wisdom||10,r=t.magic_mastery||1;let n=1.8*Math.pow(s,1.35)+1.2*Math.pow(a,1.2)+2.5*Math.pow(r,1.2);n>150&&(n=150+.6*(n-150)),n=Math.min(300,n);return Math.round(e*(1+n/100))}static calculateScaledSpellHealing(e,t){if(!("wisdom"in t)||!("magic_mastery"in t))return e;const s=t.wisdom||10,a=t.magic_mastery||1;let r=2.2*Math.pow(s,1.3)+1.8*Math.pow(a,1.15);r>120&&(r=120+.5*(r-120)),r=Math.min(220,r);return Math.round(e*(1+r/100))}static applySpellEffect(e,t,s){const a={damage:()=>{const a=this.calculateScaledSpellDamage(e.effect_value,t);return s.hp=Math.max(0,s.hp-a),`${e.name} causou ${a} de dano mágico!`},heal:()=>{const a=this.calculateScaledSpellHealing(e.effect_value,t),r="max_hp"in s?s.max_hp:s.maxHp,n=s.hp;s.hp=Math.min(r,s.hp+a);const i=s.hp-n;return`${e.name} restaurou ${i} HP!`},buff:()=>this.applyAttributeEffect(e,s,"buff"),debuff:()=>this.applyAttributeEffect(e,s,"debuff"),dot:()=>this.applyOverTimeEffect(e,s,"dot"),hot:()=>this.applyOverTimeEffect(e,s,"hot")};try{const t=a[e.effect_type]?.()||`${e.name} não teve efeito!`,s=function(e){return"buff"===e.effect_type||"heal"===e.effect_type||"debuff"===e.effect_type}(e);return{message:t,success:!0,endsTurn:s}}catch(r){return{message:`Erro ao usar ${e.name}!`,success:!1,endsTurn:!0}}}static applyAttributeEffect(e,t,s){if(!t.active_effects)return`${e.name} não teve efeito!`;const a={buffs:[...t.active_effects.buffs],debuffs:[...t.active_effects.debuffs],dots:[...t.active_effects.dots],hots:[...t.active_effects.hots],attribute_modifications:t.active_effects.attribute_modifications?[...t.active_effects.attribute_modifications]:[]};if("buff"===s){const r=this.getAttributeModificationsForSpell(e);if(r.length>0){const s=e.duration||3,n=r.map((e=>({...e,duration:s})));a.attribute_modifications.push(...n);const i=n.map((e=>{const t=e.value>0?"+":"",s="percentage"===e.type?"%":"";return`${t}${e.value}${s} ${this.translateAttributeName(e.attribute)}`})).join(", ");return t.active_effects=a,`${e.name} concedeu: ${i} por ${s} turnos!`}{const r=this.calculateScaledSpellDamage(e.effect_value,t),n=e.duration||3,i={type:s,value:r,duration:n,source_spell:e.name};return a.buffs.push(i),t.active_effects=a,`${e.name} aplicou um efeito benéfico genérico (+${r}) por ${n} turnos!`}}{const r=this.getAttributeModificationsForSpell(e);if(r.length>0){const s=e.duration||3,n=r.map((e=>({...e,value:-Math.abs(e.value),duration:s})));a.attribute_modifications.push(...n);const i=n.map((e=>{const t="percentage"===e.type?"%":"";return`${e.value}${t} ${this.translateAttributeName(e.attribute)}`})).join(", ");return t.active_effects=a,`${e.name} reduziu: ${i} por ${s} turnos!`}{const r=this.calculateScaledSpellDamage(e.effect_value,t),n=e.duration||3,i={type:s,value:r,duration:n,source_spell:e.name};return a.debuffs.push(i),t.active_effects=a,`${e.name} aplicou um efeito prejudicial genérico (-${r}) por ${n} turnos!`}}}static applyOverTimeEffect(e,t,s){if(!t.active_effects)return`${e.name} não teve efeito!`;const a="dot"===s?this.calculateScaledSpellDamage(e.effect_value,t):this.calculateScaledSpellHealing(e.effect_value,t),r={type:s,value:a,duration:e.duration,source_spell:e.name},n={buffs:[...t.active_effects.buffs],debuffs:[...t.active_effects.debuffs],dots:[...t.active_effects.dots],hots:[...t.active_effects.hots],attribute_modifications:t.active_effects.attribute_modifications?[...t.active_effects.attribute_modifications]:[]};return"dot"===s?(n.dots.push(r),t.active_effects=n,`${e.name} aplicou dano contínuo (${a} por ${e.duration} turnos)!`):(n.hots.push(r),t.active_effects=n,`${e.name} aplicou cura contínua (${a} por ${e.duration} turnos)!`)}static processOverTimeEffects(e){const t=[];if(!("active_effects"in e)||!e.active_effects)return t;const s={buffs:[...e.active_effects.buffs],debuffs:[...e.active_effects.debuffs],dots:[...e.active_effects.dots],hots:[...e.active_effects.hots],attribute_modifications:e.active_effects.attribute_modifications?[...e.active_effects.attribute_modifications]:[]};return s.dots=s.dots.map((e=>({...e}))).filter((s=>(e.hp=Math.max(0,e.hp-s.value),s.duration--,t.push(`${s.source_spell} causou ${s.value} de dano contínuo.`),s.duration>0))),s.hots=s.hots.map((e=>({...e}))).filter((s=>{const a="max_hp"in e?e.max_hp:e.maxHp,r=e.hp;e.hp=Math.min(a,e.hp+s.value);const n=e.hp-r;return s.duration--,n>0&&t.push(`${s.source_spell} restaurou ${n} HP.`),s.duration>0})),s.attribute_modifications&&(s.attribute_modifications=s.attribute_modifications.map((e=>({...e}))).filter((e=>(e.duration--,!(e.duration<=0)||(t.push(`O efeito de ${e.source_spell} em ${this.translateAttributeName(e.attribute)} expirou.`),!1))))),s.buffs=s.buffs.map((e=>({...e}))).filter((e=>(e.duration--,!(e.duration<=0)||(t.push(`O efeito benéfico de ${e.source_spell} expirou.`),!1)))),s.debuffs=s.debuffs.map((e=>({...e}))).filter((e=>(e.duration--,!(e.duration<=0)||(t.push(`O efeito prejudicial de ${e.source_spell} expirou.`),!1)))),e.active_effects=s,t}static updateSpellCooldowns(e){return{...e,player:{...e.player,spells:e.player.spells.map((e=>({...e,current_cooldown:e.current_cooldown>0?e.current_cooldown-1:0})))}}}static resetSpellCooldowns(e){return{...e,player:{...e.player,spells:e.player.spells.map((e=>({...e,current_cooldown:0})))}}}static getSpellTypeIcon(e){return{damage:"⚔️",heal:"❤️",buff:"🛡️",debuff:"💀",dot:"🔥",hot:"✨"}[e]||"🔮"}static getSpellTypeColor(e){return{damage:"text-red-500",heal:"text-green-500",buff:"text-blue-500",debuff:"text-purple-500",dot:"text-orange-500",hot:"text-emerald-500"}[e]||"text-gray-500"}static translateEffectType(e){return{damage:"Dano",heal:"Cura",buff:"Benefício",debuff:"Maldição",dot:"Dano Contínuo",hot:"Cura Contínua"}[e]||e}static getAttributeModificationsForSpell(e){const t=[],s=e.name.toLowerCase();return[{keywords:["força","strength","fortalecer","fúria","guerreiro","berserker","poder"],attribute:"atk",multiplier:1.2},{keywords:["velocidade","speed","agilidade","pressa","vento","corrida"],attribute:"speed",multiplier:1},{keywords:["defesa","defense","proteção","armadura","barreira","escudo"],attribute:"def",multiplier:1.1},{keywords:["crítico","critical","precisão","foco","mira","acerto"],attribute:"critical_chance",multiplier:.8,type:"percentage"},{keywords:["magia","magic","mystic","arcano","místico","feitiço"],attribute:"magic_attack",multiplier:1.3},{keywords:["destruição","devastação","carnificina","massacre"],attribute:"critical_damage",multiplier:1.5,type:"percentage"}].forEach((({keywords:a,attribute:r,multiplier:n,type:i="flat"})=>{if(a.some((e=>s.includes(e)))){const s=Math.floor(e.effect_value*n),a=Math.max(5,s);t.push({attribute:r,value:a,type:i,duration:e.duration||3,source_spell:e.name,applied_at:Date.now()})}})),t}static translateAttributeName(e){return{atk:"Ataque",def:"Defesa",speed:"Velocidade",magic_attack:"Ataque Mágico",critical_chance:"Chance Crítica",critical_damage:"Dano Crítico"}[e]||e}static async getCharacterEquippedSpells(e){try{const s=this.equippedSpellCache.get(e);if(this.isCacheValid(s))return{data:s.data,error:null,success:!0};const a=this.pendingEquippedRequests.get(e);if(a)try{return await a.promise}catch(t){if(!a.abortController.signal.aborted)throw t}const r=new AbortController,n=this.fetchCharacterEquippedSpells(e,r.signal);this.pendingEquippedRequests.set(e,{promise:n,abortController:r});try{const t=await n;return t.success&&t.data&&this.equippedSpellCache.set(e,{data:t.data,timestamp:Date.now(),isValid:!0}),t}finally{this.pendingEquippedRequests.delete(e)}}catch(t){return{data:null,error:t instanceof Error?t.message:"Erro desconhecido",success:!1}}}static async fetchCharacterEquippedSpells(e,t){const{data:s,error:a}=await Es.from("spell_slots").select("\n        slot_position,\n        spell_id,\n        spell:spells(\n          id,\n          name,\n          description,\n          mana_cost,\n          cooldown,\n          effect_type,\n          effect_value,\n          duration,\n          unlocked_at_level\n        )\n      ").eq("character_id",e).not("spell_id","is",null).order("slot_position");if(t.aborted)throw new Error("Request cancelado");if(a)throw a;return{data:(s||[]).map((e=>{const t=Array.isArray(e.spell)?e.spell[0]:e.spell;return{id:t.id,name:t.name,description:t.description,mana_cost:t.mana_cost,cooldown:t.cooldown,current_cooldown:0,effect_type:t.effect_type,effect_value:t.effect_value,duration:t.duration||0,unlocked_at_level:t.unlocked_at_level}})),error:null,success:!0}}}const Sh=Object.freeze(Object.defineProperty({__proto__:null,SpellService:Ch},Symbol.toStringTag,{value:"Module"}));async function Eh(e,t,s){const{loadSpells:a=!0}={},{baseStats:r,totalStats:n,derivedStats:i,equipmentBonuses:o}=await async function(e,t){const s=await yh.calculateDerivedStats(e),a=await _h.getEquipmentBonuses(t),r=a.success&&a.data?a.data:{total_atk_bonus:0,total_def_bonus:0,total_mana_bonus:0,total_speed_bonus:0,total_hp_bonus:0,total_critical_chance_bonus:0,total_critical_damage_bonus:0},n={hp:s.hp,max_hp:s.max_hp,mana:s.mana,max_mana:s.max_mana,atk:s.atk,def:s.def,speed:s.speed};return{baseStats:n,totalStats:{hp:n.hp+r.total_hp_bonus,max_hp:n.max_hp+r.total_hp_bonus,mana:n.mana+r.total_mana_bonus,max_mana:n.max_mana+r.total_mana_bonus,atk:n.atk+r.total_atk_bonus,def:n.def+r.total_def_bonus,speed:n.speed+r.total_speed_bonus},derivedStats:s,equipmentBonuses:r}}(e,t),l={id:e.id,user_id:e.user_id,name:e.name,level:e.level,xp:e.xp,xp_next_level:e.xp_next_level,gold:e.gold,hp:n.hp,max_hp:n.max_hp,mana:n.mana,max_mana:n.max_mana,atk:n.atk,def:n.def,speed:n.speed,created_at:e.created_at,updated_at:e.updated_at,isPlayerTurn:!0,specialCooldown:0,defenseCooldown:0,isDefending:!1,floor:e.floor,spells:[],consumables:[],active_effects:{buffs:[],debuffs:[],dots:[],hots:[],attribute_modifications:[]},strength:e.strength||10,dexterity:e.dexterity||10,intelligence:e.intelligence||10,wisdom:e.wisdom||10,vitality:e.vitality||10,luck:e.luck||10,attribute_points:e.attribute_points||0,sword_mastery:e.sword_mastery||1,axe_mastery:e.axe_mastery||1,blunt_mastery:e.blunt_mastery||1,defense_mastery:e.defense_mastery||1,magic_mastery:e.magic_mastery||1,sword_mastery_xp:e.sword_mastery_xp||0,axe_mastery_xp:e.axe_mastery_xp||0,blunt_mastery_xp:e.blunt_mastery_xp||0,defense_mastery_xp:e.defense_mastery_xp||0,magic_mastery_xp:e.magic_mastery_xp||0,critical_chance:i.critical_chance+o.total_critical_chance_bonus,critical_damage:i.critical_damage+o.total_critical_damage_bonus,magic_damage_bonus:i.magic_damage_bonus,magic_attack:i.magic_attack,double_attack_chance:i.double_attack_chance,base_hp:r.hp,base_max_hp:r.max_hp,base_mana:r.mana,base_max_mana:r.max_mana,base_atk:r.atk,base_def:r.def,base_speed:r.speed,equipment_hp_bonus:o.total_hp_bonus,equipment_mana_bonus:o.total_mana_bonus,equipment_atk_bonus:o.total_atk_bonus,equipment_def_bonus:o.total_def_bonus,equipment_speed_bonus:o.total_speed_bonus};if(a)try{const e=await Ch.getCharacterEquippedSpells(t);l.spells=e.success&&e.data?e.data:[]}catch(c){l.spells=[]}return l}const kh=new class{characterCache=new Map;cacheTimestamps=new Map;userCharactersCache=new Map;userCacheTimestamps=new Map;pendingRequests=new Map;getCachedCharacter(e){return this.characterCache.get(e)||null}getCacheTimestamp(e){return this.cacheTimestamps.get(e)||null}setCachedCharacter(e,t){this.characterCache.set(e,t),this.cacheTimestamps.set(e,Date.now())}invalidateCharacterCache(e){this.characterCache.delete(e),this.cacheTimestamps.delete(e)}getCachedUserCharacters(e){const t=this.userCharactersCache.get(e),s=this.userCacheTimestamps.get(e);if(!t||!s)return{isValid:!1,characters:[]};return{isValid:Date.now()-s<15e3,characters:t}}setCachedUserCharacters(e,t){this.userCharactersCache.set(e,t),this.userCacheTimestamps.set(e,Date.now())}invalidateUserCache(e){this.userCharactersCache.delete(e),this.userCacheTimestamps.delete(e)}getPendingRequest(e){return this.pendingRequests.get(e)||null}setPendingRequest(e,t){this.pendingRequests.set(e,t),t.finally((()=>this.pendingRequests.delete(e)))}clearAll(){this.characterCache.clear(),this.cacheTimestamps.clear(),this.userCharactersCache.clear(),this.userCacheTimestamps.clear(),this.pendingRequests.clear()}};class Ah{static async getUserCharacters(e){try{const t=kh.getCachedUserCharacters(e);if(t.isValid){const e=t.characters.filter((e=>!1!==e.is_alive));return{data:e,error:null,success:!0}}const{data:s,error:a}=await Es.rpc("get_user_characters",{p_user_id:e});if(a)throw a;let r=s;return r=r.filter((e=>!1!==e.is_alive)),kh.setCachedUserCharacters(e,r),{data:r,error:null,success:!0}}catch(t){return{data:null,error:t instanceof Error?t.message:"Erro ao buscar personagens",success:!1}}}static async getCharacter(e){try{const t=kh.getCachedCharacter(e);if(t)return{data:t,error:null,success:!0};const s=kh.getPendingRequest(e);if(s){return await s}const a=this.fetchCharacterFromServer(e);kh.setPendingRequest(e,a);return await a}catch(t){return{data:null,error:t instanceof Error?t.message:"Erro ao buscar personagem",success:!1}}}static async fetchCharacterFromServer(e){try{const s=new Promise(((e,t)=>{setTimeout((()=>t(new Error("Timeout ao buscar personagem"))),8e3)})),a=Es.rpc("get_character_full_stats",{p_character_id:e}).single();try{const{data:t,error:r}=await Promise.race([a,s]);if(r)return await this.fetchCharacterFromServerFallback(e);if(!t)return await this.fetchCharacterFromServerFallback(e);if(!t||"object"!=typeof t||!("character_id"in t))return await this.fetchCharacterFromServerFallback(e);const n=await this.convertRPCDataToCharacter(t,e);return kh.setCachedCharacter(e,n),{data:n,error:null,success:!0}}catch(t){return await this.fetchCharacterFromServerFallback(e)}}catch(s){return{data:null,error:s instanceof Error?s.message:"Erro ao buscar personagem",success:!1}}}static async fetchCharacterFromServerFallback(e){try{const{data:t,error:s}=await Es.from("characters").select("*").eq("id",e).maybeSingle();if(s)throw s;if(!t)return{data:null,error:"Personagem não encontrado",success:!1};const a=await yh.calculateDerivedStats(t),r={id:t.id,user_id:t.user_id,name:t.name,level:t.level,xp:t.xp,xp_next_level:t.xp_next_level,gold:t.gold,hp:a.hp,max_hp:a.max_hp,mana:a.mana,max_mana:a.max_mana,atk:a.atk,def:a.def,speed:a.speed,floor:t.floor,strength:t.strength||10,dexterity:t.dexterity||10,intelligence:t.intelligence||10,wisdom:t.wisdom||10,vitality:t.vitality||10,luck:t.luck||10,attribute_points:t.attribute_points||0,critical_chance:a.critical_chance,critical_damage:a.critical_damage,sword_mastery:t.sword_mastery||1,axe_mastery:t.axe_mastery||1,blunt_mastery:t.blunt_mastery||1,defense_mastery:t.defense_mastery||1,magic_mastery:t.magic_mastery||1,sword_mastery_xp:t.sword_mastery_xp||0,axe_mastery_xp:t.axe_mastery_xp||0,blunt_mastery_xp:t.blunt_mastery_xp||0,defense_mastery_xp:t.defense_mastery_xp||0,magic_mastery_xp:t.magic_mastery_xp||0,is_alive:!0,created_at:t.created_at,updated_at:t.updated_at,last_activity:t.last_activity};return kh.setCachedCharacter(e,r),{data:r,error:null,success:!0}}catch(t){return{data:null,error:t instanceof Error?t.message:"Erro ao buscar personagem",success:!1}}}static async convertRPCDataToCharacter(e,t){if(!e.character_id||!e.name||null===e.level||void 0===e.level)throw new Error("RPC retornou dados incompletos do personagem: faltam id, name ou level");if(e.level<1||e.level>100)throw new Error(`RPC retornou nível inválido: ${e.level}`);const s={id:e.character_id,user_id:"",name:e.name,level:e.level,xp:e.xp,xp_next_level:e.xp_next_level,gold:e.gold,hp:e.hp,max_hp:e.max_hp,mana:e.mana,max_mana:e.max_mana,atk:e.atk,def:e.def,speed:e.speed,floor:1,strength:e.strength,dexterity:e.dexterity,intelligence:e.intelligence,wisdom:e.wisdom,vitality:e.vitality,luck:e.luck,attribute_points:e.attribute_points||0,critical_chance:e.critical_chance,critical_damage:e.critical_damage,sword_mastery:e.sword_mastery,axe_mastery:e.axe_mastery,blunt_mastery:e.blunt_mastery,defense_mastery:e.defense_mastery,magic_mastery:e.magic_mastery,sword_mastery_xp:e.sword_mastery_xp,axe_mastery_xp:e.axe_mastery_xp,blunt_mastery_xp:e.blunt_mastery_xp,defense_mastery_xp:e.defense_mastery_xp,magic_mastery_xp:e.magic_mastery_xp,is_alive:!0,created_at:"",updated_at:"",last_activity:void 0},{data:a,error:r}=await Es.from("characters").select("user_id, floor, created_at, updated_at, last_activity").eq("id",s.id).maybeSingle();if(r)throw new Error(`Erro ao buscar dados adicionais do personagem: ${r.message}`);if(!a)throw new Error(`Personagem ${s.id} não encontrado na tabela characters`);return s.user_id=a.user_id,s.floor=Math.max(1,a.floor||1),s.created_at=a.created_at,s.updated_at=a.updated_at,s.last_activity=a.last_activity,kh.setCachedCharacter(t,s),s}static async createCharacter(e){try{const t=Nh.validateCharacterName(e.name);if(!t.isValid)return{data:null,error:t.error||"Nome inválido",success:!1};const s=await vh.checkCharacterLimit(e.user_id);if(!s.success||!s.data?.can_create){const e=s.data?.next_slot_required_level||0;return{data:null,error:`Limite de personagens atingido. Para criar o ${(s.data?.available_slots||3)+1}º personagem, você precisa de ${e} níveis totais entre todos os seus personagens.`,success:!1}}const a=Nh.formatCharacterName(e.name),r=await async function(e,t){const s=Nh.formatCharacterName(e),a=await Ah.getUserCharacters(t),r=a.success&&a.data?a.data:[];if(0===r.length)return{isValid:!0};const n=r.map((e=>e.name));if(Nh.isTooSimilar(s,n)){const e=Nh.generateNameSuggestions(s);return{isValid:!1,error:`Nome muito similar a um personagem existente. Sugestões: ${e.join(", ")}`,suggestions:e}}return{isValid:!0}}(a,e.user_id);if(!r.isValid)return{data:null,error:r.error||"Nome inválido",success:!1};const{data:n,error:i}=await Es.rpc("create_character",{p_user_id:e.user_id,p_name:a});if(i){if(i.message.includes("Nome"))return{data:null,error:i.message,success:!1};if(i.message.includes("Limite")||i.message.includes("personagem"))return{data:null,error:i.message,success:!1};throw i}return kh.invalidateUserCache(e.user_id),{data:{id:n},error:null,success:!0}}catch(t){return{data:null,error:t instanceof Error?t.message:"Erro ao criar personagem",success:!1}}}static async getDeadCharacters(e){try{const{data:t,error:s}=await Es.from("characters").select("*").eq("user_id",e).eq("is_alive",!1).order("updated_at",{ascending:!1});if(s)throw s;return{data:t||[],error:null,success:!0}}catch(t){return{data:null,error:t instanceof Error?t.message:"Erro ao buscar personagens mortos",success:!1}}}static async markCharacterDead(e){try{const t=await this.getCharacter(e);let s=null;if(t.success&&t.data){s=t.data.user_id;const{error:a}=await Es.rpc("mark_character_dead",{p_character_id:e});if(a)throw a}return kh.invalidateCharacterCache(e),s&&kh.invalidateUserCache(s),{error:null}}catch(t){return{error:t instanceof Error?t.message:"Erro ao marcar personagem como morto"}}}static async getCharacterStats(e){try{const t=await this.getCharacterForGame(e);if(!t.success||!t.data)return{success:!1,error:t.error||"Erro ao carregar dados do personagem",data:null};const s=t.data;return{success:!0,error:null,data:{level:s.level,xp:s.xp,xp_next_level:s.xp_next_level,gold:s.gold,hp:s.hp,max_hp:s.max_hp,mana:s.mana,max_mana:s.max_mana,atk:s.atk,def:s.def,speed:s.speed,strength:s.strength||10,dexterity:s.dexterity||10,intelligence:s.intelligence||10,wisdom:s.wisdom||10,vitality:s.vitality||10,luck:s.luck||10,attribute_points:s.attribute_points||0,critical_chance:s.critical_chance||0,critical_damage:s.critical_damage||0,magic_damage_bonus:s.magic_damage_bonus||0,magic_attack:s.magic_attack||0,sword_mastery:s.sword_mastery||1,axe_mastery:s.axe_mastery||1,blunt_mastery:s.blunt_mastery||1,defense_mastery:s.defense_mastery||1,magic_mastery:s.magic_mastery||1,sword_mastery_xp:s.sword_mastery_xp||0,axe_mastery_xp:s.axe_mastery_xp||0,blunt_mastery_xp:s.blunt_mastery_xp||0,defense_mastery_xp:s.defense_mastery_xp||0,magic_mastery_xp:s.magic_mastery_xp||0,base_hp:s.base_hp||s.base_max_hp,base_max_hp:s.base_max_hp,base_mana:s.base_mana||s.base_max_mana,base_max_mana:s.base_max_mana,base_atk:s.base_atk,base_def:s.base_def,base_speed:s.base_speed,equipment_hp_bonus:s.equipment_hp_bonus||0,equipment_mana_bonus:s.equipment_mana_bonus||0,equipment_atk_bonus:s.equipment_atk_bonus||0,equipment_def_bonus:s.equipment_def_bonus||0,equipment_speed_bonus:s.equipment_speed_bonus||0}}}catch(t){return{success:!1,error:t instanceof Error?t.message:"Erro desconhecido",data:null}}}static async getCharacterForGame(e,t=!1,s=!0){try{if(!t){const t=kh.getCachedCharacter(e),s=kh.getCacheTimestamp(e);if(t&&s&&Date.now()-s<3e5){return{success:!0,error:null,data:await Eh(t,e)}}}const{data:r,error:n}=await Es.from("characters").select("*").eq("id",e).maybeSingle();if(n)throw n;if(!r)return{success:!1,error:"Personagem não encontrado",data:null};if(s)try{const t=await gh.applyAutoHeal(r,!0);t.success&&t.data&&t.data.healed&&(r.hp=t.data.newHp,r.mana=t.data.character.mana,kh.invalidateCharacterCache(e))}catch(a){}const i=await Eh(r,e),o={...r,hp:i.hp,max_hp:i.max_hp,mana:i.mana,max_mana:i.max_mana,atk:i.base_atk,def:i.base_def,speed:i.base_speed,critical_chance:i.critical_chance,critical_damage:i.critical_damage};return kh.setCachedCharacter(e,o),{success:!0,error:null,data:i}}catch(r){return{success:!1,error:r instanceof Error?r.message:"Erro desconhecido",data:null}}}static invalidateCharacterCache(e){kh.invalidateCharacterCache(e)}static async debugForceFullHeal(e){try{const t=await this.getCharacter(e);if(!t.success||!t.data)return{success:!1,message:"Personagem não encontrado"};const s=t.data,a=await gh.updateCharacterHpMana(e,s.max_hp,s.max_mana);return a.success?(this.invalidateCharacterCache(e),{success:!0,message:`Cura forçada aplicada: ${s.hp} -> ${s.max_hp} HP, ${s.mana} -> ${s.max_mana} Mana`}):{success:!1,message:a.error||"Erro ao atualizar HP/Mana"}}catch(t){return{success:!1,message:t instanceof Error?t.message:"Erro desconhecido"}}}static getUnlockedCheckpoints=bh.getUnlockedCheckpoints;static startFromCheckpoint=bh.startFromCheckpoint;static resetCharacterProgress=bh.resetCharacterProgress;static updateCharacterFloor=bh.updateCharacterFloor;static updateCharacterHpMana=gh.updateCharacterHpMana;static applyAutoHeal=gh.applyAutoHeal;static forceFullHealForHub=gh.forceFullHealForHub;static updateLastActivity=gh.updateLastActivity;static getUserCharacterProgression=vh.getUserCharacterProgression;static checkCharacterLimit=vh.checkCharacterLimit;static reloadUserProgression=vh.reloadUserProgression;static grantSecureXP=vh.grantSecureXP;static grantSecureGold=vh.grantSecureGold;static addSkillXp=vh.addSkillXp;static updateGold=vh.updateGold;static calculateDerivedStats=yh.calculateDerivedStats;static distributeAttributePoints=jh.distributeAttributePoints;static recalculateCharacterStats=jh.recalculateCharacterStats}const Ph=H,Mh=O,Th=e.forwardRef((({className:e,...s},a)=>t.jsx(V,{ref:a,className:Hs("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",e),...s})));Th.displayName=V.displayName;const qh=e.forwardRef((({className:e,children:s,...a},r)=>t.jsxs(Mh,{children:[t.jsx(Th,{}),t.jsxs(B,{ref:r,className:Hs("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",e),...a,children:[s,t.jsxs(U,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[t.jsx(z,{className:"h-4 w-4"}),t.jsx("span",{className:"sr-only",children:"Close"})]})]})]})));qh.displayName=B.displayName;const Dh=({className:e,...s})=>t.jsx("div",{className:Hs("flex flex-col space-y-1.5 text-center sm:text-left",e),...s});Dh.displayName="DialogHeader";const Rh=({className:e,...s})=>t.jsx("div",{className:Hs("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",e),...s});Rh.displayName="DialogFooter";const Lh=e.forwardRef((({className:e,...s},a)=>t.jsx(G,{ref:a,className:Hs("text-lg font-semibold leading-none tracking-tight",e),...s})));Lh.displayName=G.displayName;const $h=e.forwardRef((({className:e,...s},a)=>t.jsx(Ge,{ref:a,className:Hs("text-sm text-muted-foreground",e),...s})));$h.displayName=Ge.displayName;var Ih="Progress",[Fh,Vh]=we(Ih),[Oh,Bh]=Fh(Ih),Uh=e.forwardRef(((e,s)=>{const{__scopeProgress:a,value:r=null,max:n,getValueLabel:i=Hh,...o}=e;(n||0===n)&&Yh(n);const l=Yh(n)?n:100;null!==r&&Kh(r,l);const c=Kh(r,l)?r:null,d=Wh(c)?i(c,l):void 0;return t.jsx(Oh,{scope:a,value:c,max:l,children:t.jsx(ne.div,{"aria-valuemax":l,"aria-valuemin":0,"aria-valuenow":Wh(c)?c:void 0,"aria-valuetext":d,role:"progressbar","data-state":Xh(c,l),"data-value":c??void 0,"data-max":l,...o,ref:s})})}));Uh.displayName=Ih;var zh="ProgressIndicator",Gh=e.forwardRef(((e,s)=>{const{__scopeProgress:a,...r}=e,n=Bh(zh,a);return t.jsx(ne.div,{"data-state":Xh(n.value,n.max),"data-value":n.value??void 0,"data-max":n.max,...r,ref:s})}));function Hh(e,t){return`${Math.round(e/t*100)}%`}function Xh(e,t){return null==e?"indeterminate":e===t?"complete":"loading"}function Wh(e){return"number"==typeof e}function Yh(e){return Wh(e)&&!isNaN(e)&&e>0}function Kh(e,t){return Wh(e)&&!isNaN(e)&&e<=t&&e>=0}Gh.displayName=zh;var Jh=Uh,Qh=Gh;const Zh=e.forwardRef((({className:e,value:s,...a},r)=>t.jsx(Jh,{ref:r,className:Hs("relative h-2 w-full overflow-hidden rounded-full bg-transparent",e),...a,children:t.jsx(Qh,{className:"h-full w-full flex-1 bg-primary transition-all",style:{transform:`translateX(-${100-(s||0)}%)`}})})));Zh.displayName=Jh.displayName;const ep=L("relative w-full rounded-lg border px-4 py-3 text-sm [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground [&>svg~*]:pl-7",{variants:{variant:{default:"bg-background text-foreground",destructive:"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive"}},defaultVariants:{variant:"default"}}),tp=e.forwardRef((({className:e,variant:s,...a},r)=>t.jsx("div",{ref:r,role:"alert",className:Hs(ep({variant:s}),e),...a})));tp.displayName="Alert";e.forwardRef((({className:e,...s},a)=>t.jsx("h5",{ref:a,className:Hs("mb-1 font-medium leading-none tracking-tight",e),...s}))).displayName="AlertTitle";const sp=e.forwardRef((({className:e,...s},a)=>t.jsx("div",{ref:a,className:Hs("text-sm [&_p]:leading-relaxed",e),...s})));sp.displayName="AlertDescription";const ap=r("/_authenticated/game/play")({component:function(){if("/game/play"===i().pathname)return t.jsx(rp,{});return t.jsx(a,{})}});function rp(){const s=n(),{user:a}=Vs(),[r,i]=e.useState([]),[o,l]=e.useState(null),[c,d]=e.useState([]),[m,u]=e.useState(!0),[h,p]=e.useState(!1),[x,f]=e.useState(""),[g,b]=e.useState({isValid:!0}),[v,y]=e.useState(!1),[N,w]=e.useState(!1),[_,C]=e.useState(null);e.useEffect((()=>{a?.id&&S()}),[a?.id]),e.useEffect((()=>{if(x.trim()){const e=Nh.validateCharacterName(x);if(e.isValid&&r.length>0){const t=r.map((e=>e.name)),s=Nh.formatCharacterName(x);if(Nh.isTooSimilar(s,t)){const e=Nh.generateNameSuggestions(s);b({isValid:!1,error:"Nome muito similar a um personagem existente",suggestions:e})}else b(e)}else b(e)}else b({isValid:!0})}),[x,r]);const S=async()=>{try{u(!0);const e=await Ah.getUserCharacters(a.id);e.success&&e.data&&i(e.data);const t=await Ah.getUserCharacterProgression(a.id);t.success&&t.data&&l(t.data)}catch(e){j.error("Erro ao carregar dados dos personagens")}finally{u(!1)}};e.useEffect((()=>{if(o&&void 0!==r){const e=[];for(let t=1;t<=20;t++){const s=r.find((e=>r.indexOf(e)+1===t))||null,a=t<=o.max_character_slots,n=E(t);e.push({slotNumber:t,character:s,isUnlocked:a,requiredTotalLevel:n})}d(e)}}),[o,r]);const E=e=>e<=3?0:15*(e-3),k=()=>{p(!1),f(""),b({isValid:!0})},A=e=>{const s=(a=e.level,Math.floor(100*Math.pow(1.1,a-1)));var a;const r=e.xp/s*100;return t.jsxs("div",{className:"space-y-2 text-sm",children:[t.jsxs("div",{className:"flex justify-between",children:[t.jsx("span",{children:"Nível:"}),t.jsx("span",{className:"font-medium",children:e.level})]}),t.jsxs("div",{className:"space-y-1",children:[t.jsxs("div",{className:"flex justify-between",children:[t.jsx("span",{children:"XP:"}),t.jsxs("span",{className:"font-medium",children:[e.xp,"/",s]})]}),t.jsx(Zh,{value:r,className:"h-2"})]}),t.jsxs("div",{className:"flex justify-between",children:[t.jsx("span",{children:"Andar Máximo:"}),t.jsx("span",{className:"font-medium",children:e.floor})]}),t.jsxs("div",{className:"flex justify-between",children:[t.jsx("span",{children:"Ouro:"}),t.jsx("span",{className:"font-medium text-yellow-600",children:e.gold})]})]})};return m?t.jsx("div",{className:"container mx-auto p-2 md:p-4",children:t.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:t.jsxs("div",{className:"text-center",children:[t.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary mx-auto mb-4"}),t.jsx("p",{children:"Carregando personagens..."})]})})}):t.jsxs("div",{className:"container mx-auto p-2 md:p-4 max-w-6xl",children:[t.jsxs("div",{className:"flex items-center justify-between mb-4 md:mb-6",children:[t.jsxs("div",{className:"flex items-center gap-4",children:[t.jsxs(Ws,{variant:"ghost",size:"sm",onClick:()=>s({to:"/game"}),children:[t.jsx(Me,{className:"h-4 w-4 mr-2"}),"Voltar"]}),t.jsxs("div",{children:[t.jsx("h1",{className:"text-2xl font-bold",children:"Selecionar Personagem"}),t.jsx("p",{className:"text-muted-foreground",children:"Escolha um personagem para jogar"})]})]}),o&&t.jsxs("div",{className:"text-right",children:[t.jsx("div",{className:"text-sm text-muted-foreground",children:"Progressão Total"}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(Ve,{className:"h-4 w-4"}),t.jsx("span",{className:"font-medium",children:o.total_character_level}),t.jsx("span",{className:"text-muted-foreground",children:"nível"})]}),t.jsxs("div",{className:"text-xs text-muted-foreground",children:[o.max_character_slots,"/",20," slots"]})]})]}),t.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4",children:c.map((e=>{if(!e.isUnlocked)return t.jsx(fu,{className:"opacity-50",children:t.jsxs(yu,{className:"p-4 text-center",children:[t.jsx(Xe,{className:"h-8 w-8 mx-auto mb-2 text-muted-foreground"}),t.jsxs("p",{className:"text-sm text-muted-foreground",children:["Slot ",e.slotNumber]}),t.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:["Requer nível total ",e.requiredTotalLevel]})]})},e.slotNumber);if(!e.character)return t.jsx(fu,{className:"cursor-pointer hover:bg-accent/50 border-dashed",children:t.jsxs(yu,{className:"p-4 text-center",onClick:()=>{p(!0)},children:[t.jsx(We,{className:"h-8 w-8 mx-auto mb-2 text-muted-foreground"}),t.jsx("p",{className:"text-sm text-muted-foreground",children:"Criar Personagem"}),t.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:["Slot ",e.slotNumber]})]})},e.slotNumber);const s=e.character,a=s.hp>0;return t.jsxs(fu,{className:"cursor-pointer hover:bg-accent/50 "+(a?"":"border-red-500/50 bg-red-500/5"),onClick:()=>a&&(e=>{C(e),w(!0)})(s),style:{cursor:a?"pointer":"not-allowed"},children:[t.jsx(gu,{className:"pb-2",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs(bu,{className:"text-base flex items-center gap-2",children:[s.name,!a&&t.jsx(Re,{className:"h-4 w-4 text-red-500"}),s.floor>=100&&t.jsx(Ye,{className:"h-4 w-4 text-yellow-500"})]}),t.jsxs("div",{className:"text-xs text-muted-foreground",children:["Slot ",e.slotNumber]})]})}),t.jsxs(yu,{className:"pt-0",children:[A(s),!a&&t.jsxs(tp,{className:"mt-3 border-red-500/50 bg-red-500/10",children:[t.jsx(Re,{className:"h-4 w-4 text-red-500"}),t.jsx(sp,{className:"text-red-700",children:"Este personagem morreu permanentemente"})]})]})]},e.slotNumber)}))}),t.jsx(Ph,{open:h,onOpenChange:p,children:t.jsxs(qh,{children:[t.jsxs(Dh,{children:[t.jsx(Lh,{children:"Criar Novo Personagem"}),t.jsx($h,{children:"Escolha um nome para seu novo personagem. Lembre-se: a morte é permanente!"})]}),t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{children:[t.jsx(qa,{placeholder:"Nome do personagem",value:x,onChange:e=>f(e.target.value),className:g.isValid?"":"border-red-500"}),!g.isValid&&g.error&&t.jsxs(tp,{className:"mt-2 border-red-500/50 bg-red-500/10",children:[t.jsx(He,{className:"h-4 w-4 text-red-500"}),t.jsx(sp,{className:"text-red-700",children:g.error})]}),g.suggestions&&g.suggestions.length>0&&t.jsxs("div",{className:"mt-2",children:[t.jsx("p",{className:"text-sm text-muted-foreground mb-2",children:"Sugestões:"}),t.jsx("div",{className:"flex flex-wrap gap-2",children:g.suggestions.map(((e,s)=>t.jsx(Ws,{variant:"outline",size:"sm",onClick:()=>(e=>{f(e)})(e),children:e},s)))})]})]}),t.jsxs(tp,{children:[t.jsx(Re,{className:"h-4 w-4"}),t.jsxs(sp,{children:[t.jsx("strong",{children:"Aviso:"})," Este jogo possui morte permanente (permadeath). Se seu personagem morrer, ele será perdido para sempre!"]})]}),t.jsxs("div",{className:"flex justify-end gap-2",children:[t.jsx(Ws,{variant:"outline",onClick:k,children:"Cancelar"}),t.jsx(Ws,{onClick:async()=>{if(a?.id&&x.trim()&&g.isValid){y(!0);try{const e=await Ah.createCharacter({user_id:a.id,name:x.trim()});e.success&&e.data?(j.success("Personagem criado com sucesso!",{description:`${Nh.formatCharacterName(x)} foi criado!`}),await S(),k()):j.error("Erro ao criar personagem",{description:e.error})}catch(e){j.error("Erro ao criar personagem")}finally{y(!1)}}},disabled:!x.trim()||!g.isValid||v,children:v?"Criando...":"Criar Personagem"})]})]})]})}),t.jsx(Ph,{open:N,onOpenChange:w,children:t.jsxs(qh,{children:[t.jsxs(Dh,{children:[t.jsx(Lh,{children:"Confirmar Seleção"}),t.jsxs($h,{children:["Você está prestes a jogar com ",_?.name]})]}),t.jsxs(tp,{children:[t.jsx(Z,{className:"h-4 w-4"}),t.jsxs(sp,{children:[t.jsx("strong",{children:"Lembrete:"})," Este jogo possui morte permanente. Se seu personagem morrer durante a aventura, ele será perdido para sempre!"]})]}),t.jsxs("div",{className:"flex justify-end gap-2",children:[t.jsx(Ws,{variant:"outline",onClick:()=>w(!1),className:"cursor-pointer",children:"Cancelar"}),t.jsxs(Ws,{onClick:async()=>{if(_)try{const e=await Ah.getCharacter(_.id);e.success&&e.data?s({to:"/game/play/hub",search:{character:_.id}}):j.error("Erro ao selecionar personagem",{description:e.error})}catch(e){j.error("Erro ao selecionar personagem")}},className:"cursor-pointer",children:[t.jsx(Ae,{className:"h-4 w-4 mr-2"}),"Confirmar e Jogar"]})]})]})})]})}const np=Ze,ip=e.forwardRef((({className:e,...s},a)=>t.jsx(Ke,{ref:a,className:Hs("inline-flex h-9 items-center justify-center rounded-lg bg-muted p-1 text-muted-foreground",e),...s})));ip.displayName=Ke.displayName;const op=e.forwardRef((({className:e,...s},a)=>t.jsx(Je,{ref:a,className:Hs("inline-flex items-center justify-center whitespace-nowrap rounded-md px-3 py-1 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow",e),...s})));op.displayName=Je.displayName;const lp=e.forwardRef((({className:e,...s},a)=>t.jsx(Qe,{ref:a,className:Hs("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",e),...s})));function cp({className:e,children:s,...a}){return t.jsxs(et,{"data-slot":"scroll-area",className:Hs("relative",e),...a,children:[t.jsx(tt,{"data-slot":"scroll-area-viewport",className:"focus-visible:ring-ring/50 size-full rounded-[inherit] transition-[color,box-shadow] outline-none focus-visible:ring-[3px] focus-visible:outline-1",children:s}),t.jsx(dp,{}),t.jsx(st,{})]})}function dp({className:e,orientation:s="vertical",...a}){return t.jsx(at,{"data-slot":"scroll-area-scrollbar",orientation:s,className:Hs("flex touch-none p-px transition-colors select-none","vertical"===s&&"h-full w-2.5 border-l border-l-transparent","horizontal"===s&&"h-2.5 flex-col border-t border-t-transparent",e),...a,children:t.jsx(rt,{"data-slot":"scroll-area-thumb",className:"bg-border relative flex-1 rounded-full"})})}lp.displayName=Qe.displayName;const mp=r("/_authenticated/game/guide")({component:function(){const e=n();return t.jsxs("div",{className:"container mx-auto p-2 md:p-4 max-w-6xl",children:[t.jsx("div",{className:"flex items-center justify-between mb-4 md:mb-6",children:t.jsxs("div",{className:"flex items-center gap-4",children:[t.jsxs(Ws,{variant:"ghost",size:"sm",onClick:()=>e({to:"/game"}),children:[t.jsx(Me,{className:"h-4 w-4 mr-2"}),"Voltar"]}),t.jsxs("div",{children:[t.jsx("h1",{className:"text-2xl font-bold",children:"Guia do Jogo"}),t.jsx("p",{className:"text-muted-foreground",children:"Aprenda a jogar Tower Trials"})]})]})}),t.jsxs(np,{defaultValue:"basics",className:"w-full",children:[t.jsxs(ip,{className:"grid w-full grid-cols-2 lg:grid-cols-4",children:[t.jsx(op,{value:"basics",children:"Básico"}),t.jsx(op,{value:"combat",children:"Combate"}),t.jsx(op,{value:"progression",children:"Progressão"}),t.jsx(op,{value:"items",children:"Itens"})]}),t.jsx(lp,{value:"basics",children:t.jsx(fu,{className:"p-6",children:t.jsx(cp,{className:"h-[600px] pr-4",children:t.jsxs("section",{className:"space-y-4",children:[t.jsx("h2",{className:"text-2xl font-bold",children:"Conceitos Básicos"}),t.jsxs("div",{className:"space-y-4",children:[t.jsx("h3",{className:"text-xl font-semibold",children:"Sobre o Jogo"}),t.jsx("p",{children:"Tower Trials é um jogo de RPG roguelike onde você sobe uma torre misteriosa, enfrentando monstros cada vez mais fortes a cada andar. Sua missão é subir o máximo possível, fortalecendo seu personagem e coletando equipamentos poderosos."}),t.jsx("h3",{className:"text-xl font-semibold",children:"Personagens"}),t.jsx("p",{children:"Cada jogador pode ter até 3 personagens ativos. Quando um personagem morre, ele é permanentemente deletado (sistema Permadeath). Os personagens possuem os seguintes atributos base:"}),t.jsxs("ul",{className:"list-disc list-inside space-y-2 ml-4",children:[t.jsxs("li",{children:[t.jsx("strong",{children:"HP (Pontos de Vida):"})," Determina quanto dano você pode receber"]}),t.jsxs("li",{children:[t.jsx("strong",{children:"Mana:"})," Recurso usado para lançar magias"]}),t.jsxs("li",{children:[t.jsx("strong",{children:"ATK (Ataque):"})," Determina o dano base dos seus ataques"]}),t.jsxs("li",{children:[t.jsx("strong",{children:"DEF (Defesa):"})," Reduz o dano recebido"]}),t.jsxs("li",{children:[t.jsx("strong",{children:"Speed (Velocidade):"})," Afeta suas chances de fuga e ordem de ações"]})]}),t.jsx("h3",{className:"text-xl font-semibold",children:"A Torre"}),t.jsx("p",{children:"A torre é dividida em andares com diferentes características:"}),t.jsxs("ul",{className:"list-disc list-inside space-y-2 ml-4",children:[t.jsxs("li",{children:[t.jsx("strong",{children:"Andares Comuns:"})," Encontros normais com monstros"]}),t.jsxs("li",{children:[t.jsx("strong",{children:"Andares de Elite (a cada 5 andares):"})," Monstros mais fortes com melhores recompensas"]}),t.jsxs("li",{children:[t.jsx("strong",{children:"Andares de Evento (a cada 7 andares):"})," Eventos especiais e encontros únicos"]}),t.jsxs("li",{children:[t.jsx("strong",{children:"Andares de Chefe (a cada 10 andares):"})," Batalhas desafiadoras contra chefes poderosos"]})]})]})]})})})}),t.jsx(lp,{value:"combat",children:t.jsx(fu,{className:"p-6",children:t.jsx(cp,{className:"h-[600px] pr-4",children:t.jsxs("section",{className:"space-y-4",children:[t.jsx("h2",{className:"text-2xl font-bold",children:"Sistema de Combate"}),t.jsxs("div",{className:"space-y-4",children:[t.jsx("h3",{className:"text-xl font-semibold",children:"Ações de Combate"}),t.jsx("p",{children:"Durante o combate, você pode realizar as seguintes ações:"}),t.jsxs("ul",{className:"list-disc list-inside space-y-2 ml-4",children:[t.jsxs("li",{children:[t.jsx("strong",{children:"Ataque:"})," Causa dano baseado no seu ATK menos a DEF do inimigo"]}),t.jsxs("li",{children:[t.jsx("strong",{children:"Defesa:"})," Aumenta temporariamente sua DEF por um turno"]}),t.jsxs("li",{children:[t.jsx("strong",{children:"Magias:"})," Efeitos variados que consomem Mana"]}),t.jsxs("li",{children:[t.jsx("strong",{children:"Itens:"})," Usar poções e outros consumíveis"]}),t.jsxs("li",{children:[t.jsx("strong",{children:"Fuga:"})," Tenta escapar do combate (chance baseada na velocidade)"]})]}),t.jsx("h3",{className:"text-xl font-semibold",children:"Sistema de Magias"}),t.jsx("p",{children:"As magias são divididas em diferentes tipos de efeito:"}),t.jsxs("ul",{className:"list-disc list-inside space-y-2 ml-4",children:[t.jsxs("li",{children:[t.jsx("strong",{children:"Dano (Damage):"})," Causa dano direto ao inimigo"]}),t.jsxs("li",{children:[t.jsx("strong",{children:"Cura (Heal):"})," Recupera HP"]}),t.jsxs("li",{children:[t.jsx("strong",{children:"Buff:"})," Aumenta temporariamente seus atributos"]}),t.jsxs("li",{children:[t.jsx("strong",{children:"Debuff:"})," Reduz temporariamente os atributos do inimigo"]}),t.jsxs("li",{children:[t.jsx("strong",{children:"DoT (Damage over Time):"})," Causa dano ao longo do tempo"]}),t.jsxs("li",{children:[t.jsx("strong",{children:"HoT (Heal over Time):"})," Cura ao longo do tempo"]})]}),t.jsx("h3",{className:"text-xl font-semibold",children:"Comportamento dos Monstros"}),t.jsx("p",{children:"Os monstros possuem diferentes padrões de comportamento:"}),t.jsxs("ul",{className:"list-disc list-inside space-y-2 ml-4",children:[t.jsxs("li",{children:[t.jsx("strong",{children:"Agressivo:"})," Foca em causar dano"]}),t.jsxs("li",{children:[t.jsx("strong",{children:"Defensivo:"})," Alterna entre ataques e defesa"]}),t.jsxs("li",{children:[t.jsx("strong",{children:"Balanceado:"})," Mistura diferentes estratégias"]})]})]})]})})})}),t.jsx(lp,{value:"progression",children:t.jsx(fu,{className:"p-6",children:t.jsx(cp,{className:"h-[600px] pr-4",children:t.jsxs("section",{className:"space-y-4",children:[t.jsx("h2",{className:"text-2xl font-bold",children:"Progressão"}),t.jsxs("div",{className:"space-y-4",children:[t.jsx("h3",{className:"text-xl font-semibold",children:"Sistema de Níveis"}),t.jsx("p",{children:"Ao derrotar monstros, você ganha XP. A quantidade de XP necessária para subir de nível aumenta em 50% a cada nível. Ao subir de nível:"}),t.jsxs("ul",{className:"list-disc list-inside space-y-2 ml-4",children:[t.jsx("li",{children:"Seus atributos base aumentam"}),t.jsx("li",{children:"HP e Mana são completamente restaurados"}),t.jsx("li",{children:"Você pode desbloquear novas magias"})]}),t.jsx("h3",{className:"text-xl font-semibold",children:"Recompensas"}),t.jsx("p",{children:"Ao derrotar monstros, você pode receber:"}),t.jsxs("ul",{className:"list-disc list-inside space-y-2 ml-4",children:[t.jsxs("li",{children:[t.jsx("strong",{children:"Gold:"})," Usado para comprar equipamentos e consumíveis"]}),t.jsxs("li",{children:[t.jsx("strong",{children:"Drops:"})," Itens que podem ser usados para crafting"]}),t.jsxs("li",{children:[t.jsx("strong",{children:"XP:"})," Para subir de nível"]})]}),t.jsx("h3",{className:"text-xl font-semibold",children:"Checkpoints"}),t.jsx("p",{children:"A cada 10 andares existe um checkpoint. Estes são pontos seguros onde você pode:"}),t.jsxs("ul",{className:"list-disc list-inside space-y-2 ml-4",children:[t.jsx("li",{children:"Salvar seu progresso"}),t.jsx("li",{children:"Retornar ao hub para comprar itens"}),t.jsx("li",{children:"Reorganizar seu equipamento"})]})]})]})})})}),t.jsx(lp,{value:"items",children:t.jsx(fu,{className:"p-6",children:t.jsx(cp,{className:"h-[600px] pr-4",children:t.jsxs("section",{className:"space-y-4",children:[t.jsx("h2",{className:"text-2xl font-bold",children:"Itens e Equipamentos"}),t.jsxs("div",{className:"space-y-4",children:[t.jsx("h3",{className:"text-xl font-semibold",children:"Equipamentos"}),t.jsx("p",{children:"Os equipamentos são divididos em três categorias:"}),t.jsxs("ul",{className:"list-disc list-inside space-y-2 ml-4",children:[t.jsxs("li",{children:[t.jsx("strong",{children:"Armas (Weapons):"})," Aumentam principalmente ATK"]}),t.jsxs("li",{children:[t.jsx("strong",{children:"Armaduras (Armor):"})," Aumentam principalmente DEF"]}),t.jsxs("li",{children:[t.jsx("strong",{children:"Acessórios (Accessory):"})," Efeitos variados"]})]}),t.jsx("p",{children:"E em cinco raridades:"}),t.jsxs("ul",{className:"list-disc list-inside space-y-2 ml-4",children:[t.jsxs("li",{children:[t.jsx("strong",{children:"Comum (Common):"})," Equipamentos básicos"]}),t.jsxs("li",{children:[t.jsx("strong",{children:"Incomum (Uncommon):"})," Melhorias moderadas"]}),t.jsxs("li",{children:[t.jsx("strong",{children:"Raro (Rare):"})," Requer pergaminho especial para desbloquear"]}),t.jsxs("li",{children:[t.jsx("strong",{children:"Épico (Epic):"})," Requer pergaminho épico para desbloquear"]}),t.jsxs("li",{children:[t.jsx("strong",{children:"Lendário (Legendary):"})," Os mais poderosos do jogo"]})]}),t.jsx("h3",{className:"text-xl font-semibold",children:"Consumíveis"}),t.jsx("p",{children:"Existem diferentes tipos de consumíveis:"}),t.jsxs("ul",{className:"list-disc list-inside space-y-2 ml-4",children:[t.jsxs("li",{children:[t.jsx("strong",{children:"Poções:"})," Recuperam HP ou Mana"]}),t.jsxs("li",{children:[t.jsx("strong",{children:"Antídotos:"})," Removem efeitos negativos"]}),t.jsxs("li",{children:[t.jsx("strong",{children:"Elixires:"})," Proporcionam buffs temporários"]}),t.jsxs("li",{children:[t.jsx("strong",{children:"Pergaminhos:"})," Desbloqueiam equipamentos especiais"]})]}),t.jsx("h3",{className:"text-xl font-semibold",children:"Sistema de Crafting"}),t.jsx("p",{children:"Você pode criar itens usando materiais obtidos como drops dos monstros. Alguns consumíveis e equipamentos só podem ser obtidos através de crafting."})]})]})})})})]})]})}});const up=e=>{let t;const s=new Set,a=(e,a)=>{const r="function"==typeof e?e(t):e;if(!Object.is(r,t)){const e=t;t=(null!=a?a:"object"!=typeof r||null===r)?r:Object.assign({},t,r),s.forEach((s=>s(t,e)))}},r=()=>t,n={setState:a,getState:r,getInitialState:()=>i,subscribe:e=>(s.add(e),()=>s.delete(e))},i=t=e(a,r,n);return n},hp=e=>e;const pp=e=>{const t=(e=>e?up(e):up)(e),s=e=>function(e,t=hp){const s=c.useSyncExternalStore(e.subscribe,(()=>t(e.getState())),(()=>t(e.getInitialState())));return c.useDebugValue(s),s}(t,e);return Object.assign(s,t),s},xp=e=>pp,fp={BASE_URL:"/",DEV:!1,MODE:"production",PROD:!0,SSR:!1,VITE_BASE_URL:"http://tower-trials.vercel.app",VITE_ENV:"DEV",VITE_LOGIN_URL:"http://tower-trials.vercel.app/login",VITE_SERVICE_ROLE:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImJrcXpudGxra2JlcHp2b2VzcXhoIiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTc2MTI3MjY1MiwiZXhwIjoyMDc2ODQ4NjUyfQ.lzOfCWvDf9JpqLngMosX1LeG7S-PUmHaXHEDBWvfLuI",VITE_SUPABASE_ANON_KEY:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImJrcXpudGxra2JlcHp2b2VzcXhoIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjEyNzI2NTIsImV4cCI6MjA3Njg0ODY1Mn0.Tr1UdumfKh8k8S6YaLFVS49rfXylQcyaU-O7qpynrK4",VITE_SUPABASE_URL:"https://bkqzntlkkbepzvoesqxh.supabase.co"},gp=new Map,bp=e=>{const t=gp.get(e);return t?Object.fromEntries(Object.entries(t.stores).map((([e,t])=>[e,t.getState()]))):{}},vp=(e,t={})=>(s,a,r)=>{const{enabled:n,anonymousActionType:i,store:o,...l}=t;let c;try{c=(null!=n?n:"production"!==(fp?"production":void 0))&&window.__REDUX_DEVTOOLS_EXTENSION__}catch(x){}if(!c)return e(s,a,r);const{connection:d,...m}=((e,t,s)=>{if(void 0===e)return{type:"untracked",connection:t.connect(s)};const a=gp.get(s.name);if(a)return{type:"tracked",store:e,...a};const r={connection:t.connect(s),stores:{}};return gp.set(s.name,r),{type:"tracked",store:e,...r}})(o,c,l);let u=!0;r.setState=(e,t,n)=>{const c=s(e,t);if(!u)return c;const m=(e=>{var t,s;if(!e)return;const a=e.split("\n"),r=a.findIndex((e=>e.includes("api.setState")));if(r<0)return;const n=(null==(t=a[r+1])?void 0:t.trim())||"";return null==(s=/.+ (.+) .+/.exec(n))?void 0:s[1]})((new Error).stack),h=void 0===n?{type:i||m||"anonymous"}:"string"==typeof n?{type:n}:n;return void 0===o?(null==d||d.send(h,a()),c):(null==d||d.send({...h,type:`${o}/${h.type}`},{...bp(l.name),[o]:r.getState()}),c)},r.devtools={cleanup:()=>{d&&"function"==typeof d.unsubscribe&&d.unsubscribe(),((e,t)=>{if(void 0===t)return;const s=gp.get(e);s&&(delete s.stores[t],0===Object.keys(s.stores).length&&gp.delete(e))})(l.name,o)}};const h=(...e)=>{const t=u;u=!1,s(...e),u=t},p=e(r.setState,a,r);if("untracked"===m.type?null==d||d.init(p):(m.stores[m.store]=r,null==d||d.init(Object.fromEntries(Object.entries(m.stores).map((([e,t])=>[e,e===m.store?p:t.getState()]))))),r.dispatchFromDevtools&&"function"==typeof r.dispatch){let e=!1;const t=r.dispatch;r.dispatch=(...s)=>{"production"===(fp?"production":void 0)||"__setState"!==s[0].type||e||(e=!0),t(...s)}}return d.subscribe((e=>{var t;switch(e.type){case"ACTION":if("string"!=typeof e.payload)return;return yp(e.payload,(e=>{if("__setState"!==e.type)r.dispatchFromDevtools&&"function"==typeof r.dispatch&&r.dispatch(e);else{if(void 0===o)return void h(e.state);Object.keys(e.state).length;const t=e.state[o];if(null==t)return;JSON.stringify(r.getState())!==JSON.stringify(t)&&h(t)}}));case"DISPATCH":switch(e.payload.type){case"RESET":return h(p),void 0===o?null==d?void 0:d.init(r.getState()):null==d?void 0:d.init(bp(l.name));case"COMMIT":return void 0===o?void(null==d||d.init(r.getState())):null==d?void 0:d.init(bp(l.name));case"ROLLBACK":return yp(e.state,(e=>{if(void 0===o)return h(e),void(null==d||d.init(r.getState()));h(e[o]),null==d||d.init(bp(l.name))}));case"JUMP_TO_STATE":case"JUMP_TO_ACTION":return yp(e.state,(e=>{void 0!==o?JSON.stringify(r.getState())!==JSON.stringify(e[o])&&h(e[o]):h(e)}));case"IMPORT_STATE":{const{nextLiftedState:s}=e.payload,a=null==(t=s.computedStates.slice(-1)[0])?void 0:t.state;if(!a)return;return h(void 0===o?a:a[o]),void(null==d||d.send(null,s))}case"PAUSE_RECORDING":return u=!u}return}})),p},yp=(e,t)=>{let s;try{s=JSON.parse(e)}catch(a){}void 0!==s&&t(s)},jp=e=>(t,s,a)=>{const r=a.subscribe;a.subscribe=(e,t,s)=>{let n=e;if(t){const r=(null==s?void 0:s.equalityFn)||Object.is;let i=e(a.getState());n=s=>{const a=e(s);if(!r(i,a)){const e=i;t(i=a,e)}},(null==s?void 0:s.fireImmediately)&&t(i,i)}return r(n)};return e(t,s,a)};function Np(e,t){let s;try{s=e()}catch(a){return}return{getItem:e=>{var t;const a=e=>null===e?null:JSON.parse(e,void 0),r=null!=(t=s.getItem(e))?t:null;return r instanceof Promise?r.then(a):a(r)},setItem:(e,t)=>s.setItem(e,JSON.stringify(t,void 0)),removeItem:e=>s.removeItem(e)}}const wp=e=>t=>{try{const s=e(t);return s instanceof Promise?s:{then:e=>wp(e)(s),catch(e){return this}}}catch(s){return{then(e){return this},catch:e=>wp(e)(s)}}},_p=(e,t)=>(s,a,r)=>{let n={storage:Np((()=>localStorage)),partialize:e=>e,version:0,merge:(e,t)=>({...t,...e}),...t},i=!1;const o=new Set,l=new Set;let c=n.storage;if(!c)return e(((...e)=>{s(...e)}),a,r);const d=()=>{const e=n.partialize({...a()});return c.setItem(n.name,{state:e,version:n.version})},m=r.setState;r.setState=(e,t)=>{m(e,t),d()};const u=e(((...e)=>{s(...e),d()}),a,r);let h;r.getInitialState=()=>u;const p=()=>{var e,t;if(!c)return;i=!1,o.forEach((e=>{var t;return e(null!=(t=a())?t:u)}));const r=(null==(t=n.onRehydrateStorage)?void 0:t.call(n,null!=(e=a())?e:u))||void 0;return wp(c.getItem.bind(c))(n.name).then((e=>{if(e){if("number"!=typeof e.version||e.version===n.version)return[!1,e.state];if(n.migrate){const t=n.migrate(e.state,e.version);return t instanceof Promise?t.then((e=>[!0,e])):[!0,t]}}return[!1,void 0]})).then((e=>{var t;const[r,i]=e;if(h=n.merge(i,null!=(t=a())?t:u),s(h,!0),r)return d()})).then((()=>{null==r||r(h,void 0),h=a(),i=!0,l.forEach((e=>e(h)))})).catch((e=>{null==r||r(void 0,e)}))};return r.persist={setOptions:e=>{n={...n,...e},e.storage&&(c=e.storage)},clearStorage:()=>{null==c||c.removeItem(n.name)},getOptions:()=>n,rehydrate:()=>p(),hasHydrated:()=>i,onHydrate:e=>(o.add(e),()=>{o.delete(e)}),onFinishHydration:e=>(l.add(e),()=>{l.delete(e)})},n.skipHydration||p(),h||u};var Cp=Symbol.for("immer-nothing"),Sp=Symbol.for("immer-draftable"),Ep=Symbol.for("immer-state");function kp(e,...t){throw new Error(`[Immer] minified error nr: ${e}. Full error at: https://bit.ly/3cXEKWf`)}var Ap=Object.getPrototypeOf;function Pp(e){return!!e&&!!e[Ep]}function Mp(e){return!!e&&(qp(e)||Array.isArray(e)||!!e[Sp]||!!e.constructor?.[Sp]||Ip(e)||Fp(e))}var Tp=Object.prototype.constructor.toString();function qp(e){if(!e||"object"!=typeof e)return!1;const t=Ap(e);if(null===t)return!0;const s=Object.hasOwnProperty.call(t,"constructor")&&t.constructor;return s===Object||"function"==typeof s&&Function.toString.call(s)===Tp}function Dp(e,t){0===Rp(e)?Reflect.ownKeys(e).forEach((s=>{t(s,e[s],e)})):e.forEach(((s,a)=>t(a,s,e)))}function Rp(e){const t=e[Ep];return t?t.type_:Array.isArray(e)?1:Ip(e)?2:Fp(e)?3:0}function Lp(e,t){return 2===Rp(e)?e.has(t):Object.prototype.hasOwnProperty.call(e,t)}function $p(e,t,s){const a=Rp(e);2===a?e.set(t,s):3===a?e.add(s):e[t]=s}function Ip(e){return e instanceof Map}function Fp(e){return e instanceof Set}function Vp(e){return e.copy_||e.base_}function Op(e,t){if(Ip(e))return new Map(e);if(Fp(e))return new Set(e);if(Array.isArray(e))return Array.prototype.slice.call(e);const s=qp(e);if(!0===t||"class_only"===t&&!s){const t=Object.getOwnPropertyDescriptors(e);delete t[Ep];let s=Reflect.ownKeys(t);for(let a=0;a<s.length;a++){const r=s[a],n=t[r];!1===n.writable&&(n.writable=!0,n.configurable=!0),(n.get||n.set)&&(t[r]={configurable:!0,writable:!0,enumerable:n.enumerable,value:e[r]})}return Object.create(Ap(e),t)}{const t=Ap(e);if(null!==t&&s)return{...e};const a=Object.create(t);return Object.assign(a,e)}}function Bp(e,t=!1){return zp(e)||Pp(e)||!Mp(e)||(Rp(e)>1&&(e.set=e.add=e.clear=e.delete=Up),Object.freeze(e),t&&Object.entries(e).forEach((([e,t])=>Bp(t,!0)))),e}function Up(){kp(2)}function zp(e){return Object.isFrozen(e)}var Gp,Hp={};function Xp(e){const t=Hp[e];return t||kp(0),t}function Wp(){return Gp}function Yp(e,t){t&&(Xp("Patches"),e.patches_=[],e.inversePatches_=[],e.patchListener_=t)}function Kp(e){Jp(e),e.drafts_.forEach(Zp),e.drafts_=null}function Jp(e){e===Gp&&(Gp=e.parent_)}function Qp(e){return Gp={drafts_:[],parent_:Gp,immer_:e,canAutoFreeze_:!0,unfinalizedDrafts_:0}}function Zp(e){const t=e[Ep];0===t.type_||1===t.type_?t.revoke_():t.revoked_=!0}function ex(e,t){t.unfinalizedDrafts_=t.drafts_.length;const s=t.drafts_[0];return void 0!==e&&e!==s?(s[Ep].modified_&&(Kp(t),kp(4)),Mp(e)&&(e=tx(t,e),t.parent_||ax(t,e)),t.patches_&&Xp("Patches").generateReplacementPatches_(s[Ep].base_,e,t.patches_,t.inversePatches_)):e=tx(t,s,[]),Kp(t),t.patches_&&t.patchListener_(t.patches_,t.inversePatches_),e!==Cp?e:void 0}function tx(e,t,s){if(zp(t))return t;const a=t[Ep];if(!a)return Dp(t,((r,n)=>sx(e,a,t,r,n,s))),t;if(a.scope_!==e)return t;if(!a.modified_)return ax(e,a.base_,!0),a.base_;if(!a.finalized_){a.finalized_=!0,a.scope_.unfinalizedDrafts_--;const t=a.copy_;let r=t,n=!1;3===a.type_&&(r=new Set(t),t.clear(),n=!0),Dp(r,((r,i)=>sx(e,a,t,r,i,s,n))),ax(e,t,!1),s&&e.patches_&&Xp("Patches").generatePatches_(a,s,e.patches_,e.inversePatches_)}return a.copy_}function sx(e,t,s,a,r,n,i){if(Pp(r)){const i=tx(e,r,n&&t&&3!==t.type_&&!Lp(t.assigned_,a)?n.concat(a):void 0);if($p(s,a,i),!Pp(i))return;e.canAutoFreeze_=!1}else i&&s.add(r);if(Mp(r)&&!zp(r)){if(!e.immer_.autoFreeze_&&e.unfinalizedDrafts_<1)return;tx(e,r),t&&t.scope_.parent_||"symbol"==typeof a||!Object.prototype.propertyIsEnumerable.call(s,a)||ax(e,r)}}function ax(e,t,s=!1){!e.parent_&&e.immer_.autoFreeze_&&e.canAutoFreeze_&&Bp(t,s)}var rx={get(e,t){if(t===Ep)return e;const s=Vp(e);if(!Lp(s,t))return function(e,t,s){const a=ox(t,s);return a?"value"in a?a.value:a.get?.call(e.draft_):void 0}(e,s,t);const a=s[t];return e.finalized_||!Mp(a)?a:a===ix(e.base_,t)?(cx(e),e.copy_[t]=dx(a,e)):a},has:(e,t)=>t in Vp(e),ownKeys:e=>Reflect.ownKeys(Vp(e)),set(e,t,s){const a=ox(Vp(e),t);if(a?.set)return a.set.call(e.draft_,s),!0;if(!e.modified_){const a=ix(Vp(e),t),r=a?.[Ep];if(r&&r.base_===s)return e.copy_[t]=s,e.assigned_[t]=!1,!0;if(function(e,t){return e===t?0!==e||1/e==1/t:e!=e&&t!=t}(s,a)&&(void 0!==s||Lp(e.base_,t)))return!0;cx(e),lx(e)}return e.copy_[t]===s&&(void 0!==s||t in e.copy_)||Number.isNaN(s)&&Number.isNaN(e.copy_[t])||(e.copy_[t]=s,e.assigned_[t]=!0),!0},deleteProperty:(e,t)=>(void 0!==ix(e.base_,t)||t in e.base_?(e.assigned_[t]=!1,cx(e),lx(e)):delete e.assigned_[t],e.copy_&&delete e.copy_[t],!0),getOwnPropertyDescriptor(e,t){const s=Vp(e),a=Reflect.getOwnPropertyDescriptor(s,t);return a?{writable:!0,configurable:1!==e.type_||"length"!==t,enumerable:a.enumerable,value:s[t]}:a},defineProperty(){kp(11)},getPrototypeOf:e=>Ap(e.base_),setPrototypeOf(){kp(12)}},nx={};function ix(e,t){const s=e[Ep];return(s?Vp(s):e)[t]}function ox(e,t){if(!(t in e))return;let s=Ap(e);for(;s;){const e=Object.getOwnPropertyDescriptor(s,t);if(e)return e;s=Ap(s)}}function lx(e){e.modified_||(e.modified_=!0,e.parent_&&lx(e.parent_))}function cx(e){e.copy_||(e.copy_=Op(e.base_,e.scope_.immer_.useStrictShallowCopy_))}Dp(rx,((e,t)=>{nx[e]=function(){return arguments[0]=arguments[0][0],t.apply(this,arguments)}})),nx.deleteProperty=function(e,t){return nx.set.call(this,e,t,void 0)},nx.set=function(e,t,s){return rx.set.call(this,e[0],t,s,e[0])};function dx(e,t){const s=Ip(e)?Xp("MapSet").proxyMap_(e,t):Fp(e)?Xp("MapSet").proxySet_(e,t):function(e,t){const s=Array.isArray(e),a={type_:s?1:0,scope_:t?t.scope_:Wp(),modified_:!1,finalized_:!1,assigned_:{},parent_:t,base_:e,draft_:null,copy_:null,revoke_:null,isManual_:!1};let r=a,n=rx;s&&(r=[a],n=nx);const{revoke:i,proxy:o}=Proxy.revocable(r,n);return a.draft_=o,a.revoke_=i,o}(e,t);return(t?t.scope_:Wp()).drafts_.push(s),s}function mx(e){if(!Mp(e)||zp(e))return e;const t=e[Ep];let s;if(t){if(!t.modified_)return t.base_;t.finalized_=!0,s=Op(e,t.scope_.immer_.useStrictShallowCopy_)}else s=Op(e,!0);return Dp(s,((e,t)=>{$p(s,e,mx(t))})),t&&(t.finalized_=!1),s}var ux=new class{constructor(e){this.autoFreeze_=!0,this.useStrictShallowCopy_=!1,this.produce=(e,t,s)=>{if("function"==typeof e&&"function"!=typeof t){const s=t;t=e;const a=this;return function(e=s,...r){return a.produce(e,(e=>t.call(this,e,...r)))}}let a;if("function"!=typeof t&&kp(6),void 0!==s&&"function"!=typeof s&&kp(7),Mp(e)){const r=Qp(this),n=dx(e,void 0);let i=!0;try{a=t(n),i=!1}finally{i?Kp(r):Jp(r)}return Yp(r,s),ex(a,r)}if(!e||"object"!=typeof e){if(a=t(e),void 0===a&&(a=e),a===Cp&&(a=void 0),this.autoFreeze_&&Bp(a,!0),s){const t=[],r=[];Xp("Patches").generateReplacementPatches_(e,a,t,r),s(t,r)}return a}kp(1)},this.produceWithPatches=(e,t)=>{if("function"==typeof e)return(t,...s)=>this.produceWithPatches(t,(t=>e(t,...s)));let s,a;const r=this.produce(e,t,((e,t)=>{s=e,a=t}));return[r,s,a]},"boolean"==typeof e?.autoFreeze&&this.setAutoFreeze(e.autoFreeze),"boolean"==typeof e?.useStrictShallowCopy&&this.setUseStrictShallowCopy(e.useStrictShallowCopy)}createDraft(e){Mp(e)||kp(8),Pp(e)&&(e=function(e){Pp(e)||kp(10);return mx(e)}(e));const t=Qp(this),s=dx(e,void 0);return s[Ep].isManual_=!0,Jp(t),s}finishDraft(e,t){const s=e&&e[Ep];s&&s.isManual_||kp(9);const{scope_:a}=s;return Yp(a,t),ex(void 0,a)}setAutoFreeze(e){this.autoFreeze_=e}setUseStrictShallowCopy(e){this.useStrictShallowCopy_=e}applyPatches(e,t){let s;for(s=t.length-1;s>=0;s--){const a=t[s];if(0===a.path.length&&"replace"===a.op){e=a.value;break}}s>-1&&(t=t.slice(s+1));const a=Xp("Patches").applyPatches_;return Pp(e)?a(e,t):this.produce(e,(e=>a(e,t)))}},hx=ux.produce;ux.produceWithPatches.bind(ux),ux.setAutoFreeze.bind(ux),ux.setUseStrictShallowCopy.bind(ux),ux.applyPatches.bind(ux),ux.createDraft.bind(ux),ux.finishDraft.bind(ux);const px={mode:"menu",player:null,currentEnemy:null,currentFloor:null,isPlayerTurn:!0,gameMessage:"",highestFloor:1,selectedSpell:null,battleRewards:null},xx=xp()(jp((e=>({gameState:px,loading:{loadProgress:!1,startGame:!1,performAction:!1,saveProgress:!1},error:null,setGameState:t=>{e(hx((e=>{e.gameState=t})))},updateGameState:t=>{e(hx((e=>{t(e.gameState)})))},resetGameState:()=>{e(hx((e=>{e.gameState=structuredClone(px),e.error=null})))},updateLoading:(t,s)=>{e(hx((e=>{e.loading[t]=s})))},setAllLoading:t=>{e(hx((e=>{e.loading=t})))},setError:t=>{e(hx((e=>{e.error=t}))),t&&j.error("Erro",{description:t})},resetError:()=>{e(hx((e=>{e.error=null})))},setGameMode:t=>{e(hx((e=>{e.gameState.mode=t})))},setGameMessage:t=>{e(hx((e=>{e.gameState.gameMessage=t})))},setPlayerTurn:t=>{e(hx((e=>{e.gameState.isPlayerTurn=t})))},updatePlayerStats:(t,s)=>{e(hx((e=>{e.gameState.player&&(e.gameState.player.hp=Math.max(0,t),e.gameState.player.mana=Math.max(0,s))})))},updatePlayerGold:t=>{e(hx((e=>{e.gameState.player&&(e.gameState.player.gold=Math.max(0,t))})))},updatePlayerFloor:t=>{e(hx((e=>{e.gameState.player&&(e.gameState.player.floor=t,e.gameState.highestFloor=Math.max(e.gameState.highestFloor,t))})))}})))),fx={types:new Set(["system","battle","lore","skill_xp","level_up","equipment","enemy_action","player_action","damage","healing"]),categories:new Set(["game"])},gx={gameMessage:"",gameLogs:[],debugLogs:[],maxGameLogs:1e3,maxDebugLogs:500,enableDebugLogs:!1,currentFilter:fx,filteredLogs:[],logStats:{totalLogsToday:0,lastLogTime:null,logsByType:{system:0,battle:0,lore:0,skill_xp:0,level_up:0,equipment:0,enemy_action:0,player_action:0,damage:0,healing:0}},isLogVisible:!0,autoScroll:!0},bx=()=>`log-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,vx=e=>{if(e instanceof Date&&!isNaN(e.getTime()))return e;if("string"==typeof e||"number"==typeof e){const t=new Date(e);if(!isNaN(t.getTime()))return t}return new Date},yx=e=>({id:e.id||bx(),text:e.text||"",type:e.type||"system",category:e.category||"game",metadata:e.metadata?{...e.metadata}:{},timestamp:vx(e.timestamp)}),jx=xp()(vp(_p(((e,t)=>({...gx,addGameLogMessage:(s,a="system",r={})=>{if(t().gameLogs.slice(-5).some((e=>e.text===s&&e.type===a)))return;const n={id:bx(),text:s,type:a,timestamp:vx(new Date),category:"game",metadata:r?{...r}:{}};e(hx((e=>{var t,s;e.gameLogs.push(n),e.gameLogs.length>e.maxGameLogs&&(e.gameLogs=e.gameLogs.slice(-e.maxGameLogs)),e.logStats.lastLogTime=n.timestamp,e.logStats.logsByType[a]++,e.logStats.lastLogTime&&(t=e.logStats.lastLogTime,s=n.timestamp,t.toDateString()===s.toDateString())?e.logStats.totalLogsToday++:e.logStats.totalLogsToday=1}))),t().applyFilter()},addDebugLog:(s,a,r={})=>{if(!t().enableDebugLogs)return;const n={id:bx(),text:`[${a.toUpperCase()}] ${s}`,type:"system",timestamp:vx(new Date),category:"debug",metadata:{level:a,...r?{...r}:{}}};e(hx((e=>{e.debugLogs.push(n),e.debugLogs.length>e.maxDebugLogs&&(e.debugLogs=e.debugLogs.slice(-e.maxDebugLogs))}))),t().applyFilter()},setGameMessage:t=>{e({gameMessage:t})},clearGameLogs:()=>{e(hx((e=>{e.gameLogs=[],e.logStats.logsByType={system:0,battle:0,lore:0,skill_xp:0,level_up:0,equipment:0,enemy_action:0,player_action:0,damage:0,healing:0}}))),t().applyFilter()},clearDebugLogs:()=>{e({debugLogs:[]}),t().applyFilter()},clearAllLogs:()=>{t().clearGameLogs(),t().clearDebugLogs()},removeLogs:s=>{e(hx((e=>{e.gameLogs=e.gameLogs.filter((e=>!s.includes(e.id))),e.debugLogs=e.debugLogs.filter((e=>!s.includes(e.id)))}))),t().applyFilter()},setFilter:s=>{e(hx((e=>{Object.assign(e.currentFilter,s)}))),t().applyFilter()},resetFilter:()=>{e({currentFilter:fx}),t().applyFilter()},applyFilter:()=>{const s=t(),{currentFilter:a,gameLogs:r,debugLogs:n}=s,i=[...r.filter((()=>a.categories.has("game"))),...s.enableDebugLogs?n.filter((()=>a.categories.has("debug"))):[]].filter((e=>{const t=vx(e.timestamp);if(!a.types.has(e.type))return!1;if(a.timeRange){const e=t.getTime(),s=a.timeRange.start.getTime(),r=a.timeRange.end.getTime();if(e<s||e>r)return!1}if(a.searchTerm){const t=a.searchTerm.toLowerCase();return e.text.toLowerCase().includes(t)}return!0})).map((e=>({...e,timestamp:vx(e.timestamp)})));i.sort(((e,t)=>t.timestamp.getTime()-e.timestamp.getTime())),e({filteredLogs:i})},searchLogs:e=>{t().setFilter({searchTerm:e})},setMaxGameLogs:t=>{e({maxGameLogs:Math.max(10,Math.min(1e4,t))})},setMaxDebugLogs:t=>{e({maxDebugLogs:Math.max(10,Math.min(5e3,t))})},toggleDebugLogs:()=>{e(hx((e=>{e.enableDebugLogs=!e.enableDebugLogs,e.enableDebugLogs?e.currentFilter.categories.add("debug"):e.currentFilter.categories.delete("debug")}))),t().applyFilter()},setAutoScroll:t=>{e({autoScroll:t})},toggleLogVisibility:()=>{e(hx((e=>{e.isLogVisible=!e.isLogVisible})))},exportLogs:e=>{const s=t(),a=e?s.filteredLogs.filter((t=>t.category===e)):s.filteredLogs,r={exportedAt:(new Date).toISOString(),category:e,logs:a,stats:s.logStats};return JSON.stringify(r,null,2)},importLogs:s=>{try{const a=JSON.parse(s);return!(!a.logs||!Array.isArray(a.logs))&&(e(hx((e=>{for(const t of a.logs){const s=yx(t);"game"===s.category?e.gameLogs.push(s):"debug"===s.category&&e.enableDebugLogs&&e.debugLogs.push(s)}e.gameLogs.length>e.maxGameLogs&&(e.gameLogs=e.gameLogs.slice(-e.maxGameLogs)),e.debugLogs.length>e.maxDebugLogs&&(e.debugLogs=e.debugLogs.slice(-e.maxDebugLogs))}))),t().applyFilter(),!0)}catch(a){return!1}},getLogsByType:e=>{const s=t();return[...s.gameLogs,...s.debugLogs].filter((t=>t.type===e))},getLogsByCategory:e=>{const s=t();return"game"===e?s.gameLogs:"debug"===e?s.debugLogs:[]}})),{name:"log-store",partialize:e=>({gameLogs:e.gameLogs.slice(-100),maxGameLogs:e.maxGameLogs,enableDebugLogs:e.enableDebugLogs,autoScroll:e.autoScroll,logStats:e.logStats}),onRehydrateStorage:()=>e=>{if(e)try{e.gameLogs&&Array.isArray(e.gameLogs)?e.gameLogs=e.gameLogs.map((e=>yx(e))):e.gameLogs=[],e.debugLogs&&Array.isArray(e.debugLogs)?e.debugLogs=e.debugLogs.map((e=>yx(e))):e.debugLogs=[],e.logStats?.lastLogTime&&(e.logStats.lastLogTime=vx(e.logStats.lastLogTime)),e.filteredLogs=[]}catch(t){e.gameLogs=[],e.debugLogs=[],e.filteredLogs=[]}},version:1}),{name:"log-store"})),Nx=()=>{const t=jx(),s=e.useCallback(((e,s,a)=>{t.addGameLogMessage(e,s,a)}),[t.addGameLogMessage]),a=e.useCallback((e=>{t.setGameMessage(e)}),[t.setGameMessage]),r=e.useCallback((()=>{t.clearGameLogs()}),[t.clearGameLogs]),n=e.useCallback((e=>{t.searchLogs(e)}),[t.searchLogs]),i=e.useCallback((e=>{t.setFilter(e)}),[t.setFilter]),o=e.useCallback((()=>{t.toggleLogVisibility()}),[t.toggleLogVisibility]);return{gameMessage:t.gameMessage,gameLog:t.filteredLogs.map((e=>({text:e.text,type:e.type}))),addGameLogMessage:s,setGameMessage:a,clearGameLogs:r,searchLogs:n,setFilter:i,logStats:t.logStats,isLogVisible:t.isLogVisible,toggleLogVisibility:o}},wx=xp()(jp(_p(((e,t)=>({characters:[],hasLoadedCharacters:!1,isLoading:!1,currentUserId:null,selectedCharacterId:null,selectedCharacterName:null,selectedCharacter:null,cacheTimestamps:{},cacheDurations:{character:3e4,userList:15e3},lastUserListFetch:null,loadCharacters:async(s,a)=>{const r=t();if(r.currentUserId!==s&&e(hx((e=>{e.characters=[],e.hasLoadedCharacters=!1,e.currentUserId=s,e.isLoading=!1,e.selectedCharacterId&&(e.selectedCharacterId=null,e.selectedCharacterName=null,e.selectedCharacter=null)}))),s&&!r.hasLoadedCharacters&&!r.isLoading){!1===r.selectedCharacter?.is_alive&&e(hx((e=>{e.selectedCharacterId=null,e.selectedCharacterName=null,e.selectedCharacter=null})));try{e(hx((e=>{e.isLoading=!0})));const t=await Ah.getUserCharacters(s);if(t.success&&t.data){const s=Date.now();e(hx((e=>{if(e.characters=t.data,e.hasLoadedCharacters=!0,e.lastUserListFetch=s,t.data.forEach((t=>{e.cacheTimestamps[t.id]=s})),e.selectedCharacterId){const s=t.data.find((t=>t.id===e.selectedCharacterId));s?(e.selectedCharacter=s,e.selectedCharacterName=s.name):(e.selectedCharacterId=null,e.selectedCharacterName=null,e.selectedCharacter=null)}})));const r=a||(()=>{});t.data.length>0?r("Selecione um personagem para jogar!"):r("Você ainda não tem personagens. Crie um para começar!")}else t.error&&j.error("Erro",{description:t.error})}catch(n){j.error("Erro",{description:n instanceof Error?n.message:"Erro ao carregar personagens"})}finally{e(hx((e=>{e.isLoading=!1})))}}},createCharacter:async(t,s,a)=>{if(s){e(hx((e=>{e.isLoading=!0})));try{const r=await Ah.createCharacter({user_id:s,name:t});if(r.success&&r.data){const r=await Ah.getUserCharacters(s);if(r.success&&r.data){e(hx((e=>{e.characters=r.data})));const s=r.data.find((e=>e.name===t));s&&(j.success("Sucesso",{description:"Personagem criado com sucesso!"}),a?.(`${s.name} foi criado!`))}}else if(r.error)throw new Error(r.error)}catch(r){j.error("Erro",{description:r instanceof Error?r.message:"Erro ao criar personagem"})}finally{e(hx((e=>{e.isLoading=!1})))}}else j.error("Erro",{description:"Você precisa estar logado para criar um personagem."})},reloadCharacters:()=>{e(hx((e=>{e.hasLoadedCharacters=!1})))},selectCharacter:(t,s)=>{e(hx((e=>{e.selectedCharacterId=t,e.selectedCharacterName=s;const a=e.characters.find((e=>e.id===t));e.selectedCharacter=a||null})))},clearSelection:()=>{e(hx((e=>{e.selectedCharacterId=null,e.selectedCharacterName=null,e.selectedCharacter=null})))},setSelectedCharacter:t=>{e(hx((e=>{e.selectedCharacter=t})))},loadSelectedCharacter:async t=>{try{const s=await Ah.getCharacter(t);s.success&&s.data&&e(hx((e=>{e.selectedCharacter=s.data;const a=e.characters.findIndex((e=>e.id===t));-1!==a&&(e.characters[a]=s.data)})))}catch(s){}},getCachedCharacter:e=>{const s=t(),a=s.characters.find((t=>t.id===e));return a?s.isCacheValid(e)?a:null:s.selectedCharacter?.id===e?s.selectedCharacter:null},isCacheValid:e=>{const s=t(),a=s.cacheTimestamps[e];if(!a)return!1;return Date.now()-a<=s.cacheDurations.character},isUserListCacheValid:()=>{const e=t();if(!e.lastUserListFetch)return!1;return Date.now()-e.lastUserListFetch<=e.cacheDurations.userList},invalidateCharacterCache:t=>{e(hx((e=>{delete e.cacheTimestamps[t]})))},invalidateUserListCache:()=>{e(hx((e=>{e.lastUserListFetch=null,e.hasLoadedCharacters=!1})))},invalidateAllCache:()=>{e(hx((e=>{e.cacheTimestamps={},e.lastUserListFetch=null,e.hasLoadedCharacters=!1})))},reset:()=>{e(hx((e=>{e.characters=[],e.hasLoadedCharacters=!1,e.isLoading=!1,e.currentUserId=null,e.selectedCharacterId=null,e.selectedCharacterName=null,e.selectedCharacter=null,e.cacheTimestamps={},e.lastUserListFetch=null})))},resetForUser:t=>{e(hx((e=>{e.characters=[],e.hasLoadedCharacters=!1,e.isLoading=!1,e.currentUserId=t,e.selectedCharacterId=null,e.selectedCharacterName=null,e.selectedCharacter=null,e.cacheTimestamps={},e.lastUserListFetch=null})))}})),{name:"character-storage",storage:Np((()=>localStorage)),partialize:e=>({selectedCharacterId:e.selectedCharacterId,selectedCharacterName:e.selectedCharacterName})})));function _x(){const{user:t}=Vs(),{addGameLogMessage:s,setGameMessage:a}=Nx(),{characters:r,hasLoadedCharacters:n,isLoading:i,currentUserId:o,selectedCharacterId:l,selectedCharacterName:c,selectedCharacter:d,loadCharacters:m,createCharacter:u,reloadCharacters:h,selectCharacter:p,clearSelection:x,loadSelectedCharacter:f,setSelectedCharacter:g,reset:b,resetForUser:v}=wx(),y=e.useCallback(((e,t)=>m(e,t)),[m]),j=e.useCallback(((e,t,s)=>u(e,t,s)),[u]);return e.useEffect((()=>{t?.id?m(t.id,a):b()}),[t?.id,m,a,b]),{characters:r,hasLoadedCharacters:n,isLoading:i,currentUserId:o,selectedCharacterId:l,selectedCharacterName:c,selectedCharacter:d,loadCharacters:y,reloadCharacters:h,selectCharacter:p,clearSelection:x,loadSelectedCharacter:f,setSelectedCharacter:g,reset:b,resetForUser:v,user:t,createCharacter:e.useCallback((e=>t?.id?j(e,t.id,s):Promise.resolve()),[t?.id,j,s])}}function Cx(){const t=wx((e=>e.selectedCharacterId)),s=wx((e=>e.selectedCharacterName)),a=wx((e=>e.selectedCharacter)),r=wx((e=>e.selectCharacter)),n=wx((e=>e.clearSelection)),i=wx((e=>e.loadSelectedCharacter));return e.useEffect((()=>{t&&!a&&i(t)}),[t,a,i]),{selectedCharacterId:t,selectedCharacterName:s,selectedCharacter:a,selectCharacter:r,clearSelection:n,loadSelectedCharacter:i}}function Sx(){const e=_x(),t=Cx();return{characters:e.characters,hasLoadedCharacters:e.hasLoadedCharacters,isLoading:e.isLoading,selectedCharacterId:t.selectedCharacterId,selectedCharacterName:t.selectedCharacterName,selectedCharacter:t.selectedCharacter,createCharacter:e.createCharacter,reloadCharacters:e.reloadCharacters,selectCharacter:t.selectCharacter,clearSelection:t.clearSelection,reset:e.reset,user:e.user}}const Ex=Object.freeze(Object.defineProperty({__proto__:null,useCharacterManagement:Sx,useCharacterSelectionWithCache:Cx,useCharacterStore:wx,useCharacterWithAuth:_x},Symbol.toStringTag,{value:"Module"}));function kx(){const t=xx((e=>e.setGameState)),s=wx((e=>e.selectCharacter)),a=e.useRef(!1);return{loadCharacterForHub:e.useCallback((async e=>{if(!a.current)try{a.current=!0;const r=await Ah.getCharacterForGame(e.id,!1,!0);if(!r.success||!r.data)throw new Error(r.error||"Erro ao carregar dados do personagem");const n=r.data;s(e.id,e.name);const i={mode:"hub",player:n,currentFloor:null,currentEnemy:null,isPlayerTurn:!0,gameMessage:`Bem-vindo ao hub, ${n.name}!`,highestFloor:Math.max(1,n.floor),selectedSpell:null,battleRewards:null,fleeSuccessful:!1,characterDeleted:!1};t(i)}catch(r){throw j.error("Erro",{description:r instanceof Error?r.message:"Erro ao carregar personagem"}),r}finally{a.current=!1}}),[t,s])}}const Ax=({isOpen:s,onClose:a,character:r,onStartFromCheckpoint:n})=>{const[i,o]=e.useState([]),[l,c]=e.useState(!1),[d,m]=e.useState(null);e.useEffect((()=>{s&&u()}),[s,r.id]);const u=async()=>{c(!0);try{const e=await Ah.getUnlockedCheckpoints(r.id);if(e.success&&e.data){if(o(e.data),e.data.length>0){const t=e.data.find((e=>e.floor===r.floor)),s=t?t.floor:e.data[e.data.length-1].floor;m(s)}}else j.error("Erro ao carregar checkpoints",{description:e.error})}catch(e){j.error("Erro ao carregar checkpoints")}finally{c(!1)}},h=e=>1===e?t.jsx(it,{className:"h-5 w-5"}):5===e||e>=20&&e%10==0?t.jsx(Ye,{className:"h-5 w-5"}):t.jsx(nt,{className:"h-5 w-5"}),p=e=>1===e?"Início da aventura":5===e?"Primeiro Desafio":e>=20&&e%10==0?"Santuário Pós-Boss":"Checkpoint";return t.jsx(Ph,{open:s,onOpenChange:a,children:t.jsxs(qh,{className:"sm:max-w-2xl max-h-[80vh] overflow-y-auto",children:[t.jsxs(Dh,{children:[t.jsxs(Lh,{className:"flex items-center gap-2",children:[t.jsx(nt,{className:"h-6 w-6"}),"Mapa da Torre - Checkpoints Desbloqueados"]}),t.jsx($h,{children:"Escolha de qual andar você deseja iniciar sua aventura. Você só pode acessar checkpoints que já alcançou antes."})]}),t.jsx("div",{className:"space-y-4",children:l?t.jsx("div",{className:"flex items-center justify-center py-8",children:t.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-t-2 border-b-2 border-primary"})}):t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3",children:i.map((e=>{return t.jsxs(fu,{className:"cursor-pointer transition-all hover:shadow-md "+(d===e.floor?"ring-2 ring-primary bg-primary/5":"hover:bg-accent/50"),onClick:()=>m(e.floor),children:[t.jsx(gu,{className:"pb-2",children:t.jsxs(bu,{className:"text-sm flex items-center gap-2",children:[t.jsx("div",{className:"p-1 rounded-full text-white "+(s=e.floor,1===s?"bg-green-500":5===s?"bg-purple-500":s>=20&&s%10==0?"bg-yellow-500":"bg-blue-500"),children:h(e.floor)}),e.description,d===e.floor&&t.jsx(be,{className:"h-4 w-4 text-primary ml-auto"})]})}),t.jsxs(yu,{className:"pt-0",children:[t.jsx("div",{className:"text-xs text-muted-foreground",children:p(e.floor)}),r.floor===e.floor&&t.jsx("div",{className:"text-xs text-green-600 font-medium mt-1",children:"Posição Atual"})]})]},e.floor);var s}))}),t.jsx(fu,{className:"bg-muted/30",children:t.jsxs(yu,{className:"p-4",children:[t.jsxs("div",{className:"flex items-center justify-between text-sm",children:[t.jsx("span",{children:"Andar Atual:"}),t.jsx("span",{className:"font-bold",children:r.floor})]}),t.jsxs("div",{className:"flex items-center justify-between text-sm mt-1",children:[t.jsx("span",{children:"Checkpoints Desbloqueados:"}),t.jsx("span",{className:"font-bold",children:i.length})]})]})}),t.jsxs("div",{className:"flex gap-3 pt-4",children:[t.jsx(Ws,{variant:"outline",onClick:a,className:"flex-1",disabled:l,children:"Cancelar"}),t.jsxs(Ws,{onClick:async()=>{if(null!==d)try{c(!0),n(d),a()}catch(e){j.error("Erro ao iniciar aventura")}finally{c(!1)}else j.error("Selecione um checkpoint")},className:"flex-1",disabled:l||null===d,children:[l?t.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-t-2 border-b-2 border-white mr-2"}):t.jsx(it,{className:"h-4 w-4 mr-2"}),"Iniciar Aventura"]})]})]})})]})})},Px=lt,Mx=ct,Tx=dt,qx=e.forwardRef((({className:e,sideOffset:s=4,...a},r)=>t.jsx(ot,{ref:r,sideOffset:s,className:Hs("z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",e),...a})));function Dx({value:e,baseValue:s,equipmentBonus:a=0,modifications:r=[],size:n="md",showTooltip:i=!1,label:o,icon:l,className:c=""}){const d=isNaN(e)||null==e?0:e,m=isNaN(s||0)||null==s?0:s||0,u=isNaN(a)||void 0===a?0:a,h=r.reduce(((e,t)=>{if("flat"===t.type)return e+(isNaN(t.value)?0:t.value);return e+(m||d)*((isNaN(t.value)?0:t.value)/100)}),0),p=r.length>0,x=t.jsxs("div",{className:`inline-flex items-center gap-1 ${{sm:"text-xs",md:"text-sm",lg:"text-base"}[n]} ${c}`,children:[l&&t.jsx("span",{className:"inline-flex",children:l}),t.jsx("span",{className:"font-bold transition-all duration-300 "+(p?"text-purple-400 animate-pulse drop-shadow-[0_0_6px_rgba(168,85,247,0.4)]":u>0?"text-green-400":""),children:Math.round(d)}),p&&t.jsxs("div",{className:"inline-flex items-center",children:[t.jsx("div",{className:"w-1 h-1 bg-purple-400 rounded-full animate-pulse"}),t.jsxs("div",{className:"ml-1 text-purple-300 text-xs animate-bounce",children:[h>0?"+":"",Math.round(h)]})]}),o&&t.jsx("span",{className:"text-muted-foreground ml-1",children:o})]});return i?t.jsx(Px,{children:t.jsxs(Mx,{children:[t.jsx(Tx,{asChild:!0,children:x}),t.jsx(qx,{className:"max-w-xs p-3",children:t.jsxs("div",{className:"space-y-2",children:[t.jsx("div",{className:"font-semibold text-sm",children:"Detalhes da Estatística"}),void 0!==s&&!isNaN(m)&&t.jsxs("div",{className:"flex justify-between text-xs",children:[t.jsx("span",{className:"text-muted-foreground",children:"Base:"}),t.jsx("span",{children:Math.round(m)})]}),u>0&&t.jsxs("div",{className:"flex justify-between text-xs",children:[t.jsx("span",{className:"text-muted-foreground",children:"Equipamentos:"}),t.jsxs("span",{className:"text-green-400 flex items-center gap-1",children:[t.jsx(We,{className:"h-3 w-3"}),Math.round(u)]})]}),r.length>0&&t.jsxs("div",{className:"space-y-1",children:[t.jsx("div",{className:"text-xs font-medium text-purple-400 border-t border-border pt-2",children:"Efeitos Mágicos:"}),r.map(((e,s)=>t.jsxs("div",{className:"flex justify-between text-xs",children:[t.jsxs("span",{className:"text-purple-300 flex items-center gap-1",children:[t.jsx("div",{className:"w-2 h-2 bg-purple-400 rounded-full animate-pulse"}),e.source_spell]}),t.jsxs("span",{className:"text-purple-400 flex items-center gap-1",children:[e.value>0?t.jsx(Ie,{className:"h-3 w-3"}):t.jsx(mt,{className:"h-3 w-3"}),e.value>0?"+":"",e.value,"percentage"===e.type?"%":""]})]},s))),t.jsxs("div",{className:"flex justify-between text-xs pt-1 border-t border-purple-500/20",children:[t.jsx("span",{className:"text-purple-300",children:"Total Mágico:"}),t.jsxs("span",{className:"text-purple-400 font-medium",children:[h>0?"+":"",Math.round(h)]})]})]}),t.jsxs("div",{className:"flex justify-between text-xs font-medium pt-2 border-t border-border",children:[t.jsx("span",{children:"Total:"}),t.jsx("span",{className:""+(p?"text-purple-400":"text-foreground"),children:Math.round(d)})]})]})})]})}):x}qx.displayName=ot.displayName;const Rx=e.memo((function({player:s}){const a=n(),[r,i]=e.useState(!1),[o,l]=e.useState(!1),c=e.useMemo((()=>{const e=(t=s.level)<=1?0:Math.floor(100*Math.pow(1.5,t-2));var t;const a=s.xp_next_level,r=s.xp-e,n=a-e;return{xpInCurrentLevel:r,xpNeededForNextLevel:n,xpProgress:Math.max(0,Math.min(100,r/n*100)),hpProgress:s.hp/s.max_hp*100,manaProgress:s.mana/s.max_mana*100}}),[s.level,s.xp,s.xp_next_level,s.hp,s.max_hp,s.mana,s.max_mana]),d=e.useMemo((()=>[{name:"FOR",fullName:"Força",value:s.strength||10,icon:se,color:"text-red-400"},{name:"AGI",fullName:"Agilidade",value:s.dexterity||10,icon:re,color:"text-green-400"},{name:"INT",fullName:"Inteligência",value:s.intelligence||10,icon:ut,color:"text-blue-400"},{name:"SAB",fullName:"Sabedoria",value:s.wisdom||10,icon:ht,color:"text-purple-400"},{name:"VIT",fullName:"Vitalidade",value:s.vitality||10,icon:ae,color:"text-pink-400"},{name:"SOR",fullName:"Sorte",value:s.luck||10,icon:Ye,color:"text-yellow-400"}]),[s.strength,s.dexterity,s.intelligence,s.wisdom,s.vitality,s.luck]),m=e.useMemo((()=>[{key:"sword_mastery",level:s.sword_mastery||1,xp:s.sword_mastery_xp||0},{key:"axe_mastery",level:s.axe_mastery||1,xp:s.axe_mastery_xp||0},{key:"blunt_mastery",level:s.blunt_mastery||1,xp:s.blunt_mastery_xp||0},{key:"defense_mastery",level:s.defense_mastery||1,xp:s.defense_mastery_xp||0},{key:"magic_mastery",level:s.magic_mastery||1,xp:s.magic_mastery_xp||0}].filter((e=>e.level>1||e.xp>0))),[s.sword_mastery,s.sword_mastery_xp,s.axe_mastery,s.axe_mastery_xp,s.blunt_mastery,s.blunt_mastery_xp,s.defense_mastery,s.defense_mastery_xp,s.magic_mastery,s.magic_mastery_xp]),u=e=>{switch(e){case"sword_mastery":return t.jsx(se,{className:"h-4 w-4 text-red-400"});case"axe_mastery":return t.jsx(bt,{className:"h-4 w-4 text-orange-400"});case"blunt_mastery":return t.jsx(gt,{className:"h-4 w-4 text-yellow-400"});case"defense_mastery":return t.jsx(De,{className:"h-4 w-4 text-blue-400"});case"magic_mastery":return t.jsx(ut,{className:"h-4 w-4 text-purple-400"});default:return t.jsx(ft,{className:"h-4 w-4 text-gray-400"})}},h=e=>{switch(e){case"sword_mastery":return"Maestria com Espadas";case"axe_mastery":return"Maestria com Machados";case"blunt_mastery":return"Maestria com Armas Pesadas";case"defense_mastery":return"Maestria em Defesa";case"magic_mastery":return"Maestria Mágica";default:return e}};return t.jsxs(fu,{className:"w-full bg-slate-900/80 border-slate-700 shadow-xl",children:[t.jsx(gu,{className:"pb-3",children:t.jsxs(bu,{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-3",children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("div",{className:"p-2 bg-slate-700 rounded-lg",children:t.jsx(W,{className:"h-5 w-5 text-slate-300"})}),t.jsxs("div",{children:[t.jsx("h2",{className:"text-xl font-bold text-slate-100",children:s.name}),t.jsx("p",{className:"text-sm text-slate-400",children:"Aventureiro"})]})]}),t.jsxs("div",{className:"flex items-center gap-2 sm:gap-3 flex-wrap",children:[t.jsxs(Ws,{onClick:async()=>{try{l(!0);const e=await Ah.getUnlockedCheckpoints(s.id);if(!e.success||!e.data||0===e.data.length)return;const t=e.data.sort(((e,t)=>t.floor-e.floor)),r=t[0];if(!(await Ah.startFromCheckpoint(s.id,r.floor)).success)return;a({to:"/game/play/hub/battle/$character",params:{character:s.id},search:{character:s.id}})}catch(e){}finally{l(!1)}},disabled:o,size:"sm",className:"quick-play-button relative overflow-hidden bg-gradient-to-r from-violet-600 via-purple-600 to-indigo-600 hover:from-violet-500 hover:via-purple-500 hover:to-indigo-500 text-white border border-violet-500/20 shadow-lg transition-all duration-300 hover:shadow-violet-500/25 hover:shadow-xl hover:-translate-y-0.5 flex-shrink-0 group disabled:opacity-60 disabled:cursor-not-allowed disabled:hover:transform-none",children:[t.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-violet-600/50 via-purple-600/50 to-indigo-600/50 opacity-0 group-hover:opacity-100 transition-opacity duration-300"}),!o&&t.jsx("div",{className:"quick-start-indicator absolute -top-1 -right-1 w-2 h-2 bg-amber-400 rounded-full shadow-sm shadow-amber-400/50"}),t.jsx(it,{className:"h-3 w-3 mr-1.5 relative z-10 transition-transform duration-300 "+(o?"animate-spin":"group-hover:scale-110 group-hover:drop-shadow-lg")}),t.jsx("span",{className:"relative z-10 font-medium tracking-wide",children:o?"Iniciando...":"Jogar"}),!o&&t.jsx("div",{className:"absolute inset-0 opacity-0 group-hover:opacity-30 transition-opacity duration-500",children:t.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-transparent via-white/30 to-transparent -skew-x-12 group-hover:animate-pulse"})})]}),t.jsxs(_u,{variant:"outline",className:"border-amber-500 text-amber-400 bg-amber-500/10 flex-shrink-0",children:[t.jsx(pt,{className:"h-3 w-3 mr-1"}),"Nível ",s.level]}),t.jsx(Ws,{variant:"ghost",size:"sm",onClick:()=>i(!r),className:"text-slate-400 hover:text-slate-200 flex-shrink-0",children:r?t.jsx(de,{className:"h-4 w-4"}):t.jsx(le,{className:"h-4 w-4"})})]})]})}),t.jsxs(yu,{className:"space-y-4",children:[t.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[t.jsxs("div",{className:"space-y-3",children:[t.jsx("h3",{className:"text-sm font-semibold text-slate-300 uppercase tracking-wide",children:"Status"}),t.jsxs("div",{className:"space-y-1",children:[t.jsxs("div",{className:"flex justify-between items-center text-sm",children:[t.jsxs("span",{className:"flex items-center gap-2 font-medium text-slate-300",children:[t.jsx(ae,{className:"h-4 w-4 text-red-400"}),"HP",s.hp<s.max_hp&&t.jsx("div",{className:"h-2 w-2 bg-green-400 rounded-full animate-pulse"})]}),t.jsxs("div",{className:"text-right",children:[t.jsx(Dx,{value:s.max_hp,baseValue:s.base_max_hp,equipmentBonus:s.equipment_hp_bonus,className:"text-red-400 font-medium",size:"sm",showTooltip:!0}),t.jsxs("div",{className:"text-xs text-slate-400",children:[s.hp,"/",s.max_hp]})]})]}),t.jsxs("div",{className:"relative",children:[t.jsx(Zh,{value:c.hpProgress,className:"h-2"}),t.jsx("div",{className:"absolute top-0 left-0 h-2 rounded-full transition-all duration-300 "+(c.hpProgress>=70?"bg-green-500":c.hpProgress>=40?"bg-yellow-500":c.hpProgress>=20?"bg-orange-500":"bg-red-500"),style:{width:`${c.hpProgress}%`}})]})]}),t.jsxs("div",{className:"space-y-1",children:[t.jsxs("div",{className:"flex justify-between items-center text-sm",children:[t.jsxs("span",{className:"flex items-center gap-2 font-medium text-slate-300",children:[t.jsx(ut,{className:"h-4 w-4 text-blue-400"}),"Mana"]}),t.jsxs("div",{className:"text-right",children:[t.jsx(Dx,{value:s.max_mana,baseValue:s.base_max_mana,equipmentBonus:s.equipment_mana_bonus,className:"text-blue-400 font-medium",size:"sm",showTooltip:!0}),t.jsxs("div",{className:"text-xs text-slate-400",children:[s.mana,"/",s.max_mana]})]})]}),t.jsxs("div",{className:"relative",children:[t.jsx(Zh,{value:c.manaProgress,className:"h-2"}),t.jsx("div",{className:"absolute top-0 left-0 h-2 rounded-full transition-all duration-300 "+(c.manaProgress>=70?"bg-blue-500":c.manaProgress>=40?"bg-cyan-500":c.manaProgress>=20?"bg-indigo-500":"bg-purple-500"),style:{width:`${c.manaProgress}%`}})]})]}),t.jsxs("div",{className:"space-y-1",children:[t.jsxs("div",{className:"flex justify-between items-center text-sm",children:[t.jsxs("span",{className:"flex items-center gap-2 font-medium text-slate-300",children:[t.jsx(pt,{className:"h-4 w-4 text-yellow-400"}),"XP"]}),t.jsxs("span",{className:"text-slate-400",children:[c.xpInCurrentLevel.toLocaleString(),"/",c.xpNeededForNextLevel.toLocaleString()]})]}),t.jsxs("div",{className:"relative",children:[t.jsx(Zh,{value:c.xpProgress,className:"h-2"}),t.jsx("div",{className:"absolute top-0 left-0 h-2 bg-gradient-to-r from-amber-400 via-yellow-500 to-orange-400 rounded-full transition-all duration-300",style:{width:`${c.xpProgress}%`}})]})]})]}),t.jsxs("div",{className:"space-y-3",children:[t.jsx("h3",{className:"text-sm font-semibold text-slate-300 uppercase tracking-wide",children:"Combat Stats"}),t.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[t.jsxs("div",{className:"space-y-2",children:[t.jsxs("div",{className:"flex items-center justify-between text-sm",children:[t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(se,{className:"h-4 w-4 text-red-400"}),t.jsx("span",{className:"text-muted-foreground",children:"ATK"})]}),t.jsx(Dx,{value:s.atk,baseValue:s.base_atk,equipmentBonus:s.equipment_atk_bonus,modifications:s.active_effects?.attribute_modifications?.filter((e=>"atk"===e.attribute))||[],className:"text-red-400 font-bold",size:"sm",showTooltip:!0})]}),Boolean(s.magic_attack&&s.magic_attack>0)&&t.jsxs("div",{className:"flex items-center justify-between text-sm",children:[t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(ut,{className:"h-4 w-4 text-purple-400"}),t.jsx("span",{className:"text-muted-foreground",children:"M.ATK"})]}),t.jsx(Dx,{value:s.magic_attack||0,modifications:s.active_effects?.attribute_modifications?.filter((e=>"magic_attack"===e.attribute))||[],className:"text-purple-400 font-bold",size:"sm",showTooltip:!0})]}),t.jsxs("div",{className:"flex items-center justify-between text-sm",children:[t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(De,{className:"h-4 w-4 text-blue-400"}),t.jsx("span",{className:"text-muted-foreground",children:"DEF"})]}),t.jsx(Dx,{value:s.def,baseValue:s.base_def,equipmentBonus:s.equipment_def_bonus,modifications:s.active_effects?.attribute_modifications?.filter((e=>"def"===e.attribute))||[],className:"text-blue-400 font-bold",size:"sm",showTooltip:!0})]})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsxs("div",{className:"flex items-center justify-between text-sm",children:[t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(re,{className:"h-4 w-4 text-yellow-400"}),t.jsx("span",{className:"text-muted-foreground",children:"SPD"})]}),t.jsx(Dx,{value:s.speed,baseValue:s.base_speed,equipmentBonus:s.equipment_speed_bonus,modifications:s.active_effects?.attribute_modifications?.filter((e=>"speed"===e.attribute))||[],className:"text-yellow-400 font-bold",size:"sm",showTooltip:!0})]}),t.jsxs("div",{className:"flex items-center justify-between text-sm",children:[t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(pt,{className:"h-4 w-4 text-amber-400"}),t.jsx("span",{className:"text-muted-foreground",children:"CRIT"})]}),t.jsxs("span",{className:"font-bold text-amber-400",children:[(s.critical_chance||0).toFixed(1),"%"]})]}),Boolean(s.magic_damage_bonus&&s.magic_damage_bonus>0)&&t.jsxs("div",{className:"flex items-center justify-between text-sm",children:[t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(ut,{className:"h-4 w-4 text-purple-400"}),t.jsx("span",{className:"text-muted-foreground",children:"M.BONUS"})]}),t.jsxs("span",{className:"font-bold text-purple-400",children:["+",Math.round(s.magic_damage_bonus||0),"%"]})]})]})]}),t.jsx("div",{className:"bg-slate-800/50 p-3 rounded-lg border border-slate-700",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(xt,{className:"h-4 w-4 text-yellow-400"}),t.jsx("span",{className:"text-sm font-medium text-slate-300",children:"Gold"})]}),t.jsx("p",{className:"text-lg font-bold text-yellow-400",children:s.gold.toLocaleString("pt-BR")})]})})]}),t.jsxs("div",{className:"space-y-3",children:[t.jsx("h3",{className:"text-sm font-semibold text-slate-300 uppercase tracking-wide",children:"Atributos"}),t.jsx("div",{className:"grid grid-cols-3 gap-2",children:d.map((e=>{const s=e.icon;return t.jsx("div",{className:"bg-slate-800/50 p-2 rounded-lg border border-slate-700 hover:bg-slate-700/50 transition-colors",title:e.fullName,children:t.jsxs("div",{className:"flex flex-col items-center gap-1",children:[t.jsx(s,{className:`h-3 w-3 ${e.color}`}),t.jsx("span",{className:"text-xs font-medium text-slate-400",children:e.name}),t.jsx("span",{className:`text-sm font-bold ${e.color}`,children:e.value})]})},e.name)}))})]})]}),r&&t.jsxs("div",{className:"border-t border-slate-700 pt-4 space-y-3",children:[t.jsx("h3",{className:"text-sm font-semibold text-slate-300 uppercase tracking-wide",children:"Habilidades de Combate"}),t.jsx("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-3",children:m.map((e=>{const s=100*e.level,a=100*(e.level-1),r=e.xp-a,n=s-a,i=Math.max(0,Math.min(100,r/n*100));return t.jsx("div",{className:"bg-slate-700/50 p-3 rounded-lg border border-slate-600 hover:border-slate-500 transition-colors",children:t.jsxs("div",{className:"flex flex-col items-center gap-2",children:[t.jsx("div",{className:"flex items-center justify-center",children:u(e.key)}),t.jsx("span",{className:"text-xs font-medium text-slate-400 text-center",children:h(e.key)}),t.jsxs(_u,{variant:"outline",className:"border-current bg-transparent text-xs",children:["Nv. ",e.level]}),Boolean(e.xp>0)&&t.jsxs("div",{className:"w-full",children:[t.jsx("div",{className:"w-full h-1 bg-slate-600 rounded-full overflow-hidden",children:t.jsx("div",{className:"h-full bg-gradient-to-r from-blue-500 to-purple-500 transition-all duration-300",style:{width:`${i}%`}})}),t.jsxs("div",{className:"text-xs text-slate-500 mt-1 text-center",children:[r,"/",n," XP"]})]})]})},e.key)}))})]})]})]})}));function Lx({title:e,description:s,icon:a,onClick:r,badge:n,badgeColor:i="secondary",accent:o,isPrimary:l=!1}){return t.jsx(fu,{className:"group relative overflow-hidden border-slate-700 bg-slate-900/80 hover:bg-slate-800/80 transition-all duration-300 hover:border-slate-600 cursor-pointer "+(l?"ring-2 ring-red-600/30":""),children:t.jsxs(Ws,{variant:"ghost",className:"w-full h-full p-3 flex flex-col items-center justify-center space-y-2 hover:bg-transparent min-h-[120px] cursor-pointer",onClick:r,children:[t.jsxs("div",{className:"relative",children:[t.jsx("div",{className:`p-3 rounded-lg bg-slate-800 group-hover:bg-slate-700 transition-colors duration-300 ${o}`,children:t.jsx(a,{className:"h-5 w-5 text-slate-300 group-hover:text-white transition-colors duration-300"})}),n&&t.jsx(_u,{variant:i,className:"absolute -top-2 -right-2 h-5 w-5 p-0 flex items-center justify-center text-xs font-bold bg-red-600 text-white border-red-500",children:n})]}),t.jsxs("div",{className:"text-center space-y-1 max-w-full",children:[t.jsx("h3",{className:"font-semibold text-sm text-slate-200 group-hover:text-white transition-colors duration-300 leading-tight",children:e}),t.jsx("p",{className:"text-xs text-slate-400 group-hover:text-slate-300 transition-colors duration-300 leading-tight px-1 break-words",children:s})]})]})})}function $x({player:e,onStartAdventure:s,onOpenMap:a,onOpenCharacterStats:r,onOpenShop:n,onOpenInventory:i,onOpenEquipment:o,onOpenSpells:l,onOpenCrafting:c,onOpenCemetery:d,onReturnToSelection:m}){const u=[{title:"Entrar na Torre",description:"Nova aventura",icon:Z,onClick:s,accent:"border-red-600/30",isPrimary:!0},{title:"Mapa da Torre",description:"Usar checkpoint",icon:nt,onClick:a,accent:"border-blue-600/30"},{title:"Atributos",description:"Evoluir personagem",icon:Ie,onClick:r,badge:e.attribute_points&&e.attribute_points>0?e.attribute_points:void 0,badgeColor:"destructive",accent:"border-purple-600/30"},{title:"Grimório",description:"Gerenciar magias",icon:ut,onClick:l,accent:"border-violet-600/30"},{title:"Loja",description:"Comprar itens",icon:vt,onClick:n,accent:"border-green-600/30"},{title:"Inventário",description:"Consumíveis",icon:yt,onClick:i,accent:"border-orange-600/30"},{title:"Equipamentos",description:"Armas e armaduras",icon:De,onClick:o,accent:"border-amber-600/30"},{title:"Forja",description:"Crafting de itens",icon:gt,onClick:c,accent:"border-cyan-600/30"},{title:"Cemitério",description:"Personagens mortos",icon:Re,onClick:d,accent:"border-red-600/30"},{title:"Trocar",description:"Outro personagem",icon:Me,onClick:m,accent:"border-slate-600/30"}];return t.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-10 gap-3",children:u.map(((e,s)=>t.jsx(Lx,{title:e.title,description:e.description,icon:e.icon,onClick:e.onClick,badge:e.badge,badgeColor:e.badgeColor,accent:e.accent,isPrimary:e.isPrimary},s)))})}function Ix({player:e,showHealNotification:s,healInfo:a,onDismissHealNotification:r}){const n=e.attribute_points&&e.attribute_points>0;return s||n?t.jsxs("div",{className:"space-y-3",children:[n&&t.jsx(fu,{className:"bg-amber-950/50 border-amber-700/50 shadow-lg backdrop-blur-sm",children:t.jsx(yu,{className:"p-3",children:t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("div",{className:"p-2 bg-amber-600/20 rounded-lg",children:t.jsx(pt,{className:"h-4 w-4 text-amber-400"})}),t.jsxs("div",{className:"flex-1",children:[t.jsx("h3",{className:"font-semibold text-amber-200 text-sm",children:"Pontos de Atributo Disponíveis"}),t.jsxs("div",{className:"text-xs text-amber-300/80",children:["Você tem"," ",t.jsx(_u,{variant:"outline",className:"mx-1 text-amber-200 bg-amber-600/20 border-amber-500/50 text-xs px-1.5 py-0.5",children:e.attribute_points}),'ponto(s) para distribuir em "Atributos".']})]}),t.jsx(He,{className:"h-4 w-4 text-amber-500 animate-pulse"})]})})}),s&&a&&t.jsx("div",{className:"fixed top-4 right-4 z-50 max-w-sm animate-in slide-in-from-top-2 duration-500",children:t.jsx(fu,{className:"bg-emerald-950/80 border-emerald-700/50 shadow-xl backdrop-blur-md",children:t.jsx(yu,{className:"p-3",children:t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("div",{className:"p-2 bg-emerald-600/20 rounded-lg",children:t.jsx(ae,{className:"h-4 w-4 text-emerald-400"})}),t.jsxs("div",{className:"flex-1",children:[t.jsxs("h3",{className:"font-semibold text-emerald-200 text-sm",children:[a.character," foi curado!"]}),t.jsxs("div",{className:"flex items-center gap-2 text-xs text-emerald-300",children:[t.jsx("span",{children:"HP:"}),t.jsxs("span",{className:"font-mono bg-emerald-900/50 px-2 py-0.5 rounded text-xs",children:[a.oldHp," → ",a.newHp]}),t.jsxs(_u,{variant:"outline",className:"text-emerald-300 border-emerald-500/50 bg-emerald-600/20 text-xs px-1.5 py-0.5",children:["+",a.newHp-a.oldHp]})]})]}),t.jsx(Ws,{variant:"ghost",size:"sm",onClick:r,className:"h-6 w-6 p-0 text-emerald-400 hover:text-emerald-300 hover:bg-emerald-800/50",children:t.jsx(z,{className:"h-3 w-3"})})]})})})})]}):null}const Fx=r("/_authenticated/game/play/hub")({component:function(){const e=i(),{character:s}=Fx.useSearch();if("/game/play/hub"===e.pathname)return t.jsx(Ox,{characterId:s});return t.jsx(a,{})},validateSearch:e=>({character:e.character})});function Vx({message:s="Carregando personagem..."}){const[a,r]=e.useState("");return e.useEffect((()=>{const e=setInterval((()=>{r((e=>"..."===e?"":e+"."))}),500);return()=>clearInterval(e)}),[]),t.jsx("div",{className:"flex items-center justify-center min-h-screen w-full bg-gradient-to-b from-slate-950 to-slate-900",children:t.jsxs("div",{className:"text-center text-white space-y-4",children:[t.jsx("div",{className:"animate-spin rounded-full h-16 w-16 border-t-2 border-b-2 border-blue-500 mx-auto"}),t.jsxs("p",{className:"text-lg font-medium",children:[s,t.jsx("span",{className:"inline-block w-8 text-left",children:a})]}),t.jsx("div",{className:"w-64 bg-slate-800 rounded-full h-2 mx-auto",children:t.jsx("div",{className:"bg-blue-500 h-2 rounded-full animate-pulse",style:{width:"60%"}})})]})})}function Ox({characterId:s}){const a=n(),{loadCharacterForHub:r}=kx(),i=xx((e=>e.gameState.mode)),o=xx((e=>e.gameState.player?.id)),l=xx((e=>e.gameState.player?.name)),c=xx((e=>e.gameState.player)),d=e.useCallback((async e=>{try{await r(e)}catch(t){throw t}}),[r]),[m,u]=e.useState("initial"),[h,p]=e.useState(null),[x,f]=e.useState(!1),g=e.useRef(!0),b=e.useRef(!1),v=e.useRef(null),y=e.useRef(null);if(e.useEffect((()=>(g.current=!0,()=>{g.current=!1,y.current&&clearTimeout(y.current)})),[]),e.useEffect((()=>{(async()=>{if(!s||""===s.trim())return u("error"),void p("ID do personagem inválido");if(g.current)if("hub"===i&&o===s&&l&&"initial"!==m)"loaded"!==m&&u("loaded");else if(!b.current||v.current!==s){b.current=!0,v.current=s,u("loading"),p(null),y.current=setTimeout((()=>{b.current&&g.current&&(u("error"),p("Timeout ao carregar personagem. Tente novamente."),b.current=!1)}),15e3);try{const e=xx.getState().gameState,t=e.player,a=!t?.id||t.id!==s||"hub"!==e.mode,r=await Ah.getCharacterForGame(s,a,!0);if(!r.success||!r.data)throw new Error(r.error||"Erro ao carregar personagem");const n=r.data;if(!g.current)return;await d(n),g.current&&(u("loaded"),y.current&&(clearTimeout(y.current),y.current=null))}catch(e){g.current&&(u("error"),p(e instanceof Error?e.message:"Erro desconhecido"),j.error("Erro ao carregar personagem",{description:e instanceof Error?e.message:"Erro desconhecido"}))}finally{b.current=!1,y.current&&(clearTimeout(y.current),y.current=null)}}})()}),[s,d]),e.useEffect((()=>{"hub"===i&&o===s&&l&&"loading"===m&&u("loaded")}),[i,o,l,s,m]),"initial"===m||"loading"===m)return t.jsx(Vx,{message:"Carregando personagem..."});if("error"===m)return t.jsx("div",{className:"flex items-center justify-center min-h-screen w-full bg-gradient-to-b from-slate-950 to-slate-900",children:t.jsxs("div",{className:"text-center text-white space-y-4 max-w-md mx-auto p-6",children:[t.jsx("div",{className:"w-16 h-16 mx-auto bg-red-500/20 rounded-full flex items-center justify-center",children:t.jsx("svg",{className:"w-8 h-8 text-red-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"})})}),t.jsx("h2",{className:"text-xl font-bold text-red-400",children:"Erro no Carregamento"}),t.jsx("p",{className:"text-slate-300",children:h||"Erro ao carregar dados do personagem"}),t.jsxs("div",{className:"space-y-2",children:[t.jsx(Ws,{onClick:()=>{u("initial"),p(null)},className:"w-full",children:"Tentar Novamente"}),t.jsxs(Ws,{variant:"outline",onClick:()=>a({to:"/game/play"}),className:"w-full",children:[t.jsx(Me,{className:"h-4 w-4 mr-2"}),"Voltar à Seleção"]})]})]})});if(!c?.id)return t.jsx("div",{className:"flex items-center justify-center min-h-screen w-full bg-gradient-to-b from-slate-950 to-slate-900",children:t.jsxs("div",{className:"text-center text-white space-y-4 max-w-md mx-auto p-6",children:[t.jsx("div",{className:"w-16 h-16 mx-auto bg-yellow-500/20 rounded-full flex items-center justify-center",children:t.jsx("svg",{className:"w-8 h-8 text-yellow-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"})})}),t.jsx("h2",{className:"text-xl font-bold text-yellow-400",children:"Personagem não carregado"}),t.jsx("p",{className:"text-slate-300",children:"Os dados do personagem não puderam ser carregados."}),t.jsxs(Ws,{onClick:()=>a({to:"/game/play"}),className:"w-full",children:[t.jsx(Me,{className:"h-4 w-4 mr-2"}),"Voltar à Seleção"]})]})});return t.jsx("div",{className:"min-h-screen w-full bg-gradient-to-b from-slate-950 to-slate-900 p-2 md:p-4",children:t.jsxs("div",{className:"w-full max-w-7xl mx-auto space-y-4",children:[t.jsx("div",{className:"space-y-3 sm:space-y-4",children:t.jsxs("div",{className:"flex flex-col gap-3",children:[t.jsxs("div",{className:"flex flex-wrap gap-2",children:[t.jsxs(Ws,{variant:"outline",size:"sm",onClick:()=>a({to:"/game/play"}),className:"flex-shrink-0",children:[t.jsx(Me,{className:"h-4 w-4 mr-2"}),t.jsx("span",{className:"hidden sm:inline",children:"Trocar Personagem"}),t.jsx("span",{className:"sm:hidden",children:"Trocar"})]}),t.jsxs(Ws,{variant:"ghost",size:"sm",onClick:()=>a({to:"/game"}),className:"flex-shrink-0",children:[t.jsx("span",{className:"hidden sm:inline",children:"Menu Principal"}),t.jsx("span",{className:"sm:hidden",children:"Menu"})]})]}),t.jsxs("div",{children:[t.jsxs("h1",{className:"text-2xl sm:text-3xl font-bold text-white",children:["Hub de ",c.name||"Carregando..."]}),t.jsxs("p",{className:"text-sm sm:text-base text-slate-300",children:["Andar ",Math.max(1,c.floor||1)," • Nível ",c.level||1," •"," ",(c.gold||0).toLocaleString("pt-BR")," Gold"]})]})]})}),t.jsx(Ix,{player:c,showHealNotification:!1,healInfo:null,onDismissHealNotification:()=>{}}),t.jsxs("div",{className:"space-y-4",children:[t.jsx(Rx,{player:c}),t.jsx($x,{player:c,onStartAdventure:async()=>{if(c?.id)try{await Ah.updateCharacterFloor(c.id,1),a({to:"/game/play/hub/battle/$character",params:{character:c.id},search:{character:c.id}})}catch{j.error("Erro ao iniciar aventura")}else j.error("Erro: Personagem não carregado")},onOpenMap:()=>f(!0),onOpenCharacterStats:()=>window.location.href=`/game/play/hub/character-stats?character=${c.id}`,onOpenShop:()=>window.location.href=`/game/play/hub/shop?character=${c.id}`,onOpenInventory:()=>window.location.href=`/game/play/hub/inventory?character=${c.id}`,onOpenEquipment:()=>window.location.href=`/game/play/hub/equipment?character=${c.id}`,onOpenSpells:()=>window.location.href=`/game/play/hub/spells?character=${c.id}`,onOpenCrafting:()=>window.location.href=`/game/play/hub/crafting?character=${c.id}`,onOpenCemetery:()=>window.location.href="/game/play/hub/cemetery",onReturnToSelection:()=>a({to:"/game/play"})})]}),t.jsx(Ax,{isOpen:x,onClose:()=>f(!1),character:{id:c.id,floor:c.floor},onStartFromCheckpoint:async e=>{if(c?.id)try{const t=await Ah.startFromCheckpoint(c.id,e);t.success?a({to:"/game/play/hub/battle/$character",params:{character:c.id},search:{character:c.id}}):j.error("Erro ao iniciar do checkpoint",{description:t.error})}catch{j.error("Erro ao iniciar do checkpoint")}else j.error("Erro: Personagem não carregado")}})]})})}const Bx=e.lazy((()=>d((()=>import("./SpellsPage-BLb2iUzk.js")),__vite__mapDeps([0,1,2,3,4,5])))),Ux=r("/_authenticated/game/play/hub/spells")({component:Bx,validateSearch:e=>({character:e.character||""})}),zx="/assets",Gx={"poção de vida pequena":"small_health_potion.png","pequena poção de vida":"small_health_potion.png","small health potion":"small_health_potion.png","poção de hp pequena":"small_health_potion.png","poção de mana pequena":"small_mana_potion.png","pequena poção de mana":"small_mana_potion.png","small mana potion":"small_mana_potion.png","poção de mp pequena":"small_mana_potion.png",potion_hp_small:"small_health_potion.png",potion_mana_small:"small_mana_potion.png"};class Hx{static iconCache=new Map;static preloadedAnimations=new Map;static loadingPromises=new Map;static getConsumableIcon(e){const t=`consumable-${e.id}`;if(this.iconCache.has(t))return this.iconCache.get(t);let s;const a=e.name.toLowerCase().trim();return s=Gx[a]?`${zx}/icons/consumables/${Gx[a]}`:this.getConsumableIconByType(e),this.iconCache.set(t,s),s}static getConsumableIconByType(e){const t=`${zx}/icons/consumables`;return"potion"===e.type?e.description.includes("HP")||e.description.includes("Vida")?e.effect_value<=30?`${t}/small_health_potion.png`:e.effect_value<=60?`${t}/health-potion-medium.png`:`${t}/health-potion-large.png`:e.description.includes("Mana")?e.effect_value<=15?`${t}/small_mana_potion.png`:e.effect_value<=30?`${t}/mana-potion-medium.png`:`${t}/mana-potion-large.png`:`${t}/small_health_potion.png`:"buff"===e.type||"elixir"===e.type?e.description.includes("Força")||e.description.includes("ataque")?`${t}/strength-elixir.png`:e.description.includes("Defesa")?`${t}/defense-elixir.png`:`${t}/strength-elixir.png`:"antidote"===e.type?`${t}/antidote.png`:`${t}/small_health_potion.png`}static addConsumableMapping(e,t){Gx[e.toLowerCase().trim()]=t}static async preloadCharacterAnimation(e,t,s=3){const a=`${e}-${t}`;if(this.loadingPromises.has(a))return void(await this.loadingPromises.get(a));if(this.preloadedAnimations.has(a))return;const r=this.loadAnimationFrames(e,t,s);this.loadingPromises.set(a,r);try{await r}finally{this.loadingPromises.delete(a)}}static async loadAnimationFrames(e,t,s){const a=`${e}-${t}`,r=new Map,n=[];for(let i=1;i<=s;i++){const s=i.toString().padStart(2,"0"),a=`${zx}/characters/${e}/${t}/${e}-${t}-${s}.png`,o={element:new Image,loaded:!1,path:a};r.set(i,o);const l=new Promise((e=>{o.element.onload=()=>{o.loaded=!0,e()},o.element.onerror=()=>{e()},o.element.src=a}));n.push(l)}await Promise.all(n),this.preloadedAnimations.set(a,r)}static getCharacterAnimationFrame(e,t,s){const a=s.toString().padStart(2,"0"),r=`${zx}/characters/${e}/${t}/${e}-${t}-${a}.png`,n=`character-${e}-${t}-${s}`;return this.iconCache.set(n,r),r}static getPreloadedAnimationFrame(e,t,s){const a=`${e}-${t}`,r=this.preloadedAnimations.get(a);if(!r)return null;const n=r.get(s);return n?.loaded?n.element:null}static isAnimationPreloaded(e,t){const s=`${e}-${t}`;return this.preloadedAnimations.has(s)}static getEquipmentIcon(e){const t=`equipment-${e.id}`;if(this.iconCache.has(t))return this.iconCache.get(t);let s;const a=`${zx}/icons/equipment`;switch(e.type){case"weapon":s=e.name.toLowerCase().includes("espada")||e.name.toLowerCase().includes("sword")?e.level_requirement<=5?`${a}/weapons/swords/wooden-sword.png`:e.level_requirement<=15?`${a}/weapons/swords/iron-sword.png`:`${a}/weapons/swords/steel-sword.png`:e.name.toLowerCase().includes("cajado")||e.name.toLowerCase().includes("staff")?e.level_requirement<=10?`${a}/weapons/staffs/basic-staff.png`:`${a}/weapons/staffs/magic-staff.png`:e.name.toLowerCase().includes("arco")||e.name.toLowerCase().includes("bow")?`${a}/weapons/bows/wooden-bow.png`:`${a}/weapons/swords/iron-sword.png`;break;case"armor":s=e.level_requirement<=5?`${a}/armor/chest/leather-armor.png`:e.level_requirement<=15?`${a}/armor/chest/iron-armor.png`:`${a}/armor/chest/steel-armor.png`;break;case"ring":case"necklace":case"amulet":s="ring"===e.type?`${a}/accessories/rings/basic-ring.png`:"necklace"===e.type?`${a}/accessories/necklaces/basic-necklace.png`:`${a}/accessories/amulets/basic-amulet.png`;break;default:s=`${a}/weapons/swords/iron-sword.png`}return this.iconCache.set(t,s),s}static getMaterialIcon(e,t){const s=`material-${e}-${t}`;if(this.iconCache.has(s))return this.iconCache.get(s);const a=`${zx}/icons/materials/${e}/${t.toLowerCase().replace(/\s+/g,"-")}.png`;return this.iconCache.set(s,a),a}static getMonsterPortrait(e,t){const s=`monster-portrait-${e}-${t}`;if(this.iconCache.has(s))return this.iconCache.get(s);const a=e.toLowerCase().replace(/\s+/g,"-"),r=`${zx}/monsters/portraits/floor-${t}/${a}.png`;return this.iconCache.set(s,r),r}static getEnvironmentBackground(e,t){const s=`bg-${e}-${t}`;if(this.iconCache.has(s))return this.iconCache.get(s);const a=`${zx}/environments/backgrounds/${e}/${t}-bg.png`;return this.iconCache.set(s,a),a}static getStatusIcon(e,t){const s=`status-${e}-${t}`;if(this.iconCache.has(s))return this.iconCache.get(s);const a=t.toLowerCase().replace(/\s+/g,"-"),r=`${zx}/icons/status/${e}s/${a}.png`;return this.iconCache.set(s,r),r}static getUIIcon(e,t){const s=`ui-${e}-${t}`;if(this.iconCache.has(s))return this.iconCache.get(s);const a=`${zx}/icons/ui/${e}/${t}.png`;return this.iconCache.set(s,a),a}static clearCache(){this.iconCache.clear(),this.preloadedAnimations.clear(),this.loadingPromises.clear()}static async preloadCriticalAssets(){const e=[`${zx}/icons/consumables/small_health_potion.png`,`${zx}/icons/consumables/small_mana_potion.png`,`${zx}/icons/equipment/weapons/swords/wooden-sword.png`,`${zx}/icons/equipment/armor/chest/leather-armor.png`,`${zx}/icons/ui/buttons/primary-button.png`,`${zx}/icons/ui/frames/inventory-frame.png`].map((e=>new Promise(((t,s)=>{const a=new Image;a.onload=()=>t(),a.onerror=()=>s(new Error(`Failed to load ${e}`)),a.src=e})))),t=[this.preloadCharacterAnimation("thief","idle",3)];try{await Promise.all([...e,...t])}catch(s){}}static async assetExists(e){return new Promise((t=>{const s=new Image;s.onload=()=>t(!0),s.onerror=()=>t(!1),s.src=e}))}static getFallbackAsset(e){return{icons:`${zx}/icons/ui/placeholder.png`,characters:`${zx}/characters/player/portraits/default.png`,monsters:`${zx}/monsters/portraits/placeholder.png`,environments:`${zx}/environments/backgrounds/default-bg.png`,effects:`${zx}/effects/placeholder.png`,audio:""}[e]}}function Xx(e){if(!e.effect_value||e.effect_value<=0)return"";switch(e.type){case"potion":return e.description.includes("HP")||e.description.includes("Vida")?`+${e.effect_value} HP`:e.description.includes("Mana")?`+${e.effect_value} Mana`:`+${e.effect_value}`;case"buff":case"elixir":return e.description.includes("Força")||e.description.includes("ataque")?`+${e.effect_value} Ataque por 3 turnos`:e.description.includes("Defesa")?`+${e.effect_value} Defesa por 3 turnos`:`+${e.effect_value} por 3 turnos`;case"antidote":return"Remove efeitos negativos";default:return`+${e.effect_value}`}}function Wx(e,t){if(e&&"object"==typeof e){if("message"in e&&"string"==typeof e.message)return e.message;if(e instanceof Error)return e.message}return t}class Yx{static consumableCache=new Map;static dropCache=new Map;static recipeCache=new Map;static lastFetchTimestamp=0;static CACHE_DURATION=3e5;static async getAvailableConsumables(){try{const e=Date.now();if(e-this.lastFetchTimestamp<this.CACHE_DURATION&&this.consumableCache.size>0){return{data:Array.from(this.consumableCache.values()),error:null,success:!0}}const{data:t,error:s}=await Es.from("consumables").select("*").order("price");if(s)throw s;return this.consumableCache.clear(),t.forEach((e=>{this.consumableCache.set(e.id,e)})),this.lastFetchTimestamp=e,{data:t,error:null,success:!0}}catch(e){return{data:null,error:"Erro ao buscar consumíveis",success:!1}}}static async getCharacterConsumables(e){try{const{data:t,error:s}=await Es.from("character_consumables").select("\n          *,\n          consumable:consumable_id (*)\n        ").eq("character_id",e);if(s)throw s;return{data:t,error:null,success:!0}}catch(t){return{data:null,error:"Erro ao buscar consumíveis do personagem",success:!1}}}static async buyConsumable(e,t,s=1){try{const{data:a,error:r}=await Es.rpc("buy_consumable",{p_character_id:e,p_consumable_id:t,p_quantity:s}).single();if(r)throw r;return{data:{newGold:a},error:null,success:!0}}catch(a){return{data:null,error:Wx(a,"Erro ao comprar consumível"),success:!1}}}static async consumeItem(e,t,s){try{const{data:a,error:r}=await Es.from("character_consumables").select("\n          *,\n          consumable:consumable_id (*)\n        ").eq("character_id",e).eq("consumable_id",t).single();if(r)throw r;const n=a;if(!n||n.quantity<=0)return{data:null,error:"Você não possui este item",success:!1};const i=n.consumable;let o="";const l={};switch(i.type){case"potion":if(function(e){if("potion"!==e.type)return!1;const t=`${e.name} ${e.description}`.toLowerCase();return t.includes("vida")||t.includes("hp")||t.includes("health")||t.includes("cura")||t.includes("heal")||t.includes("restaura hp")||t.includes("recupera hp")}(i)){const e=Math.floor(Number(s.hp)||0),t=Math.floor(Number(s.max_hp)||1),a=Math.floor(Number(i.effect_value)||0),r=Math.min(t,e+a),n=r-e;s.hp=r,l.hp=r,o=n>0?`Recuperou ${n} HP!`:"HP já estava no máximo!"}else if(function(e){if("potion"!==e.type)return!1;const t=`${e.name} ${e.description}`.toLowerCase();return t.includes("mana")||t.includes("mp")||t.includes("magia")||t.includes("magic")||t.includes("energia")||t.includes("restaura mana")||t.includes("recupera mana")}(i)){const e=Math.floor(Number(s.mana)||0),t=Math.floor(Number(s.max_mana)||1),a=Math.floor(Number(i.effect_value)||0),r=Math.min(t,e+a),n=r-e;s.mana=r,l.mana=r,o=n>0?`Recuperou ${n} Mana!`:"Mana já estava no máximo!"}break;case"antidote":"active_effects"in s?(s.active_effects.debuffs=[],s.active_effects.dots=[],o="Todos os efeitos negativos foram removidos!"):o="Antídoto só pode ser usado durante batalhas!";break;case"buff":"active_effects"in s?i.description.includes("Força")||i.description.includes("ataque")?(s.atk+=i.effect_value,s.active_effects.buffs.push({type:"buff",value:i.effect_value,duration:3,source_spell:"elixir_strength"}),o=`Ataque aumentado em ${i.effect_value} por 3 turnos!`):(i.description.includes("Defesa")||i.description.includes("defesa"))&&(s.def+=i.effect_value,s.active_effects.buffs.push({type:"buff",value:i.effect_value,duration:3,source_spell:"elixir_defense"}),o=`Defesa aumentada em ${i.effect_value} por 3 turnos!`):o="Elixires só podem ser usados durante batalhas!"}const{error:c}=await Es.rpc("use_consumable",{p_character_id:e,p_consumable_id:t});if(c)throw c;if(Object.keys(l).length>0){const{error:t}=await Es.from("characters").update(l).eq("id",e);if(t)throw t}return{data:{message:o},error:null,success:!0}}catch(a){return{data:null,error:Wx(a,"Erro ao usar consumível"),success:!1}}}static async getMonsterDrops(){try{if(Date.now()-this.lastFetchTimestamp<this.CACHE_DURATION&&this.dropCache.size>0){return{data:Array.from(this.dropCache.values()),error:null,success:!0}}const{data:e,error:t}=await Es.from("monster_drops").select("*").order("rarity");if(t)throw t;return this.dropCache.clear(),e.forEach((e=>{this.dropCache.set(e.id,e)})),{data:e,error:null,success:!0}}catch(e){return{data:null,error:"Erro ao buscar drops",success:!1}}}static processMonsterDrops(e,t,s=1){const a=[];return t.forEach((t=>{const r=t.drop_chance*(1+.02*e)*s;if(Math.random()<=Math.min(.95,r)){const e=Math.floor(Math.random()*(t.max_quantity-t.min_quantity+1)+t.min_quantity);e>0&&a.push({drop_id:t.drop_id,quantity:e})}})),a}static async addDropsToInventory(e,t){try{if(0===t.length)return{data:0,error:null,success:!0};const s=t.map((e=>({drop_id:e.drop_id,quantity:e.quantity}))),{supabaseAdmin:a}=await d((async()=>{const{supabaseAdmin:e}=await Promise.resolve().then((()=>As));return{supabaseAdmin:e}}),void 0),{data:r,error:n}=await a.rpc("secure_process_combat_drops",{p_character_id:e,p_drops:s}).single();if(n)throw n;return{data:r,error:null,success:!0}}catch(s){return{data:null,error:Wx(s,"Erro ao processar drops"),success:!1}}}static async getCraftingRecipes(){try{if(Date.now()-this.lastFetchTimestamp<this.CACHE_DURATION&&this.recipeCache.size>0){return{data:Array.from(this.recipeCache.values()),error:null,success:!0}}const{data:e,error:t}=await Es.from("crafting_recipes").select("\n          *,\n          ingredients:crafting_ingredients (*)\n        ");if(t)throw t;return this.recipeCache.clear(),e.forEach((e=>{this.recipeCache.set(e.result_id,e)})),{data:e,error:null,success:!0}}catch(e){return{data:null,error:"Erro ao buscar receitas",success:!1}}}static async canCraftItem(e,t){try{const{data:s,error:a}=await Es.rpc("check_can_craft",{p_character_id:e,p_recipe_id:t});if(a)throw a;return{data:s,error:null,success:!0}}catch(s){return{data:null,error:Wx(s,"Erro ao verificar crafting"),success:!1}}}static async craftItem(e,t){try{const{error:s}=await Es.rpc("craft_item",{p_character_id:e,p_recipe_id:t});if(s)throw s;return{data:{message:"Item criado com sucesso!"},error:null,success:!0}}catch(s){return{data:null,error:Wx(s,"Erro ao criar item"),success:!1}}}static async getCharacterDrops(e){try{const{data:t,error:s}=await Es.from("character_drops").select("\n          *,\n          drop:drop_id (*)\n        ").eq("character_id",e);if(s)throw s;return{data:t,error:null,success:!0}}catch(t){return{data:null,error:"Erro ao buscar drops do personagem",success:!1}}}static async checkIngredients(e,t){try{const s=[];let a=!0;const[r,n]=await Promise.all([this.getCharacterConsumables(e),this.getCharacterDrops(e)]),i=r.success?r.data:[],o=n.success?n.data:[];for(const e of t)if("monster_drop"===e.item_type){const t=o?.find((t=>t.drop_id===e.item_id));if(!t||t.quantity<e.quantity){a=!1;const e=t?.drop?.name||"Item desconhecido";s.push(e)}}else if("consumable"===e.item_type){const t=i?.find((t=>t.consumable_id===e.item_id));if(!t||t.quantity<e.quantity){a=!1;const e=t?.consumable?.name||"Item desconhecido";s.push(e)}}return{data:{hasAll:a,missing:s},error:null,success:!0}}catch(s){return{data:null,error:"Erro ao verificar ingredientes",success:!1}}}static async getDropInfoByIds(e){try{if(0===e.length)return{data:[],error:null,success:!0};const{data:t,error:s}=await Es.from("monster_drops").select("id, name, description, rarity, value").in("id",e);return s?{data:null,error:s.message,success:!1}:{data:t||[],error:null,success:!0}}catch(t){return{data:null,error:"Erro ao buscar informações dos drops",success:!1}}}static async sellConsumablesBatch(e,t){try{const s=t.map((e=>e.consumable_id)),{data:a,error:r}=await Es.from("consumables").select("id, price").in("id",s);if(r)throw r;const n=new Map(a?.map((e=>[e.id,e.price]))||[]);let i=0;for(const e of t){const t=n.get(e.consumable_id)||0;i+=Math.floor(.4*t)*e.quantity}const{data:o,error:l}=await Es.from("characters").select("id, gold").eq("id",e).single();if(l)throw l;const c=(o?.gold||0)+i,{error:d}=await Es.from("characters").update({gold:c}).eq("id",e);if(d)throw d;for(const m of t){const{data:t,error:s}=await Es.from("character_consumables").select("quantity").eq("character_id",e).eq("consumable_id",m.consumable_id).single();if(s)throw s;const a=(t?.quantity||0)-m.quantity;if(a<=0){const{error:t}=await Es.from("character_consumables").delete().eq("character_id",e).eq("consumable_id",m.consumable_id);if(t)throw t}else{const{error:t}=await Es.from("character_consumables").update({quantity:a}).eq("character_id",e).eq("consumable_id",m.consumable_id);if(t)throw t}}return{data:{totalGoldEarned:i,itemsSold:t.length,newGold:c},error:null,success:!0}}catch(s){return{data:null,error:Wx(s,"Erro ao vender consumíveis"),success:!1}}}static async sellDropsBatch(e,t){try{const s=t.map((e=>e.drop_id)),{data:a,error:r}=await Es.from("monster_drops").select("id, value").in("id",s);if(r)throw r;const n=new Map(a?.map((e=>[e.id,e.value]))||[]);let i=0;for(const e of t){i+=(n.get(e.drop_id)||0)*e.quantity}const{data:o,error:l}=await Es.from("characters").select("id, gold").eq("id",e).single();if(l)throw l;const c=(o?.gold||0)+i,{error:d}=await Es.from("characters").update({gold:c}).eq("id",e);if(d)throw d;for(const m of t){const{data:t,error:s}=await Es.from("character_drops").select("quantity").eq("character_id",e).eq("drop_id",m.drop_id).single();if(s)throw s;const a=(t?.quantity||0)-m.quantity;if(a<=0){const{error:t}=await Es.from("character_drops").delete().eq("character_id",e).eq("drop_id",m.drop_id);if(t)throw t}else{const{error:t}=await Es.from("character_drops").update({quantity:a}).eq("character_id",e).eq("drop_id",m.drop_id);if(t)throw t}}return{data:{totalGoldEarned:i,itemsSold:t.length,newGold:c},error:null,success:!0}}catch(s){return{data:null,error:Wx(s,"Erro ao vender materiais"),success:!1}}}}var Kx="horizontal",Jx=["horizontal","vertical"],Qx=e.forwardRef(((e,s)=>{const{decorative:a,orientation:r=Kx,...n}=e,i=function(e){return Jx.includes(e)}(r)?r:Kx,o=a?{role:"none"}:{"aria-orientation":"vertical"===i?i:void 0,role:"separator"};return t.jsx(ne.div,{"data-orientation":i,...o,...n,ref:s})}));Qx.displayName="Separator";var Zx=Qx;const ef=e.forwardRef((({className:e,orientation:s="horizontal",decorative:a=!0,...r},n)=>t.jsx(Zx,{ref:n,decorative:a,orientation:s,className:Hs("shrink-0 bg-border","horizontal"===s?"h-[1px] w-full":"h-full w-[1px]",e),...r})));ef.displayName=Zx.displayName;const tf=({characterId:s,newEquipment:a,slotType:r,currentEquipment:n,showTitle:i=!0,compact:o=!1})=>{const[l,c]=e.useState([]),[d,m]=e.useState(!0),[u,h]=e.useState(null);e.useEffect((()=>{(async()=>{m(!0),h(null);try{const e=await Ah.getCharacterForGame(s,!0,!1);if(e.success&&e.data){const t=e.data,s=[];[{name:"Ataque",current:t.atk,bonus:a.atk_bonus},{name:"Defesa",current:t.def,bonus:a.def_bonus},{name:"Mana",current:t.max_mana,bonus:a.mana_bonus},{name:"Velocidade",current:t.speed,bonus:a.speed_bonus},{name:"HP",current:t.max_hp,bonus:a.hp_bonus},{name:"Chance Crítica",current:t.critical_chance||0,bonus:a.critical_chance_bonus},{name:"Dano Crítico",current:t.critical_damage||130,bonus:a.critical_damage_bonus},{name:"Duplo Ataque",current:t.double_attack_chance||0,bonus:a.double_attack_chance_bonus},{name:"Dano Mágico",current:t.magic_damage_bonus||0,bonus:a.magic_damage_bonus}].forEach((e=>{e.bonus>0&&s.push({stat_name:e.name,current_value:e.current,new_value:e.current+e.bonus,difference:e.bonus,is_improvement:e.bonus>0})})),c(s)}else h("Erro ao carregar stats do personagem")}catch(e){h("Erro ao carregar comparação")}finally{m(!1)}})()}),[s,a.id,r,n]);const p=e=>{const s=e.toLowerCase();return s.includes("attack")||s.includes("dano")?t.jsx(Z,{className:"w-3 h-3"}):s.includes("defense")||s.includes("defesa")?t.jsx(De,{className:"w-3 h-3"}):s.includes("speed")||s.includes("velocidade")?t.jsx(re,{className:"w-3 h-3"}):s.includes("hp")||s.includes("vida")?t.jsx(ae,{className:"w-3 h-3"}):t.jsx(ut,{className:"w-3 h-3"})},x=(e,s)=>0===s?t.jsx(jt,{className:"w-4 h-4 text-muted-foreground/60"}):e?t.jsx(Ie,{className:"w-4 h-4 text-emerald-400 drop-shadow-[0_0_6px_rgba(16,185,129,0.4)]"}):t.jsx(mt,{className:"w-4 h-4 text-red-400 drop-shadow-[0_0_6px_rgba(239,68,68,0.4)]"}),f=(e,t)=>{if(0===e)return"—";return`${t?"+":""}${e.toFixed(e%1==0?0:2)}`},g=(e,t)=>0===t?"text-muted-foreground/60":e?"text-emerald-400 drop-shadow-[0_0_6px_rgba(16,185,129,0.3)]":"text-red-400 drop-shadow-[0_0_6px_rgba(239,68,68,0.3)]";return d?t.jsx("div",{className:(o?"p-3":"p-6")+" border border-border/50 rounded-xl bg-card/40 backdrop-blur-sm",children:t.jsxs("div",{className:"flex items-center justify-center space-x-3",children:[t.jsx(T,{className:"w-5 h-5 animate-spin text-primary/70"}),t.jsx("span",{className:"text-sm text-muted-foreground font-medium",children:"Analisando modificações mágicas..."})]})}):u?t.jsx("div",{className:(o?"p-3":"p-6")+" border border-destructive/30 rounded-xl bg-destructive/5 backdrop-blur-sm",children:t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(re,{className:"w-4 h-4 text-destructive/70"}),t.jsx("p",{className:"text-sm text-destructive font-medium",children:u})]})}):0===l.length?t.jsx("div",{className:(o?"p-3":"p-6")+" border border-border/50 rounded-xl bg-card/30 backdrop-blur-sm",children:t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(ut,{className:"w-4 h-4 text-muted-foreground/60"}),t.jsx("p",{className:"text-sm text-muted-foreground font-medium",children:null===n?"Slot vazio — equipamento será adicionado":"Atributos inalterados"})]})}):t.jsxs("div",{className:`\n      ${o?"p-3":"p-6"} \n      border border-border/50 rounded-xl \n      bg-gradient-to-br from-card/80 to-card/40 \n      backdrop-blur-sm\n      transition-all duration-300 \n      hover:border-border/70 hover:shadow-lg hover:shadow-primary/5\n      card-enhanced\n    `,children:[i&&t.jsxs("div",{className:"flex items-center space-x-2 mb-4",children:[t.jsx(ut,{className:"w-4 h-4 text-primary/70"}),t.jsx("h4",{className:(o?"text-sm":"text-base")+" font-semibold text-foreground",children:"Modificações Mágicas"})]}),t.jsx("div",{className:"space-y-2",children:l.map(((e,s)=>{return t.jsxs("div",{className:`\n              relative overflow-hidden\n              rounded-lg border p-3\n              ${a=e.is_improvement,r=e.difference,0===r?"bg-muted/30 border-muted/40":a?"bg-emerald-500/10 border-emerald-500/30 magical-border":"bg-red-500/10 border-red-500/30"}\n              transition-all duration-200 hover:scale-[1.02]\n              ${o?"text-xs":"text-sm"}\n            `,children:[t.jsxs("div",{className:"flex items-center justify-between relative z-10",children:[t.jsxs("div",{className:"flex items-center space-x-2",children:[p(e.stat_name),t.jsx("span",{className:"font-medium text-foreground/90",children:e.stat_name})]}),t.jsxs("div",{className:"flex items-center space-x-3",children:[t.jsxs("div",{className:"text-right",children:[t.jsx("div",{className:"text-xs text-muted-foreground/70 font-medium uppercase tracking-wide",children:"Atual"}),t.jsx("div",{className:"font-mono font-semibold text-foreground/80",children:e.current_value.toFixed(e.current_value%1==0?0:2)})]}),t.jsxs("div",{className:"flex items-center space-x-1 min-w-[60px] justify-center",children:[x(e.is_improvement,e.difference),t.jsx("span",{className:`font-mono font-bold ${g(e.is_improvement,e.difference)}`,children:f(e.difference,e.is_improvement)})]}),t.jsxs("div",{className:"text-right",children:[t.jsx("div",{className:"text-xs text-muted-foreground/70 font-medium uppercase tracking-wide",children:"Novo"}),t.jsx("div",{className:"font-mono font-bold text-foreground",children:e.new_value.toFixed(e.new_value%1==0?0:2)})]})]})]}),0!==e.difference&&t.jsx("div",{className:"absolute inset-0 opacity-10",children:t.jsx("div",{className:`\n                  w-full h-full rounded-lg\n                  ${e.is_improvement?"bg-gradient-to-r from-emerald-500/20 to-emerald-400/10":"bg-gradient-to-r from-red-500/20 to-red-400/10"}\n                `})})]},s);var a,r}))}),!o&&t.jsx("div",{className:"mt-4 pt-3 border-t border-border/30",children:t.jsxs("div",{className:"flex items-center justify-center space-x-6 text-xs",children:[t.jsxs("div",{className:"flex items-center space-x-1.5 text-emerald-400/80",children:[t.jsx(Ie,{className:"w-3 h-3"}),t.jsx("span",{className:"font-medium",children:"Aprimoramento"})]}),t.jsxs("div",{className:"flex items-center space-x-1.5 text-red-400/80",children:[t.jsx(mt,{className:"w-3 h-3"}),t.jsx("span",{className:"font-medium",children:"Redução"})]}),t.jsxs("div",{className:"flex items-center space-x-1.5 text-muted-foreground/60",children:[t.jsx(jt,{className:"w-3 h-3"}),t.jsx("span",{className:"font-medium",children:"Inalterado"})]})]})})]})},sf=[{value:"all",label:"Todos",icon:Nt,color:"text-slate-400"},{value:"weapon",label:"Armas",icon:se,color:"text-red-400"},{value:"helmet",label:"Capacete",icon:Ye,color:"text-yellow-400"},{value:"chest",label:"Peitoral",icon:wt,color:"text-green-400"},{value:"legs",label:"Perneiras",icon:De,color:"text-cyan-400"},{value:"boots",label:"Botas",icon:_t,color:"text-orange-400"},{value:"armor",label:"Escudos",icon:De,color:"text-blue-400"},{value:"ring",label:"Anéis",icon:xt,color:"text-purple-400"},{value:"necklace",label:"Colar",icon:xt,color:"text-pink-400"},{value:"amulet",label:"Amuleto",icon:xt,color:"text-indigo-400"}],af=[{value:"name",label:"Nome",icon:Ct,color:"text-slate-400"},{value:"level",label:"Nível",icon:St,color:"text-blue-400"},{value:"rarity",label:"Raridade",icon:pt,color:"text-amber-400"},{value:"attack",label:"Ataque",icon:se,color:"text-red-400"},{value:"defense",label:"Defesa",icon:De,color:"text-blue-400"}],rf=({filterType:e,onFilterChange:s,sortType:a,onSortChange:r,compact:n=!1})=>t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{className:"space-y-2",children:[t.jsx("label",{className:"text-xs font-medium text-slate-400",children:"Tipo"}),t.jsx("div",{className:"grid gap-2 "+(n?"grid-cols-5 sm:grid-cols-10":"grid-cols-3 sm:grid-cols-5 lg:grid-cols-10"),children:sf.map((a=>{const r=a.icon,i=e===a.value;return t.jsxs(Ws,{variant:"ghost",size:n?"sm":"default",onClick:()=>s(a.value),className:`${i?`bg-slate-800/80 ${a.color} border border-slate-700`:`text-slate-500 hover:${a.color} hover:bg-slate-800/50`} ${n?"px-2 py-1.5":"px-3 py-2"} transition-all duration-200 flex items-center justify-center gap-1.5`,title:a.label,children:[t.jsx(r,{className:n?"h-3 w-3":"h-4 w-4"}),!n&&t.jsx("span",{className:"text-xs hidden sm:inline",children:a.label})]},a.value)}))})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsx("label",{className:"text-xs font-medium text-slate-400",children:"Ordenar por"}),t.jsx("div",{className:"grid gap-2 "+(n?"grid-cols-5":"grid-cols-2 sm:grid-cols-5"),children:af.map((e=>{const s=e.icon,i=a===e.value;return t.jsxs(Ws,{variant:"ghost",size:n?"sm":"default",onClick:()=>r(e.value),className:`${i?`bg-slate-800/80 ${e.color} border border-slate-700`:`text-slate-500 hover:${e.color} hover:bg-slate-800/50`} ${n?"px-2 py-1.5":"px-3 py-2"} transition-all duration-200 flex items-center justify-center gap-1.5`,title:e.label,children:[t.jsx(s,{className:n?"h-3 w-3":"h-4 w-4"}),t.jsx("span",{className:"text-xs "+(n?"hidden lg:inline":"hidden sm:inline"),children:e.label})]},e.value)}))})]})]}),nf=({isOpen:s,onClose:a,onConfirm:r,itemName:n,itemIcon:i,itemRarity:o,availableQuantity:l,unitSellPrice:c,originalPrice:d,isLoading:m=!1})=>{const[u,h]=e.useState(1),[p,x]=e.useState(!1);e.useEffect((()=>{s&&h(1)}),[s]);const f=u*c,g=d?Math.round(100*(1-c/d)):0,b=e=>{const t=Math.max(1,Math.min(e,l));h(t)};return s?t.jsx(Ph,{open:s,onOpenChange:a,children:t.jsxs(qh,{className:"max-w-md bg-slate-900/95 border-slate-700/50",children:[t.jsx(Dh,{children:t.jsxs(Lh,{className:"flex items-center gap-2 text-slate-100",children:[t.jsx(Et,{className:"h-5 w-5 text-amber-400"}),"Vender Item"]})}),t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"flex items-center gap-4 p-4 rounded-lg border border-slate-700/50 bg-slate-800/30",children:[t.jsx("div",{className:"flex-shrink-0",children:i||t.jsx(Et,{className:"h-8 w-8 text-slate-400"})}),t.jsxs("div",{className:"flex-1",children:[t.jsx("h3",{className:"font-semibold text-slate-100",children:n}),t.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[o&&t.jsx(_u,{className:`text-xs ${(e=>{const t={common:"border-slate-600 bg-slate-800/30 text-slate-300",uncommon:"border-emerald-600 bg-emerald-900/30 text-emerald-300",rare:"border-blue-600 bg-blue-900/30 text-blue-300",epic:"border-purple-600 bg-purple-900/30 text-purple-300",legendary:"border-amber-600 bg-amber-900/30 text-amber-300"};return t[e]||t.common})(o)}`,children:o}),t.jsxs("span",{className:"text-xs text-slate-400",children:["Disponível: ",l]})]})]})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsx($a,{htmlFor:"quantity",className:"text-sm font-medium text-slate-300",children:"Quantidade"}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(Ws,{variant:"outline",size:"sm",onClick:()=>b(u-1),disabled:u<=1||m,className:"h-8 w-8 p-0 border-slate-600",children:t.jsx(jt,{className:"h-3 w-3"})}),t.jsx(qa,{id:"quantity",type:"number",min:1,max:l,value:u,onChange:e=>b(parseInt(e.target.value)||1),disabled:m,className:"text-center bg-slate-800/50 border-slate-600 text-slate-100"}),t.jsx(Ws,{variant:"outline",size:"sm",onClick:()=>b(u+1),disabled:u>=l||m,className:"h-8 w-8 p-0 border-slate-600",children:t.jsx(We,{className:"h-3 w-3"})}),t.jsx(Ws,{variant:"outline",size:"sm",onClick:()=>h(l),disabled:u===l||m,className:"text-xs px-2 border-slate-600",children:"Máx"})]})]}),t.jsxs("div",{className:"space-y-3 p-4 rounded-lg border border-slate-700/50 bg-slate-800/20",children:[t.jsxs("div",{className:"flex items-center justify-between text-sm",children:[t.jsx("span",{className:"text-slate-400",children:"Preço unitário:"}),t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(Fe,{className:"h-3 w-3 text-amber-400"}),t.jsx("span",{className:"text-amber-300 font-medium",children:c})]})]}),d&&g>0&&t.jsxs("div",{className:"flex items-center justify-between text-sm",children:[t.jsx("span",{className:"text-slate-400",children:"Preço original:"}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("span",{className:"text-slate-500 line-through",children:d}),t.jsxs(_u,{variant:"outline",className:"text-xs text-red-400 border-red-400/30",children:["-",g,"%"]})]})]}),t.jsx("div",{className:"border-t border-slate-700/50 pt-3",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("span",{className:"font-medium text-slate-200",children:"Total:"}),t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(Fe,{className:"h-4 w-4 text-amber-400"}),t.jsx("span",{className:"text-lg font-bold text-amber-300",children:f})]})]})})]}),g>=70&&t.jsxs("div",{className:"flex items-start gap-2 p-3 rounded-lg bg-amber-900/20 border border-amber-600/30",children:[t.jsx(kt,{className:"h-4 w-4 text-amber-400 mt-0.5 flex-shrink-0"}),t.jsxs("div",{className:"text-xs text-amber-300",children:[t.jsx("p",{className:"font-medium",children:"Preço baixo de venda"}),t.jsxs("p",{className:"text-amber-400/80",children:["Você receberá apenas ",100-g,"% do valor original."]})]})]}),t.jsxs("div",{className:"flex gap-3",children:[t.jsx(Ws,{variant:"outline",onClick:a,disabled:p||m,className:"flex-1 border-slate-600 text-slate-300 hover:bg-slate-700/50",children:"Cancelar"}),t.jsx(Ws,{onClick:async()=>{if(u<=0||u>l)j.error("Quantidade inválida");else{x(!0);try{await r(u),a()}catch(e){}finally{x(!1)}}},disabled:p||m||u<=0,className:"flex-1 bg-amber-600 hover:bg-amber-700 text-white",children:p?t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-t border-b border-current"}),"Vendendo..."]}):`Vender por ${f} gold`})]})]})]})}):null},of={sm:"h-4 w-4",md:"h-6 w-6",lg:"h-8 w-8",xl:"h-12 w-12"};function lf({consumable:s,size:a="md",className:r="",showFallback:n=!0}){const[i,o]=e.useState(!1),[l,c]=e.useState(!0),d=(e=>{const t=e.name.toLowerCase().trim();return t.includes("vida")||t.includes("hp")||t.includes("health")?"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAAAAXNSR0IArs4c6QAAA2tJREFUeJztms9rE1EQx7+zkeSg/ZF4EFsisSS997SHtrRQyF9QEHqqCILXglQQRcSLCAUPPSgU2ktB6F/QU4t6yMmj0EgNhPbY2FQPe8g+D9vZvCTb2oM7E+N+YGH37bLvzbyZefN2B0hISEhISEj4XyGtjo0xpruNiMTHc026QyAQPpPJRLZLK0FcASz8kjuF8nQZu593w3uZTEZFCWIYY0w6nTbbT56Z4u1bPcfyrGvS6bSJco+4ENM0z/zmyiqeb70HAMwUC+H9T99qYdt25Qs8zxOJCU7cHXTDJs/C24LbCpFCJQjOFAsdgmsi4gJs/uO5LABgrlS49HlJF1CxgI/V7wAAFo9Dnq+QlojGgLlSAQ7aAb5lCMa0BXdg4MAgnxsNl8S4xyTqAgCw5E5hv1oD0OkKbBVM/eSHiBuIuYDneQCCZGfJnQIA7B0cAgCIHMyV7gIA9qs1pAQ9Ifau7Nn3PA8cDI3x24MgB8b4IHLgwMAH4eikIWIBYjFgPJftEJ6o3XX3tSSiq0A+N4rZc7/fr9bUhLZRyQPIIRj/4gDP5g/Ev0UWmQIiIs/zcHTS+OOztu8P1F7AVsKr+49ADoUHECyJL5cfSg2nPS6pjtgNNlZWcbC23nO/7pYAAAvTZTxYez24u8FU6uK4m69UBUcSILIKhN8CHj/F1zdvI5/JV6qBFaytY2NlVezrkMo6tDg03NPGLiCNuAKihNdEPxM5R8P/gT5QgG0RGkpQU8Di0HCPO2i4h8oXISblBzvCe9dvBA2+f8nT8aDuAlFcliv8bdQUkFKY7Sj60gIkEVfAzlmzb2YfULKAltM/hqcykp2zJj78+qnRdQ8qCuC8vx+UoKKAcOeHQAl8aKBmAbYSNFGNRlobIBuVVJgFD1NgBCtDS2EsqpshRnNZVLEAFr4f8gG1POAqbRKIK4Ajvy0wn++cNcVXBtFfY3duZjFTLFwY/etuCQvTZbzYfDd49QEAwAUfnAfY1N3Seb1AUEU2lh0R+TQuVh8wlh0J/wZzZYidDO0dHGJ+ciIsmjhunA5GfQD/EzxunAIIagFYyCjh5ycnAHRaQKzji/PlQKcFXJUUkViViLgFAOg4774+bpyiZYxYiYwYXCjNxdB83n3N51IF06LaZaGIiGwB7euBmfGEhISEhH+A382gtA6Q1PYKAAAAAElFTkSuQmCC":t.includes("mana")||t.includes("mp")?"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAAAAXNSR0IArs4c6QAAAoVJREFUeJztmj9r20AYxp+3EhmCIVBK6ZS5m7wEigul9lDI0jX5CMUe2obgrVPAS4u3QD5Ah7ZjVg/yEi0e2myZC4YEQsCQChokrkN7qmwsxSm9xyJ5f8v5z8l3z3PvvTrfCVAURVEURVGUO4kso1FjjCn6TkSoffKZjVnhnueV1mGaQDPAGGOs8EGvVVjP8zyqCfcYjVjxg14rE797mMwtB70WRKR0mvxPKC5bA4Inz/DhZXnQ7R4m+BoNYYyh5ANqDgD+jnRVcD4F7Og/+vx94Wsetr/QpgElBwBAJ6jh7O1HjOvtwjrjehvjeht+s8HqFjcHLBoFp1vrSNOUkgMoESAikqYpTrfWS+slYUQVDywhCSZhBL/ZQBJG7KbnQl0HAEC3uwkA8JuNwrluF0OMvjmPACv+watP6HY30R9NpjuQMyEJI+ydXADgrQidRsCseADY2VibW3aCGl6/eZFdu3dyQYkEZ+7OEw8A/dEEOxtrU2UnqBX+zrvH950mRec54Drxy4a2ECoS3wlq2D++BADsH19OvWZAMaBM/PtvP7LSfsY0wbkBP6/SrMyLj41kom0ZG8lEs9YJzg3Ij2J/NEFsBLEpzmdl37mAMgXsaLLFLQItCVaVyhrA+ktcSQOYU4VmwE1vabfmLmApW+4uE4oBfrNBW9ndlErmACaVNeDW3AWSMPqnrB4boSTCykYACzWA0cjK8AixEazK9btbts7K8Mhtp/5Ai4C8CbNG2PerYhAbAUs84PhkKL8vaLl6/rQwEmbFnx9sOz8kcb7ozp8J5I0o4/xgGwAoJ0S0s0Gg/NGYPGn6exeJcTxG3aFYdI+f/aCUoiiKoiiKoiiKotwxfgG1P0Ut6qsoewAAAABJRU5ErkJggg==":function(e){return Hx.getConsumableIcon(e)}(e)})(s),m=function(e){switch(e.type){case"potion":return e.description.includes("HP")||e.description.includes("Vida")?"❤️":e.description.includes("Mana")?"💙":"🧪";case"buff":case"elixir":return e.description.includes("Força")||e.description.includes("ataque")?"⚔️":e.description.includes("Defesa")?"🛡️":"✨";case"antidote":return"🌿";default:return"📦"}}(s),u=`${of[a]} ${r}`;return i&&n?t.jsx("div",{className:`${u} flex items-center justify-center text-slate-500`,title:`${s.name} (fallback)`,children:t.jsx("span",{className:"text-sm",children:m})}):t.jsxs("div",{className:`${u} relative`,children:[l&&t.jsx("div",{className:"absolute inset-0 bg-slate-700/50 animate-pulse rounded"}),t.jsx("img",{src:d,alt:s.name,className:`${u} object-contain ${l?"opacity-0":"opacity-100"} transition-opacity duration-200`,onLoad:()=>{c(!1),o(!1)},onError:()=>{c(!1),o(!0)},loading:"lazy"})]})}const cf=({character:s,availableEquipment:a,availableConsumables:r,onEquipmentPurchase:n,onConsumablePurchase:i,onOpenInventory:o,characterEquipment:l,characterConsumables:c,characterDrops:d,onSellEquipment:m,onSellConsumable:u,onSellDrop:h})=>{const[p,x]=e.useState("equipment"),[f,g]=e.useState(null),[b,v]=e.useState("all"),[y,j]=e.useState("name"),[N,w]=e.useState("all"),[_,C]=e.useState({isOpen:!1,type:null,item:null,sellPrice:null});e.useEffect((()=>{if(f)if("consumable"in f){const e=f;c.some((t=>t.id===e.id))||g(null)}else if("drop"in f){const e=f;d.some((t=>t.id===e.id))||g(null)}}),[c,d,f]);const S=a.filter((e=>"all"===b||e.type===b)).sort(((e,t)=>{switch(y){case"name":return e.name.localeCompare(t.name);case"level":return(t.level_requirement||0)-(e.level_requirement||0);case"rarity":{const s={common:1,uncommon:2,rare:3,epic:4,legendary:5};return(s[t.rarity]||0)-(s[e.rarity]||0)}case"attack":return t.atk_bonus-e.atk_bonus;case"defense":return t.def_bonus-e.def_bonus;default:return 0}})),E=r.filter((e=>"all"===N||e.type===N)),k=e=>{const t={common:"bg-slate-800/80 text-slate-300 border-slate-600",uncommon:"bg-emerald-900/80 text-emerald-300 border-emerald-600",rare:"bg-blue-900/80 text-blue-300 border-blue-600",epic:"bg-purple-900/80 text-purple-300 border-purple-600",legendary:"bg-amber-900/80 text-amber-300 border-amber-600"};return t[e]||t.common},A=e=>{switch(e){case"weapon":return t.jsx(se,{className:"h-4 w-4 text-red-400"});case"armor":return t.jsx(De,{className:"h-4 w-4 text-blue-400"});case"chest":return t.jsx(wt,{className:"h-4 w-4 text-green-400"});case"helmet":return t.jsx(Ye,{className:"h-4 w-4 text-yellow-400"});case"legs":return t.jsx(De,{className:"h-4 w-4 text-cyan-400"});case"boots":return t.jsx(_t,{className:"h-4 w-4 text-orange-400"});case"ring":return t.jsx(xt,{className:"h-4 w-4 text-purple-400"});case"necklace":return t.jsx(xt,{className:"h-4 w-4 text-pink-400"});case"amulet":return t.jsx(xt,{className:"h-4 w-4 text-indigo-400"});default:return t.jsx(Et,{className:"h-4 w-4 text-slate-400"})}},P=e=>{switch(e){case"potion":return t.jsx(ut,{className:"h-4 w-4 text-blue-500"});case"antidote":return t.jsx(De,{className:"h-4 w-4 text-green-500"});case"buff":return t.jsx(re,{className:"h-4 w-4 text-purple-500"});default:return t.jsx(Et,{className:"h-4 w-4"})}},M=e=>Math.floor(e.price*{common:.3,uncommon:.35,rare:.4,epic:.45,legendary:.5}[e.rarity]),T=e=>{if(!e.equipment)return null;const s=M(e.equipment),a=f?.id===e.id,r=!e.is_equipped;return t.jsx(fu,{className:`cursor-pointer transition-all duration-200 hover:shadow-lg hover:shadow-amber/20 border-slate-700/50 bg-slate-800/50 backdrop-blur-sm ${a?"ring-2 ring-amber-500/60 shadow-lg shadow-amber-500/30":""} ${r?"hover:bg-slate-800/70":"opacity-60 grayscale"}`,onClick:()=>r&&g(e),children:t.jsx(yu,{className:"p-3",children:t.jsxs("div",{className:"flex items-start gap-3",children:[t.jsx("div",{className:"flex-shrink-0 p-2 rounded-lg bg-slate-700/50",children:A(e.equipment.type)}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsx("h3",{className:"font-medium text-sm truncate text-slate-100",children:e.equipment.name}),t.jsx(_u,{variant:"outline",className:`text-xs border ${k(e.equipment.rarity)} mt-1`,children:e.equipment.rarity}),e.is_equipped?t.jsx("div",{className:"text-xs text-slate-500 mt-1",children:"Equipado (não pode vender)"}):t.jsxs("div",{className:"flex items-center gap-1 mt-2",children:[t.jsx(Fe,{className:"h-3 w-3 text-amber-400"}),t.jsx("span",{className:"text-xs font-medium text-amber-300",children:s})]})]})]})})},e.id)},q=e=>{if(!e.consumable)return null;const s=f?.id===e.id;return t.jsx(fu,{className:`cursor-pointer transition-all duration-200 hover:shadow-lg hover:shadow-amber/20 border-slate-700/50 bg-slate-800/50 backdrop-blur-sm ${s?"ring-2 ring-amber-500/60 shadow-lg shadow-amber-500/30":""} hover:bg-slate-800/70`,onClick:()=>g(e),children:t.jsx(yu,{className:"p-3",children:t.jsxs("div",{className:"flex items-start gap-3",children:[t.jsx("div",{className:"flex-shrink-0 p-2 rounded-lg bg-slate-700/50",children:P(e.consumable.type)}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsx("h3",{className:"font-medium text-sm truncate text-slate-100",children:e.consumable.name}),t.jsx("div",{className:"flex items-center gap-2 mt-1",children:t.jsxs("span",{className:"text-xs bg-slate-700/50 text-slate-300 px-1.5 py-0.5 rounded",children:["x",e.quantity]})})]})]})})},e.id)},D=e=>{if(!e.drop)return null;const s=f?.id===e.id;return t.jsx(fu,{className:`cursor-pointer transition-all duration-200 hover:shadow-lg hover:shadow-amber/20 border-slate-700/50 bg-slate-800/50 backdrop-blur-sm ${s?"ring-2 ring-amber-500/60 shadow-lg shadow-amber-500/30":""} hover:bg-slate-800/70`,onClick:()=>g(e),children:t.jsx(yu,{className:"p-3",children:t.jsxs("div",{className:"flex items-start gap-3",children:[t.jsx("div",{className:"flex-shrink-0 p-2 rounded-lg bg-slate-700/50",children:t.jsx(pt,{className:"h-4 w-4 text-amber-400"})}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsx("h3",{className:"font-medium text-sm truncate text-slate-100",children:e.drop.name}),t.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[t.jsx("span",{className:`text-xs ${k(e.drop.rarity)}`,children:e.drop.rarity}),t.jsxs("span",{className:"text-xs bg-slate-700/50 text-slate-300 px-1.5 py-0.5 rounded",children:["x",e.quantity]})]}),t.jsxs("div",{className:"flex items-center gap-1 mt-2",children:[t.jsx(Fe,{className:"h-3 w-3 text-amber-400"}),t.jsxs("span",{className:"text-xs font-medium text-amber-300",children:[e.drop.value," cada"]})]})]})]})})},e.id)};return t.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-4 h-full",children:[t.jsxs("div",{className:"lg:col-span-1 space-y-4",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center gap-2 bg-amber-900/20 border border-amber-700/30 px-3 py-1.5 rounded-lg",children:[t.jsx(Fe,{className:"h-4 w-4 text-amber-400"}),t.jsx("span",{className:"font-medium text-amber-300",children:s.gold})]}),t.jsxs(Ws,{variant:"outline",size:"sm",onClick:o,className:"border-slate-700 bg-slate-800/30 hover:bg-slate-700/50",children:[t.jsx(Et,{className:"h-4 w-4 mr-2"}),"Inventário"]})]}),t.jsxs("div",{className:"flex gap-2 p-1 bg-slate-800/30 rounded-lg border border-slate-700/30",children:[t.jsx(Ws,{variant:"equipment"===p?"default":"ghost",size:"sm",onClick:()=>{x("equipment"),g(null)},className:"flex-1 "+("equipment"===p?"bg-slate-700/50 text-slate-100":"text-slate-400 hover:text-slate-200 hover:bg-slate-700/30"),children:t.jsx(At,{className:"h-4 w-4"})}),t.jsx(Ws,{variant:"consumables"===p?"default":"ghost",size:"sm",onClick:()=>{x("consumables"),g(null)},className:"flex-1 "+("consumables"===p?"bg-slate-700/50 text-slate-100":"text-slate-400 hover:text-slate-200 hover:bg-slate-700/30"),children:t.jsx(vt,{className:"h-4 w-4"})}),t.jsx(Ws,{variant:"sell"===p?"default":"ghost",size:"sm",onClick:()=>{x("sell"),g(null)},className:"flex-1 "+("sell"===p?"bg-slate-700/50 text-slate-100":"text-slate-400 hover:text-slate-200 hover:bg-slate-700/30"),children:t.jsx(Pt,{className:"h-4 w-4"})})]}),"equipment"===p&&t.jsx("div",{className:"bg-slate-800/30 p-3 rounded-lg border border-slate-700/30",children:t.jsx(rf,{filterType:b,onFilterChange:v,sortType:y,onSortChange:j,compact:!0})}),"consumables"===p&&t.jsxs("div",{className:"flex gap-1 p-1 bg-slate-800/30 rounded-lg border border-slate-700/30",children:[t.jsx(Ws,{variant:"ghost",size:"sm",onClick:()=>w("all"),className:""+("all"===N?"bg-slate-700/50 text-slate-200":"text-slate-500 hover:text-slate-300 hover:bg-slate-700/30"),children:t.jsx(Nt,{className:"h-3 w-3"})}),t.jsx(Ws,{variant:"ghost",size:"sm",onClick:()=>w("potion"),className:""+("potion"===N?"bg-blue-900/30 text-blue-400 border border-blue-800/50":"text-slate-500 hover:text-blue-400 hover:bg-blue-900/20"),children:t.jsx(ut,{className:"h-3 w-3"})}),t.jsx(Ws,{variant:"ghost",size:"sm",onClick:()=>w("antidote"),className:""+("antidote"===N?"bg-emerald-900/30 text-emerald-400 border border-emerald-800/50":"text-slate-500 hover:text-emerald-400 hover:bg-emerald-900/20"),children:t.jsx(De,{className:"h-3 w-3"})}),t.jsx(Ws,{variant:"ghost",size:"sm",onClick:()=>w("buff"),className:""+("buff"===N?"bg-purple-900/30 text-purple-400 border border-purple-800/50":"text-slate-500 hover:text-purple-400 hover:bg-purple-900/20"),children:t.jsx(re,{className:"h-3 w-3"})})]}),t.jsx("div",{className:"max-h-[60vh] overflow-y-auto",children:"equipment"===p?0===S.length?t.jsxs("div",{className:"text-center py-8 text-slate-500",children:[t.jsx(Et,{className:"h-8 w-8 mx-auto mb-2 opacity-50"}),t.jsx("p",{className:"text-sm",children:"Nenhum equipamento encontrado"})]}):t.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-2 gap-2",children:S.map((e=>{const a=s.gold>=e.price,r=s.level>=e.level_requirement,n=a&&r&&e.is_unlocked,i=f?.id===e.id;return t.jsx(fu,{className:`cursor-pointer transition-all duration-200 hover:shadow-lg hover:shadow-primary/20 border-slate-700/50 bg-slate-800/50 backdrop-blur-sm ${i?"ring-2 ring-primary/60 shadow-lg shadow-primary/30":""} ${n?"hover:bg-slate-800/70":"opacity-60 grayscale"}`,onClick:()=>g(e),children:t.jsx(yu,{className:"p-1.5",children:t.jsxs("div",{className:"flex flex-col items-center text-center gap-1",children:[t.jsx("div",{className:"p-1.5 rounded bg-slate-700/50",children:A(e.type)}),t.jsxs("div",{className:"w-full",children:[t.jsx("h3",{className:"font-medium text-xs truncate text-slate-100",title:e.name,children:e.name.length>10?`${e.name.substring(0,10)}...`:e.name}),t.jsx(_u,{variant:"outline",className:`text-xs border ${k(e.rarity)} mt-1`,children:e.rarity}),t.jsxs("div",{className:"flex items-center justify-center gap-1 mt-1",children:[t.jsx(Fe,{className:"h-3 w-3 text-amber-400"}),t.jsx("span",{className:"text-xs font-medium text-amber-300",children:e.price})]}),e.atk_bonus>0?t.jsxs("div",{className:"text-xs text-red-400 mt-1",children:["+",e.atk_bonus," ATK"]}):e.def_bonus>0?t.jsxs("div",{className:"text-xs text-blue-400 mt-1",children:["+",e.def_bonus," DEF"]}):e.mana_bonus>0?t.jsxs("div",{className:"text-xs text-purple-400 mt-1",children:["+",e.mana_bonus," MP"]}):e.speed_bonus>0?t.jsxs("div",{className:"text-xs text-green-400 mt-1",children:["+",e.speed_bonus," SPD"]}):null]})]})})},e.id)}))}):"consumables"===p?0===E.length?t.jsxs("div",{className:"text-center py-8 text-slate-500",children:[t.jsx(vt,{className:"h-8 w-8 mx-auto mb-2 opacity-50"}),t.jsx("p",{className:"text-sm",children:"Nenhum consumível encontrado"})]}):t.jsx("div",{className:"space-y-2",children:E.map((e=>{const a=s.gold>=e.price,r=s.level>=(e.level_requirement||1),n=a&&r,i=f?.id===e.id;return t.jsx(fu,{className:`cursor-pointer transition-all duration-200 hover:shadow-lg hover:shadow-primary/20 border-slate-700/50 bg-slate-800/50 backdrop-blur-sm ${i?"ring-2 ring-primary/60 shadow-lg shadow-primary/30":""} ${n?"hover:bg-slate-800/70":"opacity-60 grayscale"}`,onClick:()=>g(e),children:t.jsx(yu,{className:"p-3",children:t.jsxs("div",{className:"flex items-start gap-3",children:[t.jsx("div",{className:"flex-shrink-0 p-2 rounded-lg bg-slate-700/50",children:P(e.type)}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsx("h3",{className:"font-medium text-sm truncate text-slate-100",children:e.name}),t.jsx("p",{className:"text-xs text-slate-400 mt-1",children:"potion"===e.type?`+${e.effect_value}`:"antidote"===e.type?"Remove debuffs":`+${e.effect_value} por 3 turnos`}),t.jsxs("div",{className:"flex items-center gap-1 mt-2",children:[t.jsx(Fe,{className:"h-3 w-3 text-amber-400"}),t.jsx("span",{className:"text-xs font-medium text-amber-300",children:e.price})]})]})]})})},e.id)}))}):(()=>{const e=l.filter((e=>!e.is_equipped)),s=c.filter((e=>e.quantity>0)),a=d.filter((e=>e.quantity>0));return e.length>0||s.length>0||a.length>0?t.jsxs("div",{className:"space-y-4",children:[e.length>0&&t.jsxs("div",{children:[t.jsxs("h3",{className:"text-sm font-semibold text-slate-300 mb-2 flex items-center gap-2",children:[t.jsx(se,{className:"h-4 w-4"}),"Equipamentos (",e.length,")"]}),t.jsx("div",{className:"space-y-2",children:e.map(T)})]}),s.length>0&&t.jsxs("div",{children:[t.jsxs("h3",{className:"text-sm font-semibold text-slate-300 mb-2 flex items-center gap-2",children:[t.jsx(ut,{className:"h-4 w-4"}),"Consumíveis (",s.length,")"]}),t.jsx("div",{className:"space-y-2",children:s.map(q)})]}),a.length>0&&t.jsxs("div",{children:[t.jsxs("h3",{className:"text-sm font-semibold text-slate-300 mb-2 flex items-center gap-2",children:[t.jsx(pt,{className:"h-4 w-4"}),"Materiais (",a.length,")"]}),t.jsx("div",{className:"space-y-2",children:a.map(D)})]})]}):t.jsxs("div",{className:"text-center py-12 text-slate-500",children:[t.jsx(Et,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),t.jsx("p",{className:"font-medium text-slate-400 mb-1",children:"Nenhum item para vender"}),t.jsx("p",{className:"text-sm opacity-75",children:"Derrote monstros e obtenha equipamentos para vender na loja"})]})})()})]}),t.jsx("div",{className:"lg:col-span-2",children:t.jsx(fu,{className:"h-full border-slate-700/50 bg-slate-800/30",children:t.jsx(yu,{className:"p-4 h-full",children:(()=>{if(!f)return t.jsx("div",{className:"flex items-center justify-center h-full text-slate-500",children:t.jsxs("div",{className:"text-center",children:[t.jsx(Et,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),t.jsx("p",{className:"text-lg",children:"Selecione um item para ver os detalhes"}),t.jsx("p",{className:"text-sm mt-2 opacity-75",children:"Clique em qualquer item da lista para visualizar suas informações completas"})]})});if("sell"===p){if("equipment"in f&&f.equipment){const e=f,s=e.equipment,a=M(s),r=!e.is_equipped;return t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{children:[t.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[t.jsx("div",{className:"p-3 rounded-lg bg-slate-700/50 border border-slate-600/50",children:A(s.type)}),t.jsx("h2",{className:"text-xl font-bold text-slate-100",children:s.name})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(_u,{className:`border ${k(s.rarity)}`,children:s.rarity}),t.jsx("span",{className:"text-sm text-slate-400",children:"weapon"===s.type?"Arma":"armor"===s.type?"Armadura":"Acessório"})]})]}),t.jsx(ef,{}),t.jsxs("div",{children:[t.jsx("h3",{className:"font-semibold mb-2 text-slate-200",children:"Descrição"}),t.jsx("p",{className:"text-sm text-slate-400 leading-relaxed",children:s.description})]}),t.jsxs("div",{children:[t.jsx("h3",{className:"font-semibold mb-3 text-slate-200",children:"Atributos"}),t.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[s.atk_bonus>0&&t.jsxs("div",{className:"flex items-center gap-2 p-3 bg-red-900/30 border border-red-800/50 rounded-lg backdrop-blur-sm",children:[t.jsx(se,{className:"h-4 w-4 text-red-400"}),t.jsxs("span",{className:"text-sm text-red-300 font-medium",children:["+",s.atk_bonus]})]}),s.def_bonus>0&&t.jsxs("div",{className:"flex items-center gap-2 p-3 bg-blue-900/30 border border-blue-800/50 rounded-lg backdrop-blur-sm",children:[t.jsx(De,{className:"h-4 w-4 text-blue-400"}),t.jsxs("span",{className:"text-sm text-blue-300 font-medium",children:["+",s.def_bonus]})]}),s.mana_bonus>0&&t.jsxs("div",{className:"flex items-center gap-2 p-3 bg-purple-900/30 border border-purple-800/50 rounded-lg backdrop-blur-sm",children:[t.jsx(xt,{className:"h-4 w-4 text-purple-400"}),t.jsxs("span",{className:"text-sm text-purple-300 font-medium",children:["+",s.mana_bonus]})]}),s.speed_bonus>0&&t.jsxs("div",{className:"flex items-center gap-2 p-3 bg-amber-900/30 border border-amber-800/50 rounded-lg backdrop-blur-sm",children:[t.jsx(re,{className:"h-4 w-4 text-amber-400"}),t.jsxs("span",{className:"text-sm text-amber-300 font-medium",children:["+",s.speed_bonus]})]})]})]}),t.jsxs("div",{children:[t.jsx("h3",{className:"font-semibold mb-2 text-slate-200",children:"Preço de Venda"}),t.jsxs("div",{className:"flex items-center gap-2 p-3 bg-amber-900/30 rounded-lg border border-amber-800/50",children:[t.jsx(Fe,{className:"h-4 w-4 text-amber-400"}),t.jsxs("span",{className:"font-medium text-amber-300",children:[a," gold"]})]})]}),t.jsx(Ws,{onClick:()=>m(e),disabled:!r,className:"w-full font-semibold "+(r?"bg-gradient-to-r from-amber-600 to-amber-500 hover:from-amber-700 hover:to-amber-600 shadow-lg shadow-amber-600/25":"bg-slate-700/50 text-slate-400 cursor-not-allowed"),children:r?`Vender por ${a} gold`:"Item Equipado (não pode vender)"})]})}if("consumable"in f&&f.consumable){const e=f,s=e.consumable;return t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{children:[t.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[t.jsx("div",{className:"p-3 rounded-lg bg-slate-700/50 border border-slate-600/50",children:P(s.type)}),t.jsx("h2",{className:"text-xl font-bold text-slate-100",children:s.name})]}),t.jsx("span",{className:"text-sm text-slate-400",children:"potion"===s.type?"Poção":"antidote"===s.type?"Antídoto":"Fortalecimento"})]}),t.jsx(ef,{}),t.jsxs("div",{children:[t.jsx("h3",{className:"font-semibold mb-2 text-slate-200",children:"Descrição"}),t.jsx("p",{className:"text-sm text-slate-400 leading-relaxed",children:s.description})]}),t.jsxs("div",{children:[t.jsx("h3",{className:"font-semibold mb-2 text-slate-200",children:"Quantidade Disponível"}),t.jsx("div",{className:"p-3 bg-slate-700/30 rounded-lg border border-slate-600/30",children:t.jsxs("span",{className:"text-lg font-bold text-slate-200",children:[e.quantity,"x"]})})]}),t.jsxs(Ws,{onClick:()=>(e=>{if(!e.consumable)return;const t=Math.floor(.4*e.consumable.price);C({isOpen:!0,type:"consumable",item:e,sellPrice:{canSell:!0,availableQuantity:e.quantity,unitSellPrice:t,originalPrice:e.consumable.price}})})(e),className:"w-full font-semibold bg-gradient-to-r from-amber-600 to-amber-500 hover:from-amber-700 hover:to-amber-600 shadow-lg shadow-amber-600/25",children:[t.jsx(Pt,{className:"h-4 w-4 mr-2"}),"Vender"]})]})}if("drop"in f&&f.drop){const e=f,s=e.drop;return t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{children:[t.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[t.jsx("div",{className:"p-3 rounded-lg bg-slate-700/50 border border-slate-600/50",children:t.jsx(pt,{className:"h-5 w-5 text-amber-400"})}),t.jsx("h2",{className:"text-xl font-bold text-slate-100",children:s.name})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(_u,{className:`border ${k(s.rarity)}`,children:s.rarity}),t.jsx("span",{className:"text-sm text-slate-400",children:"Material"})]})]}),t.jsx(ef,{}),t.jsxs("div",{children:[t.jsx("h3",{className:"font-semibold mb-2 text-slate-200",children:"Descrição"}),t.jsx("p",{className:"text-sm text-slate-400 leading-relaxed",children:s.description})]}),t.jsxs("div",{children:[t.jsx("h3",{className:"font-semibold mb-2 text-slate-200",children:"Quantidade Disponível"}),t.jsx("div",{className:"p-3 bg-slate-700/30 rounded-lg border border-slate-600/30",children:t.jsxs("span",{className:"text-lg font-bold text-slate-200",children:[e.quantity,"x"]})})]}),t.jsxs("div",{children:[t.jsx("h3",{className:"font-semibold mb-2 text-slate-200",children:"Preço de Venda"}),t.jsxs("div",{className:"flex items-center gap-2 p-3 bg-amber-900/30 rounded-lg border border-amber-800/50",children:[t.jsx(Fe,{className:"h-4 w-4 text-amber-400"}),t.jsxs("span",{className:"font-medium text-amber-300",children:[s.value," gold cada"]})]})]}),t.jsxs(Ws,{onClick:()=>(e=>{e.drop&&C({isOpen:!0,type:"drop",item:e,sellPrice:{canSell:!0,availableQuantity:e.quantity,unitSellPrice:e.drop.value,originalPrice:e.drop.value}})})(e),className:"w-full font-semibold bg-gradient-to-r from-amber-600 to-amber-500 hover:from-amber-700 hover:to-amber-600 shadow-lg shadow-amber-600/25",children:[t.jsx(Pt,{className:"h-4 w-4 mr-2"}),"Vender"]})]})}}const e=f;if("atk_bonus"in f){const a=e,r=s.gold>=a.price,i=s.level>=a.level_requirement,o=r&&i&&a.is_unlocked;return t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{children:[t.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[t.jsx("div",{className:"p-3 rounded-lg bg-slate-700/50 border border-slate-600/50",children:A(a.type)}),t.jsx("h2",{className:"text-xl font-bold text-slate-100",children:a.name})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(_u,{className:`border ${k(a.rarity)}`,children:a.rarity}),t.jsx("span",{className:"text-sm text-slate-400",children:"weapon"===a.type?"Arma":"armor"===a.type?"Armadura":"Acessório"})]})]}),t.jsx(ef,{}),t.jsxs("div",{children:[t.jsx("h3",{className:"font-semibold mb-2 text-slate-200",children:"Descrição"}),t.jsx("p",{className:"text-sm text-slate-400 leading-relaxed",children:a.description})]}),t.jsxs("div",{children:[t.jsx("h3",{className:"font-semibold mb-3 text-slate-200",children:"Atributos"}),t.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[a.atk_bonus>0&&t.jsxs("div",{className:"flex items-center gap-2 p-3 bg-red-900/30 border border-red-800/50 rounded-lg backdrop-blur-sm",children:[t.jsx(se,{className:"h-4 w-4 text-red-400"}),t.jsxs("span",{className:"text-sm text-red-300 font-medium",children:["+",a.atk_bonus]})]}),a.def_bonus>0&&t.jsxs("div",{className:"flex items-center gap-2 p-3 bg-blue-900/30 border border-blue-800/50 rounded-lg backdrop-blur-sm",children:[t.jsx(De,{className:"h-4 w-4 text-blue-400"}),t.jsxs("span",{className:"text-sm text-blue-300 font-medium",children:["+",a.def_bonus]})]}),a.mana_bonus>0&&t.jsxs("div",{className:"flex items-center gap-2 p-3 bg-purple-900/30 border border-purple-800/50 rounded-lg backdrop-blur-sm",children:[t.jsx(xt,{className:"h-4 w-4 text-purple-400"}),t.jsxs("span",{className:"text-sm text-purple-300 font-medium",children:["+",a.mana_bonus]})]}),a.speed_bonus>0&&t.jsxs("div",{className:"flex items-center gap-2 p-3 bg-amber-900/30 border border-amber-800/50 rounded-lg backdrop-blur-sm",children:[t.jsx(re,{className:"h-4 w-4 text-amber-400"}),t.jsxs("span",{className:"text-sm text-amber-300 font-medium",children:["+",a.speed_bonus]})]})]})]}),t.jsxs("div",{children:[t.jsx("h3",{className:"font-semibold mb-2 text-slate-200",children:"Comparação com Equipamento Atual"}),t.jsx(tf,{characterId:s.id,newEquipment:a,slotType:a.type,showTitle:!1,compact:!0})]}),t.jsxs("div",{children:[t.jsx("h3",{className:"font-semibold mb-2 text-slate-200",children:"Requisitos"}),t.jsxs("div",{className:"space-y-2",children:[t.jsxs("div",{className:"flex justify-between items-center p-2 bg-slate-700/30 rounded border border-slate-600/30",children:[t.jsx("span",{className:"text-sm text-slate-300",children:"Nível:"}),t.jsx("span",{className:"text-sm font-medium "+(i?"text-emerald-400":"text-red-400"),children:a.level_requirement})]}),t.jsxs("div",{className:"flex justify-between items-center p-2 bg-slate-700/30 rounded border border-slate-600/30",children:[t.jsx("span",{className:"text-sm text-slate-300",children:"Preço:"}),t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(Fe,{className:"h-3 w-3 text-amber-400"}),t.jsx("span",{className:"text-sm font-medium "+(r?"text-emerald-400":"text-red-400"),children:a.price})]})]})]})]}),t.jsx(Ws,{onClick:()=>n(a),disabled:!o,className:"w-full font-semibold "+(o?"bg-gradient-to-r from-primary to-primary/80 hover:from-primary/90 hover:to-primary/70 shadow-lg shadow-primary/25":"bg-slate-700/50 text-slate-400 cursor-not-allowed"),children:a.is_unlocked?i?r?"Comprar":"Gold Insuficiente":`Requer Nível ${a.level_requirement}`:"Item Bloqueado"})]})}{const a=e,r=s.gold>=a.price,n=s.level>=(a.level_requirement||1),o=r&&n;return t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{children:[t.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[t.jsx("div",{className:"p-3 rounded-lg bg-slate-700/50 border border-slate-600/50",children:P(a.type)}),t.jsx("h2",{className:"text-xl font-bold text-slate-100",children:a.name})]}),t.jsx("span",{className:"text-sm text-slate-400",children:"potion"===a.type?"Poção":"antidote"===a.type?"Antídoto":"Fortalecimento"})]}),t.jsx(ef,{}),t.jsxs("div",{children:[t.jsx("h3",{className:"font-semibold mb-2 text-slate-200",children:"Descrição"}),t.jsx("p",{className:"text-sm text-slate-400 leading-relaxed",children:a.description})]}),t.jsxs("div",{children:[t.jsx("h3",{className:"font-semibold mb-2 text-slate-200",children:"Efeito"}),t.jsx("div",{className:"p-3 bg-emerald-900/30 border border-emerald-800/50 rounded-lg backdrop-blur-sm",children:t.jsx("span",{className:"text-sm text-emerald-300",children:"potion"===a.type?`Restaura ${a.effect_value} pontos`:"antidote"===a.type?"Remove todos os efeitos negativos":`Aumenta atributo em ${a.effect_value} por 3 turnos`})})]}),t.jsxs("div",{children:[t.jsx("h3",{className:"font-semibold mb-2 text-slate-200",children:"Preço"}),t.jsxs("div",{className:"flex items-center gap-2 p-3 bg-slate-700/30 rounded-lg border border-slate-600/30",children:[t.jsx(Fe,{className:"h-4 w-4 text-amber-400"}),t.jsxs("span",{className:"font-medium "+(r?"text-emerald-400":"text-red-400"),children:[a.price," gold cada"]})]})]}),t.jsxs("div",{className:"space-y-3",children:[t.jsx("h3",{className:"font-semibold text-slate-200",children:"Comprar"}),t.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[t.jsx(Ws,{onClick:()=>i(a,1),disabled:!o,size:"sm",className:""+(o?"bg-gradient-to-r from-primary to-primary/80 hover:from-primary/90 hover:to-primary/70 shadow-md shadow-primary/20":"bg-slate-700/50 text-slate-400 cursor-not-allowed"),children:"1x"}),t.jsx(Ws,{onClick:()=>i(a,5),disabled:!o||s.gold<5*a.price,size:"sm",variant:"outline",className:"border-slate-600 "+(!o||s.gold<5*a.price?"bg-slate-700/50 text-slate-400 cursor-not-allowed border-slate-700":"bg-slate-800/50 text-slate-300 hover:bg-slate-700/50 hover:text-slate-100"),children:"5x"}),t.jsx(Ws,{onClick:()=>i(a,10),disabled:!o||s.gold<10*a.price,size:"sm",variant:"outline",className:"border-slate-600 "+(!o||s.gold<10*a.price?"bg-slate-700/50 text-slate-400 cursor-not-allowed border-slate-700":"bg-slate-800/50 text-slate-300 hover:bg-slate-700/50 hover:text-slate-100"),children:"10x"})]})]})]})}})()})})}),t.jsx(nf,{isOpen:_.isOpen,onClose:()=>C({isOpen:!1,type:null,item:null,sellPrice:null}),onConfirm:async e=>{_.item&&_.type&&("consumable"===_.type?await u(_.item,e):"drop"===_.type&&await h(_.item,e),g(null),C({isOpen:!1,type:null,item:null,sellPrice:null}))},itemName:"consumable"===_.type?_.item?.consumable?.name||"":"drop"===_.type&&_.item?.drop?.name||"",itemIcon:"consumable"===_.type&&_.item&&_.item.consumable?t.jsx(lf,{consumable:_.item.consumable,size:"lg"}):t.jsx(pt,{className:"h-8 w-8 text-amber-400"}),itemRarity:"drop"===_.type?_.item?.drop?.rarity:void 0,availableQuantity:_.sellPrice?.availableQuantity||0,unitSellPrice:_.sellPrice?.unitSellPrice||0,originalPrice:_.sellPrice?.originalPrice})]})},df=({character:s,isOpen:a,onClose:r,onItemSold:n})=>{const[i,o]=e.useState([]),[l,c]=e.useState([]),[d,m]=e.useState([]),[u,h]=e.useState(!1),[p,x]=e.useState(null),[f,g]=e.useState({isOpen:!1,type:null,item:null,sellPrice:null});e.useEffect((()=>{a&&s.id&&b()}),[a,s.id]);const b=async()=>{h(!0);try{const[e,t,a]=await Promise.all([_h.getCharacterEquipment(s.id),Yx.getCharacterConsumables(s.id),Yx.getCharacterDrops(s.id)]);o(e||[]),c(t.success&&t.data||[]),m(a.success&&a.data||[])}catch(e){j.error("Erro ao carregar inventário")}finally{h(!1)}},v=async(e,t)=>{if(e.equipment){try{if("toggle"===t){(await _h.toggleEquipment(s.id,e.equipment.id,!e.is_equipped)).success&&(j.success(e.is_equipped?"Item desequipado!":"Item equipado!"),b())}else if("sell"===t){const t=await _h.sellEquipment(s.id,e.equipment.id);t.success&&void 0!==t.data?.newGold?(j.success(`${e.equipment.name} vendido!`),n(t.data.newGold),b()):j.error(t.error||"Erro ao vender equipamento")}}catch(a){j.error("Erro ao executar ação")}x(null)}},y=e=>{const t={common:"text-slate-400",uncommon:"text-emerald-400",rare:"text-blue-400",epic:"text-purple-400",legendary:"text-amber-400"};return t[e]||t.common},N=e=>Math.floor(e.price*{common:.3,uncommon:.35,rare:.4,epic:.45,legendary:.5}[e.rarity]),w=e=>{const s={equipment:{icon:t.jsx(Et,{className:"h-12 w-12 mx-auto mb-3 opacity-40"}),title:"Nenhum equipamento",description:"Visite a loja ou derrote monstros para obter equipamentos"},consumables:{icon:t.jsx(ut,{className:"h-12 w-12 mx-auto mb-3 opacity-40"}),title:"Nenhum consumível",description:"Compre poções na loja para ajudar em suas aventuras"},drops:{icon:t.jsx(pt,{className:"h-12 w-12 mx-auto mb-3 opacity-40"}),title:"Nenhum material",description:"Derrote monstros para coletar materiais valiosos"}}[e];return t.jsxs("div",{className:"text-center py-12 text-slate-500",children:[s.icon,t.jsx("p",{className:"font-medium text-slate-400 mb-1",children:s.title}),t.jsx("p",{className:"text-sm opacity-75",children:s.description})]})};return u?t.jsx(Ph,{open:a,onOpenChange:r,children:t.jsxs(qh,{className:"max-w-md",children:[t.jsx(Mt,{children:t.jsx(Lh,{children:"Carregando Inventário"})}),t.jsxs("div",{className:"flex items-center justify-center p-8",children:[t.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-t-2 border-b-2 border-primary"}),t.jsx("span",{className:"ml-2 text-slate-300",children:"Carregando..."})]})]})}):t.jsxs(t.Fragment,{children:[t.jsx(Ph,{open:a,onOpenChange:r,children:t.jsxs(qh,{className:"max-w-md max-h-[80vh] bg-slate-900/95 border-slate-700/50",onClick:e=>{e.target===e.currentTarget&&x(null)},children:[t.jsx(Dh,{className:"pb-2",children:t.jsxs(Lh,{className:"flex items-center justify-between text-slate-100",children:[t.jsx("span",{children:"Inventário"}),t.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[t.jsx(Fe,{className:"h-4 w-4 text-amber-400"}),t.jsx("span",{className:"text-amber-300",children:(s.gold||0).toLocaleString()})]})]})}),t.jsxs(np,{defaultValue:"equipment",className:"w-full",children:[t.jsxs(ip,{className:"grid w-full grid-cols-3 bg-slate-800/50",children:[t.jsxs(op,{value:"equipment",className:"text-xs",children:["Equipamentos (",i.length,")"]}),t.jsxs(op,{value:"consumables",className:"text-xs",children:["Consumíveis (",l.filter((e=>e.quantity>0)).length,")"]}),t.jsxs(op,{value:"drops",className:"text-xs",children:["Materiais (",d.filter((e=>e.quantity>0)).length,")"]})]}),t.jsx(lp,{value:"equipment",className:"mt-4",children:t.jsx("div",{className:"space-y-2 max-h-[50vh] overflow-y-auto",children:0===i.length?w("equipment"):i.map((e=>{if(!e.equipment)return null;const a=p===e.id;return t.jsxs("div",{className:"relative",children:[t.jsxs("div",{className:`flex items-center gap-3 p-3 rounded-lg border transition-all cursor-pointer ${e.is_equipped?"bg-primary/10 border-primary/30":"bg-slate-800/30 border-slate-700/30 hover:bg-slate-700/30"} ${a?"ring-2 ring-primary/50":""}`,onClick:()=>x(a?null:e.id),children:[t.jsx("div",{className:"flex-shrink-0",children:(r=e.equipment.type,"weapon"===r?t.jsx(se,{className:"h-4 w-4"}):"armor"===r?t.jsx(De,{className:"h-4 w-4"}):"accessory"===r?t.jsx(xt,{className:"h-4 w-4"}):"potion"===r?t.jsx(ae,{className:"h-4 w-4"}):t.jsx(Et,{className:"h-4 w-4"}))}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("span",{className:"text-sm font-medium text-slate-200 truncate",children:e.equipment.name}),e.is_equipped&&t.jsx("span",{className:"text-xs bg-primary/20 text-primary px-1.5 py-0.5 rounded",children:"Equipado"})]}),t.jsxs("div",{className:"flex items-center gap-2 text-xs text-slate-400",children:[t.jsx("span",{className:y(e.equipment.rarity),children:e.equipment.rarity}),e.equipment.atk_bonus>0&&t.jsxs("span",{className:"text-red-400",children:["+",e.equipment.atk_bonus," ATK"]}),e.equipment.def_bonus>0&&t.jsxs("span",{className:"text-blue-400",children:["+",e.equipment.def_bonus," DEF"]})]})]}),t.jsxs("div",{className:"text-xs text-amber-400",children:[t.jsx(Fe,{className:"h-3 w-3 inline mr-1"}),N(e.equipment)]})]}),a&&t.jsxs("div",{className:"absolute top-full left-0 right-0 z-10 mt-1 bg-slate-800 border border-slate-600 rounded-lg p-3 shadow-lg space-y-3",children:[!e.is_equipped&&t.jsxs("div",{children:[t.jsx("h4",{className:"text-xs font-semibold text-slate-200 mb-2",children:"Comparação se Equipado"}),t.jsx(tf,{characterId:s.id,newEquipment:e.equipment,slotType:e.equipment.type,showTitle:!1,compact:!0})]}),t.jsxs("div",{className:"flex gap-2",children:[t.jsx(Ws,{size:"sm",variant:e.is_equipped?"secondary":"default",onClick:()=>v(e,"toggle"),className:"flex-1 text-xs",children:e.is_equipped?"Desequipar":"Equipar"}),!e.is_equipped&&t.jsxs(Ws,{size:"sm",variant:"destructive",onClick:()=>v(e,"sell"),className:"flex-1 text-xs",children:[t.jsx(Pt,{className:"h-3 w-3 mr-1"}),"Vender"]})]})]})]},e.id);var r}))})}),t.jsx(lp,{value:"consumables",className:"mt-4",children:t.jsx("div",{className:"space-y-2 max-h-[50vh] overflow-y-auto",children:0===l.filter((e=>e.quantity>0)).length?w("consumables"):l.filter((e=>e.quantity>0)).map((e=>{if(!e.consumable)return null;const a=p===e.id,r=(e=>{if(!e.consumable)return!1;if("potion"===e.consumable.type){if(e.consumable.description.includes("HP")&&s.hp>=s.max_hp)return!1;if(e.consumable.description.includes("Mana")&&s.mana>=s.max_mana)return!1}return!0})(e);return t.jsxs("div",{className:"relative",children:[t.jsxs("div",{className:`flex items-center gap-3 p-3 rounded-lg border transition-all cursor-pointer ${r?"bg-slate-800/30 border-slate-700/30 hover:bg-slate-700/30":"bg-slate-800/20 border-slate-700/20 opacity-60"} ${a?"ring-2 ring-primary/50":""}`,onClick:()=>x(a?null:e.id),children:[t.jsx("div",{className:"flex-shrink-0",children:"potion"===e.consumable.type&&e.consumable.description.includes("HP")?t.jsx(ae,{className:"h-5 w-5 text-red-400"}):"potion"===e.consumable.type&&e.consumable.description.includes("Mana")?t.jsx(re,{className:"h-5 w-5 text-blue-400"}):t.jsx(ut,{className:"h-5 w-5 text-purple-400"})}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("span",{className:"text-sm font-medium text-slate-200 truncate",children:e.consumable.name}),t.jsxs("span",{className:"text-xs bg-slate-700/50 text-slate-300 px-1.5 py-0.5 rounded",children:["x",e.quantity]})]}),t.jsx("div",{className:"text-xs text-slate-400",children:Xx(e.consumable)})]})]}),a&&t.jsx("div",{className:"absolute top-full left-0 right-0 z-10 mt-1 bg-slate-800 border border-slate-600 rounded-lg p-2 shadow-lg",children:t.jsxs("div",{className:"flex gap-2",children:[r&&t.jsx(Ws,{size:"sm",onClick:()=>(async e=>{if(e.consumable){try{const t=await Yx.consumeItem(s.id,e.consumable_id,s);t.success?(j.success("Item usado com sucesso!"),b(),n(s.gold||0)):j.error(t.error||"Erro ao usar item")}catch(t){j.error("Erro ao usar item")}x(null)}})(e),className:"flex-1 text-xs",children:"Usar Agora"}),t.jsxs(Ws,{size:"sm",variant:"outline",onClick:()=>(async e=>{if(e.consumable){try{const t=Math.floor(.4*e.consumable.price);g({isOpen:!0,type:"consumable",item:e,sellPrice:{canSell:!0,availableQuantity:e.quantity,unitSellPrice:t,originalPrice:e.consumable.price}})}catch(t){j.error("Erro ao calcular preço de venda")}x(null)}})(e),className:"flex-1 text-xs border-slate-600 text-slate-300",children:[t.jsx(Pt,{className:"h-3 w-3 mr-1"}),"Vender"]})]})})]},e.id)}))})}),t.jsx(lp,{value:"drops",className:"mt-4",children:t.jsx("div",{className:"space-y-2 max-h-[50vh] overflow-y-auto",children:0===d.filter((e=>e.quantity>0)).length?w("drops"):d.filter((e=>e.quantity>0)).map((e=>{if(!e.drop)return null;const s=p===e.id;return t.jsxs("div",{className:"relative",children:[t.jsxs("div",{className:"flex items-center gap-3 p-3 rounded-lg border transition-all cursor-pointer bg-slate-800/30 border-slate-700/30 hover:bg-slate-700/30 "+(s?"ring-2 ring-primary/50":""),onClick:()=>x(s?null:e.id),children:[t.jsx("div",{className:"flex-shrink-0",children:t.jsx(pt,{className:"h-5 w-5 text-amber-400"})}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("span",{className:"text-sm font-medium text-slate-200 truncate",children:e.drop.name}),t.jsxs("span",{className:"text-xs bg-slate-700/50 text-slate-300 px-1.5 py-0.5 rounded",children:["x",e.quantity]})]}),t.jsxs("div",{className:"flex items-center gap-2 text-xs",children:[t.jsx("span",{className:y(e.drop.rarity),children:e.drop.rarity}),t.jsxs("span",{className:"text-amber-400",children:[e.drop.value," gold cada"]})]})]})]}),s&&t.jsx("div",{className:"absolute top-full left-0 right-0 z-10 mt-1 bg-slate-800 border border-slate-600 rounded-lg p-2 shadow-lg",children:t.jsxs(Ws,{size:"sm",variant:"outline",onClick:()=>(async e=>{if(e.drop){try{const t=e.drop.value;g({isOpen:!0,type:"drop",item:e,sellPrice:{canSell:!0,availableQuantity:e.quantity,unitSellPrice:t,originalPrice:e.drop.value}})}catch(t){j.error("Erro ao calcular preço de venda")}x(null)}})(e),className:"w-full text-xs border-slate-600 text-slate-300",children:[t.jsx(Pt,{className:"h-3 w-3 mr-1"}),"Vender Material"]})})]},e.id)}))})})]})]})}),t.jsx(nf,{isOpen:f.isOpen,onClose:()=>g({isOpen:!1,type:null,item:null,sellPrice:null}),onConfirm:async e=>{if(f.item&&f.type){try{if("consumable"===f.type){const t=f.item,a=await Yx.sellConsumablesBatch(s.id,[{consumable_id:t.consumable_id,quantity:e}]);a.success&&a.data?(j.success(`Vendido ${e}x ${t.consumable?.name} por ${a.data.totalGoldEarned} gold!`),n(a.data.newGold),b()):j.error(a.error||"Erro ao vender consumível")}else if("drop"===f.type){const t=f.item,a=await Yx.sellDropsBatch(s.id,[{drop_id:t.drop_id,quantity:e}]);a.success&&a.data?(j.success(`Vendido ${e}x ${t.drop?.name} por ${a.data.totalGoldEarned} gold!`),n(a.data.newGold),b()):j.error(a.error||"Erro ao vender material")}}catch(t){j.error("Erro ao vender item")}g({isOpen:!1,type:null,item:null,sellPrice:null})}},itemName:"consumable"===f.type?f.item?.consumable?.name||"":"drop"===f.type&&f.item?.drop?.name||"",itemIcon:"consumable"===f.type&&f.item&&f.item.consumable?t.jsx(lf,{consumable:f.item.consumable,size:"lg"}):t.jsx(pt,{className:"h-8 w-8 text-amber-400"}),itemRarity:"drop"===f.type?f.item?.drop?.rarity:void 0,availableQuantity:f.sellPrice?.availableQuantity||0,unitSellPrice:f.sellPrice?.unitSellPrice||0,originalPrice:f.sellPrice?.originalPrice})]})},mf=({character:s,onPurchase:a})=>{const[r,n]=e.useState([]),[i,o]=e.useState([]),[l,d]=e.useState(!0),[m,u]=e.useState(!1),[h,p]=e.useState([]),[x,f]=e.useState([]),[g,b]=e.useState([]),v=c.useCallback((async(e=!1)=>{try{let t=0;e?t=window.scrollY||document.documentElement.scrollTop:d(!0);const a=await _h.getAvailableEquipment(s.level);n(a);const r=await Yx.getAvailableConsumables();if(r.success&&r.data){const e=r.data.filter((e=>{const t=e.price>0,s=!e.name.includes("Pergaminho");return t&&s}));o(e)}e&&requestAnimationFrame((()=>{window.scrollTo(0,t)}))}catch(t){j.error("Erro ao carregar itens da loja")}finally{e||d(!1)}}),[s.level]),y=c.useCallback((async()=>{try{const[e,t,a]=await Promise.all([_h.getCharacterEquipment(s.id),Yx.getCharacterConsumables(s.id),Yx.getCharacterDrops(s.id)]);p(e||[]),f(t.success&&t.data||[]),b(a.success&&a.data||[])}catch(e){}}),[s.id]);e.useEffect((()=>{v(),y()}),[v,y]);return l?t.jsxs("div",{className:"flex items-center justify-center p-8",children:[t.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-t-2 border-b-2 border-primary mr-4"}),t.jsx("span",{children:"Carregando loja..."})]}):t.jsxs(t.Fragment,{children:[t.jsx(cf,{character:s,availableEquipment:r,availableConsumables:i,onEquipmentPurchase:async e=>{if(s.gold<e.price)j.error("Gold insuficiente para comprar este item!");else try{const t=await _h.buyEquipment(s.id,e.id);t.success&&void 0!==t.data?.newGold?(j.success(`${e.name} comprado com sucesso!`),a(t.data.newGold)):j.error(t.error||"Erro ao comprar equipamento!")}catch(t){j.error("Erro ao comprar equipamento!")}},onConsumablePurchase:async(e,t=1)=>{const r=e.price*t;if(s.gold<r)j.error("Gold insuficiente para comprar este item!");else try{const r=await Yx.buyConsumable(s.id,e.id,t);r.success&&r.data?(j.success(`${t}x ${e.name} comprado com sucesso!`),a(r.data.newGold)):j.error(r.error||"Erro ao comprar consumível!")}catch(n){j.error("Erro ao comprar consumível!")}},onOpenInventory:()=>u(!0),characterEquipment:h,characterConsumables:x,characterDrops:g,onSellEquipment:async e=>{if(e.equipment)try{const t=await _h.sellEquipment(s.id,e.equipment.id);t.success&&void 0!==t.data?.newGold?(j.success(`${e.equipment.name} vendido com sucesso!`),a(t.data.newGold),await y()):j.error(t.error||"Erro ao vender equipamento")}catch(t){j.error("Erro ao vender equipamento")}},onSellConsumable:async(e,t)=>{if(e.consumable)try{const r=await Yx.sellConsumablesBatch(s.id,[{consumable_id:e.consumable_id,quantity:t}]);r.success&&r.data?(j.success(`Vendido ${t}x ${e.consumable.name} por ${r.data.totalGoldEarned} gold!`),a(r.data.newGold),await y()):j.error(r.error||"Erro ao vender consumível")}catch(r){j.error("Erro ao vender consumível")}},onSellDrop:async(e,t)=>{if(e.drop)try{const r=await Yx.sellDropsBatch(s.id,[{drop_id:e.drop_id,quantity:t}]);r.success&&r.data?(j.success(`Vendido ${t}x ${e.drop.name} por ${r.data.totalGoldEarned} gold!`),a(r.data.newGold),await y()):j.error(r.error||"Erro ao vender material")}catch(r){j.error("Erro ao vender material")}}}),t.jsx(df,{character:s,isOpen:m,onClose:()=>u(!1),onItemSold:e=>{a(e)}})]})};const uf=r("/_authenticated/game/play/hub/shop")({component:function(){const s=n(),{character:a}=uf.useSearch(),[r,i]=e.useState(null),[o,l]=e.useState(!0),[c,d]=e.useState(null);e.useEffect((()=>{m()}),[a]);const m=async()=>{if(a)try{l(!0),d(null);const e=await Ah.getCharacter(a);if(e.success&&e.data)i(e.data);else{const t=e.error||"Erro desconhecido ao carregar personagem";d(t),j.error("Erro ao carregar personagem",{description:t})}}catch(e){const t=e instanceof Error?e.message:"Erro desconhecido";d(t),j.error("Erro ao carregar personagem",{description:t})}finally{l(!1)}else s({to:"/game/play"})};return o?t.jsx("div",{className:"min-h-screen flex flex-col items-center justify-center bg-gradient-to-b from-background to-secondary p-4",children:t.jsxs("div",{className:"text-center",children:[t.jsx("div",{className:"inline-block animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-primary mb-4"}),t.jsx("h2",{className:"text-2xl font-bold mb-2",children:"Carregando Loja"}),t.jsx("p",{className:"text-muted-foreground",children:"Aguarde enquanto carregamos os itens..."})]})}):c||!r?t.jsx("div",{className:"min-h-screen flex flex-col items-center justify-center bg-gradient-to-b from-background to-secondary p-4",children:t.jsx("div",{className:"w-full max-w-md text-center",children:t.jsxs(fu,{className:"p-6",children:[t.jsx(gu,{children:t.jsx(bu,{className:"text-red-500",children:"Erro ao Carregar Loja"})}),t.jsxs(yu,{className:"space-y-4",children:[t.jsx("p",{className:"text-muted-foreground",children:c||"Não foi possível carregar o personagem selecionado."}),t.jsxs("div",{className:"flex gap-2",children:[t.jsxs(Ws,{onClick:m,className:"flex-1",children:[t.jsx(Tt,{className:"h-4 w-4 mr-2"}),"Tentar Novamente"]}),t.jsxs(Ws,{variant:"outline",onClick:()=>s({to:"/game/play"}),className:"flex-1",children:[t.jsx(Me,{className:"h-4 w-4 mr-2"}),"Voltar"]})]})]})]})})}):t.jsx("div",{className:"min-h-screen flex flex-col items-center justify-center bg-gradient-to-b from-background to-secondary p-4",children:t.jsxs("div",{className:"w-full max-w-7xl",children:[t.jsx("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-4 mb-6",children:t.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center gap-2 sm:gap-4",children:[t.jsxs(Ws,{variant:"outline",size:"sm",onClick:()=>{s(a?{to:"/game/play/hub",search:{character:a}}:{to:"/game/play"})},className:"w-fit",children:[t.jsx(Me,{className:"h-4 w-4 mr-2"}),"Voltar ao Hub"]}),t.jsxs("div",{className:"mt-2 sm:mt-0",children:[t.jsx("h1",{className:"text-2xl sm:text-3xl font-bold",children:"Loja"}),t.jsxs("p",{className:"text-sm sm:text-base text-muted-foreground",children:[r.name," • Nível ",r.level," • Andar ",r.floor]})]})]})}),t.jsx(mf,{character:r,onPurchase:async e=>{r&&i((t=>({...t,gold:e})))}})]})})},validateSearch:e=>({character:e.character||""})});class hf{static potionSlotsCache=new Map;static spellSlotsCache=new Map;static pendingPotionRequests=new Map;static pendingSpellRequests=new Map;static CACHE_DURATION=3e5;static REQUEST_TIMEOUT=8e3;static isCacheValid(e){if(!e)return!1;const t=Date.now();return e.isValid&&t-e.timestamp<this.CACHE_DURATION}static cancelPendingRequest(e,t){const s=e.get(t);s&&(s.abortController.abort(),e.delete(t))}static invalidateCache(e){this.cancelPendingRequest(this.pendingPotionRequests,e),this.cancelPendingRequest(this.pendingSpellRequests,e);const t=this.potionSlotsCache.get(e);t&&(t.isValid=!1);const s=this.spellSlotsCache.get(e);s&&(s.isValid=!1)}static async getCharacterPotionSlots(e){try{const s=this.potionSlotsCache.get(e);if(this.isCacheValid(s))return{data:s.data,error:null,success:!0};const a=this.pendingPotionRequests.get(e);if(a)try{return await a.promise}catch(t){if(!a.abortController.signal.aborted)throw t}const r=new AbortController,n=this.fetchPotionSlotsFromServer(e,r.signal);this.pendingPotionRequests.set(e,{promise:n,abortController:r});try{const t=await n;return t.success&&t.data&&this.potionSlotsCache.set(e,{data:t.data,timestamp:Date.now(),isValid:!0}),t}finally{this.pendingPotionRequests.delete(e)}}catch(t){return this.getFallbackPotionSlots()}}static async fetchPotionSlotsFromServer(e,t){const s=new Promise(((e,s)=>{const a=setTimeout((()=>{s(new Error("Timeout ao carregar slots de poção"))}),this.REQUEST_TIMEOUT);t.addEventListener("abort",(()=>{clearTimeout(a),s(new Error("Request cancelado"))}))})),a=Es.rpc("get_character_potion_slots",{p_character_id:e});try{const{data:e,error:r}=await Promise.race([a,s]);if(t.aborted)throw new Error("Request cancelado");if(r)throw r;const n=[];for(let t=1;t<=3;t++){const s=e?.find((e=>e.slot_position===t));n.push(s||{slot_position:t,consumable_id:null,consumable_name:null,consumable_description:null,effect_value:null,consumable_type:null,available_quantity:0,consumable_price:null})}return{data:n,error:null,success:!0}}catch(r){if(t.aborted)throw r;throw r}}static getFallbackPotionSlots(){const e=[];for(let t=1;t<=3;t++)e.push({slot_position:t,consumable_id:null,consumable_name:null,consumable_description:null,effect_value:null,consumable_type:null,available_quantity:0,consumable_price:null});return{data:e,error:null,success:!0}}static async getCharacterSpellSlots(e){try{const t=this.spellSlotsCache.get(e);if(this.isCacheValid(t))return{data:t.data,error:null,success:!0};const s=this.pendingSpellRequests.get(e);if(s)return await s.promise;const a=new AbortController,r=this.fetchSpellSlotsFromServer(e,a.signal);this.pendingSpellRequests.set(e,{promise:r,abortController:a});try{const t=await r;return t.success&&t.data&&this.spellSlotsCache.set(e,{data:t.data,timestamp:Date.now(),isValid:!0}),t}finally{this.pendingSpellRequests.delete(e)}}catch(t){return{data:null,error:"Erro ao buscar slots de spell",success:!1}}}static async fetchSpellSlotsFromServer(e,t){const{data:s,error:a}=await Es.rpc("get_character_spell_slots",{p_character_id:e});if(t.aborted)throw new Error("Request cancelado");if(a)throw a;const r=[];for(let n=1;n<=3;n++){const e=s?.find((e=>e.slot_position===n));r.push(e||{slot_position:n,spell_id:null,spell_name:null,spell_description:null,mana_cost:null,damage:null,spell_type:null})}return{data:r,error:null,success:!0}}static async setPotionSlot(e,t,s){try{const{data:a,error:r}=await Es.rpc("set_potion_slot",{p_character_id:e,p_slot_position:t,p_consumable_id:s}).single();if(r)throw r;const n=a;return n.success?(this.invalidateCache(e),{data:null,error:null,success:!0}):{data:null,error:n.error||"Erro ao configurar slot de poção",success:!1}}catch(a){return{data:null,error:a instanceof Error?a.message:"Erro ao configurar slot de poção",success:!1}}}static async clearPotionSlot(e,t){try{const{data:s,error:a}=await Es.rpc("clear_potion_slot",{p_character_id:e,p_slot_position:t}).single();if(a)throw a;const r=s;return r.success?(this.invalidateCache(e),{data:null,error:null,success:!0}):{data:null,error:r.error||"Erro ao limpar slot de poção",success:!1}}catch(s){return{data:null,error:s instanceof Error?s.message:"Erro ao limpar slot de poção",success:!1}}}static async setSpellSlot(e,t,s){try{const{error:a}=await Es.rpc("set_spell_slot",{p_character_id:e,p_slot_position:t,p_spell_id:s});if(a)throw a;return this.invalidateCache(e),{data:null,error:null,success:!0}}catch(a){return{data:null,error:a instanceof Error?a.message:"Erro ao configurar slot de spell",success:!1}}}static async consumePotionFromSlot(e,t){try{if(!e)return{success:!1,error:"ID do personagem é obrigatório",data:null};if(t<1||t>3)return{success:!1,error:"Posição do slot inválida (1-3)",data:null};const{supabaseAdmin:s}=await d((async()=>{const{supabaseAdmin:e}=await Promise.resolve().then((()=>As));return{supabaseAdmin:e}}),void 0),{data:a,error:r}=await s.rpc("consume_potion_from_slot",{p_character_id:e,p_slot_position:t});if(r)return{success:!1,error:r.message||"Erro ao usar poção",data:null};if(!a||!Array.isArray(a)||0===a.length)return{success:!1,error:"Nenhum resultado retornado da função",data:null};const n=a[0];if(!n)return{success:!1,error:"Resultado vazio da função",data:null};const i=n.success,o=n.message,l=n.new_hp,c=n.new_mana;let m=!1;m="boolean"==typeof i?i:"string"==typeof i?"true"===i.toLowerCase()||"t"===i:Boolean(i);const u=Math.floor(Number(l)||0),h=Math.floor(Number(c)||0);if(isNaN(u)||isNaN(h))return{success:!1,error:"Erro nos valores de HP/Mana retornados",data:null};const p={success:m,message:String(o||"Poção usada"),new_hp:u,new_mana:h};return this.invalidateCache(e),p.success?{success:!0,error:null,data:p}:{success:!1,error:p.message,data:null}}catch(s){return this.invalidateCache(e),{success:!1,error:s instanceof Error?s.message:"Erro desconhecido",data:null}}}static async clearSpellSlot(e,t){return this.setSpellSlot(e,t,null)}static clearAllCache(){for(const[,e]of this.pendingPotionRequests)e.abortController.abort();for(const[,e]of this.pendingSpellRequests)e.abortController.abort();this.potionSlotsCache.clear(),this.spellSlotsCache.clear(),this.pendingPotionRequests.clear(),this.pendingSpellRequests.clear()}}const pf=Object.freeze(Object.defineProperty({__proto__:null,SlotService:hf},Symbol.toStringTag,{value:"Module"}));function xf({characterId:s,consumables:a,onSlotsUpdate:r}){const[n,i]=e.useState([]),[o,l]=e.useState(!0),[c,d]=e.useState(null),m=e.useRef(null),u=async()=>{try{const e=await hf.getCharacterPotionSlots(s);e.success&&e.data&&i(e.data)}catch(e){}finally{l(!1)}};e.useEffect((()=>{s&&u()}),[s]),e.useEffect((()=>{const e=e=>{m.current&&!m.current.contains(e.target)&&d(null)},t=()=>{d(null)};if(null!==c)return document.addEventListener("mousedown",e),document.addEventListener("touchstart",e),window.addEventListener("scroll",t,!0),()=>{document.removeEventListener("mousedown",e),document.removeEventListener("touchstart",e),window.removeEventListener("scroll",t,!0)}}),[c]);const h=e=>{if(!e.consumable_id)return t.jsx(qt,{className:"h-4 w-4 text-slate-500"});const s=a.find((t=>t.consumable_id===e.consumable_id));return s?.consumable?t.jsx(lf,{consumable:s.consumable,size:"lg"}):e.consumable_description?e.consumable_description.includes("HP")||e.consumable_description.includes("Vida")?t.jsx(ae,{className:"h-4 w-4 text-red-400"}):e.consumable_description.includes("Mana")?t.jsx(re,{className:"h-4 w-4 text-blue-400"}):t.jsx(qt,{className:"h-4 w-4 text-purple-400"}):t.jsx(qt,{className:"h-4 w-4 text-slate-500"})},p=e=>{if(!e.consumable_id)return 0;const t=a.find((t=>t.consumable_id===e.consumable_id));return t?.quantity||0},x=e=>{return e.effect_value&&e.consumable_description?(t=e.effect_value,s=e.consumable_description,!t||t<=0?"":s.includes("HP")||s.includes("Vida")?`+${t} HP`:s.includes("Mana")?`+${t} Mana`:`+${t}`):"";var t,s};return o?t.jsxs("div",{className:"space-y-2",children:[t.jsx("div",{className:"text-xs text-slate-500 font-medium",children:"Atalhos Rápidos"}),t.jsx("div",{className:"flex gap-2",children:[1,2,3].map((e=>t.jsx("div",{className:"w-12 h-12 bg-slate-700/20 rounded border border-slate-700/30 animate-pulse"},`loading-slot-${e}`)))})]}):t.jsxs("div",{className:"space-y-2",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("div",{className:"text-xs text-slate-500 font-medium",children:"Atalhos Rápidos"}),t.jsx("div",{className:"text-xs text-slate-600",children:"Q • W • E"})]}),t.jsxs("div",{className:"space-y-3",children:[t.jsx("div",{className:"flex gap-2",children:n.map((e=>{const a=(e=>{switch(e){case 1:return"Q";case 2:return"W";case 3:return"E";default:return""}})(e.slot_position),n=!e.consumable_id,i=c===e.slot_position;return t.jsx("div",{className:"relative",children:t.jsxs("div",{className:"relative group",children:[t.jsx(Ws,{variant:"outline",className:`w-12 h-12 p-1 border transition-all duration-200 ${n?"border-slate-600/50 bg-slate-800/20 hover:border-slate-500/70 hover:bg-slate-700/30":"border-blue-500/60 bg-blue-900/20 hover:border-blue-400/80 hover:bg-blue-800/30"} ${i?"ring-1 ring-blue-400/50":""}`,onClick:()=>{return t=e.slot_position,void d(c===t?null:t);var t},children:t.jsx("div",{className:"flex flex-col items-center justify-center",children:n?t.jsxs("div",{className:"flex items-center",children:[t.jsx(We,{className:"h-3 w-3 text-slate-500"}),t.jsx(le,{className:"h-2 w-2 text-slate-500 transition-transform "+(i?"rotate-180":"")})]}):h(e)})}),t.jsx(_u,{className:"absolute -top-1 -right-1 h-4 w-4 p-0 flex items-center justify-center bg-slate-600 text-white text-xs font-medium border border-slate-700 text-[10px]",children:a}),!n&&t.jsx(Ws,{variant:"destructive",size:"sm",className:"absolute -top-1 -left-1 h-4 w-4 p-0 rounded-full opacity-0 group-hover:opacity-100 transition-opacity",onClick:t=>{t.stopPropagation(),(async e=>{try{const t=await hf.clearPotionSlot(s,e);t.success?(await u(),r?.(),j.success("Slot limpo!")):j.error(t.error||"Erro ao limpar slot")}catch(t){j.error("Erro ao limpar slot")}})(e.slot_position)},children:t.jsx(z,{className:"h-2 w-2"})}),t.jsx("div",{className:"absolute -bottom-8 left-1/2 transform -translate-x-1/2 opacity-0 group-hover:opacity-100 transition-opacity duration-200 z-10 pointer-events-none",children:t.jsxs("div",{className:"bg-slate-900/95 text-slate-300 text-xs px-2 py-1 rounded border border-slate-700/50 whitespace-nowrap",children:[n?`Slot ${a}`:e.consumable_name||"Poção",!n&&e.effect_value&&t.jsx("div",{className:"text-emerald-300 text-[10px]",children:x(e)}),!n&&p(e)>0&&t.jsxs("div",{className:"text-blue-300 text-[10px]",children:["x",p(e)]})]})})]})},`potion-slot-${e.slot_position}`)}))}),null!==c&&t.jsx("div",{ref:m,className:"relative",children:t.jsx("div",{className:"bg-slate-800/95 backdrop-blur-sm border border-slate-600/50 rounded-lg shadow-xl max-h-48 overflow-y-auto",children:(()=>{const e=n.find((e=>e.slot_position===c));if(!e)return null;const i=(e=>{const t=n.filter((t=>t.consumable_id&&t.slot_position!==e)).map((e=>e.consumable_id)),s=a.filter((e=>{const s=e.consumable&&"potion"===e.consumable.type&&e.quantity>0,a=!t.includes(e.consumable_id);return s&&a}));return s})(e.slot_position);return i.length>0?t.jsx("div",{className:"p-2 space-y-1",children:i.map((a=>t.jsxs("button",{className:"w-full text-left px-3 py-2 rounded hover:bg-slate-700/50 transition-colors flex items-center gap-3 text-sm",onClick:()=>(async(e,t)=>{try{const a=await hf.setPotionSlot(s,e,t);a.success?(await u(),r?.(),j.success("Poção atribuída ao slot!"),d(null)):j.error(a.error||"Erro ao atribuir poção")}catch(a){j.error("Erro ao configurar slot")}})(e.slot_position,a.consumable_id),children:[t.jsx("div",{className:"flex-shrink-0",children:t.jsx(lf,{consumable:a.consumable,size:"sm"})}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsx("div",{className:"text-xs font-medium text-slate-200 truncate",children:a.consumable.name}),t.jsxs("div",{className:"text-xs text-slate-400",children:[Xx(a.consumable)," • x",a.quantity]})]})]},`dropdown-${a.id}`)))}):t.jsx("div",{className:"p-4 text-center",children:t.jsx("div",{className:"text-slate-400 text-xs",children:"Nenhuma poção disponível"})})})()})})]})]})}const ff=({character:s,onInventoryChange:a})=>{const[r,n]=e.useState([]),[i,o]=e.useState([]),[l,c]=e.useState(!0),[d,m]=e.useState(null),[u,h]=e.useState(null),[p,x]=e.useState(null),[f,g]=e.useState({isOpen:!1,type:null,item:null,sellPrice:null}),[b,v]=e.useState(s.gold),y=e.useCallback((async()=>{try{c(!0);const[e,t]=await Promise.all([Yx.getCharacterConsumables(s.id),Yx.getCharacterDrops(s.id)]);n(e.success&&e.data||[]),o(t.success&&t.data||[])}catch(e){j.error("Erro ao carregar inventário"),n([]),o([])}finally{c(!1)}}),[s.id]);e.useEffect((()=>{y()}),[y]),e.useEffect((()=>{v(s.gold)}),[s.gold]);const N=e=>{if(!e.consumable)return!1;if("potion"===e.consumable.type){if(e.consumable.description.includes("HP")&&s.hp>=s.max_hp)return!1;if(e.consumable.description.includes("Mana")&&s.mana>=s.max_mana)return!1}return!0},w=e=>{const t={common:"border-slate-600 bg-slate-800/30",uncommon:"border-emerald-600 bg-emerald-900/30",rare:"border-blue-600 bg-blue-900/30",epic:"border-purple-600 bg-purple-900/30",legendary:"border-amber-600 bg-amber-900/30"};return t[e]||t.common};return l?t.jsxs("div",{className:"grid grid-cols-1 xl:grid-cols-3 gap-6 h-[70vh]",children:[t.jsx("div",{className:"xl:col-span-2 space-y-6",children:t.jsx(fu,{className:"bg-slate-800/50 border-slate-700/50",children:t.jsx(yu,{className:"p-4 sm:p-6",children:t.jsxs("div",{className:"animate-pulse space-y-4",children:[t.jsx("div",{className:"h-6 bg-slate-700 rounded w-32"}),t.jsx("div",{className:"grid grid-cols-4 sm:grid-cols-6 md:grid-cols-8 lg:grid-cols-10 gap-2 sm:gap-3",children:Array.from({length:16}).map(((e,s)=>t.jsx("div",{className:"aspect-square bg-slate-700 rounded"},s)))})]})})})}),t.jsx("div",{className:"xl:col-span-1",children:t.jsx(fu,{className:"bg-slate-800/50 border-slate-700/50 h-full min-h-[400px]",children:t.jsx(yu,{className:"p-4 sm:p-6",children:t.jsxs("div",{className:"animate-pulse space-y-4",children:[t.jsx("div",{className:"h-6 bg-slate-700 rounded w-24"}),t.jsx("div",{className:"h-32 bg-slate-700 rounded"})]})})})})]}):t.jsxs("div",{className:"grid grid-cols-1 xl:grid-cols-3 gap-6",children:[t.jsxs("div",{className:"xl:col-span-2 space-y-6",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("h2",{className:"text-xl sm:text-2xl font-bold text-slate-100",children:"Inventário"}),t.jsxs("div",{className:"flex items-center gap-2 text-amber-400 bg-slate-800/30 px-3 py-1 rounded-lg border border-slate-700/50",children:[t.jsx(Fe,{className:"h-4 w-4"}),t.jsx("span",{className:"font-medium text-sm sm:text-base",children:b.toLocaleString()})]})]}),t.jsx(fu,{className:"bg-slate-800/50 border-slate-700/50",children:t.jsxs(yu,{className:"p-4 sm:p-6",children:[t.jsxs("h3",{className:"text-base sm:text-lg font-bold text-slate-100 mb-4 flex items-center gap-2",children:[t.jsx(ut,{className:"h-4 w-4 sm:h-5 sm:w-5 text-purple-400"}),"Consumíveis (",r.filter((e=>e.quantity>0)).length,")"]}),t.jsx("div",{className:"mb-6",children:t.jsx(xf,{characterId:s.id,consumables:r,onSlotsUpdate:()=>{y()}})}),(()=>{const e=r.filter((e=>e.consumable&&e.quantity>0));return 0===e.length?t.jsxs("div",{className:"text-center py-12",children:[t.jsx(Et,{className:"h-16 w-16 mx-auto mb-4 text-slate-600 opacity-50"}),t.jsx("p",{className:"text-slate-500",children:"Nenhum consumível disponível"})]}):t.jsx("div",{className:"grid grid-cols-4 sm:grid-cols-6 md:grid-cols-8 lg:grid-cols-10 gap-2 sm:gap-3",children:e.map((e=>{const s=d?.id===e.id,a=N(e);return t.jsxs("div",{className:`relative aspect-square border-2 rounded-lg cursor-pointer transition-all duration-200 hover:scale-105 ${s?"border-amber-400 bg-amber-900/30 shadow-lg shadow-amber-400/20":"border-slate-600 bg-slate-800/30 hover:border-slate-400"} ${a?"":"opacity-50"}`,onClick:()=>{m(e),h(null)},children:[t.jsx("div",{className:"absolute inset-0 flex items-center justify-center p-1.5",children:t.jsx(lf,{consumable:e.consumable,size:"xl"})}),e.quantity>1&&t.jsx("div",{className:"absolute bottom-1 right-1 bg-slate-900/80 text-slate-200 text-xs px-1 rounded min-w-[16px] text-center",children:e.quantity}),!a&&t.jsx("div",{className:"absolute top-1 left-1 w-2 h-2 bg-red-500 rounded-full"})]},`consumable-${e.id}`)}))})})()]})}),t.jsx(fu,{className:"bg-slate-800/50 border-slate-700/50",children:t.jsxs(yu,{className:"p-4 sm:p-6",children:[t.jsxs("h3",{className:"text-base sm:text-lg font-bold text-slate-100 mb-4 flex items-center gap-2",children:[t.jsx(pt,{className:"h-4 w-4 sm:h-5 sm:w-5 text-amber-400"}),"Materiais (",i.filter((e=>e.quantity>0)).length,")"]}),(()=>{const e=i.filter((e=>e.drop&&e.quantity>0));return 0===e.length?t.jsxs("div",{className:"text-center py-12",children:[t.jsx(Et,{className:"h-16 w-16 mx-auto mb-4 text-slate-600 opacity-50"}),t.jsx("p",{className:"text-slate-500",children:"Nenhum material disponível"})]}):t.jsx("div",{className:"grid grid-cols-4 sm:grid-cols-6 md:grid-cols-8 lg:grid-cols-10 gap-2 sm:gap-3",children:e.map((e=>{const s=u?.id===e.id,a=e.drop?.rarity||"common";return t.jsxs("div",{className:"relative aspect-square border-2 rounded-lg cursor-pointer transition-all duration-200 hover:scale-105 "+(s?"border-amber-400 bg-amber-900/30 shadow-lg shadow-amber-400/20":`${w(a)} hover:border-slate-400`),onClick:()=>{h(e),m(null)},children:[t.jsx("div",{className:"absolute inset-0 flex items-center justify-center p-1.5",children:t.jsx(pt,{className:"h-7 w-7 text-amber-400"})}),e.quantity>1&&t.jsx("div",{className:"absolute bottom-1 right-1 bg-slate-900/80 text-slate-200 text-xs px-1 rounded min-w-[16px] text-center",children:e.quantity})]},`drop-${e.id}`)}))})})()]})})]}),t.jsx("div",{className:"xl:col-span-1",children:t.jsx(fu,{className:"bg-slate-800/50 border-slate-700/50 h-full min-h-[400px]",children:t.jsx(yu,{className:"p-4 sm:p-6 h-full",children:(()=>{if(d?.consumable){const e=d,r=e.consumable,n=N(e);return t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"flex items-start gap-4",children:[t.jsx("div",{className:"p-4 rounded-lg border-2 border-slate-600 bg-slate-800/30",children:t.jsx(lf,{consumable:r,size:"xl"})}),t.jsxs("div",{className:"flex-1",children:[t.jsx("h2",{className:"text-2xl font-bold text-slate-100 mb-2",children:r.name}),t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx(_u,{className:"bg-slate-700/50 text-slate-200 border-0",children:r.type}),t.jsxs("span",{className:"text-slate-400",children:["Quantidade: ",e.quantity]})]})]})]}),t.jsx("div",{className:"bg-slate-800/30 border border-slate-700/50 rounded-lg p-4",children:t.jsx("p",{className:"text-slate-300 leading-relaxed",children:r.description})}),r.effect_value>0&&t.jsxs("div",{className:"bg-emerald-900/30 border border-emerald-700/50 rounded-lg p-4",children:[t.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[t.jsx(ut,{className:"h-4 w-4 text-emerald-400"}),t.jsx("span",{className:"text-emerald-300 font-medium",children:"Efeito"})]}),t.jsx("p",{className:"text-emerald-200",children:Xx(r)})]}),t.jsxs("div",{className:"space-y-3",children:[t.jsx(Ws,{onClick:()=>(async e=>{if(!e.consumable||e.quantity<=0)j.error("Consumível não disponível");else{x(e.consumable_id);try{const t=await Yx.consumeItem(s.id,e.consumable_id,s);t.success&&t.data?(await y(),a(),j.success(t.data.message)):j.error(t.error||"Erro ao usar consumível")}catch(t){j.error("Erro ao usar consumível")}finally{x(null)}}})(e),disabled:!n||p===e.consumable_id,className:"w-full "+(n?"bg-amber-600 hover:bg-amber-700 text-white":"bg-slate-700 text-slate-400 cursor-not-allowed"),children:p===e.consumable_id?t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-t border-b border-current"}),"Usando..."]}):n?"Usar Item":"potion"===r.type&&r.description.includes("HP")&&s.hp>=s.max_hp?"HP já está no máximo":"potion"===r.type&&r.description.includes("Mana")&&s.mana>=s.max_mana?"Mana já está no máximo":"Não pode ser usado agora"}),t.jsxs(Ws,{onClick:()=>(async e=>{if(e.consumable)try{const t=Math.floor(.4*e.consumable.price);g({isOpen:!0,type:"consumable",item:e,sellPrice:{canSell:!0,availableQuantity:e.quantity,unitSellPrice:t,originalPrice:e.consumable.price}})}catch(t){j.error("Erro ao calcular preço de venda")}})(e),variant:"outline",className:"w-full border-slate-600 text-slate-300 hover:bg-slate-700/50",children:[t.jsx(Pt,{className:"h-4 w-4 mr-2"}),"Vender Item"]})]})]})}if(u?.drop){const e=u,s=e.drop;return t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"flex items-start gap-4",children:[t.jsx("div",{className:`p-4 rounded-lg border-2 ${w(s.rarity)}`,children:t.jsx(pt,{className:"h-6 w-6 text-amber-400"})}),t.jsxs("div",{className:"flex-1",children:[t.jsx("h2",{className:"text-2xl font-bold text-slate-100 mb-2",children:s.name}),t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx(_u,{className:`${w(s.rarity)} border-0 text-slate-200`,children:s.rarity}),t.jsxs("span",{className:"text-slate-400",children:["Quantidade: ",e.quantity]})]})]})]}),t.jsx("div",{className:"bg-slate-800/30 border border-slate-700/50 rounded-lg p-4",children:t.jsx("p",{className:"text-slate-300 leading-relaxed",children:s.description})}),t.jsxs("div",{className:"bg-amber-900/30 border border-amber-700/50 rounded-lg p-4",children:[t.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[t.jsx(Fe,{className:"h-4 w-4 text-amber-400"}),t.jsx("span",{className:"text-amber-300 font-medium",children:"Valor"})]}),t.jsxs("p",{className:"text-amber-200",children:[s.value," gold por unidade"]})]}),t.jsxs(Ws,{onClick:()=>(async e=>{if(e.drop)try{const t=e.drop.value;g({isOpen:!0,type:"drop",item:e,sellPrice:{canSell:!0,availableQuantity:e.quantity,unitSellPrice:t,originalPrice:e.drop.value}})}catch(t){j.error("Erro ao calcular preço de venda")}})(e),variant:"outline",className:"w-full border-slate-600 text-slate-300 hover:bg-slate-700/50",children:[t.jsx(Pt,{className:"h-4 w-4 mr-2"}),"Vender Material"]})]})}return t.jsx("div",{className:"flex items-center justify-center h-full text-slate-500",children:t.jsxs("div",{className:"text-center",children:[t.jsx(Et,{className:"h-16 w-16 mx-auto mb-4 opacity-50"}),t.jsx("p",{className:"text-lg",children:"Selecione um item"}),t.jsx("p",{className:"text-sm mt-2 opacity-75",children:"Clique em um item para ver os detalhes"})]})})})()})})}),t.jsx(nf,{isOpen:f.isOpen,onClose:()=>g({isOpen:!1,type:null,item:null,sellPrice:null}),onConfirm:async e=>{if(f.item&&f.type)try{if("consumable"===f.type){const t=f.item,r=await Yx.sellConsumablesBatch(s.id,[{consumable_id:t.consumable_id,quantity:e}]);r.success&&r.data?(j.success(`Vendido ${e}x ${t.consumable?.name} por ${r.data.totalGoldEarned} gold!`),await y(),a(),v(r.data.newGold)):j.error(r.error||"Erro ao vender consumível")}else if("drop"===f.type){const t=f.item,r=await Yx.sellDropsBatch(s.id,[{drop_id:t.drop_id,quantity:e}]);r.success&&r.data?(j.success(`Vendido ${e}x ${t.drop?.name} por ${r.data.totalGoldEarned} gold!`),await y(),a(),v(r.data.newGold)):j.error(r.error||"Erro ao vender material")}}catch(t){j.error("Erro ao vender item")}},itemName:"consumable"===f.type?f.item?.consumable?.name||"":f.item?.drop?.name||"",itemIcon:"consumable"===f.type&&f.item&&f.item.consumable?t.jsx(lf,{consumable:f.item.consumable,size:"lg"}):t.jsx(pt,{className:"h-8 w-8 text-amber-400"}),itemRarity:"consumable"===f.type?void 0:f.item?.drop?.rarity,availableQuantity:f.sellPrice?.availableQuantity||0,unitSellPrice:f.sellPrice?.unitSellPrice||0,originalPrice:f.sellPrice?.originalPrice})]})},gf=r("/_authenticated/game/play/hub/inventory")({component:function(){const s=n(),{character:a}=gf.useSearch(),{loadCharacterForHub:r}=kx(),[i,o]=e.useState(null),[l,c]=e.useState(!0),[d,m]=e.useState(null),[u,h]=e.useState(!1),p=async(e=!0,t=!1)=>{if(a){if(t||!u||i?.id!==a||e){e&&c(!0),m(null);try{const e=await Ah.getCharacter(a);if(e.success&&e.data)o(e.data),await r(e.data),h(!0);else{const t=e.error||"Erro desconhecido ao carregar personagem";m(t),j.error("Erro ao carregar personagem",{description:t})}}catch(n){const e=n instanceof Error?n.message:"Erro desconhecido";m(e),j.error("Erro ao carregar personagem",{description:e})}finally{c(!1)}}}else s({to:"/game/play"})};e.useEffect((()=>{p(!0)}),[a]);if(l)return t.jsx("div",{className:"min-h-screen flex flex-col items-center justify-center bg-gradient-to-b from-slate-900 to-black p-4",children:t.jsxs("div",{className:"text-center",children:[t.jsx("div",{className:"inline-block animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-amber-400 mb-4"}),t.jsx("h2",{className:"text-2xl font-bold mb-2 text-slate-100",children:"Carregando Inventário"}),t.jsx("p",{className:"text-slate-400",children:"Aguarde enquanto carregamos seus itens..."})]})});if(d||!i)return t.jsx("div",{className:"min-h-screen flex flex-col items-center justify-center bg-gradient-to-b from-slate-900 to-black p-4",children:t.jsx("div",{className:"w-full max-w-md text-center",children:t.jsxs(fu,{className:"p-6 bg-slate-800/50 border-slate-700/50",children:[t.jsx(gu,{children:t.jsx(bu,{className:"text-red-400",children:"Erro ao Carregar Inventário"})}),t.jsxs(yu,{className:"space-y-4",children:[t.jsx("p",{className:"text-slate-400",children:d||"Não foi possível carregar o personagem selecionado."}),t.jsxs("div",{className:"flex gap-2",children:[t.jsx(Ws,{onClick:()=>p(),className:"flex-1 bg-amber-600 hover:bg-amber-700",children:"Tentar Novamente"}),t.jsxs(Ws,{variant:"outline",onClick:()=>s({to:"/game/play"}),className:"flex-1 border-slate-600 text-slate-300",children:[t.jsx(Me,{className:"h-4 w-4 mr-2"}),"Voltar"]})]})]})]})})});return t.jsx("div",{className:"min-h-screen bg-gradient-to-b from-slate-900 to-black",children:t.jsxs("div",{className:"container mx-auto px-2 sm:px-3 md:px-4 py-2 sm:py-4 md:py-6",children:[t.jsx("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-3 sm:gap-4 mb-4 sm:mb-6",children:t.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center gap-2 sm:gap-4",children:[t.jsxs(Ws,{variant:"outline",size:"sm",onClick:()=>{s(a?{to:"/game/play/hub",search:{character:a}}:{to:"/game/play"})},className:"border-slate-600 text-slate-300 hover:bg-slate-700 w-fit",children:[t.jsx(Me,{className:"h-4 w-4 mr-2"}),"Voltar ao Hub"]}),t.jsxs("div",{className:"mt-1 sm:mt-0",children:[t.jsx("h1",{className:"text-xl sm:text-2xl lg:text-3xl font-bold text-slate-100",children:"Inventário"}),t.jsxs("p",{className:"text-sm sm:text-base text-slate-400",children:[i.name," • Nível ",i.level]})]})]})}),t.jsx(ff,{character:i,onInventoryChange:()=>{p(!1,!0)}})]})})},validateSearch:e=>({character:e.character||""})});const bf=({selectedItem:e,selectedSlot:s,character:a,onEquipmentChange:r})=>{const n=e=>{const t={common:"bg-slate-800/80 text-slate-300 border-slate-600",uncommon:"bg-emerald-900/80 text-emerald-300 border-emerald-600",rare:"bg-blue-900/80 text-blue-300 border-blue-600",epic:"bg-purple-900/80 text-purple-300 border-purple-600",legendary:"bg-amber-900/80 text-amber-300 border-amber-600"};return t[e]||t.common};return e?t.jsxs(fu,{className:"bg-slate-800/50 border-slate-700/50 h-full",children:[t.jsx(gu,{children:t.jsx(bu,{className:"text-slate-100",children:"Detalhes do Item"})}),t.jsxs(yu,{className:"space-y-6",children:[t.jsxs("div",{className:"flex items-start gap-4",children:[t.jsx("div",{className:`p-4 rounded-lg border-2 ${n(e.rarity)}`,children:(e=>{switch(e.type){case"weapon":return t.jsx(se,{className:"h-12 w-12 text-red-400"});case"armor":return t.jsx(De,{className:"h-12 w-12 text-blue-400"});case"chest":return t.jsx(wt,{className:"h-12 w-12 text-emerald-400"});case"helmet":return t.jsx(De,{className:"h-12 w-12 text-yellow-400"});case"legs":return t.jsx(De,{className:"h-12 w-12 text-cyan-400"});case"boots":return t.jsx(De,{className:"h-12 w-12 text-orange-400"});case"ring":return t.jsx(xt,{className:"h-12 w-12 text-purple-400"});case"necklace":return t.jsx(xt,{className:"h-12 w-12 text-pink-400"});case"amulet":return t.jsx(xt,{className:"h-12 w-12 text-indigo-400"});default:return t.jsx(De,{className:"h-12 w-12 text-slate-400"})}})(e)}),t.jsxs("div",{className:"flex-1",children:[t.jsx("h2",{className:"text-2xl font-bold text-slate-100 mb-2",children:e.name}),t.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[t.jsx(_u,{className:`border ${n(e.rarity)}`,children:e.rarity}),t.jsx(_u,{variant:"outline",className:"text-slate-300",children:"weapon"===e.type?"Arma":"armor"===e.type?"Escudo":"chest"===e.type?"Peitoral":"helmet"===e.type?"Capacete":"legs"===e.type?"Perneiras":"boots"===e.type?"Botas":"ring"===e.type?"Anel":"necklace"===e.type?"Colar":"amulet"===e.type?"Amuleto":e.type}),"legendary"===e.rarity&&t.jsx(pt,{className:"h-4 w-4 text-amber-400 animate-pulse"})]}),s&&t.jsxs("p",{className:"text-sm text-slate-400",children:["Equipado em: ",(e=>{switch(e){case"main_hand":return"Mão Principal";case"off_hand":return"Mão Secundária";case"armor":return"Escudo";case"chest":return"Peitoral";case"helmet":return"Capacete";case"legs":return"Perneiras";case"boots":return"Botas";case"ring_1":return"Anel 1";case"ring_2":return"Anel 2";case"necklace":return"Colar";case"amulet":return"Amuleto";case"accessory":return"Acessório";default:return e}})(s)]})]})]}),t.jsx("div",{className:"bg-slate-800/30 border border-slate-700/50 rounded-lg p-4",children:t.jsx("p",{className:"text-slate-300 leading-relaxed",children:e.description})}),t.jsxs("div",{className:"space-y-3",children:[t.jsx("h3",{className:"text-lg font-semibold text-slate-200",children:"Atributos"}),t.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.atk_bonus>0&&t.jsxs("div",{className:"bg-red-900/30 border border-red-700/50 rounded-lg p-3",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(se,{className:"h-4 w-4 text-red-400"}),t.jsx("span",{className:"text-red-300 font-medium",children:"Ataque"})]}),t.jsxs("p",{className:"text-red-200 text-lg font-bold",children:["+",e.atk_bonus]})]}),e.def_bonus>0&&t.jsxs("div",{className:"bg-blue-900/30 border border-blue-700/50 rounded-lg p-3",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(De,{className:"h-4 w-4 text-blue-400"}),t.jsx("span",{className:"text-blue-300 font-medium",children:"Defesa"})]}),t.jsxs("p",{className:"text-blue-200 text-lg font-bold",children:["+",e.def_bonus]})]}),e.speed_bonus>0&&t.jsxs("div",{className:"bg-yellow-900/30 border border-yellow-700/50 rounded-lg p-3",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(re,{className:"h-4 w-4 text-yellow-400"}),t.jsx("span",{className:"text-yellow-300 font-medium",children:"Velocidade"})]}),t.jsxs("p",{className:"text-yellow-200 text-lg font-bold",children:["+",e.speed_bonus]})]}),e.hp_bonus>0&&t.jsxs("div",{className:"bg-green-900/30 border border-green-700/50 rounded-lg p-3",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(ae,{className:"h-4 w-4 text-green-400"}),t.jsx("span",{className:"text-green-300 font-medium",children:"HP"})]}),t.jsxs("p",{className:"text-green-200 text-lg font-bold",children:["+",e.hp_bonus]})]}),e.mana_bonus>0&&t.jsxs("div",{className:"bg-purple-900/30 border border-purple-700/50 rounded-lg p-3",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(ut,{className:"h-4 w-4 text-purple-400"}),t.jsx("span",{className:"text-purple-300 font-medium",children:"Mana"})]}),t.jsxs("p",{className:"text-purple-200 text-lg font-bold",children:["+",e.mana_bonus]})]}),e.critical_chance_bonus>0&&t.jsxs("div",{className:"bg-orange-900/30 border border-orange-700/50 rounded-lg p-3",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(pt,{className:"h-4 w-4 text-orange-400"}),t.jsx("span",{className:"text-orange-300 font-medium",children:"Crit. Chance"})]}),t.jsxs("p",{className:"text-orange-200 text-lg font-bold",children:["+",e.critical_chance_bonus.toFixed(1),"%"]})]}),e.critical_damage_bonus>0&&t.jsxs("div",{className:"bg-red-900/30 border border-red-700/50 rounded-lg p-3",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(ft,{className:"h-4 w-4 text-red-400"}),t.jsx("span",{className:"text-red-300 font-medium",children:"Crit. Dano"})]}),t.jsxs("p",{className:"text-red-200 text-lg font-bold",children:["+",e.critical_damage_bonus.toFixed(0),"%"]})]}),e.double_attack_chance_bonus>0&&t.jsxs("div",{className:"bg-cyan-900/30 border border-cyan-700/50 rounded-lg p-3",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(Ie,{className:"h-4 w-4 text-cyan-400"}),t.jsx("span",{className:"text-cyan-300 font-medium",children:"Duplo Ataque"})]}),t.jsxs("p",{className:"text-cyan-200 text-lg font-bold",children:["+",e.double_attack_chance_bonus.toFixed(1),"%"]})]}),e.magic_damage_bonus>0&&t.jsxs("div",{className:"bg-indigo-900/30 border border-indigo-700/50 rounded-lg p-3",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(ut,{className:"h-4 w-4 text-indigo-400"}),t.jsx("span",{className:"text-indigo-300 font-medium",children:"Dano Mágico"})]}),t.jsxs("p",{className:"text-indigo-200 text-lg font-bold",children:["+",e.magic_damage_bonus.toFixed(1),"%"]})]})]})]}),e.level_requirement>1&&t.jsxs("div",{className:"bg-slate-700/30 border border-slate-600/50 rounded-lg p-3",children:[t.jsx("h4",{className:"text-sm font-medium text-slate-300 mb-2",children:"Requisitos"}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("span",{className:"text-slate-400",children:"Nível mínimo:"}),t.jsx("span",{className:"font-bold "+(a.level>=e.level_requirement?"text-green-400":"text-red-400"),children:e.level_requirement})]})]}),e.weapon_subtype&&t.jsxs("div",{className:"bg-slate-700/30 border border-slate-600/50 rounded-lg p-3",children:[t.jsx("h4",{className:"text-sm font-medium text-slate-300 mb-2",children:"Tipo de Arma"}),t.jsx("p",{className:"text-slate-400 capitalize",children:e.weapon_subtype})]}),s&&t.jsx("div",{className:"pt-4 border-t border-slate-700/50",children:t.jsxs(Ws,{onClick:async()=>{if(e&&s)try{const t=e.id,s=await _h.toggleEquipment(a.id,t,!1);s.success?(j.success("Item desequipado com sucesso!"),r()):j.error(s.error||"Erro ao desequipar item")}catch(t){j.error("Erro ao desequipar item")}},variant:"outline",className:"w-full bg-slate-800/50 border-slate-600 text-slate-300 hover:bg-slate-700/50 hover:border-slate-500 hover:text-slate-200 transition-all duration-200",children:[t.jsx(Et,{className:"h-4 w-4 mr-2"}),"Desequipar Item"]})})]})]}):t.jsxs(fu,{className:"bg-slate-800/50 border-slate-700/50 h-full",children:[t.jsx(gu,{children:t.jsx(bu,{className:"text-slate-100",children:"Detalhes do Item"})}),t.jsx(yu,{className:"flex items-center justify-center h-64",children:t.jsxs("div",{className:"text-center text-slate-500",children:[t.jsx(Et,{className:"h-16 w-16 mx-auto mb-4 opacity-50"}),t.jsx("p",{className:"text-lg",children:"Nenhum item selecionado"}),t.jsx("p",{className:"text-sm mt-2 opacity-75",children:"Clique em um slot para ver os detalhes do equipamento"})]})})]})},vf=({equippedSlots:s,onSlotClick:a,onSlotLongPress:r})=>{const[n,i]=e.useState(null),[o,l]=e.useState(!1),c=e.useCallback((e=>{l(!1);const t=setTimeout((()=>{l(!0),r(e)}),800);i(t)}),[r]),d=e.useCallback(((e,t)=>{n&&(clearTimeout(n),i(null)),o||a(e,t),setTimeout((()=>l(!1)),100)}),[n,o,a]),m=e.useCallback((()=>{n&&(clearTimeout(n),i(null)),l(!1)}),[n]),u=(e,s)=>{if(s)switch(s.type){case"weapon":return t.jsx(se,{className:"h-8 w-8 text-red-400"});case"armor":case"chest":return t.jsx(wt,{className:"h-8 w-8 text-blue-400"});case"helmet":return t.jsx(Ye,{className:"h-8 w-8 text-amber-400"});case"legs":return t.jsx(wt,{className:"h-8 w-8 text-green-400"});case"boots":return t.jsx(_t,{className:"h-8 w-8 text-brown-400"});case"ring":return t.jsx(xt,{className:"h-8 w-8 text-purple-400"});case"necklace":return t.jsx(ae,{className:"h-8 w-8 text-pink-400"});case"amulet":return t.jsx(re,{className:"h-8 w-8 text-yellow-400"});default:return t.jsx(De,{className:"h-8 w-8 text-slate-400"})}switch(e){case"main_hand":case"off_hand":return t.jsx(se,{className:"h-8 w-8 text-slate-500"});case"armor":case"chest":case"legs":return t.jsx(wt,{className:"h-8 w-8 text-slate-500"});case"helmet":return t.jsx(Ye,{className:"h-8 w-8 text-slate-500"});case"boots":return t.jsx(_t,{className:"h-8 w-8 text-slate-500"});case"ring_1":case"ring_2":return t.jsx(xt,{className:"h-8 w-8 text-slate-500"});case"necklace":return t.jsx(ae,{className:"h-8 w-8 text-slate-500"});case"amulet":return t.jsx(re,{className:"h-8 w-8 text-slate-500"});default:return t.jsx(We,{className:"h-8 w-8 text-slate-500"})}},h=e=>{if(!e)return"border-slate-600 bg-slate-800/30";const t={common:"border-slate-600 bg-slate-800/30",uncommon:"border-emerald-600 bg-emerald-900/30",rare:"border-blue-600 bg-blue-900/30",epic:"border-purple-600 bg-purple-900/30",legendary:"border-amber-600 bg-amber-900/30"};return t[e]||t.common},p=(e,a)=>{const r=s[e],n=!r;return t.jsxs("div",{className:"space-y-3",children:[t.jsx("label",{className:"text-sm font-medium text-slate-300 block text-center",children:a}),t.jsxs("div",{className:"relative group",children:[t.jsx(Ws,{variant:"outline",className:`w-full h-32 p-4 border-2 transition-all duration-300 ${n?"border-dashed border-slate-600 bg-gradient-to-br from-slate-800/40 to-slate-900/60 hover:border-slate-500 hover:from-slate-700/50 hover:to-slate-800/70":`${h(r.rarity)} hover:brightness-110 shadow-lg`} hover:scale-[1.02] active:scale-[0.98] select-none`,onMouseDown:()=>c(e),onMouseUp:()=>d(e,r??null),onMouseLeave:m,onTouchStart:()=>c(e),onTouchEnd:()=>d(e,r??null),onTouchCancel:m,onContextMenu:e=>e.preventDefault(),children:t.jsxs("div",{className:"flex flex-col items-center justify-center gap-3 h-full",children:[t.jsx("div",{className:"p-3 rounded-lg "+(n?"bg-slate-700/30":"bg-black/20"),children:u(e,r??null)}),r?t.jsxs("div",{className:"text-center space-y-1",children:[t.jsx("div",{className:"text-sm font-medium text-slate-200 leading-tight max-w-full",children:r.name.length>12?`${r.name.substring(0,12)}...`:r.name}),t.jsx(_u,{variant:"outline",className:"text-xs px-2 py-0.5",children:r.rarity})]}):t.jsx("div",{className:"text-sm text-slate-500 font-medium",children:"Vazio"})]})}),t.jsx("div",{className:"absolute inset-0 rounded-lg border-2 border-transparent group-active:border-amber-400/50 transition-colors duration-200 pointer-events-none"}),t.jsx("div",{className:"absolute -bottom-2 left-1/2 transform -translate-x-1/2 opacity-0 group-hover:opacity-100 transition-opacity duration-200 z-10",children:t.jsx("div",{className:"bg-slate-900/90 text-slate-300 text-xs px-2 py-1 rounded border border-slate-700/50 shadow-lg whitespace-nowrap",children:n?"Toque e segure para equipar":"Toque para ver detalhes"})})]})]})},x=e=>{const t={0:{slotType:"chest",label:"Peitoral"},1:{slotType:"helmet",label:"Capacete"},2:{slotType:"legs",label:"Pernas"},3:{slotType:"boots",label:"Botas"}}[e];return t?p(t.slotType,t.label):null},f=e=>{const t={0:{slotType:"ring_1",label:"Anel 1"},1:{slotType:"ring_2",label:"Anel 2"},2:{slotType:"necklace",label:"Colar"},3:{slotType:"amulet",label:"Amuleto"}}[e];return t?p(t.slotType,t.label):null};return t.jsxs(fu,{className:"bg-slate-800/50 border-slate-700/50",children:[t.jsx(gu,{children:t.jsxs(bu,{className:"text-slate-100 flex items-center gap-2",children:[t.jsx(De,{className:"h-5 w-5 text-amber-400"}),"Equipamentos"]})}),t.jsxs(yu,{className:"space-y-8",children:[t.jsxs("div",{children:[t.jsx("h3",{className:"text-lg font-semibold text-slate-200 mb-6",children:"Armas"}),t.jsxs("div",{className:"grid grid-cols-2 gap-6",children:[p("main_hand","Mão Principal"),p("off_hand","Mão Secundária")]})]}),t.jsxs("div",{children:[t.jsx("h3",{className:"text-lg font-semibold text-slate-200 mb-6",children:"Armaduras"}),t.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-3 gap-6",children:[p("armor","Escudo"),[0,1,2,3].map((e=>t.jsx("div",{children:x(e)},`armor-slot-${e}`)))]})]}),t.jsxs("div",{children:[t.jsx("h3",{className:"text-lg font-semibold text-slate-200 mb-6",children:"Acessórios"}),t.jsx("div",{className:"grid grid-cols-2 gap-6",children:[0,1,2,3].map((e=>t.jsx("div",{children:f(e)},`accessory-slot-${e}`)))})]}),t.jsxs("div",{className:"bg-slate-700/30 p-4 rounded-lg",children:[t.jsx("p",{className:"text-sm text-slate-400 text-center",children:"Toque para ver detalhes • Toque e segure para selecionar/equipar"}),t.jsx("div",{className:"mt-2 text-xs text-slate-500 text-center",children:"✨ Todos os slots de equipamento estão disponíveis!"})]})]})]})},yf=r("/_authenticated/game/play/hub/equipment")({component:function(){if("/game/play/hub/equipment"===i().pathname)return t.jsx(jf,{});return t.jsx(a,{})},validateSearch:e=>({character:e.character||""})});function jf(){const s=n(),{character:a}=yf.useSearch(),[r,i]=e.useState(null),[o,l]=e.useState([]),[c,d]=e.useState(null),[m,u]=e.useState(null),{equippedSlots:h,loading:p,refresh:x}=function(t){const[s,a]=e.useState([]),[r,n]=e.useState({}),[i,o]=e.useState(!0),[l,c]=e.useState(null),d=e.useCallback((async()=>{if(!t?.trim())return c("ID do personagem não fornecido"),a([]),n({}),void o(!1);o(!0),c(null);try{const e=await _h.getCharacterEquipmentComplete(t);if(!e)throw new Error("Falha ao carregar equipamentos");a(e.allEquipment),n(e.equippedSlots)}catch(e){const t=e instanceof Error?e.message:"Erro ao carregar equipamentos";c(t),a([]),n({})}finally{o(!1)}}),[t]);return e.useEffect((()=>{d()}),[d]),{allEquipment:s,equippedSlots:r,loading:i,error:l,refresh:d}}(a);e.useEffect((()=>{(async()=>{if(a)try{const e=await Ah.getCharacter(a);e.success&&e.data&&i(e.data);const t=await Yx.getCharacterConsumables(a);t.success&&t.data?l(t.data):l([])}catch(e){j.error("Erro ao carregar equipamentos")}})()}),[a]);const f="weapon"===h.main_hand?.type&&h.main_hand?.is_two_handed;return p?t.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900 p-4",children:t.jsx("div",{className:"max-w-7xl mx-auto",children:t.jsxs("div",{className:"animate-pulse space-y-6",children:[t.jsx("div",{className:"h-8 bg-slate-700 rounded w-64"}),t.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[t.jsx("div",{className:"h-96 bg-slate-700 rounded"}),t.jsx("div",{className:"h-96 bg-slate-700 rounded"})]})]})})}):r?t.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900 p-4",children:t.jsxs("div",{className:"max-w-7xl mx-auto space-y-6",children:[t.jsx("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-4",children:t.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center gap-2 sm:gap-4",children:[t.jsxs(Ws,{variant:"outline",size:"sm",onClick:()=>s({to:"/game/play/hub",search:{character:a}}),className:"w-fit",children:[t.jsx(Me,{className:"h-4 w-4 mr-2"}),"Voltar"]}),t.jsxs("div",{className:"mt-2 sm:mt-0",children:[t.jsxs("h1",{className:"text-2xl sm:text-3xl font-bold text-slate-100 flex items-center gap-2",children:[t.jsx(De,{className:"h-6 sm:h-8 w-6 sm:w-8 text-amber-400"}),"Equipamentos"]}),t.jsxs("p",{className:"text-sm sm:text-base text-slate-400",children:[r.name," - Nível ",r.level]})]})]})}),t.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[t.jsxs("div",{className:"space-y-6",children:[t.jsx(vf,{equippedSlots:h,onSlotClick:(e,t)=>{d(e),u(t)},onSlotLongPress:e=>{s({to:"/game/play/hub/equipment/select",search:{character:a,slot:e}})}}),f&&t.jsx(fu,{className:"bg-orange-900/30 border-2 border-orange-600/50",children:t.jsx(yu,{className:"p-4",children:t.jsxs("div",{className:"flex items-start gap-3",children:[t.jsx("div",{className:"text-2xl",children:"⚔️"}),t.jsxs("div",{children:[t.jsx("h3",{className:"font-semibold text-orange-300 mb-1",children:"Arma Two-Handed Ativa"}),t.jsxs("p",{className:"text-sm text-orange-200",children:[t.jsx("strong",{children:h.main_hand?.name})," ocupa ambas as mãos. A mão secundária está bloqueada."]})]})]})})}),t.jsxs(fu,{className:"bg-slate-800/50 border-slate-700/50",children:[t.jsx(gu,{children:t.jsxs(bu,{className:"text-slate-100 flex items-center gap-2",children:[t.jsx(se,{className:"h-5 w-5 text-blue-400"}),"Slots de Poções"]})}),t.jsx(yu,{children:t.jsx(xf,{characterId:a,consumables:o,onSlotsUpdate:async()=>{if(!a)return;const e=await Yx.getCharacterConsumables(a);e.success&&e.data&&l(e.data)}})})]})]}),t.jsx("div",{children:t.jsx(bf,{selectedItem:m,selectedSlot:c,character:r,onEquipmentChange:x})})]})]})}):t.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900 p-4",children:t.jsx("div",{className:"max-w-7xl mx-auto",children:t.jsxs("div",{className:"text-center py-12",children:[t.jsx("h1",{className:"text-2xl font-bold text-slate-100 mb-4",children:"Personagem não encontrado"}),t.jsxs(Ws,{onClick:()=>s({to:"/game/play/hub",search:{character:a}}),children:[t.jsx(Me,{className:"h-4 w-4 mr-2"}),"Voltar ao Hub"]})]})})})}function Nf(){const e=xx(),t=Nx(),s=Sx();return{gameState:e.gameState,loading:e.loading,error:e.error,setGameState:e.setGameState,updateLoading:e.updateLoading,setError:e.setError,resetError:e.resetError,gameMessage:t.gameMessage,gameLog:t.gameLog,addGameLogMessage:t.addGameLogMessage,setGameMessage:t.setGameMessage,characters:s.characters,selectedCharacter:s.selectedCharacter,createCharacter:s.createCharacter,selectCharacter:s.selectCharacter,reloadCharacters:s.reloadCharacters,startGame:s.createCharacter,clearGameState:()=>{e.setGameState({mode:"menu",player:{id:"",user_id:"",name:"",level:1,xp:0,xp_next_level:150,gold:0,hp:50,max_hp:50,mana:20,max_mana:20,atk:10,def:5,speed:10,created_at:"",updated_at:"",isPlayerTurn:!0,specialCooldown:0,defenseCooldown:0,isDefending:!1,floor:1,spells:[],consumables:[],potionUsedThisTurn:!1,active_effects:{buffs:[],debuffs:[],dots:[],hots:[],attribute_modifications:[]},strength:10,dexterity:10,intelligence:10,wisdom:10,vitality:10,luck:10,critical_chance:0,critical_damage:110,double_attack_chance:0,magic_attack:0,magic_mastery:1,magic_damage_bonus:0},currentEnemy:null,currentFloor:null,isPlayerTurn:!0,gameMessage:"",highestFloor:1,selectedSpell:null,battleRewards:null,fleeSuccessful:!1,characterDeleted:!1})},returnToMenu:()=>{e.setGameState({...e.gameState,mode:"menu"})},saveProgress:async()=>{},updatePlayerConsumables:t=>{e.setGameState({...e.gameState,player:{...e.gameState.player,consumables:t}})}}}const wf=({recipe:e,onCraft:s,isCrafting:a,selectedCharacter:r})=>{if(!e)return t.jsxs("div",{className:"h-full flex flex-col items-center justify-center text-center p-6 bg-muted/10 rounded-lg border-2 border-dashed border-muted",children:[t.jsx(Et,{className:"h-16 w-16 text-muted-foreground mb-4"}),t.jsx("h3",{className:"text-lg font-semibold text-muted-foreground mb-2",children:"Selecione uma Receita"}),t.jsx("p",{className:"text-sm text-muted-foreground",children:"Escolha uma receita da lista para ver os detalhes e ingredientes necessários."})]});const n=()=>{if("equipment"===e.craftType){switch(e.result.rarity){case"legendary":return"text-orange-400 bg-orange-500/10 border-orange-500/20";case"epic":return"text-purple-400 bg-purple-500/10 border-purple-500/20";case"rare":return"text-blue-400 bg-blue-500/10 border-blue-500/20";case"uncommon":return"text-green-400 bg-green-500/10 border-green-500/20";default:return"text-gray-400 bg-gray-500/10 border-gray-500/20"}}else{switch(e.result.type){case"elixir":return"text-purple-400 bg-purple-500/10 border-purple-500/20";case"potion":return"text-red-400 bg-red-500/10 border-red-500/20";case"antidote":return"text-green-400 bg-green-500/10 border-green-500/20";default:return"text-blue-400 bg-blue-500/10 border-blue-500/20"}}};return t.jsxs("div",{className:"min-h-full flex flex-col",children:[t.jsxs("div",{className:"flex items-start gap-4 p-6 border-b shrink-0",children:[t.jsx("div",{className:Hs("p-3 rounded-lg border",n()),children:(()=>{if("equipment"===e.craftType){switch(e.result.type){case"weapon":return t.jsx(se,{className:"h-6 w-6"});case"armor":return t.jsx(De,{className:"h-6 w-6"});case"accessory":return t.jsx(xt,{className:"h-6 w-6"});default:return t.jsx(gt,{className:"h-6 w-6"})}}return t.jsx(ut,{className:"h-6 w-6"})})()}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsxs("div",{className:"flex items-start justify-between gap-2 mb-2",children:[t.jsx("h2",{className:"text-xl font-bold truncate",children:e.result.name}),t.jsxs("div",{className:"flex items-center gap-2 shrink-0",children:[t.jsx(_u,{className:Hs("",n()),children:"equipment"===e.craftType?e.result.rarity:e.result.type}),"equipment"===e.craftType&&e.result.level_requirement&&t.jsxs(_u,{variant:"outline",children:["Nível ",e.result.level_requirement]})]})]}),t.jsx("p",{className:"text-sm text-muted-foreground leading-relaxed mb-3",children:e.result.description}),"equipment"===e.craftType&&t.jsx("div",{className:"flex items-center gap-2 flex-wrap",children:t.jsx(_u,{variant:"secondary",className:"text-xs",children:(()=>{const t=e,s=t.result.type,a=t.result.weapon_subtype;if("weapon"===s&&a)switch(a){case"sword":return"Espada";case"axe":return"Machado";case"blunt":return"Maça";case"staff":return"Cajado";case"dagger":return"Adaga";default:return"Arma"}else{if("armor"===s)return"Armadura";if("accessory"===s)return"Acessório"}return s})()})})]})]}),"equipment"===e.craftType&&(()=>{const s=e;return(s.result.atk_bonus||0)>0||(s.result.def_bonus||0)>0||(s.result.mana_bonus||0)>0||(s.result.speed_bonus||0)>0||(s.result.hp_bonus||0)>0?t.jsxs("div",{className:"p-6 border-b bg-muted/20 shrink-0",children:[t.jsxs("h3",{className:"text-base font-semibold mb-3 flex items-center gap-2",children:[t.jsx(Ie,{className:"h-4 w-4"}),"Atributos do Equipamento"]}),t.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-3 gap-2",children:[(s.result.atk_bonus||0)>0&&t.jsxs("div",{className:"flex items-center gap-2 p-2 bg-red-500/10 border border-red-500/20 rounded-lg",children:[t.jsx(se,{className:"w-4 h-4 text-red-400"}),t.jsxs("span",{className:"text-sm font-medium",children:["+",s.result.atk_bonus," ATK"]})]}),(s.result.def_bonus||0)>0&&t.jsxs("div",{className:"flex items-center gap-2 p-2 bg-blue-500/10 border border-blue-500/20 rounded-lg",children:[t.jsx(De,{className:"w-4 h-4 text-blue-400"}),t.jsxs("span",{className:"text-sm font-medium",children:["+",s.result.def_bonus," DEF"]})]}),(s.result.mana_bonus||0)>0&&t.jsxs("div",{className:"flex items-center gap-2 p-2 bg-purple-500/10 border border-purple-500/20 rounded-lg",children:[t.jsx(ut,{className:"w-4 h-4 text-purple-400"}),t.jsxs("span",{className:"text-sm font-medium",children:["+",s.result.mana_bonus," MANA"]})]}),(s.result.speed_bonus||0)>0&&t.jsxs("div",{className:"flex items-center gap-2 p-2 bg-green-500/10 border border-green-500/20 rounded-lg",children:[t.jsx(re,{className:"w-4 h-4 text-green-400"}),t.jsxs("span",{className:"text-sm font-medium",children:["+",s.result.speed_bonus," VEL"]})]}),(s.result.hp_bonus||0)>0&&t.jsxs("div",{className:"flex items-center gap-2 p-2 bg-pink-500/10 border border-pink-500/20 rounded-lg",children:[t.jsx(ae,{className:"w-4 h-4 text-pink-400"}),t.jsxs("span",{className:"text-sm font-medium",children:["+",s.result.hp_bonus," HP"]})]})]})]}):null})(),"equipment"===e.craftType&&(()=>{const s=e,a={id:s.result_equipment_id,name:s.result.name,description:s.result.description,type:s.result.type,rarity:s.result.rarity,weapon_subtype:s.result.weapon_subtype,atk_bonus:s.result.atk_bonus||0,def_bonus:s.result.def_bonus||0,mana_bonus:s.result.mana_bonus||0,speed_bonus:s.result.speed_bonus||0,hp_bonus:s.result.hp_bonus||0,level_requirement:s.result.level_requirement||1,price:0,is_unlocked:!0};return t.jsxs("div",{className:"p-6 border-b bg-muted/10 shrink-0",children:[t.jsx("h3",{className:"text-base font-semibold mb-3",children:"Comparação com Equipamento Atual"}),t.jsx(tf,{characterId:r?.id||"",newEquipment:a,slotType:s.result.type,showTitle:!1,compact:!0})]})})(),t.jsxs("div",{className:"flex-1 min-h-0 p-6",children:[t.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[t.jsx("h3",{className:"text-lg font-semibold",children:"equipment"===e.craftType?"Materiais Necessários":"Ingredientes Necessários"}),t.jsxs(_u,{variant:"outline",className:"ml-auto",children:[e.ingredients.length," itens"]})]}),t.jsx("div",{className:"space-y-3 pr-2 max-h-[300px] overflow-y-auto ingredients-scroll",children:e.ingredients.map(((e,s)=>{const a=e.have>=e.quantity;return t.jsxs("div",{className:Hs("flex items-center justify-between p-3 rounded-lg border transition-colors",a?"bg-green-500/5 border-green-500/20":"bg-red-500/5 border-red-500/20"),children:[t.jsxs("div",{className:"flex items-center gap-2",children:["equipment"===e.type&&t.jsx(gt,{className:"h-4 w-4 text-blue-400"}),"drop"===e.type&&t.jsx(xt,{className:"h-4 w-4 text-orange-400"}),"consumable"===e.type&&t.jsx(ut,{className:"h-4 w-4 text-purple-400"}),t.jsx("span",{className:"font-medium",children:e.name})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsxs("span",{className:Hs("text-sm font-mono",a?"text-green-400":"text-red-400"),children:[e.have,"/",e.quantity]}),a?t.jsx(Dt,{className:"h-4 w-4 text-green-400"}):t.jsx(Pe,{className:"h-4 w-4 text-red-400"})]})]},s)}))})]}),t.jsx("div",{className:"p-6 border-t bg-card/50 mt-auto shrink-0",children:t.jsx(Ws,{onClick:async()=>{e.canCraft&&!a&&await s(e.id,e.craftType)},disabled:!e.canCraft||a,className:Hs("w-full h-12 text-base font-semibold transition-all",e.canCraft&&!a?"bg-emerald-600 hover:bg-emerald-700 text-white":"bg-muted text-muted-foreground cursor-not-allowed"),children:a?t.jsxs(t.Fragment,{children:[t.jsx(Rt,{className:"h-4 w-4 mr-2 animate-spin"}),"equipment"===e.craftType?"Forjando...":"Criando..."]}):e.canCraft?t.jsxs(t.Fragment,{children:[t.jsx(gt,{className:"h-4 w-4 mr-2"}),"equipment"===e.craftType?"Forjar Item":"Criar Item"]}):t.jsxs(t.Fragment,{children:[t.jsx(Pe,{className:"h-4 w-4 mr-2"}),"Materiais Insuficientes"]})})})]})},_f=({recipe:e,isSelected:s,onClick:a})=>t.jsx("div",{onClick:a,className:Hs("p-4 border rounded-lg cursor-pointer transition-all border-l-4",(()=>{if("equipment"===e.craftType){switch(e.result.rarity){case"legendary":return"border-l-orange-500 bg-orange-500/5";case"epic":return"border-l-purple-500 bg-purple-500/5";case"rare":return"border-l-blue-500 bg-blue-500/5";case"uncommon":return"border-l-green-500 bg-green-500/5";default:return"border-l-gray-500 bg-gray-500/5"}}else{switch(e.result.type){case"elixir":return"border-l-purple-500 bg-purple-500/5";case"potion":return"border-l-red-500 bg-red-500/5";case"antidote":return"border-l-green-500 bg-green-500/5";default:return"border-l-blue-500 bg-blue-500/5"}}})(),s?"ring-2 ring-primary border-primary bg-primary/5":"hover:bg-accent/50 hover:border-accent"),children:t.jsxs("div",{className:"flex items-start gap-3",children:[t.jsx("div",{className:"shrink-0 mt-1",children:"equipment"===e.craftType?t.jsx(gt,{className:"h-4 w-4 text-blue-400"}):t.jsx(ut,{className:"h-4 w-4 text-purple-400"})}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[t.jsx("h3",{className:"font-semibold truncate",children:e.result.name}),e.canCraft?t.jsx(Dt,{className:"h-4 w-4 text-green-400 shrink-0"}):t.jsx(Pe,{className:"h-4 w-4 text-red-400 shrink-0"})]}),t.jsx("p",{className:"text-sm text-muted-foreground line-clamp-2 mb-2",children:e.result.description}),t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx(_u,{variant:"outline",className:"text-xs",children:"equipment"===e.craftType?e.result.rarity:e.result.type}),t.jsxs("span",{className:"text-xs text-muted-foreground",children:[e.ingredients.length," ingredientes"]})]})]})]})});const Cf=r("/_authenticated/game/play/hub/crafting")({component:function(){const s=n(),{character:a}=Cf.useSearch(),{characters:r,selectedCharacter:i,selectCharacter:o}=Nf(),[l,c]=e.useState(!1),[d,m]=e.useState(!1),[u,h]=e.useState([]),[p,x]=e.useState([]),[f,g]=e.useState({consumables:[],drops:[],equipment:[]}),[b,v]=e.useState([]),[y,N]=e.useState([]),[w,_]=e.useState([]),[C,S]=e.useState([]),[E,k]=e.useState(null),[A,P]=e.useState(!1),[M,T]=e.useState(""),[q,D]=e.useState("all"),[R,L]=e.useState("all"),[$,I]=e.useState("all"),[F,V]=e.useState("all"),[O,B]=e.useState("all");e.useEffect((()=>{P(!0)}),[]),e.useEffect((()=>{if(A&&a&&r.length>0){const e=r.find((e=>e.id===a));!e||i&&i.id===a||o(e.id,e.name)}}),[A,a,r.length]),e.useEffect((()=>{if(!A||!i)return;(async()=>{c(!0);try{const[e,t,s,a,r,n,o,l]=await Promise.all([Yx.getCraftingRecipes(),_h.getEquipmentCraftingRecipes(),Yx.getCharacterConsumables(i.id),Yx.getCharacterDrops(i.id),_h.getCharacterEquipment(i.id),Yx.getAvailableConsumables(),Yx.getMonsterDrops(),_h.getAllEquipments()]);e.success&&e.data&&h(e.data),t.success&&t.data&&x(t.data),g({consumables:s.success&&s.data||[],drops:a.success&&a.data||[],equipment:r||[]}),n.success&&n.data&&v(n.data),o.success&&o.data&&N(o.data),l&&Array.isArray(l)&&_(l)}catch(e){j.error("Erro ao carregar receitas e inventário")}finally{c(!1)}})()}),[A,i]),e.useEffect((()=>{if(!A||!u.length&&!p.length||!i)return;(()=>{const e=[];for(const s of u)try{const t=f.consumables.find((e=>e.consumable_id===s.result_id))?.consumable,a={name:s.name,description:s.description,type:"potion"};t&&(a.name=t.name,a.description=t.description,a.type=t.type);const r=s.ingredients.map((e=>{let t="",s=0,a="drop";if("monster_drop"===e.item_type){const r=f.drops.find((t=>t.drop_id===e.item_id));if(s=r?.quantity||0,a="drop",r?.drop?.name)t=r.drop.name;else{const s=y.find((t=>t.id===e.item_id));t=s?.name||`Drop ID: ${e.item_id}`}}else if("consumable"===e.item_type){const r=f.consumables.find((t=>t.consumable_id===e.item_id));if(s=r?.quantity||0,a="consumable",r?.consumable?.name)t=r.consumable.name;else{const s=b.find((t=>t.id===e.item_id));t=s?.name||`Consumível ID: ${e.item_id}`}}else if("equipment"===e.item_type){const r=f.equipment.filter((t=>t.equipment_id===e.item_id&&!t.is_equipped));if(s=r.length,a="equipment",r[0]?.equipment?.name)t=r[0].equipment.name;else{const s=w.find((t=>t.id===e.item_id));t=s?.name||`Equipamento ID: ${e.item_id}`}}return{name:t,quantity:e.quantity,have:s,type:a}})),n=r.every((e=>e.have>=e.quantity));e.push({id:s.id,result_id:s.result_id,result:a,ingredients:r,canCraft:n,craftType:"consumable"})}catch(t){}for(const s of p)try{if(s.equipment){const t=s.ingredients.map((e=>{let t="",s=0,a="drop";if("monster_drop"===e.item_type){const r=f.drops.find((t=>t.drop_id===e.item_id));if(s=r?.quantity||0,a="drop",r?.drop?.name)t=r.drop.name;else{const s=y.find((t=>t.id===e.item_id));t=s?.name||`Drop ID: ${e.item_id}`}}else if("consumable"===e.item_type){const r=f.consumables.find((t=>t.consumable_id===e.item_id));if(s=r?.quantity||0,a="consumable",r?.consumable?.name)t=r.consumable.name;else{const s=b.find((t=>t.id===e.item_id));t=s?.name||`Consumível ID: ${e.item_id}`}}else if("equipment"===e.item_type){const r=f.equipment.filter((t=>t.equipment_id===e.item_id&&!t.is_equipped));if(s=r.length,a="equipment",r[0]?.equipment?.name)t=r[0].equipment.name;else{const s=w.find((t=>t.id===e.item_id));t=s?.name||`Equipamento ID: ${e.item_id}`}}return{name:t,quantity:e.quantity,have:s,type:a}})),a=t.every((e=>e.have>=e.quantity));e.push({id:s.id,result_equipment_id:s.result_equipment_id,result:{name:s.equipment.name,description:s.equipment.description,type:s.equipment.type,rarity:s.equipment.rarity,weapon_subtype:s.equipment.weapon_subtype||void 0,atk_bonus:s.equipment.atk_bonus||0,def_bonus:s.equipment.def_bonus||0,mana_bonus:s.equipment.mana_bonus||0,speed_bonus:s.equipment.speed_bonus||0,hp_bonus:0,level_requirement:s.equipment.level_requirement||1},ingredients:t,canCraft:a,craftType:"equipment"})}}catch(t){}if(S(e),E){const t=e.find((e=>e.id===E.id));t&&k(t)}})()}),[A,u,p,f,i,E?.id,b,y,w]);const U=e.useMemo((()=>{let e=C;return M&&(e=e.filter((e=>e.result.name.toLowerCase().includes(M.toLowerCase())||e.result.description.toLowerCase().includes(M.toLowerCase())))),"all"!==q&&(e=e.filter((e=>e.craftType===q))),"all"!==$&&(e=e.filter((e=>{if("equipment"===e.craftType){return e.result.type===$}return!0}))),"all"!==F&&(e=e.filter((e=>{if("equipment"===e.craftType){return e.result.weapon_subtype===F}return!0}))),"all"!==O&&(e=e.filter((e=>{if("equipment"===e.craftType){return e.result.rarity===O}return e.result.type===O}))),"craftable"===R?e=e.filter((e=>e.canCraft)):"missing"===R&&(e=e.filter((e=>!e.canCraft))),e}),[C,M,q,R,$,F,O]);return A?a&&""!==a.trim()?i?t.jsxs("div",{className:"container mx-auto py-6 px-4 max-w-7xl",children:[t.jsx("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-4 mb-6",children:t.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center gap-2 sm:gap-4",children:[t.jsxs(Ws,{variant:"outline",size:"sm",onClick:()=>s({to:"/game/play/hub",search:{character:i.id}}),className:"w-fit",children:[t.jsx(Me,{className:"h-4 w-4 mr-2"}),"Voltar ao Hub"]}),t.jsxs("div",{className:"mt-2 sm:mt-0",children:[t.jsx("h1",{className:"text-2xl sm:text-3xl font-bold",children:"Forja de Artefatos"}),t.jsx("p",{className:"text-sm sm:text-base text-muted-foreground",children:"Crie poções, elixires e forje equipamentos únicos com materiais raros"})]})]})}),t.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-12 gap-6",children:[t.jsx("div",{className:"lg:col-span-5",children:t.jsxs(fu,{className:"h-full max-h-[calc(100vh-280px)]",children:[t.jsxs(gu,{className:"pb-4",children:[t.jsxs("div",{className:"flex items-center justify-between mb-4",children:[t.jsxs(bu,{className:"flex items-center gap-2",children:[t.jsx(gt,{className:"h-5 w-5"}),"Receitas Disponíveis"]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsxs(_u,{variant:"outline",children:[U.length," de ",C.length]}),(M||"all"!==q||"all"!==R||"all"!==$||"all"!==F||"all"!==O)&&t.jsx(Ws,{variant:"ghost",size:"sm",onClick:()=>{T(""),D("all"),L("all"),I("all"),V("all"),B("all")},className:"h-6 px-2 text-xs",children:"Limpar Filtros"})]})]}),t.jsxs("div",{className:"space-y-3",children:[t.jsxs("div",{className:"relative",children:[t.jsx(Oe,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),t.jsx(qa,{placeholder:"Buscar receita...",value:M,onChange:e=>T(e.target.value),className:"pl-9"})]}),t.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[t.jsxs(cu,{value:q,onValueChange:e=>{D(e),"equipment"!==e&&(I("all"),V("all"),B("all"))},children:[t.jsx(mu,{children:t.jsx(du,{placeholder:"Tipo"})}),t.jsxs(pu,{children:[t.jsx(xu,{value:"all",children:"Todos os Tipos"}),t.jsx(xu,{value:"equipment",children:"Equipamentos"}),t.jsx(xu,{value:"consumable",children:"Consumíveis"})]})]}),t.jsxs(cu,{value:R,onValueChange:e=>L(e),children:[t.jsx(mu,{children:t.jsx(du,{placeholder:"Status"})}),t.jsxs(pu,{children:[t.jsx(xu,{value:"all",children:"Todos"}),t.jsx(xu,{value:"craftable",children:"Criáveis"}),t.jsx(xu,{value:"missing",children:"Faltam Materiais"})]})]})]}),"equipment"===q&&t.jsxs("div",{className:"space-y-2",children:[t.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[t.jsxs(cu,{value:$,onValueChange:e=>{I(e),"weapon"!==e&&V("all")},children:[t.jsx(mu,{children:t.jsx(du,{placeholder:"Tipo de Equipamento"})}),t.jsxs(pu,{children:[t.jsx(xu,{value:"all",children:"Todos Equipamentos"}),t.jsx(xu,{value:"weapon",children:"Armas"}),t.jsx(xu,{value:"armor",children:"Armaduras"}),t.jsx(xu,{value:"accessory",children:"Acessórios"})]})]}),t.jsxs(cu,{value:O,onValueChange:e=>B(e),children:[t.jsx(mu,{children:t.jsx(du,{placeholder:"Raridade"})}),t.jsxs(pu,{children:[t.jsx(xu,{value:"all",children:"Todas Raridades"}),t.jsx(xu,{value:"common",children:"Comum"}),t.jsx(xu,{value:"uncommon",children:"Incomum"}),t.jsx(xu,{value:"rare",children:"Raro"}),t.jsx(xu,{value:"epic",children:"Épico"}),t.jsx(xu,{value:"legendary",children:"Lendário"})]})]})]}),"weapon"===$&&t.jsxs(cu,{value:F,onValueChange:e=>V(e),children:[t.jsx(mu,{children:t.jsx(du,{placeholder:"Tipo de Arma"})}),t.jsxs(pu,{children:[t.jsx(xu,{value:"all",children:"Todas as Armas"}),t.jsx(xu,{value:"sword",children:"Espadas"}),t.jsx(xu,{value:"axe",children:"Machados"}),t.jsx(xu,{value:"blunt",children:"Maças"}),t.jsx(xu,{value:"staff",children:"Cajados"}),t.jsx(xu,{value:"dagger",children:"Adagas"})]})]})]})]})]}),t.jsx(yu,{className:"flex-1 overflow-hidden",children:l?t.jsxs("div",{className:"flex items-center justify-center h-64",children:[t.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-2 border-primary border-t-transparent"}),t.jsx("span",{className:"ml-2 text-muted-foreground",children:"Carregando receitas..."})]}):U.length>0?t.jsx("div",{className:"space-y-2 h-full max-h-96 overflow-y-auto pr-2 scrollbar-thin scrollbar-thumb-border scrollbar-track-transparent",children:U.map((e=>t.jsx(_f,{recipe:e,isSelected:E?.id===e.id,onClick:()=>k(e)},e.id)))}):t.jsxs("div",{className:"flex flex-col items-center justify-center h-64 text-center",children:[t.jsx(Nt,{className:"h-12 w-12 text-muted-foreground mb-3"}),t.jsx("p",{className:"text-muted-foreground text-lg",children:"Nenhuma receita encontrada"}),t.jsx("p",{className:"text-muted-foreground text-sm mt-1",children:"Tente ajustar os filtros ou explore a torre para encontrar novas receitas"})]})})]})}),t.jsx("div",{className:"lg:col-span-7",children:t.jsx(fu,{className:"h-full max-h-[calc(100vh-280px)] overflow-hidden",children:t.jsx("div",{className:"h-full overflow-y-auto",children:t.jsx(wf,{recipe:E,onCraft:async(e,t)=>{if(i&&!d){m(!0);try{let s;if(s="consumable"===t?await Yx.craftItem(i.id,e):await _h.craftEquipment(i.id,e),s.success){j.success("Item criado com sucesso!",{description:s.data?.message});const[e,t,a]=await Promise.all([Yx.getCharacterConsumables(i.id),Yx.getCharacterDrops(i.id),_h.getCharacterEquipment(i.id)]);g({consumables:e.success?e.data||[]:f.consumables,drops:t.success?t.data||[]:f.drops,equipment:a||f.equipment})}else j.error("Erro ao criar item",{description:s.error})}catch(s){j.error("Erro ao criar item")}finally{m(!1)}}},isCrafting:d,selectedCharacter:i})})})})]})]}):t.jsx("div",{className:"container mx-auto py-6 text-center",children:t.jsx("p",{children:"Carregando personagem..."})}):t.jsxs("div",{className:"container mx-auto py-6 text-center",children:[t.jsx("p",{children:"Redirecionando para seleção de personagem..."}),t.jsx(Ws,{onClick:()=>s({to:"/game/play"}),children:"Selecionar Personagem"})]}):t.jsx("div",{className:"container mx-auto py-6 text-center",children:t.jsx("p",{children:"Carregando..."})})},validateSearch:e=>{const t=e.character;return t&&"string"==typeof t?{character:t.trim()}:{character:""}}});function Sf(){const[t,s]=e.useState(!1);return e.useEffect((()=>{if("undefined"==typeof window)return;const e=()=>{const e=window.innerWidth,t=window.innerHeight;s(e>t&&t<=500&&e<=1024)};return e(),window.addEventListener("resize",e),window.addEventListener("orientationchange",(()=>{setTimeout(e,100)})),()=>{window.removeEventListener("resize",e),window.removeEventListener("orientationchange",e)}}),[]),t}function Ef(){const[t,s]=e.useState(!1);return e.useEffect((()=>{if("undefined"==typeof window)return;const e=()=>{const e=window.innerWidth,t=window.innerHeight;s(e>t&&(e>=480&&e<=1024)&&(t>=320&&t<=600))};return e(),window.addEventListener("resize",e),window.addEventListener("orientationchange",(()=>{setTimeout(e,100)})),()=>{window.removeEventListener("resize",e),window.removeEventListener("orientationchange",e)}}),[]),t}function kf({icon:s,label:a,value:r,color:n,bgColor:i,borderColor:o,tooltipData:l}){const[c,d]=e.useState(!1),m=function(t){const[s,a]=e.useState(!1);return e.useEffect((()=>{if("undefined"==typeof window)return;const e=window.matchMedia(t);a(e.matches);const s=e=>{a(e.matches)};return e.addEventListener?e.addEventListener("change",s):e.addListener(s),()=>{e.removeEventListener?e.removeEventListener("change",s):e.removeListener(s)}}),[t]),s}("(max-width: 768px)"),{elementRef:u,tooltipPosition:h,updatePosition:p}=function(){const t=e.useRef(null),[s,a]=e.useState("right"),r=e.useCallback((()=>{if(!t.current)return;const e=t.current,s=e.getBoundingClientRect();let r=e.parentElement;for(;r&&!r.classList.contains("grid");)r=r.parentElement;if(!r)return void a("right");const n=r.getBoundingClientRect(),i=n.width,o=s.left+s.width/2-n.left;a(o<i/3?"right":o>2*i/3?"left":"bottom")}),[]);return e.useEffect((()=>{r();const e=()=>r();return window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)}),[r]),{elementRef:t,tooltipPosition:s,updatePosition:r}}(),x=()=>t.jsxs("div",{className:"bg-slate-900 border border-slate-700 rounded-lg p-3 shadow-xl",children:[t.jsx("div",{className:"text-sm font-medium text-slate-200 mb-2",children:l.title}),t.jsxs("div",{className:"text-xs text-slate-300 font-mono space-y-1",children:[l.calculations.map(((e,s)=>t.jsxs("div",{className:"flex justify-between",children:[t.jsx("span",{children:e.label}),t.jsx("span",{className:e.color,children:e.value})]},s))),t.jsxs("div",{className:"border-t border-slate-600 pt-1 mt-1 flex justify-between font-bold",children:[t.jsx("span",{children:l.total.label}),t.jsx("span",{className:l.total.color,children:l.total.value})]})]})]});return t.jsxs(t.Fragment,{children:[t.jsxs("div",{ref:u,className:`p-3 rounded-lg border ${i} ${o} ${m?"cursor-pointer":"cursor-help group"} relative`,onClick:()=>{m&&d(!0)},onMouseEnter:()=>{m||p()},title:m?`Toque para ver a fórmula de ${a}`:"Clique para ver a fórmula",children:[t.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[t.jsx(s,{className:`h-4 w-4 ${n}`}),t.jsx("span",{className:`text-sm font-medium ${n}`,children:a})]}),t.jsx("div",{className:`text-2xl font-bold ${n}`,children:"number"==typeof r?r.toLocaleString():r}),!m&&t.jsx("div",{className:"absolute z-50 invisible group-hover:visible min-w-[280px] "+("left"===h?"right-full mr-2 -top-2":"right"===h?"left-full ml-2 -top-2":"top-full mt-2 left-1/2 transform -translate-x-1/2"),children:t.jsx(x,{})})]}),m&&t.jsx(Ph,{open:c,onOpenChange:d,children:t.jsxs(qh,{className:"max-w-sm",children:[t.jsx(Dh,{children:t.jsxs(Lh,{className:"flex items-center gap-2",children:[t.jsx(s,{className:`h-5 w-5 ${n}`}),"Fórmula de ",a]})}),t.jsxs("div",{className:"space-y-2",children:[l.calculations.map(((e,s)=>t.jsxs("div",{className:"flex justify-between text-sm",children:[t.jsx("span",{className:"text-muted-foreground",children:e.label}),t.jsx("span",{className:`font-mono ${e.color}`,children:e.value})]},s))),t.jsxs("div",{className:"border-t pt-2 flex justify-between font-bold",children:[t.jsx("span",{children:l.total.label}),t.jsx("span",{className:`${l.total.color}`,children:l.total.value})]})]})]})})]})}class Af{static async convertToGamePlayer(e){const t=await yh.calculateDerivedStats(e);return{id:e.id,user_id:e.user_id,name:e.name,level:e.level,xp:e.xp,xp_next_level:e.xp_next_level,gold:e.gold,hp:e.hp||t.hp,max_hp:e.max_hp||t.max_hp,mana:e.mana||t.mana,max_mana:e.max_mana||t.max_mana,atk:e.atk||t.atk,def:e.def||t.def,speed:e.speed||t.speed,created_at:e.created_at,updated_at:e.updated_at,floor:e.floor,strength:e.strength||10,dexterity:e.dexterity||10,intelligence:e.intelligence||10,wisdom:e.wisdom||10,vitality:e.vitality||10,luck:e.luck||10,attribute_points:e.attribute_points||0,sword_mastery:e.sword_mastery||1,axe_mastery:e.axe_mastery||1,blunt_mastery:e.blunt_mastery||1,defense_mastery:e.defense_mastery||1,magic_mastery:e.magic_mastery||1,sword_mastery_xp:e.sword_mastery_xp||0,axe_mastery_xp:e.axe_mastery_xp||0,blunt_mastery_xp:e.blunt_mastery_xp||0,defense_mastery_xp:e.defense_mastery_xp||0,magic_mastery_xp:e.magic_mastery_xp||0,critical_chance:t.critical_chance,critical_damage:t.critical_damage,magic_damage_bonus:t.magic_damage_bonus,magic_attack:t.magic_attack,double_attack_chance:t.double_attack_chance,base_hp:e.hp||t.hp,base_max_hp:e.max_hp||t.max_hp,base_mana:e.mana||t.mana,base_max_mana:e.max_mana||t.max_mana,base_atk:e.atk||t.atk,base_def:e.def||t.def,base_speed:e.speed||t.speed,equipment_hp_bonus:0,equipment_mana_bonus:0,equipment_atk_bonus:0,equipment_def_bonus:0,equipment_speed_bonus:0,isPlayerTurn:!0,specialCooldown:0,defenseCooldown:0,isDefending:!1,spells:[],consumables:[],active_effects:{buffs:[],debuffs:[],dots:[],hots:[],attribute_modifications:[]}}}static convertToCharacterStats(e){return{level:e.level,xp:e.xp,xp_next_level:e.xp_next_level,gold:e.gold,hp:e.hp,max_hp:e.max_hp,mana:e.mana,max_mana:e.max_mana,atk:e.atk,def:e.def,speed:e.speed,strength:e.strength||10,dexterity:e.dexterity||10,intelligence:e.intelligence||10,wisdom:e.wisdom||10,vitality:e.vitality||10,luck:e.luck||10,attribute_points:e.attribute_points||0,critical_chance:e.critical_chance||0,critical_damage:e.critical_damage||0,magic_damage_bonus:e.magic_damage_bonus||0,magic_attack:e.magic_attack||0,sword_mastery:e.sword_mastery||1,axe_mastery:e.axe_mastery||1,blunt_mastery:e.blunt_mastery||1,defense_mastery:e.defense_mastery||1,magic_mastery:e.magic_mastery||1,sword_mastery_xp:e.sword_mastery_xp||0,axe_mastery_xp:e.axe_mastery_xp||0,blunt_mastery_xp:e.blunt_mastery_xp||0,defense_mastery_xp:e.defense_mastery_xp||0,magic_mastery_xp:e.magic_mastery_xp||0,base_hp:e.base_hp||e.hp,base_max_hp:e.base_max_hp||e.max_hp,base_mana:e.base_mana||e.mana,base_max_mana:e.base_max_mana||e.max_mana,base_atk:e.base_atk||e.atk,base_def:e.base_def||e.def,base_speed:e.base_speed||e.speed,equipment_hp_bonus:e.equipment_hp_bonus||0,equipment_mana_bonus:e.equipment_mana_bonus||0,equipment_atk_bonus:e.equipment_atk_bonus||0,equipment_def_bonus:e.equipment_def_bonus||0,equipment_speed_bonus:e.equipment_speed_bonus||0}}static async getDerivedStats(e){return await yh.calculateDerivedStats(e)}static async calculatePreviewImprovements(e,t){const s=await yh.calculateDerivedStats(e),a={...e,strength:(e.strength||10)+t.strength,dexterity:(e.dexterity||10)+t.dexterity,intelligence:(e.intelligence||10)+t.intelligence,wisdom:(e.wisdom||10)+t.wisdom,vitality:(e.vitality||10)+t.vitality,luck:(e.luck||10)+t.luck},r=await yh.calculateDerivedStats(a);return{hp:r.max_hp-s.max_hp,mana:r.max_mana-s.max_mana,atk:r.atk-s.atk,speed:r.speed-s.speed,critChance:r.critical_chance-s.critical_chance}}static async getStatsBreakdown(e){const t=e.level,s=e.strength||10,a=e.dexterity||10,r=e.intelligence||10,n=e.wisdom||10,i=e.vitality||10,o=e.luck||10,l=Math.pow(s,1.1),c=Math.pow(a,1.1),d=Math.pow(r,1.1),m=Math.pow(n,1.05),u=Math.pow(i,1.2),h=o,p=e.sword_mastery||1,x=e.axe_mastery||1,f=e.blunt_mastery||1,g=e.defense_mastery||1,b=e.magic_mastery||1,v=Math.pow(Math.max(p,x,f),1.05),y=Math.pow(g,1.1),j=Math.pow(b,1.05),N=50+2*t,w=Math.floor(1.5*u),_=Math.floor(.2*l),C=e.equipment_hp_bonus||0,S=20+1*t,E=Math.floor(1*d),k=Math.floor(.8*m),A=Math.floor(.5*j),P=e.equipment_mana_bonus||0,M=2+t,T=Math.floor(.8*l),q=Math.floor(.4*v),D=Math.floor(.1*c),R=e.equipment_atk_bonus||0,L=1+t,$=Math.floor(.4*u),I=Math.floor(.3*m),F=Math.floor(.8*y),V=e.equipment_def_bonus||0,O=3+t,B=Math.floor(.8*c),U=Math.floor(.1*h),z=e.equipment_speed_bonus||0,G=.15*c,H=.25*h,X=.05*l,W=.1*v,Y=.3*l,K=.2*h,J=.4*v,Q=.8*d,Z=.4*m,ee=1*j;return{hp:{base:N,fromAttributes:w+_,fromMasteries:0,fromEquipment:C,total:N+w+_+C},mana:{base:S,fromAttributes:E+k,fromMasteries:A,fromEquipment:P,total:S+E+k+A+P},atk:{base:M,fromAttributes:T+D,fromMasteries:q,fromEquipment:R,total:M+T+q+D+R},def:{base:L,fromAttributes:$+I,fromMasteries:F,fromEquipment:V,total:L+$+I+F+V},speed:{base:O,fromAttributes:B+U,fromMasteries:0,fromEquipment:z,total:O+B+U+z},criticalChance:{base:1,fromAttributes:G+H+X,fromMasteries:W,fromEquipment:0,total:Math.min(60,1+G+H+X+W)},criticalDamage:{base:102,fromAttributes:Y+K,fromMasteries:J,fromEquipment:0,total:Math.min(200,102+Y+K+J)},magicDamage:{base:2,fromAttributes:Q+Z,fromMasteries:ee,fromEquipment:0,total:Math.min(150,2+Q+Z+ee)}}}static formatValueWithEquipmentBonus(e,t){const s=t||0,a=e+s;return{totalValue:a,baseValue:e,equipmentBonus:s,hasBonus:s>0,formattedTotal:a.toLocaleString(),formattedBonus:s>0?`(+${s})`:""}}static calculateXpProgress(e){const t=(s=e.level)<=1?0:Math.floor(100*Math.pow(1.5,s-2));var s;const a=e.xp_next_level,r=e.xp-t,n=a-t;return{xpInCurrentLevel:r,xpNeededForNextLevel:n,xpProgress:Math.max(0,Math.min(100,r/n*100))}}static calculateHealthProgress(e){return{hpProgress:e.max_hp>0?Math.max(0,Math.min(100,e.hp/e.max_hp*100)):0,manaProgress:e.max_mana>0?Math.max(0,Math.min(100,e.mana/e.max_mana*100)):0}}static validateCharacterConsistency(e){const t=[];e.hp>e.max_hp&&t.push(`HP atual (${e.hp}) maior que HP máximo (${e.max_hp})`),e.mana>e.max_mana&&t.push(`Mana atual (${e.mana}) maior que Mana máximo (${e.max_mana})`);return[e.strength||10,e.dexterity||10,e.intelligence||10,e.wisdom||10,e.vitality||10,e.luck||10].some((e=>e<1||e>100))&&t.push("Atributos fora do range válido (1-100)"),(e.level<1||e.level>100)&&t.push(`Nível inválido: ${e.level}`),{isValid:0===t.length,issues:t}}}function Pf({characterStats:e}){const[s,a]=c.useState(null);if(c.useEffect((()=>{Af.getStatsBreakdown(e).then(a)}),[e.strength,e.dexterity,e.intelligence,e.wisdom,e.vitality,e.luck,e.level]),!s)return t.jsxs(fu,{children:[t.jsx(gu,{children:t.jsxs(bu,{className:"flex items-center gap-2",children:[t.jsx(Lt,{className:"h-5 w-5"}),"Stats Derivados"]})}),t.jsx(yu,{children:t.jsx("div",{className:"animate-pulse space-y-4",children:[1,2,3,4].map((e=>t.jsx("div",{className:"h-16 bg-muted/20 rounded-lg"},e)))})})]});const r=(e,t,s=0,a)=>{const r=[{label:"Base:",value:t.base,color:"text-blue-400"},{label:"Atributos:",value:`+${t.fromAttributes}`,color:"text-green-400"}];return t.fromMasteries>0&&r.push({label:"Maestrias:",value:`+${t.fromMasteries}`,color:"text-purple-400"}),s>0&&r.push({label:"Equipamentos:",value:`+${s}`,color:"text-orange-400"}),{title:e,calculations:r,total:{label:"Total (Sistema):",value:a.toLocaleString(),color:"text-green-400"}}},n=[{icon:ae,label:"HP Máximo",value:(()=>{const s=Af.formatValueWithEquipmentBonus(e.max_hp-(e.equipment_hp_bonus||0),e.equipment_hp_bonus||0);return s.hasBonus?t.jsxs("span",{children:[s.formattedTotal,t.jsx("span",{className:"text-orange-400 text-sm ml-1 font-medium",children:s.formattedBonus})]}):t.jsx("span",{children:s.formattedTotal})})(),color:"text-red-400",bgColor:"bg-red-500/5",borderColor:"border-red-500/20",tooltipData:r("Cálculo do HP:",s.hp,e.equipment_hp_bonus||0,e.max_hp)},{icon:$t,label:"Mana Máxima",value:(()=>{const s=Af.formatValueWithEquipmentBonus(e.max_mana-(e.equipment_mana_bonus||0),e.equipment_mana_bonus||0);return s.hasBonus?t.jsxs("span",{children:[s.formattedTotal,t.jsx("span",{className:"text-orange-400 text-sm ml-1 font-medium",children:s.formattedBonus})]}):t.jsx("span",{children:s.formattedTotal})})(),color:"text-blue-400",bgColor:"bg-blue-500/5",borderColor:"border-blue-500/20",tooltipData:r("Cálculo da Mana:",s.mana,e.equipment_mana_bonus||0,e.max_mana)},{icon:se,label:"ATK Físico",value:(()=>{const s=Af.formatValueWithEquipmentBonus(e.atk-(e.equipment_atk_bonus||0),e.equipment_atk_bonus||0);return s.hasBonus?t.jsxs("span",{children:[s.formattedTotal,t.jsx("span",{className:"text-orange-400 text-sm ml-1 font-medium",children:s.formattedBonus})]}):t.jsx("span",{children:s.formattedTotal})})(),color:"text-red-400",bgColor:"bg-red-500/5",borderColor:"border-red-500/20",tooltipData:r("Cálculo do ATK Físico:",s.atk,e.equipment_atk_bonus||0,e.atk)},...e.magic_attack&&e.magic_attack>0?[{icon:ut,label:"ATK Mágico",value:t.jsx("span",{children:e.magic_attack.toLocaleString()}),color:"text-purple-400",bgColor:"bg-purple-500/5",borderColor:"border-purple-500/20",tooltipData:r("Cálculo do ATK Mágico:",s.atk,0,e.magic_attack)}]:[],{icon:De,label:"Defesa",value:(()=>{const s=Af.formatValueWithEquipmentBonus(e.def-(e.equipment_def_bonus||0),e.equipment_def_bonus||0);return s.hasBonus?t.jsxs("span",{children:[s.formattedTotal,t.jsx("span",{className:"text-orange-400 text-sm ml-1 font-medium",children:s.formattedBonus})]}):t.jsx("span",{children:s.formattedTotal})})(),color:"text-blue-400",bgColor:"bg-blue-500/5",borderColor:"border-blue-500/20",tooltipData:r("Cálculo da Defesa:",s.def,e.equipment_def_bonus||0,e.def)},{icon:re,label:"Velocidade",value:(()=>{const s=Af.formatValueWithEquipmentBonus(e.speed-(e.equipment_speed_bonus||0),e.equipment_speed_bonus||0);return s.hasBonus?t.jsxs("span",{children:[s.formattedTotal,t.jsx("span",{className:"text-orange-400 text-sm ml-1 font-medium",children:s.formattedBonus})]}):t.jsx("span",{children:s.formattedTotal})})(),color:"text-yellow-400",bgColor:"bg-yellow-500/5",borderColor:"border-yellow-500/20",tooltipData:r("Cálculo da Velocidade:",s.speed,e.equipment_speed_bonus||0,e.speed)},{icon:pt,label:"Chance Crítica",value:t.jsxs("span",{children:[e.critical_chance.toFixed(1),"%"]}),color:"text-yellow-400",bgColor:"bg-yellow-500/5",borderColor:"border-yellow-500/20",tooltipData:r("Cálculo da Chance Crítica:",s.criticalChance,0,e.critical_chance)},{icon:ft,label:"Dano Crítico",value:t.jsxs("span",{children:[e.critical_damage.toFixed(0),"%"]}),color:"text-orange-400",bgColor:"bg-orange-500/5",borderColor:"border-orange-500/20",tooltipData:r("Cálculo do Dano Crítico:",s.criticalDamage,0,e.critical_damage)},{icon:ut,label:"Bônus Mágico",value:t.jsxs("span",{children:[e.magic_damage_bonus?.toFixed(1)||"0.0","%"]}),color:"text-purple-400",bgColor:"bg-purple-500/5",borderColor:"border-purple-500/20",tooltipData:r("Cálculo do Bônus Mágico:",s.magicDamage,0,e.magic_damage_bonus||0)}];return t.jsxs(fu,{children:[t.jsx(gu,{children:t.jsxs(bu,{className:"flex items-center gap-2",children:[t.jsx(Lt,{className:"h-5 w-5"}),"Stats Derivados"]})}),t.jsx(yu,{children:t.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:n.map(((e,s)=>t.jsx(kf,{icon:e.icon,label:e.label,value:e.value,color:e.color,bgColor:e.bgColor,borderColor:e.borderColor,tooltipData:e.tooltipData},s)))})})]})}const Mf=r("/_authenticated/game/play/hub/character-stats")({component:function(){const s=n(),{character:a}=Mf.useSearch(),[r,i]=e.useState(null),[o,l]=e.useState(!0),[c,d]=e.useState(!1),[m,u]=e.useState({strength:0,dexterity:0,intelligence:0,wisdom:0,vitality:0,luck:0}),h=e.useCallback((async(e=!1)=>{if(a&&""!==a.trim())try{l(!0);const t=e||!0,r=await Ah.getCharacterForGame(a,t,!0);if(r.success&&r.data){const e=r.data,t={level:e.level,xp:e.xp,xp_next_level:e.xp_next_level,gold:e.gold,hp:e.hp,max_hp:e.max_hp,mana:e.mana,max_mana:e.max_mana,atk:e.atk,magic_attack:e.magic_attack,def:e.def,speed:e.speed,strength:e.strength||10,dexterity:e.dexterity||10,intelligence:e.intelligence||10,wisdom:e.wisdom||10,vitality:e.vitality||10,luck:e.luck||10,attribute_points:e.attribute_points||0,critical_chance:e.critical_chance||0,critical_damage:e.critical_damage||130,magic_damage_bonus:e.magic_damage_bonus||0,sword_mastery:e.sword_mastery||1,axe_mastery:e.axe_mastery||1,blunt_mastery:e.blunt_mastery||1,defense_mastery:e.defense_mastery||1,magic_mastery:e.magic_mastery||1,sword_mastery_xp:e.sword_mastery_xp||0,axe_mastery_xp:e.axe_mastery_xp||0,blunt_mastery_xp:e.blunt_mastery_xp||0,defense_mastery_xp:e.defense_mastery_xp||0,magic_mastery_xp:e.magic_mastery_xp||0,base_hp:e.base_hp,base_max_hp:e.base_max_hp,base_mana:e.base_mana,base_max_mana:e.base_max_mana,base_atk:e.base_atk,base_def:e.base_def,base_speed:e.base_speed,equipment_hp_bonus:e.equipment_hp_bonus,equipment_mana_bonus:e.equipment_mana_bonus,equipment_atk_bonus:e.equipment_atk_bonus,equipment_def_bonus:e.equipment_def_bonus,equipment_speed_bonus:e.equipment_speed_bonus};i(t)}else j.error("Erro ao carregar stats do personagem",{description:r.error}),s({to:"/game/play/hub",search:{character:a}})}catch(t){j.error("Erro ao carregar stats do personagem"),s({to:"/game/play/hub",search:{character:a}})}finally{l(!1)}else s({to:"/game/play"})}),[a,s]);e.useEffect((()=>{a&&h()}),[a]);const p=Object.values(m).reduce(((e,t)=>e+t),0),x=(r?.attribute_points||0)-p,f=()=>{u({strength:0,dexterity:0,intelligence:0,wisdom:0,vitality:0,luck:0})},[g,b]=e.useState(null);e.useEffect((()=>{r&&p>0?Af.calculatePreviewImprovements(r,m).then(b).catch((e=>{b(null)})):b(null)}),[r,m,p]);const v={strength:{label:"Força",icon:Ie,color:"text-red-400",bgColor:"bg-red-500/10",borderColor:"border-red-500/20",description:"Aumenta dano físico e capacidade de carga"},dexterity:{label:"Destreza",icon:re,color:"text-green-400",bgColor:"bg-green-500/10",borderColor:"border-green-500/20",description:"Aumenta velocidade e chance de crítico"},intelligence:{label:"Inteligência",icon:ut,color:"text-purple-400",bgColor:"bg-purple-500/10",borderColor:"border-purple-500/20",description:"Aumenta dano mágico e pontos de mana"},wisdom:{label:"Sabedoria",icon:ht,color:"text-blue-400",bgColor:"bg-blue-500/10",borderColor:"border-blue-500/20",description:"Aumenta regeneração de mana e resistência"},vitality:{label:"Vitalidade",icon:ae,color:"text-pink-400",bgColor:"bg-pink-500/10",borderColor:"border-pink-500/20",description:"Aumenta pontos de vida e regeneração"},luck:{label:"Sorte",icon:pt,color:"text-yellow-400",bgColor:"bg-yellow-500/10",borderColor:"border-yellow-500/20",description:"Aumenta chance de drops raros e críticos"}};if(o)return t.jsx("div",{className:"flex items-center justify-center min-h-screen",children:t.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-purple-500"})});if(!r)return t.jsx("div",{className:"flex items-center justify-center min-h-screen",children:t.jsxs("div",{className:"text-center",children:[t.jsx("h2",{className:"text-2xl font-bold mb-2",children:"Erro ao carregar"}),t.jsx("p",{className:"text-muted-foreground mb-4",children:"Não foi possível carregar os stats do personagem"}),t.jsx(Ws,{onClick:()=>s({to:"/game/play/hub",search:{character:a}}),children:"Voltar ao Hub"})]})});return t.jsx("div",{className:"min-h-screen bg-gradient-to-b from-background to-secondary p-4 overflow-visible",children:t.jsxs("div",{className:"max-w-6xl mx-auto space-y-6",children:[t.jsx("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:t.jsxs("div",{className:"flex flex-col items-start gap-4",children:[t.jsxs(Ws,{variant:"outline",size:"sm",onClick:()=>s({to:"/game/play/hub",search:{character:a}}),className:"w-fit",children:[t.jsx(Me,{className:"h-4 w-4 mr-2"}),"Voltar ao Hub"]}),t.jsxs("div",{children:[t.jsx("h1",{className:"text-2xl sm:text-3xl font-bold",children:"Atributos & Habilidades"}),t.jsx("p",{className:"text-sm text-muted-foreground",children:"Gerencie os stats do seu personagem"})]})]})}),t.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 overflow-visible",children:[t.jsxs(fu,{children:[t.jsx(gu,{children:t.jsxs(bu,{className:"flex items-center gap-2",children:[t.jsx(Ie,{className:"h-5 w-5"}),"Atributos Primários"]})}),t.jsxs(yu,{className:"space-y-4",children:[Object.entries(v).map((([e,s])=>{const a=e,n=r[a]||0,i=s.icon;return t.jsxs(Zm.div,{className:`flex items-center gap-4 p-4 rounded-lg border ${s.bgColor} ${s.borderColor}`,whileHover:{scale:1.01},children:[t.jsxs("div",{className:"flex items-center gap-3 flex-1",children:[t.jsx(i,{className:`h-5 w-5 ${s.color}`}),t.jsxs("div",{className:"flex-1",children:[t.jsx("div",{className:"font-semibold text-sm",children:s.label}),t.jsx("div",{className:"text-xs text-muted-foreground",children:s.description})]})]}),t.jsxs("div",{className:"text-center min-w-[80px]",children:[t.jsxs("div",{className:"text-lg font-bold",children:[n,m[a]>0&&t.jsxs("span",{className:"text-green-400 ml-1 text-sm",children:["+",m[a]]})]}),t.jsxs("div",{className:"text-xs text-muted-foreground",children:[n+m[a],"/50"]})]}),r.attribute_points>0&&t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(Ws,{size:"icon",variant:"ghost",className:"h-8 w-8 rounded-full",onClick:()=>(e=>{m[e]>0&&u((t=>({...t,[e]:t[e]-1})))})(a),disabled:0===m[a],children:t.jsx(jt,{className:"h-4 w-4"})}),t.jsx("div",{className:"w-8 text-center text-sm font-mono",children:m[a]}),t.jsx(Ws,{size:"icon",variant:"ghost",className:"h-8 w-8 rounded-full",onClick:()=>(e=>{x>0&&u((t=>({...t,[e]:t[e]+1})))})(a),disabled:0===x,children:t.jsx(We,{className:"h-4 w-4"})})]})]},a)})),r.attribute_points>0&&p>0&&t.jsx(el,{children:t.jsxs(Zm.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},className:"border-t pt-4 mt-4",children:[t.jsxs("div",{className:"bg-primary/5 border border-primary/20 rounded-lg p-3 mb-4",children:[t.jsxs("div",{className:"text-sm font-medium mb-2 flex items-center gap-2",children:[t.jsx(ut,{className:"h-4 w-4 text-primary"}),"Preview dos Melhoramentos (Sistema Real)"]}),t.jsx("div",{className:"grid grid-cols-2 gap-2 text-xs",children:(()=>{if(!g)return t.jsx("div",{className:"col-span-2 text-center text-muted-foreground",children:"Calculando melhoramentos..."});const e=g;return e.hp>0||e.mana>0||e.atk>0||e.speed>0||e.critChance>0?t.jsxs(t.Fragment,{children:[e.hp>0&&t.jsxs("div",{className:"flex justify-between",children:[t.jsx("span",{children:"HP:"}),t.jsxs("span",{className:"text-green-400",children:["+",e.hp]})]}),e.mana>0&&t.jsxs("div",{className:"flex justify-between",children:[t.jsx("span",{children:"Mana:"}),t.jsxs("span",{className:"text-blue-400",children:["+",e.mana]})]}),e.atk>0&&t.jsxs("div",{className:"flex justify-between",children:[t.jsx("span",{children:"Ataque:"}),t.jsxs("span",{className:"text-red-400",children:["+",e.atk]})]}),e.speed>0&&t.jsxs("div",{className:"flex justify-between",children:[t.jsx("span",{children:"Velocidade:"}),t.jsxs("span",{className:"text-green-400",children:["+",e.speed]})]}),e.critChance>0&&t.jsxs("div",{className:"flex justify-between",children:[t.jsx("span",{children:"Crítico:"}),t.jsxs("span",{className:"text-yellow-400",children:["+",e.critChance.toFixed(1),"%"]})]})]}):t.jsx("div",{className:"col-span-2 text-center text-muted-foreground",children:"Nenhum melhoramento detectado"})})()})]}),t.jsxs("div",{className:"flex gap-2",children:[t.jsxs(Ws,{variant:"outline",onClick:f,className:"flex-1",children:[t.jsx(It,{className:"h-4 w-4 mr-2"}),"Resetar"]}),t.jsxs(Ws,{onClick:async()=>{if(0!==p&&a){d(!0);try{const e=await Ah.distributeAttributePoints(a,m);e.success?(j.success("Pontos distribuídos com sucesso!"),f(),i(null),await h(!0)):j.error("Erro ao distribuir pontos",{description:e.error})}catch(e){j.error("Erro ao distribuir pontos")}finally{d(!1)}}},disabled:c,className:"flex-1 bg-emerald-500 hover:bg-emerald-600",children:[c?t.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-2 border-white border-t-transparent mr-2"}):t.jsx(Ft,{className:"h-4 w-4 mr-2"}),"Confirmar"]})]})]})})]})]}),t.jsx(Pf,{characterStats:r},`${r.strength}-${r.dexterity}-${r.intelligence}-${r.wisdom}-${r.vitality}-${r.luck}-${r.attribute_points}`),t.jsxs(fu,{className:"lg:col-span-2",children:[t.jsx(gu,{children:t.jsxs(bu,{className:"flex items-center gap-2",children:[t.jsx(ut,{className:"h-5 w-5"}),"Habilidades de Combate"]})}),t.jsx(yu,{children:t.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:Object.values(hh).map((e=>{const s=(e=>{switch(e){case hh.SWORD_MASTERY:return se;case hh.AXE_MASTERY:return re;case hh.BLUNT_MASTERY:return ft;case hh.DEFENSE_MASTERY:return De;case hh.MAGIC_MASTERY:return ut}})(e),a=r[`${e}_mastery`],n=r[`${e}_mastery_xp`],i=(o=a,Math.floor(50*Math.pow(1.4,o-1)));var o;const l=n/i*100;return t.jsxs("div",{className:"bg-card p-4 rounded-lg border",children:[t.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[t.jsx(s,{className:"h-5 w-5 text-primary"}),t.jsxs("div",{className:"flex-1",children:[t.jsx("h3",{className:"font-semibold capitalize",children:e.replace("_"," ")}),t.jsxs("div",{className:"text-sm text-muted-foreground",children:["Nível ",a]})]})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsxs("div",{className:"flex justify-between text-sm",children:[t.jsxs("span",{children:["XP: ",n,"/",i]}),t.jsxs("span",{children:[Math.round(l),"%"]})]}),t.jsx(Zh,{value:l,className:"h-2"})]}),t.jsx("p",{className:"text-xs text-muted-foreground mt-2",children:ph(e)})]},e)}))})})]})]})]})})},validateSearch:e=>{const t=e.character;return t&&"string"==typeof t&&""!==t.trim()?{character:t.trim()}:{character:""}}});class Tf{static calculateAttackSkillXp(e,t){const s=[];if(!e)return s;const a=(r=e,"weapon"===r.main_hand?.type?r.main_hand:void 0);var r;const n=function(e){return!("weapon"!==e.main_hand?.type||"weapon"!==e.off_hand?.type)}(e),i=Math.max(1,Math.floor(t/10));if(a){const e=this.getWeaponSkill(a);if(e){let t=i;n?(t=Math.floor(1.25*t),s.push({skill:e,xp:t,reason:`Ataque com ${a.name} (Dual-wield)`,isOffHand:!1})):s.push({skill:e,xp:t,reason:`Ataque com ${a.name}`,isOffHand:!1})}}if(n&&e.off_hand){const t=this.getWeaponSkill(e.off_hand);if(t){const a=Math.floor(.75*i);s.push({skill:t,xp:a,reason:`Ataque com ${e.off_hand.name} (Mão secundária)`,isOffHand:!0})}}return s}static calculateDefenseSkillXp(e,t=0){let s=Math.max(2,Math.floor(t/5)),a="Ação de defesa";var r;t<=0&&(s=3),e&&(r=e,"armor"===r.off_hand?.type&&!r.off_hand?.weapon_subtype)&&(s=Math.floor(2.5*s),a="Defesa com escudo equipado");const n=Math.max(1,Math.floor(s));return[{skill:hh.DEFENSE_MASTERY,xp:n,reason:a,isOffHand:!1}]}static calculateMagicSkillXp(e,t=0,s=0,a=null){const r=[],n=Math.floor(e/2);let i=0;s>0?i=Math.floor(s/8):t>0&&(i=Math.floor(t/8));const o=Math.max(2,n+i);if(r.push({skill:hh.MAGIC_MASTERY,xp:o,reason:`Uso de magia (${e} mana, ${s||t} efeito)`,isOffHand:!1}),"staff"===a?.off_hand?.weapon_subtype){const e=Math.max(1,Math.floor(.2*o));r.push({skill:hh.MAGIC_MASTERY,xp:e,reason:`Bônus por ${a.off_hand.name} (off-hand)`,isOffHand:!0})}return r}static getWeaponSkill(e){const t=e.name.toLowerCase(),s=[{keywords:["espada","sword","rapier","lâmina","adaga","dagger","punhal","fang"],skill:hh.SWORD_MASTERY},{keywords:["machado","axe","machadinha"],skill:hh.AXE_MASTERY},{keywords:["martelo","mace","clava","maça","porrete","hammer"],skill:hh.BLUNT_MASTERY},{keywords:["cajado","staff","varinha","orbe","bastão","cetro"],skill:hh.MAGIC_MASTERY}];for(const{keywords:a,skill:r}of s)if(a.some((e=>t.includes(e))))return r;return hh.SWORD_MASTERY}static async applySkillXp(e,t){const s=[],a=[];if(0===t.length)return{messages:s,skillLevelUps:a};const{gameState:r,updateGameState:n}=xx.getState(),{setSelectedCharacter:i}=wx.getState();for(const l of t)try{const t=await Ah.addSkillXp(e,l.skill,l.xp);if(t.success&&t.data){const c=this.getSkillDisplayName(l.skill),d=l.isOffHand?" (off-hand)":"";if(t.data.skill_leveled_up){const e=`🎉 ${c} subiu para nível ${t.data.new_skill_level}!${d}`;s.push(e),a.push({skill:l.skill,newLevel:t.data.new_skill_level})}else{const e=`+${l.xp} XP em ${c}${d}`;s.push(e)}if(r.player?.id===e){n((e=>{if(e.player&&t.data){const s=this.getSkillKey(l.skill);if(s&&s in e.player){e.player[s]=t.data.new_skill_level;const a=`${s}_xp`;a in e.player&&(e.player[a]=t.data.new_skill_xp)}}}));try{const t=await Ah.getCharacter(e);t.success&&t.data&&i(t.data)}catch(o){}}}}catch(o){}return{messages:s,skillLevelUps:a}}static getSkillKey(e){return{[hh.SWORD_MASTERY]:"sword_mastery",[hh.AXE_MASTERY]:"axe_mastery",[hh.BLUNT_MASTERY]:"blunt_mastery",[hh.DEFENSE_MASTERY]:"defense_mastery",[hh.MAGIC_MASTERY]:"magic_mastery"}[e]||null}static getSkillDisplayName(e){return{[hh.SWORD_MASTERY]:"Maestria em Espadas",[hh.AXE_MASTERY]:"Maestria em Machados",[hh.BLUNT_MASTERY]:"Maestria em Armas de Concussão",[hh.DEFENSE_MASTERY]:"Maestria em Defesa",[hh.MAGIC_MASTERY]:"Maestria em Magia"}[e]||e}static calculateSkillDamageBonus(e){return Math.min(100,2*e)}static calculateSkillDefenseBonus(e){return Math.min(50,1*e)}static calculateManaEfficiency(e){return Math.min(40,1*e)}static async applySkillXpToCurrentPlayer(e){const{gameState:t}=xx.getState();if(!t.player?.id)return[];return(await this.applySkillXp(t.player.id,e)).messages}static getCurrentPlayerSkillLevels(){const{gameState:e}=xx.getState(),t=e.player;return t?{[hh.SWORD_MASTERY]:t.sword_mastery||1,[hh.AXE_MASTERY]:t.axe_mastery||1,[hh.BLUNT_MASTERY]:t.blunt_mastery||1,[hh.DEFENSE_MASTERY]:t.defense_mastery||1,[hh.MAGIC_MASTERY]:t.magic_mastery||1}:{[hh.SWORD_MASTERY]:1,[hh.AXE_MASTERY]:1,[hh.BLUNT_MASTERY]:1,[hh.DEFENSE_MASTERY]:1,[hh.MAGIC_MASTERY]:1}}}const qf=Object.freeze(Object.defineProperty({__proto__:null,SkillXpService:Tf},Symbol.toStringTag,{value:"Module"})),Df=xp()(jp(((e,t)=>({monsterCache:{},loading:{fetchingMonster:!1,loadingDrops:!1},error:null,cacheDuration:3e4,cacheMonster:(t,s)=>{e(hx((e=>{const a=Date.now();e.monsterCache[t]={enemy:{...s,active_effects:s.active_effects||{buffs:[],debuffs:[],dots:[],hots:[],attribute_modifications:[]}},expiry:a+e.cacheDuration}})))},getCachedMonster:s=>{const a=t().monsterCache[s];if(!a)return null;return Date.now()>=a.expiry?(e(hx((e=>{delete e.monsterCache[s]}))),null):a.enemy},clearCache:()=>{e(hx((e=>{e.monsterCache={}})))},setFetchingMonster:t=>{e(hx((e=>{e.loading.fetchingMonster=t})))},setLoadingDrops:t=>{e(hx((e=>{e.loading.loadingDrops=t})))},setError:t=>{e(hx((e=>{e.error=t}))),t&&j.error("Erro ao carregar monstro",{description:t})},setCacheDuration:t=>{e(hx((e=>{e.cacheDuration=t})))}}))));function Rf(e,t,s,a="normal"){let r,n,i;switch(1===t?(r=1,n=1+.015*s):(r=Math.pow(1.3,Math.max(0,t-1)),n=1+.025*s),a){case"hp":i=e*r*n*1.1;break;case"attack":default:i=e*r*n;break;case"defense":i=e*r*n*.9}return Math.max(1,Math.floor(i))}function Lf(e){const t=Math.max(1,Math.floor(e/20)+1),s=e-20*(t-1),a=Math.max(1,Math.floor(e/3)),r=[5,10,15,20].includes(e)||e>20&&e%10==0,n=function(e,t){let s,a,r,n,i;if(e<=3)1===e?(s=45,a=8,r=2):2===e?(s=55,a=10,r=3):(s=65,a=12,r=4),n=12+2*e,i=18+4*e+Math.floor(8*Math.random());else if(e<=10){const t=e-3;s=75+10*t,a=14+2*t,r=5+t,e<=5?(n=16+3*e,i=25+6*e+Math.floor(12*Math.random())):(n=20+4*e,i=35+8*e+Math.floor(16*Math.random()))}else e<=20?(s=140+15*(e-10),a=28+3*(e-10),r=12+2*(e-10),e<=15?(n=30+6*e,i=50+12*e+Math.floor(20*Math.random())):(n=50+8*e,i=80+15*e+Math.floor(25*Math.random()))):(s=300+25*(e-20),a=60+5*(e-20),r=35+3*(e-20),n=80+12*e,i=120+20*e+Math.floor(30*Math.random()));return t&&(s=Math.floor(1.5*s),a=Math.floor(1.4*a),r=Math.floor(1.3*r),n=Math.floor(2.2*n),i=Math.floor(1.8*i)),{hp:s,atk:a,def:r,rewardXp:n,rewardGold:i}}(e,r),i=function(e,t){if(5===t||t%10==0||Math.random()>.15)return{isNemesis:!1};const s=[{name:"Berserker",description:"Ataque devastador, mas defesa baixa",modifiers:{hp:.8,atk:2.5,def:.4,rewardXp:1.8,rewardGold:1.5}},{name:"Fortress",description:"Defesa impenetrável, mas ataque baixo",modifiers:{hp:2,atk:.6,def:3,rewardXp:1.6,rewardGold:1.3}},{name:"Specter",description:"Muito HP, ataque e defesa normais",modifiers:{hp:3.5,atk:1,def:1,rewardXp:2.2,rewardGold:1.8}},{name:"Assassin",description:"Balanceado mas com stats altos",modifiers:{hp:1.8,atk:1.8,def:1.8,rewardXp:2,rewardGold:1.6}}],a=s[Math.floor(Math.random()*s.length)],r={hp:Math.floor(e.hp*a.modifiers.hp),atk:Math.floor(e.atk*a.modifiers.atk),def:Math.floor(e.def*a.modifiers.def),rewardXp:Math.floor(e.rewardXp*a.modifiers.rewardXp),rewardGold:Math.floor(e.rewardGold*a.modifiers.rewardGold)};return{isNemesis:!0,nemesisType:a.name,modifiedStats:r}}(n,e),o=i.modifiedStats||n,l=i.isNemesis,c=i.nemesisType,d=Rf(o.hp,t,s,"hp"),m=Rf(o.atk,t,s,"attack"),u=Rf(o.def,t,s,"defense"),h=Rf(8+a+t,t,s),p=["Slime","Goblin","Orc","Skeleton","Wolf","Spider","Troll","Dragon"],x=["","Greater","Elder","Ancient","Legendary","Mythic","Cosmic","Void"],f=p[Math.floor(s/3)%p.length];let g=f;t>1&&(g=`${t>1&&t<=x.length?x[t-1]:`T${t}`} ${f}`),r?g=`Boss ${g}`:l&&(g=`${c} ${g}`);const b=8+2*t+Math.floor(s/5),v=Math.floor(Rf(b,t,s)*(r?1.2:1)),y=Math.floor(Rf(.7*b,t,s)*(l?1.2:1)),j=Math.floor(Rf(.5*b,t,s)),N=Math.floor(Rf(.5*b,t,s)),w=Math.floor(Rf(b,t,s)*(r?1.3:1.1)),_=Math.floor(Rf(.4*b,t,s)),C=Math.min(.25,.02+.01*t+.003*s),S=Math.min(1.8,1.1+.05*t+.01*s),E=Math.min(.2,.01*t+(r?.08:.03));return{id:crypto.randomUUID(),name:g,level:a,hp:d,maxHp:d,attack:m,defense:u,speed:h,image:r?"👑":l?"💀":"👾",behavior:l?"aggressive":r?"defensive":"balanced",mana:Math.floor((20+4*a+5*t)*(1+.03*s)),reward_xp:o.rewardXp,reward_gold:o.rewardGold,possible_drops:[],active_effects:{buffs:[],debuffs:[],dots:[],hots:[],attribute_modifications:[]},tier:t,base_tier:Math.max(1,Math.floor(e/20)+1),cycle_position:s,is_boss:r,strength:v,dexterity:y,intelligence:j,wisdom:N,vitality:w,luck:_,critical_chance:C,critical_damage:S,critical_resistance:E,physical_resistance:Math.min(.25,.015*t+(r?.05:.02)),magical_resistance:Math.min(.25,.015*t+(l?.05:.02)),debuff_resistance:Math.min(.4,.025*t+(r?.15:.05)),physical_vulnerability:Math.max(.8,1-.01*t),magical_vulnerability:Math.max(.8,1-.01*t),primary_trait:r?"boss":l?"nemesis":t>3?"veteran":"common",secondary_trait:l?c?.toLowerCase():t>5?"ancient":t>2?"experienced":"basic",special_abilities:[...r?["Powerful Strike","Boss Aura"]:[],...l?[`${c} Mastery`]:[],...t>3?["Tier Mastery"]:[],...t>6?["Ancient Power"]:[]]}}class $f{static async getEnemyForFloor(e,t=!1){if(e<=0)return{data:null,error:`Andar inválido: ${e}`,success:!1};const{getCachedMonster:s,cacheMonster:a,setFetchingMonster:r,setError:n}=Df.getState(),{updateGameState:i}=xx.getState();if(!t){const t=s(e);if(t)return i((e=>{e.currentEnemy=t})),{data:t,error:null,success:!0}}r(!0),n(null);try{let{data:t,error:s}=await Promise.race([Es.rpc("get_monster_for_floor_with_initiative",{p_floor:e}),new Promise(((e,t)=>setTimeout((()=>t({data:null,error:{message:"Timeout na RPC principal"}})),3e3)))]).catch((e=>({data:null,error:e})));if("42804"===s?.code||s?.message?.includes("does not match function result type")||s?.message?.includes("structure of query does not match")||s){const a=await Promise.race([Es.rpc("get_monster_for_floor_simple",{p_floor:e}),new Promise(((e,t)=>setTimeout((()=>t({data:null,error:{message:"Timeout alternativo"}})),2e3)))]).catch((e=>({data:null,error:e})));a.data&&!a.error&&(t=a.data,s=a.error)}let n;if(!t||s)throw new Error(`Falha ao carregar monstro para andar ${e}: ${s?.message||"Erro desconhecido"}`);{const s=Array.isArray(t)?t[0]:t;if(!this.isValidMonsterData(s))throw new Error(`Dados do banco inválidos para andar ${e}. Verifique a migração 00005.`);n=this.convertToEnemyUnified(s,e)}try{await this.loadPossibleDrops(n)}catch(o){}return a(e,n),i((e=>{e.currentEnemy=n})),r(!1),{data:n,error:null,success:!0}}catch(l){r(!1);const e=l instanceof Error?l.message:"Erro desconhecido ao carregar monstro";return n(e),{data:null,error:e,success:!1}}}static isValidMonsterData(e){if(!e||"object"!=typeof e)return!1;const t=["hp","atk","def","min_floor"];for(const s of t){const t=e[s];if("number"!=typeof t||t<=0)return!1}return!(!e.name||"string"!=typeof e.name)}static convertToEnemyUnified(e,t){const s=Math.max(1,Math.floor(t/20)+1),a=(t-1)%20+1,r=5===t||t%10==0,n="string"==typeof e.id?e.id:crypto.randomUUID(),i="string"==typeof e.name?e.name:`Monster Floor ${t}`,o="number"==typeof e.min_floor?e.min_floor:1,l=Math.max(1,Math.floor(o/3)),c="number"==typeof e.hp&&e.hp>0?e.hp:Lf(t).hp,d="number"==typeof e.atk&&e.atk>0?e.atk:Lf(t).attack,m="number"==typeof e.def&&e.def>=0?e.def:Lf(t).defense,u="number"==typeof e.speed&&e.speed>0?e.speed:Lf(t).speed,h="number"==typeof e.reward_xp?e.reward_xp:50,p="number"==typeof e.reward_gold?e.reward_gold:25,x=Math.floor(h*(t<=10?.4:.3)),f=Math.floor(p*(t<=10?.4:.3));var g;return{id:n,name:i,level:l,hp:c,maxHp:c,attack:d,defense:m,speed:u,image:r?"👑":"👾",behavior:"string"==typeof e.behavior&&(g=e.behavior,["aggressive","defensive","balanced"].includes(g))?e.behavior:"balanced",mana:"number"==typeof e.mana?e.mana:Math.floor(5*l),reward_xp:x,reward_gold:f,possible_drops:[],active_effects:{buffs:[],debuffs:[],dots:[],hots:[],attribute_modifications:[]},tier:s,base_tier:Math.max(1,Math.floor(t/20)+1),cycle_position:a,is_boss:r,strength:"number"==typeof e.strength?e.strength:10+l,dexterity:"number"==typeof e.dexterity?e.dexterity:8+l,intelligence:"number"==typeof e.intelligence?e.intelligence:6+l,wisdom:"number"==typeof e.wisdom?e.wisdom:6+l,vitality:"number"==typeof e.vitality?e.vitality:12+l,luck:"number"==typeof e.luck?e.luck:5+l,critical_chance:"number"==typeof e.critical_chance?Math.min(.5,e.critical_chance):.05+.005*l,critical_damage:"number"==typeof e.critical_damage?e.critical_damage:1.5+.05*l,critical_resistance:"number"==typeof e.critical_resistance?Math.min(.5,e.critical_resistance):.1,physical_resistance:"number"==typeof e.physical_resistance?Math.max(0,Math.min(.9,e.physical_resistance)):0,magical_resistance:"number"==typeof e.magical_resistance?Math.max(0,Math.min(.9,e.magical_resistance)):0,debuff_resistance:"number"==typeof e.debuff_resistance?Math.max(0,Math.min(.9,e.debuff_resistance)):0,physical_vulnerability:"number"==typeof e.physical_vulnerability?Math.max(.5,Math.min(3,e.physical_vulnerability)):1,magical_vulnerability:"number"==typeof e.magical_vulnerability?Math.max(.5,Math.min(3,e.magical_vulnerability)):1,primary_trait:"string"==typeof e.primary_trait?e.primary_trait:r?"boss":"common",secondary_trait:"string"==typeof e.secondary_trait?e.secondary_trait:"basic",special_abilities:Array.isArray(e.special_abilities)?e.special_abilities.filter((e=>"string"==typeof e)):[]}}static async loadPossibleDrops(e){const{setLoadingDrops:t,setError:s}=Df.getState();e.possible_drops||(e.possible_drops=[]),t(!0);try{const{data:t,error:a}=await Es.rpc("get_monster_possible_drops_with_info",{p_monster_id:e.id});if(a)return void s(`Drops não carregados: ${a.message}`);t&&Array.isArray(t)&&t.length>0&&(e.possible_drops=t.map((e=>({drop_id:e.drop_id,drop_chance:e.drop_chance,min_quantity:e.min_quantity,max_quantity:e.max_quantity,drop_info:{id:e.drop_id,name:e.drop_name,description:e.drop_description,rarity:e.rarity,value:e.value}}))))}catch(a){s(`Drops não carregados: ${a instanceof Error?a.message:"Erro ao carregar drops"}`)}finally{t(!1)}}static updateCurrentEnemy(e){const{updateGameState:t}=xx.getState();t((t=>{t.currentEnemy=e}))}static getCurrentEnemy(){return xx.getState().gameState.currentEnemy}static clearCache(){const{clearCache:e}=Df.getState();e()}static isEnemyCached(e){const{getCachedMonster:t}=Df.getState();return null!==t(e)}static async preloadNearbyFloors(e,t=2){const s=[];for(let a=e+1;a<=e+t;a++)this.isEnemyCached(a)||s.push(this.getEnemyForFloor(a));s.length>0&&await Promise.allSettled(s)}}const If=Object.freeze(Object.defineProperty({__proto__:null,MonsterService:$f},Symbol.toStringTag,{value:"Module"}));class Ff{static validateNumber(e,t=0,s,a){let r=Number(e);return!isNaN(r)&&isFinite(r)&&null!=e||(r=t),void 0!==s&&(r=Math.max(s,r)),void 0!==a&&(r=Math.min(a,r)),Math.floor(r)}static validateHP(e,t){const s=this.validateNumber(t,1,1);return this.validateNumber(e,1,0,s)}static validateMana(e,t){const s=this.validateNumber(t,1,0);return this.validateNumber(e,0,0,s)}static validateAttack(e){return this.validateNumber(e,1,1)}static validateDefense(e){return this.validateNumber(e,0,0)}static validateSpeed(e){return this.validateNumber(e,1,1)}static validatePlayerStats(e){return{...e,hp:this.validateHP(e.hp,e.max_hp),max_hp:this.validateNumber(e.max_hp,1,1),mana:this.validateMana(e.mana,e.max_mana),max_mana:this.validateNumber(e.max_mana,1,0),atk:this.validateAttack(e.atk),def:this.validateDefense(e.def),speed:this.validateSpeed(e.speed),level:this.validateNumber(e.level,1,1),xp:this.validateNumber(e.xp,0,0),gold:this.validateNumber(e.gold,0,0),floor:this.validateNumber(e.floor,1,1)}}static validateEnemyStats(e){return{...e,hp:this.validateHP(e.hp,e.maxHp),maxHp:this.validateNumber(e.maxHp,1,1),attack:this.validateAttack(e.attack),defense:this.validateDefense(e.defense),speed:this.validateSpeed(e.speed),level:this.validateNumber(e.level,1,1),mana:this.validateNumber(e.mana,0,0),reward_xp:this.validateNumber(e.reward_xp,1,0),reward_gold:this.validateNumber(e.reward_gold,0,0)}}static logValidation(e,t,s){Number(t)!==s||isNaN(Number(t))}}class Vf{static logs=[];static MAX_LOGS=100;static currentBattleId=null;static startBattle(e,t){this.currentBattleId&&this.endBattle("error",{reason:"Batalha interrompida por nova inicialização"}),this.clearOldLogs();const s=`battle_${e}_${t}_${Date.now()}`;return this.currentBattleId=s,this.log("info","BattleLogger","=== NOVA BATALHA INICIADA ===",{battleId:s,playerId:e,floorNumber:t,timestamp:(new Date).toISOString()}),s}static endBattle(e,t){this.currentBattleId&&(this.log("info","BattleLogger",`=== BATALHA FINALIZADA: ${e.toUpperCase()} ===`,{battleId:this.currentBattleId,result:e,details:t,timestamp:(new Date).toISOString()}),this.currentBattleId=null)}static log(e,t,s,a){const r={timestamp:Date.now(),battleId:this.currentBattleId,service:t,level:e,message:s,data:a};this.logs.push(r),this.logs.length>this.MAX_LOGS&&this.logs.shift();const n=`${this.currentBattleId?`[${this.currentBattleId}]`:""}[${t}] ${s}`;({debug:console.debug,info:console.log,warn:console.warn,error:console.error})[e](n,a)}static logPlayerAction(e,t){this.log("info","PlayerAction",`Jogador executou: ${e}`,t)}static logEnemyAction(e,t){this.log("info","EnemyAction",`Inimigo executou: ${e}`,t)}static logDamage(e,t,s,a,r){this.log("info","Damage",`${e} causou ${s} de dano ${a} em ${t}`,{source:e,target:t,damage:s,type:a,...r})}static logStateChange(e,t,s){this.log("info","StateChange",`Estado mudou de ${e} para ${t}`,s)}static logError(e,t,s){this.log("error",e,`Erro: ${t instanceof Error?t.message:t}`,{error:t instanceof Error?t.stack:t,context:s})}static logPerformance(e,t,s,a){this.log("debug","Performance",`${e}.${t} levou ${s}ms`,a)}static getCurrentBattleLogs(){return this.currentBattleId?this.logs.filter((e=>e.battleId===this.currentBattleId)):[]}static getAllLogs(){return[...this.logs]}static getLogStats(){const e=this.getCurrentBattleLogs();return{totalLogs:this.logs.length,currentBattleLogs:e.length,errorCount:this.logs.filter((e=>"error"===e.level)).length,warnCount:this.logs.filter((e=>"warn"===e.level)).length,currentBattleId:this.currentBattleId}}static exportCurrentBattleLogs(){const e=this.getCurrentBattleLogs();return JSON.stringify(e,null,2)}static clearOldLogs(){this.currentBattleId?this.logs=this.logs.filter((e=>e.battleId===this.currentBattleId)):this.logs=[],this.log("info","BattleLogger","Logs antigos foram limpos")}}const Of=Object.freeze(Object.defineProperty({__proto__:null,BattleLoggerService:Vf},Symbol.toStringTag,{value:"Module"}));class Bf{static async processPlayerActionFromStores(e,t,s){const a=Wf.getState();try{if(a.setProcessingAction(!0),a.isProcessingAction)return!1;const r=await this.processPlayerAction(e,void 0,t,s);return Vf.log("info","BattleService",`Ação processada via stores: ${e}`,{success:!0,skipTurn:r.skipTurn}),!0}catch(r){return Vf.logError("BattleService",r,{action:e,spellId:t,consumableId:s}),!1}finally{a.setProcessingAction(!1)}}static calculateInitiative(e,t){const s=e,a=Math.floor(.5*t),r=.9+.2*Math.random(),n=Math.floor((s+a)*r);return Math.max(1,n)}static calculateExtraTurns(e,t){if(t<=0)return 2;const s=e/t;let a=0;return s>=3.5?a=3:s>=2.5?a=2:s>=1.8&&(a=1),a<3&&Math.random()<.2&&(a+=1),Math.min(a,3)}static calculateDamage(e,t,s=10,a=10){const r=yh.calculateEffectiveStats(e),n=yh.calculateEffectiveStats(t),i=r.atk||0,o=n.def||0,l=r.critical_chance||0,c=r.critical_damage||110;if(i<=0)return{damage:1,isCritical:!1,isDoubleAttack:!1,totalAttacks:1,damageBreakdown:"Dano mínimo: 1"};const d=Math.max(1,Math.floor(i-.5*o)),m=100*Math.random()<l,u=(("double_attack_chance"in e?e.double_attack_chance:0)||0)+Math.floor(.5*(s-10))+Math.floor(.3*(a-10)),h=100*Math.random()<Math.min(35,u);let p=d,x=`Base: ${d}`;if(m){const e=c/100;p=Math.floor(p*e),x+=` → Crítico (${c}%): ${p}`}let f=1;return h&&(p*=2,f=2,x+=` → Duplo Ataque (DEX: ${s}, SPD: ${a}): ${p}`),{damage:p,isCritical:m,isDoubleAttack:h,totalAttacks:f,damageBreakdown:x}}static async processPlayerAction(e,t,s,a){const r=xx.getState(),n=jx.getState(),i=t||r.gameState;Vf.logPlayerAction(e,{spellId:s,consumableId:a});const o={...i,player:{...i.player},currentEnemy:i.currentEnemy?{...i.currentEnemy}:null},l=[],c=[];let d=!1,m="",u=0;if(o.player.active_effects){const e=Ch.processOverTimeEffects(o.player);e.length>0&&l.push(...e.map((e=>({message:e,type:"system"}))))}if(o.currentEnemy?.active_effects){const e=Ch.processOverTimeEffects(o.currentEnemy);e.length>0&&l.push(...e.map((e=>({message:e,type:"system"}))))}switch(e){case"attack":if(o.currentEnemy&&o.currentEnemy.hp>0){const e=await this.getPlayerEquipmentSlots(o.player.id),t=this.calculateDamage(o.player,o.currentEnemy,o.player.dexterity||10,o.player.speed||10);u=t.damage;const s=t.isCritical,a=t.isDoubleAttack,r=t.totalAttacks;o.currentEnemy.hp=Math.max(0,o.currentEnemy.hp-u),o.player.isDefending&&(o.player.isDefending=!1),d=!1;let n=`${o.player.name} atacou ${o.currentEnemy.name}`;if(a&&(n+=` com duplo ataque (${r}x)`),s&&(n+=" causando dano crítico"),n+=` causando ${u} de dano!`,l.push({message:n,type:"player_action"}),a&&s?l.push({message:`💥 Duplo ataque crítico! ${u} de dano total!`,type:"damage"}):a?l.push({message:`⚔️ Duplo ataque! ${u} de dano total!`,type:"damage"}):s?l.push({message:`💥 Ataque crítico! ${u} de dano!`,type:"damage"}):l.push({message:`⚔️ ${u} de dano causado`,type:"damage"}),e){const t=Tf.calculateAttackSkillXp(e,u);if(t.length>0){c.push(...t);for(const e of t){const t=Tf.getSkillDisplayName(e.skill);l.push({message:`+${e.xp} XP em ${t}${e.isOffHand?" (off-hand)":""}`,type:"skill_xp"})}}}if(o.currentEnemy.hp<=0)l.push({message:`${o.currentEnemy.name} foi derrotado!`,type:"system"}),m=`Você derrotou ${o.currentEnemy.name}!`;else{let e="";a&&(e+="duplo "),s&&(e+="crítico "),m=`Ataque ${e}realizado com sucesso!`}}break;case"defend":if(0===o.player.defenseCooldown){o.player.isDefending=!0,o.player.defenseCooldown=3,d=!1;const e=`${o.player.name} assumiu postura defensiva.`;l.push({message:e,type:"player_action"});const t=await this.getPlayerEquipmentSlots(o.player.id);if(t){const e=Tf.calculateDefenseSkillXp(t,0);if(e.length>0){c.push(...e);for(const t of e){const e=Tf.getSkillDisplayName(t.skill);l.push({message:`+${t.xp} XP em ${e}`,type:"skill_xp"})}}}m=e}else{const e=`Defesa está em cooldown por mais ${o.player.defenseCooldown} turnos.`;l.push({message:e,type:"system"}),m=e,d=!0}break;case"spell":if(s){const e=o.player.spells.find((e=>e.id===s));if(e&&o.player.mana>=e.mana_cost&&0===e.current_cooldown){o.player.mana=Math.max(0,o.player.mana-e.mana_cost),o.player.spells=o.player.spells.map((e=>e.id===s?{...e,current_cooldown:e.cooldown}:{...e}));let t="";const a=0,r="damage"===e.effect_type?o.currentEnemy:o.player;if(r){const s=Ch.applySpellEffect(e,o.player,r);if(s.success){d=s.endsTurn,t=s.message,m=t,l.push({message:`${o.player.name} lançou ${e.name}`,type:"player_action"}),l.push({message:t,type:"damage"===e.effect_type?"damage":"system"});const r=await this.getPlayerEquipmentSlots(o.player.id),n=Tf.calculateMagicSkillXp(e.mana_cost,"damage"===e.effect_type?e.effect_value:0,a,r);if(n.length>0){c.push(...n);for(const e of n){const t=Tf.getSkillDisplayName(e.skill);l.push({message:`+${e.xp} XP em ${t}${e.isOffHand?" (off-hand)":""}`,type:"skill_xp"})}}}else t="A magia falhou!",m=t,d=!1,l.push({message:`${o.player.name} tentou lançar ${e.name}, mas a magia falhou!`,type:"system"})}}else e?o.player.mana<e.mana_cost?m=`Mana insuficiente! Necessário: ${e.mana_cost}, Atual: ${o.player.mana}`:e.current_cooldown>0&&(m=`${e.name} está em recarga por mais ${e.current_cooldown} turnos.`):m="Magia não encontrada!",l.push({message:m,type:"system"}),d=!0}break;case"flee":return this.processFleeResult(t||r.gameState);case"consumable":if(a)try{if(a.startsWith("slot_")){const e=parseInt(a.replace("slot_","")),t=await hf.consumePotionFromSlot(o.player.id,e);t.success&&t.data?(o.player={...o.player,hp:Math.floor(Number(t.data.new_hp)||o.player.hp),mana:Math.floor(Number(t.data.new_mana)||o.player.mana)},m=t.data.message,d=!1):(m=t.error||"Erro ao usar poção do slot.",d=!0)}else{const e={...o.player},t=await Yx.consumeItem(o.player.id,a,e);t.success&&t.data?(o.player={...o.player,hp:Math.floor(Number(e.hp)||o.player.hp),mana:Math.floor(Number(e.mana)||o.player.mana),atk:Math.floor(Number(e.atk)||o.player.atk),def:Math.floor(Number(e.def)||o.player.def)},m=t.data.message,d=!1):(m=t.error||"Erro ao usar item consumível.",d=!0)}}catch(h){m="Erro ao usar item consumível.",d=!0}else m="Item consumível não especificado.",d=!0;break;case"continue":try{const e=await Xf.advanceToNextFloor(o);Object.assign(o,e),m=e.gameMessage||"Avançando para o próximo andar...",d=!1}catch(h){m="Erro ao avançar para o próximo andar",d=!0}break;default:m="Ação não reconhecida.",d=!0}return o.player.defenseCooldown>0&&o.player.defenseCooldown--,"consumable"!==e&&(o.player.potionUsedThisTurn=!1),o.player=Ff.validatePlayerStats(o.player),o.currentEnemy&&(o.currentEnemy=Ff.validateEnemyStats(o.currentEnemy)),t||(r.setGameState(o),l.forEach((e=>{n.addGameLogMessage(e.message,e.type)}))),Vf.log("info","BattleService",`Ação processada: ${e}, skipTurn: ${d}`,{playerHp:o.player.hp,playerMana:o.player.mana,skillXpGains:c.length}),{newState:o,skipTurn:d,message:m,skillXpGains:c,skillMessages:[],gameLogMessages:l}}static async processFleeResult(e){const t=await this.processFleeAttempt(e);return{newState:t,skipTurn:t.fleeSuccessful||!1,message:t.gameMessage||"Tentativa de fuga processada",skillXpGains:[],skillMessages:[],gameLogMessages:[]}}static async getPlayerEquipmentSlots(e){try{return await _h.getEquippedItems(e)}catch(t){return null}}static async processPlayerDeath(e,t,s,a){try{const r=await Kf.killCharacter(t.id,"Battle defeat",s.name),n={...t,hp:0,isDefending:!1};return r.success?{...e,player:n,mode:"gameover",isPlayerTurn:!0,gameMessage:`${a} Você foi derrotado! Seu personagem foi perdido permanentemente.`,characterDeleted:!0}:{...e,player:n,mode:"gameover",isPlayerTurn:!0,gameMessage:`${a} Você foi derrotado!`}}catch(r){return{...e,player:{...t,hp:0,isDefending:!1},mode:"gameover",isPlayerTurn:!0,gameMessage:`${a} Você foi derrotado!`}}}static async processFleeAttempt(e){const{player:t,currentEnemy:s}=e;if(!s)return e;const a=(t.speed||10)-(s.speed||10);let r=70+Math.floor(2*a);r=Math.max(15,Math.min(95,r));if(100*Math.random()<r)return Vf.endBattle("flee",{reason:"Fuga bem-sucedida pelo sistema",playerName:t.name}),{...e,fleeSuccessful:!0,currentEnemy:null,mode:"fled",battleRewards:null,isPlayerTurn:!0,gameMessage:`${t.name} fugiu da batalha com sucesso!`};{const a=Math.floor(.3*(s.attack||10)),r=Math.max(0,t.hp-a);return r<=0?this.processPlayerDeath(e,t,s,`${t.name} tentou fugir mas falhou!`):{...e,player:{...t,hp:r},fleeSuccessful:!1,gameMessage:`${t.name} tentou fugir mas falhou! Sofreu ${a} de dano.`}}}static async processEnemyAction(e,t){if(!e.currentEnemy||e.currentEnemy.hp<=0)return{newState:{...e,isPlayerTurn:!0}};const s={...e.currentEnemy},a={...e.player},r=[];if(s.hp<=0)return{newState:{...e,isPlayerTurn:!0,gameMessage:`${s.name} foi derrotado por efeitos ao longo do tempo!`}};let n="attack";const i=s.special_abilities&&s.special_abilities.length>0,o=(s.intelligence||10)>(s.strength||10);let l=.15,c=.2;switch(s.behavior){case"aggressive":l=.25,c=.1;break;case"defensive":l=.3,c=.15;break;case"balanced":o?(c=.35,l=.2):(c=.2,l=.2)}i&&(l+=.1),i&&Math.random()<l?n="special":s.mana>=10&&Math.random()<c&&(n="spell");let d="",m=0,u=0;switch(n){case"attack":{const n=this.calculateDamage(s,a,s.dexterity||10,s.speed||10);if(m=n.damage,a.isDefending||t){u=Math.floor(.15*m);let e=`${s.name} atacou`;n.isCritical&&(e+=" com golpe crítico"),n.isDoubleAttack&&(e+=` ${n.totalAttacks}x`),e+=`, mas você reduziu o dano de ${m} para ${u} com sua defesa!`,d=e;try{const e=m-u,t=Tf.calculateDefenseSkillXp(null,e);r.push(...t)}catch(h){}}else{u=m;let e=`${s.name} atacou`;n.isCritical&&(e+=" com golpe crítico"),n.isDoubleAttack&&(e+=` ${n.totalAttacks}x`),e+=` e causou ${u} de dano!`,d=e;try{const e=Tf.calculateDefenseSkillXp(null,Math.floor(.3*u));r.push(...e)}catch(h){}}const i=Math.max(0,a.hp-u);if(i<=0)return{newState:await this.processPlayerDeath(e,a,s,d)};const o={...e,player:{...a,hp:i,isDefending:!1,potionUsedThisTurn:!1},isPlayerTurn:!0,gameMessage:d},l=r.length>0?r.map((e=>`+${e.xp} XP em ${Tf.getSkillDisplayName(e.skill)}`)):void 0;return{newState:Ch.updateSpellCooldowns(o),skillXpGains:r,skillMessages:l}}case"spell":{const n=Math.floor(1.2*s.attack),i=10;if(a.isDefending||t){u=Math.floor(.15*n),d=`${s.name} lançou uma magia, mas você reduziu o dano de ${n} para ${u} com sua defesa!`;try{const e=await _h.getEquippedItems(a.id)||null,t=Math.floor(.5*(n-u)),s=Tf.calculateDefenseSkillXp(e,t);r.push(...s)}catch(h){}}else u=n,d=`${s.name} lançou uma magia e causou ${u} de dano mágico!`;const o=Math.max(0,a.hp-u);if(o<=0)return{newState:await this.processPlayerDeath(e,a,s,d)};const l={...e,player:{...a,hp:o,isDefending:!1,potionUsedThisTurn:!1},currentEnemy:{...s,mana:Math.max(0,s.mana-i)},isPlayerTurn:!0,gameMessage:d},c=r.length>0?r.map((e=>`+${e.xp} XP em ${Tf.getSkillDisplayName(e.skill)}`)):void 0;return{newState:Ch.updateSpellCooldowns(l),skillXpGains:r,skillMessages:c}}case"special":{const n=s.special_abilities||[];if(n.length>0){const r=n[Math.floor(Math.random()*n.length)],i=r.split(":")[0].trim();if(r.includes("Regenera")||r.includes("Recupera")||r.includes("cura")){const t=Math.floor(s.maxHp*(.1+.15*Math.random())),r=Math.min(s.maxHp,s.hp+t),n={...e,player:{...a,potionUsedThisTurn:!1},currentEnemy:{...s,hp:r},isPlayerTurn:!0,gameMessage:`${s.name} usou ${i} e recuperou ${t} HP!`};return{newState:Ch.updateSpellCooldowns(n)}}r.includes("dano")||r.includes("ATK")||r.includes("Ataque")?(m=Math.floor(s.attack*(1.3+.7*Math.random())),u=a.isDefending||t?Math.floor(.15*m):m,d=`${s.name} usou ${i} e causou ${u} de dano!`):r.includes("crítico")||r.includes("Crítico")?(m=Math.floor(2*s.attack),u=a.isDefending||t?Math.floor(.15*m):m,d=`${s.name} usou ${i} com um golpe crítico devastador! ${u} de dano!`):r.includes("área")||r.includes("todos")?(m=Math.floor(1.2*s.attack),u=a.isDefending||t?Math.floor(.15*m):m,d=`${s.name} usou ${i} em área! ${u} de dano!`):(m=Math.floor(s.attack*(1.2+.5*Math.random())),u=a.isDefending||t?Math.floor(.15*m):m,d=`${s.name} usou ${i}! ${u} de dano!`)}else switch(s.behavior){case"aggressive":m=Math.floor(1.5*s.attack),u=a.isDefending||t?Math.floor(.15*m):m,d=`${s.name} usou Ataque Furioso e causou ${u} de dano!`;break;case"defensive":{const t=Math.floor(.15*s.maxHp),r=Math.min(s.maxHp,s.hp+t),n={...e,player:{...a,potionUsedThisTurn:!1},currentEnemy:{...s,hp:r},isPlayerTurn:!0,gameMessage:`${s.name} se concentrou e recuperou ${t} HP!`};return{newState:Ch.updateSpellCooldowns(n)}}default:m=Math.floor(1.3*s.attack),u=a.isDefending||t?Math.floor(.15*m):m,d=`${s.name} usou uma habilidade especial e causou ${u} de dano!`}if(u>0)try{const e=await _h.getEquippedItems(a.id)||null;if(a.isDefending||t){const t=m-u,s=Tf.calculateDefenseSkillXp(e,t);r.push(...s)}else{const t=Tf.calculateDefenseSkillXp(e,Math.floor(.2*u));r.push(...t)}}catch(h){}const i=Math.max(0,a.hp-u);if(i<=0)return{newState:await this.processPlayerDeath(e,a,s,d)};const o={...e,player:{...a,hp:i,isDefending:!1,potionUsedThisTurn:!1},isPlayerTurn:!0,gameMessage:d},l=r.length>0?r.map((e=>`+${e.xp} XP em ${Tf.getSkillDisplayName(e.skill)}`)):void 0;return{newState:Ch.updateSpellCooldowns(o),skillXpGains:r,skillMessages:l}}default:{const t={...e,player:{...e.player,potionUsedThisTurn:!1},isPlayerTurn:!0};return{newState:Ch.updateSpellCooldowns(t)}}}}}class Uf{static floorCache=new Map;static cacheExpiry=new Map;static CACHE_DURATION=3e4;static clearCache(){this.floorCache.clear(),this.cacheExpiry.clear()}static async getFloorData(e){let t=e;if(e<=0&&(t=1),t<1||t>1e3)return null;const s=Date.now(),a=this.floorCache.get(t),r=this.cacheExpiry.get(t);if(a&&r&&s<r)return a;try{const{data:e,error:s}=await Es.rpc("get_floor_data",{p_floor_number:t});if(s||!e){const e=this.generateBasicFloorData(t);return this.cacheFloor(t,e),e}const a=Array.isArray(e)?e[0]:e,r={floorNumber:a.floor_number||t,type:a.type||"common",isCheckpoint:a.is_checkpoint||!1,minLevel:a.min_level||1,description:a.description||`Andar ${t}`};return this.cacheFloor(t,r),r}catch(n){const e=this.generateBasicFloorData(t);return this.cacheFloor(t,e),e}}static cacheFloor(e,t){const s=Date.now();this.floorCache.set(e,t),this.cacheExpiry.set(e,s+this.CACHE_DURATION)}static generateBasicFloorData(e){let t="common";5===e||e%10==0?t="boss":e%5==0&&e>5&&(t="elite");const s=1===e||5===e||e>10&&(e-1)%10==0,a=Math.max(1,Math.floor(e/3));let r="";switch(t){case"boss":r=5===e?`Primeiro Desafio - Andar ${e}`:`Covil do Chefe - Andar ${e}`;break;case"elite":r=`Domínio de Elite - Andar ${e}`;break;default:r=1===e?"Entrada da Torre":s?`Santuário Seguro - Andar ${e}`:`Corredor Sombrio - Andar ${e}`}return{floorNumber:e,type:t,isCheckpoint:s,minLevel:a,description:r}}static calculateFloorRewards(e,t,s){const a={boss:2.5,elite:1.8,common:1}[s]||1;return{xp:Math.floor(e*a),gold:Math.floor(t*a)}}}const zf=Object.freeze(Object.defineProperty({__proto__:null,FloorService:Uf},Symbol.toStringTag,{value:"Module"}));class Gf{static async processEnemyDefeat(){const{gameState:e,updateGameState:t,setError:s}=xx.getState();try{const{player:r,currentEnemy:n,currentFloor:i}=e;if(!n||!i)return void s("Estado inválido para processar recompensas");if(!r?.id)return void s("Jogador não encontrado");if(e.battleRewards)return;let o=n;if(!n.possible_drops||0===n.possible_drops.length)try{const{data:e}=await $f.getEnemyForFloor(n.level||1);e&&e.possible_drops&&e.possible_drops.length>0&&(o=e)}catch(a){}const l=n.reward_xp||10,c=n.reward_gold||5,{xp:d,gold:m}=Uf.calculateFloorRewards(l,c,i.type),u=await Ah.grantSecureXP(r.id,d,"combat");if(!u.success)throw new Error(`Falha ao conceder XP: ${u.error}`);const h=u.data,p=await Ah.grantSecureGold(r.id,m);if(!p.success)throw new Error(`Falha ao conceder gold: ${p.error}`);const x=p.data,f=await this.processMonsterDrops(o,i,r.id),g={xp:d,gold:m,drops:f,leveledUp:h.leveled_up,newLevel:h.leveled_up?h.new_level:void 0},b={...r,xp:h.new_xp,level:h.new_level,gold:x};t((e=>{e.player=b,e.battleRewards=g,e.isPlayerTurn=!0,e.gameMessage=`Inimigo derrotado! +${d} XP, +${m} Gold${f.length>0?` + ${f.length} items`:""}${g.leveledUp?" - LEVEL UP!":""}`}))}catch(r){const e=r instanceof Error?r.message:"Erro desconhecido";s(`Erro ao processar recompensas: ${e}`),t((t=>{t.isPlayerTurn=!0,t.gameMessage=`Erro ao processar derrota: ${e}`}))}}static async processMonsterDrops(e,t,s){let a=[];if(e.possible_drops&&e.possible_drops.length>0){const r=Yx.processMonsterDrops(e.level,e.possible_drops,"boss"===t.type?1.5:1);if(r.length>0){const e=await Yx.addDropsToInventory(s,r);if(!e.success)throw new Error(`Falha ao persistir drops: ${e.error}`);const t=r.map((e=>e.drop_id)),n=await Yx.getDropInfoByIds(t);a=n.success&&n.data?r.map((e=>{const t=n.data.find((t=>t.id===e.drop_id));return{name:t?.name||`Item Desconhecido (${e.drop_id})`,quantity:e.quantity}})):r.map((e=>({name:`Item ${e.drop_id.substring(0,8)}...`,quantity:e.quantity})))}}return a}static clearBattleRewards(){const{updateGameState:e}=xx.getState();e((e=>{e.battleRewards=null}))}static hasPendingRewards(){const{gameState:e}=xx.getState();return null!==e.battleRewards}static getCurrentRewards(){const{gameState:e}=xx.getState();return e.battleRewards}static calculateTotalRewardValue(e){let t=e.gold;return t+=e.drops.reduce(((e,t)=>e+10*t.quantity),0),t}static formatRewardsMessage(e){const t=[];if(t.push(`+${e.xp} XP`),t.push(`+${e.gold} Gold`),e.drops.length>0){const s=e.drops.map((e=>`${e.name} (${e.quantity})`)).join(", ");t.push(`Items: ${s}`)}return e.leveledUp&&t.push(`🎉 LEVEL UP! Nível ${e.newLevel}!`),t.join(" • ")}}class Hf{static async loadPlayerForGame(e,t=!1){try{const s=await Ah.getCharacterForGame(e,t,!0);if(!s.success||!s.data)throw new Error(s.error||"Personagem não encontrado");const a=s.data,r=await Ch.getCharacterEquippedSpells(e),n=r.success&&r.data?r.data:[],i=await Yx.getCharacterConsumables(e),o=i.success&&i.data?i.data.filter((e=>e.quantity>0)):[];return{...a,spells:n,consumables:o,active_effects:{buffs:[],debuffs:[],dots:[],hots:[],attribute_modifications:[]}}}catch(s){throw s}}static async advanceToNextFloor(e){const{player:t}=e,s=t.floor+1;try{const a=await Ah.updateCharacterFloor(t.id,s);if(!a.success)throw new Error(a.error||"Erro ao atualizar andar");const r=await Uf.getFloorData(s);if(!r)throw new Error(`Erro ao carregar andar ${s}`);const n=await $f.getEnemyForFloor(s,!0);if(!n.success||!n.data)throw new Error(`Falha ao gerar inimigo para andar ${s}`);const i=n.data,o={...e,mode:"battle",player:{...t,floor:s,isPlayerTurn:!0,isDefending:!1,potionUsedThisTurn:!1,defenseCooldown:Math.max(0,(t.defenseCooldown||0)-1)},currentFloor:r,currentEnemy:i,gameMessage:`Andar ${s}: ${i.name} apareceu!`,isPlayerTurn:!0,battleRewards:null,selectedSpell:null,characterDeleted:!1,fleeSuccessful:!1,highestFloor:Math.max(e.highestFloor||0,s)};return Ch.resetSpellCooldowns(o)}catch(a){try{const a=await $f.getEnemyForFloor(s);if(a.success&&a.data){const r=a.data,n={floorNumber:s,type:"common",isCheckpoint:s%10==0,minLevel:Math.max(1,Math.floor(s/5)),description:`Andar ${s} - Área Desconhecida`},i={...e,player:{...t,floor:s,isPlayerTurn:!0,isDefending:!1,potionUsedThisTurn:!1},currentFloor:n,currentEnemy:r,gameMessage:`Andar ${s}: ${r.name} apareceu!`,isPlayerTurn:!0,battleRewards:null,mode:"battle",selectedSpell:null};return Ch.resetSpellCooldowns(i)}}catch(r){}return{...e,gameMessage:`Erro ao avançar para andar ${s}. Retorne ao hub.`}}}}class Xf{static clearAllCaches(){Yf.clearAllGameCaches()}static async generateEnemy(e){try{const{data:t,success:s}=await $f.getEnemyForFloor(e);return s&&t?t:null}catch(t){return null}}static async saveGameProgress(e,t){const{player:s,currentFloor:a}=e,r={user_id:t,player_name:s.name,current_floor:s.floor,hp:s.hp,max_hp:s.max_hp,attack:s.atk,defense:s.def,highest_floor:Math.max(s.floor,a?.floorNumber||1)};try{const{data:e,error:t}=await Es.from("game_progress").upsert(r).select();return t?{success:!1,error:t.message,data:null}:{success:!0,error:void 0,data:e[0]}}catch(n){return{success:!1,error:n instanceof Error?n.message:"Erro desconhecido",data:null}}}static async loadGameProgress(e){try{const{data:t,error:s}=await Es.from("game_progress").select("*").eq("user_id",e).order("updated_at",{ascending:!1}).limit(1);return s?{success:!1,error:s.message,data:null}:{success:!0,error:void 0,data:t[0]||null}}catch(t){return{success:!1,error:t instanceof Error?t.message:"Erro desconhecido",data:null}}}static async processPlayerAction(e,t,s,a){return Bf.processPlayerAction(e,t,s,a)}static async processEnemyDefeat(){return await Gf.processEnemyDefeat(),xx.getState().gameState}static async processEnemyActionWithDelay(e,t,s){if(!e.currentEnemy||e.currentEnemy.hp<=0)return{newState:e};const a=s??1500+1e3*Math.random();return await new Promise((e=>setTimeout(e,a))),!e.currentEnemy||e.currentEnemy.hp<=0?{newState:e}:Bf.processEnemyAction(e,t)}static async advanceToNextFloor(e){return Hf.advanceToNextFloor(e)}static async loadPlayerForGame(e,t=!1){return Hf.loadPlayerForGame(e,t)}static calculateInitiative=Bf.calculateInitiative;static calculateExtraTurns=Bf.calculateExtraTurns;static calculateDamage=Bf.calculateDamage;static processEnemyAction=Bf.processEnemyAction}const Wf=xp()(jp(((e,t)=>({isProcessingAction:!1,lastActionTimestamp:0,lastAction:"",currentTurnType:null,battlePhase:"idle",actionQueue:[],currentBattleId:null,turnCount:0,showPlayerActionFeedback:!1,showEnemyActionFeedback:!1,lastPlayerActionMessage:"",lastEnemyActionMessage:"",performAction:async(s,a,r)=>{const n=t(),i=xx.getState(),o=i.gameState;if(!o.player)return;if(n.isProcessingAction)return;if("gameover"===o.mode)return;const l=Date.now(),c=l-n.lastActionTimestamp;if(!(n.lastAction===s&&c<2e3||c<500)){e(hx((e=>{e.isProcessingAction=!0,e.lastActionTimestamp=l,e.lastAction=s,e.battlePhase="processing"}))),i.updateLoading("performAction",!0);try{await t().processPlayerTurn(s,a,r)}catch(d){t().resetBattleState()}}},processPlayerTurn:async(s,a,r)=>{const n=xx.getState(),i=jx.getState(),o=n.gameState,l=(e,t)=>{i.addGameLogMessage(e,t)};try{e(hx((e=>{e.currentTurnType="player",e.battlePhase="player_action"})));const i=await Xf.processPlayerAction(s,o,a,r),{newState:m,skipTurn:u,message:h,skillXpGains:p,gameLogMessages:x}=i;if(x?.length&&x.forEach((e=>{l(e.message,e.type)})),p?.length&&o.player?.id)try{const{messages:e,skillLevelUps:t}=await d((async()=>{const{messages:e,skillLevelUps:t}=await Promise.resolve().then((()=>qf));return{messages:e,skillLevelUps:t}}),void 0).then((e=>e.SkillXpService.applySkillXp(o.player.id,p)));for(const s of e)s.includes("subiu para nível")?l(s,"level_up"):l(s,"skill_xp");for(const s of t){const e=await d((()=>Promise.resolve().then((()=>qf))),void 0).then((e=>e.SkillXpService.getSkillDisplayName(s.skill)));l(`🎉 ${e} subiu para nível ${s.newLevel}!`,"level_up")}}catch(c){l("Erro ao aplicar experiência de habilidade","system")}if(n.setGameState(m),e(hx((e=>{e.showPlayerActionFeedback=!0,e.lastPlayerActionMessage=h}))),h&&h.trim()){l(h,"attack"===s||"defend"===s||"spell"===s?"player_action":"system")}if("flee"===s&&(!0===m.fleeSuccessful||"fled"===m.mode))return l(h,"system"),void t().endBattle();if(u)return l(h,"system"),void t().endBattle();if(m.currentEnemy&&m.currentEnemy.hp<=0){const e=await Xf.processEnemyDefeat();return n.setGameState(e),l(`${m.currentEnemy.name} foi derrotado!`,"battle"),void t().endBattle()}if("continue"===s&&null===m.battleRewards&&m.currentEnemy)return l(h,"system"),void t().endBattle();u||!m.currentEnemy||m.fleeSuccessful?t().endBattle():setTimeout((()=>{t().processEnemyTurn(s,"defend"===s)}),1e3)}catch(m){throw l("Erro durante ação do jogador","system"),m}},processEnemyTurn:async(s,a)=>{const r=xx.getState(),n=jx.getState(),i=r.gameState,o=(e,t)=>{n.addGameLogMessage(e,t)};try{e(hx((e=>{e.currentTurnType="enemy",e.battlePhase="enemy_action",e.showPlayerActionFeedback=!1}))),r.updateGameState((e=>{e.isPlayerTurn=!1}));const s=await Xf.processEnemyActionWithDelay(i,a,1500),{newState:n,skillXpGains:c}=s;if(c?.length&&i.player?.id)try{const{messages:e,skillLevelUps:t}=await d((async()=>{const{messages:e,skillLevelUps:t}=await Promise.resolve().then((()=>qf));return{messages:e,skillLevelUps:t}}),void 0).then((e=>e.SkillXpService.applySkillXp(i.player.id,c)));for(const s of e)s.includes("subiu para nível")?o(s,"level_up"):o(s,"skill_xp");for(const s of t){const e=await d((()=>Promise.resolve().then((()=>qf))),void 0).then((e=>e.SkillXpService.getSkillDisplayName(s.skill)));o(`🎉 ${e} subiu para nível ${s.newLevel}!`,"level_up")}}catch(l){}if("gameover"===n.mode)return r.setGameState(n),o("Você foi derrotado!","battle"),void t().endBattle();if(i.player?.id&&await Ah.updateCharacterHpMana(i.player.id,n.player.hp,n.player.mana),n.gameMessage?.trim()){const t=n.gameMessage.includes("causou")&&n.gameMessage.includes("dano")?"damage":"enemy_action";o(n.gameMessage,t),e(hx((e=>{e.showEnemyActionFeedback=!0,e.lastEnemyActionMessage=n.gameMessage})))}r.setGameState({...n,isPlayerTurn:!0}),e(hx((e=>{e.turnCount+=1}))),t().endBattle()}catch(c){o("Erro durante turno do inimigo","system"),t().endBattle()}},startBattle:t=>{e(hx((e=>{e.currentBattleId=t||`battle-${Date.now()}`,e.battlePhase="idle",e.currentTurnType="player",e.turnCount=0,e.isProcessingAction=!1,e.actionQueue=[],e.showPlayerActionFeedback=!1,e.showEnemyActionFeedback=!1})))},endBattle:()=>{const t=xx.getState();e(hx((e=>{e.isProcessingAction=!1,e.battlePhase="ended",e.currentTurnType=null,e.showPlayerActionFeedback=!1,e.showEnemyActionFeedback=!1}))),t.updateLoading("performAction",!1),setTimeout((()=>{e(hx((e=>{e.battlePhase="idle",e.currentBattleId=null})))}),2e3)},resetBattleState:()=>{const t=xx.getState();e(hx((e=>{e.isProcessingAction=!1,e.lastActionTimestamp=0,e.lastAction="",e.currentTurnType=null,e.battlePhase="idle",e.actionQueue=[],e.currentBattleId=null,e.turnCount=0,e.showPlayerActionFeedback=!1,e.showEnemyActionFeedback=!1,e.lastPlayerActionMessage="",e.lastEnemyActionMessage=""}))),t.updateLoading("performAction",!1)},setTurnType:t=>{e(hx((e=>{e.currentTurnType=t})))},setBattlePhase:t=>{e(hx((e=>{e.battlePhase=t})))},incrementTurnCount:()=>{e(hx((e=>{e.turnCount+=1})))},setPlayerActionFeedback:(t,s="")=>{e(hx((e=>{e.showPlayerActionFeedback=t,s&&(e.lastPlayerActionMessage=s)})))},setEnemyActionFeedback:(t,s="")=>{e(hx((e=>{e.showEnemyActionFeedback=t,s&&(e.lastEnemyActionMessage=s)})))},setProcessingAction:t=>{e(hx((e=>{e.isProcessingAction=t})))},updateLastAction:(t,s)=>{e(hx((e=>{e.lastAction=t,e.lastActionTimestamp=s})))},clearActionQueue:()=>{e(hx((e=>{e.actionQueue=[]})))}}))));class Yf{static clearAllGameCaches(){try{const e=xx.getState(),t=wx.getState(),s=Wf.getState(),a=jx.getState();e.resetGameState(),t.setSelectedCharacter(null),s.resetBattleState(),a.clearAllLogs()}catch(e){}Promise.all([d((()=>Promise.resolve().then((()=>zf))),void 0).then((e=>e.FloorService.clearCache())),d((()=>Promise.resolve().then((()=>If))),void 0).then((e=>e.MonsterService.clearCache()))]).catch((e=>{}))}static clearCharacterCache(e){}static clearUserCache(e){try{const t=wx.getState(),s=xx.getState(),a=jx.getState();t.selectedCharacter?.user_id===e&&(t.setSelectedCharacter(null),s.resetGameState()),a.clearAllLogs()}catch(t){}}static clearStoresOnly(){try{const e=xx.getState(),t=wx.getState(),s=Wf.getState(),a=jx.getState();e.resetGameState(),t.setSelectedCharacter(null),s.resetBattleState(),a.clearAllLogs()}catch(e){}}static getStoresDebugInfo(){try{const e=xx.getState(),t=wx.getState(),s=Wf.getState(),a=jx.getState();return{gameState:{mode:e.gameState.mode,hasPlayer:Boolean(e.gameState.player),hasEnemy:Boolean(e.gameState.currentEnemy)},character:{hasSelected:Boolean(t.selectedCharacter),selectedName:t.selectedCharacter?.name},battle:{isProcessing:s.isProcessingAction,phase:s.battlePhase},logs:{count:a.gameLogs.length}}}catch(e){return{gameState:{mode:"error",hasPlayer:!1,hasEnemy:!1},character:{hasSelected:!1},battle:{isProcessing:!1,phase:"error"},logs:{count:0}}}}}class Kf{static async killCharacter(e,t="Battle defeat",s){try{const a=wx.getState(),r=xx.getState(),n=jx.getState(),i=e||a.selectedCharacter?.id;if(!i)throw new Error("Nenhum personagem especificado para morte");const o=a.selectedCharacter?.name||"Personagem";n.addGameLogMessage(`💀 ${o} morreu: ${this.formatDeathCause(t,s)}`,"system");const{data:l,error:c}=await Es.rpc("process_character_death_simple",{p_character_id:i,p_death_cause:t,p_killed_by_monster:s||null});if(c)throw c;a.selectedCharacter?.id===i&&(r.updateGameState((e=>{e.mode="gameover",e.characterDeleted=!0,e.gameMessage=`${o} morreu e foi enviado ao cemitério.`})),setTimeout((()=>{a.setSelectedCharacter(null),a.clearSelection();(a.selectedCharacter?.user_id||a.currentUserId)&&(a.invalidateUserListCache(),a.invalidateCharacterCache(i)),Yf.clearStoresOnly()}),3e3));const d=Array.isArray(l)&&l.length>0?l[0]:null;return{success:!0,data:d?.success||!1?"character_moved_to_cemetery":"unknown",error:null}}catch(a){return jx.getState().addGameLogMessage(`❌ Erro ao processar morte do personagem: ${a instanceof Error?a.message:"Erro desconhecido"}`,"system"),{success:!1,data:null,error:a instanceof Error?a.message:"Erro desconhecido ao matar personagem"}}}static async killSelectedCharacter(e="Battle defeat",t){const s=wx.getState().selectedCharacter;return s?this.killCharacter(s.id,e,t):{success:!1,data:null,error:"Nenhum personagem selecionado para morte"}}static async getUserCemetery(e,t={}){try{const s=jx.getState(),a=e;if(!a)throw new Error("ID do usuário é obrigatório para buscar cemitério");const{page:r=1,limit:n=10}=t,i=(r-1)*n;s.addGameLogMessage(`🪦 Consultando cemitério (página ${r})`,"system");const{data:o,error:l}=await Es.rpc("get_user_cemetery",{p_user_id:a,p_limit:n,p_offset:i});if(l)throw l;const{data:c,error:d}=await Es.rpc("count_user_cemetery",{p_user_id:a});if(d)throw d;const{data:m,error:u}=await Es.rpc("get_cemetery_stats",{p_user_id:a});if(u)throw u;const h=o,p=c,x=m?.[0]||{total_deaths:0,highest_level_reached:0,highest_floor_reached:0,total_survival_time_hours:0,most_common_death_cause:"N/A",deadliest_monster:"N/A"},f=i+h.length<p;return s.addGameLogMessage(`📊 Cemitério carregado: ${h.length} personagens, ${p} total`,"system"),{success:!0,data:{characters:h,total:p,stats:x,hasMore:f},error:null}}catch(s){return{success:!1,data:null,error:s instanceof Error?s.message:"Erro ao buscar cemitério"}}}static async getCemeteryStats(e){try{const{data:t,error:s}=await Es.rpc("get_cemetery_stats",{p_user_id:e});if(s)throw s;return{success:!0,data:t?.[0]||{total_deaths:0,highest_level_reached:0,highest_floor_reached:0,total_survival_time_hours:0,most_common_death_cause:"N/A",deadliest_monster:"N/A"},error:null}}catch(t){return{success:!1,data:null,error:t instanceof Error?t.message:"Erro ao buscar estatísticas"}}}static async hasCemetery(e){try{const{data:t,error:s}=await Es.rpc("count_user_cemetery",{p_user_id:e});if(s)throw s;return{success:!0,data:t>0,error:null}}catch(t){return{success:!1,data:!1,error:t instanceof Error?t.message:"Erro ao verificar cemitério"}}}static formatSurvivalTime(e){if(e<60)return`${e} min`;if(e<1440){const t=Math.floor(e/60),s=e%60;return s>0?`${t}h ${s}min`:`${t}h`}{const t=Math.floor(e/1440),s=Math.floor(e%1440/60);return s>0?`${t}d ${s}h`:`${t}d`}}static formatDeathCause(e,t){return{"Battle defeat":t?`Morto por ${t}`:"Morto em batalha","Player quit":"Abandonou a jornada","System error":"Erro do sistema"}[e]||e}static isSelectedCharacterDead(){try{const e=xx.getState();return"gameover"===e.gameState.mode&&Boolean(e.gameState.characterDeleted)}catch(e){return!1}}static async getQuickCemeteryInfo(e){try{const t=await this.getCemeteryStats(e);return t.success&&t.data?{totalDeaths:t.data.total_deaths,highestLevel:t.data.highest_level_reached,deadliestMonster:t.data.deadliest_monster}:{totalDeaths:0,highestLevel:0,deadliestMonster:"N/A"}}catch(t){return{totalDeaths:0,highestLevel:0,deadliestMonster:"N/A"}}}}function Jf({className:s="",showHeader:a=!0,collapsible:r=!1}){const{user:n}=Vs(),[i,o]=e.useState([]),[l,c]=e.useState(null),[d,m]=e.useState(!0),[u,h]=e.useState(1),[p,x]=e.useState(!1),[f,g]=e.useState(0),[b,v]=e.useState(!1),[y,N]=e.useState(null);e.useEffect((()=>{n?.id&&w()}),[n?.id,u]);const w=async()=>{if(n?.id){m(!0);try{const e=await Kf.getUserCemetery(n.id,{page:u,limit:6});e.success&&e.data?(o(e.data.characters),c(e.data.stats),g(e.data.total),x(e.data.hasMore)):j.error("Erro ao carregar cemitério",{description:e.error||"Erro desconhecido"})}catch(e){j.error("Erro ao carregar cemitério")}finally{m(!1)}}},_=e=>Kf.formatSurvivalTime(e),C=(e,t)=>Kf.formatDeathCause(e,t),S=e=>new Date(e).toLocaleDateString("pt-BR",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"});return d&&0===i.length?t.jsxs(fu,{className:s,children:[a&&t.jsx(gu,{className:"pb-4",children:t.jsxs(bu,{className:"flex items-center gap-2",children:[t.jsx(Re,{className:"h-5 w-5 text-red-500"}),"Cemitério"]})}),t.jsx(yu,{children:t.jsx("div",{className:"flex items-center justify-center py-8",children:t.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-red-500"})})})]}):l&&0!==l.total_deaths?t.jsxs(fu,{className:s,children:[a&&t.jsx(gu,{className:"pb-4",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs(bu,{className:"flex items-center gap-2",children:[t.jsx(Re,{className:"h-5 w-5 text-red-500"}),"Cemitério",t.jsxs(_u,{variant:"destructive",className:"ml-2",children:[l.total_deaths," mort",1===l.total_deaths?"e":"es"]})]}),r&&t.jsx(Ws,{variant:"ghost",size:"sm",onClick:()=>v(!b),children:b?t.jsx(ht,{className:"h-4 w-4"}):t.jsx(Be,{className:"h-4 w-4"})})]})}),(!r||!b)&&t.jsxs(yu,{className:"space-y-6",children:[t.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[t.jsxs("div",{className:"bg-red-500/10 border border-red-500/20 rounded-lg p-3 text-center",children:[t.jsx(ee,{className:"h-6 w-6 mx-auto mb-2 text-red-400"}),t.jsx("div",{className:"text-sm text-muted-foreground",children:"Maior Nível"}),t.jsx("div",{className:"text-xl font-bold text-red-400",children:l.highest_level_reached})]}),t.jsxs("div",{className:"bg-orange-500/10 border border-orange-500/20 rounded-lg p-3 text-center",children:[t.jsx(ft,{className:"h-6 w-6 mx-auto mb-2 text-orange-400"}),t.jsx("div",{className:"text-sm text-muted-foreground",children:"Maior Andar"}),t.jsx("div",{className:"text-xl font-bold text-orange-400",children:l.highest_floor_reached})]}),t.jsxs("div",{className:"bg-blue-500/10 border border-blue-500/20 rounded-lg p-3 text-center",children:[t.jsx(Vt,{className:"h-6 w-6 mx-auto mb-2 text-blue-400"}),t.jsx("div",{className:"text-sm text-muted-foreground",children:"Tempo Total"}),t.jsxs("div",{className:"text-xl font-bold text-blue-400",children:[l.total_survival_time_hours,"h"]})]}),t.jsxs("div",{className:"bg-purple-500/10 border border-purple-500/20 rounded-lg p-3 text-center",children:[t.jsx(kt,{className:"h-6 w-6 mx-auto mb-2 text-purple-400"}),t.jsx("div",{className:"text-sm text-muted-foreground",children:"Maior Ameaça"}),t.jsx("div",{className:"text-xs font-bold text-purple-400 truncate",title:l.deadliest_monster,children:l.deadliest_monster})]})]}),t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("h3",{className:"text-lg font-semibold",children:"Personagens Perdidos"}),t.jsxs("div",{className:"text-sm text-muted-foreground",children:[i.length," de ",f]})]}),d?t.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[1,2,3].map((e=>t.jsxs("div",{className:"bg-muted/20 rounded-lg p-4 animate-pulse",children:[t.jsx("div",{className:"h-6 bg-muted/40 rounded w-24 mb-3"}),t.jsxs("div",{className:"space-y-2",children:[t.jsx("div",{className:"h-4 bg-muted/30 rounded w-full"}),t.jsx("div",{className:"h-4 bg-muted/30 rounded w-3/4"})]})]},e)))}):t.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:i.map((e=>t.jsx(fu,{className:"cursor-pointer transition-all duration-200 hover:shadow-lg hover:scale-105 bg-red-500/5 border-red-500/20",onClick:()=>N(e),children:t.jsx(yu,{className:"p-4",children:t.jsxs("div",{className:"space-y-3",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("h4",{className:"font-semibold text-lg truncate",children:e.name}),t.jsxs(_u,{variant:"outline",className:"bg-background/50",children:["Nv ",e.level]})]}),t.jsxs("div",{className:"grid grid-cols-3 gap-2 text-xs",children:[t.jsxs("div",{className:"text-center",children:[t.jsx(se,{className:"h-3 w-3 mx-auto mb-1 text-red-400"}),t.jsx("div",{className:"text-red-400 font-medium",children:e.atk})]}),t.jsxs("div",{className:"text-center",children:[t.jsx(De,{className:"h-3 w-3 mx-auto mb-1 text-blue-400"}),t.jsx("div",{className:"text-blue-400 font-medium",children:e.def})]}),t.jsxs("div",{className:"text-center",children:[t.jsx(re,{className:"h-3 w-3 mx-auto mb-1 text-yellow-400"}),t.jsx("div",{className:"text-yellow-400 font-medium",children:e.speed})]})]}),t.jsxs("div",{className:"space-y-2 text-xs text-muted-foreground",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("span",{children:"Andar alcançado:"}),t.jsx("span",{className:"font-medium text-orange-400",children:e.floor_reached})]}),t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("span",{children:"Tempo de vida:"}),t.jsx("span",{className:"font-medium text-blue-400",children:_(e.survival_time_minutes)})]}),t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("span",{children:"Gold acumulado:"}),t.jsx("span",{className:"font-medium text-yellow-400",children:ch(e.gold)})]})]}),t.jsxs("div",{className:"bg-red-500/10 border border-red-500/20 rounded p-2",children:[t.jsx("div",{className:"text-xs text-red-400 font-medium",children:C(e.death_cause,e.killed_by_monster)}),t.jsx("div",{className:"text-xs text-muted-foreground mt-1",children:S(e.died_at)})]})]})})},e.id)))})]}),f>6&&t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs(Ws,{variant:"outline",size:"sm",onClick:()=>h((e=>Math.max(1,e-1))),disabled:1===u||d,children:[t.jsx(Be,{className:"h-4 w-4 mr-1"}),"Anterior"]}),t.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:["Página ",u," de ",Math.ceil(f/6)]}),t.jsxs(Ws,{variant:"outline",size:"sm",onClick:()=>h((e=>e+1)),disabled:!p||d,children:["Próxima",t.jsx(Ue,{className:"h-4 w-4 ml-1"})]})]})]}),y&&t.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:t.jsxs(fu,{className:"w-full max-w-2xl max-h-[80vh] overflow-y-auto",children:[t.jsx(gu,{children:t.jsxs(bu,{className:"flex items-center gap-2",children:[t.jsx(Re,{className:"h-5 w-5 text-red-500"}),y.name,t.jsxs(_u,{variant:"outline",className:"ml-2",children:["Nível ",y.level]})]})}),t.jsxs(yu,{className:"space-y-6",children:[t.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4",children:[t.jsxs("div",{className:"bg-red-500/10 border border-red-500/20 rounded p-3 text-center",children:[t.jsx(se,{className:"h-5 w-5 mx-auto mb-2 text-red-400"}),t.jsx("div",{className:"text-sm text-muted-foreground",children:"Ataque"}),t.jsx("div",{className:"text-xl font-bold text-red-400",children:y.atk})]}),t.jsxs("div",{className:"bg-blue-500/10 border border-blue-500/20 rounded p-3 text-center",children:[t.jsx(De,{className:"h-5 w-5 mx-auto mb-2 text-blue-400"}),t.jsx("div",{className:"text-sm text-muted-foreground",children:"Defesa"}),t.jsx("div",{className:"text-xl font-bold text-blue-400",children:y.def})]}),t.jsxs("div",{className:"bg-yellow-500/10 border border-yellow-500/20 rounded p-3 text-center",children:[t.jsx(re,{className:"h-5 w-5 mx-auto mb-2 text-yellow-400"}),t.jsx("div",{className:"text-sm text-muted-foreground",children:"Velocidade"}),t.jsx("div",{className:"text-xl font-bold text-yellow-400",children:y.speed})]}),t.jsxs("div",{className:"bg-green-500/10 border border-green-500/20 rounded p-3 text-center",children:[t.jsx(pt,{className:"h-5 w-5 mx-auto mb-2 text-green-400"}),t.jsx("div",{className:"text-sm text-muted-foreground",children:"HP Máximo"}),t.jsx("div",{className:"text-xl font-bold text-green-400",children:y.max_hp})]}),t.jsxs("div",{className:"bg-purple-500/10 border border-purple-500/20 rounded p-3 text-center",children:[t.jsx(pt,{className:"h-5 w-5 mx-auto mb-2 text-purple-400"}),t.jsx("div",{className:"text-sm text-muted-foreground",children:"Mana Máxima"}),t.jsx("div",{className:"text-xl font-bold text-purple-400",children:y.max_mana})]}),t.jsxs("div",{className:"bg-orange-500/10 border border-orange-500/20 rounded p-3 text-center",children:[t.jsx(ft,{className:"h-5 w-5 mx-auto mb-2 text-orange-400"}),t.jsx("div",{className:"text-sm text-muted-foreground",children:"Andar Alcançado"}),t.jsx("div",{className:"text-xl font-bold text-orange-400",children:y.floor_reached})]})]}),t.jsxs("div",{children:[t.jsx("h3",{className:"text-lg font-semibold mb-3",children:"Atributos Primários"}),t.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[t.jsxs("div",{className:"bg-background/50 rounded p-2 text-center",children:[t.jsx("div",{className:"text-sm text-muted-foreground",children:"Força"}),t.jsx("div",{className:"text-lg font-bold",children:y.strength})]}),t.jsxs("div",{className:"bg-background/50 rounded p-2 text-center",children:[t.jsx("div",{className:"text-sm text-muted-foreground",children:"Destreza"}),t.jsx("div",{className:"text-lg font-bold",children:y.dexterity})]}),t.jsxs("div",{className:"bg-background/50 rounded p-2 text-center",children:[t.jsx("div",{className:"text-sm text-muted-foreground",children:"Inteligência"}),t.jsx("div",{className:"text-lg font-bold",children:y.intelligence})]}),t.jsxs("div",{className:"bg-background/50 rounded p-2 text-center",children:[t.jsx("div",{className:"text-sm text-muted-foreground",children:"Sabedoria"}),t.jsx("div",{className:"text-lg font-bold",children:y.wisdom})]}),t.jsxs("div",{className:"bg-background/50 rounded p-2 text-center",children:[t.jsx("div",{className:"text-sm text-muted-foreground",children:"Vitalidade"}),t.jsx("div",{className:"text-lg font-bold",children:y.vitality})]}),t.jsxs("div",{className:"bg-background/50 rounded p-2 text-center",children:[t.jsx("div",{className:"text-sm text-muted-foreground",children:"Sorte"}),t.jsx("div",{className:"text-lg font-bold",children:y.luck})]})]})]}),t.jsxs("div",{children:[t.jsx("h3",{className:"text-lg font-semibold mb-3",children:"Resumo da Jornada"}),t.jsxs("div",{className:"space-y-3",children:[t.jsxs("div",{className:"flex items-center justify-between p-3 bg-background/50 rounded",children:[t.jsxs("span",{className:"flex items-center gap-2",children:[t.jsx(Rt,{className:"h-4 w-4 text-blue-400"}),"Tempo de sobrevivência"]}),t.jsx("span",{className:"font-medium text-blue-400",children:_(y.survival_time_minutes)})]}),t.jsxs("div",{className:"flex items-center justify-between p-3 bg-background/50 rounded",children:[t.jsxs("span",{className:"flex items-center gap-2",children:[t.jsx(pt,{className:"h-4 w-4 text-yellow-400"}),"XP acumulado"]}),t.jsx("span",{className:"font-medium text-yellow-400",children:ch(y.xp)})]}),t.jsxs("div",{className:"flex items-center justify-between p-3 bg-background/50 rounded",children:[t.jsxs("span",{className:"flex items-center gap-2",children:[t.jsx(Fe,{className:"h-4 w-4 text-yellow-400"}),"Gold acumulado"]}),t.jsx("span",{className:"font-medium text-yellow-400",children:ch(y.gold)})]})]})]}),t.jsxs("div",{className:"bg-red-500/10 border border-red-500/20 rounded p-4",children:[t.jsx("h3",{className:"text-lg font-semibold mb-2 text-red-400",children:"Fim da Jornada"}),t.jsxs("div",{className:"space-y-2",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(Re,{className:"h-4 w-4 text-red-400"}),t.jsx("span",{className:"font-medium",children:C(y.death_cause,y.killed_by_monster)})]}),t.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[t.jsx(ze,{className:"h-4 w-4"}),t.jsx("span",{children:S(y.died_at)})]})]})]}),t.jsx("div",{className:"flex justify-end",children:t.jsx(Ws,{onClick:()=>N(null),children:"Fechar"})})]})]})})]}):t.jsxs(fu,{className:s,children:[a&&t.jsx(gu,{className:"pb-4",children:t.jsxs(bu,{className:"flex items-center gap-2",children:[t.jsx(Re,{className:"h-5 w-5 text-red-500"}),"Cemitério"]})}),t.jsx(yu,{children:t.jsxs("div",{className:"text-center py-8 space-y-4",children:[t.jsx("div",{className:"text-6xl opacity-50",children:"⚰️"}),t.jsxs("div",{className:"space-y-2",children:[t.jsx("h3",{className:"text-lg font-medium text-muted-foreground",children:"Cemitério Vazio"}),t.jsx("p",{className:"text-sm text-muted-foreground",children:"Nenhum personagem foi perdido ainda. Que a sorte continue com você!"})]})]})})]})}const Qf=r("/_authenticated/game/play/hub/cemetery")({component:function(){const e=n();return t.jsx("div",{className:"min-h-screen bg-gradient-to-b from-background to-secondary",children:t.jsxs("div",{className:"container mx-auto p-4 max-w-6xl",children:[t.jsx("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-4 mb-6",children:t.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center gap-2 sm:gap-4",children:[t.jsxs(Ws,{variant:"ghost",onClick:()=>e({to:"/game/play"}),className:"w-fit",children:[t.jsx(Me,{className:"h-4 w-4 mr-2"}),"Voltar à Seleção"]}),t.jsxs("div",{className:"text-center sm:text-left mt-2 sm:mt-0",children:[t.jsx("h1",{className:"text-2xl sm:text-3xl font-bold bg-gradient-to-r from-red-500 to-orange-500 bg-clip-text text-transparent",children:"Cemitério do Tower Trials"}),t.jsx("p",{className:"text-sm sm:text-base text-muted-foreground",children:"Honre a memória dos bravos aventureiros que caíram nas trevas da torre"})]})]})}),t.jsx(Jf,{className:"w-full",showHeader:!1,collapsible:!1})]})})}});const Zf=r("/_authenticated/game/play/hub/equipment/select")({component:function(){const s=n(),{character:a,slot:r}=Zf.useSearch(),[i,o]=e.useState(null),[l,c]=e.useState([]),[d,m]=e.useState([]),[u,h]=e.useState(null),[p,x]=e.useState(!0),[f,g]=e.useState("all"),[b,v]=e.useState("name"),[y,N]=e.useState(!1);e.useEffect((()=>{(async()=>{if(a&&r)try{x(!0);const e=await Ah.getCharacter(a);e.success&&e.data&&o(e.data);const t=await _h.getCharacterEquipment(a);c(t)}catch(e){j.error("Erro ao carregar equipamentos")}finally{x(!1)}else s({to:"/game/play/hub",search:{character:a}})})()}),[a,r,s]),e.useEffect((()=>{const e=l.filter((e=>{if(!e.equipment)return!1;const t=e.equipment;return!!w(t,r)&&("all"===f||t.type===f)}));e.sort(((e,t)=>{const s=e.equipment,a=t.equipment;switch(b){case"name":return s.name.localeCompare(a.name);case"level":return(a.level_requirement||0)-(s.level_requirement||0);case"rarity":{const e={common:1,uncommon:2,rare:3,epic:4,legendary:5};return(e[a.rarity]||0)-(e[s.rarity]||0)}case"attack":return a.atk_bonus-s.atk_bonus;case"defense":return a.def_bonus-s.def_bonus;default:return 0}})),m(e)}),[l,f,b,r]);const w=(e,t)=>{if("weapon"===e.type&&e.is_two_handed&&"main_hand"!==t)return!1;const s={main_hand:["weapon"],off_hand:["weapon","armor"],armor:["armor"],chest:["chest"],helmet:["helmet"],legs:["legs"],boots:["boots"],ring_1:["ring"],ring_2:["ring"],necklace:["necklace"],amulet:["amulet"]}[t];return s?.includes(e.type)||!1},_=e=>({main_hand:"Mão Principal",off_hand:"Mão Secundária",armor:"Armadura",chest:"Peitoral",helmet:"Capacete",legs:"Perneiras",boots:"Botas",ring_1:"Anel 1",ring_2:"Anel 2",necklace:"Colar",amulet:"Amuleto"}[e]||e),C=e=>({weapon:t.jsx(se,{className:"h-6 w-6 text-red-400"}),armor:t.jsx(De,{className:"h-6 w-6 text-blue-400"}),chest:t.jsx(wt,{className:"h-6 w-6 text-green-400"}),helmet:t.jsx(Ye,{className:"h-6 w-6 text-yellow-400"}),legs:t.jsx(De,{className:"h-6 w-6 text-cyan-400"}),boots:t.jsx(_t,{className:"h-6 w-6 text-orange-400"}),ring:t.jsx(xt,{className:"h-6 w-6 text-purple-400"}),necklace:t.jsx(xt,{className:"h-6 w-6 text-pink-400"}),amulet:t.jsx(xt,{className:"h-6 w-6 text-indigo-400"})}[e.type]||t.jsx(De,{className:"h-6 w-6 text-slate-400"})),S=e=>{const t={common:"border-slate-600 bg-slate-800/30 text-slate-300",uncommon:"border-emerald-600 bg-emerald-900/30 text-emerald-300",rare:"border-blue-600 bg-blue-900/30 text-blue-300",epic:"border-purple-600 bg-purple-900/30 text-purple-300",legendary:"border-amber-600 bg-amber-900/30 text-amber-300"};return t[e]||t.common};if(p)return t.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900 p-4",children:t.jsx("div",{className:"max-w-7xl mx-auto",children:t.jsxs("div",{className:"animate-pulse space-y-6",children:[t.jsx("div",{className:"h-8 bg-slate-700 rounded w-64"}),t.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[t.jsx("div",{className:"h-96 bg-slate-700 rounded"}),t.jsx("div",{className:"lg:col-span-2 h-96 bg-slate-700 rounded"})]})]})})});if(!i)return t.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900 p-4",children:t.jsx("div",{className:"max-w-7xl mx-auto",children:t.jsxs("div",{className:"text-center py-12",children:[t.jsx("h1",{className:"text-2xl font-bold text-slate-100 mb-4",children:"Personagem não encontrado"}),t.jsxs(Ws,{onClick:()=>s({to:"/game/play/hub",search:{character:a}}),children:[t.jsx(Me,{className:"h-4 w-4 mr-2"}),"Voltar ao Hub"]})]})})});return t.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900 p-2 sm:p-4",children:t.jsxs("div",{className:"max-w-7xl mx-auto space-y-4",children:[t.jsx("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:t.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center gap-2 sm:gap-4",children:[t.jsxs(Ws,{variant:"outline",size:"sm",onClick:()=>s({to:"/game/play/hub/equipment",search:{character:a}}),className:"w-fit",children:[t.jsx(Me,{className:"h-4 w-4 mr-2"}),"Voltar"]}),t.jsxs("div",{children:[t.jsxs("h1",{className:"text-xl sm:text-2xl font-bold text-slate-100 flex items-center gap-2",children:[t.jsx(se,{className:"h-5 sm:h-6 w-5 sm:w-6 text-amber-400"}),"Selecionar Equipamento"]}),t.jsxs("p",{className:"text-sm text-slate-400",children:[i.name," • ",_(r)]})]})]})}),t.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-4",children:[t.jsxs("div",{className:"space-y-4",children:[t.jsxs(fu,{className:"bg-slate-800/50 border-slate-700/50",children:[t.jsx(gu,{className:"pb-2",children:t.jsxs(bu,{className:"text-slate-100 flex items-center gap-2 text-base",children:[t.jsx(Et,{className:"h-4 w-4 text-amber-400"}),"Filtros"]})}),t.jsx(yu,{children:t.jsx(rf,{filterType:f,onFilterChange:g,sortType:b,onSortChange:v,compact:!0})})]}),t.jsxs(fu,{className:"bg-slate-800/50 border-slate-700/50",children:[t.jsx(gu,{className:"pb-2",children:t.jsxs(bu,{className:"text-slate-100 text-base",children:["Equipamentos (",d.length,")"]})}),t.jsx(yu,{className:"space-y-2 max-h-[400px] sm:max-h-[500px] lg:max-h-[600px] overflow-y-auto",children:0===d.length?t.jsxs("div",{className:"text-center py-8",children:[t.jsx(Et,{className:"h-12 w-12 mx-auto mb-3 text-slate-600 opacity-50"}),t.jsx("p",{className:"text-slate-500",children:"Nenhum equipamento encontrado"})]}):t.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-2 gap-2",children:d.map((e=>{if(!e.equipment)return null;const s=e.equipment,a=u?.characterEquipment.id===e.id,r=e.is_equipped,n=e.slot_type?_(e.slot_type):null;return t.jsx("div",{className:"relative cursor-pointer transition-all duration-200 "+(a?"transform scale-[1.02]":"hover:transform hover:scale-[1.01]"),onClick:()=>h({characterEquipment:e,equipment:s}),children:t.jsx(fu,{className:"border-2 transition-all duration-200 "+(a?"border-amber-400 bg-amber-900/20 shadow-lg shadow-amber-400/20":`${S(s.rarity)} hover:brightness-110`),children:t.jsx(yu,{className:"p-4",children:t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("div",{className:`p-2 rounded-lg ${S(s.rarity)}`,children:C(s)}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsx("h3",{className:"font-medium text-slate-200 truncate",children:s.name}),r&&n&&t.jsx("div",{className:"flex items-center gap-1 mt-1",children:t.jsxs(_u,{variant:"default",className:"bg-green-700 text-green-100 text-xs",children:["✓ Equipado em ",n]})}),t.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[t.jsx(_u,{variant:"outline",className:"text-xs",children:s.rarity}),s.level_requirement&&s.level_requirement>1&&t.jsxs(_u,{variant:"outline",className:"text-xs",children:["Nv. ",s.level_requirement]}),s.is_two_handed&&t.jsx(_u,{className:"bg-orange-700 text-orange-100 text-xs",children:"⚔️ Two-Handed"})]}),t.jsxs("div",{className:"flex items-center gap-3 mt-2 text-xs text-slate-400",children:[s.atk_bonus>0&&t.jsxs("span",{className:"flex items-center gap-1",children:[t.jsx(se,{className:"h-3 w-3 text-red-400"}),"+",s.atk_bonus]}),s.def_bonus>0&&t.jsxs("span",{className:"flex items-center gap-1",children:[t.jsx(De,{className:"h-3 w-3 text-blue-400"}),"+",s.def_bonus]}),s.mana_bonus>0&&t.jsxs("span",{className:"flex items-center gap-1",children:[t.jsx(re,{className:"h-3 w-3 text-purple-400"}),"+",s.mana_bonus]}),s.speed_bonus&&s.speed_bonus>0&&t.jsxs("span",{className:"flex items-center gap-1",children:[t.jsx(re,{className:"h-3 w-3 text-yellow-400"}),"+",s.speed_bonus]})]})]})]})})})},e.id)}))})})]})]}),t.jsx("div",{className:"lg:col-span-2",children:t.jsxs(fu,{className:"bg-slate-800/50 border-slate-700/50 h-full",children:[t.jsx(gu,{className:"pb-2",children:t.jsx(bu,{className:"text-slate-100 text-base",children:"Detalhes do Equipamento"})}),t.jsx(yu,{className:"h-full",children:(()=>{if(!u)return t.jsx("div",{className:"flex items-center justify-center h-full text-slate-500",children:t.jsxs("div",{className:"text-center",children:[t.jsx(Et,{className:"h-16 w-16 mx-auto mb-4 opacity-50"}),t.jsx("p",{className:"text-lg",children:"Selecione um equipamento"}),t.jsx("p",{className:"text-sm mt-2 opacity-75",children:"Clique em um item para ver os detalhes"})]})});const e=!!i&&i.level>=(u.equipment.level_requirement||1);return t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"flex items-start gap-4",children:[t.jsx("div",{className:`p-4 rounded-lg border-2 ${S(u.equipment.rarity)}`,children:C(u.equipment)}),t.jsxs("div",{className:"flex-1",children:[t.jsx("h2",{className:"text-2xl font-bold text-slate-100 mb-2",children:u.equipment.name}),t.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[t.jsx(_u,{className:`border ${S(u.equipment.rarity)}`,children:u.equipment.rarity}),t.jsx(_u,{variant:"outline",className:"text-slate-300",children:u.equipment.type}),"legendary"===u.equipment.rarity&&t.jsx(pt,{className:"h-4 w-4 text-amber-400 animate-pulse"})]})]})]}),t.jsx("div",{className:"bg-slate-800/30 border border-slate-700/50 rounded-lg p-4",children:t.jsx("p",{className:"text-slate-300 leading-relaxed",children:u.equipment.description})}),t.jsxs("div",{className:"space-y-3",children:[t.jsx("h3",{className:"text-lg font-semibold text-slate-200",children:"Atributos"}),t.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[u.equipment.atk_bonus>0&&t.jsxs("div",{className:"bg-red-900/30 border border-red-700/50 rounded-lg p-3",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(se,{className:"h-4 w-4 text-red-400"}),t.jsx("span",{className:"text-red-300 font-medium",children:"Ataque"})]}),t.jsxs("p",{className:"text-red-200 text-lg font-bold",children:["+",u.equipment.atk_bonus]})]}),u.equipment.def_bonus>0&&t.jsxs("div",{className:"bg-blue-900/30 border border-blue-700/50 rounded-lg p-3",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(De,{className:"h-4 w-4 text-blue-400"}),t.jsx("span",{className:"text-blue-300 font-medium",children:"Defesa"})]}),t.jsxs("p",{className:"text-blue-200 text-lg font-bold",children:["+",u.equipment.def_bonus]})]}),u.equipment.mana_bonus>0&&t.jsxs("div",{className:"bg-purple-900/30 border border-purple-700/50 rounded-lg p-3",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(re,{className:"h-4 w-4 text-purple-400"}),t.jsx("span",{className:"text-purple-300 font-medium",children:"Mana"})]}),t.jsxs("p",{className:"text-purple-200 text-lg font-bold",children:["+",u.equipment.mana_bonus]})]}),u.equipment.speed_bonus&&u.equipment.speed_bonus>0&&t.jsxs("div",{className:"bg-yellow-900/30 border border-yellow-700/50 rounded-lg p-3",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(re,{className:"h-4 w-4 text-yellow-400"}),t.jsx("span",{className:"text-yellow-300 font-medium",children:"Velocidade"})]}),t.jsxs("p",{className:"text-yellow-200 text-lg font-bold",children:["+",u.equipment.speed_bonus]})]})]})]}),u.equipment.level_requirement&&u.equipment.level_requirement>1&&t.jsxs("div",{className:"bg-slate-700/30 border border-slate-600/50 rounded-lg p-3",children:[t.jsx("h4",{className:"text-sm font-medium text-slate-300 mb-2",children:"Requisitos"}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("span",{className:"text-slate-400",children:"Nível mínimo:"}),t.jsx("span",{className:"font-bold "+(e?"text-green-400":"text-red-400"),children:u.equipment.level_requirement})]})]}),u.equipment.weapon_subtype&&t.jsxs("div",{className:"bg-slate-700/30 border border-slate-600/50 rounded-lg p-3",children:[t.jsx("h4",{className:"text-sm font-medium text-slate-300 mb-2",children:"Tipo de Arma"}),t.jsx("p",{className:"text-slate-400 capitalize",children:u.equipment.weapon_subtype})]}),u.equipment.is_two_handed&&t.jsx("div",{className:"bg-orange-900/40 border-2 border-orange-600/60 rounded-lg p-4",children:t.jsxs("div",{className:"flex items-start gap-3",children:[t.jsx("div",{className:"text-2xl flex-shrink-0",children:"⚔️"}),t.jsxs("div",{className:"flex-1",children:[t.jsx("h4",{className:"font-semibold text-orange-300 mb-2",children:"Arma Two-Handed"}),t.jsxs("ul",{className:"text-orange-200 text-sm space-y-1",children:[t.jsxs("li",{className:"flex items-center gap-2",children:[t.jsx("span",{className:"text-orange-400",children:"✓"})," Ocupa ambas as mãos"]}),t.jsxs("li",{className:"flex items-center gap-2",children:[t.jsx("span",{className:"text-orange-400",children:"✗"})," Escudo bloqueado"]}),t.jsxs("li",{className:"flex items-center gap-2",children:[t.jsx("span",{className:"text-orange-400",children:"✗"})," Sem dual-wield"]})]})]})]})}),t.jsx("div",{className:"pt-4 border-t border-slate-700/50",children:t.jsx(Ws,{onClick:()=>(async e=>{if(a&&!y)try{N(!0);const t=await _h.toggleEquipment(a,e.id,!0,r);t.success?(j.success(`${e.name} equipado em ${_(r)}!`),s({to:"/game/play/hub/equipment",search:{character:a}})):j.error(t.error||"Erro ao equipar item")}catch(t){j.error("Erro ao equipar item")}finally{N(!1)}})(u.equipment),disabled:!e||y,className:"w-full "+(e?"bg-amber-600 hover:bg-amber-700 text-white":"bg-slate-700 text-slate-400 cursor-not-allowed"),children:y?t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-t border-b border-current"}),"Equipando..."]}):e?`Equipar em ${_(r)}`:`Nível ${u.equipment.level_requirement} necessário`})})]})})()})]})})]})]})})},validateSearch:e=>({character:e.character||"",slot:e.slot||"main_hand"})});function eg({className:s="",size:a=64}){const[r,n]=e.useState(1),[i,o]=e.useState(!0),l={1:"/assets/thief-idle-01-Cg6afdQr.png",2:"/assets/thief-idle-02-Des9M6g7.png",3:"/assets/thief-idle-03-zEN7iEdx.png"};e.useEffect((()=>{if(!i)return;const e=setInterval((()=>{n((e=>e%3+1))}),600);return()=>clearInterval(e)}),[i]);const c=l[r];return t.jsx("div",{className:`relative ${s}`,style:{width:a,height:a},onMouseEnter:()=>o(!0),onMouseLeave:()=>o(!0),children:t.jsx("img",{src:c,alt:`Thief idle animation frame ${r}`,className:"w-full h-full object-contain transition-opacity duration-150",style:{imageRendering:"pixelated"}})})}function tg({activeEffects:s,size:a="md",maxVisible:r=6,className:n=""}){const i=e.useCallback((e=>({atk:"Ataque",def:"Defesa",speed:"Velocidade",magic_attack:"Ataque Mágico",critical_chance:"Chance Crítica",critical_damage:"Dano Crítico"}[e]||e)),[]),o=()=>{switch(a){case"sm":return"w-6 h-6 text-xs";case"lg":return"w-10 h-10 text-sm";default:return"w-8 h-8 text-xs"}},l=e.useMemo((()=>{const e=[],t=new Set;return s.attribute_modifications?.forEach((s=>{const a=s.value>0?"buff":"debuff",r=s.value>0?"+":"",n="percentage"===s.type?"%":"";var o;t.add(s.source_spell),e.push({type:"attribute_mod",icon:(o=s.attribute,{atk:"⚔️",def:"🛡️",speed:"💨",magic_attack:"🔮",critical_chance:"🎯",critical_damage:"💥",strength:"💪",dexterity:"🏃",intelligence:"🧠",wisdom:"📚",vitality:"❤️",luck:"🍀"}[o]||"📊"),color:fh(a),name:s.source_spell,description:`${r}${s.value}${n} ${i(s.attribute)}`,duration:s.duration,isExpiring:s.duration<=1})})),s.buffs?.forEach((s=>{t.has(s.source_spell)||e.push({type:s.type,icon:xh(s.type),color:fh(s.type),name:s.source_spell,description:`Efeito benéfico (+${s.value})`,duration:s.duration,isExpiring:s.duration<=1})})),s.debuffs?.forEach((s=>{t.has(s.source_spell)||e.push({type:s.type,icon:xh(s.type),color:fh(s.type),name:s.source_spell,description:`Efeito prejudicial (-${s.value})`,duration:s.duration,isExpiring:s.duration<=1})})),s.dots?.forEach((t=>{e.push({type:t.type,icon:xh(t.type),color:fh(t.type),name:t.source_spell,description:`${t.value} dano por turno`,duration:t.duration,isExpiring:t.duration<=1})})),s.hots?.forEach((t=>{e.push({type:t.type,icon:xh(t.type),color:fh(t.type),name:t.source_spell,description:`${t.value} cura por turno`,duration:t.duration,isExpiring:t.duration<=1})})),e.slice(0,r)}),[s,r,i]);return 0===l.length?null:t.jsx("div",{className:`flex flex-wrap gap-1 ${n}`,children:t.jsxs(Px,{children:[l.map(((e,s)=>t.jsxs(Mx,{children:[t.jsx(Tx,{asChild:!0,children:t.jsx("div",{className:"relative",children:t.jsxs(_u,{variant:"outline",className:`\n                    ${o()} \n                    ${e.color} \n                    flex items-center justify-center \n                    border-2 cursor-help\n                    ${e.isExpiring?"animate-pulse":""}\n                  `,children:[t.jsx("span",{className:"text-sm",children:e.icon}),t.jsx("div",{className:"absolute -top-1 -right-1 min-w-[16px] h-4 bg-background border border-border rounded-full flex items-center justify-center text-[10px] font-bold",children:e.isExpiring?t.jsx(Rt,{className:"w-2 h-2"}):e.duration})]})})}),t.jsx(qx,{side:"top",className:"max-w-xs bg-background border border-border shadow-xl",children:t.jsxs("div",{className:"p-2",children:[t.jsx("div",{className:"font-semibold text-foreground mb-1",children:e.name}),t.jsx("div",{className:"text-sm text-muted-foreground mb-2",children:e.description}),t.jsxs("div",{className:"flex items-center gap-1 text-xs text-muted-foreground",children:[t.jsx(Rt,{className:"w-3 h-3"}),t.jsx("span",{children:1===e.duration?"Expira no próximo turno":`${e.duration} turnos restantes`})]})]})})]},`${e.name}-${s}`))),(s.buffs?.length||0)+(s.debuffs?.length||0)+(s.dots?.length||0)+(s.hots?.length||0)+(s.attribute_modifications?.length||0)>r&&t.jsx(_u,{variant:"outline",className:`\n              ${o()}\n              bg-gray-500/20 text-gray-400 border-gray-500/30\n              flex items-center justify-center\n            `,children:t.jsx("span",{className:"text-xs",children:"+"})})]})})}function sg({player:s,currentEnemy:a,playerHpPercentage:r,playerManaPercentage:n,enemyHpPercentage:i,isPlayerTurn:o,gameLogs:l,onOpenLogModal:c}){const[d,m]=e.useState(!1),[u,h]=e.useState(!1),[p,x]=e.useState([]),[f,g]=e.useState(!1),b=e.useRef(null),v=Ef(),[y,j]=e.useState({playerHp:s?.hp||0,enemyHp:a?.hp||0,battleId:`${s?.floor||0}-${a?.name||"unknown"}-${Date.now()}`});e.useEffect((()=>{const e=e=>{b.current&&!b.current.contains(e.target)&&g(!1)};return f&&(document.addEventListener("mousedown",e),document.addEventListener("touchstart",e)),()=>{document.removeEventListener("mousedown",e),document.removeEventListener("touchstart",e)}}),[f]);const N=()=>{g(!f)};e.useEffect((()=>{if(!s||!a)return;const e=`${s.floor}-${a.name}`;if(!y.battleId.includes(e))return void j({playerHp:s.hp,enemyHp:a.hp,battleId:e});let t=!1;if(s.hp<y.playerHp&&y.playerHp-s.hp>=1){const e=y.playerHp-s.hp;w(e,!0,!1,"physical"),t=!0}if(a.hp<y.enemyHp&&y.enemyHp-a.hp>=1){const e=y.enemyHp-a.hp,r=e>1.5*(s.atk||0);w(e,!1,r,"physical"),t=!0}t&&j({playerHp:s.hp,enemyHp:a.hp,battleId:e})}),[s?.hp,a?.hp,s?.atk,s?.floor,a?.name,y]);const w=(e,t,s,a)=>{const r=`${Date.now()}-${Math.random()}`,n={id:r,damage:e,isPlayer:t,isCritical:s,damageType:a,timestamp:Date.now()};x((e=>[...e,n])),setTimeout((()=>{x((e=>e.filter((e=>e.id!==r))))}),2e3)};if(!s||!a)return t.jsx("div",{className:"min-h-[400px] flex items-center justify-center",children:t.jsx("div",{className:"text-muted-foreground",children:"Carregando dados da batalha..."})});const _=e=>({armored:"Blindado",swift:"Veloz",magical:"Mágico",brutish:"Brutal",resilient:"Resistente",berserker:"Berserker",ethereal:"Etéreo",venomous:"Venenoso"}[e]||e),C=e=>{switch(e){case"armored":return t.jsx(De,{className:"h-3 w-3"});case"swift":return t.jsx(re,{className:"h-3 w-3"});case"magical":return t.jsx(ut,{className:"h-3 w-3"});case"brutish":return t.jsx(se,{className:"h-3 w-3"});case"resilient":return t.jsx(Gt,{className:"h-3 w-3"});case"berserker":return t.jsx(ft,{className:"h-3 w-3"});case"ethereal":return t.jsx(ht,{className:"h-3 w-3"});case"venomous":return t.jsx(Xt,{className:"h-3 w-3"});default:return t.jsx(Ht,{className:"h-3 w-3"})}};return t.jsxs("div",{className:"relative",children:[t.jsx("div",{className:"absolute inset-0 bg-gradient-to-b from-slate-900/30 via-transparent to-slate-900/30 rounded-xl"}),t.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-blue-500/5 via-transparent to-red-500/5 rounded-xl"}),t.jsx(fu,{className:`relative border-2 backdrop-blur-sm overflow-hidden transition-all duration-500 ${r>=70?"battle-card-healthy":r>=30?"battle-card-wounded":"battle-card-critical"} ${v?"transform scale-90 origin-top-left":""}`,children:t.jsxs(yu,{className:""+(v?"p-2 md:p-3":"p-3 md:p-6"),children:[t.jsx("div",{className:"text-center "+(v?"mb-2 md:mb-3":"mb-3 md:mb-6"),children:t.jsxs("div",{className:"flex items-center justify-center gap-2 md:gap-3 mb-2",children:[t.jsxs(_u,{variant:"outline",className:"px-2 py-1 text-xs bg-background/50",children:[t.jsx(se,{className:"h-3 w-3 mr-1"}),"Andar ",s.floor]}),t.jsx("div",{className:"h-1.5 w-1.5 md:h-2 md:w-2 rounded-full bg-primary animate-pulse"}),t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(_u,{variant:o?"default":"secondary",className:"px-2 py-1 text-xs "+(o?"bg-primary text-primary-foreground border-primary":"bg-secondary text-secondary-foreground border-secondary"),children:o?"Seu Turno":"Turno do Inimigo"}),v&&c&&t.jsx("div",{className:"relative",children:t.jsxs("button",{onClick:c,className:"ml-1 text-muted-foreground hover:text-primary transition-colors touch-manipulation bg-background/50 rounded-full p-1.5 border border-border/50 shadow-sm relative","aria-label":"Abrir log de batalha",children:[t.jsx(Ot,{className:"h-3 w-3 md:h-4 md:w-4"}),l&&l.length>0&&t.jsx("div",{className:"absolute -top-1 -right-1 bg-primary text-primary-foreground text-xs rounded-full h-4 w-4 flex items-center justify-center min-w-[16px]",children:l.length>99?"99+":l.length})]})}),o&&t.jsxs("div",{className:"relative",ref:b,children:[t.jsx("button",{className:"ml-1 text-muted-foreground hover:text-foreground transition-colors touch-manipulation",onClick:N,onTouchStart:N,"aria-label":"Mostrar atalhos de teclado",children:t.jsx(Bt,{className:"h-3 w-3 md:h-4 md:w-4"})}),f&&t.jsxs("div",{className:"absolute top-full left-1/2 transform -translate-x-1/2 mt-2 z-50 bg-background border border-border rounded-lg shadow-xl p-4 w-72 md:w-80 max-w-[90vw]",children:[t.jsxs("div",{className:"text-sm",children:[t.jsx("div",{className:"font-semibold mb-3 text-center text-foreground",children:"Atalhos de Teclado"}),t.jsxs("div",{className:"space-y-2.5",children:[t.jsxs("div",{className:"flex items-center justify-between gap-3",children:[t.jsxs("div",{className:"flex gap-1",children:[t.jsx("span",{className:"font-mono bg-primary/20 text-primary px-2 py-1 rounded text-xs border",children:"A"}),t.jsx("span",{className:"font-mono bg-primary/20 text-primary px-2 py-1 rounded text-xs border",children:"S"}),t.jsx("span",{className:"font-mono bg-primary/20 text-primary px-2 py-1 rounded text-xs border",children:"D"})]}),t.jsx("span",{className:"text-xs text-muted-foreground flex-1 text-right",children:"Atacar, Defender, Fugir"})]}),t.jsxs("div",{className:"flex items-center justify-between gap-3",children:[t.jsxs("div",{className:"flex gap-1",children:[t.jsx("span",{className:"font-mono bg-blue-500/20 text-blue-400 px-2 py-1 rounded text-xs border border-blue-500/30",children:"1"}),t.jsx("span",{className:"font-mono bg-blue-500/20 text-blue-400 px-2 py-1 rounded text-xs border border-blue-500/30",children:"2"}),t.jsx("span",{className:"font-mono bg-blue-500/20 text-blue-400 px-2 py-1 rounded text-xs border border-blue-500/30",children:"3"})]}),t.jsx("span",{className:"text-xs text-muted-foreground flex-1 text-right",children:"Magias 1, 2, 3"})]}),t.jsxs("div",{className:"flex items-center justify-between gap-3",children:[t.jsxs("div",{className:"flex gap-1",children:[t.jsx("span",{className:"font-mono bg-green-500/20 text-green-400 px-2 py-1 rounded text-xs border border-green-500/30",children:"Q"}),t.jsx("span",{className:"font-mono bg-green-500/20 text-green-400 px-2 py-1 rounded text-xs border border-green-500/30",children:"W"}),t.jsx("span",{className:"font-mono bg-green-500/20 text-green-400 px-2 py-1 rounded text-xs border border-green-500/30",children:"E"})]}),t.jsx("span",{className:"text-xs text-muted-foreground flex-1 text-right",children:"Poções 1, 2, 3"})]})]})]}),t.jsx("div",{className:"absolute bottom-full left-1/2 transform -translate-x-1/2 w-0 h-0 border-l-4 border-r-4 border-b-4 border-l-transparent border-r-transparent border-b-border"}),t.jsx("div",{className:"absolute bottom-full left-1/2 transform -translate-x-1/2 translate-y-px w-0 h-0 border-l-4 border-r-4 border-b-4 border-l-transparent border-r-transparent border-b-background"})]})]})]})]})}),t.jsxs("div",{className:"grid grid-cols-2 items-start "+(v?"gap-2 md:gap-4":"gap-3 md:gap-8"),children:[t.jsxs("div",{className:""+(v?"space-y-1 md:space-y-2":"space-y-2 md:space-y-4"),children:[t.jsxs("div",{className:"text-center relative",children:[t.jsxs("div",{className:"relative inline-block mb-2 md:mb-4",children:[t.jsx("div",{className:"w-16 h-16 md:w-24 md:h-24 lg:w-28 lg:h-28 rounded-full bg-gradient-to-br from-blue-500/20 to-purple-500/20 border-2 md:border-3 flex items-center justify-center transition-all duration-500 overflow-hidden "+(o?"border-blue-500 shadow-xl md:shadow-2xl shadow-blue-500/40 scale-105 md:scale-110":"border-blue-500/30 scale-100"),children:t.jsx(eg,{size:64,className:"scale-75 md:scale-100 lg:scale-110"})}),o&&t.jsxs("div",{className:"absolute -top-1 -right-1 md:-top-2 md:-right-2",children:[t.jsx("div",{className:"w-3 h-3 md:w-5 md:h-5 bg-blue-500 rounded-full animate-ping"}),t.jsx("div",{className:"absolute top-0 right-0 w-3 h-3 md:w-5 md:h-5 bg-blue-500 rounded-full"})]}),s.isDefending&&t.jsx("div",{className:"absolute -bottom-1 -left-1 md:-bottom-2 md:-left-2",children:t.jsx("div",{className:"w-6 h-6 md:w-8 md:h-8 bg-blue-600/90 rounded-full flex items-center justify-center border-2 border-background",children:t.jsx(De,{className:"h-3 w-3 md:h-4 md:w-4 text-white"})})})]}),t.jsxs("div",{className:"space-y-1 md:space-y-2",children:[t.jsxs("h3",{className:"font-bold text-sm md:text-lg lg:text-xl flex items-center justify-center gap-1 md:gap-2",children:[t.jsx(Ye,{className:"h-3 w-3 md:h-5 md:w-5 text-yellow-500"}),t.jsx("span",{className:"truncate",children:s.name})]}),t.jsxs("div",{className:"flex items-center justify-center gap-1 md:gap-2 flex-wrap",children:[t.jsxs(_u,{variant:"outline",className:"bg-background/50 text-xs px-1 md:px-2",children:[t.jsx(pt,{className:"h-2 w-2 md:h-3 md:w-3 mr-1"}),"Nv ",s.level]}),t.jsxs(_u,{variant:"outline",className:"bg-background/50 text-yellow-400 text-xs px-1 md:px-2",children:[s.gold.toLocaleString("pt-BR"),"G"]})]})]}),p.filter((e=>e.isPlayer)).map((e=>t.jsxs("div",{className:"absolute pointer-events-none z-20 font-bold text-lg animate-damage-float "+(e.isCritical?"text-red-400 text-2xl animate-damage-critical":"text-red-300"),style:{left:"50%",top:"20%",transform:"translateX(-50%)",textShadow:"2px 2px 4px rgba(0,0,0,0.8)"},children:["-",e.damage,e.isCritical&&t.jsx("span",{className:"ml-1 text-yellow-400 text-sm",children:"CRÍTICO!"})]},e.id)))]}),t.jsxs("div",{className:"space-y-2 md:space-y-3",children:[t.jsxs("div",{children:[t.jsxs("div",{className:"flex justify-between items-center mb-1",children:[t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(ae,{className:"h-3 w-3 md:h-4 md:w-4 text-red-500"}),t.jsx("span",{className:"font-medium text-xs md:text-sm",children:"HP"})]}),t.jsxs("span",{className:"text-xs md:text-sm font-bold",children:[s.hp,"/",s.max_hp]})]}),t.jsx("div",{className:"relative h-2 md:h-3 bg-black/20 rounded-full overflow-hidden",children:t.jsx("div",{className:"h-full transition-all duration-300 "+(r>=70?"bg-green-500":r>=40?"bg-yellow-500":r>=20?"bg-orange-500":"bg-red-500"),style:{width:`${r}%`}})})]}),t.jsxs("div",{children:[t.jsxs("div",{className:"flex justify-between items-center mb-1",children:[t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(ut,{className:"h-3 w-3 md:h-4 md:w-4 text-blue-500"}),t.jsx("span",{className:"font-medium text-xs md:text-sm",children:"MP"})]}),t.jsxs("span",{className:"text-xs md:text-sm font-bold",children:[s.mana,"/",s.max_mana]})]}),t.jsx("div",{className:"relative h-2 md:h-3 bg-black/20 rounded-full overflow-hidden",children:t.jsx("div",{className:"h-full transition-all duration-300 "+(n>=70?"bg-blue-500":n>=40?"bg-cyan-500":n>=20?"bg-indigo-500":"bg-purple-500"),style:{width:`${n}%`}})})]})]}),t.jsxs("div",{className:"grid gap-1 md:gap-2 "+(s.magic_attack&&!isNaN(s.magic_attack)&&s.magic_attack>0?"grid-cols-4":"grid-cols-3"),children:[t.jsxs("div",{className:"bg-red-500/10 border border-red-500/20 rounded p-1 md:p-2 text-center",children:[t.jsx(se,{className:"h-3 w-3 md:h-4 md:w-4 mx-auto mb-1 text-red-400"}),t.jsx("div",{className:"text-xs text-red-300 mb-1",children:"ATK"}),t.jsx("div",{className:"text-xs font-bold text-red-400",children:t.jsx(Dx,{value:s.atk||0,baseValue:s.base_atk,equipmentBonus:s.equipment_atk_bonus,modifications:s.active_effects?.attribute_modifications?.filter((e=>"atk"===e.attribute))||[],size:"sm",showTooltip:!0})})]}),s.magic_attack&&!isNaN(s.magic_attack)&&s.magic_attack>0&&t.jsxs("div",{className:"bg-purple-500/10 border border-purple-500/20 rounded p-1 md:p-2 text-center",children:[t.jsx(ut,{className:"h-3 w-3 md:h-4 md:w-4 mx-auto mb-1 text-purple-400"}),t.jsx("div",{className:"text-xs text-purple-300 mb-1",children:"MAG"}),t.jsx("div",{className:"text-xs font-bold text-purple-400",children:t.jsx(Dx,{value:s.magic_attack,modifications:s.active_effects?.attribute_modifications?.filter((e=>"magic_attack"===e.attribute))||[],size:"sm",showTooltip:!0})})]}),t.jsxs("div",{className:"bg-blue-500/10 border border-blue-500/20 rounded p-1 md:p-2 text-center",children:[t.jsx(De,{className:"h-3 w-3 md:h-4 md:w-4 mx-auto mb-1 text-blue-400"}),t.jsx("div",{className:"text-xs text-blue-300 mb-1",children:"DEF"}),t.jsx("div",{className:"text-xs font-bold text-blue-400",children:t.jsx(Dx,{value:s.def||0,baseValue:s.base_def,equipmentBonus:s.equipment_def_bonus,modifications:s.active_effects?.attribute_modifications?.filter((e=>"def"===e.attribute))||[],size:"sm",showTooltip:!0})})]}),t.jsxs("div",{className:"bg-yellow-500/10 border border-yellow-500/20 rounded p-1 md:p-2 text-center",children:[t.jsx(re,{className:"h-3 w-3 md:h-4 md:w-4 mx-auto mb-1 text-yellow-400"}),t.jsx("div",{className:"text-xs text-yellow-300 mb-1",children:"SPD"}),t.jsx("div",{className:"text-xs font-bold text-yellow-400",children:t.jsx(Dx,{value:s.speed||0,baseValue:s.base_speed,equipmentBonus:s.equipment_speed_bonus,modifications:s.active_effects?.attribute_modifications?.filter((e=>"speed"===e.attribute))||[],size:"sm",showTooltip:!0})})]})]}),s.active_effects&&t.jsx("div",{className:"flex justify-center mb-2 md:mb-3",children:t.jsx(tg,{activeEffects:s.active_effects,size:"sm",maxVisible:4})}),t.jsxs("div",{className:"hidden md:block",children:[t.jsxs(Ws,{variant:"ghost",size:"sm",onClick:()=>m(!d),className:"w-full h-8 text-xs bg-background/30 hover:bg-background/50",children:[d?t.jsx(de,{className:"h-3 w-3 mr-1"}):t.jsx(le,{className:"h-3 w-3 mr-1"}),d?"Menos":"Mais"," Detalhes"]}),d&&t.jsxs("div",{className:"space-y-3 pt-2 border-t border-border/50 animate-in slide-in-from-top-2 duration-300",children:[t.jsx("div",{className:"space-y-2",children:(()=>{const e=(a=s.level)<=1?0:Math.floor(100*Math.pow(1.5,a-2));var a;const r=s.xp_next_level,n=s.xp-e,i=r-e,o=Math.max(0,Math.min(100,n/i*100));return t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"flex justify-between items-center",children:[t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(pt,{className:"h-3 w-3 text-yellow-500"}),t.jsx("span",{className:"font-medium text-xs text-muted-foreground",children:"Experiência"})]}),t.jsxs("div",{className:"text-xs font-bold",children:[t.jsx("span",{className:"text-yellow-400",children:ch(n)}),t.jsx("span",{className:"text-muted-foreground mx-1",children:"/"}),t.jsx("span",{className:"text-muted-foreground",children:ch(i)})]})]}),t.jsxs("div",{className:"relative",children:[t.jsxs("div",{className:"relative",children:[t.jsx(Zh,{value:o,className:"h-2",style:{background:"rgba(0,0,0,0.2)"}}),t.jsx("div",{className:"absolute top-0 left-0 h-2 bg-gradient-to-r from-amber-400 via-yellow-500 to-orange-400 rounded-full transition-all duration-300",style:{width:`${o}%`}})]}),t.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-yellow-500/10 via-yellow-500/5 to-yellow-500/10 rounded-full pointer-events-none"})]}),t.jsxs("div",{className:"flex justify-between text-xs",children:[t.jsxs("span",{className:"text-muted-foreground",children:["Nível ",s.level]}),t.jsxs("span",{className:"text-yellow-400 font-medium",children:[ch(i-n)," para nv"," ",s.level+1]})]})]})})()}),(s.strength||s.dexterity||s.intelligence||s.wisdom||s.vitality||s.luck)&&t.jsxs("div",{className:"space-y-2",children:[t.jsx("div",{className:"text-xs font-medium text-muted-foreground",children:"Atributos Primários:"}),t.jsxs("div",{className:"grid grid-cols-3 gap-2 text-xs",children:[s.strength&&t.jsxs("div",{className:"bg-red-500/10 rounded p-1 text-center",children:[t.jsx(Ie,{className:"h-3 w-3 mx-auto mb-1 text-red-400"}),t.jsx("div",{className:"text-muted-foreground",children:"FOR"}),t.jsx("div",{className:"font-medium",children:s.strength})]}),s.dexterity&&t.jsxs("div",{className:"bg-green-500/10 rounded p-1 text-center",children:[t.jsx(re,{className:"h-3 w-3 mx-auto mb-1 text-green-400"}),t.jsx("div",{className:"text-muted-foreground",children:"DES"}),t.jsx("div",{className:"font-medium",children:s.dexterity})]}),s.intelligence&&t.jsxs("div",{className:"bg-purple-500/10 rounded p-1 text-center",children:[t.jsx(ut,{className:"h-3 w-3 mx-auto mb-1 text-purple-400"}),t.jsx("div",{className:"text-muted-foreground",children:"INT"}),t.jsx("div",{className:"font-medium",children:s.intelligence})]}),s.wisdom&&t.jsxs("div",{className:"bg-blue-500/10 rounded p-1 text-center",children:[t.jsx(ht,{className:"h-3 w-3 mx-auto mb-1 text-blue-400"}),t.jsx("div",{className:"text-muted-foreground",children:"SAB"}),t.jsx("div",{className:"font-medium",children:s.wisdom})]}),s.vitality&&t.jsxs("div",{className:"bg-pink-500/10 rounded p-1 text-center",children:[t.jsx(ae,{className:"h-3 w-3 mx-auto mb-1 text-pink-400"}),t.jsx("div",{className:"text-muted-foreground",children:"VIT"}),t.jsx("div",{className:"font-medium",children:s.vitality})]}),s.luck&&t.jsxs("div",{className:"bg-yellow-500/10 rounded p-1 text-center",children:[t.jsx(pt,{className:"h-3 w-3 mx-auto mb-1 text-yellow-400"}),t.jsx("div",{className:"text-muted-foreground",children:"SOR"}),t.jsx("div",{className:"font-medium",children:s.luck})]})]})]}),(s.critical_chance||s.critical_damage)&&t.jsxs("div",{className:"space-y-2",children:[t.jsx("div",{className:"text-xs font-medium text-muted-foreground",children:"Combate Avançado:"}),t.jsxs("div",{className:"grid grid-cols-2 gap-2 text-xs",children:[s.critical_chance&&t.jsxs("div",{className:"bg-background/20 rounded p-2",children:[t.jsxs("div",{className:"flex items-center gap-1 text-muted-foreground",children:[t.jsx(Ut,{className:"h-3 w-3"}),t.jsx("span",{children:"Crítico"})]}),t.jsx("div",{className:"font-medium text-yellow-400",children:t.jsx(Dx,{value:s.critical_chance,modifications:s.active_effects?.attribute_modifications?.filter((e=>"critical_chance"===e.attribute))||[],size:"sm",showTooltip:!0,label:"%"})})]}),s.critical_damage&&t.jsxs("div",{className:"bg-background/20 rounded p-2",children:[t.jsxs("div",{className:"flex items-center gap-1 text-muted-foreground",children:[t.jsx(ft,{className:"h-3 w-3"}),t.jsx("span",{children:"Dano Crit"})]}),t.jsx("div",{className:"font-medium text-orange-400",children:t.jsx(Dx,{value:s.critical_damage,modifications:s.active_effects?.attribute_modifications?.filter((e=>"critical_damage"===e.attribute))||[],size:"sm",showTooltip:!0,label:"%"})})]})]})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsx("div",{className:"text-xs font-medium text-muted-foreground",children:"Habilidades:"}),t.jsxs("div",{className:"grid grid-cols-2 gap-2 text-xs",children:[(s.sword_mastery||0)>1&&t.jsxs("div",{className:"bg-red-500/10 rounded p-1 text-center",children:[t.jsx(se,{className:"h-3 w-3 mx-auto mb-1 text-red-400"}),t.jsx("div",{className:"text-muted-foreground",children:"Espada"}),t.jsxs("div",{className:"font-medium",children:["Lv ",s.sword_mastery]}),t.jsxs("div",{className:"text-xs text-muted-foreground",children:[s.sword_mastery_xp||0," XP"]})]}),(s.axe_mastery||0)>1&&t.jsxs("div",{className:"bg-orange-500/10 rounded p-1 text-center",children:[t.jsx(ft,{className:"h-3 w-3 mx-auto mb-1 text-orange-400"}),t.jsx("div",{className:"text-muted-foreground",children:"Machado"}),t.jsxs("div",{className:"font-medium",children:["Lv ",s.axe_mastery]}),t.jsxs("div",{className:"text-xs text-muted-foreground",children:[s.axe_mastery_xp||0," XP"]})]}),(s.blunt_mastery||0)>1&&t.jsxs("div",{className:"bg-brown-500/10 rounded p-1 text-center",children:[t.jsx(zt,{className:"h-3 w-3 mx-auto mb-1 text-brown-400"}),t.jsx("div",{className:"text-muted-foreground",children:"Concussão"}),t.jsxs("div",{className:"font-medium",children:["Lv ",s.blunt_mastery]}),t.jsxs("div",{className:"text-xs text-muted-foreground",children:[s.blunt_mastery_xp||0," XP"]})]}),(s.defense_mastery||0)>1&&t.jsxs("div",{className:"bg-blue-500/10 rounded p-1 text-center",children:[t.jsx(De,{className:"h-3 w-3 mx-auto mb-1 text-blue-400"}),t.jsx("div",{className:"text-muted-foreground",children:"Defesa"}),t.jsxs("div",{className:"font-medium",children:["Lv ",s.defense_mastery]}),t.jsxs("div",{className:"text-xs text-muted-foreground",children:[s.defense_mastery_xp||0," XP"]})]}),(s.magic_mastery||0)>1&&t.jsxs("div",{className:"bg-purple-500/10 rounded p-1 text-center",children:[t.jsx(ut,{className:"h-3 w-3 mx-auto mb-1 text-purple-400"}),t.jsx("div",{className:"text-muted-foreground",children:"Magia"}),t.jsxs("div",{className:"font-medium",children:["Lv ",s.magic_mastery]}),t.jsxs("div",{className:"text-xs text-muted-foreground",children:[s.magic_mastery_xp||0," XP"]})]})]})]}),Boolean(s.attribute_points&&s.attribute_points>0)&&t.jsxs("button",{onClick:()=>{window.dispatchEvent(new CustomEvent("openAttributeModal"))},className:"w-full bg-yellow-500/10 border border-yellow-500/20 rounded p-2 hover:bg-yellow-500/20 hover:border-yellow-500/40 transition-all duration-200 cursor-pointer relative overflow-hidden",children:[t.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-yellow-500/5 via-yellow-500/10 to-yellow-500/5 animate-pulse"}),t.jsxs("div",{className:"relative flex items-center gap-2 text-yellow-400",children:[t.jsx(pt,{className:"h-4 w-4 animate-pulse"}),t.jsxs("span",{className:"text-sm font-medium",children:[s.attribute_points," pontos de atributo disponíveis"]})]})]}),Boolean(s.isDefending)&&t.jsxs("div",{className:"flex items-center gap-2 text-blue-400 bg-blue-500/10 rounded p-2",children:[t.jsx(De,{className:"h-4 w-4"}),t.jsx("span",{className:"text-sm font-medium",children:"Postura Defensiva Ativa"})]}),Boolean(s.defenseCooldown>0)&&t.jsxs("div",{className:"flex items-center gap-2 text-orange-400 bg-orange-500/10 rounded p-2",children:[t.jsx(zt,{className:"h-4 w-4"}),t.jsxs("span",{className:"text-sm",children:["Defesa em Cooldown: ",s.defenseCooldown," turnos"]})]})]})]})]}),t.jsxs("div",{className:""+(v?"space-y-1 md:space-y-2":"space-y-2 md:space-y-4"),children:[t.jsxs("div",{className:"text-center relative",children:[t.jsxs("div",{className:"relative inline-block mb-2 md:mb-4",children:[t.jsx("div",{className:"w-16 h-16 md:w-24 md:h-24 lg:w-28 lg:h-28 rounded-full bg-gradient-to-br from-red-500/20 to-orange-500/20 border-2 md:border-3 flex items-center justify-center text-2xl md:text-4xl lg:text-5xl transition-all duration-500 "+(o?"border-red-500/30 scale-100":"border-red-500 shadow-xl md:shadow-2xl shadow-red-500/40 scale-105 md:scale-110"),children:a.image||"👾"}),!o&&t.jsxs("div",{className:"absolute -top-1 -right-1 md:-top-2 md:-right-2",children:[t.jsx("div",{className:"w-3 h-3 md:w-5 md:h-5 bg-red-500 rounded-full animate-ping"}),t.jsx("div",{className:"absolute top-0 right-0 w-3 h-3 md:w-5 md:h-5 bg-red-500 rounded-full"})]})]}),t.jsxs("div",{className:"space-y-1 md:space-y-2",children:[t.jsxs("h3",{className:"font-bold text-sm md:text-lg lg:text-xl flex items-center justify-center gap-1 md:gap-2",children:[t.jsx(Re,{className:"h-3 w-3 md:h-5 md:w-5 text-red-500"}),t.jsx("span",{className:"truncate",children:a.name})]}),t.jsxs("div",{className:"flex items-center justify-center gap-1 md:gap-2 flex-wrap",children:[t.jsxs(_u,{variant:"outline",className:"bg-background/50 text-xs px-1 md:px-2",children:[t.jsx(ht,{className:"h-2 w-2 md:h-3 md:w-3 mr-1"}),"Nv ",a.level]}),a.tier&&a.tier>1&&t.jsxs(_u,{variant:"outline",className:"bg-purple-500/20 text-purple-400 border-purple-500/30 text-xs px-1 md:px-2",children:[t.jsx(pt,{className:"h-2 w-2 md:h-3 md:w-3 mr-1"}),"Tier ",a.tier]}),a.is_boss&&t.jsxs(_u,{className:"bg-red-500/20 text-red-400 border-red-500/30 text-xs px-1 md:px-2",children:[t.jsx(Ye,{className:"h-2 w-2 md:h-3 md:w-3 mr-1"}),"BOSS"]}),t.jsx(_u,{className:`text-xs border px-1 md:px-2 ${(e=>{switch(e){case"aggressive":return"bg-red-500/20 text-red-400 border-red-500/30";case"defensive":return"bg-blue-500/20 text-blue-400 border-blue-500/30";case"balanced":return"bg-green-500/20 text-green-400 border-green-500/30";default:return"bg-gray-500/20 text-gray-400 border-gray-500/30"}})(a.behavior)}`,children:(S=a.behavior,{aggressive:"Agressivo",defensive:"Defensivo",balanced:"Equilibrado"}[S]||S)})]})]}),p.filter((e=>!e.isPlayer)).map((e=>t.jsxs("div",{className:"absolute pointer-events-none z-20 font-bold text-lg animate-damage-float "+(e.isCritical?"text-orange-400 text-2xl animate-damage-critical":"text-orange-300"),style:{left:"50%",top:"20%",transform:"translateX(-50%)",textShadow:"2px 2px 4px rgba(0,0,0,0.8)"},children:["-",e.damage,e.isCritical&&t.jsx("span",{className:"ml-1 text-yellow-400 text-sm",children:"CRÍTICO!"})]},e.id)))]}),t.jsxs("div",{className:"space-y-2 md:space-y-3",children:[t.jsxs("div",{children:[t.jsxs("div",{className:"flex justify-between items-center mb-1",children:[t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(ae,{className:"h-3 w-3 md:h-4 md:w-4 text-red-500"}),t.jsx("span",{className:"font-medium text-xs md:text-sm",children:"HP"})]}),t.jsxs("span",{className:"text-xs md:text-sm font-bold",children:[a.hp,"/",a.maxHp]})]}),t.jsx("div",{className:"relative h-2 md:h-3 bg-black/20 rounded-full overflow-hidden",children:t.jsx("div",{className:"h-full transition-all duration-300 "+(i>=70?"bg-green-500":i>=40?"bg-yellow-500":i>=20?"bg-orange-500":"bg-red-500"),style:{width:`${i}%`}})})]}),Boolean(a.mana>0)&&t.jsxs("div",{children:[t.jsxs("div",{className:"flex justify-between items-center mb-1",children:[t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(ut,{className:"h-3 w-3 md:h-4 md:w-4 text-purple-500"}),t.jsx("span",{className:"font-medium text-xs md:text-sm",children:"MP"})]}),t.jsx("span",{className:"text-xs md:text-sm font-bold",children:a.mana})]}),t.jsxs("div",{className:"relative",children:[t.jsx("div",{className:"h-2 md:h-3 bg-black/20 rounded-full"}),t.jsx("div",{className:"absolute top-0 left-0 h-2 md:h-3 bg-gradient-to-r from-blue-500 via-cyan-500 to-purple-500 rounded-full transition-all duration-300",style:{width:`${Math.min(100,a.mana/Math.max(a.mana,100)*100)}%`}})]})]})]}),a.active_effects&&t.jsx("div",{className:"flex justify-center mb-2 md:mb-3",children:t.jsx(tg,{activeEffects:a.active_effects,size:"sm",maxVisible:4})}),t.jsxs("div",{className:"grid grid-cols-3 gap-1 md:gap-2",children:[t.jsxs("div",{className:"bg-red-500/10 border border-red-500/20 rounded p-1 md:p-2 text-center",children:[t.jsx(se,{className:"h-3 w-3 md:h-4 md:w-4 mx-auto mb-1 text-red-400"}),t.jsx("div",{className:"text-xs font-bold text-red-400",children:a.attack})]}),t.jsxs("div",{className:"bg-blue-500/10 border border-blue-500/20 rounded p-1 md:p-2 text-center",children:[t.jsx(De,{className:"h-3 w-3 md:h-4 md:w-4 mx-auto mb-1 text-blue-400"}),t.jsx("div",{className:"text-xs font-bold text-blue-400",children:a.defense})]}),t.jsxs("div",{className:"bg-yellow-500/10 border border-yellow-500/20 rounded p-1 md:p-2 text-center",children:[t.jsx(re,{className:"h-3 w-3 md:h-4 md:w-4 mx-auto mb-1 text-yellow-400"}),t.jsx("div",{className:"text-xs font-bold text-yellow-400",children:a.speed})]})]}),t.jsxs("div",{className:"hidden md:block",children:[t.jsxs(Ws,{variant:"ghost",size:"sm",onClick:()=>h(!u),className:"w-full h-8 text-xs bg-background/30 hover:bg-background/50",children:[u?t.jsx(de,{className:"h-3 w-3 mr-1"}):t.jsx(le,{className:"h-3 w-3 mr-1"}),u?"Menos":"Mais"," Detalhes"]}),u&&t.jsxs("div",{className:"space-y-3 pt-2 border-t border-border/50 animate-in slide-in-from-top-2 duration-300",children:[t.jsxs("div",{className:"grid grid-cols-2 gap-3 text-xs",children:[t.jsxs("div",{className:"bg-background/20 rounded p-2",children:[t.jsx("div",{className:"text-muted-foreground",children:"Recompensa XP"}),t.jsx("div",{className:"font-medium text-blue-400",children:a.reward_xp})]}),t.jsxs("div",{className:"bg-background/20 rounded p-2",children:[t.jsx("div",{className:"text-muted-foreground",children:"Recompensa Gold"}),t.jsx("div",{className:"font-medium text-yellow-400",children:a.reward_gold})]})]}),Boolean(a.strength||a.dexterity||a.intelligence)&&t.jsxs("div",{className:"space-y-2",children:[t.jsx("div",{className:"text-xs font-medium text-muted-foreground",children:"Atributos Primários:"}),t.jsxs("div",{className:"grid grid-cols-3 gap-2 text-xs",children:[Boolean(a.strength)&&t.jsxs("div",{className:"bg-red-500/10 rounded p-1 text-center",children:[t.jsx(Ie,{className:"h-3 w-3 mx-auto mb-1 text-red-400"}),t.jsx("div",{className:"text-muted-foreground",children:"FOR"}),t.jsx("div",{className:"font-medium",children:a.strength})]}),Boolean(a.dexterity)&&t.jsxs("div",{className:"bg-green-500/10 rounded p-1 text-center",children:[t.jsx(re,{className:"h-3 w-3 mx-auto mb-1 text-green-400"}),t.jsx("div",{className:"text-muted-foreground",children:"DES"}),t.jsx("div",{className:"font-medium",children:a.dexterity})]}),Boolean(a.intelligence)&&t.jsxs("div",{className:"bg-purple-500/10 rounded p-1 text-center",children:[t.jsx(ut,{className:"h-3 w-3 mx-auto mb-1 text-purple-400"}),t.jsx("div",{className:"text-muted-foreground",children:"INT"}),t.jsx("div",{className:"font-medium",children:a.intelligence})]})]})]}),Boolean(a.critical_chance||a.critical_damage)&&t.jsxs("div",{className:"space-y-2",children:[t.jsx("div",{className:"text-xs font-medium text-muted-foreground",children:"Combate Avançado:"}),t.jsxs("div",{className:"grid grid-cols-2 gap-2 text-xs",children:[Boolean(a.critical_chance)&&t.jsxs("div",{className:"bg-background/20 rounded p-2",children:[t.jsxs("div",{className:"flex items-center gap-1 text-muted-foreground",children:[t.jsx(Ut,{className:"h-3 w-3"}),t.jsx("span",{children:"Crítico"})]}),t.jsxs("div",{className:"font-medium text-yellow-400",children:[(a.critical_chance||0).toFixed(1),"%"]})]}),Boolean(a.critical_damage)&&t.jsxs("div",{className:"bg-background/20 rounded p-2",children:[t.jsxs("div",{className:"flex items-center gap-1 text-muted-foreground",children:[t.jsx(ft,{className:"h-3 w-3"}),t.jsx("span",{children:"Dano Crit"})]}),t.jsxs("div",{className:"font-medium text-orange-400",children:[(a.critical_damage||0).toFixed(0),"%"]})]})]})]}),Boolean(a.physical_resistance||a.magical_resistance||a.debuff_resistance)&&t.jsxs("div",{className:"space-y-2",children:[t.jsx("div",{className:"text-xs font-medium text-muted-foreground",children:"Resistências:"}),t.jsxs("div",{className:"space-y-1",children:[Boolean(a.physical_resistance&&a.physical_resistance>0)&&t.jsxs("div",{className:"flex justify-between items-center text-xs",children:[t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(De,{className:"h-3 w-3 text-red-400"}),t.jsx("span",{children:"Física"})]}),t.jsxs("span",{className:"text-red-400",children:[(100*(a.physical_resistance||0)).toFixed(0),"%"]})]}),Boolean(a.magical_resistance&&a.magical_resistance>0)&&t.jsxs("div",{className:"flex justify-between items-center text-xs",children:[t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(ut,{className:"h-3 w-3 text-blue-400"}),t.jsx("span",{children:"Mágica"})]}),t.jsxs("span",{className:"text-blue-400",children:[(100*(a.magical_resistance||0)).toFixed(0),"%"]})]}),Boolean(a.debuff_resistance&&a.debuff_resistance>0)&&t.jsxs("div",{className:"flex justify-between items-center text-xs",children:[t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(Gt,{className:"h-3 w-3 text-green-400"}),t.jsx("span",{children:"Debuffs"})]}),t.jsxs("span",{className:"text-green-400",children:[(100*(a.debuff_resistance||0)).toFixed(0),"%"]})]})]})]}),Boolean(a.physical_vulnerability&&a.physical_vulnerability>1||a.magical_vulnerability&&a.magical_vulnerability>1)&&t.jsxs("div",{className:"space-y-2",children:[t.jsx("div",{className:"text-xs font-medium text-muted-foreground",children:"Vulnerabilidades:"}),t.jsxs("div",{className:"space-y-1",children:[Boolean(a.physical_vulnerability&&a.physical_vulnerability>1)&&t.jsxs("div",{className:"flex justify-between items-center text-xs",children:[t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(mt,{className:"h-3 w-3 text-red-400"}),t.jsx("span",{children:"Física"})]}),t.jsxs("span",{className:"text-red-400",children:["+",(100*((a.physical_vulnerability||1)-1)).toFixed(0),"%"]})]}),Boolean(a.magical_vulnerability&&a.magical_vulnerability>1)&&t.jsxs("div",{className:"flex justify-between items-center text-xs",children:[t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(mt,{className:"h-3 w-3 text-blue-400"}),t.jsx("span",{children:"Mágica"})]}),t.jsxs("span",{className:"text-blue-400",children:["+",(100*((a.magical_vulnerability||1)-1)).toFixed(0),"%"]})]})]})]}),Boolean(a.primary_trait||a.secondary_trait)&&t.jsxs("div",{className:"space-y-2",children:[t.jsx("div",{className:"text-xs font-medium text-muted-foreground",children:"Características:"}),t.jsxs("div",{className:"space-y-1",children:[Boolean(a.primary_trait)&&t.jsxs("div",{className:"flex items-center gap-2 text-xs",children:[C(a.primary_trait),t.jsx("span",{className:"text-purple-400",children:_(a.primary_trait)})]}),Boolean(a.secondary_trait)&&t.jsxs("div",{className:"flex items-center gap-2 text-xs",children:[C(a.secondary_trait),t.jsx("span",{className:"text-blue-400",children:_(a.secondary_trait)})]})]})]})]})]})]})]})]})})]});var S}function ag({handleAction:s,isPlayerTurn:a,loading:r,player:n,onPlayerStatsUpdate:i,currentEnemy:o,battleRewards:l,potionSlots:c,loadingPotionSlots:m,onSlotsChange:u}){const[h,p]=e.useState(null),[x,f]=e.useState(null),[g,b]=e.useState(null),[v,y]=e.useState(null),[N,w]=e.useState(!1),_=e.useRef(!1),C=e.useRef(0),S=e.useRef(null),E=e.useMemo((()=>!a||r.performAction),[a,r.performAction]),k=e.useMemo((()=>n?.potionUsedThisTurn||!1),[n?.potionUsedThisTurn]),A=e.useMemo((()=>void 0!==n?.hp&&n.hp<=0),[n?.hp]),P=e.useMemo((()=>r.performAction||A),[r.performAction,A]),M=e.useMemo((()=>Boolean(l&&!r.performAction&&!A&&!N&&(!o||void 0!==o.hp&&o.hp<=0))),[l,r.performAction,A,N,o]),T=e.useCallback((async()=>{if(!N&&l){w(!0);try{s("continue"),j.success("Avançando para o próximo andar!",{description:"Preparando nova batalha...",duration:2e3})}catch{j.error("Erro ao avançar para o próximo andar"),w(!1)}}}),[N,l,s]),q=e.useCallback((()=>{const e=Date.now()-C.current;return!_.current&&!(e<300)}),[]),D=e.useCallback((async(e,t,a)=>{if(q()){a?.preventDefault?.(),_.current=!0,C.current=Date.now();try{await s(e,t)}finally{setTimeout((()=>{_.current=!1}),300)}}}),[q,s]),R=e.useCallback((async e=>{const t=n,s=t?.potionUsedThisTurn||!1,o=void 0!==t?.hp&&t.hp<=0,l=!a||r.performAction;if(o||l||null!==h||!t?.id)return;const m=c.find((t=>t.slot_position===e));if(m?.consumable_id)if(s)j.error("Você já usou uma poção neste turno!",{description:"Você só pode usar uma poção por turno",duration:3e3});else if(m.available_quantity<=0)j.error("Poção não disponível!",{description:"Você não possui esta poção no inventário",duration:3e3});else{p(e);try{const{SlotService:s}=await d((async()=>{const{SlotService:e}=await Promise.resolve().then((()=>pf));return{SlotService:e}}),void 0),a=await s.consumePotionFromSlot(t.id,e);if(a.success&&a.data){const{message:s,new_hp:r,new_mana:n}=a.data;i(r,n),t&&(t.potionUsedThisTurn=!0),y(e),setTimeout((()=>y(null)),2e3),await u(),j.success(s,{description:`HP: ${r} | Mana: ${n}`,duration:4e3})}else{await u();const t=a.error||"Erro desconhecido ao usar poção";j.error(t,{description:`Slot ${e} - Verifique os logs do console para mais detalhes`,duration:5e3})}}catch(x){try{await u()}catch(f){}j.error("Erro ao usar poção")}finally{p(null)}}else j.warning(`Slot ${L(e)} está vazio`)}),[n,a,r.performAction,h,c,i,u]),L=e=>{switch(e){case 1:return"Q";case 2:return"W";case 3:return"E";default:return""}},$=e.useCallback((e=>{e.preventDefault(),D("attack",void 0,e)}),[D]),I=e.useCallback((e=>{e.preventDefault(),D("defend",void 0,e)}),[D]),F=e.useCallback((e=>{e.preventDefault(),D("flee")}),[D]),V=e.useCallback(((e,t)=>{e.preventDefault(),D("spell",t,e)}),[D]),O=e.useCallback(((e,t)=>{f({...e,position:t})}),[]),B=e.useCallback((()=>{S.current&&clearTimeout(S.current),S.current=setTimeout((()=>{f(null)}),150)}),[]),U=e.useCallback(((e,t)=>{const s=t.currentTarget.getBoundingClientRect(),a={x:s.left+s.width/2,y:s.top-10},r=setTimeout((()=>{O(e,a)}),500);b(r)}),[O]),z=e.useCallback((()=>{g&&(clearTimeout(g),b(null))}),[g]),G=e.useCallback((()=>{g&&(clearTimeout(g),b(null)),B()}),[g,B]),H=e.useCallback(((e,t)=>{t.preventDefault();const s=t.currentTarget.getBoundingClientRect(),a={x:s.left+s.width/2,y:s.top-10},r=setTimeout((()=>{O(e,a)}),500);b(r)}),[O]),X=e.useCallback((()=>{g&&(clearTimeout(g),b(null))}),[g]);e.useEffect((()=>{const e=e=>{const t=n,i=void 0!==t?.hp&&t.hp<=0,o=!a||r.performAction,l=r.performAction||i;if(i||null!==h)return;const c=e.target;if("INPUT"===c.tagName||"TEXTAREA"===c.tagName||"true"===c.contentEditable)return;const d=e.key.toLowerCase();switch(d){case"a":if(o)return;return e.preventDefault(),void s("attack");case"s":if(o||t?.defenseCooldown&&t.defenseCooldown>0)return;return e.preventDefault(),void s("defend");case"d":if(l)return;return e.preventDefault(),void D("flee")}if(o)return;let m=0;switch(d){case"q":m=1;break;case"w":m=2;break;case"e":m=3;break;default:{const a=parseInt(d)-1;if(t&&a>=0&&a<Math.min(3,t.spells.length)){const r=t.spells[a];t.mana>=r.mana_cost&&0===r.current_cooldown&&(e.preventDefault(),s("spell",r.id))}return}}m>0&&(e.preventDefault(),R(m))};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)}),[n,a,r.performAction,h,s,D,R]);const W=e.useMemo((()=>n?.spells?.slice(0,3)||[]),[n?.spells]);return n?t.jsxs(t.Fragment,{children:[A&&t.jsx("div",{className:"absolute inset-0 bg-black/60 backdrop-blur-sm z-50 flex items-center justify-center rounded-xl",children:t.jsxs("div",{className:"text-center space-y-3",children:[t.jsx("div",{className:"text-red-400 text-2xl animate-pulse",children:"💀"}),t.jsx("div",{className:"text-red-400 font-bold text-lg",children:"Personagem Morto"}),t.jsx("div",{className:"text-muted-foreground text-sm",children:"Interface bloqueada"})]})}),t.jsx(fu,{className:"border-0 bg-card/50 backdrop-blur-sm relative",children:t.jsxs(yu,{className:"p-3 md:p-3 space-y-3 md:space-y-2",children:[M&&!A&&t.jsx("div",{className:"mb-4 p-4 bg-gradient-to-r from-green-500/10 via-emerald-500/10 to-teal-500/10 border border-green-500/20 rounded-xl animate-in slide-in-from-top-2 duration-500",children:t.jsxs("div",{className:"text-center space-y-3",children:[t.jsxs("div",{className:"flex items-center justify-center gap-2",children:[t.jsx("div",{className:"text-lg",children:"⚔️"}),t.jsx("div",{className:"text-sm text-green-400 font-medium",children:"Inimigo derrotado - Pronto para avançar"}),t.jsx("div",{className:"text-lg",children:"⚔️"})]}),t.jsxs("div",{className:"bg-background/30 rounded-lg p-3 border border-green-500/10",children:[t.jsx("div",{className:"text-xs text-green-300 font-medium mb-1",children:"Recompensas Obtidas:"}),t.jsxs("div",{className:"flex justify-center items-center gap-4 text-sm",children:[t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(pt,{className:"h-4 w-4 text-blue-400"}),t.jsxs("span",{className:"text-blue-400 font-semibold",children:["+",l?.xp," XP"]})]}),t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx("span",{className:"text-yellow-400 text-lg",children:"💰"}),t.jsxs("span",{className:"text-yellow-400 font-semibold",children:["+",l?.gold," Gold"]})]}),l?.drops&&l.drops.length>0&&t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx("span",{className:"text-purple-400 text-lg",children:"📦"}),t.jsxs("span",{className:"text-purple-400 font-semibold",children:["+",l.drops.length," item",l.drops.length>1?"s":""]})]})]}),l?.leveledUp&&t.jsx("div",{className:"mt-2 text-center",children:t.jsxs(_u,{className:"bg-yellow-500/20 text-yellow-400 border-yellow-500/30 animate-pulse",children:["🎊 LEVEL UP! Nível ",l.newLevel]})})]}),t.jsx(Ws,{onClick:T,disabled:r.performAction||A||N,size:"lg",className:"bg-gradient-to-r from-green-600 to-emerald-600 hover:from-green-700 hover:to-emerald-700 text-white font-semibold px-6 py-3 rounded-xl shadow-lg shadow-green-500/20 transition-all duration-200 transform hover:scale-105 w-full md:w-auto cursor-pointer",children:r.performAction||N?t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-2 border-white border-t-transparent mr-2"}),"Avançando..."]}):t.jsxs(t.Fragment,{children:[t.jsx(Wt,{className:"h-4 w-4 mr-2"}),"Continuar Aventura"]})}),t.jsx("div",{className:"text-xs text-muted-foreground",children:"Continue para o próximo andar da torre"})]})}),t.jsxs("div",{className:"flex flex-col md:flex-row md:justify-center md:items-start gap-3 md:gap-4",children:[t.jsxs("div",{className:"flex-1 md:max-w-xs md:flex-none",children:[t.jsx("div",{className:"text-xs font-medium text-muted-foreground/80 mb-2 text-center md:text-left",children:"Ações de Combate"}),t.jsxs("div",{className:"flex justify-center md:justify-start gap-2",children:[t.jsxs("div",{className:"relative",children:[t.jsx(Ws,{onClick:$,disabled:E||M||A,variant:"ghost",size:"lg",className:"h-12 w-12 md:h-14 md:w-14 rounded-xl p-0 border-2 border-red-500/30 bg-red-500/5 hover:bg-red-500/10 hover:border-red-500/50 shadow-lg shadow-red-500/10 transition-all duration-200 cursor-pointer "+(A?"opacity-30 cursor-not-allowed":""),children:t.jsx(se,{className:"h-4 w-4 md:h-5 md:w-5 text-red-500/80"})}),t.jsx(_u,{variant:"outline",className:"absolute -top-1 -right-1 md:-top-2 md:-right-2 h-4 w-4 md:h-5 md:w-5 p-0 text-xs font-medium flex items-center justify-center bg-background/90 border-muted-foreground/30 hidden md:flex",children:"A"})]}),t.jsxs("div",{className:"relative",children:[t.jsx(Ws,{onClick:I,disabled:E||n.defenseCooldown>0||M||A,variant:"ghost",size:"lg",className:"h-12 w-12 md:h-14 md:w-14 rounded-xl p-0 border-2 border-blue-500/30 bg-blue-500/5 hover:bg-blue-500/10 hover:border-blue-500/50 shadow-lg shadow-blue-500/10 transition-all duration-200 cursor-pointer "+(A?"opacity-30 cursor-not-allowed":""),children:t.jsx(De,{className:"h-4 w-4 md:h-5 md:w-5 text-blue-500/80"})}),t.jsx(_u,{variant:"outline",className:"absolute -top-1 -right-1 md:-top-2 md:-right-2 h-4 w-4 md:h-5 md:w-5 p-0 text-xs font-medium flex items-center justify-center bg-background/90 border-muted-foreground/30 hidden md:flex",style:{display:n.defenseCooldown>0?"none":"flex"},children:"S"})]}),t.jsxs("div",{className:"relative",children:[t.jsx(Ws,{onClick:F,disabled:P,variant:"ghost",size:"lg",className:"h-12 w-12 md:h-14 md:w-14 rounded-xl p-0 border-2 border-amber-500/30 bg-amber-500/5 hover:bg-amber-500/10 hover:border-amber-500/50 shadow-lg shadow-amber-500/10 transition-all duration-200 cursor-pointer "+(A?"opacity-30 cursor-not-allowed":r.performAction?"opacity-50 animate-pulse":""),children:t.jsx(Me,{className:"h-4 w-4 md:h-5 md:w-5 text-amber-500/80"})}),t.jsx(_u,{variant:"outline",className:"absolute -top-1 -right-1 md:-top-2 md:-right-2 h-4 w-4 md:h-5 md:w-5 p-0 text-xs font-medium flex items-center justify-center bg-background/90 border-muted-foreground/30 hidden md:flex",children:"D"})]})]})]}),t.jsxs("div",{className:"flex-1 md:max-w-xs md:flex-none",children:[t.jsx("div",{className:"text-xs font-medium text-muted-foreground/80 mb-2 text-center md:text-right",children:"Poções Rápidas"}),t.jsx("div",{className:"flex justify-center md:justify-end gap-1 md:gap-2",children:m?[1,2,3].map((e=>t.jsxs("div",{className:"relative",children:[t.jsx("div",{className:"h-12 w-12 md:h-14 md:w-14 rounded-xl border-2 border-dashed border-muted-foreground/20 bg-muted/10 animate-pulse"}),t.jsx(_u,{variant:"outline",className:"absolute -top-1 -right-1 md:-top-2 md:-right-2 h-4 w-4 md:h-5 md:w-5 p-0 text-xs font-medium flex items-center justify-center bg-background/90 border-muted-foreground/30",children:L(e)})]},e))):(()=>{const e=[1,2,3].map((e=>{const t=c.find((t=>t.slot_position===e));return t&&t.consumable_id?t.available_quantity<=0?{slot_position:e,consumable_id:null,consumable_name:null,consumable_description:null,effect_value:null,consumable_type:null,available_quantity:0,consumable_price:null}:t:{slot_position:e,consumable_id:null,consumable_name:null,consumable_description:null,effect_value:null,consumable_type:null,available_quantity:0,consumable_price:null}}));return e.map((e=>{const s=L(e.slot_position),a=!e.consumable_id||e.available_quantity<=0,r=h===e.slot_position,n=v===e.slot_position,i=k&&!a,o=a?0:Math.max(0,e.available_quantity),l=a?{title:`Slot ${s}`,description:"Slot vazio - arraste uma poção aqui",stats:[{label:"Tecla de atalho",value:s}]}:{title:e.consumable_name||"Poção",description:e.consumable_description||"",stats:[{label:"Efeito",value:`+${e.effect_value}`},{label:"Quantidade",value:`${o}`},{label:"Tecla",value:s},...i?[{label:"Status",value:"Já usada neste turno"}]:[]]},c=!a&&0===o;return t.jsxs("div",{className:"relative",children:[t.jsxs(Ws,{onClick:()=>R(e.slot_position),disabled:E||a||r||M||i||c||A,variant:"ghost",className:`h-12 w-12 md:h-14 md:w-14 rounded-xl p-2 relative border-2 transition-all duration-200 cursor-pointer ${a?"border-dashed border-muted-foreground/20 bg-transparent hover:bg-muted/10 hover:border-muted-foreground/30":c?"border-red-500/30 bg-red-500/5 opacity-50 cursor-not-allowed":i?"border-orange-500/30 bg-orange-500/5 opacity-50 cursor-not-allowed":"border-emerald-500/30 bg-emerald-500/5 hover:bg-emerald-500/10 hover:border-emerald-500/50 shadow-lg shadow-emerald-500/10"} ${r?"opacity-50":""} ${n?"animate-pulse scale-110":""} ${A?"opacity-30 cursor-not-allowed":""}`,onMouseDown:e=>U(l,e),onMouseUp:z,onMouseLeave:G,onTouchStart:e=>H(l,e),onTouchEnd:X,children:[a?t.jsx(We,{className:"h-4 w-4 md:h-5 md:w-5 text-muted-foreground/40"}):e.consumable_id?t.jsxs("div",{className:"flex items-center justify-center",children:[t.jsx(lf,{consumable:{id:e.consumable_id,name:e.consumable_name||"Poção",description:e.consumable_description||"",type:e.consumable_type||"potion",effect_value:e.effect_value||0,price:e.consumable_price||0,level_requirement:1,created_at:"",updated_at:""},size:"lg",className:"h-5 w-5",showFallback:!0}),(i||c)&&t.jsxs("div",{className:"absolute inset-0 flex items-center justify-center",children:[t.jsx("div",{className:"w-6 h-0.5 bg-red-500 rotate-45 absolute"}),t.jsx("div",{className:"w-6 h-0.5 bg-red-500 -rotate-45 absolute"})]})]}):null,r&&t.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-background/80 rounded-xl",children:t.jsx("div",{className:"animate-spin rounded-full h-3 w-3 md:h-4 md:w-4 border-2 border-primary border-t-transparent"})}),n&&t.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:t.jsx("div",{className:"text-green-400 font-bold text-xs animate-bounce",children:"✓"})})]}),!a&&o>0&&t.jsx("div",{className:"absolute -bottom-1 -left-1 text-white text-xs rounded-full h-5 w-5 flex items-center justify-center border border-background font-semibold "+(o<5?"bg-orange-500/90":"bg-emerald-500/90"),children:o}),t.jsx(_u,{variant:"outline",className:"absolute -top-1 -right-1 md:-top-2 md:-right-2 h-4 w-4 md:h-5 md:w-5 p-0 text-xs font-medium flex items-center justify-center border-muted-foreground/30 "+(i?"bg-orange-500/20 text-orange-400 border-orange-500/30":c?"bg-red-500/20 text-red-400 border-red-500/30":"bg-background/90"),children:s}),i&&!a&&t.jsx("div",{className:"absolute top-0 left-0 bg-orange-500 text-white text-xs rounded-full h-4 w-4 flex items-center justify-center border border-background",children:"✗"})]},e.slot_position)}))})()})]})]}),W.length>0&&t.jsx(t.Fragment,{children:t.jsxs("div",{className:"border-t border-border/50 pt-2",children:[t.jsx("div",{className:"text-xs font-medium text-muted-foreground/80 mb-2 text-center",children:"Magias"}),t.jsx("div",{className:"flex justify-center gap-2 md:max-w-md md:mx-auto",children:W.map(((e,s)=>{const a=!!n&&(n.mana>=e.mana_cost&&0===e.current_cooldown),r=(e=>{const s=e.name.toLowerCase(),a=e.description.toLowerCase();return s.includes("bola de fogo")||s.includes("fireball")||a.includes("fogo")?t.jsx(Xt,{className:"h-4 w-4"}):s.includes("raio de gelo")||s.includes("ice")||a.includes("gelo")?t.jsx(Yt,{className:"h-4 w-4"}):s.includes("cura")||s.includes("heal")||a.includes("restaura")?t.jsx(ae,{className:"h-4 w-4"}):s.includes("raio")||s.includes("bolt")||a.includes("raio")?t.jsx(re,{className:"h-4 w-4"}):s.includes("escudo")||s.includes("shield")||a.includes("defesa")?t.jsx(Gt,{className:"h-4 w-4"}):s.includes("dano")||a.includes("damage")||a.includes("dano")?t.jsx(ft,{className:"h-4 w-4"}):a.includes("overtime")||a.includes("tempo")?t.jsx(zt,{className:"h-4 w-4"}):t.jsx(ut,{className:"h-4 w-4"})})(e),i=(s+1).toString(),o={title:e.name,description:e.description,stats:[{label:"Custo de Mana",value:`${e.mana_cost}`},{label:"Cooldown",value:e.current_cooldown>0?`${e.current_cooldown} turnos`:"Disponível"},{label:"Dano/Efeito",value:`${e.effect_value}`},{label:"Tecla",value:i}]};return t.jsxs("div",{className:"relative",children:[t.jsxs(Ws,{onClick:t=>V(t,e.id),onMouseDown:e=>U(o,e),onMouseUp:z,onMouseLeave:G,onTouchStart:e=>H(o,e),onTouchEnd:X,disabled:E||!a||M||A||!n,variant:"ghost",size:"lg",className:`h-12 w-12 md:h-14 md:w-14 rounded-xl p-0 relative border-2 transition-all duration-200 cursor-pointer ${a?"border-violet-500/30 bg-violet-500/5 hover:bg-violet-500/10 hover:border-violet-500/50 shadow-lg shadow-violet-500/10":"border-muted-foreground/10 bg-muted/5 opacity-50 cursor-not-allowed"} ${A?"opacity-30 cursor-not-allowed":""}`,children:[t.jsx("div",{className:a?"text-violet-500/80":"text-muted-foreground/50",children:r}),e.current_cooldown>0&&t.jsx("div",{className:"absolute -top-1 -right-1 bg-red-500/90 text-white text-xs rounded-full h-4 w-4 flex items-center justify-center border border-background",children:e.current_cooldown}),t.jsx("div",{className:"absolute -bottom-1 -right-1 text-white text-xs rounded-full h-4 w-4 flex items-center justify-center border border-background "+(a?"bg-blue-500/90":"bg-muted-foreground/70"),children:e.mana_cost})]}),t.jsx(_u,{variant:"outline",className:"absolute -top-1 -left-1 md:-top-2 md:-left-2 h-4 w-4 md:h-5 md:w-5 p-0 text-xs font-medium flex items-center justify-center bg-background/90 border-muted-foreground/30 hidden md:flex",children:i})]},e.id)}))})]})}),t.jsx("div",{className:"hidden md:block text-center",children:t.jsx("div",{className:"text-xs text-muted-foreground/60",children:A?"Interface bloqueada - Personagem morto":"Atalhos: A/S/D (Combate) • Q/W/E (Poções) • 1/2/3 (Magias)"})})]})}),x&&t.jsx("div",{className:"fixed z-50 pointer-events-none",style:{left:x.position.x,top:x.position.y,transform:"translate(-50%, -100%)"},children:t.jsxs("div",{className:"bg-background/95 backdrop-blur-sm border border-border/50 rounded-lg p-3 shadow-xl max-w-xs",children:[t.jsx("h4",{className:"font-medium text-sm mb-1",children:x.title}),t.jsx("p",{className:"text-xs text-muted-foreground mb-2 leading-relaxed",children:x.description}),x.stats.length>0&&t.jsx("div",{className:"space-y-1",children:x.stats.map(((e,s)=>t.jsxs("div",{className:"flex justify-between text-xs",children:[t.jsxs("span",{className:"text-muted-foreground",children:[e.label,":"]}),t.jsx("span",{className:"font-medium",children:e.value})]},s)))})]})})]}):t.jsx("div",{className:"min-h-[200px] flex items-center justify-center",children:t.jsx("div",{className:"text-muted-foreground",children:"Carregando interface de batalha..."})})}function rg({isOpen:s,onContinue:a,onReturnToHub:r,onOpenAttributeModal:n,rewards:i,leveledUp:o,newLevel:l,hasAttributePoints:c}){const d=Sf();e.useEffect((()=>{if(d){const e=document.createElement("style");return e.textContent="\n        .victory-modal-landscape .scroll-area {\n          max-height: calc(90vh - 140px);\n          overflow-y: auto;\n          -webkit-overflow-scrolling: touch;\n        }\n        .victory-modal-buttons {\n          min-height: 24px !important;\n          padding: 0.15rem 0.3rem !important;\n          font-size: 0.65rem !important;\n          font-weight: 600 !important;\n          line-height: 1 !important;\n        }\n        .victory-modal-landscape [data-radix-dialog-content] {\n          max-height: 90vh !important;\n        }\n      ",document.head.appendChild(e),()=>{document.head.removeChild(e)}}}),[d]);return t.jsx(el,{children:s&&t.jsx(Ph,{open:s,children:t.jsxs(qh,{className:"overflow-hidden "+(d?"max-w-[98vw] max-h-[98vh] p-2 victory-modal-landscape w-[98vw]":"sm:max-w-[425px]"),children:[t.jsxs(Dh,{className:"relative "+(d?"pb-2":""),children:[!d&&t.jsx(Zm.div,{initial:{scale:0},animate:{scale:1},transition:{type:"spring",duration:.5},className:"absolute -top-12 left-1/2 -translate-x-1/2 w-24 h-24 bg-yellow-500/20 rounded-full flex items-center justify-center",children:t.jsx(ee,{className:"h-12 w-12 text-yellow-500"})}),t.jsxs(Zm.div,{initial:{y:20,opacity:0},animate:{y:0,opacity:1},transition:{delay:.3},className:"flex items-center gap-3 "+(d?"justify-start":"flex-col text-center pt-12"),children:[d&&t.jsx(Zm.div,{initial:{scale:0},animate:{scale:1},transition:{type:"spring",duration:.5},className:"w-10 h-10 bg-yellow-500/20 rounded-full flex items-center justify-center flex-shrink-0",children:t.jsx(ee,{className:"h-5 w-5 text-yellow-500"})}),t.jsxs("div",{className:d?"text-left":"text-center",children:[t.jsx(Lh,{className:"font-bold "+(d?"text-base":"text-2xl"),children:"Vitória!"}),t.jsx($h,{className:""+(d?"text-xs":""),children:"Você derrotou o inimigo e avançou para o próximo andar!"})]})]})]}),t.jsx("div",{className:d?"scroll-area overflow-y-auto max-h-[calc(98vh-100px)]":"",children:t.jsxs(Zm.div,{className:""+(d?"py-1 space-y-1":"space-y-4 py-4"),initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.5},children:[t.jsxs("div",{className:""+(d?"grid grid-cols-2 gap-1 mb-1":"space-y-4"),children:[t.jsxs(Zm.div,{className:"flex items-center gap-2 bg-primary/10 rounded-lg "+(d?"p-1":"p-3 text-lg"),whileHover:{scale:1.02},children:[t.jsx(pt,{className:"text-yellow-500 "+(d?"h-3 w-3":"h-6 w-6")}),t.jsxs("div",{className:"min-w-0 flex-1",children:[t.jsx("div",{className:"font-semibold "+(d?"text-xs":""),children:"Experiência"}),t.jsxs("div",{className:"font-bold text-primary "+(d?"text-xs":"text-2xl"),children:["+",i.xp," XP"]})]})]}),t.jsxs(Zm.div,{className:"flex items-center gap-2 bg-primary/10 rounded-lg "+(d?"p-1":"p-3 text-lg"),whileHover:{scale:1.02},children:[t.jsx(Fe,{className:"text-yellow-400 "+(d?"h-3 w-3":"h-6 w-6")}),t.jsxs("div",{className:"min-w-0 flex-1",children:[t.jsx("div",{className:"font-semibold "+(d?"text-xs":""),children:"Ouro"}),t.jsxs("div",{className:"font-bold text-primary "+(d?"text-xs":"text-2xl"),children:["+",ch(i.gold)," Gold"]})]})]})]}),o&&l&&t.jsxs(Zm.div,{className:"rounded-lg bg-gradient-to-r from-primary/20 to-primary/30 text-center "+(d?"p-2 mt-2":"p-4 mt-2"),initial:{scale:.8,opacity:0},animate:{scale:1,opacity:1},transition:{delay:.7,type:"spring"},children:[t.jsxs("div",{className:"flex items-center gap-2 "+(d?"justify-start mb-1":"justify-center mb-2"),children:[t.jsx(ut,{className:"text-primary "+(d?"h-4 w-4":"h-6 w-6")}),t.jsxs("div",{className:"font-bold "+(d?"text-sm":"text-xl"),children:["Nível ",l,"!"]})]}),t.jsx("div",{className:"opacity-80 "+(d?"text-xs mb-1":"text-sm mb-2"),children:"Seu personagem evoluiu e ficou mais forte!"}),t.jsxs("div",{className:"grid gap-1 "+(d?"grid-cols-4 text-xs":"grid-cols-2 gap-2 text-sm"),children:[t.jsx("div",{className:"bg-background/50 rounded "+(d?"p-1":"p-2"),children:"HP +10"}),t.jsx("div",{className:"bg-background/50 rounded "+(d?"p-1":"p-2"),children:"Mana +5"}),t.jsx("div",{className:"bg-background/50 rounded "+(d?"p-1":"p-2"),children:"Ataque +2"}),t.jsx("div",{className:"bg-background/50 rounded "+(d?"p-1":"p-2"),children:"Defesa +1"})]})]}),c&&!o&&t.jsxs(Zm.div,{className:"rounded-lg bg-gradient-to-r from-purple-500/20 to-purple-600/20 text-center border border-purple-500/30 "+(d?"p-2 mt-2":"p-4 mt-2"),initial:{scale:.8,opacity:0},animate:{scale:1,opacity:1},transition:{delay:.9,type:"spring"},children:[t.jsxs("div",{className:"flex items-center gap-2 "+(d?"justify-start mb-1":"justify-center mb-2"),children:[t.jsx(Ie,{className:"text-purple-400 "+(d?"h-4 w-4":"h-5 w-5")}),t.jsx("div",{className:"font-bold "+(d?"text-sm":"text-lg"),children:"Pontos de Atributo Disponíveis"})]}),t.jsx("div",{className:"opacity-90 "+(d?"text-xs mb-2":"text-sm mb-2"),children:'Você tem pontos para distribuir! Clique em "Distribuir Pontos" para fortalecer seu personagem.'})]}),i.drops.length>0&&t.jsxs(Zm.div,{className:"bg-primary/10 rounded-lg "+(d?"mt-2 p-2":"mt-4 p-4"),initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.9},children:[t.jsxs("h4",{className:"font-semibold flex items-center gap-2 "+(d?"mb-1 text-xs":"mb-3"),children:[t.jsx(vt,{className:d?"h-3 w-3":"h-5 w-5"}),"Itens Obtidos"]}),t.jsx("div",{className:""+(d?"grid grid-cols-2 gap-1":"space-y-2"),children:i.drops.map(((e,s)=>t.jsxs(Zm.div,{className:"flex items-center gap-2 bg-background/50 rounded "+(d?"p-1 text-xs":"p-2"),initial:{x:-20,opacity:0},animate:{x:0,opacity:1},transition:{delay:1+.1*s},children:[t.jsx("span",{className:d?"text-xs":"text-xl",children:"🎁"}),t.jsx("span",{className:"flex-1 truncate",children:e.name}),t.jsxs("span",{className:"font-mono flex-shrink-0",children:["x",e.quantity]})]},s)))})]})]})}),t.jsx(Rh,{className:"flex flex-col gap-1 "+(d?"mt-1":"mt-4"),children:t.jsxs("div",{className:"w-full "+(d?"grid grid-cols-3 gap-1":"flex flex-col gap-2"),children:[c&&t.jsxs(Ws,{onClick:()=>{n()},className:"bg-gradient-to-r from-purple-500 to-purple-600 hover:from-purple-600 hover:to-purple-700 text-white shadow-lg "+(d?"victory-modal-buttons text-xs":"w-full"),children:[t.jsx(Ie,{className:""+(d?"h-3 w-3":"h-4 w-4 mr-2")}),d?"Pts":"Distribuir Pontos de Atributo"]}),t.jsxs(Ws,{onClick:()=>{r()},variant:"outline",className:"items-center justify-center "+(d?"victory-modal-buttons text-xs":"flex-1"),children:[t.jsx(Kt,{className:""+(d?"h-3 w-3":"h-4 w-4 mr-2")}),d?"":"Voltar ao Hub"]}),t.jsxs(Ws,{onClick:()=>{a()},className:"bg-emerald-500 hover:bg-emerald-600 "+(d?"victory-modal-buttons text-xs":"flex-1"),children:[t.jsx(Wt,{className:""+(d?"h-3 w-3":"h-4 w-4 mr-2")}),"Continuar"]})]})})]})})})}function ng({isOpen:s,onClose:a,player:r,gameMessage:i=`${r.name} foi derrotado no Andar ${r.floor}...`,highestFloor:o=r.floor,isCharacterDeleted:l=!1,onReturnToCharacterSelect:c,onViewCemetery:d}){const m=n(),[u,h]=e.useState(!1),[p,x]=e.useState(!1),f=Sf();return t.jsx(Ph,{open:s,onOpenChange:a,children:t.jsxs(qh,{className:"overflow-hidden "+(f?"max-w-[95vw] max-h-[95vh] w-[95vw] p-3":"sm:max-w-md"),children:[t.jsx(Dh,{className:"text-center "+(f?"pb-2":""),children:t.jsxs(Lh,{className:"flex items-center justify-center gap-2 "+(f?"text-lg":"text-2xl"),children:[t.jsx(Re,{className:"text-red-500 "+(f?"h-5 w-5":"h-8 w-8")}),l?"Permadeath - Personagem Perdido":"Fim de Jogo"]})}),t.jsxs("div",{className:""+(f?"space-y-2 max-h-[calc(95vh-140px)] overflow-y-auto":"space-y-4"),children:[t.jsxs("div",{className:"text-center",children:[t.jsx("p",{className:"mb-2 "+(f?"text-sm":"text-lg"),children:i}),t.jsxs("div",{className:"flex items-center justify-center gap-2 mb-2 "+(f?"mb-2":"mb-4"),children:[t.jsx(ee,{className:"text-yellow-500 "+(f?"h-4 w-4":"h-6 w-6")}),t.jsxs("span",{className:"font-bold "+(f?"text-lg":"text-2xl"),children:["Andar ",r.floor-1]})]}),t.jsxs("p",{className:"text-muted-foreground "+(f?"text-xs":"text-sm"),children:["Seu recorde atual: Andar ",o]})]}),t.jsxs("div",{className:f?"grid grid-cols-2 gap-2":"space-y-3",children:[t.jsxs("div",{className:"bg-muted rounded-lg "+(f?"p-2":"p-4"),children:[t.jsx("h3",{className:"font-medium mb-2 "+(f?"text-sm":""),children:"Estatísticas Finais"}),t.jsxs("div",{className:"grid grid-cols-2 gap-1 "+(f?"text-xs":"gap-2 text-sm"),children:[t.jsx("div",{children:"Personagem:"}),t.jsx("div",{className:"font-medium truncate",children:r.name}),t.jsx("div",{children:"Andares:"}),t.jsx("div",{className:"font-medium",children:r.floor-1}),t.jsx("div",{children:"HP final:"}),t.jsxs("div",{className:"font-medium",children:[r.hp,"/",r.max_hp]}),t.jsx("div",{children:"Nível:"}),t.jsx("div",{className:"font-medium",children:r.level}),t.jsx("div",{children:"Gold:"}),t.jsx("div",{className:"font-medium",children:ch(r.gold)}),t.jsx("div",{children:"XP total:"}),t.jsx("div",{className:"font-medium",children:ch(r.xp)})]})]}),t.jsxs("div",{className:"bg-red-500/10 border border-red-500/20 rounded-lg "+(f?"p-2":"p-4"),children:[t.jsxs("div",{className:"flex items-center gap-2 mb-2 "+(f?"mb-1":""),children:[t.jsx(kt,{className:"text-red-400 "+(f?"h-3 w-3":"h-5 w-5")}),t.jsx("span",{className:"font-medium text-red-400 "+(f?"text-xs":"text-sm"),children:"Aviso de Permadeath"})]}),t.jsx("p",{className:"text-red-400 mb-2 "+(f?"text-xs mb-1":"text-sm"),children:l?"Este personagem foi permanentemente deletado.":"Este personagem será permanentemente deletado ao continuar."}),t.jsx("p",{className:"text-red-300 text-xs",children:"Suas estatísticas serão salvas no ranking para comparação."})]})]}),l&&t.jsx("div",{className:"bg-blue-500/10 border border-blue-500/20 rounded-lg "+(f?"p-2":"p-3"),children:t.jsxs("div",{className:"text-blue-400 text-xs",children:["💀 ",t.jsx("strong",{children:"Estatísticas da Jornada:"}),t.jsx("br",{}),t.jsxs("div",{className:"mt-1 "+(f?"grid grid-cols-2 gap-1":""),children:[t.jsxs("div",{children:["• Nível alcançado: ",r.level]}),t.jsxs("div",{children:["• Andar mais alto: ",r.floor]}),t.jsxs("div",{children:["• Gold acumulado: ",r.gold]}),t.jsxs("div",{children:["• XP total: ",r.xp]})]})]})})]}),t.jsxs("div",{className:"flex gap-2 "+(f?"flex-row pt-2":"flex-col pt-4"),children:[l&&t.jsxs(Ws,{variant:"outline",onClick:()=>{d?d():m({to:"/game/play/hub/cemetery",search:{character:r.id}})},className:"border-blue-500/30 text-blue-400 hover:bg-blue-500/10 "+(f?"flex-1 text-xs h-8":"w-full"),disabled:u||p,children:[t.jsx(ht,{className:"mr-1 "+(f?"h-3 w-3":"h-4 w-4 mr-2")}),f?"Cemitério":"Ver Cemitério"]}),t.jsx(Ws,{variant:"destructive",onClick:async()=>{if(r.id)try{if(h(!0),x(!0),!l){const{error:e}=await Ah.markCharacterDead(r.id);if(e)throw new Error(e)}j.success("Fim de jogo",{description:"Personagem perdido permanentemente. Suas estatísticas foram salvas no ranking."}),c()}catch(e){j.error("Erro ao finalizar jogo",{description:e instanceof Error?e.message:"Erro desconhecido"})}finally{h(!1),x(!1)}},disabled:u||p,className:""+(f?"flex-1 text-xs h-8":"w-full"),children:u||p?t.jsxs("span",{className:"flex items-center gap-1",children:[t.jsx("div",{className:"animate-spin rounded-full border-t-2 border-b-2 border-white "+(f?"h-3 w-3":"h-4 w-4")}),"Finalizando..."]}):t.jsxs("span",{className:"flex items-center gap-1",children:[t.jsx(Re,{className:""+(f?"h-3 w-3":"h-4 w-4")}),f?"Aceitar Derrota":l?"Criar Novo Personagem":"Aceitar Derrota e Salvar"]})}),t.jsxs(Ws,{variant:"outline",onClick:()=>{m({to:"/game/ranking"})},className:""+(f?"flex-1 text-xs h-8":"w-full"),disabled:u||p,children:[t.jsx(ee,{className:"mr-1 "+(f?"h-3 w-3":"h-4 w-4 mr-2")}),f?"Ranking":"Ver Ranking"]})]})]})})}function ig({currentFloor:e,playerLevel:s}){const a=e.floorNumber||1,r=Math.ceil(a/20),n=(a-1)%20+1,i=5===a||a%10==0,o=a%5==0&&a>5&&!i,l=r>1;return t.jsx("div",{className:"mb-4",children:t.jsxs("div",{className:"text-center",children:[t.jsxs("div",{className:"flex items-center justify-center gap-2 mb-2 flex-wrap",children:[t.jsxs("h2",{className:"text-2xl font-bold text-primary",children:[(e=>{switch(e){case"boss":return"👑";case"elite":return"⭐";default:return"🗺️"}})(e.type)," ",e.description]}),t.jsxs(_u,{variant:"outline",className:"bg-background/50",children:[t.jsx(Jt,{className:"h-3 w-3 mr-1"}),"Andar ",a]}),l&&t.jsxs(_u,{className:"bg-purple-500/20 text-purple-400 border-purple-500/30",children:[t.jsx(Ye,{className:"h-3 w-3 mr-1"}),"Tier ",r]}),i&&t.jsxs(_u,{className:"bg-red-500/20 text-red-400 border-red-500/30 animate-pulse",children:[t.jsx(ft,{className:"h-3 w-3 mr-1"}),"BOSS"]}),o&&t.jsxs(_u,{className:"bg-orange-500/20 text-orange-400 border-orange-500/30",children:[t.jsx(pt,{className:"h-3 w-3 mr-1"}),"ELITE"]}),e.isCheckpoint&&t.jsxs(_u,{className:"bg-primary/20 text-primary",children:[t.jsx(pt,{className:"h-3 w-3 mr-1"}),"Checkpoint"]})]}),l&&t.jsx("div",{className:"text-xs text-muted-foreground mb-2",children:t.jsxs("span",{className:"bg-purple-500/10 px-2 py-1 rounded border border-purple-500/20",children:["Sistema Cíclico: Posição ",n,"/20 no Ciclo ",r,i&&" • Monstros Escalados"]})}),s<e.minLevel&&t.jsxs("div",{className:"text-yellow-500 text-sm",children:["⚠️ Nível recomendado: ",e.minLevel]}),l&&t.jsx("div",{className:"text-sm text-purple-400 mt-2",children:"Os monstros foram fortalecidos pelo poder ancestral da torre!"})]})})}var og="Popover",[lg,cg]=we(og,[es]),dg=es(),[mg,ug]=lg(og),hg=s=>{const{__scopePopover:a,children:r,open:n,defaultOpen:i,onOpenChange:o,modal:l=!1}=s,c=dg(a),d=e.useRef(null),[m,u]=e.useState(!1),[h,p]=ds({prop:n,defaultProp:i??!1,onChange:o,caller:og});return t.jsx(ms,{...c,children:t.jsx(mg,{scope:a,contentId:us(),triggerRef:d,open:h,onOpenChange:p,onOpenToggle:e.useCallback((()=>p((e=>!e))),[p]),hasCustomAnchor:m,onCustomAnchorAdd:e.useCallback((()=>u(!0)),[]),onCustomAnchorRemove:e.useCallback((()=>u(!1)),[]),modal:l,children:r})})};hg.displayName=og;var pg="PopoverAnchor";e.forwardRef(((s,a)=>{const{__scopePopover:r,...n}=s,i=ug(pg,r),o=dg(r),{onCustomAnchorAdd:l,onCustomAnchorRemove:c}=i;return e.useEffect((()=>(l(),()=>c())),[l,c]),t.jsx(hs,{...o,...n,ref:a})})).displayName=pg;var xg="PopoverTrigger",fg=e.forwardRef(((e,s)=>{const{__scopePopover:a,...r}=e,n=ug(xg,a),i=dg(a),o=ts(s,n.triggerRef),l=t.jsx(ne.button,{type:"button","aria-haspopup":"dialog","aria-expanded":n.open,"aria-controls":n.contentId,"data-state":kg(n.open),...r,ref:o,onClick:ns(e.onClick,n.onOpenToggle)});return n.hasCustomAnchor?l:t.jsx(hs,{asChild:!0,...i,children:l})}));fg.displayName=xg;var gg="PopoverPortal",[bg,vg]=lg(gg,{forceMount:void 0}),yg=e=>{const{__scopePopover:s,forceMount:a,children:r,container:n}=e,i=ug(gg,s);return t.jsx(bg,{scope:s,forceMount:a,children:t.jsx(Qt,{present:a||i.open,children:t.jsx(Zt,{asChild:!0,container:n,children:r})})})};yg.displayName=gg;var jg="PopoverContent",Ng=e.forwardRef(((e,s)=>{const a=vg(jg,e.__scopePopover),{forceMount:r=a.forceMount,...n}=e,i=ug(jg,e.__scopePopover);return t.jsx(Qt,{present:r||i.open,children:i.modal?t.jsx(_g,{...n,ref:s}):t.jsx(Cg,{...n,ref:s})})}));Ng.displayName=jg;var wg=rs("PopoverContent.RemoveScroll"),_g=e.forwardRef(((s,a)=>{const r=ug(jg,s.__scopePopover),n=e.useRef(null),i=ts(a,n),o=e.useRef(!1);return e.useEffect((()=>{const e=n.current;if(e)return ss(e)}),[]),t.jsx(as,{as:wg,allowPinchZoom:!0,children:t.jsx(Sg,{...s,ref:i,trapFocus:r.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:ns(s.onCloseAutoFocus,(e=>{e.preventDefault(),o.current||r.triggerRef.current?.focus()})),onPointerDownOutside:ns(s.onPointerDownOutside,(e=>{const t=e.detail.originalEvent,s=0===t.button&&!0===t.ctrlKey,a=2===t.button||s;o.current=a}),{checkForDefaultPrevented:!1}),onFocusOutside:ns(s.onFocusOutside,(e=>e.preventDefault()),{checkForDefaultPrevented:!1})})})})),Cg=e.forwardRef(((s,a)=>{const r=ug(jg,s.__scopePopover),n=e.useRef(!1),i=e.useRef(!1);return t.jsx(Sg,{...s,ref:a,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:e=>{s.onCloseAutoFocus?.(e),e.defaultPrevented||(n.current||r.triggerRef.current?.focus(),e.preventDefault()),n.current=!1,i.current=!1},onInteractOutside:e=>{s.onInteractOutside?.(e),e.defaultPrevented||(n.current=!0,"pointerdown"===e.detail.originalEvent.type&&(i.current=!0));const t=e.target,a=r.triggerRef.current?.contains(t);a&&e.preventDefault(),"focusin"===e.detail.originalEvent.type&&i.current&&e.preventDefault()}})})),Sg=e.forwardRef(((e,s)=>{const{__scopePopover:a,trapFocus:r,onOpenAutoFocus:n,onCloseAutoFocus:i,disableOutsidePointerEvents:o,onEscapeKeyDown:l,onPointerDownOutside:c,onFocusOutside:d,onInteractOutside:m,...u}=e,h=ug(jg,a),p=dg(a);return is(),t.jsx(os,{asChild:!0,loop:!0,trapped:r,onMountAutoFocus:n,onUnmountAutoFocus:i,children:t.jsx(ls,{asChild:!0,disableOutsidePointerEvents:o,onInteractOutside:m,onEscapeKeyDown:l,onPointerDownOutside:c,onFocusOutside:d,onDismiss:()=>h.onOpenChange(!1),children:t.jsx(cs,{"data-state":kg(h.open),role:"dialog",id:h.contentId,...p,...u,ref:s,style:{...u.style,"--radix-popover-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-popover-content-available-width":"var(--radix-popper-available-width)","--radix-popover-content-available-height":"var(--radix-popper-available-height)","--radix-popover-trigger-width":"var(--radix-popper-anchor-width)","--radix-popover-trigger-height":"var(--radix-popper-anchor-height)"}})})})})),Eg="PopoverClose";e.forwardRef(((e,s)=>{const{__scopePopover:a,...r}=e,n=ug(Eg,a);return t.jsx(ne.button,{type:"button",...r,ref:s,onClick:ns(e.onClick,(()=>n.onOpenChange(!1)))})})).displayName=Eg;function kg(e){return e?"open":"closed"}e.forwardRef(((e,s)=>{const{__scopePopover:a,...r}=e,n=dg(a);return t.jsx(ps,{...n,...r,ref:s})})).displayName="PopoverArrow";var Ag=yg,Pg=Ng;const Mg=hg,Tg=fg,qg=e.forwardRef((({className:e,align:s="center",sideOffset:a=4,...r},n)=>t.jsx(Ag,{children:t.jsx(Pg,{ref:n,align:s,sideOffset:a,className:Hs("z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-popover-content-transform-origin]",e),...r})})));qg.displayName=Pg.displayName;var Dg="Checkbox",[Rg,Lg]=we(Dg),[$g,Ig]=Rg(Dg);function Fg(s){const{__scopeCheckbox:a,checked:r,children:n,defaultChecked:i,disabled:o,form:l,name:c,onCheckedChange:d,required:m,value:u="on",internal_do_not_use_render:h}=s,[p,x]=ds({prop:r,defaultProp:i??!1,onChange:d,caller:Dg}),[f,g]=e.useState(null),[b,v]=e.useState(null),y=e.useRef(!1),j=!f||(!!l||!!f.closest("form")),N={checked:p,disabled:o,setChecked:x,control:f,setControl:g,name:c,form:l,value:u,hasConsumerStoppedPropagationRef:y,required:m,defaultChecked:!Wg(i)&&i,isFormControl:j,bubbleInput:b,setBubbleInput:v};return t.jsx($g,{scope:a,...N,children:Xg(h)?h(N):n})}var Vg="CheckboxTrigger",Og=e.forwardRef((({__scopeCheckbox:s,onKeyDown:a,onClick:r,...n},i)=>{const{control:o,value:l,disabled:c,checked:d,required:m,setControl:u,setChecked:h,hasConsumerStoppedPropagationRef:p,isFormControl:x,bubbleInput:f}=Ig(Vg,s),g=ts(i,u),b=e.useRef(d);return e.useEffect((()=>{const e=o?.form;if(e){const t=()=>h(b.current);return e.addEventListener("reset",t),()=>e.removeEventListener("reset",t)}}),[o,h]),t.jsx(ne.button,{type:"button",role:"checkbox","aria-checked":Wg(d)?"mixed":d,"aria-required":m,"data-state":Yg(d),"data-disabled":c?"":void 0,disabled:c,value:l,...n,ref:g,onKeyDown:ns(a,(e=>{"Enter"===e.key&&e.preventDefault()})),onClick:ns(r,(e=>{h((e=>!!Wg(e)||!e)),f&&x&&(p.current=e.isPropagationStopped(),p.current||e.stopPropagation())}))})}));Og.displayName=Vg;var Bg=e.forwardRef(((e,s)=>{const{__scopeCheckbox:a,name:r,checked:n,defaultChecked:i,required:o,disabled:l,value:c,onCheckedChange:d,form:m,...u}=e;return t.jsx(Fg,{__scopeCheckbox:a,checked:n,defaultChecked:i,disabled:l,required:o,onCheckedChange:d,name:r,form:m,value:c,internal_do_not_use_render:({isFormControl:e})=>t.jsxs(t.Fragment,{children:[t.jsx(Og,{...u,ref:s,__scopeCheckbox:a}),e&&t.jsx(Hg,{__scopeCheckbox:a})]})})}));Bg.displayName=Dg;var Ug="CheckboxIndicator",zg=e.forwardRef(((e,s)=>{const{__scopeCheckbox:a,forceMount:r,...n}=e,i=Ig(Ug,a);return t.jsx(Qt,{present:r||Wg(i.checked)||!0===i.checked,children:t.jsx(ne.span,{"data-state":Yg(i.checked),"data-disabled":i.disabled?"":void 0,...n,ref:s,style:{pointerEvents:"none",...e.style}})})}));zg.displayName=Ug;var Gg="CheckboxBubbleInput",Hg=e.forwardRef((({__scopeCheckbox:s,...a},r)=>{const{control:n,hasConsumerStoppedPropagationRef:i,checked:o,defaultChecked:l,required:c,disabled:d,name:m,value:u,form:h,bubbleInput:p,setBubbleInput:x}=Ig(Gg,s),f=ts(r,x),g=xs(o),b=fs(n);e.useEffect((()=>{const e=p;if(!e)return;const t=window.HTMLInputElement.prototype,s=Object.getOwnPropertyDescriptor(t,"checked").set,a=!i.current;if(g!==o&&s){const t=new Event("click",{bubbles:a});e.indeterminate=Wg(o),s.call(e,!Wg(o)&&o),e.dispatchEvent(t)}}),[p,g,o,i]);const v=e.useRef(!Wg(o)&&o);return t.jsx(ne.input,{type:"checkbox","aria-hidden":!0,defaultChecked:l??v.current,required:c,disabled:d,name:m,value:u,form:h,...a,tabIndex:-1,ref:f,style:{...a.style,...b,position:"absolute",pointerEvents:"none",opacity:0,margin:0,transform:"translateX(-100%)"}})}));function Xg(e){return"function"==typeof e}function Wg(e){return"indeterminate"===e}function Yg(e){return Wg(e)?"indeterminate":e?"checked":"unchecked"}Hg.displayName=Gg;const Kg=e.forwardRef((({className:e,...s},a)=>t.jsx(Bg,{ref:a,className:Hs("peer h-4 w-4 shrink-0 rounded-sm border border-primary shadow focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground",e),...s,children:t.jsx(zg,{className:Hs("flex items-center justify-center text-current"),children:t.jsx(be,{className:"h-4 w-4"})})})));function Jg({gameLog:s}){const a=e.useRef(null),[r,n]=e.useState({system:!0,battle:!0,lore:!0,skill_xp:!0,level_up:!0,equipment:!0,enemy_action:!0,player_action:!0,damage:!0,healing:!0});e.useEffect((()=>{if(a.current){const e=a.current.querySelector("[data-radix-scroll-area-viewport]");e&&(e.scrollTop=e.scrollHeight)}}),[s]);const i=e=>{n({system:e,battle:e,lore:e,skill_xp:e,level_up:e,equipment:e,enemy_action:e,player_action:e,damage:e,healing:e})},o=s.filter((e=>r[e.type])),l=e=>{switch(e){case"system":case"player_action":return"text-blue-400";case"battle":default:return"text-foreground";case"lore":return"text-purple-400 italic";case"skill_xp":return"text-green-400";case"level_up":return"text-yellow-400 font-semibold";case"equipment":return"text-orange-400";case"enemy_action":return"text-red-400";case"damage":return"text-red-300";case"healing":return"text-green-300"}},c=e=>{switch(e){case"enemy_action":return t.jsx(se,{className:"h-3 w-3 text-red-400 mr-2"});case"player_action":return t.jsx(De,{className:"h-3 w-3 text-blue-400 mr-2"});case"damage":return t.jsx(re,{className:"h-3 w-3 text-red-300 mr-2"});case"healing":return t.jsx(ut,{className:"h-3 w-3 text-green-300 mr-2"});case"level_up":return t.jsx("span",{className:"mr-2",children:"🌟"});case"equipment":return t.jsx("span",{className:"mr-2",children:"⚔️"});case"skill_xp":return t.jsx("span",{className:"mr-2",children:"📈"});case"lore":return t.jsx("span",{className:"mr-2",children:"📜"});default:return null}},d=e=>{switch(e){case"system":return"Sistema";case"battle":return"Batalha";case"lore":return"História";case"skill_xp":return"XP de Habilidade";case"level_up":return"Level Up";case"equipment":return"Equipamentos";case"enemy_action":return"Ações do Inimigo";case"player_action":return"Ações do Jogador";case"damage":return"Dano";case"healing":return"Cura";default:return e}},m=e=>{let t=e.text;if(t.includes("causou")&&t.includes("de dano")){const e=t.match(/(\d+)\s+de dano/);if(e){const s=e[1];t=t.replace(`${s} de dano`,`**${s}** de dano`)}}if(t.includes("recuperou")&&t.includes("HP")){const e=t.match(/(\d+)\s+HP/);if(e){const s=e[1];t=t.replace(`${s} HP`,`**${s}** HP`)}}return t};return t.jsxs(fu,{className:"mt-6",children:[t.jsxs(gu,{className:"pb-2 flex flex-row items-center justify-between",children:[t.jsxs(bu,{className:"text-lg flex items-center gap-2",children:[t.jsx(Ot,{className:"h-5 w-5"}),"Log de Batalha"]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsxs("span",{className:"text-sm text-muted-foreground",children:[o.length,"/",s.length]}),t.jsxs(Mg,{children:[t.jsx(Tg,{asChild:!0,children:t.jsx(Ws,{variant:"outline",size:"sm",className:"h-8 w-8 p-0",children:t.jsx(Nt,{className:"h-4 w-4"})})}),t.jsx(qg,{className:"w-80",align:"end",children:t.jsxs("div",{className:"space-y-3",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("h4",{className:"font-medium",children:"Filtros do Log"}),t.jsxs("div",{className:"flex gap-1",children:[t.jsxs(Ws,{variant:"ghost",size:"sm",onClick:()=>i(!0),className:"h-6 px-2 text-xs",children:[t.jsx(ht,{className:"h-3 w-3 mr-1"}),"Todos"]}),t.jsxs(Ws,{variant:"ghost",size:"sm",onClick:()=>i(!1),className:"h-6 px-2 text-xs",children:[t.jsx(gs,{className:"h-3 w-3 mr-1"}),"Nenhum"]})]})]}),t.jsx("div",{className:"grid grid-cols-2 gap-2",children:Object.entries(r).map((([e,s])=>t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(Kg,{id:e,checked:s,onCheckedChange:t=>((e,t)=>{n((s=>({...s,[e]:t})))})(e,!!t)}),t.jsx("label",{htmlFor:e,className:`text-xs font-medium cursor-pointer ${l(e)}`,children:d(e)})]},e)))})]})})]})]})]}),t.jsx(yu,{children:t.jsx(cp,{ref:a,className:"h-56 rounded border p-3 bg-card/50 backdrop-blur-sm",children:0===o.length?t.jsx("div",{className:"flex items-center justify-center h-full text-muted-foreground",children:t.jsxs("div",{className:"text-center",children:[t.jsx(Ot,{className:"h-8 w-8 mx-auto mb-2 opacity-50"}),t.jsx("p",{className:"text-sm",children:0===s.length?"Nenhum evento ainda":"Nenhum evento corresponde aos filtros"})]})}):t.jsx("div",{className:"space-y-2",children:o.map(((e,s)=>t.jsxs("div",{className:`flex items-start text-sm leading-relaxed ${l(e.type)} transition-all duration-200 hover:bg-muted/20 rounded p-2 -m-2`,children:[c(e.type),t.jsx("span",{className:"flex-1",dangerouslySetInnerHTML:{__html:m(e).replace(/\*\*(.+?)\*\*/g,'<strong class="text-yellow-300">$1</strong>')}}),t.jsx("span",{className:"text-xs text-muted-foreground/60 ml-2 flex-shrink-0",children:(new Date).toLocaleTimeString("pt-BR",{hour:"2-digit",minute:"2-digit",second:"2-digit"})})]},`${s}-${e.text.substring(0,20)}`)))})})})]})}Kg.displayName=Bg.displayName;const Qg=({isVisible:s,isSuccess:a,playerName:r,enemyName:n,onComplete:i})=>{const[o,l]=e.useState(!1),[c,d]=e.useState(0);if(e.useEffect((()=>(l(!0),()=>l(!1))),[]),e.useEffect((()=>{if(!s)return;const e=setInterval((()=>{d((e=>{const t=a?2.5:3.3;return Math.min(e+t,100)}))}),50),t=setTimeout((()=>{i()}),a?3e3:2500);return()=>{clearInterval(e),clearTimeout(t)}}),[s,a,r,n,i]),!o||!s)return null;const m=a?{emoji:"🏃‍♂️",title:"Fuga Bem-Sucedida!",subtitle:"Redirecionando para o hub...",description:n?`${r} conseguiu fugir de ${n}!`:`${r} conseguiu escapar!`,bgColor:"bg-gradient-to-r from-green-500/20 via-emerald-500/20 to-teal-500/20",borderColor:"border-green-500/30",textColor:"text-green-400",accentColor:"border-green-400"}:{emoji:"⚔️",title:"Fuga Falhou!",subtitle:"Prepare-se para o contra-ataque...",description:n?`${n} impediu a fuga de ${r}!`:`O inimigo impediu a fuga de ${r}!`,bgColor:"bg-gradient-to-r from-red-500/20 via-orange-500/20 to-yellow-500/20",borderColor:"border-red-500/30",textColor:"text-red-400",accentColor:"border-red-400"};return t.jsxs("div",{className:"fixed inset-0 backdrop-blur-md z-50 flex items-center justify-center",children:[t.jsx("div",{className:"absolute inset-0 bg-black/40"}),t.jsxs("div",{className:`relative ${m.bgColor} border ${m.borderColor} rounded-2xl p-8 shadow-2xl max-w-md mx-4 transform transition-all duration-500 animate-in zoom-in-95 fade-in-0`,children:[t.jsxs("div",{className:"text-center space-y-4",children:[t.jsx("div",{className:`text-6xl ${a?"animate-bounce":"animate-pulse"} transition-all duration-300`,children:m.emoji}),t.jsx("div",{className:`font-bold text-2xl ${m.textColor}`,children:m.title}),t.jsx("div",{className:"text-muted-foreground text-base",children:m.subtitle}),t.jsx("div",{className:"w-full bg-background/30 rounded-full h-2 overflow-hidden",children:t.jsx("div",{className:"h-full transition-all duration-150 ease-out "+(a?"bg-green-400":"bg-red-400"),style:{width:`${c}%`}})}),t.jsx("div",{className:"text-sm text-muted-foreground/90 leading-relaxed px-2",children:m.description}),t.jsxs("div",{className:"flex items-center justify-center gap-3 pt-2",children:[t.jsx("div",{className:`animate-spin rounded-full h-5 w-5 border-2 border-t-transparent ${m.accentColor}`}),t.jsx("span",{className:`text-sm font-medium ${m.textColor}`,children:a?"Redirecionando...":"Retornando..."})]})]}),t.jsx("div",{className:`absolute inset-0 rounded-2xl border-2 ${m.borderColor} animate-pulse pointer-events-none`})]})]})};class Zg{static async initializeBattle(e,t){try{const a=e;if(!a)throw new Error("Nenhum personagem deve ser fornecido para inicializar batalha");t?.({step:"character",progress:25,message:"Carregando personagem..."});const r=await Ah.getCharacterForGame(a.id,!0,!0);if(!r.success||!r.data)throw new Error(r.error||"Falha ao carregar personagem");const n=r.data;if(!n||!n.id)throw new Error("Dados do personagem inválidos ou incompletos");if(n.floor<=0){n.floor=1;try{await Ah.updateCharacterFloor(n.id,1)}catch(s){}}t?.({step:"floor",progress:50,message:`Carregando andar ${n.floor}...`});const i=await Uf.getFloorData(n.floor);if(!i)throw new Error(`Falha ao carregar andar ${n.floor}`);t?.({step:"enemy",progress:85,message:"Carregando inimigo..."});const o=await $f.getEnemyForFloor(n.floor,!0);if(!o.success||!o.data){const e=o.error||`Falha ao carregar monstro para andar ${n.floor}`;throw new Error(e)}const l=o.data;if(!l||!l.id)throw new Error("Falha crítica: Inimigo não pôde ser gerado");t?.({step:"complete",progress:100,message:"Batalha pronta!"});const c={mode:"battle",player:{...n,isPlayerTurn:!0,isDefending:!1,potionUsedThisTurn:!1,defenseCooldown:Math.max(0,(n.defenseCooldown||0)-1)},currentFloor:i,currentEnemy:l,isPlayerTurn:!0,gameMessage:`Andar ${i.floorNumber}: ${l.name} apareceu!`,highestFloor:Math.max(n.floor,i.floorNumber),selectedSpell:null,battleRewards:null,fleeSuccessful:!1,characterDeleted:!1},{SpellService:m}=await d((async()=>{const{SpellService:e}=await Promise.resolve().then((()=>Sh));return{SpellService:e}}),void 0);return{success:!0,gameState:m.resetSpellCooldowns(c)}}catch(a){return{success:!1,error:a instanceof Error?a.message:"Erro desconhecido"}}}static async healthCheck(){const e=[],t={};try{try{await $f.getEnemyForFloor(1),t.monster=!0}catch{t.monster=!1,e.push("MonsterService indisponível")}try{await Uf.getFloorData(1),t.floor=!0}catch{t.floor=!1,e.push("FloorService indisponível")}try{await Ah.getUserCharacters("test-health-check"),t.character=!0}catch{t.character=!1,e.push("CharacterService indisponível")}return{healthy:0===e.length,issues:e,services:t}}catch{return{healthy:!1,issues:["Falha crítica no health check"],services:{}}}}}const eb=e=>{switch(e.effect_type){case"damage":return t.jsx(Xt,{className:"w-3 h-3"});case"heal":return t.jsx(ae,{className:"w-3 h-3"});case"buff":return t.jsx(ut,{className:"w-3 h-3"});case"debuff":return t.jsx(Yt,{className:"w-3 h-3"});default:return t.jsx(re,{className:"w-3 h-3"})}},tb=e=>{switch(e.effect_type){case"damage":return"bg-red-500/20 hover:bg-red-500/30 border-red-500/50";case"heal":return"bg-green-500/20 hover:bg-green-500/30 border-green-500/50";case"buff":return"bg-blue-500/20 hover:bg-blue-500/30 border-blue-500/50";case"debuff":return"bg-purple-500/20 hover:bg-purple-500/30 border-purple-500/50";default:return"bg-slate-500/20 hover:bg-slate-500/30 border-slate-500/50"}};function sb({handleAction:e,isPlayerTurn:s,loading:a,player:r,potionSlots:n,loadingPotionSlots:i}){if(!r)return t.jsxs("div",{className:"quick-action-panel flex flex-col gap-1 p-2 bg-slate-900/40 rounded-lg border border-slate-700/50 w-16 shadow-lg",children:[t.jsx("div",{className:"w-12 h-12 bg-muted/20 rounded-lg animate-pulse"}),t.jsx("div",{className:"w-12 h-12 bg-muted/20 rounded-lg animate-pulse"}),t.jsx("div",{className:"w-12 h-12 bg-muted/20 rounded-lg animate-pulse"})]});const o=r.spells?.slice(0,3)||[],l=!s||a.performAction;return t.jsxs("div",{className:"quick-action-panel flex flex-col gap-1 p-2 bg-slate-900/40 rounded-lg border border-slate-700/50 w-16 shadow-lg",children:[t.jsxs("div",{className:"flex flex-col gap-1",children:[t.jsxs("div",{className:"relative",children:[t.jsx(Ws,{variant:"outline",size:"sm",onClick:()=>e("attack"),disabled:l,className:"quick-action-button w-12 h-12 p-0 bg-red-500/20 hover:bg-red-500/30 border-red-500/50 text-red-400 transition-all duration-150 cursor-pointer",title:"Atacar (A)",children:t.jsx(se,{className:"w-4 h-4"})}),t.jsx("span",{className:"absolute -top-1 -left-1 bg-slate-800 text-white text-xs rounded-full w-4 h-4 flex items-center justify-center border border-slate-600",children:"A"})]}),t.jsxs("div",{className:"relative",children:[t.jsxs(Ws,{variant:"outline",size:"sm",onClick:()=>e("defend"),disabled:l||(r?.defenseCooldown||0)>0,className:"quick-action-button w-12 h-12 p-0 bg-blue-500/20 hover:bg-blue-500/30 border-blue-500/50 text-blue-400 transition-all duration-150 relative cursor-pointer "+((r?.defenseCooldown||0)>0?"opacity-50":""),title:"Defender (S)"+((r?.defenseCooldown||0)>0?` - Cooldown: ${r?.defenseCooldown}`:""),children:[t.jsx(De,{className:"w-4 h-4"}),(r?.defenseCooldown||0)>0&&t.jsx("span",{className:"absolute -top-1 -right-1 bg-blue-600 text-white text-xs rounded-full w-4 h-4 flex items-center justify-center",children:r?.defenseCooldown})]}),t.jsx("span",{className:"absolute -top-1 -left-1 bg-slate-800 text-white text-xs rounded-full w-4 h-4 flex items-center justify-center border border-slate-600",children:"S"})]}),t.jsxs("div",{className:"relative",children:[t.jsx(Ws,{variant:"outline",size:"sm",onClick:()=>e("flee"),disabled:l,className:"quick-action-button w-12 h-12 p-0 bg-yellow-500/20 hover:bg-yellow-500/30 border-yellow-500/50 text-yellow-400 transition-all duration-150 cursor-pointer",title:"Fugir (D)",children:t.jsx(Me,{className:"w-4 h-4"})}),t.jsx("span",{className:"absolute -top-1 -left-1 bg-slate-800 text-white text-xs rounded-full w-4 h-4 flex items-center justify-center border border-slate-600",children:"D"})]})]}),t.jsx("div",{className:"h-px bg-slate-700/50 my-1"}),t.jsx("div",{className:"flex flex-col gap-1",children:o.map(((s,a)=>{const n=(r?.mana||0)>=s.mana_cost&&0===s.current_cooldown;return t.jsxs("div",{className:"relative",children:[t.jsxs(Ws,{variant:"outline",size:"sm",onClick:()=>e("spell",s.id),disabled:l||!n,className:`quick-action-button w-12 h-12 p-0 ${tb(s)} relative transition-all duration-150 cursor-pointer ${n?"":"opacity-50"}`,title:`${s.name} (${1+a}) - ${s.mana_cost} Mana${s.current_cooldown>0?` - Cooldown: ${s.current_cooldown}`:(r?.mana||0)<s.mana_cost?" - Mana insuficiente":""}`,children:[eb(s),s.current_cooldown>0&&t.jsx("span",{className:"absolute -top-1 -right-1 bg-red-600 text-white text-xs rounded-full w-4 h-4 flex items-center justify-center",children:s.current_cooldown}),t.jsx("span",{className:"absolute -bottom-1 -right-1 text-white text-xs rounded-full w-4 h-4 flex items-center justify-center "+((r?.mana||0)>=s.mana_cost?"bg-blue-600":"bg-red-600"),children:s.mana_cost})]}),t.jsx("span",{className:"absolute -top-1 -left-1 bg-slate-800 text-white text-xs rounded-full w-4 h-4 flex items-center justify-center border border-slate-600",children:1+a})]},s.id)}))}),n.length>0&&t.jsx("div",{className:"h-px bg-slate-700/50 my-1"}),t.jsx("div",{className:"flex flex-col gap-1",children:i?[1,2,3].map((e=>t.jsx("div",{className:"w-12 h-12 bg-muted/20 rounded-lg animate-pulse"},e))):n.map((s=>{const a=!s.consumable_id,n=(e=>{switch(e){case 1:return"Q";case 2:return"W";case 3:return"E";default:return""}})(s.slot_position),i=s.available_quantity,o=!a&&0===i;return t.jsxs("div",{className:"relative",children:[t.jsxs(Ws,{variant:"outline",size:"sm",onClick:()=>e("consumable",s.consumable_id||void 0),disabled:l||r?.potionUsedThisTurn||a||o,className:"quick-action-button w-12 h-12 p-2 relative transition-all duration-150 cursor-pointer "+(a?"border-dashed border-muted-foreground/20 bg-transparent hover:bg-muted/10":o?"border-red-500/30 bg-red-500/5 opacity-50":r.potionUsedThisTurn?"border-orange-500/30 bg-orange-500/5 opacity-50":"border-green-500/30 bg-green-500/20 hover:bg-green-500/30 text-green-400"),title:a?`Slot ${n} - Vazio`:o?`${s.consumable_name} - Sem unidades`:`${s.consumable_name} (${n}) - ${s.effect_value} HP${r?.potionUsedThisTurn?" - Já usou poção neste turno":""}`,children:[a?t.jsx(We,{className:"w-4 h-4 text-muted-foreground/40"}):s.consumable_id?t.jsx(lf,{consumable:{id:s.consumable_id,name:s.consumable_name||"Poção",description:s.consumable_description||"",type:s.consumable_type||"potion",effect_value:s.effect_value||0,price:s.consumable_price||0,level_requirement:1,created_at:"",updated_at:""},size:"lg",className:"w-4 h-4",showFallback:!0}):null,(r?.potionUsedThisTurn||o)&&!a&&t.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-orange-500/30 rounded-lg",children:t.jsx("span",{className:"text-orange-400 text-xs font-bold",children:"✗"})})]}),!a&&t.jsx("span",{className:"absolute -bottom-1 -left-1 text-white text-xs rounded-full w-4 h-4 flex items-center justify-center border border-background "+(o?"bg-red-500/90":"bg-slate-800"),children:i}),t.jsx("span",{className:"absolute -top-1 -left-1 bg-slate-800 text-white text-xs rounded-full w-4 h-4 flex items-center justify-center border border-slate-600",children:n})]},`slot-${s.slot_position}`)}))})]})}const ab=({isOpen:s,onClose:a,character:r,onAttributesUpdated:n})=>{const[i,o]=e.useState({strength:0,dexterity:0,intelligence:0,wisdom:0,vitality:0,luck:0}),[l,c]=e.useState(!1),d=Sf(),m=Object.values(i).reduce(((e,t)=>e+t),0),u=(r?.attribute_points||0)-m,h=()=>{o({strength:0,dexterity:0,intelligence:0,wisdom:0,vitality:0,luck:0})},p={strength:{label:"Força",icon:Ie,color:"text-red-400",bgColor:"bg-red-500/10",borderColor:"border-red-500/20",benefit:"+2 Ataque + 0.5% Dano Crítico"},dexterity:{label:"Destreza",icon:re,color:"text-green-400",bgColor:"bg-green-500/10",borderColor:"border-green-500/20",benefit:"+1.5 Velocidade + 0.3% Crítico"},intelligence:{label:"Inteligência",icon:ut,color:"text-purple-400",bgColor:"bg-purple-500/10",borderColor:"border-purple-500/20",benefit:"+5 Mana + 10% Dano Mágico"},wisdom:{label:"Sabedoria",icon:ht,color:"text-blue-400",bgColor:"bg-blue-500/10",borderColor:"border-blue-500/20",benefit:"+1 Def + 5% Magia + 12% Cura"},vitality:{label:"Vitalidade",icon:ae,color:"text-pink-400",bgColor:"bg-pink-500/10",borderColor:"border-pink-500/20",benefit:"+8 HP + 1 Defesa"},luck:{label:"Sorte",icon:pt,color:"text-yellow-400",bgColor:"bg-yellow-500/10",borderColor:"border-yellow-500/20",benefit:"+0.5% Crítico + 1% Dano Crítico"}};return s&&r&&r.attribute_points&&0!==r.attribute_points?t.jsx(Ph,{open:s,onOpenChange:a,children:t.jsxs(qh,{className:"overflow-hidden "+(d?"max-w-[95vw] max-h-[95vh] w-[95vw] p-3":"sm:max-w-2xl max-h-[90vh] overflow-y-auto"),children:[t.jsxs(Dh,{className:""+(d?"pb-2":"text-center"),children:[!d&&t.jsx(Zm.div,{initial:{scale:0},animate:{scale:1},transition:{type:"spring",duration:.5},className:"mx-auto w-16 h-16 bg-yellow-500/20 rounded-full flex items-center justify-center mb-4",children:t.jsx(pt,{className:"h-8 w-8 text-yellow-500"})}),t.jsxs(Zm.div,{initial:{y:20,opacity:0},animate:{y:0,opacity:1},transition:{delay:.3},className:"flex items-center gap-3 "+(d?"justify-start":"flex-col text-center"),children:[d&&t.jsx(Zm.div,{initial:{scale:0},animate:{scale:1},transition:{type:"spring",duration:.5},className:"w-10 h-10 bg-yellow-500/20 rounded-full flex items-center justify-center flex-shrink-0",children:t.jsx(pt,{className:"h-5 w-5 text-yellow-500"})}),t.jsxs("div",{className:d?"text-left flex-1":"text-center",children:[t.jsx(Lh,{className:"font-bold "+(d?"text-lg":"text-xl"),children:"Distribuir Pontos de Atributo"}),t.jsx($h,{asChild:!0,children:t.jsxs("div",{className:""+(d?"flex items-center justify-between mt-1":"text-center space-y-3"),children:[t.jsxs(_u,{variant:"outline",className:"bg-yellow-500/10 border-yellow-500/30 text-yellow-400 "+(d?"px-2 py-1 text-xs":"px-3 py-1"),children:[t.jsx(pt,{className:"mr-2 "+(d?"h-3 w-3":"h-4 w-4")}),u," pontos"]}),!d&&t.jsx("p",{className:"text-sm text-muted-foreground",children:"Distribua seus pontos estrategicamente para fortalecer seu personagem na torre."})]})})]})]})]}),t.jsx("div",{className:""+(d?"overflow-y-auto max-h-[calc(95vh-120px)]":""),children:t.jsxs(Zm.div,{className:""+(d?"py-2":"space-y-4 py-4"),initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.3},children:[t.jsx("div",{className:""+(d?"grid grid-cols-2 gap-2 mb-3":"space-y-3"),children:Object.entries(p).map((([e,s])=>{const a=e,n=r?.[a]||0,l=s.icon;return t.jsxs(Zm.div,{className:`flex items-center gap-2 rounded-lg border ${s.bgColor} ${s.borderColor} ${d?"p-2 text-xs":"gap-3 p-3"}`,whileHover:{scale:1.01},children:[t.jsxs("div",{className:"flex items-center gap-2 flex-1 "+(d?"min-w-0":"gap-3"),children:[t.jsx(l,{className:`flex-shrink-0 ${s.color} ${d?"h-4 w-4":"h-5 w-5"}`}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsx("div",{className:"font-semibold "+(d?"text-xs truncate":"text-sm"),children:s.label}),!d&&t.jsx("div",{className:"text-xs text-muted-foreground",children:s.benefit})]})]}),t.jsx("div",{className:"text-center "+(d?"min-w-[40px]":"min-w-[60px]"),children:t.jsxs("div",{className:"font-bold "+(d?"text-xs":"text-sm"),children:[n,i[a]>0&&t.jsxs("span",{className:"text-green-400 ml-1",children:["+",i[a]]})]})}),t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(Ws,{size:"icon",variant:"ghost",className:"rounded-full "+(d?"h-6 w-6":"h-8 w-8"),onClick:()=>(e=>{i[e]>0&&o((t=>({...t,[e]:t[e]-1})))})(a),disabled:0===i[a],children:t.jsx(jt,{className:d?"h-3 w-3":"h-4 w-4"})}),t.jsx("div",{className:"text-center font-mono "+(d?"w-6 text-xs":"w-8 text-sm"),children:i[a]}),t.jsx(Ws,{size:"icon",variant:"ghost",className:"rounded-full "+(d?"h-6 w-6":"h-8 w-8"),onClick:()=>(e=>{u>0&&o((t=>({...t,[e]:t[e]+1})))})(a),disabled:0===u,children:t.jsx(We,{className:d?"h-3 w-3":"h-4 w-4"})})]})]},a)}))}),m>0&&t.jsxs(Zm.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},className:"bg-primary/5 border border-primary/20 rounded-lg "+(d?"p-2 mt-2":"p-3"),children:[t.jsxs("div",{className:"font-medium mb-2 flex items-center gap-2 "+(d?"text-xs":"text-sm"),children:[t.jsx(ft,{className:"text-primary "+(d?"h-3 w-3":"h-4 w-4")}),"Preview dos Melhoramentos"]}),t.jsxs("div",{className:"grid gap-1 "+(d?"grid-cols-4 text-xs":"grid-cols-2 gap-2 text-xs"),children:[i.vitality>0&&t.jsxs("div",{className:"flex justify-between",children:[t.jsx("span",{children:"HP:"}),t.jsxs("span",{className:"text-green-400",children:["+",8*i.vitality]})]}),i.intelligence>0&&t.jsxs("div",{className:"flex justify-between",children:[t.jsx("span",{children:"Mana:"}),t.jsxs("span",{className:"text-blue-400",children:["+",5*i.intelligence]})]}),i.strength>0&&t.jsxs("div",{className:"flex justify-between",children:[t.jsx("span",{children:"Ataque:"}),t.jsxs("span",{className:"text-red-400",children:["+",2*i.strength]})]}),i.dexterity>0&&t.jsxs("div",{className:"flex justify-between",children:[t.jsx("span",{children:"Velocidade:"}),t.jsxs("span",{className:"text-green-400",children:["+",Math.floor(1.5*i.dexterity)]})]})]})]})]})}),t.jsxs("div",{className:"flex gap-2 pt-2",children:[t.jsx(Ws,{variant:"outline",onClick:a,className:"flex-1 "+(d?"text-xs h-8":""),children:"Cancelar"}),m>0&&t.jsxs(Ws,{variant:"outline",onClick:h,className:"flex-1 "+(d?"text-xs h-8":""),children:[t.jsx(It,{className:"mr-1 "+(d?"h-3 w-3":"h-4 w-4 mr-2")}),d?"Reset":"Resetar"]}),t.jsxs(Ws,{onClick:async()=>{if(0!==m&&r){c(!0);try{const e=await Ah.distributeAttributePoints(r.id,i);if(e.success&&e.data?.new_stats){if(j.success("Pontos distribuídos com sucesso!"),n){const t={...r,...e.data.new_stats,attribute_points:e.data.new_stats.attribute_points};n(t)}h(),a()}else j.error("Erro ao distribuir pontos",{description:e.error||e.data?.message})}catch(e){j.error("Erro ao distribuir pontos")}finally{c(!1)}}},disabled:l||0===m,className:"flex-1 bg-emerald-500 hover:bg-emerald-600 "+(d?"text-xs h-8":""),children:[l?t.jsx("div",{className:"animate-spin rounded-full border-2 border-white border-t-transparent mr-1 "+(d?"h-3 w-3":"h-4 w-4 mr-2")}):t.jsx(Ft,{className:"mr-1 "+(d?"h-3 w-3":"h-4 w-4 mr-2")}),d?`OK (${m})`:`Confirmar (${m})`]})]})]})}):null};function rb({isOpen:e,onClose:s,gameLogs:a}){return t.jsx(Ph,{open:e,onOpenChange:s,children:t.jsxs(qh,{className:"max-w-2xl max-h-[80vh] flex flex-col",children:[t.jsx(Dh,{className:"flex-shrink-0",children:t.jsxs(Lh,{className:"flex items-center gap-2",children:["💬 Log de Batalha",t.jsxs("span",{className:"text-sm text-muted-foreground",children:["(",a.length," evento",1!==a.length?"s":"",")"]})]})}),t.jsx("div",{className:"flex-1 overflow-auto min-h-0",children:t.jsx(Jg,{gameLog:a})})]})})}function nb(){e.useRef(0).current+=1;const s=n(),{user:a}=Vs(),r=xx((e=>e.gameState.player)),i=xx((e=>e.gameState.currentEnemy)),o=xx((e=>e.gameState.currentFloor)),l=xx((e=>e.gameState.isPlayerTurn)),c=xx((e=>e.gameState.mode)),u=xx((e=>e.gameState.battleRewards)),h=xx((e=>e.gameState.characterDeleted)),p=xx((e=>e.gameState.fleeSuccessful)),x=xx((e=>e.loading)),f=jx((e=>e.gameLogs)),g=jx((e=>e.addGameLogMessage)),b=Wf((e=>e.performAction)),v=xx((e=>e.updatePlayerStats)),{character:y}=m({from:"/_authenticated/game/play/hub/battle/$character"}),{canInitialize:N,markAsInitialized:w}=function(t){const s=e.useRef({initialized:new Set,lastCharacterId:null,canInitialize:!0});t&&s.current.lastCharacterId!==t&&(s.current.lastCharacterId=t,s.current.canInitialize=!s.current.initialized.has(t));const a=e.useCallback((()=>{t&&(s.current.initialized.add(t),s.current.canInitialize=!1)}),[t]);return{canInitialize:!!t&&s.current.canInitialize,markAsInitialized:a}}(y),{initializeBattle:_,isLoading:C,error:S,progress:E,isInitialized:k}=function(t,s,a){const r=e.useRef({isInitialized:!1,isInitializing:!1,lastCharacterId:null,hasError:!1,errorMessage:null}),n=e.useRef(a);n.current=a;const i=e.useRef(xx.getState().setGameState);i.current=xx.getState().setGameState;const[o,l]=e.useState(!1),[c,m]=e.useState(null);return{initializeBattle:e.useCallback((async()=>{const e=r.current;if(t&&s){if(e.isInitialized&&e.lastCharacterId===t)l(!1);else if(!e.isInitializing)try{e.isInitializing=!0,e.lastCharacterId=t,l(!0),m(null);const s=await Ah.getCharacter(t);if(!s.success||!s.data)throw new Error(s.error||"Personagem não encontrado");const{LoggingUtils:a}=await d((async()=>{const{LoggingUtils:e}=await import("./logging-utils-BzLicWhP.js");return{LoggingUtils:e}}),__vite__mapDeps([6,1,2,3,5,4]));a.clearAllLogs();const r=await Zg.initializeBattle(s.data);if(!r.success)throw new Error(r.error||"Falha na inicialização da batalha");if(!r.gameState)throw new Error("gameState não foi retornado pelo BattleInitializationService");i.current(r.gameState),e.isInitialized=!0,e.hasError=!1,e.errorMessage=null,n.current&&n.current()}catch(a){e.hasError=!0,e.errorMessage=a instanceof Error?a.message:"Erro desconhecido",m(e.errorMessage)}finally{e.isInitializing=!1,l(!1)}}else l(!1)}),[t,s]),isLoading:o,error:c,isInitialized:r.current.isInitialized,progress:{step:"ready",progress:100,message:"Pronto"}}}(y,a?.id,w),A=e.useRef(_);A.current=_;const{potionSlots:P,loadingSlots:M,loadPotionSlots:T,reloadSlots:q}=function(t){const[s,a]=e.useState([]),[r,n]=e.useState(!1),i=e.useRef(!1),o=e.useRef(void 0);i.current=r,o.current=t;const l=e.useCallback((async()=>{const e=o.current,t=i.current;if(e&&!t)try{n(!0);const{SlotService:t}=await d((async()=>{const{SlotService:e}=await Promise.resolve().then((()=>pf));return{SlotService:e}}),void 0),s=await t.getCharacterPotionSlots(e);s.success&&s.data?a(s.data):a([{slot_position:1,consumable_id:null,consumable_name:null,consumable_description:null,effect_value:null,consumable_type:null,available_quantity:0,consumable_price:null},{slot_position:2,consumable_id:null,consumable_name:null,consumable_description:null,effect_value:null,consumable_type:null,available_quantity:0,consumable_price:null},{slot_position:3,consumable_id:null,consumable_name:null,consumable_description:null,effect_value:null,consumable_type:null,available_quantity:0,consumable_price:null}])}catch{a([{slot_position:1,consumable_id:null,consumable_name:null,consumable_description:null,effect_value:null,consumable_type:null,available_quantity:0,consumable_price:null},{slot_position:2,consumable_id:null,consumable_name:null,consumable_description:null,effect_value:null,consumable_type:null,available_quantity:0,consumable_price:null},{slot_position:3,consumable_id:null,consumable_name:null,consumable_description:null,effect_value:null,consumable_type:null,available_quantity:0,consumable_price:null}])}finally{n(!1)}}),[]),c=e.useCallback((async()=>{const e=o.current;if(e){const{SlotService:t}=await d((async()=>{const{SlotService:e}=await Promise.resolve().then((()=>pf));return{SlotService:e}}),void 0);t.invalidateCache(e),await l()}}),[l]);return{potionSlots:s,loadingSlots:r,loadPotionSlots:l,reloadSlots:c}}(r?.id);e.useEffect((()=>{S&&S.includes("Dados do banco inválidos")?(j.error("Erro ao carregar inimigo",{description:"Retornando ao hub. Por favor, tente novamente."}),s({to:"/game/play/hub",search:{character:y}})):S&&S.includes("Falha ao")&&(j.error("Erro ao inicializar batalha",{description:"Retornando ao hub."}),s({to:"/game/play/hub",search:{character:y}}))}),[S,s,y]);const D=e.useRef(!0);e.useEffect((()=>(D.current=!0,()=>{D.current=!1})),[]),e.useEffect((()=>{r?.id&&T().catch((e=>{}))}),[r?.id,T]);const[R,L]=e.useState(!1),[$,I]=e.useState(!1),[F,V]=e.useState(!1),[O,B]=e.useState(!1),[U,z]=e.useState(!1),[G,H]=e.useState(!1),[,X]=e.useState(!1),[W,Y]=e.useState(!1),K=Ef(),[J,Q]=e.useState({xp:0,gold:0,drops:[],leveledUp:!1,newLevel:0}),Z=e.useRef(null);e.useEffect((()=>{if(D.current=!0,y&&a?.id&&!Z.current&&N)return Z.current=setTimeout((()=>{D.current&&y&&a?.id&&A.current&&A.current().catch((e=>{})),Z.current=null}),200),()=>{D.current=!1,Z.current&&(clearTimeout(Z.current),Z.current=null)}}),[y,a?.id,N]);const ee=e.useMemo((()=>({enemyHpPercentage:i&&i.maxHp>0?Math.max(0,Math.min(100,i.hp/i.maxHp*100)):0,playerHpPercentage:r?.max_hp&&r.max_hp>0?Math.max(0,Math.min(100,r.hp/r.max_hp*100)):0,playerManaPercentage:r?.max_mana&&r.max_mana>0?Math.max(0,Math.min(100,r.mana/r.max_mana*100)):0})),[i?.hp,i?.maxHp,r?.hp,r?.max_hp,r?.mana,r?.max_mana]),te=e.useMemo((()=>({floorNumber:r?.floor||1,type:o?.type||"common",description:o?.description||`Andar ${r?.floor||1}`,isCheckpoint:o?.isCheckpoint||!1,minLevel:o?.minLevel||1})),[r?.floor,o?.type,o?.description,o?.isCheckpoint,o?.minLevel]),se=e.useMemo((()=>({id:"placeholder",name:u?"Inimigo derrotado!":"Preparando próximo inimigo...",level:1,hp:0,maxHp:1,attack:0,defense:0,speed:1,image:u?"💀":"⏳",behavior:"balanced",mana:0,reward_xp:0,reward_gold:0,possible_drops:[],active_effects:{buffs:[],debuffs:[],dots:[],hots:[],attribute_modifications:[]}})),[u]),ae=e.useMemo((()=>({id:r?.id||"",name:r?.name||"",level:r?.level||1,floor:r?.floor||1,hp:r?.hp||0,max_hp:r?.max_hp||1,xp:r?.xp||0,gold:r?.gold||0})),[r?.id,r?.name,r?.level,r?.floor,r?.hp,r?.max_hp,r?.xp,r?.gold]);e.useEffect((()=>{const e=u?.xp||0,t=u?.gold||0,s=u?.leveledUp||!1,a=u?.newLevel||0;(e||t)&&(R||(Q({xp:e,gold:t,drops:u?.drops||[],leveledUp:s,newLevel:a}),L(!0),g(`Vitória! Você derrotou o inimigo e recebeu ${e} XP e ${t} Gold.`,"system"),s&&a&&g(`Você subiu para o nível ${a}!`,"system")))}),[u?.xp,u?.gold,u?.leveledUp,u?.newLevel]),e.useEffect((()=>{"gameover"===c&&void 0!==r?.hp&&r.hp<=0&&!$&&(I(!0),h&&r?.name&&g(`${r.name} foi perdido permanentemente. O sistema de Permadeath está ativo.`,"system"))}),[c,r?.hp,r?.name,h]),e.useEffect((()=>{if(("fled"===c||!0===p)&&!O){z("fled"===c||!0===p),B(!0)}}),[c,p]),e.useEffect((()=>{const e=()=>{const e=window.innerWidth<=768,t=window.innerHeight>window.innerWidth;H(e&&t)};e();const t=()=>e(),s=()=>e();return window.addEventListener("resize",t),window.addEventListener("orientationchange",s),()=>{window.removeEventListener("resize",t),window.removeEventListener("orientationchange",s)}}),[]),e.useEffect((()=>{const e=()=>V(!0);return window.addEventListener("openAttributeModal",e),()=>window.removeEventListener("openAttributeModal",e)}),[]);const re=e.useCallback((async(e,t,s)=>{try{await b(e,t,s)}catch(a){j.error(`Erro ao executar ação: ${e}`)}}),[]),ne=e.useCallback(((e,t)=>{v(e,t);const s=xx.getState().gameState.player;s?.id&&Ah.updateCharacterHpMana(s.id,e,t).then((e=>{e.success||j.error("Erro ao atualizar status do personagem")})).catch((e=>{j.error("Erro ao atualizar status do personagem")}))}),[v]),ie=e.useCallback((e=>{const t={...xx.getState().gameState,player:e};xx.getState().setGameState(t)}),[r?.attribute_points]),oe=e.useCallback((async()=>{L(!1);try{const e=xx.getState().gameState.player;e?.id&&u&&Ah.invalidateCharacterCache(e.id),await re("continue")}catch(e){j.error("Erro ao avançar para o próximo andar"),L(!0)}}),[re,u]),le=e.useCallback((async()=>{const e=xx.getState().gameState.player;if(e?.id){const{BattleLoggerService:t}=await d((async()=>{const{BattleLoggerService:e}=await Promise.resolve().then((()=>Of));return{BattleLoggerService:e}}),void 0);t.endBattle("victory",{reason:"Retorno ao hub",playerName:e.name}),Ah.invalidateCharacterCache(e.id);const{useCharacterStore:a}=await d((async()=>{const{useCharacterStore:e}=await Promise.resolve().then((()=>Ex));return{useCharacterStore:e}}),void 0),r=a.getState();r.selectedCharacterId===e.id&&r.setSelectedCharacter(null),s({to:"/game/play/hub",search:{character:e.id}})}}),[s]),ce=e.useCallback((()=>{s({to:"/game/play"})}),[s]),de=e.useCallback((()=>{V(!0),L(!1)}),[]),me=e.useCallback((async()=>{B(!1);const e=xx.getState().gameState.player;if(U&&e?.id){const{BattleLoggerService:a}=await d((async()=>{const{BattleLoggerService:e}=await Promise.resolve().then((()=>Of));return{BattleLoggerService:e}}),void 0);a.endBattle("flee",{reason:"Fuga bem-sucedida",playerName:e.name}),j.success("Fuga bem-sucedida!",{description:"Retornando ao hub...",duration:2e3});try{const{RankingService:t}=await d((async()=>{const{RankingService:e}=await Promise.resolve().then((()=>nh));return{RankingService:e}}),void 0);await t.saveAliveCharacterToRanking(e.id),await Ah.updateCharacterFloor(e.id,1)}catch(t){}s({to:"/game/play/hub",search:{character:e.id}})}else j.warning("Fuga falhou!",{description:"Prepare-se para o contra-ataque...",duration:3e3})}),[U,s]),ue=e.useCallback((async()=>{X(!1),await _()}),[]),he=e.useCallback((()=>{const e=xx.getState().gameState.player;e?.id&&s({to:"/game/play/hub/cemetery",search:{character:e.id}})}),[s]);return S&&!k?t.jsx("div",{className:"min-h-svh flex flex-col items-center justify-center bg-gradient-to-b from-background to-secondary p-4",children:t.jsxs("div",{className:"text-center "+(K?"max-w-md":"max-w-lg"),children:[t.jsx("div",{className:"text-destructive text-6xl mb-4",children:"⚠️"}),t.jsx("h2",{className:"text-2xl font-bold mb-4",children:"Falha na Inicialização da Batalha"}),t.jsxs("div",{className:"bg-card rounded-lg p-4 mb-6 text-left",children:[t.jsx("h3",{className:"font-semibold mb-2",children:"Detalhes do Erro:"}),t.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:S}),t.jsxs("div",{className:"flex justify-between text-sm",children:[t.jsx("span",{children:"Última etapa:"}),t.jsx("span",{children:E.step})]})]}),t.jsxs("div",{className:"space-y-3",children:[t.jsx(Ws,{onClick:ue,className:"w-full",size:"lg",children:"🔄 Tentar Novamente"}),t.jsx(Ws,{onClick:()=>s({to:"/game/play"}),variant:"secondary",className:"w-full",children:"🏠 Voltar ao Hub"})]})]})}):C||!k&&N?t.jsx("div",{className:"min-h-svh flex flex-col items-center justify-center bg-gradient-to-b from-background to-secondary p-4",children:t.jsxs("div",{className:"text-center "+(K?"max-w-sm":"max-w-md"),children:[t.jsx("div",{className:"inline-block animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-primary mb-4"}),t.jsx("h2",{className:"text-2xl font-bold mb-2",children:"Inicializando Batalha"}),t.jsx("div",{className:"bg-card rounded-lg p-4 mb-4",children:t.jsxs("div",{className:"mb-2",children:[t.jsxs("div",{className:"flex justify-between text-sm mb-1",children:[t.jsx("span",{children:E.message}),t.jsxs("span",{children:[E.progress,"%"]})]}),t.jsx("div",{className:"w-full bg-secondary rounded-full h-2",children:t.jsx("div",{className:"bg-primary h-2 rounded-full transition-all duration-300",style:{width:`${E.progress}%`}})})]})}),t.jsx(Ws,{onClick:()=>s({to:"/game/play"}),variant:"ghost",size:"sm",children:"Cancelar e Voltar"})]})}):k&&"battle"===c&&!i?t.jsx("div",{className:"min-h-svh flex flex-col items-center justify-center bg-gradient-to-b from-background to-secondary p-4",children:t.jsxs("div",{className:"text-center "+(K?"max-w-md":"max-w-lg"),children:[t.jsx("div",{className:"text-destructive text-6xl mb-4",children:"⚠️"}),t.jsx("h2",{className:"text-2xl font-bold mb-4",children:"Erro na Inicialização"}),t.jsxs("div",{className:"bg-card rounded-lg p-4 mb-6 text-left",children:[t.jsx("h3",{className:"font-semibold mb-2",children:"Problema:"}),t.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"A batalha foi inicializada mas nenhum inimigo foi gerado."}),t.jsxs("div",{className:"space-y-2 text-sm",children:[t.jsxs("div",{className:"flex justify-between",children:[t.jsx("span",{children:"Modo:"}),t.jsx("span",{children:c})]}),t.jsxs("div",{className:"flex justify-between",children:[t.jsx("span",{children:"Andar:"}),t.jsx("span",{children:r?.floor||"N/A"})]}),t.jsxs("div",{className:"flex justify-between",children:[t.jsx("span",{children:"Tem inimigo:"}),t.jsx("span",{className:"text-destructive",children:i?"Sim":"Não"})]})]})]}),t.jsxs("div",{className:"space-y-3",children:[t.jsx(Ws,{onClick:ue,className:"w-full",size:"lg",children:"🔄 Reinicializar Batalha"}),t.jsx(Ws,{onClick:()=>{const e=xx.getState().gameState.player;e?.id&&s({to:"/game/play/hub",search:{character:e.id}})},variant:"secondary",className:"w-full",children:"🏠 Voltar ao Hub"})]})]})}):t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"w-full "+(K?"max-w-4xl mr-16 overflow-y-auto":"max-w-6xl"),children:[t.jsx(ig,{currentFloor:te,playerLevel:r?.level||1}),t.jsxs("div",{className:"mb-6 relative "+(K?"h-full flex flex-col":""),children:[!G&&!K&&r&&t.jsx("div",{className:"absolute left-0 top-1/2 transform -translate-y-1/2 -translate-x-20 z-10 hidden lg:block",children:t.jsx(sb,{handleAction:re,isPlayerTurn:l,loading:x,player:r,potionSlots:P,loadingPotionSlots:M})}),!G&&!K&&r&&t.jsx("div",{className:"fixed bottom-4 left-4 z-20 block lg:hidden",children:t.jsx(sb,{handleAction:re,isPlayerTurn:l,loading:x,player:r,potionSlots:P,loadingPotionSlots:M})}),K&&r&&t.jsx("div",{className:"fixed right-2 top-1/2 transform -translate-y-1/2 z-20 flex flex-col justify-center max-h-screen py-4",children:t.jsx("div",{className:"bg-slate-900/95 rounded-xl border border-slate-700/50 shadow-2xl backdrop-blur-sm",children:t.jsx(sb,{handleAction:re,isPlayerTurn:l,loading:x,player:r,potionSlots:P,loadingPotionSlots:M})})}),t.jsx(sg,{player:r,currentEnemy:i||se,playerHpPercentage:ee.playerHpPercentage,playerManaPercentage:ee.playerManaPercentage,enemyHpPercentage:ee.enemyHpPercentage,isPlayerTurn:l,gameLogs:f,onOpenLogModal:()=>Y(!0)})]}),!K&&t.jsx("div",{className:"mb-6",children:t.jsx(ag,{handleAction:re,isPlayerTurn:l,loading:x,player:r,onPlayerStatsUpdate:ne,currentEnemy:i,battleRewards:u,potionSlots:P,loadingPotionSlots:M,onSlotsChange:q})}),t.jsx("div",{className:""+(K?"invisible h-0 overflow-hidden":""),children:t.jsx(Jg,{gameLog:f})})]}),t.jsx(rg,{isOpen:R,onContinue:oe,onReturnToHub:le,onOpenAttributeModal:de,rewards:J,leveledUp:J.leveledUp,newLevel:J.newLevel,hasAttributePoints:(r?.attribute_points||0)>0}),t.jsx(ng,{isOpen:$,onClose:()=>I(!1),player:ae,gameMessage:`${r?.name||"Personagem"} foi derrotado no Andar ${r?.floor||1}...`,highestFloor:r?.floor||1,isCharacterDeleted:h,onReturnToCharacterSelect:ce,onViewCemetery:he}),t.jsx(ab,{isOpen:F,onClose:()=>{V(!1);const e=xx.getState().gameState.player,t=(e?.attribute_points||0)>0;u&&!R&&t&&L(!0)},character:r,onAttributesUpdated:ie}),O&&t.jsx("div",{className:"fixed inset-0 z-50",children:t.jsx(Qg,{isVisible:O,isSuccess:U,playerName:r?.name||"Personagem",enemyName:i?.name,onComplete:me})}),K&&t.jsx(rb,{isOpen:W,onClose:()=>Y(!1),gameLogs:f})]})}const ib=r("/_authenticated/game/play/hub/battle/$character")({component:function(){const s=n(),{character:a}=ib.useParams(),{loading:r}=Nf(),[i,o]=e.useState(!0),l=Ef(),c=e.useRef(!1),d=e.useRef(!1),m=e.useMemo((()=>({isGameLoading:r.loadProgress,shouldShowLoading:i||r.loadProgress})),[r.loadProgress,i]);return e.useEffect((()=>(d.current=!0,()=>{d.current=!1,c.current=!1})),[]),e.useEffect((()=>{if(!d.current)return;const e=m.isGameLoading;if(!e&&i){const e=setTimeout((()=>{d.current&&o(!1)}),100);return()=>clearTimeout(e)}e&&!i&&o(!0)}),[m.isGameLoading,i]),e.useEffect((()=>{d.current&&!c.current&&(a?c.current=!0:(c.current=!0,j.error("Personagem não especificado",{description:"Redirecionando para a seleção de personagens"}),s({to:"/game/play"})))}),[a,s]),m.shouldShowLoading?t.jsx("div",{className:"min-h-screen flex flex-col items-center justify-center bg-gradient-to-b from-background to-secondary p-2 md:p-4",children:t.jsxs("div",{className:"w-full max-w-6xl",children:[t.jsxs("div",{className:"text-center mb-8",children:[t.jsx("div",{className:"h-8 w-64 bg-muted/50 animate-pulse rounded mx-auto mb-4"}),t.jsx("div",{className:"h-4 w-48 bg-muted/30 animate-pulse rounded mx-auto"})]}),t.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6 mb-6",children:[1,2,3].map((e=>t.jsxs("div",{className:"bg-card rounded-lg overflow-hidden shadow animate-pulse",children:[t.jsx("div",{className:"p-4 bg-muted/20",children:t.jsx("div",{className:"h-6 bg-muted/40 rounded w-24 mx-auto"})}),t.jsxs("div",{className:"p-6",children:[t.jsx("div",{className:"aspect-square bg-muted/30 rounded-md mb-4"}),t.jsxs("div",{className:"space-y-3",children:[t.jsx("div",{className:"h-4 bg-muted/40 rounded w-full"}),t.jsx("div",{className:"h-2 bg-muted/30 rounded w-full"}),t.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[t.jsx("div",{className:"h-8 bg-muted/20 rounded"}),t.jsx("div",{className:"h-8 bg-muted/20 rounded"})]})]})]})]},e)))}),t.jsxs("div",{className:"bg-card rounded-lg p-4 animate-pulse",children:[t.jsx("div",{className:"h-6 bg-muted/40 rounded w-32 mx-auto mb-4"}),t.jsxs("div",{className:"flex gap-2 justify-center",children:[t.jsx("div",{className:"h-10 bg-muted/30 rounded w-24"}),t.jsx("div",{className:"h-10 bg-muted/30 rounded w-24"}),t.jsx("div",{className:"h-10 bg-muted/30 rounded w-24"})]})]})]})}):t.jsx("div",{className:"min-h-screen w-full flex flex-col bg-gradient-to-b from-background to-secondary m-0 "+(l?"items-start justify-start pl-4 pr-2 py-2":"items-center justify-center p-2 md:p-4"),children:t.jsx(nb,{})})}}),ob=Fs.update({id:"/_public",getParentRoute:()=>Is}),lb=oa.update({id:"/_authenticated",getParentRoute:()=>Is}),cb=ma.update({id:"/",path:"/",getParentRoute:()=>Is}),db=ua.update({id:"/logout",path:"/logout",getParentRoute:()=>ob}),mb=xa.update({id:"/home",path:"/home",getParentRoute:()=>ob}),ub=tu.update({id:"/auth",path:"/auth",getParentRoute:()=>ob}),hb=Su.update({id:"/users",path:"/users",getParentRoute:()=>lb}),pb=Wu.update({id:"/profile",path:"/profile",getParentRoute:()=>lb}),xb=Ku.update({id:"/game",path:"/game",getParentRoute:()=>lb}),fb=Qu.update({id:"/403",path:"/403",getParentRoute:()=>lb}),gb=Zu.update({id:"/guide/",path:"/guide/",getParentRoute:()=>ob}),bb=ah.update({id:"/verify-email",path:"/verify-email",getParentRoute:()=>ub}),vb=oh.update({id:"/$id",path:"/$id",getParentRoute:()=>hb}),yb=uh.update({id:"/ranking",path:"/ranking",getParentRoute:()=>xb}),jb=ap.update({id:"/play",path:"/play",getParentRoute:()=>xb}),Nb=mp.update({id:"/guide",path:"/guide",getParentRoute:()=>xb}),wb=Fx.update({id:"/hub",path:"/hub",getParentRoute:()=>jb}),_b=Ux.update({id:"/spells",path:"/spells",getParentRoute:()=>wb}),Cb=uf.update({id:"/shop",path:"/shop",getParentRoute:()=>wb}),Sb=gf.update({id:"/inventory",path:"/inventory",getParentRoute:()=>wb}),Eb=yf.update({id:"/equipment",path:"/equipment",getParentRoute:()=>wb}),kb=Cf.update({id:"/crafting",path:"/crafting",getParentRoute:()=>wb}),Ab=Mf.update({id:"/character-stats",path:"/character-stats",getParentRoute:()=>wb}),Pb=Qf.update({id:"/cemetery",path:"/cemetery",getParentRoute:()=>wb}),Mb=Zf.update({id:"/select",path:"/select",getParentRoute:()=>Eb}),Tb=ib.update({id:"/battle/$character",path:"/battle/$character",getParentRoute:()=>wb}),qb={AuthenticatedGamePlayHubEquipmentSelectRoute:Mb},Db={AuthenticatedGamePlayHubCemeteryRoute:Pb,AuthenticatedGamePlayHubCharacterStatsRoute:Ab,AuthenticatedGamePlayHubCraftingRoute:kb,AuthenticatedGamePlayHubEquipmentRoute:Eb._addFileChildren(qb),AuthenticatedGamePlayHubInventoryRoute:Sb,AuthenticatedGamePlayHubShopRoute:Cb,AuthenticatedGamePlayHubSpellsRoute:_b,AuthenticatedGamePlayHubBattleCharacterRoute:Tb},Rb={AuthenticatedGamePlayHubRoute:wb._addFileChildren(Db)},Lb={AuthenticatedGameGuideRoute:Nb,AuthenticatedGamePlayRoute:jb._addFileChildren(Rb),AuthenticatedGameRankingRoute:yb},$b={AuthenticatedUsersIdRoute:vb},Ib={Authenticated403Route:fb,AuthenticatedGameRoute:xb._addFileChildren(Lb),AuthenticatedProfileRoute:pb,AuthenticatedUsersRoute:hb._addFileChildren($b)},Fb=lb._addFileChildren(Ib),Vb={PublicAuthVerifyEmailRoute:bb},Ob={PublicAuthRoute:ub._addFileChildren(Vb),PublicHomeRoute:mb,PublicLogoutRoute:db,PublicGuideIndexRoute:gb},Bb={IndexRoute:cb,AuthenticatedRoute:Fb,PublicRoute:ob._addFileChildren(Ob)},Ub=u({routeTree:Is._addFileChildren(Bb)._addFileTypes()});"serviceWorker"in navigator&&window.addEventListener("load",(()=>{navigator.serviceWorker.register("/sw.js").then((e=>{e.addEventListener("updatefound",(()=>{const t=e.installing;t&&t.addEventListener("statechange",(()=>{"installed"===t.state&&navigator.serviceWorker.controller&&confirm("Nova versão disponível! Deseja atualizar?")&&(t.postMessage({type:"SKIP_WAITING"}),window.location.reload())}))})),setInterval((()=>{e.update()}),3e4)})).catch((e=>{})),navigator.serviceWorker.addEventListener("controllerchange",(()=>{window.location.reload()}))})),bs.createRoot(document.getElementById("root")).render(t.jsx(e.StrictMode,{children:t.jsx(h,{router:Ub})}));export{Ws as B,Ah as C,qa as I,cp as S,fu as a,gu as b,bu as c,yu as d,_u as e,Ch as f,Vf as g,jx as u};
