import{C as a,S as e,g as r,M as t}from"./main-BRzRyVm5.js";import{FloorService as o}from"./floor.service-r0yLIAYT.js";import"./unknown-BjZws6l5.js";import"./unknown-DE60C25c.js";import"./unknown-Chho9maJ.js";import"./unknown-CgHcGUJm.js";import"./unknown-CWUl0966.js";class n{static async loadPlayerForGame(t){try{const o=await a.getCharacterForGame(t);if(!o.success||!o.data)throw new Error(o.error||"Personagem não encontrado");const n=o.data,s=await e.getCharacterEquippedSpells(t),c=s.success&&s.data?s.data:[],l=await r.getCharacterConsumables(t),i=l.success&&l.data?l.data.filter((a=>a.quantity>0)):[];return{...n,spells:c,consumables:i,active_effects:{buffs:[],debuffs:[],dots:[],hots:[],attribute_modifications:[]}}}catch(o){throw o}}static async advanceToNextFloor(e){const{player:r}=e,n=r.floor+1;try{const s=await a.updateCharacterFloor(r.id,n);if(!s.success)throw new Error(s.error||"Erro ao atualizar andar");const c=await o.getFloorData(n);if(!c)throw new Error(`Erro ao carregar andar ${n}`);const l=Math.random()<.01?await o.checkForSpecialEvent(n):null;let i=null;if(!l){const a=await t.getEnemyForFloor(n);if(!a.success||!a.data)throw new Error(`Falha ao gerar inimigo para andar ${n}`);i=a.data}return{...e,mode:l?"special_event":"battle",player:{...r,floor:n,isPlayerTurn:!0,isDefending:!1,potionUsedThisTurn:!1,defenseCooldown:Math.max(0,(r.defenseCooldown||0)-1)},currentFloor:c,currentEnemy:i,currentSpecialEvent:l,gameMessage:l?`Evento especial: ${l.name}!`:`Andar ${n}: ${i?.name} apareceu!`,isPlayerTurn:!0,battleRewards:null,selectedSpell:null,characterDeleted:!1,fleeSuccessful:!1,highestFloor:Math.max(e.highestFloor||0,n)}}catch(s){try{const a=await t.getEnemyForFloor(n);if(a.success&&a.data){const t=a.data,o={floorNumber:n,type:"common",isCheckpoint:n%10==0,minLevel:Math.max(1,Math.floor(n/5)),description:`Andar ${n} - Área Desconhecida`};return{...e,player:{...r,floor:n,isPlayerTurn:!0,isDefending:!1,potionUsedThisTurn:!1},currentFloor:o,currentEnemy:t,currentSpecialEvent:null,gameMessage:`Andar ${n}: ${t.name} apareceu!`,isPlayerTurn:!0,battleRewards:null,mode:"battle",selectedSpell:null}}}catch(c){}return{...e,gameMessage:`Erro ao avançar para andar ${n}. Retorne ao hub.`}}}}export{n as GameStateService};
