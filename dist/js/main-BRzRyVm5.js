const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["js/battle-initialization.service-BghrgNc3.js","js/floor.service-r0yLIAYT.js","js/unknown-BjZws6l5.js","js/unknown-DE60C25c.js","js/unknown-Chho9maJ.js","js/unknown-CgHcGUJm.js","js/unknown-CWUl0966.js","js/reward.service-Auo9OQyl.js","js/game-state.service-BO5lp073.js","js/SpellsPage-BJgbqMWQ.js"])))=>i.map(i=>d[i]);
import{r as e,j as t,_ as s,d as a,O as r,T as n,u as i,e as o,f as l,L as c,g as d,h as m,i as u,c as h,a as p,k as x,l as f,m as g}from"./unknown-BjZws6l5.js";import{c as b,g as v}from"./unknown-DE60C25c.js";import{o as y,s as j,n as N,Z as w,t as _,T as C,a as E,b as S,c as k,u as P,F as A,C as M,d as T,e as R}from"./unknown-Chho9maJ.js";import{c as D,A as q}from"./unknown-CgHcGUJm.js";import{L as $,t as I,c as L,S as V,a as F,G as O,T as z,D as B,O as U,P as H,C as G,b as W,X,d as Y,R as K,e as J,U as Z,f as Q,M as ee,g as te,h as se,i as ae,j as re,k as ne,l as ie,m as oe,I as le,n as ce,o as de,p as me,q as ue,r as he,s as pe,V as xe,u as fe,v as ge,w as be,x as ve,y as ye,z as je,A as Ne,B as we,E as _e,F as Ce,H as Ee,J as Se,W as ke,K as Pe,N as Ae,Q as Me,Y as Te,Z as Re,_ as De,$ as qe,a0 as $e,a1 as Ie,a2 as Le,a3 as Ve,a4 as Fe,a5 as Oe,a6 as ze,a7 as Be,a8 as Ue,a9 as He,aa as Ge,ab as We,ac as Xe,ad as Ye,ae as Ke,af as Je,ag as Ze,ah as Qe,ai as et,aj as tt,ak as st,al as at,am as rt,an as nt,ao as it,ap as ot,aq as lt,ar as ct,as as dt,at as mt,au as ut,av as ht,aw as pt,ax as xt,ay as ft,az as gt,aA as bt,aB as vt,aC as yt,aD as jt,aE as Nt,aF as wt,aG as _t,aH as Ct,aI as Et,aJ as St,aK as kt,aL as Pt,aM as At,aN as Mt,aO as Tt,aP as Rt,aQ as Dt,aR as qt,aS as $t,aT as It,aU as Lt,aV as Vt,aW as Ft,aX as Ot,aY as zt,aZ as Bt,a_ as Ut,a$ as Ht,b0 as Gt,b1 as Wt,b2 as Xt,b3 as Yt,b4 as Kt,b5 as Jt,b6 as Zt,b7 as Qt,b8 as es,b9 as ts,ba as ss,bb as as,bc as rs,bd as ns,be as is,bf as os,bg as ls,bh as cs,bi as ds,bj as ms,bk as us,bl as hs,bm as ps,bn as xs,bo as fs,bp as gs}from"./unknown-CWUl0966.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver((e=>{for(const s of e)if("childList"===s.type)for(const e of s.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)})).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();const bs=v(b()),vs=y({email:j().email("Email inválido"),password:j().min(6,"A senha deve ter pelo menos 6 caracteres")}),ys=y({email:j().email("Email inválido"),password:j().min(6,"A senha deve ter pelo menos 6 caracteres"),confirmPassword:j().min(6,"A senha deve ter pelo menos 6 caracteres")}).refine((e=>e.password===e.confirmPassword),{message:"As senhas não coincidem",path:["confirmPassword"]}),js={user:null,session:null,isLoading:!1,isAuthenticated:!1,error:null,loading:{onAuthUserChanged:!1,signIn:!1,signUp:!1,signOut:!1,updateProfile:!1}},Ns=e.createContext({...js,signInWithEmail:async()=>({success:!1}),signUpWithEmail:async()=>({success:!1}),signOut:async()=>{},updateProfile:async()=>({success:!1})});var ws=(e=>(e.LOCAL="LOCAL",e.DEV="DEV",e.PROD="PROD",e))(ws||{});const _s=y({VITE_ENV:N(ws),VITE_BASE_URL:j().url().optional(),VITE_SUPABASE_URL:j().url(),VITE_SUPABASE_ANON_KEY:j(),VITE_SERVICE_ROLE:j().optional(),VITE_LOGIN_URL:j().url().optional(),VITE_SUPABASE_LOCAL_URL:j().url().optional(),VITE_SUPABASE_LOCAL_ANON_KEY:j().optional()});const Cs=function(){const e={VITE_ENV:"DEV",VITE_BASE_URL:"http://tower-trials.vercel.app",VITE_SUPABASE_URL:"https://rpagdztnwtyjatslrjay.supabase.co",VITE_SUPABASE_ANON_KEY:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJwYWdkenRud3R5amF0c2xyamF5Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDcyODUxNjEsImV4cCI6MjA2Mjg2MTE2MX0.DIB6tYhoJ_Rb5pGr8Vu236MFhFUaMIq0x7PrUTR0ztI",VITE_SERVICE_ROLE:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJwYWdkenRud3R5amF0c2xyamF5Iiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTc0NzI4NTE2MSwiZXhwIjoyMDYyODYxMTYxfQ.kylyn4vQcXVEMJuZ_baF9Mt4Ka5d1RFraocaIx3lrB4",VITE_LOGIN_URL:"http://tower-trials.vercel.app/login",VITE_SUPABASE_LOCAL_URL:void 0,VITE_SUPABASE_LOCAL_ANON_KEY:void 0};try{return _s.parse(e)}catch(t){throw t instanceof w&&t.errors.forEach((e=>{})),new Error("Configuração de ambiente inválida")}}(),Es=(()=>{switch(Cs.VITE_ENV){case ws.LOCAL:return{url:Cs.VITE_SUPABASE_LOCAL_URL||"http://127.0.0.1:54321",anonKey:Cs.VITE_SUPABASE_LOCAL_ANON_KEY||"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZS1kZW1vIiwicm9sZSI6ImFub24iLCJleHAiOjE5ODM4MTI5OTZ9.CRXP1A7WOeoJeXxjNni43kdQwgnWNReilDMblYTn_I0",serviceRoleKey:Cs.VITE_SERVICE_ROLE||"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZS1kZW1vIiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImV4cCI6MTk4MzgxMjk5Nn0.EGIM96RAZx35lJzdJsyH-qQwv8Hdp7fsn3W0YpN81IU"};case ws.DEV:case ws.PROD:default:return{url:Cs.VITE_SUPABASE_URL,anonKey:Cs.VITE_SUPABASE_ANON_KEY,serviceRoleKey:Cs.VITE_SERVICE_ROLE}}})(),Ss=D(Es.url,Es.anonKey,{auth:{persistSession:!0,autoRefreshToken:!0,detectSessionInUrl:!0,storage:localStorage}}),ks=D(Es.url,Es.serviceRoleKey||"",{auth:{autoRefreshToken:!1,persistSession:!1}}),Ps=Object.freeze(Object.defineProperty({__proto__:null,supabase:Ss,supabaseAdmin:ks},Symbol.toStringTag,{value:"Module"})),As={getSession:async()=>{try{const{data:{session:e},error:t}=await Ss.auth.getSession();if(t)throw t;return e}catch(e){return null}},getCurrentUser:async()=>{try{const{data:{user:e},error:t}=await Ss.auth.getUser();if(403===t?.status||!e)return null;if(t)throw t;const{data:s,error:a}=await Ss.from("users").select("*").eq("uid",e.id).maybeSingle();return a?null:s?{...e,username:s.username,display_name:s.display_name,avatar_url:s.avatar_url,role:s.role,highest_floor:s.highest_floor,total_games:s.total_games,total_victories:s.total_victories,total_character_level:s.total_character_level,max_character_slots:s.max_character_slots,is_active:s.is_active,last_login:s.last_login}:null}catch(e){return e instanceof Error&&e.message.includes("JWT"),null}},signOut:async()=>{try{const{error:e}=await Ss.auth.signOut();if(e)throw e}catch(e){throw e}},signInWithEmail:async({email:e,password:t})=>{try{const{data:s,error:a}=await Ss.auth.signInWithPassword({email:e,password:t});if(a)throw a;if(!s.user)return{user:null,session:null,error:"Usuário não encontrado"};const{data:r,error:n}=await Ss.from("users").select("*").eq("uid",s.user.id).maybeSingle();if(n)return{user:null,session:s.session,error:"Erro ao buscar perfil do usuário"};if(!r)return{user:null,session:s.session,error:"Perfil não encontrado"};await Ss.from("users").update({last_login:(new Date).toISOString()}).eq("uid",s.user.id);return{user:{...s.user,username:r.username,display_name:r.display_name,avatar_url:r.avatar_url,role:r.role,highest_floor:r.highest_floor,total_games:r.total_games,total_victories:r.total_victories,total_character_level:r.total_character_level,max_character_slots:r.max_character_slots,is_active:r.is_active,last_login:r.last_login},session:s.session}}catch(s){return{user:null,session:null,error:String(s)}}},signUpWithEmail:async e=>{try{const{email:a,password:r,username:n=a.split("@")[0]}=e,{data:i,error:o}=await Ss.auth.signUp({email:a,password:r,options:{data:{username:n},emailRedirectTo:`${window.location.origin}/auth`}});if(o)throw o;if(!i.user)throw new Error("Falha ao criar usuário");await new Promise((e=>setTimeout(e,1e3)));try{await Ss.rpc("create_user_profile",{p_uid:i.user.id,p_username:n,p_email:a})}catch(t){try{const{error:e}=await Ss.from("users").insert({uid:i.user.id,username:n,email:a,role:"PLAYER",highest_floor:0,total_games:0,total_victories:0,total_character_level:0,max_character_slots:3,is_active:!0,created_at:(new Date).toISOString(),updated_at:(new Date).toISOString()});if(e){if("23505"===e.code)return{user:{...i.user,username:n,role:"PLAYER",highest_floor:0,total_games:0,total_victories:0,total_character_level:0,max_character_slots:3,is_active:!0},session:i.session};throw e}}catch(s){}}return{user:{...i.user,username:n,role:"PLAYER",highest_floor:0,total_games:0,total_victories:0,total_character_level:0,max_character_slots:3,is_active:!0},session:i.session}}catch(a){return{user:null,session:null,error:String(a)}}},updateProfile:async e=>{try{const t=await As.getSession();if(!t?.user)throw new Error("Usuário não autenticado");const{error:s}=await Ss.from("users").update({display_name:e.display_name,avatar_url:e.avatar_url,updated_at:(new Date).toISOString()}).eq("uid",t.user.id).select().single();if(s)throw s;return{user:await As.getCurrentUser(),session:t}}catch(t){return{user:null,session:null,error:String(t)}}},handleAuthError:e=>{if(e instanceof q)switch(e.status){case 400:if(e.message.includes("Email not confirmed"))return new Error("Por favor, confirme seu e-mail antes de fazer login");if(e.message.includes("Invalid login credentials"))return new Error("E-mail ou senha incorretos");if(e.message.includes("Password should be at least 6 characters"))return new Error("A senha deve ter pelo menos 6 caracteres");if(e.message.includes("User already registered"))return new Error("Este e-mail já está cadastrado");break;case 401:return new Error("Sessão expirada. Por favor, faça login novamente");case 422:return new Error("Dados inválidos. Verifique as informações e tente novamente");case 429:return new Error("Muitas tentativas. Por favor, aguarde alguns minutos")}return e instanceof Error?e:new Error("Ocorreu um erro inesperado. Tente novamente mais tarde")}},Ms={onAuthUserChanged:!0,signIn:!1,signUp:!1,signOut:!1,updateProfile:!1},Ts={user:null,session:null,isLoading:!0,isAuthenticated:!1,error:null,loading:Ms};function Rs({children:s}){const[a,r]=e.useState(Ts),n=e.useCallback((async()=>{r((e=>e.isLoading?{...e,loading:{...e.loading,onAuthUserChanged:!0}}:e));try{const e=await As.getSession();if(!e)return void r({...Ts,isLoading:!1,loading:{...Ms,onAuthUserChanged:!1}});const t=await As.getCurrentUser();r({...Ts,user:t,session:e,isAuthenticated:!!t,isLoading:!1,loading:{...Ms,onAuthUserChanged:!1}})}catch(e){r({...Ts,error:e instanceof Error?e.message:String(e),isLoading:!1,loading:{...Ms,onAuthUserChanged:!1}})}}),[]);e.useEffect((()=>{const{data:{subscription:e}}=Ss.auth.onAuthStateChange(((e,t)=>{r((e=>JSON.stringify(t)===JSON.stringify(e.session)?e:{...e,session:t,isLoading:!0,loading:{...e.loading,onAuthUserChanged:!0}}))}));return()=>{e.unsubscribe()}}),[]),e.useEffect((()=>{a.isLoading&&n()}),[a.isLoading,n]);const i=e.useCallback((async e=>{r((e=>({...e,loading:{...e.loading,signIn:!0}})));try{const t=await As.signInWithEmail(e);return t.error?(r((e=>({...e,error:t.error,loading:{...e.loading,signIn:!1}}))),{success:!1,error:t.error}):(r((e=>({...e,isLoading:!0,loading:{...e.loading,signIn:!1,onAuthUserChanged:!0}}))),{success:!0})}catch(t){const e=t instanceof Error?t.message:"Erro ao fazer login";return r((t=>({...t,error:e,loading:{...t.loading,signIn:!1}}))),{success:!1,error:e}}}),[]),o=e.useCallback((async e=>{r((e=>({...e,loading:{...e.loading,signUp:!0}})));try{const t=await As.signUpWithEmail(e);return t.error?(r((e=>({...e,error:t.error,loading:{...e.loading,signUp:!1}}))),{success:!1,error:t.error}):(r((e=>({...e,isLoading:!0,loading:{...e.loading,signUp:!1,onAuthUserChanged:!0}}))),{success:!0})}catch(t){const e=t instanceof Error?t.message:"Erro ao criar conta";return r((t=>({...t,error:e,loading:{...t.loading,signUp:!1}}))),{success:!1,error:e}}}),[]),l=e.useCallback((async()=>{r((e=>({...e,loading:{...e.loading,signOut:!0}})));try{await As.signOut(),r({...Ts,isLoading:!1,loading:{...Ms,onAuthUserChanged:!1}}),"undefined"!=typeof window&&(window.location.href="/auth?auth=logout")}catch(e){r((t=>({...t,error:e instanceof Error?e.message:String(e),loading:{...t.loading,signOut:!1}})))}}),[]),c=e.useCallback((async e=>{r((e=>({...e,loading:{...e.loading,updateProfile:!0}})));try{const t=await As.updateProfile(e);return t.error?(r((e=>({...e,error:t.error,loading:{...e.loading,updateProfile:!1}}))),{success:!1,error:t.error}):(r((e=>({...e,isLoading:!0,loading:{...e.loading,updateProfile:!1,onAuthUserChanged:!0}}))),{success:!0})}catch(t){const e=t instanceof Error?t.message:"Erro ao atualizar perfil";return r((t=>({...t,error:e,loading:{...t.loading,updateProfile:!1}}))),{success:!1,error:e}}}),[]),d=e.useMemo((()=>({...a,signInWithEmail:i,signUpWithEmail:o,signOut:l,updateProfile:c})),[a,i,o,l,c]);return t.jsx(Ns.Provider,{value:d,children:s})}const Ds=100,qs={hp:100,mana:50,atk:20,def:10,speed:10};var $s=(e=>(e.SWORD_MASTERY="sword",e.AXE_MASTERY="axe",e.BLUNT_MASTERY="blunt",e.DEFENSE_MASTERY="defense",e.MAGIC_MASTERY="magic",e))($s||{});function Is(e){return{sword:"Maestria com espadas. Aumenta ataque (+1), chance crítica (+0.2%) e dano crítico (+3%) por nível.",axe:"Maestria com machados. Aumenta ataque (+1), chance crítica (+0.2%) e dano crítico (+3%) por nível.",blunt:"Maestria com armas de concussão. Aumenta ataque (+1), chance crítica (+0.2%) e dano crítico (+3%) por nível.",defense:"Maestria defensiva. Aumenta defesa (+2) por nível e reduz dano recebido.",magic:"Maestria mágica. Aumenta mana (+3), dano mágico (+15%) e cura (+10%) por nível."}[e]}const Ls={mode:"menu",player:{id:"",user_id:"",name:"",level:1,xp:0,xp_next_level:Ds,gold:0,hp:qs.hp,max_hp:qs.hp,mana:qs.mana,max_mana:qs.mana,atk:qs.atk,def:qs.def,speed:qs.speed,created_at:"",updated_at:"",isPlayerTurn:!0,specialCooldown:0,defenseCooldown:0,isDefending:!1,floor:1,spells:[],consumables:[],potionUsedThisTurn:!1,active_effects:{buffs:[],debuffs:[],dots:[],hots:[],attribute_modifications:[]},strength:10,dexterity:10,intelligence:10,wisdom:10,vitality:10,luck:10,critical_chance:0,critical_damage:110,double_attack_chance:0,magic_attack:0,magic_mastery:1,magic_damage_bonus:0},currentEnemy:null,currentFloor:null,currentSpecialEvent:null,isPlayerTurn:!0,gameMessage:"",highestFloor:0,selectedSpell:null,battleRewards:null,fleeSuccessful:!1,characterDeleted:!1},Vs=e.createContext({gameState:Ls,loading:{loadProgress:!1,startGame:!1,performAction:!1,saveProgress:!1},error:null,gameMessage:"",gameLog:[],characters:[],selectedCharacter:null,startGame:async()=>{},selectCharacter:async()=>{},loadCharacterForHub:async()=>{},clearGameState:()=>{},performAction:()=>{},returnToMenu:()=>{},resetError:()=>{},addGameLogMessage:()=>{},saveProgress:async()=>{},updatePlayerStats:()=>{},updatePlayerConsumables:()=>{}}),Fs=e.createContext(null);function Os({children:s}){const[a,r]=e.useState({gameState:Ls,loading:{loadProgress:!1,startGame:!1,performAction:!1,saveProgress:!1},error:null,gameMessage:"Bem-vindo ao Tower Trials! Crie um personagem para iniciar sua aventura.",gameLog:[{text:"Bem-vindo ao Tower Trials!",type:"system"}]}),n=(e,t)=>{r((s=>({...s,loading:{...s.loading,[e]:t}})))},i=e=>{r((t=>({...t,gameState:e})))},o=e=>{r((t=>({...t,error:e}))),e&&_.error("Erro",{description:e})},l=()=>{r((e=>({...e,error:null})))},c=e.useMemo((()=>({gameState:a.gameState,loading:a.loading,error:a.error,setGameState:i,updateLoading:n,setError:o,resetError:l})),[a]);return t.jsx(Fs.Provider,{value:c,children:s})}const zs=e.createContext(null);function Bs({children:s}){const[a,r]=e.useState(""),[n,i]=e.useState([]),o=e.useCallback(((e,t="system")=>{i((s=>s.slice(-5).some((s=>s.text===e&&s.type===t))?s:[...s,{text:e,type:t}]))}),[]),l=e.useMemo((()=>({gameMessage:a,gameLog:n,addGameLogMessage:o,setGameMessage:r})),[a,n,o,r]);return t.jsx(zs.Provider,{value:l,children:s})}function Us(){const t=e.useContext(zs);if(!t)throw new Error("useGameLog deve ser usado dentro de um LogProvider");return t}class Hs{static characterCache=new Map;static userCharactersCache=new Map;static pendingRequests=new Map;static pendingUserRequests=new Map;static CACHE_DURATION=3e4;static USER_CACHE_DURATION=15e3;static MAX_CACHE_SIZE=100;static invalidationQueue=new Set;static invalidationTimer=null;static INVALIDATION_DELAY=500;static getCachedCharacter(e){const t=this.characterCache.get(e);if(!t)return null;if(Date.now()-t.timestamp>this.CACHE_DURATION||!t.isValid)return this.characterCache.delete(e),null;"undefined"!=typeof window&&localStorage.getItem("debug");return t.character}static setCachedCharacter(e,t){this.characterCache.size>=this.MAX_CACHE_SIZE&&this.cleanOldEntries(),this.characterCache.set(e,{character:t,timestamp:Date.now(),isValid:!0});"undefined"!=typeof window&&localStorage.getItem("debug")}static getCachedUserCharacters(e){const t=this.userCharactersCache.get(e);if(!t)return{characters:[],isValid:!1};if(Date.now()-t.timestamp>this.USER_CACHE_DURATION||!t.isValid)return this.userCharactersCache.delete(e),{characters:[],isValid:!1};"undefined"!=typeof window&&localStorage.getItem("debug");return{characters:t.characters,isValid:!0}}static setCachedUserCharacters(e,t){this.userCharactersCache.set(e,{characters:t,timestamp:Date.now(),isValid:!0}),t.forEach((e=>{this.setCachedCharacter(e.id,e)}))}static getPendingRequest(e){return this.pendingRequests.get(e)||null}static setPendingRequest(e,t){this.pendingRequests.set(e,t),t.finally((()=>{this.pendingRequests.delete(e)}))}static getPendingUserRequest(e){return this.pendingUserRequests.get(e)||null}static setPendingUserRequest(e,t){this.pendingUserRequests.set(e,t),t.finally((()=>{this.pendingUserRequests.delete(e)}))}static invalidateCharacterCache(e){this.invalidationQueue.add(e),this.invalidationTimer&&clearTimeout(this.invalidationTimer),this.invalidationTimer=setTimeout((()=>{const e=Array.from(this.invalidationQueue);this.invalidationQueue.clear(),this.invalidationTimer=null,e.forEach((e=>{const t=this.characterCache.get(e);t&&(t.isValid=!1)})),e.length}),this.INVALIDATION_DELAY)}static invalidateUserCache(e){const t=this.userCharactersCache.get(e);t&&(t.isValid=!1);const s=[];this.characterCache.forEach(((t,a)=>{t.character.user_id===e&&s.push(a)})),s.forEach((e=>this.invalidateCharacterCache(e)))}static cleanOldEntries(){const e=Date.now();for(const[t,s]of this.characterCache.entries())(e-s.timestamp>this.CACHE_DURATION||!s.isValid)&&this.characterCache.delete(t);for(const[t,s]of this.userCharactersCache.entries())(e-s.timestamp>this.USER_CACHE_DURATION||!s.isValid)&&this.userCharactersCache.delete(t)}static clearAllCache(){this.characterCache.clear(),this.userCharactersCache.clear(),this.pendingRequests.clear(),this.pendingUserRequests.clear(),this.invalidationTimer&&(clearTimeout(this.invalidationTimer),this.invalidationTimer=null),this.invalidationQueue.clear()}static getCacheStats(){return{charactersCount:this.characterCache.size,userCachesCount:this.userCharactersCache.size,pendingRequestsCount:this.pendingRequests.size,pendingUserRequestsCount:this.pendingUserRequests.size,invalidationQueueSize:this.invalidationQueue.size}}static async preloadCharacter(e,t){const s=this.getCachedCharacter(e);if(s)return s;const a=this.getPendingRequest(e);if(a)try{return(await a).data||null}catch(r){return null}try{const s=await t();return this.setCachedCharacter(e,s),s}catch(r){return null}}static validateCacheIntegrity(){const e=[],t=Date.now();for(const[s,a]of this.characterCache.entries())a.character&&a.character.id||e.push(`Personagem ${s} tem dados inválidos`),a.character.id!==s&&e.push(`Personagem ${s} tem ID inconsistente: ${a.character.id}`),t-a.timestamp>2*this.CACHE_DURATION&&e.push(`Personagem ${s} está muito desatualizado`);for(const[s,a]of this.userCharactersCache.entries())Array.isArray(a.characters)||e.push(`Lista de personagens do usuário ${s} não é um array`),t-a.timestamp>2*this.USER_CACHE_DURATION&&e.push(`Lista de personagens do usuário ${s} está muito desatualizada`);return{isValid:0===e.length,issues:e}}}const Gs=Object.freeze(Object.defineProperty({__proto__:null,CharacterCacheService:Hs},Symbol.toStringTag,{value:"Module"}));class Ws{static async updateCharacterHpMana(e,t,s){try{if(!e)return{success:!1,error:"ID do personagem é obrigatório",data:null};const a=void 0!==t?Math.floor(Number(t)):void 0,r=void 0!==s?Math.floor(Number(s)):void 0;if(void 0!==a&&(a<0||a>9999))return{success:!1,error:"Valor de HP inválido",data:null};if(void 0!==r&&(r<0||r>9999))return{success:!1,error:"Valor de Mana inválido",data:null};const n=Hs.getCachedCharacter(e);if(n){const e=void 0!==a&&a!==n.hp,t=void 0!==r&&r!==n.mana;if(!e&&!t)return{success:!0,error:null,data:null}}const{error:i}=await Ss.rpc("internal_update_character_hp_mana",{p_character_id:e,p_hp:a,p_mana:r});if(i)return{success:!1,error:`Erro ao atualizar stats: ${i.message}`,data:null};if(!n||void 0===a&&void 0===r)Hs.invalidateCharacterCache(e);else{const t={...n};void 0!==a&&(t.hp=a),void 0!==r&&(t.mana=r),Hs.setCachedCharacter(e,t)}return{success:!0,error:null,data:null}}catch(a){return{success:!1,error:a instanceof Error?a.message:"Erro desconhecido ao atualizar HP/Mana",data:null}}}static calculateAutoHeal(e,t){if(!e.last_activity)return{hp:e.hp,mana:e.mana};if(e.hp>=e.max_hp&&e.mana>=e.max_mana)return{hp:e.hp,mana:e.mana};const s=new Date(e.last_activity),a=t.getTime()-s.getTime(),r=Math.floor(a/1e3);if(r<1)return{hp:e.hp,mana:e.mana};const n=100;let i=e.hp;if(e.hp<e.max_hp){const t=Math.max(e.hp,Math.ceil(.001*e.max_hp)),s=t/e.max_hp*100,a=.013875,o=Math.min(a*r,n-s),l=Math.floor(o/100*e.max_hp);i=Math.min(e.max_hp,t+l)}let o=e.mana;if(e.mana<e.max_mana){const t=Math.max(e.mana,Math.ceil(.001*e.max_mana)),s=t/e.max_mana*100,a=.013875,i=Math.min(a*r,n-s),l=Math.floor(i/100*e.max_mana);o=Math.min(e.max_mana,t+l)}return i>e.hp||e.mana,{hp:i,mana:o}}static async applyAutoHeal(e){try{let t=Hs.getCachedCharacter(e);if(!t){const{data:s,error:a}=await Ss.from("characters").select("*").eq("id",e).single();if(a)throw a;t=s}if(!t)return{data:null,error:"Personagem não encontrado",success:!1};const s=new Date,{hp:a,mana:r}=this.calculateAutoHeal(t,s);if(a===t.hp&&r===t.mana)return{data:{healed:!1,oldHp:t.hp,newHp:t.hp,character:t},error:null,success:!0};const n=await this.updateCharacterHpMana(e,a,r);if(!n.success)throw new Error(n.error||"Erro ao atualizar HP/Mana");await this.updateLastActivity(e),Hs.invalidateCharacterCache(e);const i={...t,hp:a,mana:r,last_activity:s.toISOString()};return{data:{healed:!0,oldHp:t.hp,newHp:a,character:i},error:null,success:!0}}catch(t){return{data:null,error:t instanceof Error?t.message:"Erro ao aplicar cura automática",success:!1}}}static async updateLastActivity(e){try{const{error:t}=await Ss.rpc("update_character_activity",{p_character_id:e});if(t)throw t;return Hs.invalidateCharacterCache(e),{data:null,error:null,success:!0}}catch(t){return{data:null,error:t instanceof Error?t.message:"Erro ao atualizar última atividade",success:!1}}}}class Xs{static async updateCharacterFloor(e,t){try{const{supabaseAdmin:a}=await s((async()=>{const{supabaseAdmin:e}=await Promise.resolve().then((()=>Ps));return{supabaseAdmin:e}}),void 0),{error:r}=await a.rpc("secure_advance_floor",{p_character_id:e,p_new_floor:t});if(r)throw r;return Hs.invalidateCharacterCache(e),{data:null,error:null,success:!0}}catch(a){return{data:null,error:a instanceof Error?a.message:"Erro desconhecido",success:!1}}}static async getUnlockedCheckpoints(e){try{try{const{data:t,error:s}=await Ss.rpc("get_character_unlocked_checkpoints",{p_character_id:e});if(!s&&t){return{data:t.map((e=>({floor:e.floor_number,description:e.description}))),error:null,success:!0}}}catch(t){}let s=Hs.getCachedCharacter(e);if(!s){const{data:t,error:a}=await Ss.from("characters").select("*").eq("id",e).single();if(a)throw a;s=t}if(!s)return{data:null,error:"Personagem não encontrado",success:!1};const a=Math.max(s.floor,("highest_floor"in s?s.highest_floor:s.floor)||s.floor),r=[];r.push({floor:1,description:"Andar 1 - Início da Torre"});for(let e=1;e<=100;e++){const t=10*e+1;if(!(a>=t))break;r.push({floor:t,description:`Andar ${t} - Checkpoint Pós-Boss`})}return{data:r,error:null,success:!0}}catch(s){return{data:null,error:s instanceof Error?s.message:"Erro ao obter checkpoints",success:!1}}}static async startFromCheckpoint(e,t){try{if(!(1===t||t>10&&(t-1)%10==0))return{data:null,error:"Checkpoint inválido",success:!1};const s=await this.getUnlockedCheckpoints(e);if(!s.success||!s.data)return{data:null,error:"Erro ao verificar checkpoints",success:!1};if(!s.data.some((e=>e.floor===t)))return{data:null,error:"Checkpoint não desbloqueado",success:!1};const a=await this.updateCharacterFloor(e,t);if(!a.success)return a;const r=Hs.getCachedCharacter(e);return r&&await Ws.updateCharacterHpMana(e,r.max_hp,r.max_mana),{data:null,error:null,success:!0}}catch(s){return{data:null,error:s instanceof Error?s.message:"Erro ao iniciar do checkpoint",success:!1}}}static async resetCharacterProgress(e){try{const t=await this.updateCharacterFloor(e,1);if(!t.success)return t;const s=Hs.getCachedCharacter(e);return s&&await Ws.updateCharacterHpMana(e,s.max_hp,s.max_mana),{data:null,error:null,success:!0}}catch(t){return{data:null,error:t instanceof Error?t.message:"Erro ao resetar progresso",success:!1}}}}class Ys{static async getUserCharacterProgression(e){try{const{data:t,error:s}=await Ss.rpc("get_user_character_progression",{p_user_id:e}).single();if(s)throw s;return{data:t,error:null,success:!0}}catch(t){return{data:null,error:t instanceof Error?t.message:"Erro ao buscar progressão",success:!1}}}static async checkCharacterLimit(e){try{const{data:t,error:s}=await Ss.rpc("check_character_limit",{p_user_id:e}).single();if(s)throw s;return{data:t,error:null,success:!0}}catch(t){return{data:null,error:t instanceof Error?t.message:"Erro ao verificar limite",success:!1}}}static async grantSecureXP(e,t,a="combat"){try{const{supabaseAdmin:r}=await s((async()=>{const{supabaseAdmin:e}=await Promise.resolve().then((()=>Ps));return{supabaseAdmin:e}}),void 0),{data:n,error:i}=await r.rpc("secure_grant_xp",{p_character_id:e,p_xp_amount:t,p_source:a}).single();if(i)throw i;Hs.invalidateCharacterCache(e);const o=n;if(o.leveled_up||o.slots_unlocked){const t=await this.getCharacterById(e);t.success&&t.data&&Hs.invalidateUserCache(t.data.user_id)}return{data:o,error:null,success:!0}}catch(r){return{data:null,error:r instanceof Error?r.message:"Erro ao conceder XP",success:!1}}}static async grantSecureGold(e,t,a="combat"){try{const{supabaseAdmin:r}=await s((async()=>{const{supabaseAdmin:e}=await Promise.resolve().then((()=>Ps));return{supabaseAdmin:e}}),void 0),{data:n,error:i}=await r.rpc("secure_grant_gold",{p_character_id:e,p_gold_amount:t,p_source:a}).single();if(i)throw i;return Hs.invalidateCharacterCache(e),{data:n,error:null,success:!0}}catch(r){return{data:null,error:r instanceof Error?r.message:"Erro ao conceder gold",success:!1}}}static async addSkillXp(e,t,s){try{const{data:a,error:r}=await Ss.rpc("add_skill_xp",{p_character_id:e,p_skill_type:t,p_xp_amount:s}).single();if(r)throw r;return a&&a.skill_leveled_up&&Hs.invalidateCharacterCache(e),{data:a,error:null,success:!0}}catch(a){return{data:null,error:a instanceof Error?a.message:"Erro ao adicionar XP",success:!1}}}static async updateGold(e,t){try{const{error:s}=await Ss.from("characters").update({gold:t}).eq("id",e);if(s)throw s;return Hs.invalidateCharacterCache(e),{data:null,error:null,success:!0}}catch(s){return{data:null,error:s instanceof Error?s.message:"Erro ao atualizar gold",success:!1}}}static async getCharacterById(e){try{const{data:t,error:s}=await Ss.from("characters").select("*").eq("id",e).single();if(s)throw s;return{data:t,error:null,success:!0}}catch(t){return{data:null,error:t instanceof Error?t.message:"Erro ao buscar personagem",success:!1}}}}function Ks(e,t){if(e&&"object"==typeof e){if("message"in e&&"string"==typeof e.message)return e.message;if(e instanceof Error)return e.message}return t}class Js{static equipmentCache=new Map;static lastFetchTimestamp=0;static CACHE_DURATION=3e5;static async getAvailableEquipment(e){try{const t=`level_${e}`,s=Date.now();if(s-this.lastFetchTimestamp<this.CACHE_DURATION&&this.equipmentCache.has(t))return this.equipmentCache.get(t)||[];const{data:a,error:r}=await Ss.from("equipment").select("*").lte("level_requirement",e).eq("is_unlocked",!0).eq("craftable",!1).order("level_requirement",{ascending:!0});if(r)throw r;const n=a;return this.equipmentCache.set(t,n),this.lastFetchTimestamp=s,n}catch(t){return[]}}static async getAllEquipments(){try{const{data:e,error:t}=await Ss.from("equipment").select("*").order("name");if(t)throw t;return e}catch(e){return[]}}static async getCharacterEquipment(e){try{const{data:t,error:s}=await Ss.from("character_equipment").select("*, equipment:equipment_id (*)").eq("character_id",e).order("created_at",{ascending:!1});if(s)throw s;return t}catch(t){return[]}}static async getEquippedItems(e){try{const{data:t,error:s}=await Ss.rpc("get_equipped_slots",{p_character_id:e});if(s)throw s;const a={};return t&&Array.isArray(t)&&t.forEach((e=>{const t={id:e.equipment_id,name:e.equipment_name,description:"",type:e.equipment_type,weapon_subtype:e.weapon_subtype,rarity:e.rarity,level_requirement:0,atk_bonus:e.atk_bonus,def_bonus:e.def_bonus,mana_bonus:e.mana_bonus,speed_bonus:e.speed_bonus,hp_bonus:e.hp_bonus,critical_chance_bonus:e.critical_chance_bonus,critical_damage_bonus:e.critical_damage_bonus,double_attack_chance_bonus:e.double_attack_chance_bonus,magic_damage_bonus:e.magic_damage_bonus,price:0,is_unlocked:!0,created_at:"",updated_at:""};a[e.slot_type]=t})),a}catch(t){return{}}}static async toggleEquipment(e,t,s,a){try{const{error:r}=await Ss.rpc("toggle_equipment",{p_character_id:e,p_equipment_id:t,p_equip:s,p_slot_type:a});if(r)throw r;return{data:s?"Item equipado com sucesso!":"Item desequipado com sucesso!",error:null,success:!0}}catch(r){return{data:null,error:Ks(r,"Erro ao equipar/desequipar item"),success:!1}}}static async buyEquipment(e,t){try{const{data:s,error:a}=await Ss.from("equipment").select("price").eq("id",t).single();if(a)throw new Error(`Erro ao buscar equipamento: ${a.message}`);if(!s)throw new Error("Equipamento não encontrado");const{data:r,error:n}=await Ss.rpc("buy_equipment",{p_character_id:e,p_equipment_id:t,p_price:s.price});if(n)throw n;return{data:{newGold:r},error:null,success:!0}}catch(s){return{data:null,error:Ks(s,"Erro ao comprar equipamento"),success:!1}}}static async sellEquipment(e,t){try{const{data:s,error:a}=await Ss.rpc("sell_equipment",{p_character_id:e,p_equipment_id:t});if(a)throw a;return{data:{newGold:s},error:null,success:!0}}catch(s){return{data:null,error:Ks(s,"Erro ao vender equipamento"),success:!1}}}static async getEquipmentCraftingRecipes(){try{const{data:e,error:t}=await Ss.from("equipment_crafting_recipes").select("\n          *,\n          equipment:result_equipment_id (*),\n          ingredients:equipment_crafting_ingredients (*)\n        ").order("name");if(t)throw t;return{data:e,error:null,success:!0}}catch(e){return{data:null,error:"Erro ao buscar receitas de equipamentos",success:!1}}}static async canCraftEquipment(e,t){try{const{data:s,error:a}=await Ss.rpc("check_can_craft_equipment",{p_character_id:e,p_recipe_id:t});if(a)throw a;return{data:s,error:null,success:!0}}catch(s){return{data:null,error:Ks(s,"Erro ao verificar crafting de equipamento"),success:!1}}}static async craftEquipment(e,t){try{const{error:s}=await Ss.rpc("craft_equipment",{p_character_id:e,p_recipe_id:t});if(s)throw s;return{data:{message:"Equipamento criado com sucesso!"},error:null,success:!0}}catch(s){return{data:null,error:Ks(s,"Erro ao craftar equipamento"),success:!1}}}static async canEquipItem(e,t){try{const{data:s,error:a}=await Ss.rpc("can_equip_item",{p_character_id:e,p_equipment_id:t});if(a)throw a;return{data:s,error:null,success:!0}}catch(s){return{data:null,error:Ks(s,"Erro ao verificar se pode equipar item"),success:!1}}}static async compareEquipmentStats(e,t,s){try{const{data:a,error:r}=await Ss.rpc("compare_equipment_stats",{p_character_id:e,p_new_equipment_id:t,p_slot_type:s});return r?{success:!1,error:r.message,data:null}:{success:!0,error:null,data:a||[]}}catch(a){return{success:!1,error:Ks(a,"Erro ao comparar equipamentos"),data:null}}}static async getEquipmentBonuses(e){try{const{data:t,error:s}=await Ss.rpc("calculate_equipment_bonuses_enhanced",{p_character_id:e});return s?{success:!1,error:s.message,data:null}:{success:!0,error:null,data:t?.[0]||{total_atk_bonus:0,total_def_bonus:0,total_mana_bonus:0,total_speed_bonus:0,total_hp_bonus:0,total_critical_chance_bonus:0,total_critical_damage_bonus:0,total_double_attack_chance_bonus:0,total_magic_damage_bonus:0}}}catch(t){return{success:!1,error:Ks(t,"Erro ao obter bônus de equipamentos"),data:null}}}static clearCache(){this.equipmentCache.clear(),this.lastFetchTimestamp=0}}class Zs{static calculateEquipmentBonusLocal(e){const t={hp:0,mana:0,atk:0,def:0,speed:0,critical_chance:0,critical_damage:0,magic_damage:0,double_attack_chance:0};if(!e)return t;return[e.main_hand,e.off_hand,e.armor,e.accessory].forEach((e=>{e&&(t.hp+=e.hp_bonus||0,t.mana+=e.mana_bonus||0,t.atk+=e.atk_bonus||0,t.def+=e.def_bonus||0,t.speed+=e.speed_bonus||0,t.critical_chance+=e.critical_chance_bonus||0,t.critical_damage+=e.critical_damage_bonus||0,t.magic_damage+=e.magic_damage_bonus||0,t.double_attack_chance+=e.double_attack_chance_bonus||0)})),t}static async calculateDerivedStats(e){try{return await this.calculateDerivedStatsFallback(e)}catch(t){return await this.calculateDerivedStatsFallback(e)}}static async calculateDerivedStatsFallback(e){const t=e.level,s=e.strength||10,a=e.dexterity||10,r=e.intelligence||10,n=e.wisdom||10,i=e.vitality||10,o=e.luck||10,l=s+a+r+n+i+o,c=1+.2*(1-(Math.abs(s/l-1/6)+Math.abs(a/l-1/6)+Math.abs(r/l-1/6)+Math.abs(n/l-1/6)+Math.abs(i/l-1/6)+Math.abs(o/l-1/6))/2);let d=1;Math.max(s/l,a/l,r/l,n/l,i/l,o/l)>.8&&(d=.7);"undefined"!=typeof window&&localStorage.getItem("debug");const m=Math.pow(s,1.2)*c*d,u=Math.pow(a,1.15)*c*d,h=Math.pow(r,1.25)*c*d,p=Math.pow(n,1.1)*c*d,x=Math.pow(i,1.3)*c*d,f=o*c*d,g=e.sword_mastery||1,b=e.axe_mastery||1,v=e.blunt_mastery||1,y=e.defense_mastery||1,j=e.magic_mastery||1,N=Math.pow(Math.max(g,b,v),1.1)*c,w=Math.pow(y,1.2)*c,_=Math.pow(j,1.15)*c,C=50+2*t,E=20+1*t,S=2+t,k=1+t,P=3+t;let A={hp:0,mana:0,atk:0,def:0,speed:0,critical_chance:0,critical_damage:0,magic_damage:0,double_attack_chance:0};try{const t=await Js.getEquippedItems(e.id);if(t){A=this.calculateEquipmentBonusLocal(t);"undefined"!=typeof window&&localStorage.getItem("debug")}}catch(q){}const M=Math.floor(C+3.5*x+A.hp),T=M,R=Math.floor(E+1.5*(h+p)+A.mana),D={hp:M,max_hp:T,mana:R,max_mana:R,atk:Math.floor(S+2.2*m+N+A.atk),magic_attack:Math.floor(1.8*h+_+A.magic_damage),def:Math.floor(k+1.5*u+w+A.def),speed:Math.floor(P+1.8*u+A.speed),critical_chance:Math.min(95,Math.floor(5+.3*u+.5*f+.2*N+A.critical_chance)),critical_damage:Math.floor(150+.8*m+1.2*N+A.critical_damage),magic_damage_bonus:Math.floor(1.2*h+1.5*_+A.magic_damage),double_attack_chance:Math.min(25,Math.floor(.2*u+.3*f+A.double_attack_chance))};"undefined"!=typeof window&&localStorage.getItem("debug");return D}static analyzeBuildDiversity(e){const t=e.strength||10,s=e.dexterity||10,a=e.intelligence||10,r=e.wisdom||10,n=e.vitality||10,i=e.luck||10,o=t+s+a+r+n+i,l=[{name:"Força",value:t,percentage:t/o},{name:"Destreza",value:s,percentage:s/o},{name:"Inteligência",value:a,percentage:a/o},{name:"Sabedoria",value:r,percentage:r/o},{name:"Vitalidade",value:n,percentage:n/o},{name:"Sorte",value:i,percentage:i/o}],c=l.reduce(((e,t)=>t.percentage>e.percentage?t:e)),d=c.percentage>.8,m=1-l.reduce(((e,t)=>e+Math.abs(t.percentage-1/6)),0)/2,u=1+.2*m,h=d?.7:1;let p="";return p=d?`Build muito especializada em ${c.name}. Considere investir em outros atributos para melhor eficiência geral.`:m>.7?"Build bem balanceada! Você está aproveitando as sinergias entre atributos.":"Build moderadamente especializada. Há espaço para melhorar o equilíbrio.",{diversityScore:m,diversityPercentage:100*m,diversityBonus:u,monoBuildPenalty:h,dominantAttribute:c.name,dominantPercentage:100*c.percentage,isMonoBuild:d,recommendation:p}}}class Qs{static async distributeAttributePoints(e,t){try{const{data:s,error:a}=await Ss.rpc("distribute_attribute_points",{p_character_id:e,p_strength:t.strength,p_dexterity:t.dexterity,p_intelligence:t.intelligence,p_wisdom:t.wisdom,p_vitality:t.vitality,p_luck:t.luck}).single();if(a)throw a;return Hs.invalidateCharacterCache(e),{data:s,error:null,success:!0}}catch(s){return{data:null,error:s instanceof Error?s.message:"Erro ao distribuir pontos",success:!1}}}static async recalculateCharacterStats(e){try{const{error:t}=await Ss.rpc("recalculate_character_stats",{p_character_id:e});if(t)throw t;return Hs.invalidateCharacterCache(e),{data:null,error:null,success:!0}}catch(t){return{data:null,error:t instanceof Error?t.message:"Erro ao recalcular stats",success:!1}}}}class ea{static BLACKLIST_WORDS=["porra","merda","caralho","puta","putaria","viado","bicha","cu","buceta","piroca","pinto","rola","foda","foder","fodido","cuzao","cuzão","babaca","otario","otário","idiota","imbecil","retardado","mongoloide","burro","desgraça","desgraçado","filho da puta","fdp","vagabundo","safado","cachorro","cadela","prostituta","vagabunda","piranha","galinha","fuck","shit","bitch","damn","hell","ass","asshole","bastard","crap","piss","dick","cock","pussy","cunt","whore","slut","fag","faggot","nigger","retard","moron","idiot","stupid","gay","lesbian","homo","nazi","hitler","rape","kill","murder","mierda","joder","puta","puto","cabron","cabrón","pendejo","idiota","estupido","estúpido","culo","coño","verga","chingar","pinche","mamada","putada","hijo de puta","hdp","marica","maricon","maricón","droga","cocaina","heroina","crack","cocaine","heroin","drug","dealer","traficante","sexo","sex","porn","porno","nude","naked","xxx","fetish","admin","moderador","mod","gm","gamemaster","suporte","support","oficial","staff","dev","developer","bot","sistema","system"];static RESERVED_WORDS=["admin","administrator","moderador","moderator","mod","gm","gamemaster","suporte","support","help","ajuda","oficial","official","staff","dev","developer","sistema","system","bot","null","undefined","test","teste","demo","sample","example","exemplo","guest","visitante","player","jogador","user","usuario","usuário","npc","monster","monstro"];static INVALID_PATTERNS=[/^[0-9]+$/,/^[^a-zA-ZÀ-ÿ]/,/[^a-zA-ZÀ-ÿ0-9\s'-]/,/\d{3,}/,/(.)\1{3,}/,/^\s|\s$/,/\s{2,}/];static validateCharacterName(e){if(!e||"string"!=typeof e)return{isValid:!1,error:"Nome é obrigatório"};const t=e.trim();if(t.length<3)return{isValid:!1,error:"Nome deve ter pelo menos 3 caracteres"};if(t.length>20)return{isValid:!1,error:"Nome deve ter no máximo 20 caracteres"};for(const n of this.INVALID_PATTERNS)if(n.test(t))return{isValid:!1,error:this.getPatternError(n)};const s=t.toLowerCase().split(/[\s\-']+/);for(const n of s)if(this.BLACKLIST_WORDS.includes(n))return{isValid:!1,error:"Nome contém palavras inadequadas"};const a=t.toLowerCase().replace(/[\s\-']/g,"");for(const n of this.BLACKLIST_WORDS)if(a.includes(n))return{isValid:!1,error:"Nome contém termos inadequados"};for(const n of this.RESERVED_WORDS)if(a.includes(n))return{isValid:!1,error:"Nome contém termos reservados do sistema"};if(!/[a-zA-ZÀ-ÿ]/.test(t))return{isValid:!1,error:"Nome deve conter pelo menos uma letra"};const r=(t.match(/[a-zA-ZÀ-ÿ]/g)||[]).length;return(t.match(/[0-9]/g)||[]).length>r?{isValid:!1,error:"Nome não pode ter mais números que letras"}:{isValid:!0}}static getPatternError(e){const t=e.toString();return t.includes("^[0-9]+$")?"Nome não pode ser apenas números":t.includes("^[^a-zA-ZÀ-ÿ]")?"Nome deve começar com uma letra":t.includes("[^a-zA-ZÀ-ÿ0-9\\s'\\-]")?"Nome contém caracteres especiais não permitidos":t.includes("\\d{3,}")?"Nome não pode ter mais de 2 números consecutivos":t.includes("(.)\\1{3,}")?"Nome não pode ter mais de 3 caracteres iguais seguidos":t.includes("^\\s|\\s$")?"Nome não pode começar ou terminar com espaços":t.includes("\\s{2,}")?"Nome não pode ter espaços múltiplos":"Nome contém formato inválido"}static formatCharacterName(e){if(!e)return"";let t=e.trim().replace(/\s+/g," ");return t=t.replace(/\b\w/g,(e=>e.toUpperCase())),t}static generateNameSuggestions(e){const t=[],s=e.replace(/[^a-zA-ZÀ-ÿ]/g,"");if(s.length>=3){for(let a=1;a<=3;a++){const e=Math.floor(100*Math.random());t.push(this.formatCharacterName(s+e))}const e=["Jr","II","III","X","Prime","Neo"];for(const a of e.slice(0,2))t.push(this.formatCharacterName(s+a))}if(0===t.length){const e=["Aventureiro","Guerreiro","Explorador","Heroi","Campeao","Bravo","Valente","Nobre","Lenda","Mestre"];for(let s=0;s<3;s++){const s=e[Math.floor(Math.random()*e.length)],a=Math.floor(1e3*Math.random());t.push(`${s}${a}`)}}return t.slice(0,3)}static isTooSimilar(e,t){const s=e.toLowerCase().replace(/[^a-zA-ZÀ-ÿ0-9]/g,"");for(const a of t){const e=a.toLowerCase().replace(/[^a-zA-ZÀ-ÿ0-9]/g,"");if(s===e)return!0;if(this.calculateSimilarity(s,e)>.8)return!0}return!1}static calculateSimilarity(e,t){const s=e.length>t.length?e:t,a=e.length>t.length?t:e;if(0===s.length)return 1;const r=this.levenshteinDistance(s,a);return(s.length-r)/s.length}static levenshteinDistance(e,t){const s=Array(t.length+1).fill(null).map((()=>Array(e.length+1).fill(null)));for(let a=0;a<=e.length;a+=1)s[0][a]=a;for(let a=0;a<=t.length;a+=1)s[a][0]=a;for(let a=1;a<=t.length;a+=1)for(let r=1;r<=e.length;r+=1){const n=e[r-1]===t[a-1]?0:1;s[a][r]=Math.min(s[a][r-1]+1,s[a-1][r]+1,s[a-1][r-1]+n)}return s[t.length][e.length]}}class ta{static async getUserCharacters(e){try{const t=Hs.getCachedUserCharacters(e);if(t.isValid)return{data:t.characters,error:null,success:!0};const{data:s,error:a}=await Ss.rpc("get_user_characters",{p_user_id:e});if(a)throw a;return Hs.setCachedUserCharacters(e,s),{data:s,error:null,success:!0}}catch(t){return{data:null,error:t instanceof Error?t.message:"Erro ao buscar personagens",success:!1}}}static async getCharacter(e){try{const t=Hs.getCachedCharacter(e);if(t)return{data:t,error:null,success:!0};const s=Hs.getPendingRequest(e);if(s)return s;const a=this.fetchCharacterFromServer(e);Hs.setPendingRequest(e,a);return await a}catch(t){return{data:null,error:t instanceof Error?t.message:"Erro ao buscar personagem",success:!1}}}static async fetchCharacterFromServer(e){try{const t=new Promise(((e,t)=>{setTimeout((()=>t(new Error("Timeout ao buscar personagem"))),8e3)})),s=Ss.rpc("get_character_full_stats",{p_character_id:e}).single(),{data:a,error:r}=await Promise.race([s,t]);if(r)throw r;if(!a)return{data:null,error:"Personagem não encontrado",success:!1};const n=a,i={id:n.character_id,user_id:"",name:n.name,level:n.level,xp:n.xp,xp_next_level:n.xp_next_level,gold:n.gold,hp:n.hp,max_hp:n.max_hp,mana:n.mana,max_mana:n.max_mana,atk:n.atk,def:n.def,speed:n.speed,floor:1,strength:n.strength,dexterity:n.dexterity,intelligence:n.intelligence,wisdom:n.wisdom,vitality:n.vitality,luck:n.luck,attribute_points:n.attribute_points||0,critical_chance:n.critical_chance,critical_damage:n.critical_damage,sword_mastery:n.sword_mastery,axe_mastery:n.axe_mastery,blunt_mastery:n.blunt_mastery,defense_mastery:n.defense_mastery,magic_mastery:n.magic_mastery,sword_mastery_xp:n.sword_mastery_xp,axe_mastery_xp:n.axe_mastery_xp,blunt_mastery_xp:n.blunt_mastery_xp,defense_mastery_xp:n.defense_mastery_xp,magic_mastery_xp:n.magic_mastery_xp,is_alive:!0,created_at:"",updated_at:"",last_activity:void 0},{data:o,error:l}=await Ss.from("characters").select("user_id, floor, created_at, updated_at, last_activity").eq("id",i.id).maybeSingle();return!l&&o&&(i.user_id=o.user_id,i.floor=o.floor,i.created_at=o.created_at,i.updated_at=o.updated_at,i.last_activity=o.last_activity),Hs.setCachedCharacter(e,i),{data:i,error:null,success:!0}}catch(t){return{data:null,error:t instanceof Error?t.message:"Erro ao buscar personagem",success:!1}}}static async createCharacter(e){try{const t=ea.validateCharacterName(e.name);if(!t.isValid)return{data:null,error:t.error||"Nome inválido",success:!1};const s=await Ys.checkCharacterLimit(e.user_id);if(!s.success||!s.data?.can_create){const e=s.data?.next_slot_required_level||0;return{data:null,error:`Limite de personagens atingido. Para criar o ${(s.data?.available_slots||3)+1}º personagem, você precisa de ${e} níveis totais entre todos os seus personagens.`,success:!1}}const a=ea.formatCharacterName(e.name),r=await this.getUserCharacters(e.user_id);if(r.success&&r.data&&r.data.length>0){const e=r.data.map((e=>e.name));if(ea.isTooSimilar(a,e)){return{data:null,error:`Nome muito similar a um personagem existente. Sugestões: ${ea.generateNameSuggestions(a).join(", ")}`,success:!1}}}const{data:n,error:i}=await Ss.rpc("create_character",{p_user_id:e.user_id,p_name:a});if(i){if(i.message.includes("Nome"))return{data:null,error:i.message,success:!1};if(i.message.includes("Limite")||i.message.includes("personagem"))return{data:null,error:i.message,success:!1};throw i}return Hs.invalidateUserCache(e.user_id),{data:{id:n},error:null,success:!0}}catch(t){return{data:null,error:t instanceof Error?t.message:"Erro ao criar personagem",success:!1}}}static async deleteCharacter(e){try{const s=await this.getCharacter(e);if(s.success&&s.data&&s.data.floor>0)try{const{error:t}=await Ss.rpc("save_ranking_entry_on_death",{p_character_id:e})}catch(t){}const{error:a}=await Ss.rpc("delete_character",{p_character_id:e});if(a)throw a;return Hs.invalidateCharacterCache(e),s.success&&s.data&&Hs.invalidateUserCache(s.data.user_id),{error:null}}catch(s){return{error:s instanceof Error?s.message:"Erro ao deletar personagem"}}}static async getCharacterStats(e){try{const t=await this.getCharacterForGame(e);if(!t.success||!t.data)return{success:!1,error:t.error||"Erro ao carregar dados do personagem",data:null};const s=t.data;return{success:!0,error:null,data:{level:s.level,xp:s.xp,xp_next_level:s.xp_next_level,gold:s.gold,hp:s.hp,max_hp:s.max_hp,mana:s.mana,max_mana:s.max_mana,atk:s.atk,def:s.def,speed:s.speed,strength:s.strength||10,dexterity:s.dexterity||10,intelligence:s.intelligence||10,wisdom:s.wisdom||10,vitality:s.vitality||10,luck:s.luck||10,attribute_points:s.attribute_points||0,critical_chance:s.critical_chance||0,critical_damage:s.critical_damage||0,magic_damage_bonus:s.magic_damage_bonus||0,magic_attack:s.magic_attack||0,sword_mastery:s.sword_mastery||1,axe_mastery:s.axe_mastery||1,blunt_mastery:s.blunt_mastery||1,defense_mastery:s.defense_mastery||1,magic_mastery:s.magic_mastery||1,sword_mastery_xp:s.sword_mastery_xp||0,axe_mastery_xp:s.axe_mastery_xp||0,blunt_mastery_xp:s.blunt_mastery_xp||0,defense_mastery_xp:s.defense_mastery_xp||0,magic_mastery_xp:s.magic_mastery_xp||0,base_hp:s.base_hp||s.base_max_hp,base_max_hp:s.base_max_hp,base_mana:s.base_mana||s.base_max_mana,base_max_mana:s.base_max_mana,base_atk:s.base_atk,base_def:s.base_def,base_speed:s.base_speed,equipment_hp_bonus:s.equipment_hp_bonus||0,equipment_mana_bonus:s.equipment_mana_bonus||0,equipment_atk_bonus:s.equipment_atk_bonus||0,equipment_def_bonus:s.equipment_def_bonus||0,equipment_speed_bonus:s.equipment_speed_bonus||0}}}catch(t){return{success:!1,error:t instanceof Error?t.message:"Erro desconhecido",data:null}}}static async getCharacterForGame(e){try{const{data:t,error:a}=await Ss.from("characters").select("*").eq("id",e).maybeSingle();if(a)throw a;if(!t)return{success:!1,error:"Personagem não encontrado",data:null};const r=await Zs.calculateDerivedStats(t),n=await s((()=>Promise.resolve().then((()=>ma))),void 0).then((t=>t.SpellService.getCharacterEquippedSpells(e))),i=n.success&&n.data?n.data:[];return{success:!0,error:null,data:{id:t.id,user_id:t.user_id,name:t.name,level:t.level,xp:t.xp,xp_next_level:t.xp_next_level,gold:t.gold,hp:r.hp,max_hp:r.max_hp,mana:r.mana,max_mana:r.max_mana,atk:r.atk,def:r.def,speed:r.speed,created_at:t.created_at,updated_at:t.updated_at,isPlayerTurn:!0,specialCooldown:0,defenseCooldown:0,isDefending:!1,floor:t.floor,spells:i,consumables:[],active_effects:{buffs:[],debuffs:[],dots:[],hots:[],attribute_modifications:[]},strength:t.strength||10,dexterity:t.dexterity||10,intelligence:t.intelligence||10,wisdom:t.wisdom||10,vitality:t.vitality||10,luck:t.luck||10,attribute_points:t.attribute_points||0,sword_mastery:t.sword_mastery||1,axe_mastery:t.axe_mastery||1,blunt_mastery:t.blunt_mastery||1,defense_mastery:t.defense_mastery||1,magic_mastery:t.magic_mastery||1,sword_mastery_xp:t.sword_mastery_xp||0,axe_mastery_xp:t.axe_mastery_xp||0,blunt_mastery_xp:t.blunt_mastery_xp||0,defense_mastery_xp:t.defense_mastery_xp||0,magic_mastery_xp:t.magic_mastery_xp||0,critical_chance:r.critical_chance,critical_damage:r.critical_damage,magic_damage_bonus:r.magic_damage_bonus,magic_attack:r.magic_attack,double_attack_chance:r.double_attack_chance,base_hp:r.hp,base_max_hp:r.max_hp,base_mana:r.mana,base_max_mana:r.max_mana,base_atk:r.atk,base_def:r.def,base_speed:r.speed,equipment_hp_bonus:0,equipment_mana_bonus:0,equipment_atk_bonus:0,equipment_def_bonus:0,equipment_speed_bonus:0}}}catch(t){return{success:!1,error:t instanceof Error?t.message:"Erro desconhecido",data:null}}}static getUnlockedCheckpoints=Xs.getUnlockedCheckpoints;static startFromCheckpoint=Xs.startFromCheckpoint;static resetCharacterProgress=Xs.resetCharacterProgress;static updateCharacterFloor=Xs.updateCharacterFloor;static updateCharacterHpMana=Ws.updateCharacterHpMana;static applyAutoHeal=Ws.applyAutoHeal;static updateLastActivity=Ws.updateLastActivity;static getUserCharacterProgression=Ys.getUserCharacterProgression;static checkCharacterLimit=Ys.checkCharacterLimit;static grantSecureXP=Ys.grantSecureXP;static grantSecureGold=Ys.grantSecureGold;static addSkillXp=Ys.addSkillXp;static updateGold=Ys.updateGold;static calculateDerivedStats=Zs.calculateDerivedStats;static analyzeBuildDiversity=Zs.analyzeBuildDiversity;static distributeAttributePoints=Qs.distributeAttributePoints;static recalculateCharacterStats=Qs.recalculateCharacterStats}const sa=Object.freeze(Object.defineProperty({__proto__:null,CharacterService:ta},Symbol.toStringTag,{value:"Module"})),aa=()=>e.useContext(Ns);function ra(){const t=e.useContext(Fs);if(!t)throw new Error("useGameState deve ser usado dentro de um GameStateProvider");return t}const na=e.createContext(null);function ia({children:a}){const[r,n]=e.useState([]),[i,o]=e.useState(null),[l,c]=e.useState(!1),{user:d}=aa(),{gameState:m,setGameState:u,updateLoading:h}=ra(),{addGameLogMessage:p,setGameMessage:x}=Us(),f=e.useRef(!1),g=e.useRef(null),b=e.useRef(!1),v=e.useRef(null);e.useEffect((()=>{if(g.current!==d?.id&&(g.current=d?.id||null,n([]),o(null),c(!1),f.current=!1),!d?.id||l||f.current)return;(async()=>{try{f.current=!0,h("loadProgress",!0);const e=await ta.getUserCharacters(d.id);e.success&&e.data?(n(e.data),c(!0),e.data.length>0?x("Selecione um personagem para jogar!"):x("Você ainda não tem personagens. Crie um para começar!")):e.error&&_.error("Erro",{description:e.error})}catch(e){_.error("Erro",{description:e instanceof Error?e.message:"Erro ao carregar personagens"})}finally{h("loadProgress",!1),f.current=!1}})()}),[d?.id,l]);const y=e.useCallback((async e=>{if(d?.id){h("startGame",!0);try{const t=await ta.createCharacter({user_id:d.id,name:e});if(t.success&&t.data){const e=await ta.getCharacter(t.data.id);e.success&&e.data&&(n((t=>[...t,e.data])),o(e.data),_.success("Sucesso",{description:"Personagem criado com sucesso!"}),p(`${e.data.name} foi criado!`))}else if(t.error)throw new Error(t.error)}catch(t){_.error("Erro",{description:t instanceof Error?t.message:"Erro ao criar personagem"})}finally{h("startGame",!1)}}else _.error("Erro",{description:"Você precisa estar logado para criar um personagem."})}),[d?.id]),j=e.useCallback((async e=>{try{o(e);const t=await ta.getCharacterForGame(e.id);if(!t.success||!t.data)throw new Error(t.error||"Erro ao carregar dados do personagem");const s=t.data;u({mode:"menu",player:s,currentFloor:null,currentEnemy:null,currentSpecialEvent:null,isPlayerTurn:!0,gameMessage:"",highestFloor:s.floor,selectedSpell:null,battleRewards:null,fleeSuccessful:!1,characterDeleted:!1}),p(`${e.name} selecionado!`)}catch(t){_.error("Erro",{description:t instanceof Error?t.message:"Erro ao selecionar personagem"})}}),[]),N=e.useCallback((async e=>{try{o(e);const s=await ta.getCharacterForGame(e.id);if(!s.success||!s.data)throw new Error(s.error||"Erro ao carregar dados do personagem");let a=s.data;try{const t=await ta.applyAutoHeal(e.id);t.success&&t.data&&t.data.healed&&(a={...a,hp:t.data.newHp,mana:t.data.character.mana})}catch(t){}const r={mode:"hub",player:a,currentFloor:null,currentEnemy:null,currentSpecialEvent:null,isPlayerTurn:!0,gameMessage:"",highestFloor:Math.max(1,a.floor),selectedSpell:null,battleRewards:null,fleeSuccessful:!1,characterDeleted:!1};u(r),x(`Bem-vindo ao hub, ${a.name}!`)}catch(s){_.error("Erro",{description:s instanceof Error?s.message:"Erro ao carregar personagem"})}}),[u,x]),w=e.useCallback(((e,t)=>{const s=m;u({...s,player:{...s.player,hp:Math.floor(e),mana:Math.floor(t)}})}),[]),C=e.useCallback((()=>{c(!1),f.current=!1}),[]),E=e.useCallback((async(e,t)=>{if(!b.current){b.current=!0,v.current=t;try{h("loadProgress",!0),o(e);const{BattleInitializationService:t}=await s((async()=>{const{BattleInitializationService:e}=await import("./battle-initialization.service-BghrgNc3.js");return{BattleInitializationService:e}}),__vite__mapDeps([0,1,2,3,4,5,6])),a=await t.initializeBattle(e);if(!a.success)throw new Error(a.error||"Falha na inicialização");if(!a.gameState)throw new Error("Estado de jogo não foi gerado");u(a.gameState);const r=a.gameState.currentSpecialEvent?`Evento especial: ${a.gameState.currentSpecialEvent.name}`:`Andar ${a.gameState.player.floor} - ${a.gameState.currentEnemy?.name||"Combate"} iniciado!`;p(r,"system")}catch(a){throw _.error("Falha ao inicializar batalha",{description:a instanceof Error?a.message:"Erro ao inicializar batalha",duration:5e3}),v.current=null,a}finally{h("loadProgress",!1),b.current=!1}}}),[u,p,h]),S=e.useMemo((()=>({characters:r,selectedCharacter:i,createCharacter:y,selectCharacter:j,loadCharacterForHub:N,initializeBattle:E,updatePlayerStats:w,reloadCharacters:C})),[r,i,y,j,N,E,w,C]);return t.jsx(na.Provider,{value:S,children:a})}class oa{static calculateAttackSkillXp(e,t){const s=[];if(!e)return s;const a=(r=e,"weapon"===r.main_hand?.type?r.main_hand:void 0);var r;const n=function(e){return!("weapon"!==e.main_hand?.type||"weapon"!==e.off_hand?.type)}(e),i=Math.max(1,Math.floor(t/10));if(a){const e=this.getWeaponSkill(a);if(e){let t=i;n?(t=Math.floor(1.25*t),s.push({skill:e,xp:t,reason:`Ataque com ${a.name} (Dual-wield)`,isOffHand:!1})):s.push({skill:e,xp:t,reason:`Ataque com ${a.name}`,isOffHand:!1})}}if(n&&e.off_hand){const t=this.getWeaponSkill(e.off_hand);if(t){const a=Math.floor(.75*i);s.push({skill:t,xp:a,reason:`Ataque com ${e.off_hand.name} (Mão secundária)`,isOffHand:!0})}}return s}static calculateDefenseSkillXp(e,t=0){let s=Math.max(2,Math.floor(t/5)),a="Ação de defesa";var r;t<=0&&(s=3),e&&(r=e,"armor"===r.off_hand?.type&&!r.off_hand?.weapon_subtype)&&(s=Math.floor(2.5*s),a="Defesa com escudo equipado");const n=Math.max(1,Math.floor(s));return[{skill:$s.DEFENSE_MASTERY,xp:n,reason:a,isOffHand:!1}]}static calculateMagicSkillXp(e,t=0,s=0,a=null){const r=[],n=Math.floor(e/2);let i=0;s>0?i=Math.floor(s/8):t>0&&(i=Math.floor(t/8));const o=Math.max(2,n+i);if(r.push({skill:$s.MAGIC_MASTERY,xp:o,reason:`Uso de magia (${e} mana, ${s||t} efeito)`,isOffHand:!1}),"staff"===a?.off_hand?.weapon_subtype){const e=Math.max(1,Math.floor(.2*o));r.push({skill:$s.MAGIC_MASTERY,xp:e,reason:`Bônus por ${a.off_hand.name} (off-hand)`,isOffHand:!0})}return r}static getWeaponSkill(e){const t=e.name.toLowerCase(),s=[{keywords:["espada","sword","rapier","lâmina","adaga","dagger","punhal","fang"],skill:$s.SWORD_MASTERY},{keywords:["machado","axe","machadinha"],skill:$s.AXE_MASTERY},{keywords:["martelo","mace","clava","maça","porrete","hammer"],skill:$s.BLUNT_MASTERY},{keywords:["cajado","staff","varinha","orbe","bastão","cetro"],skill:$s.MAGIC_MASTERY}];for(const{keywords:a,skill:r}of s)if(a.some((e=>t.includes(e))))return r;return $s.SWORD_MASTERY}static async applySkillXp(e,t){const s=[],a=[];if(0===t.length)return{messages:s,skillLevelUps:a};for(const n of t)try{const t=await ta.addSkillXp(e,n.skill,n.xp);if(t.success&&t.data){const e=this.getSkillDisplayName(n.skill),r=n.isOffHand?" (off-hand)":"";if(t.data.skill_leveled_up){const i=`🎉 ${e} subiu para nível ${t.data.new_skill_level}!${r}`;s.push(i),a.push({skill:n.skill,newLevel:t.data.new_skill_level})}else{const t=`+${n.xp} XP em ${e}${r}`;s.push(t)}}}catch(r){}return{messages:s,skillLevelUps:a}}static getSkillDisplayName(e){return{[$s.SWORD_MASTERY]:"Maestria em Espadas",[$s.AXE_MASTERY]:"Maestria em Machados",[$s.BLUNT_MASTERY]:"Maestria em Armas de Concussão",[$s.DEFENSE_MASTERY]:"Maestria em Defesa",[$s.MAGIC_MASTERY]:"Maestria em Magia"}[e]||e}static calculateSkillDamageBonus(e){return Math.min(100,2*e)}static calculateSkillDefenseBonus(e){return Math.min(50,1*e)}static calculateManaEfficiency(e){return Math.min(40,1*e)}}class la{static enemyCache=new Map;static cacheExpiry=new Map;static CACHE_DURATION=3e4;static async getEnemyForFloor(e){if(e<=0)return{data:null,error:`Andar inválido: ${e}`,success:!1};const t=this.enemyCache.get(e),s=this.cacheExpiry.get(e),a=Date.now();if(t&&s&&a<s)return{data:t,error:null,success:!0};try{let{data:t,error:s}=await Ss.rpc("get_monster_for_floor_with_initiative",{p_floor:e});if(s?.message?.includes("does not exist")){const a=await Ss.rpc("get_monster_for_floor",{p_floor:e});t=a.data,s=a.error}if(s){const a=await Ss.from("monsters").select("*").lte("min_floor",e).order("min_floor",{ascending:!1}).limit(1);t=a.data?.[0]||null,s=a.error}if(s||!t){const t=this.generateFallbackEnemy(e);return this.cacheEnemy(e,t),{data:t,error:null,success:!0}}const a=Array.isArray(t)?t[0]:t,r=this.convertToEnemy(a,e);return await this.loadPossibleDrops(r),this.cacheEnemy(e,r),{data:r,error:null,success:!0}}catch(r){const t=this.generateFallbackEnemy(e);return this.cacheEnemy(e,t),{data:t,error:null,success:!0}}}static cacheEnemy(e,t){const s=Date.now();this.enemyCache.set(e,t),this.cacheExpiry.set(e,s+this.CACHE_DURATION)}static convertToEnemy(e,t){const s=e.level||Math.max(1,Math.floor(t/5)+1);return{id:e.id||`generated_${t}_${Date.now()}`,name:e.name||`Monstro Andar ${t}`,level:s,hp:e.hp||50+10*t,maxHp:e.hp||50+10*t,attack:e.atk||10+2*t,defense:e.def||5+1*t,speed:e.speed||10,image:e.image||"👾",behavior:e.behavior||"balanced",mana:e.mana||0,reward_xp:e.reward_xp||Math.floor(5+2*t),reward_gold:e.reward_gold||Math.floor(3+1*t),possible_drops:[],active_effects:{buffs:[],debuffs:[],dots:[],hots:[],attribute_modifications:[]},tier:e.tier||1,base_tier:e.base_tier||1,cycle_position:e.cycle_position||(t-1)%20+1,is_boss:e.is_boss||!1,strength:e.strength||10,dexterity:e.dexterity||10,intelligence:e.intelligence||10,wisdom:e.wisdom||10,vitality:e.vitality||10,luck:e.luck||10,critical_chance:e.critical_chance||.05,critical_damage:e.critical_damage||1.5,critical_resistance:e.critical_resistance||.1,physical_resistance:e.physical_resistance||0,magical_resistance:e.magical_resistance||0,debuff_resistance:e.debuff_resistance||0,physical_vulnerability:e.physical_vulnerability||1,magical_vulnerability:e.magical_vulnerability||1,primary_trait:e.primary_trait||"common",secondary_trait:e.secondary_trait||"basic",special_abilities:e.special_abilities||[]}}static async loadPossibleDrops(e){try{const{data:t}=await Ss.from("monster_possible_drops").select("\n          drop_id,\n          drop_chance,\n          min_quantity,\n          max_quantity,\n          monster_drops:drop_id (id, name, description, rarity, value)\n        ").eq("monster_id",e.id);t&&(e.possible_drops=t.map((e=>({drop_id:e.drop_id,drop_chance:e.drop_chance,min_quantity:e.min_quantity,max_quantity:e.max_quantity,drop_info:Array.isArray(e.monster_drops)?e.monster_drops[0]:e.monster_drops}))))}catch(t){}}static generateFallbackEnemy(e){const t=Math.max(1,Math.floor(e/5)+1),s=Math.max(1,Math.floor(e/20)+1),a=e%10==0,r=["Slime","Goblin","Orc","Skeleton","Wolf","Spider","Troll","Dragon"],n=`${a?"Boss ":""}${r[Math.floor(e/2)%r.length]}${s>1?` T${s}`:""}`,i=a?80:50,o=a?15:10,l=a?8:5,c=Math.floor(i+15*t+25*s),d=Math.floor(o+3*t+5*s),m=Math.floor(l+2*t+3*s),u=Math.floor(10+1*t+2*s),h=Math.floor((5+2*t+2*s)*(a?2.5:1)),p=Math.floor((3+1*t+1*s)*(a?2.5:1));return{id:`fallback_${e}_${Date.now()}`,name:n,level:t,hp:c,maxHp:c,attack:d,defense:m,speed:u,image:a?"👑":"👾",behavior:"balanced",mana:Math.floor(20+5*t),reward_xp:h,reward_gold:p,possible_drops:[],active_effects:{buffs:[],debuffs:[],dots:[],hots:[],attribute_modifications:[]},tier:s,base_tier:1,cycle_position:(e-1)%20+1,is_boss:a,strength:Math.floor(10+2*t),dexterity:Math.floor(10+1*t),intelligence:Math.floor(8+1*t),wisdom:Math.floor(8+1*t),vitality:Math.floor(12+2*t),luck:Math.floor(5+t),critical_chance:.05+.005*t,critical_damage:1.5+.05*t,critical_resistance:.1,physical_resistance:0,magical_resistance:0,debuff_resistance:0,physical_vulnerability:1,magical_vulnerability:1,primary_trait:a?"boss":"common",secondary_trait:"basic",special_abilities:a?["Boss Fury"]:[]}}static clearCache(){this.enemyCache.clear(),this.cacheExpiry.clear()}}const ca=Object.freeze(Object.defineProperty({__proto__:null,MonsterService:la},Symbol.toStringTag,{value:"Module"}));class da{static spellCache=new Map;static lastFetchTimestamp=0;static CACHE_DURATION=3e5;static clearCache(){this.spellCache.clear(),this.lastFetchTimestamp=0}static async getCharacterAvailableSpells(e){try{const{data:t,error:s}=await Ss.rpc("get_character_available_spells",{p_character_id:e});if(s)throw s;return{data:t.map((e=>({id:e.spell_id,name:e.name,description:e.description,effect_type:e.effect_type,mana_cost:e.mana_cost,cooldown:e.cooldown,effect_value:e.effect_value,duration:e.duration,unlocked_at_level:e.unlocked_at_level,is_equipped:e.is_equipped,slot_position:e.slot_position}))),error:null,success:!0}}catch(t){return{data:null,error:t instanceof Error?t.message:"Erro desconhecido",success:!1}}}static async setCharacterSpells(e,t){try{const[s,a,r]=t,{error:n}=await Ss.rpc("set_character_spells",{p_character_id:e,p_spell_1_id:s||null,p_spell_2_id:a||null,p_spell_3_id:r||null});if(n)throw n;return{data:null,error:null,success:!0}}catch(s){return{data:null,error:s instanceof Error?s.message:"Erro desconhecido",success:!1}}}static async getCharacterSpellStats(e){try{const{data:t,error:s}=await Ss.rpc("get_character_spell_stats",{p_character_id:e});if(s)throw s;return{data:t[0]||{total_available:0,total_equipped:0,highest_level_unlocked:1,spells_by_type:{}},error:null,success:!0}}catch(t){return{data:null,error:t instanceof Error?t.message:"Erro desconhecido",success:!1}}}static async getAvailableSpells(e){const t=Date.now();if(this.spellCache.has(e)&&t-this.lastFetchTimestamp<this.CACHE_DURATION)return{data:this.spellCache.get(e),error:null,success:!0};try{const{data:s,error:a}=await Ss.rpc("get_available_spells",{p_level:e});if(a)throw a;return this.spellCache.set(e,s||[]),this.lastFetchTimestamp=t,{data:s||[],error:null,success:!0}}catch(s){return{data:null,error:s instanceof Error?s.message:"Erro desconhecido",success:!1}}}static calculateScaledSpellDamage(e,t){if(!("intelligence"in t)||!("wisdom"in t)||!("magic_mastery"in t))return e;const s=t.intelligence||10,a=t.wisdom||10,r=t.magic_mastery||1;let n=1.8*Math.pow(s,1.35)+1.2*Math.pow(a,1.2)+2.5*Math.pow(r,1.2);n>150&&(n=150+.6*(n-150)),n=Math.min(300,n);return Math.round(e*(1+n/100))}static calculateScaledSpellHealing(e,t){if(!("wisdom"in t)||!("magic_mastery"in t))return e;const s=t.wisdom||10,a=t.magic_mastery||1;let r=2.2*Math.pow(s,1.3)+1.8*Math.pow(a,1.15);r>120&&(r=120+.5*(r-120)),r=Math.min(220,r);return Math.round(e*(1+r/100))}static applySpellEffect(e,t,s){const a={damage:()=>{const a=this.calculateScaledSpellDamage(e.effect_value,t);return s.hp=Math.max(0,s.hp-a),`${e.name} causou ${a} de dano mágico!`},heal:()=>{const a=this.calculateScaledSpellHealing(e.effect_value,t),r="max_hp"in s?s.max_hp:s.maxHp,n=s.hp;s.hp=Math.min(r,s.hp+a);const i=s.hp-n;return`${e.name} restaurou ${i} HP!`},buff:()=>this.applyAttributeEffect(e,s,"buff"),debuff:()=>this.applyAttributeEffect(e,s,"debuff"),dot:()=>this.applyOverTimeEffect(e,s,"dot"),hot:()=>this.applyOverTimeEffect(e,s,"hot")};try{return{message:a[e.effect_type]?.()||`${e.name} não teve efeito!`,success:!0}}catch(r){return{message:`Erro ao usar ${e.name}!`,success:!1}}}static applyAttributeEffect(e,t,s){if(!t.active_effects)return`${e.name} não teve efeito!`;const a=this.calculateScaledSpellDamage(e.effect_value,t),r={type:s,value:a,duration:e.duration,source_spell:e.name};if("buff"===s){t.active_effects.buffs.push(r);const s=this.getAttributeModificationsForSpell(e);if(s.length>0&&t.active_effects.attribute_modifications){t.active_effects.attribute_modifications.push(...s);const a=s.map((e=>`+${e.value}${"percentage"===e.type?"%":""} ${this.translateAttributeName(e.attribute)}`)).join(", ");return`${e.name} aumentou: ${a}!`}return`${e.name} aplicou um efeito benéfico (+${a})!`}return t.active_effects.debuffs.push(r),`${e.name} aplicou um efeito prejudicial (-${a})!`}static applyOverTimeEffect(e,t,s){if(!t.active_effects)return`${e.name} não teve efeito!`;const a="dot"===s?this.calculateScaledSpellDamage(e.effect_value,t):this.calculateScaledSpellHealing(e.effect_value,t),r={type:s,value:a,duration:e.duration,source_spell:e.name};return"dot"===s?(t.active_effects.dots.push(r),`${e.name} aplicou dano contínuo (${a} por ${e.duration} turnos)!`):(t.active_effects.hots.push(r),`${e.name} aplicou cura contínua (${a} por ${e.duration} turnos)!`)}static processOverTimeEffects(e){const t=[];return"active_effects"in e&&e.active_effects?(e.active_effects.dots=e.active_effects.dots.filter((s=>(e.hp=Math.max(0,e.hp-s.value),s.duration--,t.push(`${s.source_spell} causou ${s.value} de dano contínuo.`),s.duration>0))),e.active_effects.hots=e.active_effects.hots.filter((s=>{const a="max_hp"in e?e.max_hp:e.maxHp,r=e.hp;e.hp=Math.min(a,e.hp+s.value);const n=e.hp-r;return s.duration--,n>0&&t.push(`${s.source_spell} restaurou ${n} HP.`),s.duration>0})),e.active_effects.attribute_modifications&&(e.active_effects.attribute_modifications=e.active_effects.attribute_modifications.filter((e=>(e.duration--,!(e.duration<=0)||(t.push(`O efeito de ${e.source_spell} em ${this.translateAttributeName(e.attribute)} expirou.`),!1))))),t):t}static updateSpellCooldowns(e){return e.player.spells.forEach((e=>{e.current_cooldown>0&&e.current_cooldown--})),e}static getSpellTypeIcon(e){return{damage:"⚔️",heal:"❤️",buff:"🛡️",debuff:"💀",dot:"🔥",hot:"✨"}[e]||"🔮"}static getSpellTypeColor(e){return{damage:"text-red-500",heal:"text-green-500",buff:"text-blue-500",debuff:"text-purple-500",dot:"text-orange-500",hot:"text-emerald-500"}[e]||"text-gray-500"}static translateEffectType(e){return{damage:"Dano",heal:"Cura",buff:"Benefício",debuff:"Maldição",dot:"Dano Contínuo",hot:"Cura Contínua"}[e]||e}static getAttributeModificationsForSpell(e){const t=[],s=e.name.toLowerCase();return[{keywords:["força","strength","fortalecer"],attribute:"atk",multiplier:.5},{keywords:["velocidade","speed","agilidade"],attribute:"speed",multiplier:.3},{keywords:["defesa","defense","proteção"],attribute:"def",multiplier:.4},{keywords:["crítico","critical","precisão"],attribute:"critical_chance",multiplier:.2,type:"percentage"},{keywords:["magia","magic","mystic"],attribute:"magic_attack",multiplier:.6}].forEach((({keywords:a,attribute:r,multiplier:n,type:i="flat"})=>{a.some((e=>s.includes(e)))&&t.push({attribute:r,value:Math.floor(e.effect_value*n),type:i,duration:e.duration,source_spell:e.name,applied_at:Date.now()})})),t}static translateAttributeName(e){return{atk:"Ataque",def:"Defesa",speed:"Velocidade",magic_attack:"Ataque Mágico",critical_chance:"Chance Crítica",critical_damage:"Dano Crítico"}[e]||e}static async getCharacterEquippedSpells(e){try{const{data:t,error:s}=await Ss.from("character_spell_slots").select("\n          slot_position,\n          spell_id,\n          spell:spells(\n            id,\n            name,\n            description,\n            mana_cost,\n            cooldown,\n            effect_type,\n            effect_value,\n            duration,\n            unlocked_at_level\n          )\n        ").eq("character_id",e).not("spell_id","is",null).order("slot_position");if(s)throw s;return{data:(t||[]).map((e=>{const t=Array.isArray(e.spell)?e.spell[0]:e.spell;return{id:t.id,name:t.name,description:t.description,mana_cost:t.mana_cost,cooldown:t.cooldown,current_cooldown:0,effect_type:t.effect_type,effect_value:t.effect_value,duration:t.duration||0,unlocked_at_level:t.unlocked_at_level}})),error:null,success:!0}}catch(t){return{data:null,error:t instanceof Error?t.message:"Erro desconhecido",success:!1}}}}const ma=Object.freeze(Object.defineProperty({__proto__:null,SpellService:da},Symbol.toStringTag,{value:"Module"}));class ua{static async killCharacter(e,t="Battle defeat",s){try{const{data:a,error:r}=await Ss.rpc("kill_character",{p_character_id:e,p_death_cause:t,p_killed_by_monster:s||null});if(r)throw r;return{success:!0,data:a,error:null}}catch(a){return{success:!1,data:null,error:a instanceof Error?a.message:"Erro desconhecido ao matar personagem"}}}static async getUserCemetery(e,t={}){try{const{page:s=1,limit:a=10}=t,r=(s-1)*a,{data:n,error:i}=await Ss.rpc("get_user_cemetery",{p_user_id:e,p_limit:a,p_offset:r});if(i)throw i;const{data:o,error:l}=await Ss.rpc("count_user_cemetery",{p_user_id:e});if(l)throw l;const{data:c,error:d}=await Ss.rpc("get_cemetery_stats",{p_user_id:e});if(d)throw d;const m=n,u=o;return{success:!0,data:{characters:m,total:u,stats:c?.[0]||{total_deaths:0,highest_level_reached:0,highest_floor_reached:0,total_survival_time_hours:0,most_common_death_cause:"N/A",deadliest_monster:"N/A"},hasMore:r+m.length<u},error:null}}catch(s){return{success:!1,data:null,error:s instanceof Error?s.message:"Erro ao buscar cemitério"}}}static async getCemeteryStats(e){try{const{data:t,error:s}=await Ss.rpc("get_cemetery_stats",{p_user_id:e});if(s)throw s;return{success:!0,data:t?.[0]||{total_deaths:0,highest_level_reached:0,highest_floor_reached:0,total_survival_time_hours:0,most_common_death_cause:"N/A",deadliest_monster:"N/A"},error:null}}catch(t){return{success:!1,data:null,error:t instanceof Error?t.message:"Erro ao buscar estatísticas"}}}static async hasCemetery(e){try{const{data:t,error:s}=await Ss.rpc("count_user_cemetery",{p_user_id:e});if(s)throw s;return{success:!0,data:t>0,error:null}}catch(t){return{success:!1,data:!1,error:t instanceof Error?t.message:"Erro ao verificar cemitério"}}}static formatSurvivalTime(e){if(e<60)return`${e} min`;if(e<1440){const t=Math.floor(e/60),s=e%60;return s>0?`${t}h ${s}min`:`${t}h`}{const t=Math.floor(e/1440),s=Math.floor(e%1440/60);return s>0?`${t}d ${s}h`:`${t}d`}}static formatDeathCause(e,t){return{"Battle defeat":t?`Morto por ${t}`:"Morto em batalha","Player quit":"Abandonou a jornada","System error":"Erro do sistema"}[e]||e}}class ha{static validateNumber(e,t=0,s,a){let r=Number(e);return!isNaN(r)&&isFinite(r)&&null!=e||(r=t),void 0!==s&&(r=Math.max(s,r)),void 0!==a&&(r=Math.min(a,r)),Math.floor(r)}static validateHP(e,t){const s=this.validateNumber(t,1,1);return this.validateNumber(e,1,0,s)}static validateMana(e,t){const s=this.validateNumber(t,1,0);return this.validateNumber(e,0,0,s)}static validateAttack(e){return this.validateNumber(e,1,1)}static validateDefense(e){return this.validateNumber(e,0,0)}static validateSpeed(e){return this.validateNumber(e,1,1)}static validatePlayerStats(e){return{...e,hp:this.validateHP(e.hp,e.max_hp),max_hp:this.validateNumber(e.max_hp,1,1),mana:this.validateMana(e.mana,e.max_mana),max_mana:this.validateNumber(e.max_mana,1,0),atk:this.validateAttack(e.atk),def:this.validateDefense(e.def),speed:this.validateSpeed(e.speed),level:this.validateNumber(e.level,1,1),xp:this.validateNumber(e.xp,0,0),gold:this.validateNumber(e.gold,0,0),floor:this.validateNumber(e.floor,1,1)}}static validateEnemyStats(e){return{...e,hp:this.validateHP(e.hp,e.maxHp),maxHp:this.validateNumber(e.maxHp,1,1),attack:this.validateAttack(e.attack),defense:this.validateDefense(e.defense),speed:this.validateSpeed(e.speed),level:this.validateNumber(e.level,1,1),mana:this.validateNumber(e.mana,0,0),reward_xp:this.validateNumber(e.reward_xp,1,0),reward_gold:this.validateNumber(e.reward_gold,0,0)}}static logValidation(e,t,s){Number(t)!==s||isNaN(Number(t))}}class pa{static calculateInitiative(e,t){const s=e,a=Math.floor(.5*t),r=.9+.2*Math.random(),n=Math.floor((s+a)*r);return Math.max(1,n)}static calculateExtraTurns(e,t){if(t<=0)return 2;const s=e/t;let a=0;return s>=3.5?a=3:s>=2.5?a=2:s>=1.8&&(a=1),a<3&&Math.random()<.2&&(a+=1),Math.min(a,3)}static calculateDamage(e,t,s=0,a=110,r=0,n=10,i=10){const o=Number(e)||0,l=Number(t)||0;if(o<=0)return{damage:1,isCritical:!1,isDoubleAttack:!1,totalAttacks:1,damageBreakdown:"Dano mínimo: 1"};const c=Math.max(1,Math.floor(o-.5*l)),d=100*Math.random()<s,m=r+Math.floor(.5*(n-10))+Math.floor(.3*(i-10)),u=100*Math.random()<Math.min(35,m);let h=c,p=`Base: ${c}`;if(d){const e=a/100;h=Math.floor(h*e),p+=` → Crítico (${a}%): ${h}`}let x=1;return u&&(h*=2,x=2,p+=` → Duplo Ataque (DEX: ${n}, SPD: ${i}): ${h}`),{damage:h,isCritical:d,isDoubleAttack:u,totalAttacks:x,damageBreakdown:p}}static async processPlayerAction(e,t,a,r){const n={...t},i=[],o=[],l=[];let c=!1,d="",m=0;switch(e){case"attack":if(n.currentEnemy&&n.currentEnemy.hp>0){const e=await this.getPlayerEquipmentSlots(n.player.id),t=this.calculateDamage(n.player.atk,n.currentEnemy.defense,n.player.critical_chance||0,n.player.critical_damage||110,n.player.double_attack_chance||0,n.player.dexterity||10,n.player.speed||10);m=t.damage;const s=t.isCritical,a=t.isDoubleAttack;n.currentEnemy.hp=Math.max(0,n.currentEnemy.hp-m),n.player.isDefending&&(n.player.isDefending=!1);let r=`${n.player.name} atacou ${n.currentEnemy.name}`;if(a&&(r+=" com ataque duplo"),s&&(r+=" CRITICAMENTE"),r+=` causando ${m} de dano!`,i.push({message:r,type:"player_action"}),e){const t=oa.calculateAttackSkillXp(e,m);if(t.length>0){o.push(...t);try{const{messages:e,skillLevelUps:s}=await oa.applySkillXp(n.player.id,t);for(const t of e)i.push({message:t,type:"skill_xp"});l.push(...e);for(const t of s);}catch(u){}}}n.currentEnemy.hp<=0?(i.push({message:`${n.currentEnemy.name} foi derrotado!`,type:"system"}),d=`Você derrotou ${n.currentEnemy.name}!`):d=r}break;case"defend":if(0===n.player.defenseCooldown){n.player.isDefending=!0,n.player.defenseCooldown=3;const e=`${n.player.name} assumiu postura defensiva.`;i.push({message:e,type:"player_action"});const t=await this.getPlayerEquipmentSlots(n.player.id);if(t){const e=oa.calculateDefenseSkillXp(t,0);if(e.length>0){o.push(...e);try{const{messages:t}=await oa.applySkillXp(n.player.id,e);for(const e of t)i.push({message:e,type:"skill_xp"});l.push(...t)}catch(u){}}}d=e}else d=`Defesa está em cooldown por mais ${n.player.defenseCooldown} turnos.`,c=!0;break;case"spell":if(a){const e=n.player.spells.find((e=>e.id===a));if(e&&n.player.mana>=e.mana_cost&&0===e.current_cooldown){n.player.mana=Math.max(0,n.player.mana-e.mana_cost),e.current_cooldown=e.cooldown;let t="",s=0;if("damage"===e.effect_type&&n.currentEnemy){let a=e.effect_value;if(n.player.magic_attack&&(a+=Math.floor(.5*n.player.magic_attack)),n.player.magic_mastery&&n.player.magic_mastery>1){a+=Math.floor(a*(n.player.magic_mastery-1)*.1)}s=a,n.currentEnemy.hp=Math.max(0,n.currentEnemy.hp-a),t=`causando ${a} de dano mágico`,n.currentEnemy.hp<=0&&(t+=` e derrotando ${n.currentEnemy.name}`)}else if("heal"===e.effect_type){let a=e.effect_value;if(n.player.magic_attack&&(a+=Math.floor(.3*n.player.magic_attack)),n.player.magic_mastery&&n.player.magic_mastery>1){a+=Math.floor(a*(n.player.magic_mastery-1)*.1)}s=a,n.player.hp=Math.min(n.player.max_hp,n.player.hp+a),t=`restaurando ${a} de vida`}const a=`${n.player.name} lançou ${e.name} ${t}!`;i.push({message:a,type:"player_action"});const r=await this.getPlayerEquipmentSlots(n.player.id),c=oa.calculateMagicSkillXp(e.mana_cost,"damage"===e.effect_type?s:0,s,r);if(c.length>0){o.push(...c);try{const{messages:e}=await oa.applySkillXp(n.player.id,c);for(const t of e)i.push({message:t,type:"skill_xp"});l.push(...e)}catch(u){}}d=a}else d="Não é possível usar esta magia agora.",c=!0}break;case"flee":return this.processFleeResult(t);case"consumable":if(r)try{if(r.startsWith("slot_")){const e=parseInt(r.replace("slot_","")),{SlotService:t}=await s((async()=>{const{SlotService:e}=await Promise.resolve().then((()=>Ex));return{SlotService:e}}),void 0),a=await t.consumePotionFromSlot(n.player.id,e);a.success&&a.data?(n.player={...n.player,hp:Math.floor(Number(a.data.new_hp)||n.player.hp),mana:Math.floor(Number(a.data.new_mana)||n.player.mana)},d=a.data.message,i.push({message:a.data.message,type:"player_action"}),c=!1):(d=a.error||"Erro ao usar poção do slot.",c=!0)}else{const{ConsumableService:e}=await s((async()=>{const{ConsumableService:e}=await Promise.resolve().then((()=>Yp));return{ConsumableService:e}}),void 0),t={...n.player},a=await e.consumeItem(n.player.id,r,t);a.success&&a.data?(n.player={...n.player,hp:Math.floor(Number(t.hp)||n.player.hp),mana:Math.floor(Number(t.mana)||n.player.mana),atk:Math.floor(Number(t.atk)||n.player.atk),def:Math.floor(Number(t.def)||n.player.def)},d=a.data.message,i.push({message:a.data.message,type:"player_action"}),c=!1):(d=a.error||"Erro ao usar item consumível.",c=!0)}}catch(u){d="Erro ao usar item consumível.",c=!0}else d="Item consumível não especificado.",c=!0;break;case"special":d="Habilidade especial ainda não implementada.",c=!0;break;case"continue":try{const{GameService:e}=await s((async()=>{const{GameService:e}=await Promise.resolve().then((()=>ga));return{GameService:e}}),void 0),t=await e.advanceToNextFloor(n);Object.assign(n,t),d=t.gameMessage||"Avançando para o próximo andar...",c=!1}catch(u){d="Erro ao avançar para o próximo andar",c=!0}break;case"interact_event":try{const{GameService:e}=await s((async()=>{const{GameService:e}=await Promise.resolve().then((()=>ga));return{GameService:e}}),void 0),t=await e.processSpecialEventInteraction(n);Object.assign(n,t),d=t.gameMessage||"Evento especial processado com sucesso!",c=!1}catch(u){d="Erro ao processar evento especial",c=!0}break;default:d="Ação não reconhecida.",c=!0}return n.player.defenseCooldown>0&&n.player.defenseCooldown--,"consumable"!==e&&(n.player.potionUsedThisTurn=!1),n.player=ha.validatePlayerStats(n.player),n.currentEnemy&&(n.currentEnemy=ha.validateEnemyStats(n.currentEnemy)),{newState:n,skipTurn:c,message:d,skillXpGains:o,skillMessages:l,gameLogMessages:i}}static async processFleeResult(e){const t=await this.processFleeAttempt(e);return{newState:t,skipTurn:t.fleeSuccessful||!1,message:t.gameMessage||"Tentativa de fuga processada",skillXpGains:[],skillMessages:[],gameLogMessages:[]}}static async getPlayerEquipmentSlots(e){try{return await Js.getEquippedItems(e)}catch(t){return null}}static async processPlayerDeath(e,t,s,a){try{return(await ua.killCharacter(t.id,"Battle defeat",s.name)).success?{...e,player:{...t,hp:0,isDefending:!1},mode:"gameover",isPlayerTurn:!0,gameMessage:`${a} Você foi derrotado! Seu personagem foi perdido permanentemente.`,characterDeleted:!0}:{...e,player:{...t,hp:0,isDefending:!1},mode:"gameover",isPlayerTurn:!0,gameMessage:`${a} Você foi derrotado!`}}catch(r){return{...e,player:{...t,hp:0,isDefending:!1},mode:"gameover",isPlayerTurn:!0,gameMessage:`${a} Você foi derrotado!`}}}static async processFleeAttempt(e){const{player:t,currentEnemy:s}=e;if(!s)return e;const a=(t.speed||10)-(s.speed||10);let r=70+Math.floor(2*a);r=Math.max(15,Math.min(95,r));if(100*Math.random()<r)return{...e,fleeSuccessful:!0,currentEnemy:null,mode:"fled",battleRewards:null,isPlayerTurn:!0,gameMessage:`${t.name} fugiu da batalha com sucesso!`};{const a=Math.floor(.3*(s.attack||10)),r=Math.max(0,t.hp-a);return r<=0?this.processPlayerDeath(e,t,s,`${t.name} tentou fugir mas falhou!`):{...e,player:{...t,hp:r},fleeSuccessful:!1,gameMessage:`${t.name} tentou fugir mas falhou! Sofreu ${a} de dano.`}}}static async processEnemyAction(e,t){if(!e.currentEnemy||e.currentEnemy.hp<=0)return{newState:{...e,isPlayerTurn:!0}};const s=e.currentEnemy,a=e.player,r=[];if(da.processOverTimeEffects(s),s.hp<=0)return{newState:{...e,isPlayerTurn:!0,gameMessage:`${s.name} foi derrotado por efeitos ao longo do tempo!`}};let n="attack";const i=s.special_abilities&&s.special_abilities.length>0,o=(s.intelligence||10)>(s.strength||10);let l=.15,c=.2;switch(s.behavior){case"aggressive":l=.25,c=.1;break;case"defensive":l=.3,c=.15;break;case"balanced":o?(c=.35,l=.2):(c=.2,l=.2)}i&&(l+=.1),i&&Math.random()<l?n="special":s.mana>=10&&Math.random()<c&&(n="spell");let d="",m=0,u=0;switch(n){case"attack":{const n=this.calculateDamage(s.attack,a.def,s.critical_chance||0,s.critical_damage||110,0,s.dexterity||10,s.speed||10);if(m=n.damage,a.isDefending||t){u=Math.floor(.15*m);let e=`${s.name} atacou`;n.isCritical&&(e+=" com golpe crítico"),n.isDoubleAttack&&(e+=` ${n.totalAttacks}x`),e+=`, mas você reduziu o dano de ${m} para ${u} com sua defesa!`,d=e;try{const e=m-u,t=oa.calculateDefenseSkillXp(null,e);r.push(...t)}catch(h){}}else{u=m;let e=`${s.name} atacou`;n.isCritical&&(e+=" com golpe crítico"),n.isDoubleAttack&&(e+=` ${n.totalAttacks}x`),e+=` e causou ${u} de dano!`,d=e;try{const e=oa.calculateDefenseSkillXp(null,Math.floor(.3*u));r.push(...e)}catch(h){}}const i=Math.max(0,a.hp-u);if(i<=0)return{newState:await this.processPlayerDeath(e,a,s,d)};const o={...e,player:{...a,hp:i,isDefending:!1,potionUsedThisTurn:!1},isPlayerTurn:!0,gameMessage:d},l=r.length>0?r.map((e=>`+${e.xp} XP em ${oa.getSkillDisplayName(e.skill)}`)):void 0;return{newState:da.updateSpellCooldowns(o),skillXpGains:r,skillMessages:l}}case"spell":{const n=Math.floor(1.2*s.attack),i=10;if(a.isDefending||t){u=Math.floor(.15*n),d=`${s.name} lançou uma magia, mas você reduziu o dano de ${n} para ${u} com sua defesa!`;try{const e=await Js.getEquippedItems(a.id)||null,t=Math.floor(.5*(n-u)),s=oa.calculateDefenseSkillXp(e,t);r.push(...s)}catch(h){}}else u=n,d=`${s.name} lançou uma magia e causou ${u} de dano mágico!`;const o=Math.max(0,a.hp-u);if(o<=0)return{newState:await this.processPlayerDeath(e,a,s,d)};const l={...e,player:{...a,hp:o,isDefending:!1,potionUsedThisTurn:!1},currentEnemy:{...s,mana:Math.max(0,s.mana-i)},isPlayerTurn:!0,gameMessage:d},c=r.length>0?r.map((e=>`+${e.xp} XP em ${oa.getSkillDisplayName(e.skill)}`)):void 0;return{newState:da.updateSpellCooldowns(l),skillXpGains:r,skillMessages:c}}case"special":{const n=s.special_abilities||[];if(n.length>0){const r=n[Math.floor(Math.random()*n.length)],i=r.split(":")[0].trim();if(r.includes("Regenera")||r.includes("Recupera")||r.includes("cura")){const t=Math.floor(s.maxHp*(.1+.15*Math.random())),r=Math.min(s.maxHp,s.hp+t),n={...e,player:{...a,potionUsedThisTurn:!1},currentEnemy:{...s,hp:r},isPlayerTurn:!0,gameMessage:`${s.name} usou ${i} e recuperou ${t} HP!`};return{newState:da.updateSpellCooldowns(n)}}r.includes("dano")||r.includes("ATK")||r.includes("Ataque")?(m=Math.floor(s.attack*(1.3+.7*Math.random())),u=a.isDefending||t?Math.floor(.15*m):m,d=`${s.name} usou ${i} e causou ${u} de dano!`):r.includes("crítico")||r.includes("Crítico")?(m=Math.floor(2*s.attack),u=a.isDefending||t?Math.floor(.15*m):m,d=`${s.name} usou ${i} com um golpe crítico devastador! ${u} de dano!`):r.includes("área")||r.includes("todos")?(m=Math.floor(1.2*s.attack),u=a.isDefending||t?Math.floor(.15*m):m,d=`${s.name} usou ${i} em área! ${u} de dano!`):(m=Math.floor(s.attack*(1.2+.5*Math.random())),u=a.isDefending||t?Math.floor(.15*m):m,d=`${s.name} usou ${i}! ${u} de dano!`)}else switch(s.behavior){case"aggressive":m=Math.floor(1.5*s.attack),u=a.isDefending||t?Math.floor(.15*m):m,d=`${s.name} usou Ataque Furioso e causou ${u} de dano!`;break;case"defensive":{const t=Math.floor(.15*s.maxHp),r=Math.min(s.maxHp,s.hp+t),n={...e,player:{...a,potionUsedThisTurn:!1},currentEnemy:{...s,hp:r},isPlayerTurn:!0,gameMessage:`${s.name} se concentrou e recuperou ${t} HP!`};return{newState:da.updateSpellCooldowns(n)}}default:m=Math.floor(1.3*s.attack),u=a.isDefending||t?Math.floor(.15*m):m,d=`${s.name} usou uma habilidade especial e causou ${u} de dano!`}if(u>0)try{const e=await Js.getEquippedItems(a.id)||null;if(a.isDefending||t){const t=m-u,s=oa.calculateDefenseSkillXp(e,t);r.push(...s)}else{const t=oa.calculateDefenseSkillXp(e,Math.floor(.2*u));r.push(...t)}}catch(h){}const i=Math.max(0,a.hp-u);if(i<=0)return{newState:await this.processPlayerDeath(e,a,s,d)};const o={...e,player:{...a,hp:i,isDefending:!1,potionUsedThisTurn:!1},isPlayerTurn:!0,gameMessage:d},l=r.length>0?r.map((e=>`+${e.xp} XP em ${oa.getSkillDisplayName(e.skill)}`)):void 0;return{newState:da.updateSpellCooldowns(o),skillXpGains:r,skillMessages:l}}default:{const t={...e,player:{...e.player,potionUsedThisTurn:!1},isPlayerTurn:!0};return{newState:da.updateSpellCooldowns(t)}}}}}class xa{static clearAllGameCaches(){Promise.all([s((()=>import("./floor.service-r0yLIAYT.js")),__vite__mapDeps([1,2,3,4,5,6])).then((e=>e.FloorService.clearCache())),s((()=>Promise.resolve().then((()=>ca))),void 0).then((e=>e.MonsterService.clearCache())),s((()=>Promise.resolve().then((()=>Gs))),void 0).then((e=>e.CharacterCacheService.clearAllCache()))]).catch((e=>{}))}static clearCharacterCache(e){s((()=>Promise.resolve().then((()=>Gs))),void 0).then((t=>t.CharacterCacheService.invalidateCharacterCache(e))).catch((e=>{}))}static clearUserCache(e){s((()=>Promise.resolve().then((()=>Gs))),void 0).then((t=>t.CharacterCacheService.invalidateUserCache(e))).catch((e=>{}))}}class fa{static clearAllCaches(){xa.clearAllGameCaches()}static async generateEnemy(e){try{const{data:t,success:s}=await la.getEnemyForFloor(e);return s&&t?t:null}catch(t){return null}}static async saveGameProgress(e,t){const{player:s,currentFloor:a}=e,r={user_id:t,player_name:s.name,current_floor:s.floor,hp:s.hp,max_hp:s.max_hp,attack:s.atk,defense:s.def,highest_floor:Math.max(s.floor,a?.floorNumber||1)};try{const{data:e,error:t}=await Ss.from("game_progress").upsert(r).select();return t?{success:!1,error:t.message,data:null}:{success:!0,error:void 0,data:e[0]}}catch(n){return{success:!1,error:n instanceof Error?n.message:"Erro desconhecido",data:null}}}static async loadGameProgress(e){try{const{data:t,error:s}=await Ss.from("game_progress").select("*").eq("user_id",e).order("updated_at",{ascending:!1}).limit(1);return s?{success:!1,error:s.message,data:null}:{success:!0,error:void 0,data:t[0]||null}}catch(t){return{success:!1,error:t instanceof Error?t.message:"Erro desconhecido",data:null}}}static async processPlayerAction(e,t,s,a){return pa.processPlayerAction(e,t,s,a)}static async processEnemyDefeat(e){const{RewardService:t}=await s((async()=>{const{RewardService:e}=await import("./reward.service-Auo9OQyl.js");return{RewardService:e}}),__vite__mapDeps([7,1,2,3,4,5,6]));return t.processEnemyDefeat(e)}static async processEnemyActionWithDelay(e,t,s){if(!e.currentEnemy||e.currentEnemy.hp<=0)return{newState:e};const a=s??1500+1e3*Math.random();return await new Promise((e=>setTimeout(e,a))),!e.currentEnemy||e.currentEnemy.hp<=0?{newState:e}:pa.processEnemyAction(e,t)}static async advanceToNextFloor(e){const{GameStateService:t}=await s((async()=>{const{GameStateService:e}=await import("./game-state.service-BO5lp073.js");return{GameStateService:e}}),__vite__mapDeps([8,1,2,3,4,5,6]));return t.advanceToNextFloor(e)}static async processSpecialEventInteraction(e){const{FloorService:t}=await s((async()=>{const{FloorService:e}=await import("./floor.service-r0yLIAYT.js");return{FloorService:e}}),__vite__mapDeps([1,2,3,4,5,6]));return t.processSpecialEventInteraction(e)}static async loadPlayerForGame(e){const{GameStateService:t}=await s((async()=>{const{GameStateService:e}=await import("./game-state.service-BO5lp073.js");return{GameStateService:e}}),__vite__mapDeps([8,1,2,3,4,5,6]));return t.loadPlayerForGame(e)}static calculateInitiative=pa.calculateInitiative;static calculateExtraTurns=pa.calculateExtraTurns;static calculateDamage=pa.calculateDamage;static processEnemyAction=pa.processEnemyAction}const ga=Object.freeze(Object.defineProperty({__proto__:null,GameService:fa},Symbol.toStringTag,{value:"Module"}));function ba(){const t=e.useContext(na);if(!t)throw new Error("useCharacter deve ser usado dentro de um CharacterProvider");return t}const va=e.createContext(null);function ya({children:s}){const{gameState:a,setGameState:r,updateLoading:n}=ra(),{addGameLogMessage:i}=Us(),{selectedCharacter:o}=ba(),l=e.useRef({timestamp:0,action:"",processing:!1}),c=e.useCallback((()=>{l.current.processing=!1,n("performAction",!1)}),[n]),d=e.useCallback((async(e,t,s)=>{const d=Date.now(),m=d-l.current.timestamp,u=l.current.action===e;if(o&&!l.current.processing&&"gameover"!==a.mode&&!(u&&m<2e3||m<500)){l.current={timestamp:d,action:e,processing:!0},n("performAction",!0);try{const n=await fa.processPlayerAction(e,a,t,s),{newState:l,skipTurn:d,message:m,skillXpGains:u,gameLogMessages:p}=n;if(p?.length&&p.forEach((e=>{i(e.message,e.type)})),u?.length&&o)try{for(const e of u)await ta.addSkillXp(o.id,e.skill,e.xp)}catch(h){}if(r(l),"flee"===e&&(!0===l.fleeSuccessful||"fled"===l.mode))return i(m,"system"),void c();if(d)return i(m,"system"),void c();if(l.currentEnemy&&l.currentEnemy.hp<=0){const e=await fa.processEnemyDefeat(l);return r(e),i(`${l.currentEnemy.name} foi derrotado!`,"system"),void c()}if("continue"===e&&null===l.battleRewards&&l.currentEnemy)return i(m,"system"),void c();if("interact_event"===e&&"battle"===l.mode&&l.currentEnemy)return i(m,"system"),void c();l.currentEnemy&&!l.fleeSuccessful?(r({...l,isPlayerTurn:!1,gameMessage:m}),i(m,"player_action"),setTimeout((async()=>{try{const t=await fa.processEnemyActionWithDelay({...l,isPlayerTurn:!1},"defend"===e,1500),{newState:s,skillXpGains:a}=t;if(a?.length&&o)try{for(const e of a)await ta.addSkillXp(o.id,e.skill,e.xp)}catch(h){}if("gameover"===s.mode)return r(s),void c();if(o&&await ta.updateCharacterHpMana(o.id,s.player.hp,s.player.mana),s.gameMessage?.trim()){const e=s.gameMessage.includes("causou")&&s.gameMessage.includes("dano")?"damage":"enemy_action";i(s.gameMessage,e)}r({...s,isPlayerTurn:!0}),c()}catch(h){c()}}),1e3)):c()}catch(h){c()}}}),[a,o,r,i,n,c]);return t.jsx(va.Provider,{value:{performAction:d},children:s})}const ja=e.createContext(null);function Na({children:s}){const{gameState:a,setGameState:r}=ra(),{addGameLogMessage:n}=Us(),{selectedCharacter:i}=ba(),o=e.useCallback((async()=>{if("special_event"===a.mode)try{const e=await fa.processSpecialEventInteraction(a);if(i&&e.player){e.player.hp===a.player.hp&&e.player.mana===a.player.mana||await ta.updateCharacterHpMana(i.id,e.player.hp,e.player.mana);const t=e.player.gold-a.player.gold;t>0&&await ta.grantSecureGold(i.id,t,"special_event")}const t=await fa.generateEnemy(e.player.floor);if(!t)throw new Error("Erro ao gerar inimigo após evento especial");const s={...e,mode:"battle",currentSpecialEvent:null,currentEnemy:t,gameMessage:`Andar ${e.player.floor}: ${e.currentFloor?.description||"Área Desconhecida"}. Um ${t.name} apareceu!`};r(s),n(e.gameMessage||"Evento especial concluído!","system"),n(`Um ${t.name} apareceu!`,"system")}catch(e){n("Erro ao processar evento especial","system")}}),[a,i,r,n]);return t.jsx(ja.Provider,{value:{interactWithEvent:o},children:s})}function wa({children:e}){return t.jsx(Os,{children:t.jsx(Bs,{children:t.jsx(ia,{children:t.jsx(ya,{children:t.jsx(Na,{children:e})})})})})}function _a(){const[t,s]=e.useState((()=>{if("undefined"==typeof window)return"dark";try{return localStorage.getItem("theme")||"dark"}catch{return"dark"}})),[a,r]=e.useState("dark");e.useEffect((()=>{if("undefined"==typeof window)return;const e=window.document.documentElement,s=t=>{const s="system"===t?(()=>{try{return window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"}catch{return"dark"}})():t;r(s),e.classList.remove("light","dark"),e.classList.add(s)};if(s(t),"system"===t)try{const e=window.matchMedia("(prefers-color-scheme: dark)"),a=()=>s(t);return e.addEventListener?(e.addEventListener("change",a),()=>e.removeEventListener("change",a)):(e.addListener(a),()=>e.removeListener(a))}catch{return}}),[t]);return{theme:t,setTheme:e=>{if(s(e),"undefined"!=typeof window)try{localStorage.setItem("theme",e)}catch{}},resolvedTheme:a}}function Ca(){return e.useEffect((()=>{}),[]),_a(),null}function Ea(){return t.jsx("div",{className:"min-h-screen flex items-center justify-center",children:t.jsxs("div",{className:"text-center",children:[t.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-primary mx-auto mb-4"}),t.jsx("p",{className:"text-muted-foreground",children:"Carregando página..."})]})})}const Sa=a({component:function(){return t.jsxs("div",{className:"font-inter",children:[t.jsx(Ca,{}),t.jsx(C,{richColors:!0,position:"top-right"}),t.jsx(Rs,{children:t.jsxs(wa,{children:[t.jsx(e.Suspense,{fallback:t.jsx(Ea,{}),children:t.jsx(r,{})}),t.jsx(n,{})]})})]})}});const ka=()=>t.jsx("div",{className:"flex items-center justify-center min-h-screen",children:t.jsxs("div",{className:"flex flex-col items-center gap-2",children:[t.jsx($,{className:"h-8 w-8 animate-spin text-primary"}),t.jsx("p",{className:"text-sm text-muted-foreground",children:"Carregando..."})]})});function Pa({children:s}){const{loading:a}=aa(),[r,n]=e.useState(!1),i=e.useRef(!1),o=e.useRef(null);return e.useEffect((()=>{if("undefined"!=typeof window&&!i.current)return i.current=!0,r||(a.onAuthUserChanged?o.current=setTimeout((()=>{n(!0)}),5e3):n(!0)),()=>{o.current&&clearTimeout(o.current)}}),[a.onAuthUserChanged,r]),e.useEffect((()=>{a.onAuthUserChanged||r||(n(!0),o.current&&(clearTimeout(o.current),o.current=null))}),[a.onAuthUserChanged,r]),r?s:t.jsx(ka,{})}function Aa({children:s}){const{user:a,signOut:r,loading:n}=aa(),c=i(),d=o(),m=l({strict:!1}).auth,u=e.useRef(!1),h=e.useRef(!1),p=e.useRef(null);return e.useLayoutEffect((()=>{const e=null!==a;p.current!==e&&(p.current=e,e||(h.current=!1,u.current=!1))}),[a]),e.useEffect((()=>{if("undefined"!=typeof window&&!n.onAuthUserChanged&&void 0!==a){if("/logout"===d.pathname){if(a&&!u.current)return _.error("Sessão expirada, faça o login novamente."),r(),void(u.current=!0);if(!a&&u.current){const t=`${d.pathname}${d.search||""}`;try{const e="string"==typeof t?t:"",s=e?encodeURIComponent(e):"";c({to:"/auth",search:{auth:s},replace:!0})}catch(e){c({to:"/auth",search:{auth:""},replace:!0})}return}}if("/auth/verify-email"!==d.pathname&&a&&!h.current&&!u.current){h.current=!0;try{if(m&&"string"==typeof m&&""!==m.trim()&&"true"!==m){const e=decodeURIComponent(m);if(e&&e.startsWith("/")&&!e.includes("[object")&&!e.startsWith("/auth"))return void c({to:e,replace:!0})}c({to:"/game",replace:!0})}catch(e){c({to:"/game",replace:!0})}}}}),[a,m,d.pathname,d.search,n.onAuthUserChanged,r,c]),n.onAuthUserChanged||void 0===a||a&&!u.current&&"/auth/verify-email"!==d.pathname&&"/logout"!==d.pathname?t.jsx(ka,{}):s}function Ma({children:e}){return t.jsx(Pa,{children:t.jsx(Aa,{children:e})})}function Ta(...e){return I(L(e))}const Ra=F("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground shadow hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground shadow-sm hover:bg-destructive/90",outline:"border border-input bg-background shadow-sm hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground shadow-sm hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2",sm:"h-8 rounded-md px-3 text-xs",lg:"h-10 rounded-md px-8",icon:"h-9 w-9"}},defaultVariants:{variant:"default",size:"default"}}),Da=e.forwardRef((({className:e,variant:s,size:a,asChild:r=!1,...n},i)=>{const o=r?V:"button";return t.jsx(o,{className:Ta(Ra({variant:s,size:a,className:e})),ref:i,...n})}));function qa(...e){return I(L(e))}Da.displayName="Button";const $a={container:"max-w-5xl mx-auto p-6 sm:p-8",section:"py-8 md:py-12"},Ia=({children:e,className:s,id:a,style:r})=>t.jsx("section",{className:qa($a.section,s),id:a,style:r,children:e}),La=({children:e,className:s,id:a,style:r})=>t.jsx("div",{className:qa($a.container,s),id:a,style:r,children:e});function Va(){return t.jsx("footer",{className:"bg-gradient-to-t from-background/90 to-background/70 border-t border-border",children:t.jsxs(Ia,{children:[t.jsxs(La,{className:"grid gap-12 md:grid-cols-[1.5fr_0.5fr_0.5fr]",children:[t.jsxs("div",{className:"not-prose flex flex-col gap-6",children:[t.jsxs(c,{to:"/",className:"group",children:[t.jsx("h3",{className:"sr-only",children:"Tower Trials"}),t.jsx("h1",{className:"text-2xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-purple-400 to-pink-600 group-hover:from-purple-500 group-hover:to-pink-700 transition-colors",children:"Tower Trials"})]}),t.jsx("p",{className:"text-muted-foreground",children:"Enfrente desafios, suba a torre e torne-se uma lenda neste RPG roguelike épico."})]}),t.jsxs("div",{className:"flex flex-col gap-3",children:[t.jsx("h5",{className:"font-bold text-primary",children:"Links"}),t.jsx(c,{to:"/game/ranking",className:"text-muted-foreground hover:text-primary transition-colors",children:"Ranking Global"}),t.jsx(c,{to:"/game/guide",className:"text-muted-foreground hover:text-primary transition-colors",children:"Guia do Jogo"})]}),t.jsx("div",{className:"flex flex-col gap-3",children:t.jsx("h5",{className:"font-bold text-primary",children:"Legal"})})]}),t.jsxs(La,{className:"not-prose mt-8 flex flex-col justify-between gap-6 border-t border-border pt-8 md:flex-row md:items-center md:gap-2",children:[t.jsxs("div",{className:"flex gap-2",children:[t.jsx(Da,{variant:"ghost",size:"icon",className:"text-muted-foreground hover:text-primary transition-colors",children:t.jsx(O,{className:"h-5 w-5"})}),t.jsx(Da,{variant:"ghost",size:"icon",className:"text-muted-foreground hover:text-primary transition-colors",children:t.jsx(z,{className:"h-5 w-5"})})]}),t.jsx("p",{className:"text-muted-foreground",children:"© 2024 Tower Trials. Todos os direitos reservados."})]})]})})}const Fa=d("/_public")({component:function(){return t.jsx(Ma,{children:t.jsxs("main",{className:"flex min-h-screen flex-col",children:[t.jsx("div",{className:"flex flex-1 items-center justify-center p-4",children:t.jsx(r,{})}),t.jsx(Va,{})]})})}});function Oa({children:s}){const{user:a,loading:r}=aa(),n=i(),l=o(),c=e.useRef(!1),d=e.useRef(null);return e.useLayoutEffect((()=>{const e=null!==a;d.current!==e&&(d.current=e,c.current=!1)}),[a]),e.useEffect((()=>{if("undefined"!=typeof window&&!r.onAuthUserChanged&&null===a&&!c.current){if(c.current=!0,l.pathname.startsWith("/auth"))return;const t=`${l.pathname}${l.search||""}`;if(t&&"/auth"!==t)try{const e=encodeURIComponent("string"==typeof t?t:"/game");n({to:"/auth",search:{auth:e},replace:!0})}catch(e){n({to:"/auth",search:{auth:encodeURIComponent("/game")},replace:!0})}else n({to:"/auth",search:{auth:""},replace:!0})}}),[a,r.onAuthUserChanged,l.pathname,l.search]),r.onAuthUserChanged||null==a?t.jsx(ka,{}):s}function za({children:e}){return t.jsx(Pa,{children:t.jsx(Oa,{children:e})})}function Ba({children:s}){const{user:a}=aa(),r=i(),n=e.useRef(!1),o=e.useRef(null);return e.useLayoutEffect((()=>{if(!a)return o.current=null,void(n.current=!1);const e=!!a.email_confirmed_at;o.current!==e&&(o.current=e,n.current=!1)}),[a?.email_confirmed_at]),e.useEffect((()=>{"undefined"!=typeof window&&a&&(a.email_confirmed_at||n.current||(n.current=!0,r({to:"/auth/verify-email",search:{auth:"true"},replace:!0})))}),[a,r]),a&&a.email_confirmed_at?t.jsx(t.Fragment,{children:s}):null}function Ua(){const[t,s]=e.useState(null),[a,r]=e.useState(!1),[n,i]=e.useState(!1);e.useEffect((()=>{const e=e=>{e.preventDefault(),s(e),r(!0)},t=()=>{i(!0),r(!1),s(null)};return window.addEventListener("beforeinstallprompt",e),window.addEventListener("appinstalled",t),(()=>{const e=window.matchMedia("(display-mode: standalone)").matches,t=window.matchMedia("(display-mode: fullscreen)").matches,s=window.matchMedia("(display-mode: minimal-ui)").matches;(e||t||s)&&i(!0)})(),()=>{window.removeEventListener("beforeinstallprompt",e),window.removeEventListener("appinstalled",t)}}),[]);return{installPWA:async()=>{if(!t)return!1;try{t.prompt();const{outcome:e}=await t.userChoice;return"accepted"===e&&(s(null),r(!1),!0)}catch(e){return!1}},isInstallable:a,isInstalled:n,canInstall:a&&!n}}function Ha(){const{installPWA:e,canInstall:s,isInstalled:a}=Ua();return a?t.jsxs("div",{className:"flex items-center gap-2 text-sm text-green-600 dark:text-green-400",children:[t.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full animate-pulse"}),"App Instalado"]}):s?t.jsxs(Da,{onClick:async()=>{await e()},variant:"outline",size:"sm",className:"flex items-center gap-2 bg-blue-50 hover:bg-blue-100 dark:bg-blue-950 dark:hover:bg-blue-900 border-blue-200 dark:border-blue-800",children:[t.jsx(B,{className:"w-4 h-4"}),"Instalar App"]}):null}const Ga=K,Wa=J,Xa=H,Ya=e.forwardRef((({className:e,...s},a)=>t.jsx(U,{className:Ta("fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",e),...s,ref:a})));Ya.displayName=U.displayName;const Ka=F("fixed z-50 gap-4 bg-background p-6 shadow-lg transition ease-in-out data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:duration-300 data-[state=open]:duration-500",{variants:{side:{top:"inset-x-0 top-0 border-b data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top",bottom:"inset-x-0 bottom-0 border-t data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom",left:"inset-y-0 left-0 h-full w-3/4 border-r data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left sm:max-w-sm",right:"inset-y-0 right-0 h-full w-3/4 border-l data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right sm:max-w-sm"}},defaultVariants:{side:"right"}}),Ja=e.forwardRef((({side:e="right",className:s,children:a,...r},n)=>t.jsxs(Xa,{children:[t.jsx(Ya,{}),t.jsxs(G,{ref:n,className:Ta(Ka({side:e}),s),...r,children:[a,t.jsxs(W,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-secondary",children:[t.jsx(X,{className:"h-4 w-4"}),t.jsx("span",{className:"sr-only",children:"Close"})]})]})]})));Ja.displayName=G.displayName;const Za=({className:e,...s})=>t.jsx("div",{className:Ta("flex flex-col space-y-2 text-center sm:text-left",e),...s});Za.displayName="SheetHeader";const Qa=e.forwardRef((({className:e,...s},a)=>t.jsx(Y,{ref:a,className:Ta("text-lg font-semibold text-foreground",e),...s})));Qa.displayName=Y.displayName;function er({userName:e}){const s=o(),a=i(),r=s.pathname,{user:n}=aa(),{resolvedTheme:l,setTheme:c}=_a(),d=r.startsWith("/game/play/"),m=((e,t)=>{const s=[...t?[]:[{href:"/game",icon:ae,label:"Jogar"}],{href:"/game/ranking",icon:re,label:"Ranking"},{href:"/game/guide",icon:ne,label:"Guia"}];return"ADMIN"===e?[...s,{href:"/users",icon:Z,label:"Admin"}]:s})(n?.role,d),u=e=>{a({to:e})};return t.jsxs("header",{className:"flex w-full flex-col bg-gradient-to-b from-background/90 to-background/70 border-b border-border",children:[t.jsxs("div",{className:"flex w-full items-center justify-between px-4 py-3",children:[t.jsx("button",{onClick:()=>u("/game"),className:"group cursor-pointer",children:t.jsx("h1",{className:"text-xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-purple-400 to-pink-600 group-hover:from-purple-500 group-hover:to-pink-700 transition-colors",children:"Tower Trials"})}),t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx(Ha,{}),t.jsxs("div",{className:"hidden sm:flex items-center gap-2 text-muted-foreground",children:[t.jsx(Z,{className:"h-4 w-4"}),t.jsx("span",{className:"text-sm",children:e})]}),t.jsx(Da,{variant:"ghost",size:"icon",onClick:()=>c("dark"===l?"light":"dark"),className:"text-muted-foreground hover:text-primary transition-colors",title:"dark"===l?"Modo claro":"Modo escuro",children:"dark"===l?t.jsx(Q,{className:"h-5 w-5"}):t.jsx(ee,{className:"h-5 w-5"})}),t.jsx(Da,{variant:"ghost",size:"icon",className:"text-muted-foreground hover:text-primary transition-colors",onClick:()=>u("/profile"),children:t.jsx(Z,{className:"h-5 w-5"})}),t.jsx(Da,{variant:"ghost",size:"icon",className:"text-muted-foreground hover:text-primary transition-colors",onClick:()=>u("/logout"),children:t.jsx(te,{className:"h-5 w-5"})}),t.jsxs(Ga,{children:[t.jsx(Wa,{asChild:!0,children:t.jsx(Da,{variant:"ghost",size:"icon",className:"text-muted-foreground hover:text-primary transition-colors lg:hidden",children:t.jsx(se,{className:"h-5 w-5"})})}),t.jsxs(Ja,{side:"left",className:"w-[300px] bg-background border-r border-border p-0",children:[t.jsx(Za,{className:"border-b border-border p-4",children:t.jsx(Qa,{children:"Menu Principal"})}),t.jsxs("div",{className:"flex flex-col py-2",children:[m.map((e=>{const s=e.icon,a=r===e.href;return t.jsxs("button",{onClick:()=>u(e.href),className:"flex items-center gap-3 px-4 py-3 transition-colors hover:bg-accent text-left cursor-pointer "+(a?"bg-accent text-primary":"text-muted-foreground"),children:[t.jsx(s,{className:"h-5 w-5"}),t.jsx("span",{className:"text-sm font-medium",children:e.label})]},e.href)})),t.jsx("button",{onClick:()=>c("dark"===l?"light":"dark"),className:"flex items-center gap-3 px-4 py-3 transition-colors hover:bg-accent text-muted-foreground text-left cursor-pointer",children:"dark"===l?t.jsxs(t.Fragment,{children:[t.jsx(Q,{className:"h-5 w-5"}),t.jsx("span",{className:"text-sm font-medium",children:"Modo Claro"})]}):t.jsxs(t.Fragment,{children:[t.jsx(ee,{className:"h-5 w-5"}),t.jsx("span",{className:"text-sm font-medium",children:"Modo Escuro"})]})})]})]})]})]})]}),t.jsx("nav",{className:"hidden border-t border-border lg:block",children:t.jsx("div",{className:"flex items-center justify-center gap-1 px-2",children:m.map((e=>{const s=e.icon,a=r===e.href;return t.jsxs("button",{onClick:()=>u(e.href),className:"flex items-center gap-2 rounded-md px-4 py-3 transition-colors hover:bg-accent cursor-pointer "+(a?"text-primary":"text-muted-foreground"),children:[t.jsx(s,{className:"h-4 w-4"}),t.jsx("span",{className:"text-sm font-medium",children:e.label})]},e.href)}))})})]})}const tr=d("/_authenticated")({component:function(){return t.jsx(za,{children:t.jsx(Ba,{children:t.jsx(sr,{})})})}});function sr(){const{user:e}=aa();return t.jsxs("div",{className:"flex min-h-screen flex-col",children:[t.jsx(er,{userName:e?.username||"Usuário"}),t.jsx("main",{className:"flex-1",children:t.jsx(r,{})}),t.jsx(Va,{})]})}const ar=d("/")({beforeLoad:()=>{throw m({to:"/game"})}}),rr=d("/_public/logout")({component:function(){const{signOut:s,user:a}=aa(),r=i();return e.useEffect((()=>{(async()=>{a&&(_.info("Encerrando sessão..."),await s()),setTimeout((()=>{r({to:"/auth",search:{auth:"true"}})}),1e3)})()}),[s,r,a]),t.jsx("div",{className:"flex min-h-screen items-center justify-center",children:t.jsxs("div",{className:"text-center space-y-4",children:[t.jsx(ka,{}),t.jsx("p",{className:"text-muted-foreground",children:"Encerrando sessão..."})]})})}});function nr(e,t,s){function a(s,a){var r;Object.defineProperty(s,"_zod",{value:s._zod??{},enumerable:!1}),(r=s._zod).traits??(r.traits=new Set),s._zod.traits.add(e),t(s,a);for(const e in i.prototype)e in s||Object.defineProperty(s,e,{value:i.prototype[e].bind(s)});s._zod.constr=i,s._zod.def=a}const r=s?.Parent??Object;class n extends r{}function i(e){var t;const r=s?.Parent?new n:this;a(r,e),(t=r._zod).deferred??(t.deferred=[]);for(const s of r._zod.deferred)s();return r}return Object.defineProperty(n,"name",{value:e}),Object.defineProperty(i,"init",{value:a}),Object.defineProperty(i,Symbol.hasInstance,{value:t=>!!(s?.Parent&&t instanceof s.Parent)||t?._zod?.traits?.has(e)}),Object.defineProperty(i,"name",{value:e}),i}class ir extends Error{constructor(){super("Encountered Promise during synchronous parse. Use .parseAsync() instead.")}}const or={};function lr(e){return or}function cr(e,t){return"bigint"==typeof t?t.toString():t}function dr(e){return"string"==typeof e?e:e?.message}function mr(e,t,s){const a={...e,path:e.path??[]};if(!e.message){const r=dr(e.inst?._zod.def?.error?.(e))??dr(t?.error?.(e))??dr(s.customError?.(e))??dr(s.localeError?.(e))??"Invalid input";a.message=r}return delete a.inst,delete a.continue,t?.reportInput||delete a.input,a}const ur=(e,t)=>{e.name="$ZodError",Object.defineProperty(e,"_zod",{value:e._zod,enumerable:!1}),Object.defineProperty(e,"issues",{value:t,enumerable:!1}),Object.defineProperty(e,"message",{get:()=>JSON.stringify(t,cr,2),enumerable:!0})},hr=nr("$ZodError",ur),pr=nr("$ZodError",ur,{Parent:Error}),xr=(e=>(t,s,a,r)=>{const n=a?Object.assign(a,{async:!1}):{async:!1},i=t._zod.run({value:s,issues:[]},n);if(i instanceof Promise)throw new ir;if(i.issues.length){const t=new(r?.Err??e)(i.issues.map((e=>mr(e,n,lr()))));throw Error.captureStackTrace(t,r?.callee),t}return i.value})(pr),fr=(e=>async(t,s,a,r)=>{const n=a?Object.assign(a,{async:!0}):{async:!0};let i=t._zod.run({value:s,issues:[]},n);if(i instanceof Promise&&(i=await i),i.issues.length){const t=new(r?.Err??e)(i.issues.map((e=>mr(e,n,lr()))));throw Error.captureStackTrace(t,r?.callee),t}return i.value})(pr);function gr(e,t){try{var s=e()}catch(e){return t(e)}return s&&s.then?s.then(void 0,t):s}function br(e,t){for(var s={};e.length;){var a=e[0],r=a.code,n=a.message,i=a.path.join(".");if(!s[i])if("unionErrors"in a){var o=a.unionErrors[0].errors[0];s[i]={message:o.message,type:o.code}}else s[i]={message:n,type:r};if("unionErrors"in a&&a.unionErrors.forEach((function(t){return t.errors.forEach((function(t){return e.push(t)}))})),t){var l=s[i].types,c=l&&l[a.code];s[i]=k(i,t,s,r,c?[].concat(c,a.message):a.message)}e.shift()}return s}function vr(e,t){for(var s={};e.length;){var a=e[0],r=a.code,n=a.message,i=a.path.join(".");if(!s[i])if("invalid_union"===a.code){var o=a.errors[0][0];s[i]={message:o.message,type:o.code}}else s[i]={message:n,type:r};if("invalid_union"===a.code&&a.errors.forEach((function(t){return t.forEach((function(t){return e.push(t)}))})),t){var l=s[i].types,c=l&&l[a.code];s[i]=k(i,t,s,r,c?[].concat(c,a.message):a.message)}e.shift()}return s}function yr(e,t,s){if(void 0===s&&(s={}),"_def"in(a=e)&&"object"==typeof a._def&&"typeName"in a._def)return function(r,n,i){try{return Promise.resolve(gr((function(){return Promise.resolve(e["sync"===s.mode?"parse":"parseAsync"](r,t)).then((function(e){return i.shouldUseNativeValidation&&E({},i),{errors:{},values:s.raw?Object.assign({},r):e}}))}),(function(e){if(function(e){return Array.isArray(null==e?void 0:e.issues)}(e))return{values:{},errors:S(br(e.errors,!i.shouldUseNativeValidation&&"all"===i.criteriaMode),i)};throw e})))}catch(a){return Promise.reject(a)}};var a;if(function(e){return"_zod"in e&&"object"==typeof e._zod}(e))return function(r,n,i){try{return Promise.resolve(gr((function(){return Promise.resolve(("sync"===s.mode?xr:fr)(e,r,t)).then((function(e){return i.shouldUseNativeValidation&&E({},i),{errors:{},values:s.raw?Object.assign({},r):e}}))}),(function(e){if(function(e){return e instanceof hr}(e))return{values:{},errors:S(vr(e.issues,!i.shouldUseNativeValidation&&"all"===i.criteriaMode),i)};throw e})))}catch(a){return Promise.reject(a)}};throw new Error("Invalid input: not a Zod schema")}const jr=e.forwardRef((({className:e,type:s,...a},r)=>t.jsx("input",{type:s,className:Ta("flex h-9 w-full rounded-md border border-neutral-200 bg-white px-3 py-1 text-sm shadow-sm transition-colors file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-neutral-500 focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-neutral-950 disabled:cursor-not-allowed disabled:opacity-50 dark:border-neutral-800 dark:bg-neutral-950 dark:placeholder:text-neutral-400 dark:focus-visible:ring-neutral-300",e),ref:r,...a})));jr.displayName="Input";var Nr=e.forwardRef(((e,s)=>t.jsx(ie.label,{...e,ref:s,onMouseDown:t=>{t.target.closest("button, input, select, textarea")||(e.onMouseDown?.(t),!t.defaultPrevented&&t.detail>1&&t.preventDefault())}})));Nr.displayName="Label";var wr=Nr;const _r=F("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),Cr=e.forwardRef((({className:e,...s},a)=>t.jsx(wr,{ref:a,className:Ta(_r(),e),...s})));Cr.displayName=wr.displayName;const Er=A,Sr=e.createContext({}),kr=({...e})=>t.jsx(Sr.Provider,{value:{name:e.name},children:t.jsx(M,{...e})}),Pr=()=>{const t=e.useContext(Sr),s=e.useContext(Ar),{getFieldState:a,formState:r}=P(),n=a(t.name,r);if(!t)throw new Error("useFormField should be used within <FormField>");const{id:i}=s;return{id:i,name:t.name,formItemId:`${i}-form-item`,formDescriptionId:`${i}-form-item-description`,formMessageId:`${i}-form-item-message`,...n}},Ar=e.createContext({}),Mr=e.forwardRef((({className:s,...a},r)=>{const n=e.useId();return t.jsx(Ar.Provider,{value:{id:n},children:t.jsx("div",{ref:r,className:Ta("space-y-2",s),...a})})}));Mr.displayName="FormItem";const Tr=e.forwardRef((({className:e,...s},a)=>{const{error:r,formItemId:n}=Pr();return t.jsx(Cr,{ref:a,className:Ta(r&&"text-destructive",e),htmlFor:n,...s})}));Tr.displayName="FormLabel";const Rr=e.forwardRef((({...e},s)=>{const{error:a,formItemId:r,formDescriptionId:n,formMessageId:i}=Pr();return t.jsx(V,{ref:s,id:r,"aria-describedby":a?`${n} ${i}`:`${n}`,"aria-invalid":!!a,...e})}));Rr.displayName="FormControl";e.forwardRef((({className:e,...s},a)=>{const{formDescriptionId:r}=Pr();return t.jsx("p",{ref:a,id:r,className:Ta("text-[0.8rem] text-muted-foreground",e),...s})})).displayName="FormDescription";const Dr=e.forwardRef((({className:e,children:s,...a},r)=>{const{error:n,formMessageId:i}=Pr(),o=n?String(n?.message??""):s;return o?t.jsx("p",{ref:r,id:i,className:Ta("text-[0.8rem] font-medium text-destructive",e),...a,children:o}):null}));function qr({onSubmit:e,isLoading:s}){const a=T({resolver:yr(vs),defaultValues:{email:"",password:""}});return t.jsx(Er,{...a,children:t.jsxs("form",{onSubmit:a.handleSubmit(e),className:"space-y-4",children:[t.jsx(kr,{control:a.control,name:"email",render:({field:e})=>t.jsxs(Mr,{children:[t.jsx(Tr,{children:"Email"}),t.jsx(Rr,{children:t.jsx(jr,{type:"email",placeholder:"seu@email.com",...e})}),t.jsx(Dr,{})]})}),t.jsx(kr,{control:a.control,name:"password",render:({field:e})=>t.jsxs(Mr,{children:[t.jsx(Tr,{children:"Senha"}),t.jsx(Rr,{children:t.jsx(jr,{type:"password",placeholder:"••••••",...e})}),t.jsx(Dr,{})]})}),t.jsx(Da,{type:"submit",className:"w-full",disabled:s,children:s?"Processando...":"Entrar"})]})})}function $r({onSubmit:e,isLoading:s}){const a=T({resolver:yr(ys),defaultValues:{email:"",password:"",confirmPassword:""}});return t.jsx(Er,{...a,children:t.jsxs("form",{onSubmit:a.handleSubmit(e),className:"space-y-4",children:[t.jsx(kr,{control:a.control,name:"email",render:({field:e})=>t.jsxs(Mr,{children:[t.jsx(Tr,{children:"Email"}),t.jsx(Rr,{children:t.jsx(jr,{type:"email",placeholder:"seu@email.com",...e})}),t.jsx(Dr,{})]})}),t.jsx(kr,{control:a.control,name:"password",render:({field:e})=>t.jsxs(Mr,{children:[t.jsx(Tr,{children:"Senha"}),t.jsx(Rr,{children:t.jsx(jr,{type:"password",placeholder:"••••••",...e})}),t.jsx(Dr,{})]})}),t.jsx(kr,{control:a.control,name:"confirmPassword",render:({field:e})=>t.jsxs(Mr,{children:[t.jsx(Tr,{children:"Confirmar Senha"}),t.jsx(Rr,{children:t.jsx(jr,{type:"password",placeholder:"••••••",...e})}),t.jsx(Dr,{})]})}),t.jsx(Da,{type:"submit",className:"w-full",disabled:s,children:s?"Processando...":"Criar Conta"})]})})}Dr.displayName="FormMessage";const Ir=e.createContext({});function Lr(t){const s=e.useRef(null);return null===s.current&&(s.current=t()),s.current}const Vr="undefined"!=typeof window,Fr=Vr?e.useLayoutEffect:e.useEffect,Or=e.createContext(null);function zr(e,t){-1===e.indexOf(t)&&e.push(t)}function Br(e,t){const s=e.indexOf(t);s>-1&&e.splice(s,1)}const Ur=(e,t,s)=>s>t?t:s<e?e:s;const Hr={},Gr=e=>/^-?(?:\d+(?:\.\d+)?|\.\d+)$/u.test(e);function Wr(e){return"object"==typeof e&&null!==e}const Xr=e=>/^0[^.\s]+$/u.test(e);function Yr(e){let t;return()=>(void 0===t&&(t=e()),t)}const Kr=e=>e,Jr=(e,t)=>s=>t(e(s)),Zr=(...e)=>e.reduce(Jr),Qr=(e,t,s)=>{const a=t-e;return 0===a?1:(s-e)/a};class en{constructor(){this.subscriptions=[]}add(e){return zr(this.subscriptions,e),()=>Br(this.subscriptions,e)}notify(e,t,s){const a=this.subscriptions.length;if(a)if(1===a)this.subscriptions[0](e,t,s);else for(let r=0;r<a;r++){const a=this.subscriptions[r];a&&a(e,t,s)}}getSize(){return this.subscriptions.length}clear(){this.subscriptions.length=0}}const tn=e=>1e3*e,sn=e=>e/1e3;function an(e,t){return t?e*(1e3/t):0}const rn=(e,t,s)=>(((1-3*s+3*t)*e+(3*s-6*t))*e+3*t)*e;function nn(e,t,s,a){if(e===t&&s===a)return Kr;const r=t=>function(e,t,s,a,r){let n,i,o=0;do{i=t+(s-t)/2,n=rn(i,a,r)-e,n>0?s=i:t=i}while(Math.abs(n)>1e-7&&++o<12);return i}(t,0,1,e,s);return e=>0===e||1===e?e:rn(r(e),t,a)}const on=e=>t=>t<=.5?e(2*t)/2:(2-e(2*(1-t)))/2,ln=e=>t=>1-e(1-t),cn=nn(.33,1.53,.69,.99),dn=ln(cn),mn=on(dn),un=e=>(e*=2)<1?.5*dn(e):.5*(2-Math.pow(2,-10*(e-1))),hn=e=>1-Math.sin(Math.acos(e)),pn=ln(hn),xn=on(hn),fn=nn(.42,0,1,1),gn=nn(0,0,.58,1),bn=nn(.42,0,.58,1),vn=e=>Array.isArray(e)&&"number"==typeof e[0],yn={linear:Kr,easeIn:fn,easeInOut:bn,easeOut:gn,circIn:hn,circInOut:xn,circOut:pn,backIn:dn,backInOut:mn,backOut:cn,anticipate:un},jn=e=>{if(vn(e)){e.length;const[t,s,a,r]=e;return nn(t,s,a,r)}return"string"==typeof e?yn[e]:e},Nn=["setup","read","resolveKeyframes","preUpdate","update","preRender","render","postRender"],wn={value:null};function _n(e,t){let s=!1,a=!0;const r={delta:0,timestamp:0,isProcessing:!1},n=()=>s=!0,i=Nn.reduce(((e,s)=>(e[s]=function(e,t){let s=new Set,a=new Set,r=!1,n=!1;const i=new WeakSet;let o={delta:0,timestamp:0,isProcessing:!1},l=0;function c(t){i.has(t)&&(d.schedule(t),e()),l++,t(o)}const d={schedule:(e,t=!1,n=!1)=>{const o=n&&r?s:a;return t&&i.add(e),o.has(e)||o.add(e),e},cancel:e=>{a.delete(e),i.delete(e)},process:e=>{o=e,r?n=!0:(r=!0,[s,a]=[a,s],s.forEach(c),t&&wn.value&&wn.value.frameloop[t].push(l),l=0,s.clear(),r=!1,n&&(n=!1,d.process(e)))}};return d}(n,t?s:void 0),e)),{}),{setup:o,read:l,resolveKeyframes:c,preUpdate:d,update:m,preRender:u,render:h,postRender:p}=i,x=()=>{const n=Hr.useManualTiming?r.timestamp:performance.now();s=!1,Hr.useManualTiming||(r.delta=a?1e3/60:Math.max(Math.min(n-r.timestamp,40),1)),r.timestamp=n,r.isProcessing=!0,o.process(r),l.process(r),c.process(r),d.process(r),m.process(r),u.process(r),h.process(r),p.process(r),r.isProcessing=!1,s&&t&&(a=!1,e(x))};return{schedule:Nn.reduce(((t,n)=>{const o=i[n];return t[n]=(t,n=!1,i=!1)=>(s||(s=!0,a=!0,r.isProcessing||e(x)),o.schedule(t,n,i)),t}),{}),cancel:e=>{for(let t=0;t<Nn.length;t++)i[Nn[t]].cancel(e)},state:r,steps:i}}const{schedule:Cn,cancel:En,state:Sn,steps:kn}=_n("undefined"!=typeof requestAnimationFrame?requestAnimationFrame:Kr,!0);let Pn;function An(){Pn=void 0}const Mn={now:()=>(void 0===Pn&&Mn.set(Sn.isProcessing||Hr.useManualTiming?Sn.timestamp:performance.now()),Pn),set:e=>{Pn=e,queueMicrotask(An)}},Tn=e=>t=>"string"==typeof t&&t.startsWith(e),Rn=Tn("--"),Dn=Tn("var(--"),qn=e=>!!Dn(e)&&$n.test(e.split("/*")[0].trim()),$n=/var\(--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)$/iu,In={test:e=>"number"==typeof e,parse:parseFloat,transform:e=>e},Ln={...In,transform:e=>Ur(0,1,e)},Vn={...In,default:1},Fn=e=>Math.round(1e5*e)/1e5,On=/-?(?:\d+(?:\.\d+)?|\.\d+)/gu;const zn=/^(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))$/iu,Bn=(e,t)=>s=>Boolean("string"==typeof s&&zn.test(s)&&s.startsWith(e)||t&&!function(e){return null==e}(s)&&Object.prototype.hasOwnProperty.call(s,t)),Un=(e,t,s)=>a=>{if("string"!=typeof a)return a;const[r,n,i,o]=a.match(On);return{[e]:parseFloat(r),[t]:parseFloat(n),[s]:parseFloat(i),alpha:void 0!==o?parseFloat(o):1}},Hn={...In,transform:e=>Math.round((e=>Ur(0,255,e))(e))},Gn={test:Bn("rgb","red"),parse:Un("red","green","blue"),transform:({red:e,green:t,blue:s,alpha:a=1})=>"rgba("+Hn.transform(e)+", "+Hn.transform(t)+", "+Hn.transform(s)+", "+Fn(Ln.transform(a))+")"};const Wn={test:Bn("#"),parse:function(e){let t="",s="",a="",r="";return e.length>5?(t=e.substring(1,3),s=e.substring(3,5),a=e.substring(5,7),r=e.substring(7,9)):(t=e.substring(1,2),s=e.substring(2,3),a=e.substring(3,4),r=e.substring(4,5),t+=t,s+=s,a+=a,r+=r),{red:parseInt(t,16),green:parseInt(s,16),blue:parseInt(a,16),alpha:r?parseInt(r,16)/255:1}},transform:Gn.transform},Xn=e=>({test:t=>"string"==typeof t&&t.endsWith(e)&&1===t.split(" ").length,parse:parseFloat,transform:t=>`${t}${e}`}),Yn=Xn("deg"),Kn=Xn("%"),Jn=Xn("px"),Zn=Xn("vh"),Qn=Xn("vw"),ei=(()=>({...Kn,parse:e=>Kn.parse(e)/100,transform:e=>Kn.transform(100*e)}))(),ti={test:Bn("hsl","hue"),parse:Un("hue","saturation","lightness"),transform:({hue:e,saturation:t,lightness:s,alpha:a=1})=>"hsla("+Math.round(e)+", "+Kn.transform(Fn(t))+", "+Kn.transform(Fn(s))+", "+Fn(Ln.transform(a))+")"},si={test:e=>Gn.test(e)||Wn.test(e)||ti.test(e),parse:e=>Gn.test(e)?Gn.parse(e):ti.test(e)?ti.parse(e):Wn.parse(e),transform:e=>"string"==typeof e?e:e.hasOwnProperty("red")?Gn.transform(e):ti.transform(e)},ai=/(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))/giu;const ri="number",ni="color",ii=/var\s*\(\s*--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)|#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\)|-?(?:\d+(?:\.\d+)?|\.\d+)/giu;function oi(e){const t=e.toString(),s=[],a={color:[],number:[],var:[]},r=[];let n=0;const i=t.replace(ii,(e=>(si.test(e)?(a.color.push(n),r.push(ni),s.push(si.parse(e))):e.startsWith("var(")?(a.var.push(n),r.push("var"),s.push(e)):(a.number.push(n),r.push(ri),s.push(parseFloat(e))),++n,"${}"))).split("${}");return{values:s,split:i,indexes:a,types:r}}function li(e){return oi(e).values}function ci(e){const{split:t,types:s}=oi(e),a=t.length;return e=>{let r="";for(let n=0;n<a;n++)if(r+=t[n],void 0!==e[n]){const t=s[n];r+=t===ri?Fn(e[n]):t===ni?si.transform(e[n]):e[n]}return r}}const di=e=>"number"==typeof e?0:e;const mi={test:function(e){return isNaN(e)&&"string"==typeof e&&(e.match(On)?.length||0)+(e.match(ai)?.length||0)>0},parse:li,createTransformer:ci,getAnimatableNone:function(e){const t=li(e);return ci(e)(t.map(di))}};function ui(e,t,s){return s<0&&(s+=1),s>1&&(s-=1),s<1/6?e+6*(t-e)*s:s<.5?t:s<2/3?e+(t-e)*(2/3-s)*6:e}function hi(e,t){return s=>s>0?t:e}const pi=(e,t,s)=>e+(t-e)*s,xi=(e,t,s)=>{const a=e*e,r=s*(t*t-a)+a;return r<0?0:Math.sqrt(r)},fi=[Wn,Gn,ti];function gi(e){const t=(e=>fi.find((t=>t.test(e))))(e);if(!Boolean(t))return!1;let s=t.parse(e);return t===ti&&(s=function({hue:e,saturation:t,lightness:s,alpha:a}){e/=360,s/=100;let r=0,n=0,i=0;if(t/=100){const a=s<.5?s*(1+t):s+t-s*t,o=2*s-a;r=ui(o,a,e+1/3),n=ui(o,a,e),i=ui(o,a,e-1/3)}else r=n=i=s;return{red:Math.round(255*r),green:Math.round(255*n),blue:Math.round(255*i),alpha:a}}(s)),s}const bi=(e,t)=>{const s=gi(e),a=gi(t);if(!s||!a)return hi(e,t);const r={...s};return e=>(r.red=xi(s.red,a.red,e),r.green=xi(s.green,a.green,e),r.blue=xi(s.blue,a.blue,e),r.alpha=pi(s.alpha,a.alpha,e),Gn.transform(r))},vi=new Set(["none","hidden"]);function yi(e,t){return s=>pi(e,t,s)}function ji(e){return"number"==typeof e?yi:"string"==typeof e?qn(e)?hi:si.test(e)?bi:_i:Array.isArray(e)?Ni:"object"==typeof e?si.test(e)?bi:wi:hi}function Ni(e,t){const s=[...e],a=s.length,r=e.map(((e,s)=>ji(e)(e,t[s])));return e=>{for(let t=0;t<a;t++)s[t]=r[t](e);return s}}function wi(e,t){const s={...e,...t},a={};for(const r in s)void 0!==e[r]&&void 0!==t[r]&&(a[r]=ji(e[r])(e[r],t[r]));return e=>{for(const t in a)s[t]=a[t](e);return s}}const _i=(e,t)=>{const s=mi.createTransformer(t),a=oi(e),r=oi(t);return a.indexes.var.length===r.indexes.var.length&&a.indexes.color.length===r.indexes.color.length&&a.indexes.number.length>=r.indexes.number.length?vi.has(e)&&!r.values.length||vi.has(t)&&!a.values.length?function(e,t){return vi.has(e)?s=>s<=0?e:t:s=>s>=1?t:e}(e,t):Zr(Ni(function(e,t){const s=[],a={color:0,var:0,number:0};for(let r=0;r<t.values.length;r++){const n=t.types[r],i=e.indexes[n][a[n]],o=e.values[i]??0;s[r]=o,a[n]++}return s}(a,r),r.values),s):hi(e,t)};function Ci(e,t,s){if("number"==typeof e&&"number"==typeof t&&"number"==typeof s)return pi(e,t,s);return ji(e)(e,t)}const Ei=e=>{const t=({timestamp:t})=>e(t);return{start:(e=!0)=>Cn.update(t,e),stop:()=>En(t),now:()=>Sn.isProcessing?Sn.timestamp:Mn.now()}},Si=(e,t,s=10)=>{let a="";const r=Math.max(Math.round(t/s),2);for(let n=0;n<r;n++)a+=e(n/(r-1))+", ";return`linear(${a.substring(0,a.length-2)})`},ki=2e4;function Pi(e){let t=0;let s=e.next(t);for(;!s.done&&t<ki;)t+=50,s=e.next(t);return t>=ki?1/0:t}function Ai(e,t,s){const a=Math.max(t-5,0);return an(s-e(a),t-a)}const Mi=100,Ti=10,Ri=1,Di=0,qi=800,$i=.3,Ii=.3,Li={granular:.01,default:2},Vi={granular:.005,default:.5},Fi=.01,Oi=10,zi=.05,Bi=1,Ui=.001;function Hi({duration:e=qi,bounce:t=$i,velocity:s=Di,mass:a=Ri}){let r,n,i=1-t;i=Ur(zi,Bi,i),e=Ur(Fi,Oi,sn(e)),i<1?(r=t=>{const a=t*i,r=a*e,n=a-s,o=Wi(t,i),l=Math.exp(-r);return Ui-n/o*l},n=t=>{const a=t*i*e,n=a*s+s,o=Math.pow(i,2)*Math.pow(t,2)*e,l=Math.exp(-a),c=Wi(Math.pow(t,2),i);return(-r(t)+Ui>0?-1:1)*((n-o)*l)/c}):(r=t=>Math.exp(-t*e)*((t-s)*e+1)-.001,n=t=>Math.exp(-t*e)*(e*e*(s-t)));const o=function(e,t,s){let a=s;for(let r=1;r<Gi;r++)a-=e(a)/t(a);return a}(r,n,5/e);if(e=tn(e),isNaN(o))return{stiffness:Mi,damping:Ti,duration:e};{const t=Math.pow(o,2)*a;return{stiffness:t,damping:2*i*Math.sqrt(a*t),duration:e}}}const Gi=12;function Wi(e,t){return e*Math.sqrt(1-t*t)}const Xi=["duration","bounce"],Yi=["stiffness","damping","mass"];function Ki(e,t){return t.some((t=>void 0!==e[t]))}function Ji(e=Ii,t=$i){const s="object"!=typeof e?{visualDuration:e,keyframes:[0,1],bounce:t}:e;let{restSpeed:a,restDelta:r}=s;const n=s.keyframes[0],i=s.keyframes[s.keyframes.length-1],o={done:!1,value:n},{stiffness:l,damping:c,mass:d,duration:m,velocity:u,isResolvedFromDuration:h}=function(e){let t={velocity:Di,stiffness:Mi,damping:Ti,mass:Ri,isResolvedFromDuration:!1,...e};if(!Ki(e,Yi)&&Ki(e,Xi))if(e.visualDuration){const s=e.visualDuration,a=2*Math.PI/(1.2*s),r=a*a,n=2*Ur(.05,1,1-(e.bounce||0))*Math.sqrt(r);t={...t,mass:Ri,stiffness:r,damping:n}}else{const s=Hi(e);t={...t,...s,mass:Ri},t.isResolvedFromDuration=!0}return t}({...s,velocity:-sn(s.velocity||0)}),p=u||0,x=c/(2*Math.sqrt(l*d)),f=i-n,g=sn(Math.sqrt(l/d)),b=Math.abs(f)<5;let v;if(a||(a=b?Li.granular:Li.default),r||(r=b?Vi.granular:Vi.default),x<1){const e=Wi(g,x);v=t=>{const s=Math.exp(-x*g*t);return i-s*((p+x*g*f)/e*Math.sin(e*t)+f*Math.cos(e*t))}}else if(1===x)v=e=>i-Math.exp(-g*e)*(f+(p+g*f)*e);else{const e=g*Math.sqrt(x*x-1);v=t=>{const s=Math.exp(-x*g*t),a=Math.min(e*t,300);return i-s*((p+x*g*f)*Math.sinh(a)+e*f*Math.cosh(a))/e}}const y={calculatedDuration:h&&m||null,next:e=>{const t=v(e);if(h)o.done=e>=m;else{let s=0===e?p:0;x<1&&(s=0===e?tn(p):Ai(v,e,t));const n=Math.abs(s)<=a,l=Math.abs(i-t)<=r;o.done=n&&l}return o.value=o.done?i:t,o},toString:()=>{const e=Math.min(Pi(y),ki),t=Si((t=>y.next(e*t).value),e,30);return e+"ms "+t},toTransition:()=>{}};return y}function Zi({keyframes:e,velocity:t=0,power:s=.8,timeConstant:a=325,bounceDamping:r=10,bounceStiffness:n=500,modifyTarget:i,min:o,max:l,restDelta:c=.5,restSpeed:d}){const m=e[0],u={done:!1,value:m},h=e=>void 0===o?l:void 0===l||Math.abs(o-e)<Math.abs(l-e)?o:l;let p=s*t;const x=m+p,f=void 0===i?x:i(x);f!==x&&(p=f-m);const g=e=>-p*Math.exp(-e/a),b=e=>f+g(e),v=e=>{const t=g(e),s=b(e);u.done=Math.abs(t)<=c,u.value=u.done?f:s};let y,j;const N=e=>{(e=>void 0!==o&&e<o||void 0!==l&&e>l)(u.value)&&(y=e,j=Ji({keyframes:[u.value,h(u.value)],velocity:Ai(b,e,u.value),damping:r,stiffness:n,restDelta:c,restSpeed:d}))};return N(0),{calculatedDuration:null,next:e=>{let t=!1;return j||void 0!==y||(t=!0,v(e),N(e)),void 0!==y&&e>=y?j.next(e-y):(!t&&v(e),u)}}}function Qi(e,t,{clamp:s=!0,ease:a,mixer:r}={}){const n=e.length;if(t.length,1===n)return()=>t[0];if(2===n&&t[0]===t[1])return()=>t[1];const i=e[0]===e[1];e[0]>e[n-1]&&(e=[...e].reverse(),t=[...t].reverse());const o=function(e,t,s){const a=[],r=s||Hr.mix||Ci,n=e.length-1;for(let i=0;i<n;i++){let s=r(e[i],e[i+1]);if(t){const e=Array.isArray(t)?t[i]||Kr:t;s=Zr(e,s)}a.push(s)}return a}(t,a,r),l=o.length,c=s=>{if(i&&s<e[0])return t[0];let a=0;if(l>1)for(;a<e.length-2&&!(s<e[a+1]);a++);const r=Qr(e[a],e[a+1],s);return o[a](r)};return s?t=>c(Ur(e[0],e[n-1],t)):c}function eo(e){const t=[0];return function(e,t){const s=e[e.length-1];for(let a=1;a<=t;a++){const r=Qr(0,t,a);e.push(pi(s,1,r))}}(t,e.length-1),t}function to({duration:e=300,keyframes:t,times:s,ease:a="easeInOut"}){const r=(e=>Array.isArray(e)&&"number"!=typeof e[0])(a)?a.map(jn):jn(a),n={done:!1,value:t[0]},i=function(e,t){return e.map((e=>e*t))}(s&&s.length===t.length?s:eo(t),e),o=Qi(i,t,{ease:Array.isArray(r)?r:(l=t,c=r,l.map((()=>c||bn)).splice(0,l.length-1))});var l,c;return{calculatedDuration:e,next:t=>(n.value=o(t),n.done=t>=e,n)}}Ji.applyToOptions=e=>{const t=function(e,t=100,s){const a=s({...e,keyframes:[0,t]}),r=Math.min(Pi(a),ki);return{type:"keyframes",ease:e=>a.next(r*e).value/t,duration:sn(r)}}(e,100,Ji);return e.ease=t.ease,e.duration=tn(t.duration),e.type="keyframes",e};const so=e=>null!==e;function ao(e,{repeat:t,repeatType:s="loop"},a,r=1){const n=e.filter(so),i=r<0||t&&"loop"!==s&&t%2==1?0:n.length-1;return i&&void 0!==a?a:n[i]}const ro={decay:Zi,inertia:Zi,tween:to,keyframes:to,spring:Ji};function no(e){"string"==typeof e.type&&(e.type=ro[e.type])}class io{constructor(){this.updateFinished()}get finished(){return this._finished}updateFinished(){this._finished=new Promise((e=>{this.resolve=e}))}notifyFinished(){this.resolve()}then(e,t){return this.finished.then(e,t)}}const oo=e=>e/100;class lo extends io{constructor(e){super(),this.state="idle",this.startTime=null,this.isStopped=!1,this.currentTime=0,this.holdTime=null,this.playbackSpeed=1,this.stop=()=>{const{motionValue:e}=this.options;e&&e.updatedAt!==Mn.now()&&this.tick(Mn.now()),this.isStopped=!0,"idle"!==this.state&&(this.teardown(),this.options.onStop?.())},this.options=e,this.initAnimation(),this.play(),!1===e.autoplay&&this.pause()}initAnimation(){const{options:e}=this;no(e);const{type:t=to,repeat:s=0,repeatDelay:a=0,repeatType:r,velocity:n=0}=e;let{keyframes:i}=e;const o=t||to;o!==to&&"number"!=typeof i[0]&&(this.mixKeyframes=Zr(oo,Ci(i[0],i[1])),i=[0,100]);const l=o({...e,keyframes:i});"mirror"===r&&(this.mirroredGenerator=o({...e,keyframes:[...i].reverse(),velocity:-n})),null===l.calculatedDuration&&(l.calculatedDuration=Pi(l));const{calculatedDuration:c}=l;this.calculatedDuration=c,this.resolvedDuration=c+a,this.totalDuration=this.resolvedDuration*(s+1)-a,this.generator=l}updateTime(e){const t=Math.round(e-this.startTime)*this.playbackSpeed;null!==this.holdTime?this.currentTime=this.holdTime:this.currentTime=t}tick(e,t=!1){const{generator:s,totalDuration:a,mixKeyframes:r,mirroredGenerator:n,resolvedDuration:i,calculatedDuration:o}=this;if(null===this.startTime)return s.next(0);const{delay:l=0,keyframes:c,repeat:d,repeatType:m,repeatDelay:u,type:h,onUpdate:p,finalKeyframe:x}=this.options;this.speed>0?this.startTime=Math.min(this.startTime,e):this.speed<0&&(this.startTime=Math.min(e-a/this.speed,this.startTime)),t?this.currentTime=e:this.updateTime(e);const f=this.currentTime-l*(this.playbackSpeed>=0?1:-1),g=this.playbackSpeed>=0?f<0:f>a;this.currentTime=Math.max(f,0),"finished"===this.state&&null===this.holdTime&&(this.currentTime=a);let b=this.currentTime,v=s;if(d){const e=Math.min(this.currentTime,a)/i;let t=Math.floor(e),s=e%1;!s&&e>=1&&(s=1),1===s&&t--,t=Math.min(t,d+1);Boolean(t%2)&&("reverse"===m?(s=1-s,u&&(s-=u/i)):"mirror"===m&&(v=n)),b=Ur(0,1,s)*i}const y=g?{done:!1,value:c[0]}:v.next(b);r&&(y.value=r(y.value));let{done:j}=y;g||null===o||(j=this.playbackSpeed>=0?this.currentTime>=a:this.currentTime<=0);const N=null===this.holdTime&&("finished"===this.state||"running"===this.state&&j);return N&&h!==Zi&&(y.value=ao(c,this.options,x,this.speed)),p&&p(y.value),N&&this.finish(),y}then(e,t){return this.finished.then(e,t)}get duration(){return sn(this.calculatedDuration)}get time(){return sn(this.currentTime)}set time(e){e=tn(e),this.currentTime=e,null===this.startTime||null!==this.holdTime||0===this.playbackSpeed?this.holdTime=e:this.driver&&(this.startTime=this.driver.now()-e/this.playbackSpeed),this.driver?.start(!1)}get speed(){return this.playbackSpeed}set speed(e){this.updateTime(Mn.now());const t=this.playbackSpeed!==e;this.playbackSpeed=e,t&&(this.time=sn(this.currentTime))}play(){if(this.isStopped)return;const{driver:e=Ei,startTime:t}=this.options;this.driver||(this.driver=e((e=>this.tick(e)))),this.options.onPlay?.();const s=this.driver.now();"finished"===this.state?(this.updateFinished(),this.startTime=s):null!==this.holdTime?this.startTime=s-this.holdTime:this.startTime||(this.startTime=t??s),"finished"===this.state&&this.speed<0&&(this.startTime+=this.calculatedDuration),this.holdTime=null,this.state="running",this.driver.start()}pause(){this.state="paused",this.updateTime(Mn.now()),this.holdTime=this.currentTime}complete(){"running"!==this.state&&this.play(),this.state="finished",this.holdTime=null}finish(){this.notifyFinished(),this.teardown(),this.state="finished",this.options.onComplete?.()}cancel(){this.holdTime=null,this.startTime=0,this.tick(0),this.teardown(),this.options.onCancel?.()}teardown(){this.state="idle",this.stopDriver(),this.startTime=this.holdTime=null}stopDriver(){this.driver&&(this.driver.stop(),this.driver=void 0)}sample(e){return this.startTime=0,this.tick(e,!0)}attachTimeline(e){return this.options.allowFlatten&&(this.options.type="keyframes",this.options.ease="linear",this.initAnimation()),this.driver?.stop(),e.observe(this)}}const co=e=>180*e/Math.PI,mo=e=>{const t=co(Math.atan2(e[1],e[0]));return ho(t)},uo={x:4,y:5,translateX:4,translateY:5,scaleX:0,scaleY:3,scale:e=>(Math.abs(e[0])+Math.abs(e[3]))/2,rotate:mo,rotateZ:mo,skewX:e=>co(Math.atan(e[1])),skewY:e=>co(Math.atan(e[2])),skew:e=>(Math.abs(e[1])+Math.abs(e[2]))/2},ho=e=>((e%=360)<0&&(e+=360),e),po=e=>Math.sqrt(e[0]*e[0]+e[1]*e[1]),xo=e=>Math.sqrt(e[4]*e[4]+e[5]*e[5]),fo={x:12,y:13,z:14,translateX:12,translateY:13,translateZ:14,scaleX:po,scaleY:xo,scale:e=>(po(e)+xo(e))/2,rotateX:e=>ho(co(Math.atan2(e[6],e[5]))),rotateY:e=>ho(co(Math.atan2(-e[2],e[0]))),rotateZ:mo,rotate:mo,skewX:e=>co(Math.atan(e[4])),skewY:e=>co(Math.atan(e[1])),skew:e=>(Math.abs(e[1])+Math.abs(e[4]))/2};function go(e){return e.includes("scale")?1:0}function bo(e,t){if(!e||"none"===e)return go(t);const s=e.match(/^matrix3d\(([-\d.e\s,]+)\)$/u);let a,r;if(s)a=fo,r=s;else{const t=e.match(/^matrix\(([-\d.e\s,]+)\)$/u);a=uo,r=t}if(!r)return go(t);const n=a[t],i=r[1].split(",").map(vo);return"function"==typeof n?n(i):i[n]}function vo(e){return parseFloat(e.trim())}const yo=["transformPerspective","x","y","z","translateX","translateY","translateZ","scale","scaleX","scaleY","rotate","rotateX","rotateY","rotateZ","skew","skewX","skewY"],jo=(()=>new Set(yo))(),No=e=>e===In||e===Jn,wo=new Set(["x","y","z"]),_o=yo.filter((e=>!wo.has(e)));const Co={width:({x:e},{paddingLeft:t="0",paddingRight:s="0"})=>e.max-e.min-parseFloat(t)-parseFloat(s),height:({y:e},{paddingTop:t="0",paddingBottom:s="0"})=>e.max-e.min-parseFloat(t)-parseFloat(s),top:(e,{top:t})=>parseFloat(t),left:(e,{left:t})=>parseFloat(t),bottom:({y:e},{top:t})=>parseFloat(t)+(e.max-e.min),right:({x:e},{left:t})=>parseFloat(t)+(e.max-e.min),x:(e,{transform:t})=>bo(t,"x"),y:(e,{transform:t})=>bo(t,"y")};Co.translateX=Co.x,Co.translateY=Co.y;const Eo=new Set;let So=!1,ko=!1,Po=!1;function Ao(){if(ko){const e=Array.from(Eo).filter((e=>e.needsMeasurement)),t=new Set(e.map((e=>e.element))),s=new Map;t.forEach((e=>{const t=function(e){const t=[];return _o.forEach((s=>{const a=e.getValue(s);void 0!==a&&(t.push([s,a.get()]),a.set(s.startsWith("scale")?1:0))})),t}(e);t.length&&(s.set(e,t),e.render())})),e.forEach((e=>e.measureInitialState())),t.forEach((e=>{e.render();const t=s.get(e);t&&t.forEach((([t,s])=>{e.getValue(t)?.set(s)}))})),e.forEach((e=>e.measureEndState())),e.forEach((e=>{void 0!==e.suspendedScrollY&&window.scrollTo(0,e.suspendedScrollY)}))}ko=!1,So=!1,Eo.forEach((e=>e.complete(Po))),Eo.clear()}function Mo(){Eo.forEach((e=>{e.readKeyframes(),e.needsMeasurement&&(ko=!0)}))}class To{constructor(e,t,s,a,r,n=!1){this.state="pending",this.isAsync=!1,this.needsMeasurement=!1,this.unresolvedKeyframes=[...e],this.onComplete=t,this.name=s,this.motionValue=a,this.element=r,this.isAsync=n}scheduleResolve(){this.state="scheduled",this.isAsync?(Eo.add(this),So||(So=!0,Cn.read(Mo),Cn.resolveKeyframes(Ao))):(this.readKeyframes(),this.complete())}readKeyframes(){const{unresolvedKeyframes:e,name:t,element:s,motionValue:a}=this;if(null===e[0]){const r=a?.get(),n=e[e.length-1];if(void 0!==r)e[0]=r;else if(s&&t){const a=s.readValue(t,n);null!=a&&(e[0]=a)}void 0===e[0]&&(e[0]=n),a&&void 0===r&&a.set(e[0])}!function(e){for(let t=1;t<e.length;t++)e[t]??(e[t]=e[t-1])}(e)}setFinalKeyframe(){}measureInitialState(){}renderEndStyles(){}measureEndState(){}complete(e=!1){this.state="complete",this.onComplete(this.unresolvedKeyframes,this.finalKeyframe,e),Eo.delete(this)}cancel(){"scheduled"===this.state&&(Eo.delete(this),this.state="pending")}resume(){"pending"===this.state&&this.scheduleResolve()}}const Ro=Yr((()=>void 0!==window.ScrollTimeline)),Do={};function qo(e,t){const s=Yr(e);return()=>Do[t]??s()}const $o=qo((()=>{try{document.createElement("div").animate({opacity:0},{easing:"linear(0, 1)"})}catch(e){return!1}return!0}),"linearEasing"),Io=([e,t,s,a])=>`cubic-bezier(${e}, ${t}, ${s}, ${a})`,Lo={linear:"linear",ease:"ease",easeIn:"ease-in",easeOut:"ease-out",easeInOut:"ease-in-out",circIn:Io([0,.65,.55,1]),circOut:Io([.55,0,1,.45]),backIn:Io([.31,.01,.66,-.59]),backOut:Io([.33,1.53,.69,.99])};function Vo(e,t){return e?"function"==typeof e?$o()?Si(e,t):"ease-out":vn(e)?Io(e):Array.isArray(e)?e.map((e=>Vo(e,t)||Lo.easeOut)):Lo[e]:void 0}function Fo(e,t,s,{delay:a=0,duration:r=300,repeat:n=0,repeatType:i="loop",ease:o="easeOut",times:l}={},c=void 0){const d={[t]:s};l&&(d.offset=l);const m=Vo(o,r);Array.isArray(m)&&(d.easing=m);const u={delay:a,duration:r,easing:Array.isArray(m)?"linear":m,fill:"both",iterations:n+1,direction:"reverse"===i?"alternate":"normal"};c&&(u.pseudoElement=c);return e.animate(d,u)}function Oo(e){return"function"==typeof e&&"applyToOptions"in e}class zo extends io{constructor(e){if(super(),this.finishedTime=null,this.isStopped=!1,!e)return;const{element:t,name:s,keyframes:a,pseudoElement:r,allowFlatten:n=!1,finalKeyframe:i,onComplete:o}=e;this.isPseudoElement=Boolean(r),this.allowFlatten=n,this.options=e,e.type;const l=function({type:e,...t}){return Oo(e)&&$o()?e.applyToOptions(t):(t.duration??(t.duration=300),t.ease??(t.ease="easeOut"),t)}(e);this.animation=Fo(t,s,a,l,r),!1===l.autoplay&&this.animation.pause(),this.animation.onfinish=()=>{if(this.finishedTime=this.time,!r){const e=ao(a,this.options,i,this.speed);this.updateMotionValue?this.updateMotionValue(e):function(e,t,s){(e=>e.startsWith("--"))(t)?e.style.setProperty(t,s):e.style[t]=s}(t,s,e),this.animation.cancel()}o?.(),this.notifyFinished()}}play(){this.isStopped||(this.animation.play(),"finished"===this.state&&this.updateFinished())}pause(){this.animation.pause()}complete(){this.animation.finish?.()}cancel(){try{this.animation.cancel()}catch(e){}}stop(){if(this.isStopped)return;this.isStopped=!0;const{state:e}=this;"idle"!==e&&"finished"!==e&&(this.updateMotionValue?this.updateMotionValue():this.commitStyles(),this.isPseudoElement||this.cancel())}commitStyles(){this.isPseudoElement||this.animation.commitStyles?.()}get duration(){const e=this.animation.effect?.getComputedTiming?.().duration||0;return sn(Number(e))}get time(){return sn(Number(this.animation.currentTime)||0)}set time(e){this.finishedTime=null,this.animation.currentTime=tn(e)}get speed(){return this.animation.playbackRate}set speed(e){e<0&&(this.finishedTime=null),this.animation.playbackRate=e}get state(){return null!==this.finishedTime?"finished":this.animation.playState}get startTime(){return Number(this.animation.startTime)}set startTime(e){this.animation.startTime=e}attachTimeline({timeline:e,observe:t}){return this.allowFlatten&&this.animation.effect?.updateTiming({easing:"linear"}),this.animation.onfinish=null,e&&Ro()?(this.animation.timeline=e,Kr):t(this)}}const Bo={anticipate:un,backInOut:mn,circInOut:xn};function Uo(e){"string"==typeof e.ease&&e.ease in Bo&&(e.ease=Bo[e.ease])}class Ho extends zo{constructor(e){Uo(e),no(e),super(e),e.startTime&&(this.startTime=e.startTime),this.options=e}updateMotionValue(e){const{motionValue:t,onUpdate:s,onComplete:a,element:r,...n}=this.options;if(!t)return;if(void 0!==e)return void t.set(e);const i=new lo({...n,autoplay:!1}),o=tn(this.finishedTime??this.time);t.setWithVelocity(i.sample(o-10).value,i.sample(o).value,10),i.stop()}}const Go=(e,t)=>"zIndex"!==t&&(!("number"!=typeof e&&!Array.isArray(e))||!("string"!=typeof e||!mi.test(e)&&"0"!==e||e.startsWith("url(")));function Wo(e){return Wr(e)&&"offsetHeight"in e}const Xo=new Set(["opacity","clipPath","filter","transform"]),Yo=Yr((()=>Object.hasOwnProperty.call(Element.prototype,"animate")));class Ko extends io{constructor({autoplay:e=!0,delay:t=0,type:s="keyframes",repeat:a=0,repeatDelay:r=0,repeatType:n="loop",keyframes:i,name:o,motionValue:l,element:c,...d}){super(),this.stop=()=>{this._animation&&(this._animation.stop(),this.stopTimeline?.()),this.keyframeResolver?.cancel()},this.createdAt=Mn.now();const m={autoplay:e,delay:t,type:s,repeat:a,repeatDelay:r,repeatType:n,name:o,motionValue:l,element:c,...d},u=c?.KeyframeResolver||To;this.keyframeResolver=new u(i,((e,t,s)=>this.onKeyframesResolved(e,t,m,!s)),o,l,c),this.keyframeResolver?.scheduleResolve()}onKeyframesResolved(e,t,s,a){this.keyframeResolver=void 0;const{name:r,type:n,velocity:i,delay:o,isHandoff:l,onUpdate:c}=s;this.resolvedAt=Mn.now(),function(e,t,s,a){const r=e[0];if(null===r)return!1;if("display"===t||"visibility"===t)return!0;const n=e[e.length-1],i=Go(r,t),o=Go(n,t);return!(!i||!o)&&(function(e){const t=e[0];if(1===e.length)return!0;for(let s=0;s<e.length;s++)if(e[s]!==t)return!0}(e)||("spring"===s||Oo(s))&&a)}(e,r,n,i)||(!Hr.instantAnimations&&o||c?.(ao(e,s,t)),e[0]=e[e.length-1],s.duration=0,s.repeat=0);const d={startTime:a?this.resolvedAt&&this.resolvedAt-this.createdAt>40?this.resolvedAt:this.createdAt:void 0,finalKeyframe:t,...s,keyframes:e},m=!l&&function(e){const{motionValue:t,name:s,repeatDelay:a,repeatType:r,damping:n,type:i}=e;if(!Wo(t?.owner?.current))return!1;const{onUpdate:o,transformTemplate:l}=t.owner.getProps();return Yo()&&s&&Xo.has(s)&&("transform"!==s||!l)&&!o&&!a&&"mirror"!==r&&0!==n&&"inertia"!==i}(d)?new Ho({...d,element:d.motionValue.owner.current}):new lo(d);m.finished.then((()=>this.notifyFinished())).catch(Kr),this.pendingTimeline&&(this.stopTimeline=m.attachTimeline(this.pendingTimeline),this.pendingTimeline=void 0),this._animation=m}get finished(){return this._animation?this.animation.finished:this._finished}then(e,t){return this.finished.finally(e).then((()=>{}))}get animation(){return this._animation||(this.keyframeResolver?.resume(),Po=!0,Mo(),Ao(),Po=!1),this._animation}get duration(){return this.animation.duration}get time(){return this.animation.time}set time(e){this.animation.time=e}get speed(){return this.animation.speed}get state(){return this.animation.state}set speed(e){this.animation.speed=e}get startTime(){return this.animation.startTime}attachTimeline(e){return this._animation?this.stopTimeline=this.animation.attachTimeline(e):this.pendingTimeline=e,()=>this.stop()}play(){this.animation.play()}pause(){this.animation.pause()}complete(){this.animation.complete()}cancel(){this._animation&&this.animation.cancel(),this.keyframeResolver?.cancel()}}const Jo=/^var\(--(?:([\w-]+)|([\w-]+), ?([a-zA-Z\d ()%#.,-]+))\)/u;function Zo(e,t,s=1){const[a,r]=function(e){const t=Jo.exec(e);if(!t)return[,];const[,s,a,r]=t;return[`--${s??a}`,r]}(e);if(!a)return;const n=window.getComputedStyle(t).getPropertyValue(a);if(n){const e=n.trim();return Gr(e)?parseFloat(e):e}return qn(r)?Zo(r,t,s+1):r}function Qo(e,t){return e?.[t]??e?.default??e}const el=new Set(["width","height","top","left","right","bottom",...yo]),tl=e=>t=>t.test(e),sl=[In,Jn,Kn,Yn,Qn,Zn,{test:e=>"auto"===e,parse:e=>e}],al=e=>sl.find(tl(e));const rl=new Set(["brightness","contrast","saturate","opacity"]);function nl(e){const[t,s]=e.slice(0,-1).split("(");if("drop-shadow"===t)return e;const[a]=s.match(On)||[];if(!a)return e;const r=s.replace(a,"");let n=rl.has(t)?1:0;return a!==s&&(n*=100),t+"("+n+r+")"}const il=/\b([a-z-]*)\(.*?\)/gu,ol={...mi,getAnimatableNone:e=>{const t=e.match(il);return t?t.map(nl).join(" "):e}},ll={...In,transform:Math.round},cl={borderWidth:Jn,borderTopWidth:Jn,borderRightWidth:Jn,borderBottomWidth:Jn,borderLeftWidth:Jn,borderRadius:Jn,radius:Jn,borderTopLeftRadius:Jn,borderTopRightRadius:Jn,borderBottomRightRadius:Jn,borderBottomLeftRadius:Jn,width:Jn,maxWidth:Jn,height:Jn,maxHeight:Jn,top:Jn,right:Jn,bottom:Jn,left:Jn,padding:Jn,paddingTop:Jn,paddingRight:Jn,paddingBottom:Jn,paddingLeft:Jn,margin:Jn,marginTop:Jn,marginRight:Jn,marginBottom:Jn,marginLeft:Jn,backgroundPositionX:Jn,backgroundPositionY:Jn,...{rotate:Yn,rotateX:Yn,rotateY:Yn,rotateZ:Yn,scale:Vn,scaleX:Vn,scaleY:Vn,scaleZ:Vn,skew:Yn,skewX:Yn,skewY:Yn,distance:Jn,translateX:Jn,translateY:Jn,translateZ:Jn,x:Jn,y:Jn,z:Jn,perspective:Jn,transformPerspective:Jn,opacity:Ln,originX:ei,originY:ei,originZ:Jn},zIndex:ll,fillOpacity:Ln,strokeOpacity:Ln,numOctaves:ll},dl={...cl,color:si,backgroundColor:si,outlineColor:si,fill:si,stroke:si,borderColor:si,borderTopColor:si,borderRightColor:si,borderBottomColor:si,borderLeftColor:si,filter:ol,WebkitFilter:ol},ml=e=>dl[e];function ul(e,t){let s=ml(e);return s!==ol&&(s=mi),s.getAnimatableNone?s.getAnimatableNone(t):void 0}const hl=new Set(["auto","none","0"]);class pl extends To{constructor(e,t,s,a,r){super(e,t,s,a,r,!0)}readKeyframes(){const{unresolvedKeyframes:e,element:t,name:s}=this;if(!t||!t.current)return;super.readKeyframes();for(let o=0;o<e.length;o++){let s=e[o];if("string"==typeof s&&(s=s.trim(),qn(s))){const a=Zo(s,t.current);void 0!==a&&(e[o]=a),o===e.length-1&&(this.finalKeyframe=s)}}if(this.resolveNoneKeyframes(),!el.has(s)||2!==e.length)return;const[a,r]=e,n=al(a),i=al(r);if(n!==i)if(No(n)&&No(i))for(let o=0;o<e.length;o++){const t=e[o];"string"==typeof t&&(e[o]=parseFloat(t))}else Co[s]&&(this.needsMeasurement=!0)}resolveNoneKeyframes(){const{unresolvedKeyframes:e,name:t}=this,s=[];for(let r=0;r<e.length;r++)(null===e[r]||("number"==typeof(a=e[r])?0===a:null===a||"none"===a||"0"===a||Xr(a)))&&s.push(r);var a;s.length&&function(e,t,s){let a,r=0;for(;r<e.length&&!a;){const t=e[r];"string"==typeof t&&!hl.has(t)&&oi(t).values.length&&(a=e[r]),r++}if(a&&s)for(const n of t)e[n]=ul(s,a)}(e,s,t)}measureInitialState(){const{element:e,unresolvedKeyframes:t,name:s}=this;if(!e||!e.current)return;"height"===s&&(this.suspendedScrollY=window.pageYOffset),this.measuredOrigin=Co[s](e.measureViewportBox(),window.getComputedStyle(e.current)),t[0]=this.measuredOrigin;const a=t[t.length-1];void 0!==a&&e.getValue(s,a).jump(a,!1)}measureEndState(){const{element:e,name:t,unresolvedKeyframes:s}=this;if(!e||!e.current)return;const a=e.getValue(t);a&&a.jump(this.measuredOrigin,!1);const r=s.length-1,n=s[r];s[r]=Co[t](e.measureViewportBox(),window.getComputedStyle(e.current)),null!==n&&void 0===this.finalKeyframe&&(this.finalKeyframe=n),this.removedTransforms?.length&&this.removedTransforms.forEach((([t,s])=>{e.getValue(t).set(s)})),this.resolveNoneKeyframes()}}const xl=(e,t)=>t&&"number"==typeof e?t.transform(e):e;class fl{constructor(e,t={}){this.canTrackVelocity=null,this.events={},this.updateAndNotify=(e,t=!0)=>{const s=Mn.now();if(this.updatedAt!==s&&this.setPrevFrameValue(),this.prev=this.current,this.setCurrent(e),this.current!==this.prev&&(this.events.change?.notify(this.current),this.dependents))for(const a of this.dependents)a.dirty();t&&this.events.renderRequest?.notify(this.current)},this.hasAnimated=!1,this.setCurrent(e),this.owner=t.owner}setCurrent(e){var t;this.current=e,this.updatedAt=Mn.now(),null===this.canTrackVelocity&&void 0!==e&&(this.canTrackVelocity=(t=this.current,!isNaN(parseFloat(t))))}setPrevFrameValue(e=this.current){this.prevFrameValue=e,this.prevUpdatedAt=this.updatedAt}onChange(e){return this.on("change",e)}on(e,t){this.events[e]||(this.events[e]=new en);const s=this.events[e].add(t);return"change"===e?()=>{s(),Cn.read((()=>{this.events.change.getSize()||this.stop()}))}:s}clearListeners(){for(const e in this.events)this.events[e].clear()}attach(e,t){this.passiveEffect=e,this.stopPassiveEffect=t}set(e,t=!0){t&&this.passiveEffect?this.passiveEffect(e,this.updateAndNotify):this.updateAndNotify(e,t)}setWithVelocity(e,t,s){this.set(t),this.prev=void 0,this.prevFrameValue=e,this.prevUpdatedAt=this.updatedAt-s}jump(e,t=!0){this.updateAndNotify(e),this.prev=e,this.prevUpdatedAt=this.prevFrameValue=void 0,t&&this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}dirty(){this.events.change?.notify(this.current)}addDependent(e){this.dependents||(this.dependents=new Set),this.dependents.add(e)}removeDependent(e){this.dependents&&this.dependents.delete(e)}get(){return this.current}getPrevious(){return this.prev}getVelocity(){const e=Mn.now();if(!this.canTrackVelocity||void 0===this.prevFrameValue||e-this.updatedAt>30)return 0;const t=Math.min(this.updatedAt-this.prevUpdatedAt,30);return an(parseFloat(this.current)-parseFloat(this.prevFrameValue),t)}start(e){return this.stop(),new Promise((t=>{this.hasAnimated=!0,this.animation=e(t),this.events.animationStart&&this.events.animationStart.notify()})).then((()=>{this.events.animationComplete&&this.events.animationComplete.notify(),this.clearAnimation()}))}stop(){this.animation&&(this.animation.stop(),this.events.animationCancel&&this.events.animationCancel.notify()),this.clearAnimation()}isAnimating(){return!!this.animation}clearAnimation(){delete this.animation}destroy(){this.dependents?.clear(),this.events.destroy?.notify(),this.clearListeners(),this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}}function gl(e,t){return new fl(e,t)}const{schedule:bl}=_n(queueMicrotask,!1),vl={x:!1,y:!1};function yl(){return vl.x||vl.y}function jl(e,t){const s=function(e,t,s){if(e instanceof EventTarget)return[e];if("string"==typeof e){let t=document;const a=s?.[e]??t.querySelectorAll(e);return a?Array.from(a):[]}return Array.from(e)}(e),a=new AbortController;return[s,{passive:!0,...t,signal:a.signal},()=>a.abort()]}function Nl(e){return!("touch"===e.pointerType||yl())}const wl=(e,t)=>!!t&&(e===t||wl(e,t.parentElement)),_l=e=>"mouse"===e.pointerType?"number"!=typeof e.button||e.button<=0:!1!==e.isPrimary,Cl=new Set(["BUTTON","INPUT","SELECT","TEXTAREA","A"]);const El=new WeakSet;function Sl(e){return t=>{"Enter"===t.key&&e(t)}}function kl(e,t){e.dispatchEvent(new PointerEvent("pointer"+t,{isPrimary:!0,bubbles:!0}))}function Pl(e){return _l(e)&&!yl()}function Al(e,t,s={}){const[a,r,n]=jl(e,s),i=e=>{const a=e.currentTarget;if(!Pl(e))return;El.add(a);const n=t(a,e),i=(e,t)=>{window.removeEventListener("pointerup",o),window.removeEventListener("pointercancel",l),El.has(a)&&El.delete(a),Pl(e)&&"function"==typeof n&&n(e,{success:t})},o=e=>{i(e,a===window||a===document||s.useGlobalTarget||wl(a,e.target))},l=e=>{i(e,!1)};window.addEventListener("pointerup",o,r),window.addEventListener("pointercancel",l,r)};return a.forEach((e=>{var t;(s.useGlobalTarget?window:e).addEventListener("pointerdown",i,r),Wo(e)&&(e.addEventListener("focus",(e=>((e,t)=>{const s=e.currentTarget;if(!s)return;const a=Sl((()=>{if(El.has(s))return;kl(s,"down");const e=Sl((()=>{kl(s,"up")}));s.addEventListener("keyup",e,t),s.addEventListener("blur",(()=>kl(s,"cancel")),t)}));s.addEventListener("keydown",a,t),s.addEventListener("blur",(()=>s.removeEventListener("keydown",a)),t)})(e,r))),t=e,Cl.has(t.tagName)||-1!==t.tabIndex||e.hasAttribute("tabindex")||(e.tabIndex=0))})),n}function Ml(e){return Wr(e)&&"ownerSVGElement"in e}const Tl=e=>Boolean(e&&e.getVelocity),Rl=[...sl,si,mi],Dl=e.createContext({transformPagePoint:e=>e,isStatic:!1,reducedMotion:"never"});class ql extends e.Component{getSnapshotBeforeUpdate(e){const t=this.props.childRef.current;if(t&&e.isPresent&&!this.props.isPresent){const e=t.offsetParent,s=Wo(e)&&e.offsetWidth||0,a=this.props.sizeRef.current;a.height=t.offsetHeight||0,a.width=t.offsetWidth||0,a.top=t.offsetTop,a.left=t.offsetLeft,a.right=s-a.width-a.left}return null}componentDidUpdate(){}render(){return this.props.children}}function $l({children:s,isPresent:a,anchorX:r}){const n=e.useId(),i=e.useRef(null),o=e.useRef({width:0,height:0,top:0,left:0,right:0}),{nonce:l}=e.useContext(Dl);return e.useInsertionEffect((()=>{const{width:e,height:t,top:s,left:c,right:d}=o.current;if(a||!i.current||!e||!t)return;const m="left"===r?`left: ${c}`:`right: ${d}`;i.current.dataset.motionPopId=n;const u=document.createElement("style");return l&&(u.nonce=l),document.head.appendChild(u),u.sheet&&u.sheet.insertRule(`\n          [data-motion-pop-id="${n}"] {\n            position: absolute !important;\n            width: ${e}px !important;\n            height: ${t}px !important;\n            ${m}px !important;\n            top: ${s}px !important;\n          }\n        `),()=>{document.head.contains(u)&&document.head.removeChild(u)}}),[a]),t.jsx(ql,{isPresent:a,childRef:i,sizeRef:o,children:e.cloneElement(s,{ref:i})})}const Il=({children:s,initial:a,isPresent:r,onExitComplete:n,custom:i,presenceAffectsLayout:o,mode:l,anchorX:c})=>{const d=Lr(Ll),m=e.useId();let u=!0,h=e.useMemo((()=>(u=!1,{id:m,initial:a,isPresent:r,custom:i,onExitComplete:e=>{d.set(e,!0);for(const t of d.values())if(!t)return;n&&n()},register:e=>(d.set(e,!1),()=>d.delete(e))})),[r,d,n]);return o&&u&&(h={...h}),e.useMemo((()=>{d.forEach(((e,t)=>d.set(t,!1)))}),[r]),e.useEffect((()=>{!r&&!d.size&&n&&n()}),[r]),"popLayout"===l&&(s=t.jsx($l,{isPresent:r,anchorX:c,children:s})),t.jsx(Or.Provider,{value:h,children:s})};function Ll(){return new Map}function Vl(t=!0){const s=e.useContext(Or);if(null===s)return[!0,null];const{isPresent:a,onExitComplete:r,register:n}=s,i=e.useId();e.useEffect((()=>{if(t)return n(i)}),[t]);const o=e.useCallback((()=>t&&r&&r(i)),[i,r,t]);return!a&&r?[!1,o]:[!0]}const Fl=e=>e.key||"";function Ol(t){const s=[];return e.Children.forEach(t,(t=>{e.isValidElement(t)&&s.push(t)})),s}const zl=({children:s,custom:a,initial:r=!0,onExitComplete:n,presenceAffectsLayout:i=!0,mode:o="sync",propagate:l=!1,anchorX:c="left"})=>{const[d,m]=Vl(l),u=e.useMemo((()=>Ol(s)),[s]),h=l&&!d?[]:u.map(Fl),p=e.useRef(!0),x=e.useRef(u),f=Lr((()=>new Map)),[g,b]=e.useState(u),[v,y]=e.useState(u);Fr((()=>{p.current=!1,x.current=u;for(let e=0;e<v.length;e++){const t=Fl(v[e]);h.includes(t)?f.delete(t):!0!==f.get(t)&&f.set(t,!1)}}),[v,h.length,h.join("-")]);const j=[];if(u!==g){let e=[...u];for(let t=0;t<v.length;t++){const s=v[t],a=Fl(s);h.includes(a)||(e.splice(t,0,s),j.push(s))}return"wait"===o&&j.length&&(e=j),y(Ol(e)),b(u),null}const{forceRender:N}=e.useContext(Ir);return t.jsx(t.Fragment,{children:v.map((e=>{const s=Fl(e),g=!(l&&!d)&&(u===v||h.includes(s));return t.jsx(Il,{isPresent:g,initial:!(p.current&&!r)&&void 0,custom:a,presenceAffectsLayout:i,mode:o,onExitComplete:g?void 0:()=>{if(!f.has(s))return;f.set(s,!0);let e=!0;f.forEach((t=>{t||(e=!1)})),e&&(N?.(),y(x.current),l&&m?.(),n&&n())},anchorX:c,children:e},s)}))})},Bl=e.createContext({strict:!1}),Ul={animation:["animate","variants","whileHover","whileTap","exit","whileInView","whileFocus","whileDrag"],exit:["exit"],drag:["drag","dragControls"],focus:["whileFocus"],hover:["whileHover","onHoverStart","onHoverEnd"],tap:["whileTap","onTap","onTapStart","onTapCancel"],pan:["onPan","onPanStart","onPanSessionStart","onPanEnd"],inView:["whileInView","onViewportEnter","onViewportLeave"],layout:["layout","layoutId"]},Hl={};for(const Dg in Ul)Hl[Dg]={isEnabled:e=>Ul[Dg].some((t=>!!e[t]))};const Gl=new Set(["animate","exit","variants","initial","style","values","variants","transition","transformTemplate","custom","inherit","onBeforeLayoutMeasure","onAnimationStart","onAnimationComplete","onUpdate","onDragStart","onDrag","onDragEnd","onMeasureDragConstraints","onDirectionLock","onDragTransitionEnd","_dragX","_dragY","onHoverStart","onHoverEnd","onViewportEnter","onViewportLeave","globalTapTarget","ignoreStrict","viewport"]);function Wl(e){return e.startsWith("while")||e.startsWith("drag")&&"draggable"!==e||e.startsWith("layout")||e.startsWith("onTap")||e.startsWith("onPan")||e.startsWith("onLayout")||Gl.has(e)}let Xl=e=>!Wl(e);try{(Yl=require("@emotion/is-prop-valid").default)&&(Xl=e=>e.startsWith("on")?!Wl(e):Yl(e))}catch{}var Yl;function Kl(e){if("undefined"==typeof Proxy)return e;const t=new Map;return new Proxy(((...t)=>e(...t)),{get:(s,a)=>"create"===a?e:(t.has(a)||t.set(a,e(a)),t.get(a))})}const Jl=e.createContext({});function Zl(e){return null!==e&&"object"==typeof e&&"function"==typeof e.start}function Ql(e){return"string"==typeof e||Array.isArray(e)}const ec=["animate","whileInView","whileFocus","whileHover","whileTap","whileDrag","exit"],tc=["initial",...ec];function sc(e){return Zl(e.animate)||tc.some((t=>Ql(e[t])))}function ac(e){return Boolean(sc(e)||e.variants)}function rc(t){const{initial:s,animate:a}=function(e,t){if(sc(e)){const{initial:t,animate:s}=e;return{initial:!1===t||Ql(t)?t:void 0,animate:Ql(s)?s:void 0}}return!1!==e.inherit?t:{}}(t,e.useContext(Jl));return e.useMemo((()=>({initial:s,animate:a})),[nc(s),nc(a)])}function nc(e){return Array.isArray(e)?e.join(" "):e}const ic=Symbol.for("motionComponentSymbol");function oc(e){return e&&"object"==typeof e&&Object.prototype.hasOwnProperty.call(e,"current")}function lc(t,s,a){return e.useCallback((e=>{e&&t.onMount&&t.onMount(e),s&&(e?s.mount(e):s.unmount()),a&&("function"==typeof a?a(e):oc(a)&&(a.current=e))}),[s])}const cc=e=>e.replace(/([a-z])([A-Z])/gu,"$1-$2").toLowerCase(),dc="data-"+cc("framerAppearId"),mc=e.createContext({});function uc(t,s,a,r,n){const{visualElement:i}=e.useContext(Jl),o=e.useContext(Bl),l=e.useContext(Or),c=e.useContext(Dl).reducedMotion,d=e.useRef(null);r=r||o.renderer,!d.current&&r&&(d.current=r(t,{visualState:s,parent:i,props:a,presenceContext:l,blockInitialAnimation:!!l&&!1===l.initial,reducedMotionConfig:c}));const m=d.current,u=e.useContext(mc);!m||m.projection||!n||"html"!==m.type&&"svg"!==m.type||function(e,t,s,a){const{layoutId:r,layout:n,drag:i,dragConstraints:o,layoutScroll:l,layoutRoot:c,layoutCrossfade:d}=t;e.projection=new s(e.latestValues,t["data-framer-portal-id"]?void 0:hc(e.parent)),e.projection.setOptions({layoutId:r,layout:n,alwaysMeasureLayout:Boolean(i)||o&&oc(o),visualElement:e,animationType:"string"==typeof n?n:"both",initialPromotionConfig:a,crossfade:d,layoutScroll:l,layoutRoot:c})}(d.current,a,n,u);const h=e.useRef(!1);e.useInsertionEffect((()=>{m&&h.current&&m.update(a,l)}));const p=a[dc],x=e.useRef(Boolean(p)&&!window.MotionHandoffIsComplete?.(p)&&window.MotionHasOptimisedAnimation?.(p));return Fr((()=>{m&&(h.current=!0,window.MotionIsMounted=!0,m.updateFeatures(),bl.render(m.render),x.current&&m.animationState&&m.animationState.animateChanges())})),e.useEffect((()=>{m&&(!x.current&&m.animationState&&m.animationState.animateChanges(),x.current&&(queueMicrotask((()=>{window.MotionHandoffMarkAsComplete?.(p)})),x.current=!1))})),m}function hc(e){if(e)return!1!==e.options.allowProjection?e.projection:hc(e.parent)}function pc({preloadedFeatures:s,createVisualElement:a,useRender:r,useVisualState:n,Component:i}){function o(s,o){let l;const c={...e.useContext(Dl),...s,layoutId:xc(s)},{isStatic:d}=c,m=rc(s),u=n(s,d);if(!d&&Vr){e.useContext(Bl).strict;const t=function(e){const{drag:t,layout:s}=Hl;if(!t&&!s)return{};const a={...t,...s};return{MeasureLayout:t?.isEnabled(e)||s?.isEnabled(e)?a.MeasureLayout:void 0,ProjectionNode:a.ProjectionNode}}(c);l=t.MeasureLayout,m.visualElement=uc(i,u,c,a,t.ProjectionNode)}return t.jsxs(Jl.Provider,{value:m,children:[l&&m.visualElement?t.jsx(l,{visualElement:m.visualElement,...c}):null,r(i,s,lc(u,m.visualElement,o),u,d,m.visualElement)]})}s&&function(e){for(const t in e)Hl[t]={...Hl[t],...e[t]}}(s),o.displayName=`motion.${"string"==typeof i?i:`create(${i.displayName??i.name??""})`}`;const l=e.forwardRef(o);return l[ic]=i,l}function xc({layoutId:t}){const s=e.useContext(Ir).id;return s&&void 0!==t?s+"-"+t:t}const fc={};function gc(e,{layout:t,layoutId:s}){return jo.has(e)||e.startsWith("origin")||(t||void 0!==s)&&(!!fc[e]||"opacity"===e)}const bc={x:"translateX",y:"translateY",z:"translateZ",transformPerspective:"perspective"},vc=yo.length;function yc(e,t,s){const{style:a,vars:r,transformOrigin:n}=e;let i=!1,o=!1;for(const l in t){const e=t[l];if(jo.has(l))i=!0;else if(Rn(l))r[l]=e;else{const t=xl(e,cl[l]);l.startsWith("origin")?(o=!0,n[l]=t):a[l]=t}}if(t.transform||(i||s?a.transform=function(e,t,s){let a="",r=!0;for(let n=0;n<vc;n++){const i=yo[n],o=e[i];if(void 0===o)continue;let l=!0;if(l="number"==typeof o?o===(i.startsWith("scale")?1:0):0===parseFloat(o),!l||s){const e=xl(o,cl[i]);l||(r=!1,a+=`${bc[i]||i}(${e}) `),s&&(t[i]=e)}}return a=a.trim(),s?a=s(t,r?"":a):r&&(a="none"),a}(t,e.transform,s):a.transform&&(a.transform="none")),o){const{originX:e="50%",originY:t="50%",originZ:s=0}=n;a.transformOrigin=`${e} ${t} ${s}`}}const jc=()=>({style:{},transform:{},transformOrigin:{},vars:{}});function Nc(e,t,s){for(const a in t)Tl(t[a])||gc(a,s)||(e[a]=t[a])}function wc(t,s){const a={};return Nc(a,t.style||{},t),Object.assign(a,function({transformTemplate:t},s){return e.useMemo((()=>{const e={style:{},transform:{},transformOrigin:{},vars:{}};return yc(e,s,t),Object.assign({},e.vars,e.style)}),[s])}(t,s)),a}function _c(e,t){const s={},a=wc(e,t);return e.drag&&!1!==e.dragListener&&(s.draggable=!1,a.userSelect=a.WebkitUserSelect=a.WebkitTouchCallout="none",a.touchAction=!0===e.drag?"none":"pan-"+("x"===e.drag?"y":"x")),void 0===e.tabIndex&&(e.onTap||e.onTapStart||e.whileTap)&&(s.tabIndex=0),s.style=a,s}const Cc={offset:"stroke-dashoffset",array:"stroke-dasharray"},Ec={offset:"strokeDashoffset",array:"strokeDasharray"};function Sc(e,{attrX:t,attrY:s,attrScale:a,pathLength:r,pathSpacing:n=1,pathOffset:i=0,...o},l,c,d){if(yc(e,o,c),l)return void(e.style.viewBox&&(e.attrs.viewBox=e.style.viewBox));e.attrs=e.style,e.style={};const{attrs:m,style:u}=e;m.transform&&(u.transform=m.transform,delete m.transform),(u.transform||m.transformOrigin)&&(u.transformOrigin=m.transformOrigin??"50% 50%",delete m.transformOrigin),u.transform&&(u.transformBox=d?.transformBox??"fill-box",delete m.transformBox),void 0!==t&&(m.x=t),void 0!==s&&(m.y=s),void 0!==a&&(m.scale=a),void 0!==r&&function(e,t,s=1,a=0,r=!0){e.pathLength=1;const n=r?Cc:Ec;e[n.offset]=Jn.transform(-a);const i=Jn.transform(t),o=Jn.transform(s);e[n.array]=`${i} ${o}`}(m,r,n,i,!1)}const kc=()=>({style:{},transform:{},transformOrigin:{},vars:{},attrs:{}}),Pc=e=>"string"==typeof e&&"svg"===e.toLowerCase();function Ac(t,s,a,r){const n=e.useMemo((()=>{const e={style:{},transform:{},transformOrigin:{},vars:{},attrs:{}};return Sc(e,s,Pc(r),t.transformTemplate,t.style),{...e.attrs,style:{...e.style}}}),[s]);if(t.style){const e={};Nc(e,t.style,t),n.style={...e,...n.style}}return n}const Mc=["animate","circle","defs","desc","ellipse","g","image","line","filter","marker","mask","metadata","path","pattern","polygon","polyline","rect","stop","switch","symbol","svg","text","tspan","use","view"];function Tc(e){return"string"==typeof e&&!e.includes("-")&&!!(Mc.indexOf(e)>-1||/[A-Z]/u.test(e))}function Rc(t=!1){return(s,a,r,{latestValues:n},i)=>{const o=(Tc(s)?Ac:_c)(a,n,i,s),l=function(e,t,s){const a={};for(const r in e)"values"===r&&"object"==typeof e.values||(Xl(r)||!0===s&&Wl(r)||!t&&!Wl(r)||e.draggable&&r.startsWith("onDrag"))&&(a[r]=e[r]);return a}(a,"string"==typeof s,t),c=s!==e.Fragment?{...l,...o,ref:r}:{},{children:d}=a,m=e.useMemo((()=>Tl(d)?d.get():d),[d]);return e.createElement(s,{...c,children:m})}}function Dc(e){const t=[{},{}];return e?.values.forEach(((e,s)=>{t[0][s]=e.get(),t[1][s]=e.getVelocity()})),t}function qc(e,t,s,a){if("function"==typeof t){const[r,n]=Dc(a);t=t(void 0!==s?s:e.custom,r,n)}if("string"==typeof t&&(t=e.variants&&e.variants[t]),"function"==typeof t){const[r,n]=Dc(a);t=t(void 0!==s?s:e.custom,r,n)}return t}function $c(e){return Tl(e)?e.get():e}const Ic=t=>(s,a)=>{const r=e.useContext(Jl),n=e.useContext(Or),i=()=>function({scrapeMotionValuesFromProps:e,createRenderState:t},s,a,r){return{latestValues:Lc(s,a,r,e),renderState:t()}}(t,s,r,n);return a?i():Lr(i)};function Lc(e,t,s,a){const r={},n=a(e,{});for(const u in n)r[u]=$c(n[u]);let{initial:i,animate:o}=e;const l=sc(e),c=ac(e);t&&c&&!l&&!1!==e.inherit&&(void 0===i&&(i=t.initial),void 0===o&&(o=t.animate));let d=!!s&&!1===s.initial;d=d||!1===i;const m=d?o:i;if(m&&"boolean"!=typeof m&&!Zl(m)){const t=Array.isArray(m)?m:[m];for(let s=0;s<t.length;s++){const a=qc(e,t[s]);if(a){const{transitionEnd:e,transition:t,...s}=a;for(const a in s){let e=s[a];if(Array.isArray(e)){e=e[d?e.length-1:0]}null!==e&&(r[a]=e)}for(const a in e)r[a]=e[a]}}}return r}function Vc(e,t,s){const{style:a}=e,r={};for(const n in a)(Tl(a[n])||t.style&&Tl(t.style[n])||gc(n,e)||void 0!==s?.getValue(n)?.liveStyle)&&(r[n]=a[n]);return r}const Fc={useVisualState:Ic({scrapeMotionValuesFromProps:Vc,createRenderState:jc})};function Oc(e,t,s){const a=Vc(e,t,s);for(const r in e)if(Tl(e[r])||Tl(t[r])){a[-1!==yo.indexOf(r)?"attr"+r.charAt(0).toUpperCase()+r.substring(1):r]=e[r]}return a}const zc={useVisualState:Ic({scrapeMotionValuesFromProps:Oc,createRenderState:kc})};function Bc(e,t){return function(s,{forwardMotionProps:a}={forwardMotionProps:!1}){return pc({...Tc(s)?zc:Fc,preloadedFeatures:e,useRender:Rc(a),createVisualElement:t,Component:s})}}function Uc(e,t,s){const a=e.getProps();return qc(a,t,void 0!==s?s:a.custom,e)}const Hc=e=>Array.isArray(e);function Gc(e,t,s){e.hasValue(t)?e.getValue(t).set(s):e.addValue(t,gl(s))}function Wc(e){return Hc(e)?e[e.length-1]||0:e}function Xc(e,t){const s=e.getValue("willChange");if(a=s,Boolean(Tl(a)&&a.add))return s.add(t);if(!s&&Hr.WillChange){const s=new Hr.WillChange("auto");e.addValue("willChange",s),s.add(t)}var a}function Yc(e){return e.props[dc]}const Kc=e=>null!==e;const Jc={type:"spring",stiffness:500,damping:25,restSpeed:10},Zc={type:"keyframes",duration:.8},Qc={type:"keyframes",ease:[.25,.1,.35,1],duration:.3},ed=(e,{keyframes:t})=>t.length>2?Zc:jo.has(e)?e.startsWith("scale")?{type:"spring",stiffness:550,damping:0===t[1]?2*Math.sqrt(550):30,restSpeed:10}:Jc:Qc;const td=(e,t,s,a={},r,n)=>i=>{const o=Qo(a,e)||{},l=o.delay||a.delay||0;let{elapsed:c=0}=a;c-=tn(l);const d={keyframes:Array.isArray(s)?s:[null,s],ease:"easeOut",velocity:t.getVelocity(),...o,delay:-c,onUpdate:e=>{t.set(e),o.onUpdate&&o.onUpdate(e)},onComplete:()=>{i(),o.onComplete&&o.onComplete()},name:e,motionValue:t,element:n?void 0:r};(function({when:e,delay:t,delayChildren:s,staggerChildren:a,staggerDirection:r,repeat:n,repeatType:i,repeatDelay:o,from:l,elapsed:c,...d}){return!!Object.keys(d).length})(o)||Object.assign(d,ed(e,d)),d.duration&&(d.duration=tn(d.duration)),d.repeatDelay&&(d.repeatDelay=tn(d.repeatDelay)),void 0!==d.from&&(d.keyframes[0]=d.from);let m=!1;if((!1===d.type||0===d.duration&&!d.repeatDelay)&&(d.duration=0,0===d.delay&&(m=!0)),(Hr.instantAnimations||Hr.skipAnimations)&&(m=!0,d.duration=0,d.delay=0),d.allowFlatten=!o.type&&!o.ease,m&&!n&&void 0!==t.get()){const e=function(e,{repeat:t,repeatType:s="loop"}){const a=e.filter(Kc);return a[t&&"loop"!==s&&t%2==1?0:a.length-1]}(d.keyframes,o);if(void 0!==e)return void Cn.update((()=>{d.onUpdate(e),d.onComplete()}))}return o.isSync?new lo(d):new Ko(d)};function sd({protectedKeys:e,needsAnimating:t},s){const a=e.hasOwnProperty(s)&&!0!==t[s];return t[s]=!1,a}function ad(e,t,{delay:s=0,transitionOverride:a,type:r}={}){let{transition:n=e.getDefaultTransition(),transitionEnd:i,...o}=t;a&&(n=a);const l=[],c=r&&e.animationState&&e.animationState.getState()[r];for(const d in o){const t=e.getValue(d,e.latestValues[d]??null),a=o[d];if(void 0===a||c&&sd(c,d))continue;const r={delay:s,...Qo(n||{},d)},i=t.get();if(void 0!==i&&!t.isAnimating&&!Array.isArray(a)&&a===i&&!r.velocity)continue;let m=!1;if(window.MotionHandoffAnimation){const t=Yc(e);if(t){const e=window.MotionHandoffAnimation(t,d,Cn);null!==e&&(r.startTime=e,m=!0)}}Xc(e,d),t.start(td(d,t,a,e.shouldReduceMotion&&el.has(d)?{type:!1}:r,e,m));const u=t.animation;u&&l.push(u)}return i&&Promise.all(l).then((()=>{Cn.update((()=>{i&&function(e,t){const s=Uc(e,t);let{transitionEnd:a={},transition:r={},...n}=s||{};n={...n,...a};for(const i in n)Gc(e,i,Wc(n[i]))}(e,i)}))})),l}function rd(e,t,s={}){const a=Uc(e,t,"exit"===s.type?e.presenceContext?.custom:void 0);let{transition:r=e.getDefaultTransition()||{}}=a||{};s.transitionOverride&&(r=s.transitionOverride);const n=a?()=>Promise.all(ad(e,a,s)):()=>Promise.resolve(),i=e.variantChildren&&e.variantChildren.size?(a=0)=>{const{delayChildren:n=0,staggerChildren:i,staggerDirection:o}=r;return function(e,t,s=0,a=0,r=1,n){const i=[],o=(e.variantChildren.size-1)*a,l=1===r?(e=0)=>e*a:(e=0)=>o-e*a;return Array.from(e.variantChildren).sort(nd).forEach(((e,a)=>{e.notify("AnimationStart",t),i.push(rd(e,t,{...n,delay:s+l(a)}).then((()=>e.notify("AnimationComplete",t))))})),Promise.all(i)}(e,t,n+a,i,o,s)}:()=>Promise.resolve(),{when:o}=r;if(o){const[e,t]="beforeChildren"===o?[n,i]:[i,n];return e().then((()=>t()))}return Promise.all([n(),i(s.delay)])}function nd(e,t){return e.sortNodePosition(t)}function id(e,t){if(!Array.isArray(t))return!1;const s=t.length;if(s!==e.length)return!1;for(let a=0;a<s;a++)if(t[a]!==e[a])return!1;return!0}const od=tc.length;function ld(e){if(!e)return;if(!e.isControllingVariants){const t=e.parent&&ld(e.parent)||{};return void 0!==e.props.initial&&(t.initial=e.props.initial),t}const t={};for(let s=0;s<od;s++){const a=tc[s],r=e.props[a];(Ql(r)||!1===r)&&(t[a]=r)}return t}const cd=[...ec].reverse(),dd=ec.length;function md(e){return t=>Promise.all(t.map((({animation:t,options:s})=>function(e,t,s={}){let a;if(e.notify("AnimationStart",t),Array.isArray(t)){const r=t.map((t=>rd(e,t,s)));a=Promise.all(r)}else if("string"==typeof t)a=rd(e,t,s);else{const r="function"==typeof t?Uc(e,t,s.custom):t;a=Promise.all(ad(e,r,s))}return a.then((()=>{e.notify("AnimationComplete",t)}))}(e,t,s))))}function ud(e){let t=md(e),s=xd(),a=!0;const r=t=>(s,a)=>{const r=Uc(e,a,"exit"===t?e.presenceContext?.custom:void 0);if(r){const{transition:e,transitionEnd:t,...a}=r;s={...s,...a,...t}}return s};function n(n){const{props:i}=e,o=ld(e.parent)||{},l=[],c=new Set;let d={},m=1/0;for(let t=0;t<dd;t++){const u=cd[t],h=s[u],p=void 0!==i[u]?i[u]:o[u],x=Ql(p),f=u===n?h.isActive:null;!1===f&&(m=t);let g=p===o[u]&&p!==i[u]&&x;if(g&&a&&e.manuallyAnimateOnMount&&(g=!1),h.protectedKeys={...d},!h.isActive&&null===f||!p&&!h.prevProp||Zl(p)||"boolean"==typeof p)continue;const b=hd(h.prevProp,p);let v=b||u===n&&h.isActive&&!g&&x||t>m&&x,y=!1;const j=Array.isArray(p)?p:[p];let N=j.reduce(r(u),{});!1===f&&(N={});const{prevResolvedValues:w={}}=h,_={...w,...N},C=t=>{v=!0,c.has(t)&&(y=!0,c.delete(t)),h.needsAnimating[t]=!0;const s=e.getValue(t);s&&(s.liveStyle=!1)};for(const e in _){const t=N[e],s=w[e];if(d.hasOwnProperty(e))continue;let a=!1;a=Hc(t)&&Hc(s)?!id(t,s):t!==s,a?null!=t?C(e):c.add(e):void 0!==t&&c.has(e)?C(e):h.protectedKeys[e]=!0}h.prevProp=p,h.prevResolvedValues=N,h.isActive&&(d={...d,...N}),a&&e.blockInitialAnimation&&(v=!1);v&&(!(g&&b)||y)&&l.push(...j.map((e=>({animation:e,options:{type:u}}))))}if(c.size){const t={};if("boolean"!=typeof i.initial){const s=Uc(e,Array.isArray(i.initial)?i.initial[0]:i.initial);s&&s.transition&&(t.transition=s.transition)}c.forEach((s=>{const a=e.getBaseTarget(s),r=e.getValue(s);r&&(r.liveStyle=!0),t[s]=a??null})),l.push({animation:t})}let u=Boolean(l.length);return!a||!1!==i.initial&&i.initial!==i.animate||e.manuallyAnimateOnMount||(u=!1),a=!1,u?t(l):Promise.resolve()}return{animateChanges:n,setActive:function(t,a){if(s[t].isActive===a)return Promise.resolve();e.variantChildren?.forEach((e=>e.animationState?.setActive(t,a))),s[t].isActive=a;const r=n(t);for(const e in s)s[e].protectedKeys={};return r},setAnimateFunction:function(s){t=s(e)},getState:()=>s,reset:()=>{s=xd(),a=!0}}}function hd(e,t){return"string"==typeof t?t!==e:!!Array.isArray(t)&&!id(t,e)}function pd(e=!1){return{isActive:e,protectedKeys:{},needsAnimating:{},prevResolvedValues:{}}}function xd(){return{animate:pd(!0),whileInView:pd(),whileHover:pd(),whileTap:pd(),whileDrag:pd(),whileFocus:pd(),exit:pd()}}class fd{constructor(e){this.isMounted=!1,this.node=e}update(){}}let gd=0;const bd={animation:{Feature:class extends fd{constructor(e){super(e),e.animationState||(e.animationState=ud(e))}updateAnimationControlsSubscription(){const{animate:e}=this.node.getProps();Zl(e)&&(this.unmountControls=e.subscribe(this.node))}mount(){this.updateAnimationControlsSubscription()}update(){const{animate:e}=this.node.getProps(),{animate:t}=this.node.prevProps||{};e!==t&&this.updateAnimationControlsSubscription()}unmount(){this.node.animationState.reset(),this.unmountControls?.()}}},exit:{Feature:class extends fd{constructor(){super(...arguments),this.id=gd++}update(){if(!this.node.presenceContext)return;const{isPresent:e,onExitComplete:t}=this.node.presenceContext,{isPresent:s}=this.node.prevPresenceContext||{};if(!this.node.animationState||e===s)return;const a=this.node.animationState.setActive("exit",!e);t&&!e&&a.then((()=>{t(this.id)}))}mount(){const{register:e,onExitComplete:t}=this.node.presenceContext||{};t&&t(this.id),e&&(this.unmount=e(this.id))}unmount(){}}}};function vd(e,t,s,a={passive:!0}){return e.addEventListener(t,s,a),()=>e.removeEventListener(t,s)}function yd(e){return{point:{x:e.pageX,y:e.pageY}}}function jd(e,t,s,a){return vd(e,t,(e=>t=>_l(t)&&e(t,yd(t)))(s),a)}function Nd({top:e,left:t,right:s,bottom:a}){return{x:{min:t,max:s},y:{min:e,max:a}}}function wd(e){return e.max-e.min}function _d(e,t,s,a=.5){e.origin=a,e.originPoint=pi(t.min,t.max,e.origin),e.scale=wd(s)/wd(t),e.translate=pi(s.min,s.max,e.origin)-e.originPoint,(e.scale>=.9999&&e.scale<=1.0001||isNaN(e.scale))&&(e.scale=1),(e.translate>=-.01&&e.translate<=.01||isNaN(e.translate))&&(e.translate=0)}function Cd(e,t,s,a){_d(e.x,t.x,s.x,a?a.originX:void 0),_d(e.y,t.y,s.y,a?a.originY:void 0)}function Ed(e,t,s){e.min=s.min+t.min,e.max=e.min+wd(t)}function Sd(e,t,s){e.min=t.min-s.min,e.max=e.min+wd(t)}function kd(e,t,s){Sd(e.x,t.x,s.x),Sd(e.y,t.y,s.y)}const Pd=()=>({x:{min:0,max:0},y:{min:0,max:0}});function Ad(e){return[e("x"),e("y")]}function Md(e){return void 0===e||1===e}function Td({scale:e,scaleX:t,scaleY:s}){return!Md(e)||!Md(t)||!Md(s)}function Rd(e){return Td(e)||Dd(e)||e.z||e.rotate||e.rotateX||e.rotateY||e.skewX||e.skewY}function Dd(e){return qd(e.x)||qd(e.y)}function qd(e){return e&&"0%"!==e}function $d(e,t,s){return s+t*(e-s)}function Id(e,t,s,a,r){return void 0!==r&&(e=$d(e,r,a)),$d(e,s,a)+t}function Ld(e,t=0,s=1,a,r){e.min=Id(e.min,t,s,a,r),e.max=Id(e.max,t,s,a,r)}function Vd(e,{x:t,y:s}){Ld(e.x,t.translate,t.scale,t.originPoint),Ld(e.y,s.translate,s.scale,s.originPoint)}const Fd=.999999999999,Od=1.0000000000001;function zd(e,t){e.min=e.min+t,e.max=e.max+t}function Bd(e,t,s,a,r=.5){Ld(e,t,s,pi(e.min,e.max,r),a)}function Ud(e,t){Bd(e.x,t.x,t.scaleX,t.scale,t.originX),Bd(e.y,t.y,t.scaleY,t.scale,t.originY)}function Hd(e,t){return Nd(function(e,t){if(!t)return e;const s=t({x:e.left,y:e.top}),a=t({x:e.right,y:e.bottom});return{top:s.y,left:s.x,bottom:a.y,right:a.x}}(e.getBoundingClientRect(),t))}const Gd=({current:e})=>e?e.ownerDocument.defaultView:null,Wd=(e,t)=>Math.abs(e-t);class Xd{constructor(e,t,{transformPagePoint:s,contextWindow:a,dragSnapToOrigin:r=!1}={}){if(this.startEvent=null,this.lastMoveEvent=null,this.lastMoveEventInfo=null,this.handlers={},this.contextWindow=window,this.updatePoint=()=>{if(!this.lastMoveEvent||!this.lastMoveEventInfo)return;const e=Jd(this.lastMoveEventInfo,this.history),t=null!==this.startEvent,s=function(e,t){const s=Wd(e.x,t.x),a=Wd(e.y,t.y);return Math.sqrt(s**2+a**2)}(e.offset,{x:0,y:0})>=3;if(!t&&!s)return;const{point:a}=e,{timestamp:r}=Sn;this.history.push({...a,timestamp:r});const{onStart:n,onMove:i}=this.handlers;t||(n&&n(this.lastMoveEvent,e),this.startEvent=this.lastMoveEvent),i&&i(this.lastMoveEvent,e)},this.handlePointerMove=(e,t)=>{this.lastMoveEvent=e,this.lastMoveEventInfo=Yd(t,this.transformPagePoint),Cn.update(this.updatePoint,!0)},this.handlePointerUp=(e,t)=>{this.end();const{onEnd:s,onSessionEnd:a,resumeAnimation:r}=this.handlers;if(this.dragSnapToOrigin&&r&&r(),!this.lastMoveEvent||!this.lastMoveEventInfo)return;const n=Jd("pointercancel"===e.type?this.lastMoveEventInfo:Yd(t,this.transformPagePoint),this.history);this.startEvent&&s&&s(e,n),a&&a(e,n)},!_l(e))return;this.dragSnapToOrigin=r,this.handlers=t,this.transformPagePoint=s,this.contextWindow=a||window;const n=Yd(yd(e),this.transformPagePoint),{point:i}=n,{timestamp:o}=Sn;this.history=[{...i,timestamp:o}];const{onSessionStart:l}=t;l&&l(e,Jd(n,this.history)),this.removeListeners=Zr(jd(this.contextWindow,"pointermove",this.handlePointerMove),jd(this.contextWindow,"pointerup",this.handlePointerUp),jd(this.contextWindow,"pointercancel",this.handlePointerUp))}updateHandlers(e){this.handlers=e}end(){this.removeListeners&&this.removeListeners(),En(this.updatePoint)}}function Yd(e,t){return t?{point:t(e.point)}:e}function Kd(e,t){return{x:e.x-t.x,y:e.y-t.y}}function Jd({point:e},t){return{point:e,delta:Kd(e,Qd(t)),offset:Kd(e,Zd(t)),velocity:em(t,.1)}}function Zd(e){return e[0]}function Qd(e){return e[e.length-1]}function em(e,t){if(e.length<2)return{x:0,y:0};let s=e.length-1,a=null;const r=Qd(e);for(;s>=0&&(a=e[s],!(r.timestamp-a.timestamp>tn(t)));)s--;if(!a)return{x:0,y:0};const n=sn(r.timestamp-a.timestamp);if(0===n)return{x:0,y:0};const i={x:(r.x-a.x)/n,y:(r.y-a.y)/n};return i.x===1/0&&(i.x=0),i.y===1/0&&(i.y=0),i}function tm(e,t,s){return{min:void 0!==t?e.min+t:void 0,max:void 0!==s?e.max+s-(e.max-e.min):void 0}}function sm(e,t){let s=t.min-e.min,a=t.max-e.max;return t.max-t.min<e.max-e.min&&([s,a]=[a,s]),{min:s,max:a}}const am=.35;function rm(e,t,s){return{min:nm(e,t),max:nm(e,s)}}function nm(e,t){return"number"==typeof e?e:e[t]||0}const im=new WeakMap;class om{constructor(e){this.openDragLock=null,this.isDragging=!1,this.currentDirection=null,this.originPoint={x:0,y:0},this.constraints=!1,this.hasMutatedConstraints=!1,this.elastic={x:{min:0,max:0},y:{min:0,max:0}},this.visualElement=e}start(e,{snapToCursor:t=!1}={}){const{presenceContext:s}=this.visualElement;if(s&&!1===s.isPresent)return;const{dragSnapToOrigin:a}=this.getProps();this.panSession=new Xd(e,{onSessionStart:e=>{const{dragSnapToOrigin:s}=this.getProps();s?this.pauseAnimation():this.stopAnimation(),t&&this.snapToCursor(yd(e).point)},onStart:(e,t)=>{const{drag:s,dragPropagation:a,onDragStart:r}=this.getProps();if(s&&!a&&(this.openDragLock&&this.openDragLock(),this.openDragLock="x"===(n=s)||"y"===n?vl[n]?null:(vl[n]=!0,()=>{vl[n]=!1}):vl.x||vl.y?null:(vl.x=vl.y=!0,()=>{vl.x=vl.y=!1}),!this.openDragLock))return;var n;this.isDragging=!0,this.currentDirection=null,this.resolveConstraints(),this.visualElement.projection&&(this.visualElement.projection.isAnimationBlocked=!0,this.visualElement.projection.target=void 0),Ad((e=>{let t=this.getAxisMotionValue(e).get()||0;if(Kn.test(t)){const{projection:s}=this.visualElement;if(s&&s.layout){const a=s.layout.layoutBox[e];if(a){t=wd(a)*(parseFloat(t)/100)}}}this.originPoint[e]=t})),r&&Cn.postRender((()=>r(e,t))),Xc(this.visualElement,"transform");const{animationState:i}=this.visualElement;i&&i.setActive("whileDrag",!0)},onMove:(e,t)=>{const{dragPropagation:s,dragDirectionLock:a,onDirectionLock:r,onDrag:n}=this.getProps();if(!s&&!this.openDragLock)return;const{offset:i}=t;if(a&&null===this.currentDirection)return this.currentDirection=function(e,t=10){let s=null;Math.abs(e.y)>t?s="y":Math.abs(e.x)>t&&(s="x");return s}(i),void(null!==this.currentDirection&&r&&r(this.currentDirection));this.updateAxis("x",t.point,i),this.updateAxis("y",t.point,i),this.visualElement.render(),n&&n(e,t)},onSessionEnd:(e,t)=>this.stop(e,t),resumeAnimation:()=>Ad((e=>"paused"===this.getAnimationState(e)&&this.getAxisMotionValue(e).animation?.play()))},{transformPagePoint:this.visualElement.getTransformPagePoint(),dragSnapToOrigin:a,contextWindow:Gd(this.visualElement)})}stop(e,t){const s=this.isDragging;if(this.cancel(),!s)return;const{velocity:a}=t;this.startAnimation(a);const{onDragEnd:r}=this.getProps();r&&Cn.postRender((()=>r(e,t)))}cancel(){this.isDragging=!1;const{projection:e,animationState:t}=this.visualElement;e&&(e.isAnimationBlocked=!1),this.panSession&&this.panSession.end(),this.panSession=void 0;const{dragPropagation:s}=this.getProps();!s&&this.openDragLock&&(this.openDragLock(),this.openDragLock=null),t&&t.setActive("whileDrag",!1)}updateAxis(e,t,s){const{drag:a}=this.getProps();if(!s||!lm(e,a,this.currentDirection))return;const r=this.getAxisMotionValue(e);let n=this.originPoint[e]+s[e];this.constraints&&this.constraints[e]&&(n=function(e,{min:t,max:s},a){return void 0!==t&&e<t?e=a?pi(t,e,a.min):Math.max(e,t):void 0!==s&&e>s&&(e=a?pi(s,e,a.max):Math.min(e,s)),e}(n,this.constraints[e],this.elastic[e])),r.set(n)}resolveConstraints(){const{dragConstraints:e,dragElastic:t}=this.getProps(),s=this.visualElement.projection&&!this.visualElement.projection.layout?this.visualElement.projection.measure(!1):this.visualElement.projection?.layout,a=this.constraints;e&&oc(e)?this.constraints||(this.constraints=this.resolveRefConstraints()):this.constraints=!(!e||!s)&&function(e,{top:t,left:s,bottom:a,right:r}){return{x:tm(e.x,s,r),y:tm(e.y,t,a)}}(s.layoutBox,e),this.elastic=function(e=am){return!1===e?e=0:!0===e&&(e=am),{x:rm(e,"left","right"),y:rm(e,"top","bottom")}}(t),a!==this.constraints&&s&&this.constraints&&!this.hasMutatedConstraints&&Ad((e=>{!1!==this.constraints&&this.getAxisMotionValue(e)&&(this.constraints[e]=function(e,t){const s={};return void 0!==t.min&&(s.min=t.min-e.min),void 0!==t.max&&(s.max=t.max-e.min),s}(s.layoutBox[e],this.constraints[e]))}))}resolveRefConstraints(){const{dragConstraints:e,onMeasureDragConstraints:t}=this.getProps();if(!e||!oc(e))return!1;const s=e.current,{projection:a}=this.visualElement;if(!a||!a.layout)return!1;const r=function(e,t,s){const a=Hd(e,s),{scroll:r}=t;return r&&(zd(a.x,r.offset.x),zd(a.y,r.offset.y)),a}(s,a.root,this.visualElement.getTransformPagePoint());let n=function(e,t){return{x:sm(e.x,t.x),y:sm(e.y,t.y)}}(a.layout.layoutBox,r);if(t){const e=t(function({x:e,y:t}){return{top:t.min,right:e.max,bottom:t.max,left:e.min}}(n));this.hasMutatedConstraints=!!e,e&&(n=Nd(e))}return n}startAnimation(e){const{drag:t,dragMomentum:s,dragElastic:a,dragTransition:r,dragSnapToOrigin:n,onDragTransitionEnd:i}=this.getProps(),o=this.constraints||{},l=Ad((i=>{if(!lm(i,t,this.currentDirection))return;let l=o&&o[i]||{};n&&(l={min:0,max:0});const c=a?200:1e6,d=a?40:1e7,m={type:"inertia",velocity:s?e[i]:0,bounceStiffness:c,bounceDamping:d,timeConstant:750,restDelta:1,restSpeed:10,...r,...l};return this.startAxisValueAnimation(i,m)}));return Promise.all(l).then(i)}startAxisValueAnimation(e,t){const s=this.getAxisMotionValue(e);return Xc(this.visualElement,e),s.start(td(e,s,0,t,this.visualElement,!1))}stopAnimation(){Ad((e=>this.getAxisMotionValue(e).stop()))}pauseAnimation(){Ad((e=>this.getAxisMotionValue(e).animation?.pause()))}getAnimationState(e){return this.getAxisMotionValue(e).animation?.state}getAxisMotionValue(e){const t=`_drag${e.toUpperCase()}`,s=this.visualElement.getProps(),a=s[t];return a||this.visualElement.getValue(e,(s.initial?s.initial[e]:void 0)||0)}snapToCursor(e){Ad((t=>{const{drag:s}=this.getProps();if(!lm(t,s,this.currentDirection))return;const{projection:a}=this.visualElement,r=this.getAxisMotionValue(t);if(a&&a.layout){const{min:s,max:n}=a.layout.layoutBox[t];r.set(e[t]-pi(s,n,.5))}}))}scalePositionWithinConstraints(){if(!this.visualElement.current)return;const{drag:e,dragConstraints:t}=this.getProps(),{projection:s}=this.visualElement;if(!oc(t)||!s||!this.constraints)return;this.stopAnimation();const a={x:0,y:0};Ad((e=>{const t=this.getAxisMotionValue(e);if(t&&!1!==this.constraints){const s=t.get();a[e]=function(e,t){let s=.5;const a=wd(e),r=wd(t);return r>a?s=Qr(t.min,t.max-a,e.min):a>r&&(s=Qr(e.min,e.max-r,t.min)),Ur(0,1,s)}({min:s,max:s},this.constraints[e])}}));const{transformTemplate:r}=this.visualElement.getProps();this.visualElement.current.style.transform=r?r({},""):"none",s.root&&s.root.updateScroll(),s.updateLayout(),this.resolveConstraints(),Ad((t=>{if(!lm(t,e,null))return;const s=this.getAxisMotionValue(t),{min:r,max:n}=this.constraints[t];s.set(pi(r,n,a[t]))}))}addListeners(){if(!this.visualElement.current)return;im.set(this.visualElement,this);const e=jd(this.visualElement.current,"pointerdown",(e=>{const{drag:t,dragListener:s=!0}=this.getProps();t&&s&&this.start(e)})),t=()=>{const{dragConstraints:e}=this.getProps();oc(e)&&e.current&&(this.constraints=this.resolveRefConstraints())},{projection:s}=this.visualElement,a=s.addEventListener("measure",t);s&&!s.layout&&(s.root&&s.root.updateScroll(),s.updateLayout()),Cn.read(t);const r=vd(window,"resize",(()=>this.scalePositionWithinConstraints())),n=s.addEventListener("didUpdate",(({delta:e,hasLayoutChanged:t})=>{this.isDragging&&t&&(Ad((t=>{const s=this.getAxisMotionValue(t);s&&(this.originPoint[t]+=e[t].translate,s.set(s.get()+e[t].translate))})),this.visualElement.render())}));return()=>{r(),e(),a(),n&&n()}}getProps(){const e=this.visualElement.getProps(),{drag:t=!1,dragDirectionLock:s=!1,dragPropagation:a=!1,dragConstraints:r=!1,dragElastic:n=am,dragMomentum:i=!0}=e;return{...e,drag:t,dragDirectionLock:s,dragPropagation:a,dragConstraints:r,dragElastic:n,dragMomentum:i}}}function lm(e,t,s){return!(!0!==t&&t!==e||null!==s&&s!==e)}const cm=e=>(t,s)=>{e&&Cn.postRender((()=>e(t,s)))};const dm={hasAnimatedSinceResize:!0,hasEverUpdated:!1};function mm(e,t){return t.max===t.min?0:e/(t.max-t.min)*100}const um={correct:(e,t)=>{if(!t.target)return e;if("string"==typeof e){if(!Jn.test(e))return e;e=parseFloat(e)}return`${mm(e,t.target.x)}% ${mm(e,t.target.y)}%`}},hm={correct:(e,{treeScale:t,projectionDelta:s})=>{const a=e,r=mi.parse(e);if(r.length>5)return a;const n=mi.createTransformer(e),i="number"!=typeof r[0]?1:0,o=s.x.scale*t.x,l=s.y.scale*t.y;r[0+i]/=o,r[1+i]/=l;const c=pi(o,l,.5);return"number"==typeof r[2+i]&&(r[2+i]/=c),"number"==typeof r[3+i]&&(r[3+i]/=c),n(r)}};class pm extends e.Component{componentDidMount(){const{visualElement:e,layoutGroup:t,switchLayoutGroup:s,layoutId:a}=this.props,{projection:r}=e;!function(e){for(const t in e)fc[t]=e[t],Rn(t)&&(fc[t].isCSSVariable=!0)}(fm),r&&(t.group&&t.group.add(r),s&&s.register&&a&&s.register(r),r.root.didUpdate(),r.addEventListener("animationComplete",(()=>{this.safeToRemove()})),r.setOptions({...r.options,onExitComplete:()=>this.safeToRemove()})),dm.hasEverUpdated=!0}getSnapshotBeforeUpdate(e){const{layoutDependency:t,visualElement:s,drag:a,isPresent:r}=this.props,{projection:n}=s;return n?(n.isPresent=r,a||e.layoutDependency!==t||void 0===t||e.isPresent!==r?n.willUpdate():this.safeToRemove(),e.isPresent!==r&&(r?n.promote():n.relegate()||Cn.postRender((()=>{const e=n.getStack();e&&e.members.length||this.safeToRemove()}))),null):null}componentDidUpdate(){const{projection:e}=this.props.visualElement;e&&(e.root.didUpdate(),bl.postRender((()=>{!e.currentAnimation&&e.isLead()&&this.safeToRemove()})))}componentWillUnmount(){const{visualElement:e,layoutGroup:t,switchLayoutGroup:s}=this.props,{projection:a}=e;a&&(a.scheduleCheckAfterUnmount(),t&&t.group&&t.group.remove(a),s&&s.deregister&&s.deregister(a))}safeToRemove(){const{safeToRemove:e}=this.props;e&&e()}render(){return null}}function xm(s){const[a,r]=Vl(),n=e.useContext(Ir);return t.jsx(pm,{...s,layoutGroup:n,switchLayoutGroup:e.useContext(mc),isPresent:a,safeToRemove:r})}const fm={borderRadius:{...um,applyTo:["borderTopLeftRadius","borderTopRightRadius","borderBottomLeftRadius","borderBottomRightRadius"]},borderTopLeftRadius:um,borderTopRightRadius:um,borderBottomLeftRadius:um,borderBottomRightRadius:um,boxShadow:hm};const gm=(e,t)=>e.depth-t.depth;class bm{constructor(){this.children=[],this.isDirty=!1}add(e){zr(this.children,e),this.isDirty=!0}remove(e){Br(this.children,e),this.isDirty=!0}forEach(e){this.isDirty&&this.children.sort(gm),this.isDirty=!1,this.children.forEach(e)}}const vm=["TopLeft","TopRight","BottomLeft","BottomRight"],ym=vm.length,jm=e=>"string"==typeof e?parseFloat(e):e,Nm=e=>"number"==typeof e||Jn.test(e);function wm(e,t){return void 0!==e[t]?e[t]:e.borderRadius}const _m=Em(0,.5,pn),Cm=Em(.5,.95,Kr);function Em(e,t,s){return a=>a<e?0:a>t?1:s(Qr(e,t,a))}function Sm(e,t){e.min=t.min,e.max=t.max}function km(e,t){Sm(e.x,t.x),Sm(e.y,t.y)}function Pm(e,t){e.translate=t.translate,e.scale=t.scale,e.originPoint=t.originPoint,e.origin=t.origin}function Am(e,t,s,a,r){return e=$d(e-=t,1/s,a),void 0!==r&&(e=$d(e,1/r,a)),e}function Mm(e,t,[s,a,r],n,i){!function(e,t=0,s=1,a=.5,r,n=e,i=e){Kn.test(t)&&(t=parseFloat(t),t=pi(i.min,i.max,t/100)-i.min);if("number"!=typeof t)return;let o=pi(n.min,n.max,a);e===n&&(o-=t),e.min=Am(e.min,t,s,o,r),e.max=Am(e.max,t,s,o,r)}(e,t[s],t[a],t[r],t.scale,n,i)}const Tm=["x","scaleX","originX"],Rm=["y","scaleY","originY"];function Dm(e,t,s,a){Mm(e.x,t,Tm,s?s.x:void 0,a?a.x:void 0),Mm(e.y,t,Rm,s?s.y:void 0,a?a.y:void 0)}function qm(e){return 0===e.translate&&1===e.scale}function $m(e){return qm(e.x)&&qm(e.y)}function Im(e,t){return e.min===t.min&&e.max===t.max}function Lm(e,t){return Math.round(e.min)===Math.round(t.min)&&Math.round(e.max)===Math.round(t.max)}function Vm(e,t){return Lm(e.x,t.x)&&Lm(e.y,t.y)}function Fm(e){return wd(e.x)/wd(e.y)}function Om(e,t){return e.translate===t.translate&&e.scale===t.scale&&e.originPoint===t.originPoint}class zm{constructor(){this.members=[]}add(e){zr(this.members,e),e.scheduleRender()}remove(e){if(Br(this.members,e),e===this.prevLead&&(this.prevLead=void 0),e===this.lead){const e=this.members[this.members.length-1];e&&this.promote(e)}}relegate(e){const t=this.members.findIndex((t=>e===t));if(0===t)return!1;let s;for(let a=t;a>=0;a--){const e=this.members[a];if(!1!==e.isPresent){s=e;break}}return!!s&&(this.promote(s),!0)}promote(e,t){const s=this.lead;if(e!==s&&(this.prevLead=s,this.lead=e,e.show(),s)){s.instance&&s.scheduleRender(),e.scheduleRender(),e.resumeFrom=s,t&&(e.resumeFrom.preserveOpacity=!0),s.snapshot&&(e.snapshot=s.snapshot,e.snapshot.latestValues=s.animationValues||s.latestValues),e.root&&e.root.isUpdating&&(e.isLayoutDirty=!0);const{crossfade:a}=e.options;!1===a&&s.hide()}}exitAnimationComplete(){this.members.forEach((e=>{const{options:t,resumingFrom:s}=e;t.onExitComplete&&t.onExitComplete(),s&&s.options.onExitComplete&&s.options.onExitComplete()}))}scheduleRender(){this.members.forEach((e=>{e.instance&&e.scheduleRender(!1)}))}removeLeadSnapshot(){this.lead&&this.lead.snapshot&&(this.lead.snapshot=void 0)}}const Bm=["","X","Y","Z"],Um={visibility:"hidden"};let Hm=0;function Gm(e,t,s,a){const{latestValues:r}=t;r[e]&&(s[e]=r[e],t.setStaticValue(e,0),a&&(a[e]=0))}function Wm(e){if(e.hasCheckedOptimisedAppear=!0,e.root===e)return;const{visualElement:t}=e.options;if(!t)return;const s=Yc(t);if(window.MotionHasOptimisedAnimation(s,"transform")){const{layout:t,layoutId:a}=e.options;window.MotionCancelOptimisedAnimation(s,"transform",Cn,!(t||a))}const{parent:a}=e;a&&!a.hasCheckedOptimisedAppear&&Wm(a)}function Xm({attachResizeListener:e,defaultParent:t,measureScroll:s,checkIsScrollRoot:a,resetTransform:r}){return class{constructor(e={},s=t?.()){this.id=Hm++,this.animationId=0,this.children=new Set,this.options={},this.isTreeAnimating=!1,this.isAnimationBlocked=!1,this.isLayoutDirty=!1,this.isProjectionDirty=!1,this.isSharedProjectionDirty=!1,this.isTransformDirty=!1,this.updateManuallyBlocked=!1,this.updateBlockedByResize=!1,this.isUpdating=!1,this.isSVG=!1,this.needsReset=!1,this.shouldResetTransform=!1,this.hasCheckedOptimisedAppear=!1,this.treeScale={x:1,y:1},this.eventHandlers=new Map,this.hasTreeAnimated=!1,this.updateScheduled=!1,this.scheduleUpdate=()=>this.update(),this.projectionUpdateScheduled=!1,this.checkUpdateFailed=()=>{this.isUpdating&&(this.isUpdating=!1,this.clearAllSnapshots())},this.updateProjection=()=>{this.projectionUpdateScheduled=!1,this.nodes.forEach(Jm),this.nodes.forEach(ru),this.nodes.forEach(nu),this.nodes.forEach(Zm)},this.resolvedRelativeTargetAt=0,this.hasProjected=!1,this.isVisible=!0,this.animationProgress=0,this.sharedNodes=new Map,this.latestValues=e,this.root=s?s.root||s:this,this.path=s?[...s.path,s]:[],this.parent=s,this.depth=s?s.depth+1:0;for(let t=0;t<this.path.length;t++)this.path[t].shouldResetTransform=!0;this.root===this&&(this.nodes=new bm)}addEventListener(e,t){return this.eventHandlers.has(e)||this.eventHandlers.set(e,new en),this.eventHandlers.get(e).add(t)}notifyListeners(e,...t){const s=this.eventHandlers.get(e);s&&s.notify(...t)}hasListeners(e){return this.eventHandlers.has(e)}mount(t){if(this.instance)return;var s;this.isSVG=Ml(t)&&!(Ml(s=t)&&"svg"===s.tagName),this.instance=t;const{layoutId:a,layout:r,visualElement:n}=this.options;if(n&&!n.current&&n.mount(t),this.root.nodes.add(this),this.parent&&this.parent.children.add(this),this.root.hasTreeAnimated&&(r||a)&&(this.isLayoutDirty=!0),e){let s;const a=()=>this.root.updateBlockedByResize=!1;e(t,(()=>{this.root.updateBlockedByResize=!0,s&&s(),s=function(e,t){const s=Mn.now(),a=({timestamp:r})=>{const n=r-s;n>=t&&(En(a),e(n-t))};return Cn.setup(a,!0),()=>En(a)}(a,250),dm.hasAnimatedSinceResize&&(dm.hasAnimatedSinceResize=!1,this.nodes.forEach(au))}))}a&&this.root.registerSharedNode(a,this),!1!==this.options.animate&&n&&(a||r)&&this.addEventListener("didUpdate",(({delta:e,hasLayoutChanged:t,hasRelativeLayoutChanged:s,layout:a})=>{if(this.isTreeAnimationBlocked())return this.target=void 0,void(this.relativeTarget=void 0);const r=this.options.transition||n.getDefaultTransition()||mu,{onLayoutAnimationStart:i,onLayoutAnimationComplete:o}=n.getProps(),l=!this.targetLayout||!Vm(this.targetLayout,a),c=!t&&s;if(this.options.layoutRoot||this.resumeFrom||c||t&&(l||!this.currentAnimation)){this.resumeFrom&&(this.resumingFrom=this.resumeFrom,this.resumingFrom.resumingFrom=void 0);const t={...Qo(r,"layout"),onPlay:i,onComplete:o};(n.shouldReduceMotion||this.options.layoutRoot)&&(t.delay=0,t.type=!1),this.startAnimation(t),this.setAnimationOrigin(e,c)}else t||au(this),this.isLead()&&this.options.onExitComplete&&this.options.onExitComplete();this.targetLayout=a}))}unmount(){this.options.layoutId&&this.willUpdate(),this.root.nodes.remove(this);const e=this.getStack();e&&e.remove(this),this.parent&&this.parent.children.delete(this),this.instance=void 0,this.eventHandlers.clear(),En(this.updateProjection)}blockUpdate(){this.updateManuallyBlocked=!0}unblockUpdate(){this.updateManuallyBlocked=!1}isUpdateBlocked(){return this.updateManuallyBlocked||this.updateBlockedByResize}isTreeAnimationBlocked(){return this.isAnimationBlocked||this.parent&&this.parent.isTreeAnimationBlocked()||!1}startUpdate(){this.isUpdateBlocked()||(this.isUpdating=!0,this.nodes&&this.nodes.forEach(iu),this.animationId++)}getTransformTemplate(){const{visualElement:e}=this.options;return e&&e.getProps().transformTemplate}willUpdate(e=!0){if(this.root.hasTreeAnimated=!0,this.root.isUpdateBlocked())return void(this.options.onExitComplete&&this.options.onExitComplete());if(window.MotionCancelOptimisedAnimation&&!this.hasCheckedOptimisedAppear&&Wm(this),!this.root.isUpdating&&this.root.startUpdate(),this.isLayoutDirty)return;this.isLayoutDirty=!0;for(let r=0;r<this.path.length;r++){const e=this.path[r];e.shouldResetTransform=!0,e.updateScroll("snapshot"),e.options.layoutRoot&&e.willUpdate(!1)}const{layoutId:t,layout:s}=this.options;if(void 0===t&&!s)return;const a=this.getTransformTemplate();this.prevTransformTemplateValue=a?a(this.latestValues,""):void 0,this.updateSnapshot(),e&&this.notifyListeners("willUpdate")}update(){this.updateScheduled=!1;if(this.isUpdateBlocked())return this.unblockUpdate(),this.clearAllSnapshots(),void this.nodes.forEach(eu);this.isUpdating||this.nodes.forEach(tu),this.isUpdating=!1,this.nodes.forEach(su),this.nodes.forEach(Ym),this.nodes.forEach(Km),this.clearAllSnapshots();const e=Mn.now();Sn.delta=Ur(0,1e3/60,e-Sn.timestamp),Sn.timestamp=e,Sn.isProcessing=!0,kn.update.process(Sn),kn.preRender.process(Sn),kn.render.process(Sn),Sn.isProcessing=!1}didUpdate(){this.updateScheduled||(this.updateScheduled=!0,bl.read(this.scheduleUpdate))}clearAllSnapshots(){this.nodes.forEach(Qm),this.sharedNodes.forEach(ou)}scheduleUpdateProjection(){this.projectionUpdateScheduled||(this.projectionUpdateScheduled=!0,Cn.preRender(this.updateProjection,!1,!0))}scheduleCheckAfterUnmount(){Cn.postRender((()=>{this.isLayoutDirty?this.root.didUpdate():this.root.checkUpdateFailed()}))}updateSnapshot(){!this.snapshot&&this.instance&&(this.snapshot=this.measure(),!this.snapshot||wd(this.snapshot.measuredBox.x)||wd(this.snapshot.measuredBox.y)||(this.snapshot=void 0))}updateLayout(){if(!this.instance)return;if(this.updateScroll(),!(this.options.alwaysMeasureLayout&&this.isLead()||this.isLayoutDirty))return;if(this.resumeFrom&&!this.resumeFrom.instance)for(let s=0;s<this.path.length;s++){this.path[s].updateScroll()}const e=this.layout;this.layout=this.measure(!1),this.layoutCorrected={x:{min:0,max:0},y:{min:0,max:0}},this.isLayoutDirty=!1,this.projectionDelta=void 0,this.notifyListeners("measure",this.layout.layoutBox);const{visualElement:t}=this.options;t&&t.notify("LayoutMeasure",this.layout.layoutBox,e?e.layoutBox:void 0)}updateScroll(e="measure"){let t=Boolean(this.options.layoutScroll&&this.instance);if(this.scroll&&this.scroll.animationId===this.root.animationId&&this.scroll.phase===e&&(t=!1),t&&this.instance){const t=a(this.instance);this.scroll={animationId:this.root.animationId,phase:e,isRoot:t,offset:s(this.instance),wasRoot:this.scroll?this.scroll.isRoot:t}}}resetTransform(){if(!r)return;const e=this.isLayoutDirty||this.shouldResetTransform||this.options.alwaysMeasureLayout,t=this.projectionDelta&&!$m(this.projectionDelta),s=this.getTransformTemplate(),a=s?s(this.latestValues,""):void 0,n=a!==this.prevTransformTemplateValue;e&&this.instance&&(t||Rd(this.latestValues)||n)&&(r(this.instance,a),this.shouldResetTransform=!1,this.scheduleRender())}measure(e=!0){const t=this.measurePageBox();let s=this.removeElementScroll(t);var a;return e&&(s=this.removeTransform(s)),pu((a=s).x),pu(a.y),{animationId:this.root.animationId,measuredBox:t,layoutBox:s,latestValues:{},source:this.id}}measurePageBox(){const{visualElement:e}=this.options;if(!e)return{x:{min:0,max:0},y:{min:0,max:0}};const t=e.measureViewportBox();if(!(this.scroll?.wasRoot||this.path.some(fu))){const{scroll:e}=this.root;e&&(zd(t.x,e.offset.x),zd(t.y,e.offset.y))}return t}removeElementScroll(e){const t={x:{min:0,max:0},y:{min:0,max:0}};if(km(t,e),this.scroll?.wasRoot)return t;for(let s=0;s<this.path.length;s++){const a=this.path[s],{scroll:r,options:n}=a;a!==this.root&&r&&n.layoutScroll&&(r.wasRoot&&km(t,e),zd(t.x,r.offset.x),zd(t.y,r.offset.y))}return t}applyTransform(e,t=!1){const s={x:{min:0,max:0},y:{min:0,max:0}};km(s,e);for(let a=0;a<this.path.length;a++){const e=this.path[a];!t&&e.options.layoutScroll&&e.scroll&&e!==e.root&&Ud(s,{x:-e.scroll.offset.x,y:-e.scroll.offset.y}),Rd(e.latestValues)&&Ud(s,e.latestValues)}return Rd(this.latestValues)&&Ud(s,this.latestValues),s}removeTransform(e){const t={x:{min:0,max:0},y:{min:0,max:0}};km(t,e);for(let s=0;s<this.path.length;s++){const e=this.path[s];if(!e.instance)continue;if(!Rd(e.latestValues))continue;Td(e.latestValues)&&e.updateSnapshot();const a={x:{min:0,max:0},y:{min:0,max:0}};km(a,e.measurePageBox()),Dm(t,e.latestValues,e.snapshot?e.snapshot.layoutBox:void 0,a)}return Rd(this.latestValues)&&Dm(t,this.latestValues),t}setTargetDelta(e){this.targetDelta=e,this.root.scheduleUpdateProjection(),this.isProjectionDirty=!0}setOptions(e){this.options={...this.options,...e,crossfade:void 0===e.crossfade||e.crossfade}}clearMeasurements(){this.scroll=void 0,this.layout=void 0,this.snapshot=void 0,this.prevTransformTemplateValue=void 0,this.targetDelta=void 0,this.target=void 0,this.isLayoutDirty=!1}forceRelativeParentToResolveTarget(){this.relativeParent&&this.relativeParent.resolvedRelativeTargetAt!==Sn.timestamp&&this.relativeParent.resolveTargetDelta(!0)}resolveTargetDelta(e=!1){const t=this.getLead();this.isProjectionDirty||(this.isProjectionDirty=t.isProjectionDirty),this.isTransformDirty||(this.isTransformDirty=t.isTransformDirty),this.isSharedProjectionDirty||(this.isSharedProjectionDirty=t.isSharedProjectionDirty);const s=Boolean(this.resumingFrom)||this!==t;if(!(e||s&&this.isSharedProjectionDirty||this.isProjectionDirty||this.parent?.isProjectionDirty||this.attemptToResolveRelativeTarget||this.root.updateBlockedByResize))return;const{layout:a,layoutId:r}=this.options;if(this.layout&&(a||r)){if(this.resolvedRelativeTargetAt=Sn.timestamp,!this.targetDelta&&!this.relativeTarget){const e=this.getClosestProjectingParent();e&&e.layout&&1!==this.animationProgress?(this.relativeParent=e,this.forceRelativeParentToResolveTarget(),this.relativeTarget={x:{min:0,max:0},y:{min:0,max:0}},this.relativeTargetOrigin={x:{min:0,max:0},y:{min:0,max:0}},kd(this.relativeTargetOrigin,this.layout.layoutBox,e.layout.layoutBox),km(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}var n,i,o;if(this.relativeTarget||this.targetDelta)if(this.target||(this.target={x:{min:0,max:0},y:{min:0,max:0}},this.targetWithTransforms={x:{min:0,max:0},y:{min:0,max:0}}),this.relativeTarget&&this.relativeTargetOrigin&&this.relativeParent&&this.relativeParent.target?(this.forceRelativeParentToResolveTarget(),n=this.target,i=this.relativeTarget,o=this.relativeParent.target,Ed(n.x,i.x,o.x),Ed(n.y,i.y,o.y)):this.targetDelta?(Boolean(this.resumingFrom)?this.target=this.applyTransform(this.layout.layoutBox):km(this.target,this.layout.layoutBox),Vd(this.target,this.targetDelta)):km(this.target,this.layout.layoutBox),this.attemptToResolveRelativeTarget){this.attemptToResolveRelativeTarget=!1;const e=this.getClosestProjectingParent();e&&Boolean(e.resumingFrom)===Boolean(this.resumingFrom)&&!e.options.layoutScroll&&e.target&&1!==this.animationProgress?(this.relativeParent=e,this.forceRelativeParentToResolveTarget(),this.relativeTarget={x:{min:0,max:0},y:{min:0,max:0}},this.relativeTargetOrigin={x:{min:0,max:0},y:{min:0,max:0}},kd(this.relativeTargetOrigin,this.target,e.target),km(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}}}getClosestProjectingParent(){if(this.parent&&!Td(this.parent.latestValues)&&!Dd(this.parent.latestValues))return this.parent.isProjecting()?this.parent:this.parent.getClosestProjectingParent()}isProjecting(){return Boolean((this.relativeTarget||this.targetDelta||this.options.layoutRoot)&&this.layout)}calcProjection(){const e=this.getLead(),t=Boolean(this.resumingFrom)||this!==e;let s=!0;if((this.isProjectionDirty||this.parent?.isProjectionDirty)&&(s=!1),t&&(this.isSharedProjectionDirty||this.isTransformDirty)&&(s=!1),this.resolvedRelativeTargetAt===Sn.timestamp&&(s=!1),s)return;const{layout:a,layoutId:r}=this.options;if(this.isTreeAnimating=Boolean(this.parent&&this.parent.isTreeAnimating||this.currentAnimation||this.pendingAnimation),this.isTreeAnimating||(this.targetDelta=this.relativeTarget=void 0),!this.layout||!a&&!r)return;km(this.layoutCorrected,this.layout.layoutBox);const n=this.treeScale.x,i=this.treeScale.y;!function(e,t,s,a=!1){const r=s.length;if(!r)return;let n,i;t.x=t.y=1;for(let o=0;o<r;o++){n=s[o],i=n.projectionDelta;const{visualElement:r}=n.options;r&&r.props.style&&"contents"===r.props.style.display||(a&&n.options.layoutScroll&&n.scroll&&n!==n.root&&Ud(e,{x:-n.scroll.offset.x,y:-n.scroll.offset.y}),i&&(t.x*=i.x.scale,t.y*=i.y.scale,Vd(e,i)),a&&Rd(n.latestValues)&&Ud(e,n.latestValues))}t.x<Od&&t.x>Fd&&(t.x=1),t.y<Od&&t.y>Fd&&(t.y=1)}(this.layoutCorrected,this.treeScale,this.path,t),!e.layout||e.target||1===this.treeScale.x&&1===this.treeScale.y||(e.target=e.layout.layoutBox,e.targetWithTransforms={x:{min:0,max:0},y:{min:0,max:0}});const{target:o}=e;o?(this.projectionDelta&&this.prevProjectionDelta?(Pm(this.prevProjectionDelta.x,this.projectionDelta.x),Pm(this.prevProjectionDelta.y,this.projectionDelta.y)):this.createProjectionDeltas(),Cd(this.projectionDelta,this.layoutCorrected,o,this.latestValues),this.treeScale.x===n&&this.treeScale.y===i&&Om(this.projectionDelta.x,this.prevProjectionDelta.x)&&Om(this.projectionDelta.y,this.prevProjectionDelta.y)||(this.hasProjected=!0,this.scheduleRender(),this.notifyListeners("projectionUpdate",o))):this.prevProjectionDelta&&(this.createProjectionDeltas(),this.scheduleRender())}hide(){this.isVisible=!1}show(){this.isVisible=!0}scheduleRender(e=!0){if(this.options.visualElement?.scheduleRender(),e){const e=this.getStack();e&&e.scheduleRender()}this.resumingFrom&&!this.resumingFrom.instance&&(this.resumingFrom=void 0)}createProjectionDeltas(){this.prevProjectionDelta={x:{translate:0,scale:1,origin:0,originPoint:0},y:{translate:0,scale:1,origin:0,originPoint:0}},this.projectionDelta={x:{translate:0,scale:1,origin:0,originPoint:0},y:{translate:0,scale:1,origin:0,originPoint:0}},this.projectionDeltaWithTransform={x:{translate:0,scale:1,origin:0,originPoint:0},y:{translate:0,scale:1,origin:0,originPoint:0}}}setAnimationOrigin(e,t=!1){const s=this.snapshot,a=s?s.latestValues:{},r={...this.latestValues},n={x:{translate:0,scale:1,origin:0,originPoint:0},y:{translate:0,scale:1,origin:0,originPoint:0}};this.relativeParent&&this.relativeParent.options.layoutRoot||(this.relativeTarget=this.relativeTargetOrigin=void 0),this.attemptToResolveRelativeTarget=!t;const i={x:{min:0,max:0},y:{min:0,max:0}},o=(s?s.source:void 0)!==(this.layout?this.layout.source:void 0),l=this.getStack(),c=!l||l.members.length<=1,d=Boolean(o&&!c&&!0===this.options.crossfade&&!this.path.some(du));let m;this.animationProgress=0,this.mixTargetDelta=t=>{const s=t/1e3;lu(n.x,e.x,s),lu(n.y,e.y,s),this.setTargetDelta(n),this.relativeTarget&&this.relativeTargetOrigin&&this.layout&&this.relativeParent&&this.relativeParent.layout&&(kd(i,this.layout.layoutBox,this.relativeParent.layout.layoutBox),function(e,t,s,a){cu(e.x,t.x,s.x,a),cu(e.y,t.y,s.y,a)}(this.relativeTarget,this.relativeTargetOrigin,i,s),m&&function(e,t){return Im(e.x,t.x)&&Im(e.y,t.y)}(this.relativeTarget,m)&&(this.isProjectionDirty=!1),m||(m={x:{min:0,max:0},y:{min:0,max:0}}),km(m,this.relativeTarget)),o&&(this.animationValues=r,function(e,t,s,a,r,n){r?(e.opacity=pi(0,s.opacity??1,_m(a)),e.opacityExit=pi(t.opacity??1,0,Cm(a))):n&&(e.opacity=pi(t.opacity??1,s.opacity??1,a));for(let i=0;i<ym;i++){const r=`border${vm[i]}Radius`;let n=wm(t,r),o=wm(s,r);void 0===n&&void 0===o||(n||(n=0),o||(o=0),0===n||0===o||Nm(n)===Nm(o)?(e[r]=Math.max(pi(jm(n),jm(o),a),0),(Kn.test(o)||Kn.test(n))&&(e[r]+="%")):e[r]=o)}(t.rotate||s.rotate)&&(e.rotate=pi(t.rotate||0,s.rotate||0,a))}(r,a,this.latestValues,s,d,c)),this.root.scheduleUpdateProjection(),this.scheduleRender(),this.animationProgress=s},this.mixTargetDelta(this.options.layoutRoot?1e3:0)}startAnimation(e){this.notifyListeners("animationStart"),this.currentAnimation?.stop(),this.resumingFrom?.currentAnimation?.stop(),this.pendingAnimation&&(En(this.pendingAnimation),this.pendingAnimation=void 0),this.pendingAnimation=Cn.update((()=>{dm.hasAnimatedSinceResize=!0,this.motionValue||(this.motionValue=gl(0)),this.currentAnimation=function(e,t,s){const a=Tl(e)?e:gl(e);return a.start(td("",a,t,s)),a.animation}(this.motionValue,[0,1e3],{...e,velocity:0,isSync:!0,onUpdate:t=>{this.mixTargetDelta(t),e.onUpdate&&e.onUpdate(t)},onStop:()=>{},onComplete:()=>{e.onComplete&&e.onComplete(),this.completeAnimation()}}),this.resumingFrom&&(this.resumingFrom.currentAnimation=this.currentAnimation),this.pendingAnimation=void 0}))}completeAnimation(){this.resumingFrom&&(this.resumingFrom.currentAnimation=void 0,this.resumingFrom.preserveOpacity=void 0);const e=this.getStack();e&&e.exitAnimationComplete(),this.resumingFrom=this.currentAnimation=this.animationValues=void 0,this.notifyListeners("animationComplete")}finishAnimation(){this.currentAnimation&&(this.mixTargetDelta&&this.mixTargetDelta(1e3),this.currentAnimation.stop()),this.completeAnimation()}applyTransformsToTarget(){const e=this.getLead();let{targetWithTransforms:t,target:s,layout:a,latestValues:r}=e;if(t&&s&&a){if(this!==e&&this.layout&&a&&xu(this.options.animationType,this.layout.layoutBox,a.layoutBox)){s=this.target||{x:{min:0,max:0},y:{min:0,max:0}};const t=wd(this.layout.layoutBox.x);s.x.min=e.target.x.min,s.x.max=s.x.min+t;const a=wd(this.layout.layoutBox.y);s.y.min=e.target.y.min,s.y.max=s.y.min+a}km(t,s),Ud(t,r),Cd(this.projectionDeltaWithTransform,this.layoutCorrected,t,r)}}registerSharedNode(e,t){this.sharedNodes.has(e)||this.sharedNodes.set(e,new zm);this.sharedNodes.get(e).add(t);const s=t.options.initialPromotionConfig;t.promote({transition:s?s.transition:void 0,preserveFollowOpacity:s&&s.shouldPreserveFollowOpacity?s.shouldPreserveFollowOpacity(t):void 0})}isLead(){const e=this.getStack();return!e||e.lead===this}getLead(){const{layoutId:e}=this.options;return e&&this.getStack()?.lead||this}getPrevLead(){const{layoutId:e}=this.options;return e?this.getStack()?.prevLead:void 0}getStack(){const{layoutId:e}=this.options;if(e)return this.root.sharedNodes.get(e)}promote({needsReset:e,transition:t,preserveFollowOpacity:s}={}){const a=this.getStack();a&&a.promote(this,s),e&&(this.projectionDelta=void 0,this.needsReset=!0),t&&this.setOptions({transition:t})}relegate(){const e=this.getStack();return!!e&&e.relegate(this)}resetSkewAndRotation(){const{visualElement:e}=this.options;if(!e)return;let t=!1;const{latestValues:s}=e;if((s.z||s.rotate||s.rotateX||s.rotateY||s.rotateZ||s.skewX||s.skewY)&&(t=!0),!t)return;const a={};s.z&&Gm("z",e,a,this.animationValues);for(let r=0;r<Bm.length;r++)Gm(`rotate${Bm[r]}`,e,a,this.animationValues),Gm(`skew${Bm[r]}`,e,a,this.animationValues);e.render();for(const r in a)e.setStaticValue(r,a[r]),this.animationValues&&(this.animationValues[r]=a[r]);e.scheduleRender()}getProjectionStyles(e){if(!this.instance||this.isSVG)return;if(!this.isVisible)return Um;const t={visibility:""},s=this.getTransformTemplate();if(this.needsReset)return this.needsReset=!1,t.opacity="",t.pointerEvents=$c(e?.pointerEvents)||"",t.transform=s?s(this.latestValues,""):"none",t;const a=this.getLead();if(!this.projectionDelta||!this.layout||!a.target){const t={};return this.options.layoutId&&(t.opacity=void 0!==this.latestValues.opacity?this.latestValues.opacity:1,t.pointerEvents=$c(e?.pointerEvents)||""),this.hasProjected&&!Rd(this.latestValues)&&(t.transform=s?s({},""):"none",this.hasProjected=!1),t}const r=a.animationValues||a.latestValues;this.applyTransformsToTarget(),t.transform=function(e,t,s){let a="";const r=e.x.translate/t.x,n=e.y.translate/t.y,i=s?.z||0;if((r||n||i)&&(a=`translate3d(${r}px, ${n}px, ${i}px) `),1===t.x&&1===t.y||(a+=`scale(${1/t.x}, ${1/t.y}) `),s){const{transformPerspective:e,rotate:t,rotateX:r,rotateY:n,skewX:i,skewY:o}=s;e&&(a=`perspective(${e}px) ${a}`),t&&(a+=`rotate(${t}deg) `),r&&(a+=`rotateX(${r}deg) `),n&&(a+=`rotateY(${n}deg) `),i&&(a+=`skewX(${i}deg) `),o&&(a+=`skewY(${o}deg) `)}const o=e.x.scale*t.x,l=e.y.scale*t.y;return 1===o&&1===l||(a+=`scale(${o}, ${l})`),a||"none"}(this.projectionDeltaWithTransform,this.treeScale,r),s&&(t.transform=s(r,t.transform));const{x:n,y:i}=this.projectionDelta;t.transformOrigin=`${100*n.origin}% ${100*i.origin}% 0`,a.animationValues?t.opacity=a===this?r.opacity??this.latestValues.opacity??1:this.preserveOpacity?this.latestValues.opacity:r.opacityExit:t.opacity=a===this?void 0!==r.opacity?r.opacity:"":void 0!==r.opacityExit?r.opacityExit:0;for(const o in fc){if(void 0===r[o])continue;const{correct:e,applyTo:s,isCSSVariable:n}=fc[o],i="none"===t.transform?r[o]:e(r[o],a);if(s){const e=s.length;for(let a=0;a<e;a++)t[s[a]]=i}else n?this.options.visualElement.renderState.vars[o]=i:t[o]=i}return this.options.layoutId&&(t.pointerEvents=a===this?$c(e?.pointerEvents)||"":"none"),t}clearSnapshot(){this.resumeFrom=this.snapshot=void 0}resetTree(){this.root.nodes.forEach((e=>e.currentAnimation?.stop())),this.root.nodes.forEach(eu),this.root.sharedNodes.clear()}}}function Ym(e){e.updateLayout()}function Km(e){const t=e.resumeFrom?.snapshot||e.snapshot;if(e.isLead()&&e.layout&&t&&e.hasListeners("didUpdate")){const{layoutBox:s,measuredBox:a}=e.layout,{animationType:r}=e.options,n=t.source!==e.layout.source;"size"===r?Ad((e=>{const a=n?t.measuredBox[e]:t.layoutBox[e],r=wd(a);a.min=s[e].min,a.max=a.min+r})):xu(r,t.layoutBox,s)&&Ad((a=>{const r=n?t.measuredBox[a]:t.layoutBox[a],i=wd(s[a]);r.max=r.min+i,e.relativeTarget&&!e.currentAnimation&&(e.isProjectionDirty=!0,e.relativeTarget[a].max=e.relativeTarget[a].min+i)}));const i={x:{translate:0,scale:1,origin:0,originPoint:0},y:{translate:0,scale:1,origin:0,originPoint:0}};Cd(i,s,t.layoutBox);const o={x:{translate:0,scale:1,origin:0,originPoint:0},y:{translate:0,scale:1,origin:0,originPoint:0}};n?Cd(o,e.applyTransform(a,!0),t.measuredBox):Cd(o,s,t.layoutBox);const l=!$m(i);let c=!1;if(!e.resumeFrom){const a=e.getClosestProjectingParent();if(a&&!a.resumeFrom){const{snapshot:r,layout:n}=a;if(r&&n){const i={x:{min:0,max:0},y:{min:0,max:0}};kd(i,t.layoutBox,r.layoutBox);const o={x:{min:0,max:0},y:{min:0,max:0}};kd(o,s,n.layoutBox),Vm(i,o)||(c=!0),a.options.layoutRoot&&(e.relativeTarget=o,e.relativeTargetOrigin=i,e.relativeParent=a)}}}e.notifyListeners("didUpdate",{layout:s,snapshot:t,delta:o,layoutDelta:i,hasLayoutChanged:l,hasRelativeLayoutChanged:c})}else if(e.isLead()){const{onExitComplete:t}=e.options;t&&t()}e.options.transition=void 0}function Jm(e){e.parent&&(e.isProjecting()||(e.isProjectionDirty=e.parent.isProjectionDirty),e.isSharedProjectionDirty||(e.isSharedProjectionDirty=Boolean(e.isProjectionDirty||e.parent.isProjectionDirty||e.parent.isSharedProjectionDirty)),e.isTransformDirty||(e.isTransformDirty=e.parent.isTransformDirty))}function Zm(e){e.isProjectionDirty=e.isSharedProjectionDirty=e.isTransformDirty=!1}function Qm(e){e.clearSnapshot()}function eu(e){e.clearMeasurements()}function tu(e){e.isLayoutDirty=!1}function su(e){const{visualElement:t}=e.options;t&&t.getProps().onBeforeLayoutMeasure&&t.notify("BeforeLayoutMeasure"),e.resetTransform()}function au(e){e.finishAnimation(),e.targetDelta=e.relativeTarget=e.target=void 0,e.isProjectionDirty=!0}function ru(e){e.resolveTargetDelta()}function nu(e){e.calcProjection()}function iu(e){e.resetSkewAndRotation()}function ou(e){e.removeLeadSnapshot()}function lu(e,t,s){e.translate=pi(t.translate,0,s),e.scale=pi(t.scale,1,s),e.origin=t.origin,e.originPoint=t.originPoint}function cu(e,t,s,a){e.min=pi(t.min,s.min,a),e.max=pi(t.max,s.max,a)}function du(e){return e.animationValues&&void 0!==e.animationValues.opacityExit}const mu={duration:.45,ease:[.4,0,.1,1]},uu=e=>"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().includes(e),hu=uu("applewebkit/")&&!uu("chrome/")?Math.round:Kr;function pu(e){e.min=hu(e.min),e.max=hu(e.max)}function xu(e,t,s){return"position"===e||"preserve-aspect"===e&&(a=Fm(t),r=Fm(s),n=.2,!(Math.abs(a-r)<=n));var a,r,n}function fu(e){return e!==e.root&&e.scroll?.wasRoot}const gu=Xm({attachResizeListener:(e,t)=>vd(e,"resize",t),measureScroll:()=>({x:document.documentElement.scrollLeft||document.body.scrollLeft,y:document.documentElement.scrollTop||document.body.scrollTop}),checkIsScrollRoot:()=>!0}),bu={current:void 0},vu=Xm({measureScroll:e=>({x:e.scrollLeft,y:e.scrollTop}),defaultParent:()=>{if(!bu.current){const e=new gu({});e.mount(window),e.setOptions({layoutScroll:!0}),bu.current=e}return bu.current},resetTransform:(e,t)=>{e.style.transform=void 0!==t?t:"none"},checkIsScrollRoot:e=>Boolean("fixed"===window.getComputedStyle(e).position)}),yu={pan:{Feature:class extends fd{constructor(){super(...arguments),this.removePointerDownListener=Kr}onPointerDown(e){this.session=new Xd(e,this.createPanHandlers(),{transformPagePoint:this.node.getTransformPagePoint(),contextWindow:Gd(this.node)})}createPanHandlers(){const{onPanSessionStart:e,onPanStart:t,onPan:s,onPanEnd:a}=this.node.getProps();return{onSessionStart:cm(e),onStart:cm(t),onMove:s,onEnd:(e,t)=>{delete this.session,a&&Cn.postRender((()=>a(e,t)))}}}mount(){this.removePointerDownListener=jd(this.node.current,"pointerdown",(e=>this.onPointerDown(e)))}update(){this.session&&this.session.updateHandlers(this.createPanHandlers())}unmount(){this.removePointerDownListener(),this.session&&this.session.end()}}},drag:{Feature:class extends fd{constructor(e){super(e),this.removeGroupControls=Kr,this.removeListeners=Kr,this.controls=new om(e)}mount(){const{dragControls:e}=this.node.getProps();e&&(this.removeGroupControls=e.subscribe(this.controls)),this.removeListeners=this.controls.addListeners()||Kr}unmount(){this.removeGroupControls(),this.removeListeners()}},ProjectionNode:vu,MeasureLayout:xm}};function ju(e,t,s){const{props:a}=e;e.animationState&&a.whileHover&&e.animationState.setActive("whileHover","Start"===s);const r=a["onHover"+s];r&&Cn.postRender((()=>r(t,yd(t))))}function Nu(e,t,s){const{props:a}=e;if(e.current instanceof HTMLButtonElement&&e.current.disabled)return;e.animationState&&a.whileTap&&e.animationState.setActive("whileTap","Start"===s);const r=a["onTap"+("End"===s?"":s)];r&&Cn.postRender((()=>r(t,yd(t))))}const wu=new WeakMap,_u=new WeakMap,Cu=e=>{const t=wu.get(e.target);t&&t(e)},Eu=e=>{e.forEach(Cu)};function Su(e,t,s){const a=function({root:e,...t}){const s=e||document;_u.has(s)||_u.set(s,{});const a=_u.get(s),r=JSON.stringify(t);return a[r]||(a[r]=new IntersectionObserver(Eu,{root:e,...t})),a[r]}(t);return wu.set(e,s),a.observe(e),()=>{wu.delete(e),a.unobserve(e)}}const ku={some:0,all:1};const Pu={inView:{Feature:class extends fd{constructor(){super(...arguments),this.hasEnteredView=!1,this.isInView=!1}startObserver(){this.unmount();const{viewport:e={}}=this.node.getProps(),{root:t,margin:s,amount:a="some",once:r}=e,n={root:t?t.current:void 0,rootMargin:s,threshold:"number"==typeof a?a:ku[a]};return Su(this.node.current,n,(e=>{const{isIntersecting:t}=e;if(this.isInView===t)return;if(this.isInView=t,r&&!t&&this.hasEnteredView)return;t&&(this.hasEnteredView=!0),this.node.animationState&&this.node.animationState.setActive("whileInView",t);const{onViewportEnter:s,onViewportLeave:a}=this.node.getProps(),n=t?s:a;n&&n(e)}))}mount(){this.startObserver()}update(){if("undefined"==typeof IntersectionObserver)return;const{props:e,prevProps:t}=this.node;["amount","margin","root"].some(function({viewport:e={}},{viewport:t={}}={}){return s=>e[s]!==t[s]}(e,t))&&this.startObserver()}unmount(){}}},tap:{Feature:class extends fd{mount(){const{current:e}=this.node;e&&(this.unmount=Al(e,((e,t)=>(Nu(this.node,t,"Start"),(e,{success:t})=>Nu(this.node,e,t?"End":"Cancel"))),{useGlobalTarget:this.node.props.globalTapTarget}))}unmount(){}}},focus:{Feature:class extends fd{constructor(){super(...arguments),this.isActive=!1}onFocus(){let e=!1;try{e=this.node.current.matches(":focus-visible")}catch(t){e=!0}e&&this.node.animationState&&(this.node.animationState.setActive("whileFocus",!0),this.isActive=!0)}onBlur(){this.isActive&&this.node.animationState&&(this.node.animationState.setActive("whileFocus",!1),this.isActive=!1)}mount(){this.unmount=Zr(vd(this.node.current,"focus",(()=>this.onFocus())),vd(this.node.current,"blur",(()=>this.onBlur())))}unmount(){}}},hover:{Feature:class extends fd{mount(){const{current:e}=this.node;e&&(this.unmount=function(e,t,s={}){const[a,r,n]=jl(e,s),i=e=>{if(!Nl(e))return;const{target:s}=e,a=t(s,e);if("function"!=typeof a||!s)return;const n=e=>{Nl(e)&&(a(e),s.removeEventListener("pointerleave",n))};s.addEventListener("pointerleave",n,r)};return a.forEach((e=>{e.addEventListener("pointerenter",i,r)})),n}(e,((e,t)=>(ju(this.node,t,"Start"),e=>ju(this.node,e,"End")))))}unmount(){}}}},Au={layout:{ProjectionNode:vu,MeasureLayout:xm}},Mu={current:null},Tu={current:!1};const Ru=new WeakMap;const Du=["AnimationStart","AnimationComplete","Update","BeforeLayoutMeasure","LayoutMeasure","LayoutAnimationStart","LayoutAnimationComplete"];class qu{scrapeMotionValuesFromProps(e,t,s){return{}}constructor({parent:e,props:t,presenceContext:s,reducedMotionConfig:a,blockInitialAnimation:r,visualState:n},i={}){this.current=null,this.children=new Set,this.isVariantNode=!1,this.isControllingVariants=!1,this.shouldReduceMotion=null,this.values=new Map,this.KeyframeResolver=To,this.features={},this.valueSubscriptions=new Map,this.prevMotionValues={},this.events={},this.propEventSubscriptions={},this.notifyUpdate=()=>this.notify("Update",this.latestValues),this.render=()=>{this.current&&(this.triggerBuild(),this.renderInstance(this.current,this.renderState,this.props.style,this.projection))},this.renderScheduledAt=0,this.scheduleRender=()=>{const e=Mn.now();this.renderScheduledAt<e&&(this.renderScheduledAt=e,Cn.render(this.render,!1,!0))};const{latestValues:o,renderState:l}=n;this.latestValues=o,this.baseTarget={...o},this.initialValues=t.initial?{...o}:{},this.renderState=l,this.parent=e,this.props=t,this.presenceContext=s,this.depth=e?e.depth+1:0,this.reducedMotionConfig=a,this.options=i,this.blockInitialAnimation=Boolean(r),this.isControllingVariants=sc(t),this.isVariantNode=ac(t),this.isVariantNode&&(this.variantChildren=new Set),this.manuallyAnimateOnMount=Boolean(e&&e.current);const{willChange:c,...d}=this.scrapeMotionValuesFromProps(t,{},this);for(const m in d){const e=d[m];void 0!==o[m]&&Tl(e)&&e.set(o[m],!1)}}mount(e){this.current=e,Ru.set(e,this),this.projection&&!this.projection.instance&&this.projection.mount(e),this.parent&&this.isVariantNode&&!this.isControllingVariants&&(this.removeFromVariantTree=this.parent.addVariantChild(this)),this.values.forEach(((e,t)=>this.bindToMotionValue(t,e))),Tu.current||function(){if(Tu.current=!0,Vr)if(window.matchMedia){const e=window.matchMedia("(prefers-reduced-motion)"),t=()=>Mu.current=e.matches;e.addListener(t),t()}else Mu.current=!1}(),this.shouldReduceMotion="never"!==this.reducedMotionConfig&&("always"===this.reducedMotionConfig||Mu.current),this.parent&&this.parent.children.add(this),this.update(this.props,this.presenceContext)}unmount(){this.projection&&this.projection.unmount(),En(this.notifyUpdate),En(this.render),this.valueSubscriptions.forEach((e=>e())),this.valueSubscriptions.clear(),this.removeFromVariantTree&&this.removeFromVariantTree(),this.parent&&this.parent.children.delete(this);for(const e in this.events)this.events[e].clear();for(const e in this.features){const t=this.features[e];t&&(t.unmount(),t.isMounted=!1)}this.current=null}bindToMotionValue(e,t){this.valueSubscriptions.has(e)&&this.valueSubscriptions.get(e)();const s=jo.has(e);s&&this.onBindTransform&&this.onBindTransform();const a=t.on("change",(t=>{this.latestValues[e]=t,this.props.onUpdate&&Cn.preRender(this.notifyUpdate),s&&this.projection&&(this.projection.isTransformDirty=!0)})),r=t.on("renderRequest",this.scheduleRender);let n;window.MotionCheckAppearSync&&(n=window.MotionCheckAppearSync(this,e,t)),this.valueSubscriptions.set(e,(()=>{a(),r(),n&&n(),t.owner&&t.stop()}))}sortNodePosition(e){return this.current&&this.sortInstanceNodePosition&&this.type===e.type?this.sortInstanceNodePosition(this.current,e.current):0}updateFeatures(){let e="animation";for(e in Hl){const t=Hl[e];if(!t)continue;const{isEnabled:s,Feature:a}=t;if(!this.features[e]&&a&&s(this.props)&&(this.features[e]=new a(this)),this.features[e]){const t=this.features[e];t.isMounted?t.update():(t.mount(),t.isMounted=!0)}}}triggerBuild(){this.build(this.renderState,this.latestValues,this.props)}measureViewportBox(){return this.current?this.measureInstanceViewportBox(this.current,this.props):{x:{min:0,max:0},y:{min:0,max:0}}}getStaticValue(e){return this.latestValues[e]}setStaticValue(e,t){this.latestValues[e]=t}update(e,t){(e.transformTemplate||this.props.transformTemplate)&&this.scheduleRender(),this.prevProps=this.props,this.props=e,this.prevPresenceContext=this.presenceContext,this.presenceContext=t;for(let s=0;s<Du.length;s++){const t=Du[s];this.propEventSubscriptions[t]&&(this.propEventSubscriptions[t](),delete this.propEventSubscriptions[t]);const a=e["on"+t];a&&(this.propEventSubscriptions[t]=this.on(t,a))}this.prevMotionValues=function(e,t,s){for(const a in t){const r=t[a],n=s[a];if(Tl(r))e.addValue(a,r);else if(Tl(n))e.addValue(a,gl(r,{owner:e}));else if(n!==r)if(e.hasValue(a)){const t=e.getValue(a);!0===t.liveStyle?t.jump(r):t.hasAnimated||t.set(r)}else{const t=e.getStaticValue(a);e.addValue(a,gl(void 0!==t?t:r,{owner:e}))}}for(const a in s)void 0===t[a]&&e.removeValue(a);return t}(this,this.scrapeMotionValuesFromProps(e,this.prevProps,this),this.prevMotionValues),this.handleChildMotionValue&&this.handleChildMotionValue()}getProps(){return this.props}getVariant(e){return this.props.variants?this.props.variants[e]:void 0}getDefaultTransition(){return this.props.transition}getTransformPagePoint(){return this.props.transformPagePoint}getClosestVariantNode(){return this.isVariantNode?this:this.parent?this.parent.getClosestVariantNode():void 0}addVariantChild(e){const t=this.getClosestVariantNode();if(t)return t.variantChildren&&t.variantChildren.add(e),()=>t.variantChildren.delete(e)}addValue(e,t){const s=this.values.get(e);t!==s&&(s&&this.removeValue(e),this.bindToMotionValue(e,t),this.values.set(e,t),this.latestValues[e]=t.get())}removeValue(e){this.values.delete(e);const t=this.valueSubscriptions.get(e);t&&(t(),this.valueSubscriptions.delete(e)),delete this.latestValues[e],this.removeValueFromRenderState(e,this.renderState)}hasValue(e){return this.values.has(e)}getValue(e,t){if(this.props.values&&this.props.values[e])return this.props.values[e];let s=this.values.get(e);return void 0===s&&void 0!==t&&(s=gl(null===t?void 0:t,{owner:this}),this.addValue(e,s)),s}readValue(e,t){let s=void 0===this.latestValues[e]&&this.current?this.getBaseTargetFromProps(this.props,e)??this.readValueFromInstance(this.current,e,this.options):this.latestValues[e];return null!=s&&("string"==typeof s&&(Gr(s)||Xr(s))?s=parseFloat(s):!(e=>Rl.find(tl(e)))(s)&&mi.test(t)&&(s=ul(e,t)),this.setBaseTarget(e,Tl(s)?s.get():s)),Tl(s)?s.get():s}setBaseTarget(e,t){this.baseTarget[e]=t}getBaseTarget(e){const{initial:t}=this.props;let s;if("string"==typeof t||"object"==typeof t){const a=qc(this.props,t,this.presenceContext?.custom);a&&(s=a[e])}if(t&&void 0!==s)return s;const a=this.getBaseTargetFromProps(this.props,e);return void 0===a||Tl(a)?void 0!==this.initialValues[e]&&void 0===s?void 0:this.baseTarget[e]:a}on(e,t){return this.events[e]||(this.events[e]=new en),this.events[e].add(t)}notify(e,...t){this.events[e]&&this.events[e].notify(...t)}}class $u extends qu{constructor(){super(...arguments),this.KeyframeResolver=pl}sortInstanceNodePosition(e,t){return 2&e.compareDocumentPosition(t)?1:-1}getBaseTargetFromProps(e,t){return e.style?e.style[t]:void 0}removeValueFromRenderState(e,{vars:t,style:s}){delete t[e],delete s[e]}handleChildMotionValue(){this.childSubscription&&(this.childSubscription(),delete this.childSubscription);const{children:e}=this.props;Tl(e)&&(this.childSubscription=e.on("change",(e=>{this.current&&(this.current.textContent=`${e}`)})))}}function Iu(e,{style:t,vars:s},a,r){Object.assign(e.style,t,r&&r.getProjectionStyles(a));for(const n in s)e.style.setProperty(n,s[n])}class Lu extends $u{constructor(){super(...arguments),this.type="html",this.renderInstance=Iu}readValueFromInstance(e,t){if(jo.has(t))return this.projection?.isProjecting?go(t):((e,t)=>{const{transform:s="none"}=getComputedStyle(e);return bo(s,t)})(e,t);{const a=(s=e,window.getComputedStyle(s)),r=(Rn(t)?a.getPropertyValue(t):a[t])||0;return"string"==typeof r?r.trim():r}var s}measureInstanceViewportBox(e,{transformPagePoint:t}){return Hd(e,t)}build(e,t,s){yc(e,t,s.transformTemplate)}scrapeMotionValuesFromProps(e,t,s){return Vc(e,t,s)}}const Vu=new Set(["baseFrequency","diffuseConstant","kernelMatrix","kernelUnitLength","keySplines","keyTimes","limitingConeAngle","markerHeight","markerWidth","numOctaves","targetX","targetY","surfaceScale","specularConstant","specularExponent","stdDeviation","tableValues","viewBox","gradientTransform","pathLength","startOffset","textLength","lengthAdjust"]);class Fu extends $u{constructor(){super(...arguments),this.type="svg",this.isSVGTag=!1,this.measureInstanceViewportBox=Pd}getBaseTargetFromProps(e,t){return e[t]}readValueFromInstance(e,t){if(jo.has(t)){const e=ml(t);return e&&e.default||0}return t=Vu.has(t)?t:cc(t),e.getAttribute(t)}scrapeMotionValuesFromProps(e,t,s){return Oc(e,t,s)}build(e,t,s){Sc(e,t,this.isSVGTag,s.transformTemplate,s.style)}renderInstance(e,t,s,a){!function(e,t,s,a){Iu(e,t,void 0,a);for(const r in t.attrs)e.setAttribute(Vu.has(r)?r:cc(r),t.attrs[r])}(e,t,0,a)}mount(e){this.isSVGTag=Pc(e.tagName),super.mount(e)}}const Ou=Kl(Bc({...bd,...Pu,...yu,...Au},((t,s)=>Tc(t)?new Fu(s):new Lu(s,{allowProjection:t!==e.Fragment}))));function zu({children:e,className:s,...a}){return t.jsx(Ou.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.3},className:Ta("relative overflow-hidden rounded-2xl border bg-card p-8 shadow-xl",'before:absolute before:-left-80 before:-top-80 before:h-[500px] before:w-[500px] before:rounded-full before:bg-primary/20 before:blur-3xl before:content-[""]','after:absolute after:-right-80 after:-top-80 after:h-[500px] after:w-[500px] after:rounded-full after:bg-secondary/20 after:blur-3xl after:content-[""]',s),...a,children:e})}const Bu=d("/_public/auth")({component:function(){const[s,a]=e.useState(!0),{signInWithEmail:r,signUpWithEmail:n,loading:o,isAuthenticated:l}=aa(),c=i(),{auth:d}=Bu.useSearch();e.useEffect((()=>{if(l){let t="/game";if(d&&"string"==typeof d&&""!==d.trim()&&"true"!==d)try{const e=decodeURIComponent(d);e&&e.startsWith("/")&&!e.includes("[object")&&!e.startsWith("/auth")&&(t=e)}catch(e){t="/game"}c({to:t})}}),[l,d,c]);return t.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gradient-to-b from-background via-background/95 to-background/90 transition-colors duration-300",children:t.jsx(zu,{className:"w-full max-w-md",children:t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"space-y-2",children:[t.jsx("h1",{className:"text-2xl font-semibold tracking-tight",children:s?"Login":"Criar Conta"}),t.jsx("p",{className:"text-sm text-muted-foreground",children:s?"Entre com suas credenciais para acessar o sistema":"Preencha os dados abaixo para criar sua conta"})]}),s?t.jsx(qr,{onSubmit:async e=>{try{const t=await r(e);t.success||_.error("Erro ao fazer login",{description:t.error||"Ocorreu um erro inesperado"})}catch(t){_.error("Erro ao fazer login",{description:t instanceof Error?t.message:"Ocorreu um erro inesperado"})}},isLoading:o.signIn}):t.jsx($r,{onSubmit:async e=>{try{const t={email:e.email,password:e.password,username:e.email.split("@")[0]},s=await n(t);s.success||s.error&&s.error.includes("Email rate limit")?(_.success("Conta criada com sucesso",{description:"Por favor, verifique seu e-mail para confirmar sua conta."}),c({to:"/auth/verify-email",search:{auth:"true"}})):_.error("Erro ao criar conta",{description:s.error||"Ocorreu um erro inesperado"})}catch(t){_.error("Erro ao criar conta",{description:t instanceof Error?t.message:"Ocorreu um erro inesperado"})}},isLoading:o.signUp}),t.jsx(Da,{type:"button",variant:"ghost",className:"w-full",onClick:()=>a(!s),disabled:o.signIn||o.signUp,children:s?"Não tem uma conta? Criar conta":"Já tem uma conta? Fazer login"})]})})})},validateSearch:e=>({auth:e.auth||""})});const Uu=new class{async getUserProfile(){try{const{data:{user:e},error:t}=await Ss.auth.getUser();if(t)throw t;if(!e)return{data:null,error:"Usuário não autenticado"};const{data:s,error:a}=await Ss.from("users").select("*").eq("uid",e.id).maybeSingle();if(a)throw a;return{data:s,error:null}}catch(e){return{data:null,error:e instanceof Error?e.message:"Erro ao buscar perfil"}}}async searchUsers(e){try{let t=Ss.from("users").select("id",{count:"exact"});e.nome&&(t=t.ilike("nome",`%${e.nome}%`)),e.email&&(t=t.ilike("email",`%${e.email}%`)),e.role&&(t=t.eq("role",e.role)),void 0!==e.ativo&&(t=t.eq("ativo",e.ativo));const{count:s,error:a}=await t;if(a)throw a;let r=Ss.from("users").select("*").order("created_at",{ascending:!1});e.nome&&(r=r.ilike("nome",`%${e.nome}%`)),e.email&&(r=r.ilike("email",`%${e.email}%`)),e.role&&(r=r.eq("role",e.role)),void 0!==e.ativo&&(r=r.eq("ativo",e.ativo));const{data:n,error:i}=await r.range((e.page-1)*e.limit,e.page*e.limit-1);if(i)throw i;return{data:n,count:s||0,error:null}}catch(t){return{data:null,count:0,error:t instanceof Error?t.message:"Erro ao buscar usuários"}}}async updateUser(e,t){try{let s;if(t.imagemPerfil){const a=t.imagemPerfil.name.split(".").pop(),r=`${e}-${Date.now()}.${a}`,{error:n}=await Ss.storage.from("profile-images").upload(r,t.imagemPerfil,{cacheControl:"3600",upsert:!0});if(n)throw n;const{data:{publicUrl:i}}=Ss.storage.from("profile-images").getPublicUrl(r);s=i,delete t.imagemPerfil}const{error:a}=await Ss.from("users").update({...t,...s&&{imagem_perfil_url:s},updated_at:(new Date).toISOString()}).eq("uid",e);if(a)throw a;return{error:null}}catch(s){return{error:s instanceof Error?s.message:"Erro ao atualizar usuário"}}}};const Hu=e.forwardRef((({className:e,...s},a)=>t.jsx("div",{className:"relative w-full overflow-auto",children:t.jsx("table",{ref:a,className:Ta("w-full caption-bottom text-sm",e),...s})})));Hu.displayName="Table";const Gu=e.forwardRef((({className:e,...s},a)=>t.jsx("thead",{ref:a,className:Ta("[&_tr]:border-b",e),...s})));Gu.displayName="TableHeader";const Wu=e.forwardRef((({className:e,...s},a)=>t.jsx("tbody",{ref:a,className:Ta("[&_tr:last-child]:border-0",e),...s})));Wu.displayName="TableBody";e.forwardRef((({className:e,...s},a)=>t.jsx("tfoot",{ref:a,className:Ta("border-t bg-muted/50 font-medium [&>tr]:last:border-b-0",e),...s}))).displayName="TableFooter";const Xu=e.forwardRef((({className:e,...s},a)=>t.jsx("tr",{ref:a,className:Ta("border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted",e),...s})));Xu.displayName="TableRow";const Yu=e.forwardRef((({className:e,...s},a)=>t.jsx("th",{ref:a,className:Ta("h-10 px-2 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",e),...s})));Yu.displayName="TableHead";const Ku=e.forwardRef((({className:e,...s},a)=>t.jsx("td",{ref:a,className:Ta("p-2 align-middle [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",e),...s})));Ku.displayName="TableCell";e.forwardRef((({className:e,...s},a)=>t.jsx("caption",{ref:a,className:Ta("mt-4 text-sm text-muted-foreground",e),...s}))).displayName="TableCaption";const Ju=Ne,Zu=we,Qu=e.forwardRef((({className:e,children:s,...a},r)=>t.jsxs(oe,{ref:r,className:Ta("flex h-9 w-full items-center justify-between whitespace-nowrap rounded-md border border-input bg-transparent px-3 py-2 text-sm shadow-sm ring-offset-background data-[placeholder]:text-muted-foreground focus:outline-none focus:ring-1 focus:ring-ring disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",e),...a,children:[s,t.jsx(le,{asChild:!0,children:t.jsx(ce,{className:"h-4 w-4 opacity-50"})})]})));Qu.displayName=oe.displayName;const eh=e.forwardRef((({className:e,...s},a)=>t.jsx(de,{ref:a,className:Ta("flex cursor-default items-center justify-center py-1",e),...s,children:t.jsx(me,{className:"h-4 w-4"})})));eh.displayName=de.displayName;const th=e.forwardRef((({className:e,...s},a)=>t.jsx(ue,{ref:a,className:Ta("flex cursor-default items-center justify-center py-1",e),...s,children:t.jsx(ce,{className:"h-4 w-4"})})));th.displayName=ue.displayName;const sh=e.forwardRef((({className:e,children:s,position:a="popper",...r},n)=>t.jsx(he,{children:t.jsxs(pe,{ref:n,className:Ta("relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2","popper"===a&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",e),position:a,...r,children:[t.jsx(eh,{}),t.jsx(xe,{className:Ta("p-1","popper"===a&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:s}),t.jsx(th,{})]})})));sh.displayName=pe.displayName;e.forwardRef((({className:e,...s},a)=>t.jsx(fe,{ref:a,className:Ta("px-2 py-1.5 text-sm font-semibold",e),...s}))).displayName=fe.displayName;const ah=e.forwardRef((({className:e,children:s,...a},r)=>t.jsxs(ge,{ref:r,className:Ta("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-2 pr-8 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",e),...a,children:[t.jsx("span",{className:"absolute right-2 flex h-3.5 w-3.5 items-center justify-center",children:t.jsx(be,{children:t.jsx(ve,{className:"h-4 w-4"})})}),t.jsx(ye,{children:s})]})));ah.displayName=ge.displayName;e.forwardRef((({className:e,...s},a)=>t.jsx(je,{ref:a,className:Ta("-mx-1 my-1 h-px bg-muted",e),...s}))).displayName=je.displayName;const rh=e.forwardRef((({className:e,...s},a)=>t.jsx("div",{ref:a,className:Ta("w-full max-w-full overflow-hidden rounded-xl border bg-card text-card-foreground shadow",e),...s})));rh.displayName="Card";const nh=e.forwardRef((({className:e,...s},a)=>t.jsx("div",{ref:a,className:Ta("flex flex-col space-y-1.5 p-4 sm:p-6",e),...s})));nh.displayName="CardHeader";const ih=e.forwardRef((({className:e,...s},a)=>t.jsx("div",{ref:a,className:Ta("break-words font-semibold leading-none tracking-tight",e),...s})));ih.displayName="CardTitle";const oh=e.forwardRef((({className:e,...s},a)=>t.jsx("div",{ref:a,className:Ta("break-words text-sm text-muted-foreground",e),...s})));oh.displayName="CardDescription";const lh=e.forwardRef((({className:e,...s},a)=>t.jsx("div",{ref:a,className:Ta("w-full p-4 sm:p-6",e),...s})));lh.displayName="CardContent";const ch=e.forwardRef((({className:e,...s},a)=>t.jsx("div",{ref:a,className:Ta("flex flex-wrap items-center gap-2 p-4 pt-0 sm:p-6 sm:pt-0",e),...s})));function dh({children:s}){const a=i(),{user:r,loading:n}=aa();return e.useEffect((()=>{!n.onAuthUserChanged&&r&&"ADMIN"!==r.role&&(_.error("Você não tem permissão para acessar esta página"),a({to:"/403"}))}),[r,n.onAuthUserChanged,a]),n.onAuthUserChanged||!r?t.jsx(ka,{}):"ADMIN"!==r.role?t.jsx(t.Fragment,{}):s}ch.displayName="CardFooter";const mh=F("inline-flex items-center rounded-md border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground shadow hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground shadow hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function uh({className:e,variant:s,...a}){return t.jsx("div",{className:Ta(mh({variant:s}),e),...a})}const hh={ADMIN:"Administrador",PLAYER:"Jogador"},ph=d("/_authenticated/users")({component:function(){const s=i(),{users:a,loading:r,searchUsers:n}=function(){const[t,s]=e.useState(!1),[a,r]=e.useState(null),[n,i]=e.useState(null),[o,l]=e.useState([]);return{user:n,users:o,loading:t,error:a,getUserProfile:e.useCallback((async()=>{try{s(!0),r(null);const{data:e,error:t}=await Uu.getUserProfile();if(t)throw new Error(t);return e&&i(e),e}catch(e){const t=e instanceof Error?e.message:"Erro ao buscar perfil";return r(t),null}finally{s(!1)}}),[]),searchUsers:e.useCallback((async e=>{try{s(!0),r(null);const{data:t,error:a}=await Uu.searchUsers(e);if(a)throw new Error(a);t&&l(t)}catch(t){const e=t instanceof Error?t.message:"Erro ao buscar usuários";r(e)}finally{s(!1)}}),[])}}(),[o,l]=e.useState({page:1,limit:10});e.useEffect((()=>{n(o)}),[o,n]);const c=e=>{switch(e){case"ADMIN":return"bg-red-500";case"PLAYER":return"bg-blue-500";default:return"bg-gray-500"}};return t.jsx(dh,{children:t.jsx("div",{className:"container mx-auto py-8",children:t.jsxs(rh,{children:[t.jsx(nh,{children:t.jsx("div",{className:"flex items-center justify-between",children:t.jsx(ih,{children:"Usuários"})})}),t.jsxs(lh,{children:[t.jsxs("div",{className:"mb-6 grid grid-cols-1 gap-4 md:grid-cols-3",children:[t.jsx(jr,{placeholder:"Nome",value:o.nome||"",onChange:e=>l({...o,nome:e.target.value})}),t.jsx(jr,{placeholder:"Email",value:o.email||"",onChange:e=>l({...o,email:e.target.value})}),t.jsxs(Ju,{value:o.role,onValueChange:e=>l({...o,role:e}),children:[t.jsx(Qu,{children:t.jsx(Zu,{placeholder:"Tipo de Usuário"})}),t.jsxs(sh,{children:[t.jsx(ah,{value:"ADMIN",children:"Administrador"}),t.jsx(ah,{value:"PLAYER",children:"Jogador"})]})]})]}),t.jsx("div",{className:"rounded-md border",children:t.jsxs(Hu,{children:[t.jsx(Gu,{children:t.jsxs(Xu,{children:[t.jsx(Yu,{children:"Nome"}),t.jsx(Yu,{children:"Email"}),t.jsx(Yu,{children:"Tipo"}),t.jsx(Yu,{children:"Maior Andar"}),t.jsx(Yu,{children:"Total de Jogos"}),t.jsx(Yu,{children:"Vitórias"}),t.jsx(Yu,{children:"Ações"})]})}),t.jsx(Wu,{children:r?t.jsx(Xu,{children:t.jsx(Ku,{colSpan:7,className:"text-center",children:"Carregando..."})}):0===a.length?t.jsx(Xu,{children:t.jsx(Ku,{colSpan:7,className:"text-center",children:"Nenhum usuário encontrado"})}):a.map((e=>t.jsxs(Xu,{children:[t.jsx(Ku,{children:e.nome}),t.jsx(Ku,{children:e.email}),t.jsx(Ku,{children:t.jsx(uh,{className:c(e.role),children:hh[e.role]})}),t.jsx(Ku,{children:e.highest_floor}),t.jsx(Ku,{children:e.total_games}),t.jsx(Ku,{children:e.total_victories}),t.jsx(Ku,{children:t.jsx(Da,{variant:"ghost",onClick:()=>s({to:`/users/${e.id}`}),children:"Visualizar"})})]},e.id)))})]})})]})]})})})}});var xh=u();function fh(){return()=>{}}var gh="Avatar",[bh,vh]=_e(gh),[yh,jh]=bh(gh),Nh=e.forwardRef(((s,a)=>{const{__scopeAvatar:r,...n}=s,[i,o]=e.useState("idle");return t.jsx(yh,{scope:r,imageLoadingStatus:i,onImageLoadingStatusChange:o,children:t.jsx(ie.span,{...n,ref:a})})}));Nh.displayName=gh;var wh="AvatarImage",_h=e.forwardRef(((s,a)=>{const{__scopeAvatar:r,src:n,onLoadingStatusChange:i=()=>{},...o}=s,l=jh(wh,r),c=function(t,{referrerPolicy:s,crossOrigin:a}){const r=xh.useSyncExternalStore(fh,(()=>!0),(()=>!1)),n=e.useRef(null),i=r?(n.current||(n.current=new window.Image),n.current):null,[o,l]=e.useState((()=>Sh(i,t)));return Ee((()=>{l(Sh(i,t))}),[i,t]),Ee((()=>{const e=e=>()=>{l(e)};if(!i)return;const t=e("loaded"),r=e("error");return i.addEventListener("load",t),i.addEventListener("error",r),s&&(i.referrerPolicy=s),"string"==typeof a&&(i.crossOrigin=a),()=>{i.removeEventListener("load",t),i.removeEventListener("error",r)}}),[i,a,s]),o}(n,o),d=Ce((e=>{i(e),l.onImageLoadingStatusChange(e)}));return Ee((()=>{"idle"!==c&&d(c)}),[c,d]),"loaded"===c?t.jsx(ie.img,{...o,ref:a,src:n}):null}));_h.displayName=wh;var Ch="AvatarFallback",Eh=e.forwardRef(((s,a)=>{const{__scopeAvatar:r,delayMs:n,...i}=s,o=jh(Ch,r),[l,c]=e.useState(void 0===n);return e.useEffect((()=>{if(void 0!==n){const e=window.setTimeout((()=>c(!0)),n);return()=>window.clearTimeout(e)}}),[n]),l&&"loaded"!==o.imageLoadingStatus?t.jsx(ie.span,{...i,ref:a}):null}));function Sh(e,t){return e?t?(e.src!==t&&(e.src=t),e.complete&&e.naturalWidth>0?"loaded":"loading"):"error":"idle"}Eh.displayName=Ch;var kh=Nh,Ph=_h,Ah=Eh;const Mh=e.forwardRef((({className:e,...s},a)=>t.jsx(kh,{ref:a,className:Ta("relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full",e),...s})));Mh.displayName=kh.displayName;const Th=e.forwardRef((({className:e,...s},a)=>t.jsx(Ph,{ref:a,className:Ta("aspect-square h-full w-full",e),...s})));Th.displayName=Ph.displayName;const Rh=e.forwardRef((({className:e,...s},a)=>t.jsx(Ah,{ref:a,className:Ta("flex h-full w-full items-center justify-center rounded-full bg-muted",e),...s})));function Dh(){const{isInstalled:s,canInstall:a}=Ua(),[r,n]=e.useState(!0),[i,o]=e.useState(!1);e.useEffect((()=>{const e=()=>n(navigator.onLine);window.addEventListener("online",e),window.addEventListener("offline",e);return(()=>{const e=window.matchMedia("(display-mode: standalone)").matches,t=window.matchMedia("(display-mode: fullscreen)").matches;o(e||t)})(),()=>{window.removeEventListener("online",e),window.removeEventListener("offline",e)}}),[]);const l=[{name:"Modo Offline",status:"serviceWorker"in navigator,icon:r?ke:Pe,description:r?"Online":"Offline"},{name:"PWA Instalado",status:s,icon:s?Ae:B,description:s?"Instalado":a?"Disponível":"Não disponível"},{name:"Modo Tela Cheia",status:i,icon:Se,description:i?"Ativo":"Navegador"},{name:"Service Worker",status:"serviceWorker"in navigator,icon:"serviceWorker"in navigator?Ae:Me,description:"serviceWorker"in navigator?"Suportado":"Não suportado"}];return t.jsxs(rh,{className:"w-full max-w-md",children:[t.jsx(nh,{children:t.jsxs(ih,{className:"flex items-center gap-2",children:[t.jsx(Se,{className:"h-5 w-5"}),"Status PWA"]})}),t.jsxs(lh,{className:"space-y-3",children:[l.map((e=>{const s=e.icon;return t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(s,{className:"h-4 w-4 "+(e.status?"text-green-500":"text-red-500")}),t.jsx("span",{className:"text-sm font-medium",children:e.name})]}),t.jsx(uh,{variant:e.status?"default":"secondary",children:e.description})]},e.name)})),!r&&t.jsx("div",{className:"mt-4 p-3 bg-orange-50 dark:bg-orange-950 border border-orange-200 dark:border-orange-800 rounded-md",children:t.jsx("p",{className:"text-sm text-orange-800 dark:text-orange-200",children:"🌐 Você está offline! O jogo ainda pode funcionar com recursos em cache."})})]})]})}Rh.displayName=Ah.displayName;const qh=y({nome:j().min(3,"Nome deve ter no mínimo 3 caracteres"),tipo_pessoa:R(["PF","PJ"]),documento:j().optional(),telefone:j().optional(),data_nascimento:j().optional()}),$h=d("/_authenticated/profile")({component:function(){const{user:s}=aa(),a=i(),[r,n]=e.useState(null),[o,l]=e.useState(!0),c=e.useRef(null),[d,m]=e.useState(null),u=T({resolver:yr(qh),defaultValues:{nome:"",tipo_pessoa:"PF"}});e.useEffect((()=>{(async()=>{try{l(!0);const{data:e,error:t}=await Uu.getUserProfile();if(t)return void _.error("Erro",{description:t});e&&(n(e),u.reset({nome:e.nome,tipo_pessoa:e.tipo_pessoa,documento:e.documento,telefone:e.telefone,data_nascimento:e.data_nascimento}))}catch(e){_.error("Erro",{description:e instanceof Error?e.message:"Não foi possível carregar seu perfil"})}finally{l(!1)}})()}),[u]);if(o)return t.jsx("div",{className:"container mx-auto px-4 py-6",children:t.jsx(rh,{children:t.jsx(nh,{children:t.jsx(ih,{children:"Carregando..."})})})});return t.jsxs("div",{className:"container mx-auto px-4 py-6",children:[t.jsx("div",{className:"space-y-3 sm:space-y-4 mb-6",children:t.jsxs("div",{className:"flex flex-col gap-3",children:[t.jsxs(Da,{variant:"outline",size:"sm",onClick:()=>a({to:"/game"}),className:"self-start",children:[t.jsx(Te,{className:"h-4 w-4 mr-2"}),t.jsx("span",{className:"hidden sm:inline",children:"Voltar ao Menu"}),t.jsx("span",{className:"sm:hidden",children:"Voltar"})]}),t.jsxs("div",{children:[t.jsx("h1",{className:"text-2xl sm:text-3xl font-bold",children:"Perfil"}),t.jsx("p",{className:"text-sm sm:text-base text-muted-foreground",children:"Gerencie suas informações pessoais"})]})]})}),t.jsxs("div",{className:"grid gap-6",children:[t.jsxs(rh,{children:[t.jsxs(nh,{children:[t.jsx(ih,{children:"Foto de Perfil"}),t.jsx(oh,{children:"Atualize sua foto de perfil"})]}),t.jsx(lh,{children:t.jsxs("div",{className:"flex items-center gap-4",children:[t.jsxs(Mh,{className:"h-24 w-24",children:[t.jsx(Th,{src:r?.imagem_perfil_url}),t.jsx(Rh,{children:r?.nome?.charAt(0)})]}),t.jsx(jr,{type:"file",ref:c,accept:"image/*",onChange:e=>{const t=e.target.files?.[0];t&&m(t)},className:"max-w-xs"})]})})]}),t.jsxs(rh,{children:[t.jsxs(nh,{children:[t.jsx(ih,{children:"Informações Pessoais"}),t.jsx(oh,{children:"Atualize suas informações pessoais"})]}),t.jsx(lh,{children:t.jsx(Er,{...u,children:t.jsxs("form",{onSubmit:u.handleSubmit((async e=>{if(s?.id&&r)try{const{error:t}=await Uu.updateUser(s.id,{...e,data_nascimento:e.data_nascimento?new Date(e.data_nascimento):void 0,imagemPerfil:d||void 0});if(t)throw new Error(t);const{data:a,error:r}=await Uu.getUserProfile();if(r)throw new Error(r);a&&n(a),_.success("Sucesso",{description:"Perfil atualizado com sucesso!"}),m(null)}catch(t){_.error("Erro",{description:t instanceof Error?t.message:"Erro ao atualizar perfil"})}})),className:"space-y-4",children:[t.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[t.jsx(kr,{control:u.control,name:"nome",render:({field:e})=>t.jsxs(Mr,{children:[t.jsx(Tr,{children:"Nome *"}),t.jsx(Rr,{children:t.jsx(jr,{...e})}),t.jsx(Dr,{})]})}),t.jsx(kr,{control:u.control,name:"tipo_pessoa",render:({field:e})=>t.jsxs(Mr,{children:[t.jsx(Tr,{children:"Tipo de Pessoa *"}),t.jsxs(Ju,{onValueChange:e.onChange,defaultValue:e.value,children:[t.jsx(Rr,{children:t.jsx(Qu,{children:t.jsx(Zu,{placeholder:"Selecione o tipo de pessoa"})})}),t.jsxs(sh,{children:[t.jsx(ah,{value:"PF",children:"Pessoa Física"}),t.jsx(ah,{value:"PJ",children:"Pessoa Jurídica"})]})]}),t.jsx(Dr,{})]})}),t.jsx(kr,{control:u.control,name:"documento",render:({field:e})=>t.jsxs(Mr,{children:[t.jsx(Tr,{children:"PF"===u.watch("tipo_pessoa")?"CPF":"CNPJ"}),t.jsx(Rr,{children:t.jsx(jr,{...e,value:e.value||""})}),t.jsx(Dr,{})]})}),t.jsx(kr,{control:u.control,name:"telefone",render:({field:e})=>t.jsxs(Mr,{children:[t.jsx(Tr,{children:"Telefone"}),t.jsx(Rr,{children:t.jsx(jr,{...e,value:e.value||""})}),t.jsx(Dr,{})]})}),t.jsx(kr,{control:u.control,name:"data_nascimento",render:({field:e})=>t.jsxs(Mr,{children:[t.jsx(Tr,{children:"Data de Nascimento"}),t.jsx(Rr,{children:t.jsx(jr,{type:"date",...e,value:e.value||""})}),t.jsx(Dr,{})]})})]}),t.jsx("div",{className:"flex justify-end",children:t.jsx(Da,{type:"submit",children:"Salvar"})})]})})})]}),t.jsx(Dh,{})]})]})}});function Ih(){return t.jsxs(rh,{className:"w-full max-w-md",children:[t.jsx(nh,{children:t.jsxs(ih,{className:"flex items-center gap-2",children:[t.jsx(Re,{className:"h-5 w-5 text-primary"}),"Sobre Tower Trials"]})}),t.jsxs(lh,{className:"space-y-4",children:[t.jsx("p",{className:"text-sm text-muted-foreground",children:"Um jogo de aventura em que você sobe uma torre mágica, enfrentando inimigos cada vez mais fortes em cada andar. Quanto mais alto você chegar, melhor será sua posição no ranking."}),t.jsxs("div",{className:"grid grid-cols-1 gap-3 mt-4",children:[t.jsxs("div",{className:"flex items-start gap-3 p-3 bg-muted/50 rounded-md",children:[t.jsx("div",{className:"mt-1",children:t.jsx(De,{className:"h-5 w-5 text-primary"})}),t.jsxs("div",{children:[t.jsx("h3",{className:"font-medium mb-1",children:"Progressão na Torre"}),t.jsx("p",{className:"text-sm text-muted-foreground",children:"Cada andar apresenta um inimigo mais forte. A dificuldade aumenta conforme você sobe, mas você recupera um pouco de HP a cada inimigo derrotado."})]})]}),t.jsxs("div",{className:"flex items-start gap-3 p-3 bg-muted/50 rounded-md",children:[t.jsx("div",{className:"mt-1",children:t.jsx(qe,{className:"h-5 w-5 text-primary"})}),t.jsxs("div",{children:[t.jsx("h3",{className:"font-medium mb-1",children:"Ataque"}),t.jsx("p",{className:"text-sm text-muted-foreground",children:"Ataque direto ao inimigo, causando dano baseado no seu valor de ataque menos a defesa do inimigo."})]})]}),t.jsxs("div",{className:"flex items-start gap-3 p-3 bg-muted/50 rounded-md",children:[t.jsx("div",{className:"mt-1",children:t.jsx($e,{className:"h-5 w-5 text-primary"})}),t.jsxs("div",{children:[t.jsx("h3",{className:"font-medium mb-1",children:"Defesa"}),t.jsx("p",{className:"text-sm text-muted-foreground",children:"Aumenta temporariamente sua defesa, reduzindo o dano recebido no próximo ataque do inimigo."})]})]}),t.jsxs("div",{className:"flex items-start gap-3 p-3 bg-muted/50 rounded-md",children:[t.jsx("div",{className:"mt-1",children:t.jsx(Ie,{className:"h-5 w-5 text-primary"})}),t.jsxs("div",{children:[t.jsx("h3",{className:"font-medium mb-1",children:"Habilidade Especial"}),t.jsx("p",{className:"text-sm text-muted-foreground",children:"Causa o dobro do seu dano de ataque, mas tem um cooldown de 3 turnos antes de poder ser usada novamente."})]})]})]})]})]})}const Lh=d("/_authenticated/game")({component:function(){if("/game"===o().pathname)return t.jsx(Vh,{});return t.jsx(r,{})}});function Vh(){const s=i(),{user:a}=aa(),[r,n]=e.useState(!1);return t.jsxs("div",{className:"min-h-screen flex flex-col items-center justify-center bg-gradient-to-b from-background to-secondary p-4",children:[t.jsxs("div",{className:"w-full max-w-md text-center mb-8",children:[t.jsx("h1",{className:"text-4xl font-bold text-primary mb-2",children:"Tower Trials"}),t.jsx("p",{className:"text-foreground/80",children:"Suba a torre mágica, derrote inimigos e alcance o andar mais alto possível!"})]}),r?t.jsxs("div",{className:"w-full max-w-md mb-4",children:[t.jsx("div",{className:"flex justify-end mb-2",children:t.jsx(Da,{variant:"ghost",size:"sm",className:"p-1 h-8 w-8",onClick:()=>n(!1),children:t.jsx(X,{className:"h-5 w-5"})})}),t.jsx(Ih,{})]}):t.jsxs(rh,{className:"w-full max-w-md mb-4",children:[t.jsx(nh,{children:t.jsx(ih,{className:"text-center",children:"Menu Principal"})}),t.jsxs(lh,{className:"space-y-4",children:[t.jsx(Da,{onClick:()=>{s(a?{to:"/game/play"}:{to:"/auth",search:{auth:"true"}})},className:"w-full py-6 text-lg cursor-pointer",size:"lg",children:a?"Jogar":"Entrar para Jogar"}),t.jsx(Da,{onClick:()=>{s({to:"/game/ranking"})},className:"w-full py-6 text-lg cursor-pointer",variant:"outline",size:"lg",children:"Ranking"}),a&&t.jsxs(Da,{onClick:()=>{s({to:"/game/play/hub/cemetery",search:{character:""}})},className:"w-full py-4 text-base border border-red-500/20 bg-red-500/5 hover:bg-red-500/10 text-red-400 hover:text-red-300 cursor-pointer",variant:"ghost",size:"lg",children:[t.jsx(Le,{className:"h-5 w-5 mr-2"}),"Cemitério"]})]}),t.jsxs(ch,{className:"flex justify-between",children:[t.jsxs(Da,{variant:"ghost",size:"sm",className:"flex items-center gap-1 cursor-pointer",onClick:()=>n(!0),children:[t.jsx(Ve,{className:"h-4 w-4"}),t.jsx("span",{children:"Como Jogar"})]}),a?t.jsxs("div",{className:"text-sm text-muted-foreground",children:[t.jsx("span",{className:"font-medium",children:a.username||a.email})," |",t.jsx(c,{to:"/logout",className:"text-primary ml-1 hover:underline",children:"Sair"})]}):t.jsx(c,{to:"/auth",search:{auth:"true"},children:t.jsx(Da,{variant:"ghost",size:"sm",className:"cursor-pointer",children:"Entrar / Criar Conta"})})]})]})]})}const Fh=d("/_authenticated/403")({component:function(){return t.jsx("div",{className:"w-full h-full flex items-center justify-center",children:t.jsx("h1",{children:"A página que você tentou acessar não existe ou você não possui a permissão necessária."})})}});const Oh=d("/_public/auth/verify-email")({component:function(){const{user:e}=aa();return t.jsx("div",{className:"container mx-auto flex min-h-screen items-center justify-center px-4",children:t.jsxs(rh,{className:"w-full max-w-md",children:[t.jsx(nh,{children:t.jsxs("div",{className:"flex items-center space-x-4",children:[t.jsx(Fe,{className:"h-8 w-8 text-primary"}),t.jsxs("div",{children:[t.jsx(ih,{children:"Verifique seu Email"}),t.jsx(oh,{children:"Enviamos um link de confirmação para seu email"})]})]})}),t.jsxs(lh,{className:"space-y-6",children:[t.jsxs("div",{className:"rounded-lg bg-muted p-4 text-sm",children:[t.jsxs("p",{className:"mb-2",children:["Olá ",t.jsx("span",{className:"font-semibold",children:e?.email}),","]}),t.jsx("p",{className:"mb-2",children:"Para sua segurança, enviamos um email de confirmação para o endereço fornecido."}),t.jsx("p",{children:"Por favor, siga estas etapas:"}),t.jsxs("ol",{className:"ml-4 mt-2 list-decimal space-y-1",children:[t.jsx("li",{children:"Verifique sua caixa de entrada"}),t.jsx("li",{children:"Clique no link de confirmação no email"}),t.jsx("li",{children:"Retorne aqui para fazer login"})]})]}),t.jsx("div",{className:"space-y-4 text-sm text-muted-foreground",children:t.jsx("p",{children:"Não recebeu o email? Verifique sua pasta de spam ou aguarde alguns minutos."})}),t.jsx("div",{className:"flex flex-col space-y-2",children:t.jsx(c,{to:"/auth",search:{auth:"true"},children:t.jsxs(Da,{variant:"outline",className:"w-full",children:[t.jsx(Te,{className:"mr-2 h-4 w-4"}),"Voltar para o Login"]})})})]})]})})},validateSearch:e=>({auth:e.auth||""})});class zh{static async saveScore(e){try{const{data:t,error:s}=await Ss.rpc("save_ranking_entry",{p_user_id:e.user_id,p_player_name:e.player_name,p_floor:e.floor,p_character_level:e.character_level||1,p_character_gold:e.character_gold||0,p_character_alive:e.character_alive??!0});if(s)throw s;return{data:t,error:null}}catch(t){return{data:"",error:t instanceof Error?t.message:"Erro ao salvar no ranking"}}}static async getGlobalRanking(e="floor",t=10,s="all",a="",r=1){try{const n=(r-1)*t,i={floor:"get_dynamic_ranking_by_highest_floor",level:"get_dynamic_ranking_by_level",gold:"get_dynamic_ranking_by_gold"}[e],{data:o,error:l}=await Ss.rpc(i,{p_limit:t,p_status_filter:s,p_name_filter:a,p_offset:n});if(l)throw l;return{data:o||[],error:null}}catch(n){return{data:[],error:n instanceof Error?n.message:"Erro ao buscar ranking"}}}static async countRankingEntries(e="all",t=""){try{const{data:s,error:a}=await Ss.rpc("count_ranking_entries",{p_status_filter:e,p_name_filter:t});if(a)throw a;return{data:s||0,error:null}}catch(s){return{data:0,error:s instanceof Error?s.message:"Erro ao contar entradas"}}}static async getUserRanking(e,t=10){try{const{data:s,error:a}=await Ss.rpc("get_dynamic_user_ranking_history",{p_user_id:e,p_limit:t});if(a)throw a;return{data:s||[],error:null}}catch(s){return{data:[],error:s instanceof Error?s.message:"Erro ao buscar ranking do usuário"}}}static async getUserStats(e){try{const{data:t,error:s}=await Ss.rpc("get_dynamic_user_stats",{p_user_id:e}).single();if(s)throw s;const a=t;return{data:{bestFloor:a?.best_floor||0,bestLevel:a?.best_level||1,bestGold:a?.best_gold||0,totalRuns:a?.total_runs||0,aliveCharacters:a?.alive_characters||0},error:null}}catch(t){return{data:{bestFloor:0,bestLevel:1,bestGold:0,totalRuns:0,aliveCharacters:0},error:t instanceof Error?t.message:"Erro ao buscar estatísticas"}}}static async testRankingSystem(e){try{const{data:t,error:s}=await Ss.rpc("test_ranking_system",{p_user_id:e||null});if(s)throw s;return{data:t||[],error:null}}catch(t){return{data:[],error:t instanceof Error?t.message:"Erro ao testar ranking"}}}static async syncAllRankings(){try{const{data:e,error:t}=await Ss.rpc("refresh_all_rankings");if(t)throw t;return{data:e||"Sincronização concluída",error:null}}catch(e){return{data:"",error:e instanceof Error?e.message:"Erro ao sincronizar rankings"}}}}const Bh={ADMIN:"Administrador",PLAYER:"Jogador"},Uh=d("/_authenticated/users/$id")({component:function(){const{id:s}=Uh.useParams(),[a,r]=e.useState(null),[n,i]=e.useState([]),[o,l]=e.useState(!0),[c,d]=e.useState(null);if(e.useEffect((()=>{(async()=>{try{l(!0),d(null);const{data:e,error:t}=await Uu.searchUsers({page:1,limit:1,email:s});if(t)return void d(`Erro ao buscar usuário: ${t}`);if(!e||0===e.length)return void d("Usuário não encontrado");const a=e[0];r(a);const{data:n}=await zh.getUserRanking(a.uid);i(n||[])}catch(e){d("Erro ao carregar dados do usuário")}finally{l(!1)}})()}),[s]),o)return t.jsx("div",{children:"Carregando..."});if(c)return t.jsx("div",{className:"text-red-500",children:c});if(!a)return t.jsx("div",{children:"Usuário não encontrado"});return t.jsx(dh,{children:t.jsxs("div",{className:"container mx-auto py-8",children:[t.jsxs(rh,{className:"mb-8",children:[t.jsx(nh,{children:t.jsx(ih,{children:"Detalhes do Usuário"})}),t.jsx(lh,{children:t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsxs("div",{children:[t.jsx("p",{className:"text-sm font-medium",children:"Nome"}),t.jsx("p",{className:"text-lg",children:a.nome})]}),t.jsxs("div",{children:[t.jsx("p",{className:"text-sm font-medium",children:"Email"}),t.jsx("p",{className:"text-lg",children:a.email})]}),t.jsxs("div",{children:[t.jsx("p",{className:"text-sm font-medium",children:"Tipo"}),t.jsx(uh,{className:"ADMIN"===a.role?"bg-red-500":"bg-blue-500",children:Bh[a.role]})]}),t.jsxs("div",{children:[t.jsx("p",{className:"text-sm font-medium",children:"Status"}),t.jsx(uh,{variant:a.ativo?"default":"destructive",children:a.ativo?"Ativo":"Inativo"})]}),t.jsxs("div",{children:[t.jsx("p",{className:"text-sm font-medium",children:"Maior Andar Alcançado"}),t.jsx("p",{className:"text-lg",children:a.highest_floor})]}),t.jsxs("div",{children:[t.jsx("p",{className:"text-sm font-medium",children:"Total de Jogos"}),t.jsx("p",{className:"text-lg",children:a.total_games})]}),t.jsxs("div",{children:[t.jsx("p",{className:"text-sm font-medium",children:"Vitórias"}),t.jsx("p",{className:"text-lg",children:a.total_victories})]})]})})]}),t.jsxs(rh,{children:[t.jsx(nh,{children:t.jsx(ih,{children:"Histórico de Rankings"})}),t.jsx(lh,{children:t.jsx("div",{className:"rounded-md border",children:t.jsxs(Hu,{children:[t.jsx(Gu,{children:t.jsxs(Xu,{children:[t.jsx(Yu,{children:"Andar Alcançado"}),t.jsx(Yu,{children:"Data"})]})}),t.jsx(Wu,{children:0===n.length?t.jsx(Xu,{children:t.jsx(Ku,{colSpan:2,className:"text-center",children:"Nenhum ranking encontrado"})}):n.map((e=>t.jsxs(Xu,{children:[t.jsx(Ku,{children:e.highest_floor}),t.jsx(Ku,{children:e.created_at?new Date(e.created_at).toLocaleDateString("pt-BR"):"-"})]},e.id)))})]})})})]})]})})}});const Hh=({activeMode:e,onModeChange:s,statusFilter:a,onStatusFilterChange:r,nameFilter:n,onNameFilterChange:i,currentPage:o,totalPages:l,onPageChange:c,isLoading:d=!1})=>{const m=[{key:"floor",label:"Andar Mais Alto",icon:re,color:"text-yellow-500"},{key:"level",label:"Maior Nível",icon:Oe,color:"text-blue-500"},{key:"gold",label:"Mais Rico",icon:ze,color:"text-amber-500"}],u=[{key:"all",label:"Todos",shortLabel:"Todos",icon:Be,color:"text-gray-500"},{key:"alive",label:"Apenas Vivos",shortLabel:"Vivos",icon:Ue,color:"text-green-500"},{key:"dead",label:"Apenas Mortos",shortLabel:"Mortos",icon:Le,color:"text-red-500"}];return t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{children:[t.jsx("h3",{className:"text-sm font-medium mb-2 text-muted-foreground",children:"Modalidade"}),t.jsx("div",{className:"flex flex-wrap gap-2",children:m.map((a=>{const r=a.icon,n=e===a.key;return t.jsxs(Da,{variant:n?"default":"outline",size:"sm",onClick:()=>s(a.key),disabled:d,className:"flex items-center gap-2 text-xs "+(n?"":"hover:bg-muted"),children:[t.jsx(r,{className:"h-3 w-3 "+(n?"text-white":"text-muted-foreground")}),t.jsx("span",{className:"hidden sm:inline",children:a.label}),t.jsx("span",{className:"sm:hidden",children:"floor"===a.key?"Andar":"level"===a.key?"Nível":"Ouro"})]},a.key)}))})]}),t.jsxs("div",{children:[t.jsx("h3",{className:"text-sm font-medium mb-2 text-muted-foreground",children:"Status"}),t.jsx("div",{className:"flex flex-wrap gap-2",children:u.map((e=>{const s=e.icon,n=a===e.key;return t.jsxs(Da,{variant:n?"default":"outline",size:"sm",onClick:()=>r(e.key),disabled:d,className:"flex items-center gap-2 text-xs "+(n?"":"hover:bg-muted"),children:[t.jsx(s,{className:"h-3 w-3 "+(n?"text-white":"text-muted-foreground")}),t.jsx("span",{className:"hidden sm:inline",children:e.label}),t.jsx("span",{className:"sm:hidden",children:e.shortLabel})]},e.key)}))})]}),t.jsxs("div",{children:[t.jsx("h3",{className:"text-sm font-medium mb-2 text-muted-foreground",children:"Buscar Jogador"}),t.jsxs("div",{className:"relative",children:[t.jsx(He,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),t.jsx(jr,{type:"text",placeholder:"Digite o nome do jogador...",value:n,onChange:e=>i(e.target.value),disabled:d,className:"pl-10 text-sm"})]})]}),l>1&&t.jsxs("div",{children:[t.jsx("h3",{className:"text-sm font-medium mb-2 text-muted-foreground",children:"Páginas"}),t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs(Da,{variant:"outline",size:"sm",onClick:()=>c(o-1),disabled:o<=1||d,className:"flex items-center gap-2",children:[t.jsx(Ge,{className:"h-4 w-4"}),t.jsx("span",{className:"hidden sm:inline",children:"Anterior"})]}),t.jsx("div",{className:"flex items-center gap-2",children:t.jsxs("span",{className:"text-sm text-muted-foreground",children:["Página ",o," de ",l]})}),t.jsxs(Da,{variant:"outline",size:"sm",onClick:()=>c(o+1),disabled:o>=l||d,className:"flex items-center gap-2",children:[t.jsx("span",{className:"hidden sm:inline",children:"Próxima"}),t.jsx(We,{className:"h-4 w-4"})]})]})]})]})},Gh=e=>e>=1e6?(e/1e6).toFixed(1)+"M":e>=1e3?(e/1e3).toFixed(1)+"K":e.toString(),Wh=({entries:e,mode:s,currentUserId:a})=>{const r=e=>{switch(e){case 0:return"text-yellow-500";case 1:return"text-gray-400";case 2:return"text-amber-700";default:return"text-gray-300"}},n=(e,t)=>{switch(t){case"floor":default:return`Andar ${e.highest_floor}`;case"level":return`Nível ${e.character_level}`;case"gold":return`${Gh(e.character_gold)} Gold`}},i=(e,t)=>{switch(t){case"floor":return`Nível ${e.character_level} • ${Gh(e.character_gold)} Gold`;case"level":return`Andar ${e.highest_floor} • ${Gh(e.character_gold)} Gold`;case"gold":return`Andar ${e.highest_floor} • Nível ${e.character_level}`;default:return`Nível ${e.character_level}`}},o=(e=>{switch(e){case"floor":default:return re;case"level":return Oe;case"gold":return ze}})(s);return 0===e.length?t.jsxs("div",{className:"text-center py-8",children:[t.jsx(o,{className:"h-12 w-12 text-muted-foreground mx-auto mb-4"}),t.jsx("p",{className:"text-muted-foreground",children:"Nenhum registro encontrado para esta modalidade."})]}):t.jsxs(Hu,{children:[t.jsx(Gu,{children:t.jsxs(Xu,{children:[t.jsx(Yu,{className:"w-12 text-center",children:"Pos."}),t.jsx(Yu,{children:"Jogador"}),t.jsx(Yu,{className:"text-right",children:"Valor Principal"}),t.jsx(Yu,{className:"text-right hidden sm:table-cell",children:"Detalhes"}),t.jsx(Yu,{className:"text-right",children:"Data"})]})}),t.jsx(Wu,{children:e.map(((e,o)=>t.jsxs(Xu,{className:e.user_id===a?"bg-primary/5":"",children:[t.jsx(Ku,{className:"text-center font-medium",children:o<3?t.jsx(re,{className:`inline h-4 w-4 ${r(o)}`}):t.jsx("span",{className:"text-muted-foreground",children:o+1})}),t.jsx(Ku,{children:t.jsx("div",{className:"flex items-center gap-2",children:t.jsxs("div",{className:"flex flex-col",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("span",{className:"font-medium",children:e.player_name}),e.character_alive?t.jsx(Ue,{className:"h-3 w-3 text-green-500"}):t.jsx(Le,{className:"h-3 w-3 text-red-500"}),e.user_id===a&&t.jsx("span",{className:"text-xs bg-primary/20 text-primary px-1.5 py-0.5 rounded",children:"Você"})]}),t.jsx("div",{className:"text-xs text-muted-foreground sm:hidden",children:i(e,s)})]})})}),t.jsx(Ku,{className:"text-right font-medium",children:n(e,s)}),t.jsx(Ku,{className:"text-right text-muted-foreground hidden sm:table-cell",children:i(e,s)}),t.jsx(Ku,{className:"text-right text-muted-foreground",children:e.created_at?new Date(e.created_at).toLocaleDateString("pt-BR",{day:"2-digit",month:"2-digit",year:"2-digit",hour:"2-digit",minute:"2-digit"}):"-"})]},e.id)))})]})},Xh=({stats:s,userRanking:a})=>{const[r,n]=e.useState(!0),[i,o]=e.useState(!1),l=a[0];return t.jsxs("div",{className:"space-y-4",children:[t.jsxs(rh,{children:[t.jsx(nh,{className:"pb-3",children:t.jsxs(Da,{variant:"ghost",className:"w-full justify-between p-0 h-auto hover:bg-transparent",onClick:()=>n(!r),children:[t.jsx(ih,{className:"text-lg font-medium",children:"Suas Conquistas"}),r?t.jsx(me,{className:"h-4 w-4 text-muted-foreground"}):t.jsx(ce,{className:"h-4 w-4 text-muted-foreground"})]})}),r&&t.jsx(lh,{className:"pt-0",children:t.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-3",children:[t.jsxs("div",{className:"text-center p-4 bg-muted/30 rounded-lg border",children:[t.jsx(re,{className:"h-5 w-5 text-muted-foreground mx-auto mb-2"}),t.jsx("div",{className:"text-2xl font-bold mb-1",children:s.bestFloor}),t.jsx("div",{className:"text-xs text-muted-foreground",children:"Melhor Andar"})]}),t.jsxs("div",{className:"text-center p-4 bg-muted/30 rounded-lg border",children:[t.jsx(Oe,{className:"h-5 w-5 text-muted-foreground mx-auto mb-2"}),t.jsx("div",{className:"text-2xl font-bold mb-1",children:s.bestLevel}),t.jsx("div",{className:"text-xs text-muted-foreground",children:"Maior Nível"})]}),t.jsxs("div",{className:"text-center p-4 bg-muted/30 rounded-lg border",children:[t.jsx(ze,{className:"h-5 w-5 text-muted-foreground mx-auto mb-2"}),t.jsx("div",{className:"text-xl font-bold mb-1",title:`${s.bestGold.toLocaleString("pt-BR")} Gold`,children:Gh(s.bestGold)}),t.jsx("div",{className:"text-xs text-muted-foreground",children:"Mais Rico"})]})]})})]}),l&&t.jsxs(rh,{children:[t.jsx(nh,{className:"pb-3",children:t.jsxs(Da,{variant:"ghost",className:"w-full justify-between p-0 h-auto hover:bg-transparent",onClick:()=>o(!i),children:[t.jsxs(ih,{className:"text-lg font-medium flex items-center gap-2",children:[t.jsx(Xe,{className:"h-4 w-4"}),"Última Tentativa"]}),i?t.jsx(me,{className:"h-4 w-4 text-muted-foreground"}):t.jsx(ce,{className:"h-4 w-4 text-muted-foreground"})]})}),i&&t.jsx(lh,{className:"pt-0",children:t.jsxs("div",{className:"flex items-center justify-between p-3 bg-muted/30 rounded-lg",children:[t.jsxs("div",{className:"flex items-center gap-3",children:[l.character_alive?t.jsx("span",{className:"text-sm",children:"❤️"}):t.jsx("span",{className:"text-sm",children:"💀"}),t.jsxs("div",{children:[t.jsx("div",{className:"font-medium text-sm",children:l.character_alive?"Vivo":"Morto"}),t.jsx("div",{className:"text-xs text-muted-foreground",children:new Date(l.created_at).toLocaleDateString("pt-BR")})]})]}),t.jsxs("div",{className:"text-right",children:[t.jsxs("div",{className:"font-bold",children:["Andar ",l.highest_floor]}),t.jsxs("div",{className:"text-xs text-muted-foreground",children:["Nível ",l.character_level]})]})]})})]}),t.jsx(rh,{children:t.jsx(lh,{className:"p-4",children:t.jsxs("div",{className:"flex justify-between items-center text-sm",children:[t.jsx("span",{className:"text-muted-foreground",children:"Total de Tentativas:"}),t.jsx("span",{className:"font-medium",children:s.totalRuns})]})})})]})},Yh=d("/_authenticated/game/ranking")({component:function(){const s=i(),{user:a}=aa(),[r,n]=e.useState([]),[o,l]=e.useState([]),[c,d]=e.useState({bestFloor:0,bestLevel:1,bestGold:0,totalRuns:0,aliveCharacters:0}),[m,u]=e.useState(!0),[h,p]=e.useState("floor"),[x,f]=e.useState("all"),[g,b]=e.useState(""),[v,y]=e.useState(1),[j,N]=e.useState(1),[w,_]=e.useState("");e.useEffect((()=>{const e=setTimeout((()=>{_(g)}),500);return()=>clearTimeout(e)}),[g]),e.useEffect((()=>{y(1)}),[h,x,w]),e.useEffect((()=>{E()}),[a?.id,h,x,w,v]);const C=e.useCallback((async()=>{try{const e=await zh.countRankingEntries(x,w);if(null!==e.data){const t=e.data,s=Math.max(1,Math.ceil(t/20));N(s)}}catch(e){N(1)}}),[x,w]),E=async()=>{try{u(!0),await C();const e=await zh.getGlobalRanking(h,20,x,w,v);if(e.error?n([]):(n(e.data||[]),e.data&&e.data.length),a?.id){const[e,t]=await Promise.all([zh.getUserRanking(a.id,15),zh.getUserStats(a.id)]);e.error?l([]):l(e.data||[]),t.error?d({bestFloor:0,bestLevel:1,bestGold:0,totalRuns:0,aliveCharacters:0}):d(t.data||{bestFloor:0,bestLevel:1,bestGold:0,totalRuns:0,aliveCharacters:0})}}catch(e){n([]),l([]),d({bestFloor:0,bestLevel:1,bestGold:0,totalRuns:0,aliveCharacters:0})}finally{u(!1)}},S=e=>{y(e)};return t.jsxs("div",{className:"container mx-auto p-4 max-w-7xl",children:[t.jsxs("div",{className:"flex items-center justify-between mb-6",children:[t.jsxs("div",{className:"flex items-center gap-4",children:[t.jsxs(Da,{variant:"ghost",size:"sm",onClick:()=>s({to:"/game"}),children:[t.jsx(Te,{className:"h-4 w-4 mr-2"}),"Voltar"]}),t.jsxs("div",{children:[t.jsx("h1",{className:"text-2xl font-bold",children:(e=>{switch(e){case"floor":return"Ranking por Andar Mais Alto";case"level":return"Ranking por Nível Mais Alto";case"gold":return"Ranking por Mais Ouro";default:return"Ranking"}})(h)}),t.jsxs("p",{className:"text-muted-foreground",children:["Veja os melhores jogadores",(()=>{const e=[];return"all"!==x&&e.push("alive"===x?"vivos":"mortos"),w&&e.push(`nome: "${w}"`),e.length>0?` (${e.join(", ")})`:""})()]})]})]}),t.jsx("div",{className:"flex gap-2",children:t.jsx(Da,{variant:"outline",size:"sm",onClick:async()=>{await E()},disabled:m,children:"Atualizar"})})]}),t.jsx(rh,{className:"mb-6",children:t.jsx(nh,{children:t.jsx(Hh,{activeMode:h,onModeChange:p,statusFilter:x,onStatusFilterChange:f,nameFilter:g,onNameFilterChange:b,currentPage:v,totalPages:j,onPageChange:S,isLoading:m})})}),t.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-4 gap-6",children:[a&&t.jsx("div",{className:"lg:col-span-1",children:t.jsx(Xh,{stats:c,userRanking:o.map((e=>({highest_floor:e.highest_floor,character_level:e.character_level,character_gold:e.character_gold,character_alive:e.character_alive,created_at:e.created_at})))})}),t.jsx("div",{className:a?"lg:col-span-3":"lg:col-span-4",children:t.jsxs(rh,{children:[t.jsx(lh,{className:"p-0",children:t.jsx(Wh,{entries:r,mode:h,currentUserId:a?.id})}),j>1&&t.jsxs(ch,{className:"flex justify-center gap-2",children:[t.jsx(Da,{variant:"outline",size:"sm",onClick:()=>S(v-1),disabled:v<=1||m,children:"Anterior"}),t.jsxs("span",{className:"flex items-center px-4 text-sm text-muted-foreground",children:["Página ",v," de ",j]}),t.jsx(Da,{variant:"outline",size:"sm",onClick:()=>S(v+1),disabled:v>=j||m,children:"Próxima"})]})]})})]})]})}});const Kh=K,Jh=H,Zh=e.forwardRef((({className:e,...s},a)=>t.jsx(U,{ref:a,className:Ta("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",e),...s})));Zh.displayName=U.displayName;const Qh=e.forwardRef((({className:e,children:s,...a},r)=>t.jsxs(Jh,{children:[t.jsx(Zh,{}),t.jsxs(G,{ref:r,className:Ta("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",e),...a,children:[s,t.jsxs(W,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[t.jsx(X,{className:"h-4 w-4"}),t.jsx("span",{className:"sr-only",children:"Close"})]})]})]})));Qh.displayName=G.displayName;const ep=({className:e,...s})=>t.jsx("div",{className:Ta("flex flex-col space-y-1.5 text-center sm:text-left",e),...s});ep.displayName="DialogHeader";const tp=({className:e,...s})=>t.jsx("div",{className:Ta("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",e),...s});tp.displayName="DialogFooter";const sp=e.forwardRef((({className:e,...s},a)=>t.jsx(Y,{ref:a,className:Ta("text-lg font-semibold leading-none tracking-tight",e),...s})));sp.displayName=Y.displayName;const ap=e.forwardRef((({className:e,...s},a)=>t.jsx(Ye,{ref:a,className:Ta("text-sm text-muted-foreground",e),...s})));ap.displayName=Ye.displayName;var rp="Progress",[np,ip]=_e(rp),[op,lp]=np(rp),cp=e.forwardRef(((e,s)=>{const{__scopeProgress:a,value:r=null,max:n,getValueLabel:i=up,...o}=e;(n||0===n)&&xp(n);const l=xp(n)?n:100;null!==r&&fp(r,l);const c=fp(r,l)?r:null,d=pp(c)?i(c,l):void 0;return t.jsx(op,{scope:a,value:c,max:l,children:t.jsx(ie.div,{"aria-valuemax":l,"aria-valuemin":0,"aria-valuenow":pp(c)?c:void 0,"aria-valuetext":d,role:"progressbar","data-state":hp(c,l),"data-value":c??void 0,"data-max":l,...o,ref:s})})}));cp.displayName=rp;var dp="ProgressIndicator",mp=e.forwardRef(((e,s)=>{const{__scopeProgress:a,...r}=e,n=lp(dp,a);return t.jsx(ie.div,{"data-state":hp(n.value,n.max),"data-value":n.value??void 0,"data-max":n.max,...r,ref:s})}));function up(e,t){return`${Math.round(e/t*100)}%`}function hp(e,t){return null==e?"indeterminate":e===t?"complete":"loading"}function pp(e){return"number"==typeof e}function xp(e){return pp(e)&&!isNaN(e)&&e>0}function fp(e,t){return pp(e)&&!isNaN(e)&&e<=t&&e>=0}mp.displayName=dp;var gp=cp,bp=mp;const vp=e.forwardRef((({className:e,value:s,...a},r)=>t.jsx(gp,{ref:r,className:Ta("relative h-2 w-full overflow-hidden rounded-full bg-secondary",e),...a,children:t.jsx(bp,{className:"h-full w-full flex-1 bg-primary transition-all",style:{transform:`translateX(-${100-(s||0)}%)`}})})));vp.displayName=gp.displayName;const yp=F("relative w-full rounded-lg border px-4 py-3 text-sm [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground [&>svg~*]:pl-7",{variants:{variant:{default:"bg-background text-foreground",destructive:"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive"}},defaultVariants:{variant:"default"}}),jp=e.forwardRef((({className:e,variant:s,...a},r)=>t.jsx("div",{ref:r,role:"alert",className:Ta(yp({variant:s}),e),...a})));jp.displayName="Alert";e.forwardRef((({className:e,...s},a)=>t.jsx("h5",{ref:a,className:Ta("mb-1 font-medium leading-none tracking-tight",e),...s}))).displayName="AlertTitle";const Np=e.forwardRef((({className:e,...s},a)=>t.jsx("div",{ref:a,className:Ta("text-sm [&_p]:leading-relaxed",e),...s})));Np.displayName="AlertDescription";const wp=d("/_authenticated/game/play")({component:function(){if("/game/play"===o().pathname)return t.jsx(_p,{});return t.jsx(r,{})}});function _p(){const s=i(),{user:a}=aa(),[r,n]=e.useState([]),[o,l]=e.useState(null),[c,d]=e.useState([]),[m,u]=e.useState(!0),[h,p]=e.useState(!1),[x,f]=e.useState(""),[g,b]=e.useState({isValid:!0}),[v,y]=e.useState(!1),[j,N]=e.useState(!1),[w,C]=e.useState(null);e.useEffect((()=>{a?.id&&E()}),[a?.id]),e.useEffect((()=>{if(x.trim()){const e=ea.validateCharacterName(x);if(e.isValid&&r.length>0){const t=r.map((e=>e.name)),s=ea.formatCharacterName(x);if(ea.isTooSimilar(s,t)){const e=ea.generateNameSuggestions(s);b({isValid:!1,error:"Nome muito similar a um personagem existente",suggestions:e})}else b(e)}else b(e)}else b({isValid:!0})}),[x,r]);const E=async()=>{try{u(!0);const e=await ta.getUserCharacters(a.id);e.success&&e.data&&n(e.data);const t=await ta.getUserCharacterProgression(a.id);t.success&&t.data&&l(t.data)}catch(e){_.error("Erro ao carregar dados dos personagens")}finally{u(!1)}};e.useEffect((()=>{if(o&&void 0!==r){const e=[];for(let t=1;t<=20;t++){const s=r.find((e=>r.indexOf(e)+1===t))||null,a=t<=o.max_character_slots,n=S(t);e.push({slotNumber:t,character:s,isUnlocked:a,requiredTotalLevel:n})}d(e)}}),[o,r]);const S=e=>e<=3?0:15*(e-3),k=()=>{p(!1),f(""),b({isValid:!0})},P=e=>{const s=(a=e.level,Math.floor(100*Math.pow(1.1,a-1)));var a;const r=e.xp/s*100;return t.jsxs("div",{className:"space-y-2 text-sm",children:[t.jsxs("div",{className:"flex justify-between",children:[t.jsx("span",{children:"Nível:"}),t.jsx("span",{className:"font-medium",children:e.level})]}),t.jsxs("div",{className:"space-y-1",children:[t.jsxs("div",{className:"flex justify-between",children:[t.jsx("span",{children:"XP:"}),t.jsxs("span",{className:"font-medium",children:[e.xp,"/",s]})]}),t.jsx(vp,{value:r,className:"h-2"})]}),t.jsxs("div",{className:"flex justify-between",children:[t.jsx("span",{children:"Andar Máximo:"}),t.jsx("span",{className:"font-medium",children:e.floor})]}),t.jsxs("div",{className:"flex justify-between",children:[t.jsx("span",{children:"Ouro:"}),t.jsx("span",{className:"font-medium text-yellow-600",children:e.gold})]})]})};return m?t.jsx("div",{className:"container mx-auto p-4",children:t.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:t.jsxs("div",{className:"text-center",children:[t.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary mx-auto mb-4"}),t.jsx("p",{children:"Carregando personagens..."})]})})}):t.jsxs("div",{className:"container mx-auto p-4 max-w-6xl",children:[t.jsxs("div",{className:"flex items-center justify-between mb-6",children:[t.jsxs("div",{className:"flex items-center gap-4",children:[t.jsxs(Da,{variant:"ghost",size:"sm",onClick:()=>s({to:"/game"}),children:[t.jsx(Te,{className:"h-4 w-4 mr-2"}),"Voltar"]}),t.jsxs("div",{children:[t.jsx("h1",{className:"text-2xl font-bold",children:"Selecionar Personagem"}),t.jsx("p",{className:"text-muted-foreground",children:"Escolha um personagem para jogar"})]})]}),o&&t.jsxs("div",{className:"text-right",children:[t.jsx("div",{className:"text-sm text-muted-foreground",children:"Progressão Total"}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(Be,{className:"h-4 w-4"}),t.jsx("span",{className:"font-medium",children:o.total_character_level}),t.jsx("span",{className:"text-muted-foreground",children:"nível"})]}),t.jsxs("div",{className:"text-xs text-muted-foreground",children:[o.max_character_slots,"/",20," slots"]})]})]}),t.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4",children:c.map((e=>{if(!e.isUnlocked)return t.jsx(rh,{className:"opacity-50",children:t.jsxs(lh,{className:"p-4 text-center",children:[t.jsx(Je,{className:"h-8 w-8 mx-auto mb-2 text-muted-foreground"}),t.jsxs("p",{className:"text-sm text-muted-foreground",children:["Slot ",e.slotNumber]}),t.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:["Requer nível total ",e.requiredTotalLevel]})]})},e.slotNumber);if(!e.character)return t.jsx(rh,{className:"cursor-pointer hover:bg-accent/50 border-dashed",children:t.jsxs(lh,{className:"p-4 text-center",onClick:()=>{p(!0)},children:[t.jsx(Ze,{className:"h-8 w-8 mx-auto mb-2 text-muted-foreground"}),t.jsx("p",{className:"text-sm text-muted-foreground",children:"Criar Personagem"}),t.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:["Slot ",e.slotNumber]})]})},e.slotNumber);const s=e.character,a=s.hp>0;return t.jsxs(rh,{className:"cursor-pointer hover:bg-accent/50 "+(a?"":"border-red-500/50 bg-red-500/5"),onClick:()=>a&&(e=>{C(e),N(!0)})(s),style:{cursor:a?"pointer":"not-allowed"},children:[t.jsx(nh,{className:"pb-2",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs(ih,{className:"text-base flex items-center gap-2",children:[s.name,!a&&t.jsx(Le,{className:"h-4 w-4 text-red-500"}),s.floor>=100&&t.jsx(Qe,{className:"h-4 w-4 text-yellow-500"})]}),t.jsxs("div",{className:"text-xs text-muted-foreground",children:["Slot ",e.slotNumber]})]})}),t.jsxs(lh,{className:"pt-0",children:[P(s),!a&&t.jsxs(jp,{className:"mt-3 border-red-500/50 bg-red-500/10",children:[t.jsx(Le,{className:"h-4 w-4 text-red-500"}),t.jsx(Np,{className:"text-red-700",children:"Este personagem morreu permanentemente"})]})]})]},e.slotNumber)}))}),t.jsx(Kh,{open:h,onOpenChange:p,children:t.jsxs(Qh,{children:[t.jsxs(ep,{children:[t.jsx(sp,{children:"Criar Novo Personagem"}),t.jsx(ap,{children:"Escolha um nome para seu novo personagem. Lembre-se: a morte é permanente!"})]}),t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{children:[t.jsx(jr,{placeholder:"Nome do personagem",value:x,onChange:e=>f(e.target.value),className:g.isValid?"":"border-red-500"}),!g.isValid&&g.error&&t.jsxs(jp,{className:"mt-2 border-red-500/50 bg-red-500/10",children:[t.jsx(Ke,{className:"h-4 w-4 text-red-500"}),t.jsx(Np,{className:"text-red-700",children:g.error})]}),g.suggestions&&g.suggestions.length>0&&t.jsxs("div",{className:"mt-2",children:[t.jsx("p",{className:"text-sm text-muted-foreground mb-2",children:"Sugestões:"}),t.jsx("div",{className:"flex flex-wrap gap-2",children:g.suggestions.map(((e,s)=>t.jsx(Da,{variant:"outline",size:"sm",onClick:()=>(e=>{f(e)})(e),children:e},s)))})]})]}),t.jsxs(jp,{children:[t.jsx(Le,{className:"h-4 w-4"}),t.jsxs(Np,{children:[t.jsx("strong",{children:"Aviso:"})," Este jogo possui morte permanente (permadeath). Se seu personagem morrer, ele será perdido para sempre!"]})]}),t.jsxs("div",{className:"flex justify-end gap-2",children:[t.jsx(Da,{variant:"outline",onClick:k,children:"Cancelar"}),t.jsx(Da,{onClick:async()=>{if(a?.id&&x.trim()&&g.isValid){y(!0);try{const e=await ta.createCharacter({user_id:a.id,name:x.trim()});e.success&&e.data?(_.success("Personagem criado com sucesso!",{description:`${ea.formatCharacterName(x)} foi criado!`}),await E(),k()):_.error("Erro ao criar personagem",{description:e.error})}catch(e){_.error("Erro ao criar personagem")}finally{y(!1)}}},disabled:!x.trim()||!g.isValid||v,children:v?"Criando...":"Criar Personagem"})]})]})]})}),t.jsx(Kh,{open:j,onOpenChange:N,children:t.jsxs(Qh,{children:[t.jsxs(ep,{children:[t.jsx(sp,{children:"Confirmar Seleção"}),t.jsxs(ap,{children:["Você está prestes a jogar com ",w?.name]})]}),t.jsxs(jp,{children:[t.jsx(ae,{className:"h-4 w-4"}),t.jsxs(Np,{children:[t.jsx("strong",{children:"Lembrete:"})," Este jogo possui morte permanente. Se seu personagem morrer durante a aventura, ele será perdido para sempre!"]})]}),t.jsxs("div",{className:"flex justify-end gap-2",children:[t.jsx(Da,{variant:"outline",onClick:()=>N(!1),className:"cursor-pointer",children:"Cancelar"}),t.jsxs(Da,{onClick:async()=>{if(w)try{const e=await ta.getCharacter(w.id);e.success&&e.data?s({to:"/game/play/hub",search:{character:w.id}}):_.error("Erro ao selecionar personagem",{description:e.error})}catch(e){_.error("Erro ao selecionar personagem")}},className:"cursor-pointer",children:[t.jsx(Ae,{className:"h-4 w-4 mr-2"}),"Confirmar e Jogar"]})]})]})})]})}const Cp=at,Ep=e.forwardRef((({className:e,...s},a)=>t.jsx(et,{ref:a,className:Ta("inline-flex h-9 items-center justify-center rounded-lg bg-muted p-1 text-muted-foreground",e),...s})));Ep.displayName=et.displayName;const Sp=e.forwardRef((({className:e,...s},a)=>t.jsx(tt,{ref:a,className:Ta("inline-flex items-center justify-center whitespace-nowrap rounded-md px-3 py-1 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow",e),...s})));Sp.displayName=tt.displayName;const kp=e.forwardRef((({className:e,...s},a)=>t.jsx(st,{ref:a,className:Ta("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",e),...s})));function Pp({className:e,children:s,...a}){return t.jsxs(rt,{"data-slot":"scroll-area",className:Ta("relative",e),...a,children:[t.jsx(nt,{"data-slot":"scroll-area-viewport",className:"focus-visible:ring-ring/50 size-full rounded-[inherit] transition-[color,box-shadow] outline-none focus-visible:ring-[3px] focus-visible:outline-1",children:s}),t.jsx(Ap,{}),t.jsx(it,{})]})}function Ap({className:e,orientation:s="vertical",...a}){return t.jsx(ot,{"data-slot":"scroll-area-scrollbar",orientation:s,className:Ta("flex touch-none p-px transition-colors select-none","vertical"===s&&"h-full w-2.5 border-l border-l-transparent","horizontal"===s&&"h-2.5 flex-col border-t border-t-transparent",e),...a,children:t.jsx(lt,{"data-slot":"scroll-area-thumb",className:"bg-border relative flex-1 rounded-full"})})}kp.displayName=st.displayName;const Mp=d("/_authenticated/game/guide")({component:function(){const e=i();return t.jsxs("div",{className:"container mx-auto p-4 space-y-4",children:[t.jsx("div",{className:"space-y-3 sm:space-y-4 mb-6",children:t.jsxs("div",{className:"flex flex-col gap-3",children:[t.jsxs(Da,{variant:"outline",size:"sm",onClick:()=>e({to:"/game"}),className:"self-start",children:[t.jsx(Te,{className:"h-4 w-4 mr-2"}),t.jsx("span",{className:"hidden sm:inline",children:"Voltar ao Menu"}),t.jsx("span",{className:"sm:hidden",children:"Voltar"})]}),t.jsxs("div",{children:[t.jsx("h1",{className:"text-2xl sm:text-3xl font-bold",children:"Guia do Tower Trials"}),t.jsx("p",{className:"text-sm sm:text-base text-muted-foreground",children:"Aprenda tudo sobre o jogo"})]})]})}),t.jsxs(Cp,{defaultValue:"basics",className:"w-full",children:[t.jsxs(Ep,{className:"grid w-full grid-cols-2 lg:grid-cols-4",children:[t.jsx(Sp,{value:"basics",children:"Básico"}),t.jsx(Sp,{value:"combat",children:"Combate"}),t.jsx(Sp,{value:"progression",children:"Progressão"}),t.jsx(Sp,{value:"items",children:"Itens"})]}),t.jsx(kp,{value:"basics",children:t.jsx(rh,{className:"p-6",children:t.jsx(Pp,{className:"h-[600px] pr-4",children:t.jsxs("section",{className:"space-y-4",children:[t.jsx("h2",{className:"text-2xl font-bold",children:"Conceitos Básicos"}),t.jsxs("div",{className:"space-y-4",children:[t.jsx("h3",{className:"text-xl font-semibold",children:"Sobre o Jogo"}),t.jsx("p",{children:"Tower Trials é um jogo de RPG roguelike onde você sobe uma torre misteriosa, enfrentando monstros cada vez mais fortes a cada andar. Sua missão é subir o máximo possível, fortalecendo seu personagem e coletando equipamentos poderosos."}),t.jsx("h3",{className:"text-xl font-semibold",children:"Personagens"}),t.jsx("p",{children:"Cada jogador pode ter até 3 personagens ativos. Quando um personagem morre, ele é permanentemente deletado (sistema Permadeath). Os personagens possuem os seguintes atributos base:"}),t.jsxs("ul",{className:"list-disc list-inside space-y-2 ml-4",children:[t.jsxs("li",{children:[t.jsx("strong",{children:"HP (Pontos de Vida):"})," Determina quanto dano você pode receber"]}),t.jsxs("li",{children:[t.jsx("strong",{children:"Mana:"})," Recurso usado para lançar magias"]}),t.jsxs("li",{children:[t.jsx("strong",{children:"ATK (Ataque):"})," Determina o dano base dos seus ataques"]}),t.jsxs("li",{children:[t.jsx("strong",{children:"DEF (Defesa):"})," Reduz o dano recebido"]}),t.jsxs("li",{children:[t.jsx("strong",{children:"Speed (Velocidade):"})," Afeta suas chances de fuga e ordem de ações"]})]}),t.jsx("h3",{className:"text-xl font-semibold",children:"A Torre"}),t.jsx("p",{children:"A torre é dividida em andares com diferentes características:"}),t.jsxs("ul",{className:"list-disc list-inside space-y-2 ml-4",children:[t.jsxs("li",{children:[t.jsx("strong",{children:"Andares Comuns:"})," Encontros normais com monstros"]}),t.jsxs("li",{children:[t.jsx("strong",{children:"Andares de Elite (a cada 5 andares):"})," Monstros mais fortes com melhores recompensas"]}),t.jsxs("li",{children:[t.jsx("strong",{children:"Andares de Evento (a cada 7 andares):"})," Eventos especiais e encontros únicos"]}),t.jsxs("li",{children:[t.jsx("strong",{children:"Andares de Chefe (a cada 10 andares):"})," Batalhas desafiadoras contra chefes poderosos"]})]})]})]})})})}),t.jsx(kp,{value:"combat",children:t.jsx(rh,{className:"p-6",children:t.jsx(Pp,{className:"h-[600px] pr-4",children:t.jsxs("section",{className:"space-y-4",children:[t.jsx("h2",{className:"text-2xl font-bold",children:"Sistema de Combate"}),t.jsxs("div",{className:"space-y-4",children:[t.jsx("h3",{className:"text-xl font-semibold",children:"Ações de Combate"}),t.jsx("p",{children:"Durante o combate, você pode realizar as seguintes ações:"}),t.jsxs("ul",{className:"list-disc list-inside space-y-2 ml-4",children:[t.jsxs("li",{children:[t.jsx("strong",{children:"Ataque:"})," Causa dano baseado no seu ATK menos a DEF do inimigo"]}),t.jsxs("li",{children:[t.jsx("strong",{children:"Defesa:"})," Aumenta temporariamente sua DEF por um turno"]}),t.jsxs("li",{children:[t.jsx("strong",{children:"Magias:"})," Efeitos variados que consomem Mana"]}),t.jsxs("li",{children:[t.jsx("strong",{children:"Itens:"})," Usar poções e outros consumíveis"]}),t.jsxs("li",{children:[t.jsx("strong",{children:"Fuga:"})," Tenta escapar do combate (chance baseada na velocidade)"]})]}),t.jsx("h3",{className:"text-xl font-semibold",children:"Sistema de Magias"}),t.jsx("p",{children:"As magias são divididas em diferentes tipos de efeito:"}),t.jsxs("ul",{className:"list-disc list-inside space-y-2 ml-4",children:[t.jsxs("li",{children:[t.jsx("strong",{children:"Dano (Damage):"})," Causa dano direto ao inimigo"]}),t.jsxs("li",{children:[t.jsx("strong",{children:"Cura (Heal):"})," Recupera HP"]}),t.jsxs("li",{children:[t.jsx("strong",{children:"Buff:"})," Aumenta temporariamente seus atributos"]}),t.jsxs("li",{children:[t.jsx("strong",{children:"Debuff:"})," Reduz temporariamente os atributos do inimigo"]}),t.jsxs("li",{children:[t.jsx("strong",{children:"DoT (Damage over Time):"})," Causa dano ao longo do tempo"]}),t.jsxs("li",{children:[t.jsx("strong",{children:"HoT (Heal over Time):"})," Cura ao longo do tempo"]})]}),t.jsx("h3",{className:"text-xl font-semibold",children:"Comportamento dos Monstros"}),t.jsx("p",{children:"Os monstros possuem diferentes padrões de comportamento:"}),t.jsxs("ul",{className:"list-disc list-inside space-y-2 ml-4",children:[t.jsxs("li",{children:[t.jsx("strong",{children:"Agressivo:"})," Foca em causar dano"]}),t.jsxs("li",{children:[t.jsx("strong",{children:"Defensivo:"})," Alterna entre ataques e defesa"]}),t.jsxs("li",{children:[t.jsx("strong",{children:"Balanceado:"})," Mistura diferentes estratégias"]})]})]})]})})})}),t.jsx(kp,{value:"progression",children:t.jsx(rh,{className:"p-6",children:t.jsx(Pp,{className:"h-[600px] pr-4",children:t.jsxs("section",{className:"space-y-4",children:[t.jsx("h2",{className:"text-2xl font-bold",children:"Progressão"}),t.jsxs("div",{className:"space-y-4",children:[t.jsx("h3",{className:"text-xl font-semibold",children:"Sistema de Níveis"}),t.jsx("p",{children:"Ao derrotar monstros, você ganha XP. A quantidade de XP necessária para subir de nível aumenta em 50% a cada nível. Ao subir de nível:"}),t.jsxs("ul",{className:"list-disc list-inside space-y-2 ml-4",children:[t.jsx("li",{children:"Seus atributos base aumentam"}),t.jsx("li",{children:"HP e Mana são completamente restaurados"}),t.jsx("li",{children:"Você pode desbloquear novas magias"})]}),t.jsx("h3",{className:"text-xl font-semibold",children:"Recompensas"}),t.jsx("p",{children:"Ao derrotar monstros, você pode receber:"}),t.jsxs("ul",{className:"list-disc list-inside space-y-2 ml-4",children:[t.jsxs("li",{children:[t.jsx("strong",{children:"Gold:"})," Usado para comprar equipamentos e consumíveis"]}),t.jsxs("li",{children:[t.jsx("strong",{children:"Drops:"})," Itens que podem ser usados para crafting"]}),t.jsxs("li",{children:[t.jsx("strong",{children:"XP:"})," Para subir de nível"]})]}),t.jsx("h3",{className:"text-xl font-semibold",children:"Checkpoints"}),t.jsx("p",{children:"A cada 10 andares existe um checkpoint. Estes são pontos seguros onde você pode:"}),t.jsxs("ul",{className:"list-disc list-inside space-y-2 ml-4",children:[t.jsx("li",{children:"Salvar seu progresso"}),t.jsx("li",{children:"Retornar ao hub para comprar itens"}),t.jsx("li",{children:"Reorganizar seu equipamento"})]})]})]})})})}),t.jsx(kp,{value:"items",children:t.jsx(rh,{className:"p-6",children:t.jsx(Pp,{className:"h-[600px] pr-4",children:t.jsxs("section",{className:"space-y-4",children:[t.jsx("h2",{className:"text-2xl font-bold",children:"Itens e Equipamentos"}),t.jsxs("div",{className:"space-y-4",children:[t.jsx("h3",{className:"text-xl font-semibold",children:"Equipamentos"}),t.jsx("p",{children:"Os equipamentos são divididos em três categorias:"}),t.jsxs("ul",{className:"list-disc list-inside space-y-2 ml-4",children:[t.jsxs("li",{children:[t.jsx("strong",{children:"Armas (Weapons):"})," Aumentam principalmente ATK"]}),t.jsxs("li",{children:[t.jsx("strong",{children:"Armaduras (Armor):"})," Aumentam principalmente DEF"]}),t.jsxs("li",{children:[t.jsx("strong",{children:"Acessórios (Accessory):"})," Efeitos variados"]})]}),t.jsx("p",{children:"E em cinco raridades:"}),t.jsxs("ul",{className:"list-disc list-inside space-y-2 ml-4",children:[t.jsxs("li",{children:[t.jsx("strong",{children:"Comum (Common):"})," Equipamentos básicos"]}),t.jsxs("li",{children:[t.jsx("strong",{children:"Incomum (Uncommon):"})," Melhorias moderadas"]}),t.jsxs("li",{children:[t.jsx("strong",{children:"Raro (Rare):"})," Requer pergaminho especial para desbloquear"]}),t.jsxs("li",{children:[t.jsx("strong",{children:"Épico (Epic):"})," Requer pergaminho épico para desbloquear"]}),t.jsxs("li",{children:[t.jsx("strong",{children:"Lendário (Legendary):"})," Os mais poderosos do jogo"]})]}),t.jsx("h3",{className:"text-xl font-semibold",children:"Consumíveis"}),t.jsx("p",{children:"Existem diferentes tipos de consumíveis:"}),t.jsxs("ul",{className:"list-disc list-inside space-y-2 ml-4",children:[t.jsxs("li",{children:[t.jsx("strong",{children:"Poções:"})," Recuperam HP ou Mana"]}),t.jsxs("li",{children:[t.jsx("strong",{children:"Antídotos:"})," Removem efeitos negativos"]}),t.jsxs("li",{children:[t.jsx("strong",{children:"Elixires:"})," Proporcionam buffs temporários"]}),t.jsxs("li",{children:[t.jsx("strong",{children:"Pergaminhos:"})," Desbloqueiam equipamentos especiais"]})]}),t.jsx("h3",{className:"text-xl font-semibold",children:"Sistema de Crafting"}),t.jsx("p",{children:"Você pode criar itens usando materiais obtidos como drops dos monstros. Alguns consumíveis e equipamentos só podem ser obtidos através de crafting."})]})]})})})})]})]})}});function Tp(){const t=ra(),s=Us(),a=ba(),r=function(){const t=e.useContext(va);if(!t)throw new Error("useBattle deve ser usado dentro de um BattleProvider");return t}(),n=function(){const t=e.useContext(ja);if(!t)throw new Error("useEvent deve ser usado dentro de um EventProvider");return t}();return{gameState:t.gameState,loading:t.loading,error:t.error,setGameState:t.setGameState,updateLoading:t.updateLoading,setError:t.setError,resetError:t.resetError,gameMessage:s.gameMessage,gameLog:s.gameLog,addGameLogMessage:s.addGameLogMessage,setGameMessage:s.setGameMessage,characters:a.characters,selectedCharacter:a.selectedCharacter,createCharacter:a.createCharacter,selectCharacter:a.selectCharacter,loadCharacterForHub:a.loadCharacterForHub,initializeBattle:a.initializeBattle,updatePlayerStats:a.updatePlayerStats,reloadCharacters:a.reloadCharacters,performAction:r.performAction,interactWithEvent:n.interactWithEvent,startGame:a.createCharacter,clearGameState:()=>{t.setGameState({mode:"menu",player:{id:"",user_id:"",name:"",level:1,xp:0,xp_next_level:150,gold:0,hp:50,max_hp:50,mana:20,max_mana:20,atk:10,def:5,speed:10,created_at:"",updated_at:"",isPlayerTurn:!0,specialCooldown:0,defenseCooldown:0,isDefending:!1,floor:1,spells:[],consumables:[],potionUsedThisTurn:!1,active_effects:{buffs:[],debuffs:[],dots:[],hots:[],attribute_modifications:[]},strength:10,dexterity:10,intelligence:10,wisdom:10,vitality:10,luck:10,critical_chance:0,critical_damage:110,double_attack_chance:0,magic_attack:0,magic_mastery:1,magic_damage_bonus:0},currentEnemy:null,currentFloor:null,currentSpecialEvent:null,isPlayerTurn:!0,gameMessage:"",highestFloor:1,selectedSpell:null,battleRewards:null,fleeSuccessful:!1,characterDeleted:!1})},returnToMenu:()=>{t.setGameState({...t.gameState,mode:"menu"})},saveProgress:async()=>{},updatePlayerConsumables:e=>{t.setGameState({...t.gameState,player:{...t.gameState.player,consumables:e}})}}}const Rp=({isOpen:s,onClose:a,character:r,onStartFromCheckpoint:n})=>{const[i,o]=e.useState([]),[l,c]=e.useState(!1),[d,m]=e.useState(null);e.useEffect((()=>{s&&u()}),[s,r.id]);const u=async()=>{c(!0);try{const e=await ta.getUnlockedCheckpoints(r.id);if(e.success&&e.data){if(o(e.data),e.data.length>0){const t=e.data.find((e=>e.floor===r.floor)),s=t?t.floor:e.data[e.data.length-1].floor;m(s)}}else _.error("Erro ao carregar checkpoints",{description:e.error})}catch(e){_.error("Erro ao carregar checkpoints")}finally{c(!1)}},h=e=>1===e?t.jsx(dt,{className:"h-5 w-5"}):e>1&&(e-1)%10==0?t.jsx(Qe,{className:"h-5 w-5"}):t.jsx(ct,{className:"h-5 w-5"}),p=e=>1===e?"Início da aventura":e>1&&(e-1)%10==0?"Santuário Pós-Boss":"Checkpoint";return t.jsx(Kh,{open:s,onOpenChange:a,children:t.jsxs(Qh,{className:"sm:max-w-2xl max-h-[80vh] overflow-y-auto",children:[t.jsxs(ep,{children:[t.jsxs(sp,{className:"flex items-center gap-2",children:[t.jsx(ct,{className:"h-6 w-6"}),"Mapa da Torre - Checkpoints Desbloqueados"]}),t.jsx(ap,{children:"Escolha de qual andar você deseja iniciar sua aventura. Você só pode acessar checkpoints que já alcançou antes."})]}),t.jsx("div",{className:"space-y-4",children:l?t.jsx("div",{className:"flex items-center justify-center py-8",children:t.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-t-2 border-b-2 border-primary"})}):t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3",children:i.map((e=>{return t.jsxs(rh,{className:"cursor-pointer transition-all hover:shadow-md "+(d===e.floor?"ring-2 ring-primary bg-primary/5":"hover:bg-accent/50"),onClick:()=>m(e.floor),children:[t.jsx(nh,{className:"pb-2",children:t.jsxs(ih,{className:"text-sm flex items-center gap-2",children:[t.jsx("div",{className:"p-1 rounded-full text-white "+(s=e.floor,1===s?"bg-green-500":s>1&&(s-1)%10==0?"bg-yellow-500":"bg-blue-500"),children:h(e.floor)}),e.description,d===e.floor&&t.jsx(ve,{className:"h-4 w-4 text-primary ml-auto"})]})}),t.jsxs(lh,{className:"pt-0",children:[t.jsx("div",{className:"text-xs text-muted-foreground",children:p(e.floor)}),r.floor===e.floor&&t.jsx("div",{className:"text-xs text-green-600 font-medium mt-1",children:"Posição Atual"})]})]},e.floor);var s}))}),t.jsx(rh,{className:"bg-muted/30",children:t.jsxs(lh,{className:"p-4",children:[t.jsxs("div",{className:"flex items-center justify-between text-sm",children:[t.jsx("span",{children:"Andar Atual:"}),t.jsx("span",{className:"font-bold",children:r.floor})]}),t.jsxs("div",{className:"flex items-center justify-between text-sm mt-1",children:[t.jsx("span",{children:"Checkpoints Desbloqueados:"}),t.jsx("span",{className:"font-bold",children:i.length})]})]})}),t.jsxs("div",{className:"flex gap-3 pt-4",children:[t.jsx(Da,{variant:"outline",onClick:a,className:"flex-1",disabled:l,children:"Cancelar"}),t.jsxs(Da,{onClick:async()=>{if(null!==d)try{c(!0),n(d),a()}catch(e){_.error("Erro ao iniciar aventura")}finally{c(!1)}else _.error("Selecione um checkpoint")},className:"flex-1",disabled:l||null===d,children:[l?t.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-t-2 border-b-2 border-white mr-2"}):t.jsx(dt,{className:"h-4 w-4 mr-2"}),"Iniciar Aventura"]})]})]})})]})})},Dp=ut,qp=ht,$p=pt,Ip=e.forwardRef((({className:e,sideOffset:s=4,...a},r)=>t.jsx(mt,{ref:r,sideOffset:s,className:Ta("z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",e),...a})));function Lp({value:e,baseValue:s,equipmentBonus:a=0,modifications:r=[],size:n="md",showTooltip:i=!1,label:o,icon:l,className:c=""}){const d=isNaN(e)||null==e?0:e,m=isNaN(s||0)||null==s?0:s||0,u=isNaN(a)||void 0===a?0:a,h=r.reduce(((e,t)=>{if("flat"===t.type)return e+(isNaN(t.value)?0:t.value);return e+(m||d)*((isNaN(t.value)?0:t.value)/100)}),0),p=r.length>0,x=t.jsxs("div",{className:`inline-flex items-center gap-1 ${{sm:"text-xs",md:"text-sm",lg:"text-base"}[n]} ${c}`,children:[l&&t.jsx("span",{className:"inline-flex",children:l}),t.jsx("span",{className:"font-bold transition-all duration-300 "+(p?"text-purple-400 animate-pulse drop-shadow-[0_0_6px_rgba(168,85,247,0.4)]":u>0?"text-green-400":""),children:Math.round(d)}),p&&t.jsxs("div",{className:"inline-flex items-center",children:[t.jsx("div",{className:"w-1 h-1 bg-purple-400 rounded-full animate-pulse"}),t.jsxs("div",{className:"ml-1 text-purple-300 text-xs animate-bounce",children:[h>0?"+":"",Math.round(h)]})]}),o&&t.jsx("span",{className:"text-muted-foreground ml-1",children:o})]});return i?t.jsx(Dp,{children:t.jsxs(qp,{children:[t.jsx($p,{asChild:!0,children:x}),t.jsx(Ip,{className:"max-w-xs p-3",children:t.jsxs("div",{className:"space-y-2",children:[t.jsx("div",{className:"font-semibold text-sm",children:"Detalhes da Estatística"}),void 0!==s&&!isNaN(m)&&t.jsxs("div",{className:"flex justify-between text-xs",children:[t.jsx("span",{className:"text-muted-foreground",children:"Base:"}),t.jsx("span",{children:Math.round(m)})]}),u>0&&t.jsxs("div",{className:"flex justify-between text-xs",children:[t.jsx("span",{className:"text-muted-foreground",children:"Equipamentos:"}),t.jsxs("span",{className:"text-green-400 flex items-center gap-1",children:[t.jsx(Ze,{className:"h-3 w-3"}),Math.round(u)]})]}),r.length>0&&t.jsxs("div",{className:"space-y-1",children:[t.jsx("div",{className:"text-xs font-medium text-purple-400 border-t border-border pt-2",children:"Efeitos Mágicos:"}),r.map(((e,s)=>t.jsxs("div",{className:"flex justify-between text-xs",children:[t.jsxs("span",{className:"text-purple-300 flex items-center gap-1",children:[t.jsx("div",{className:"w-2 h-2 bg-purple-400 rounded-full animate-pulse"}),e.source_spell]}),t.jsxs("span",{className:"text-purple-400 flex items-center gap-1",children:[e.value>0?t.jsx(Oe,{className:"h-3 w-3"}):t.jsx(xt,{className:"h-3 w-3"}),e.value>0?"+":"",e.value,"percentage"===e.type?"%":""]})]},s))),t.jsxs("div",{className:"flex justify-between text-xs pt-1 border-t border-purple-500/20",children:[t.jsx("span",{className:"text-purple-300",children:"Total Mágico:"}),t.jsxs("span",{className:"text-purple-400 font-medium",children:[h>0?"+":"",Math.round(h)]})]})]}),t.jsxs("div",{className:"flex justify-between text-xs font-medium pt-2 border-t border-border",children:[t.jsx("span",{children:"Total:"}),t.jsx("span",{className:""+(p?"text-purple-400":"text-foreground"),children:Math.round(d)})]})]})})]})}):x}function Vp({player:s}){const a=i(),[r,n]=e.useState(!1),[o,l]=e.useState(!1),c=(d=s.level)<=1?0:Math.floor(100*Math.pow(1.5,d-2));var d;const m=s.xp_next_level,u=s.xp-c,h=m-c,p=Math.max(0,Math.min(100,u/h*100)),x=s.hp/s.max_hp*100,f=s.mana/s.max_mana*100,g=[{name:"FOR",fullName:"Força",value:s.strength||10,icon:qe,color:"text-red-400"},{name:"AGI",fullName:"Agilidade",value:s.dexterity||10,icon:Ie,color:"text-green-400"},{name:"INT",fullName:"Inteligência",value:s.intelligence||10,icon:ft,color:"text-blue-400"},{name:"SAB",fullName:"Sabedoria",value:s.wisdom||10,icon:gt,color:"text-purple-400"},{name:"VIT",fullName:"Vitalidade",value:s.vitality||10,icon:Ue,color:"text-pink-400"},{name:"SOR",fullName:"Sorte",value:s.luck||10,icon:Qe,color:"text-yellow-400"}],b=e=>{switch(e){case"sword_mastery":return t.jsx(qe,{className:"h-4 w-4 text-red-400"});case"axe_mastery":return t.jsx(jt,{className:"h-4 w-4 text-orange-400"});case"blunt_mastery":return t.jsx(yt,{className:"h-4 w-4 text-yellow-400"});case"defense_mastery":return t.jsx($e,{className:"h-4 w-4 text-blue-400"});case"magic_mastery":return t.jsx(ft,{className:"h-4 w-4 text-purple-400"});default:return t.jsx(vt,{className:"h-4 w-4 text-gray-400"})}},v=e=>{switch(e){case"sword_mastery":return"Maestria com Espadas";case"axe_mastery":return"Maestria com Machados";case"blunt_mastery":return"Maestria com Armas Pesadas";case"defense_mastery":return"Maestria em Defesa";case"magic_mastery":return"Maestria Mágica";default:return e}},y=[{key:"sword_mastery",level:s.sword_mastery||1,xp:s.sword_mastery_xp||0},{key:"axe_mastery",level:s.axe_mastery||1,xp:s.axe_mastery_xp||0},{key:"blunt_mastery",level:s.blunt_mastery||1,xp:s.blunt_mastery_xp||0},{key:"defense_mastery",level:s.defense_mastery||1,xp:s.defense_mastery_xp||0},{key:"magic_mastery",level:s.magic_mastery||1,xp:s.magic_mastery_xp||0}].filter((e=>e.level>1||e.xp>0));return t.jsxs(rh,{className:"w-full bg-slate-900/80 border-slate-700 shadow-xl",children:[t.jsx(nh,{className:"pb-3",children:t.jsxs(ih,{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-3",children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("div",{className:"p-2 bg-slate-700 rounded-lg",children:t.jsx(Z,{className:"h-5 w-5 text-slate-300"})}),t.jsxs("div",{children:[t.jsx("h2",{className:"text-xl font-bold text-slate-100",children:s.name}),t.jsx("p",{className:"text-sm text-slate-400",children:"Aventureiro"})]})]}),t.jsxs("div",{className:"flex items-center gap-2 sm:gap-3 flex-wrap",children:[t.jsxs(Da,{onClick:async()=>{try{l(!0);const e=await ta.getUnlockedCheckpoints(s.id);if(!e.success||!e.data||0===e.data.length)return;const t=e.data.sort(((e,t)=>t.floor-e.floor)),r=t[0];if(!(await ta.startFromCheckpoint(s.id,r.floor)).success)return;a({to:"/game/play/hub/battle/$character",params:{character:s.id},search:{character:s.id}})}catch(e){}finally{l(!1)}},disabled:o,size:"sm",className:"quick-play-button relative overflow-hidden bg-gradient-to-r from-violet-600 via-purple-600 to-indigo-600 hover:from-violet-500 hover:via-purple-500 hover:to-indigo-500 text-white border border-violet-500/20 shadow-lg transition-all duration-300 hover:shadow-violet-500/25 hover:shadow-xl hover:-translate-y-0.5 flex-shrink-0 group disabled:opacity-60 disabled:cursor-not-allowed disabled:hover:transform-none",children:[t.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-violet-600/50 via-purple-600/50 to-indigo-600/50 opacity-0 group-hover:opacity-100 transition-opacity duration-300"}),!o&&t.jsx("div",{className:"quick-start-indicator absolute -top-1 -right-1 w-2 h-2 bg-amber-400 rounded-full shadow-sm shadow-amber-400/50"}),t.jsx(dt,{className:"h-3 w-3 mr-1.5 relative z-10 transition-transform duration-300 "+(o?"animate-spin":"group-hover:scale-110 group-hover:drop-shadow-lg")}),t.jsx("span",{className:"relative z-10 font-medium tracking-wide",children:o?"Iniciando...":"Jogar"}),!o&&t.jsx("div",{className:"absolute inset-0 opacity-0 group-hover:opacity-30 transition-opacity duration-500",children:t.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-transparent via-white/30 to-transparent -skew-x-12 group-hover:animate-pulse"})})]}),t.jsxs(uh,{variant:"outline",className:"border-amber-500 text-amber-400 bg-amber-500/10 flex-shrink-0",children:[t.jsx(gt,{className:"h-3 w-3 mr-1"}),"Nível ",s.level]}),t.jsx(Da,{variant:"ghost",size:"sm",onClick:()=>n(!r),className:"text-slate-400 hover:text-slate-200 flex-shrink-0",children:r?t.jsx(me,{className:"h-4 w-4"}):t.jsx(ce,{className:"h-4 w-4"})})]})]})}),t.jsxs(lh,{className:"space-y-4",children:[t.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[t.jsxs("div",{className:"space-y-3",children:[t.jsx("h3",{className:"text-sm font-semibold text-slate-300 uppercase tracking-wide",children:"Status"}),t.jsxs("div",{className:"space-y-1",children:[t.jsxs("div",{className:"flex justify-between items-center text-sm",children:[t.jsxs("span",{className:"flex items-center gap-2 font-medium text-slate-300",children:[t.jsx(Ue,{className:"h-4 w-4 text-red-400"}),"HP",s.hp<s.max_hp&&t.jsx("div",{className:"h-2 w-2 bg-green-400 rounded-full animate-pulse"})]}),t.jsxs("span",{className:"text-slate-400",children:[s.hp,"/",s.max_hp]})]}),t.jsxs("div",{className:"relative",children:[t.jsx(vp,{value:x,className:"h-2"}),t.jsx("div",{className:"absolute top-0 left-0 h-2 rounded-full transition-all duration-300 "+(x>=70?"bg-green-500":x>=40?"bg-yellow-500":x>=20?"bg-orange-500":"bg-red-500"),style:{width:`${x}%`}})]})]}),t.jsxs("div",{className:"space-y-1",children:[t.jsxs("div",{className:"flex justify-between items-center text-sm",children:[t.jsxs("span",{className:"flex items-center gap-2 font-medium text-slate-300",children:[t.jsx(ft,{className:"h-4 w-4 text-blue-400"}),"Mana"]}),t.jsxs("span",{className:"text-slate-400",children:[s.mana,"/",s.max_mana]})]}),t.jsxs("div",{className:"relative",children:[t.jsx(vp,{value:f,className:"h-2"}),t.jsx("div",{className:"absolute top-0 left-0 h-2 rounded-full transition-all duration-300 "+(f>=70?"bg-blue-500":f>=40?"bg-cyan-500":f>=20?"bg-indigo-500":"bg-purple-500"),style:{width:`${f}%`}})]})]}),t.jsxs("div",{className:"space-y-1",children:[t.jsxs("div",{className:"flex justify-between items-center text-sm",children:[t.jsxs("span",{className:"flex items-center gap-2 font-medium text-slate-300",children:[t.jsx(gt,{className:"h-4 w-4 text-yellow-400"}),"XP"]}),t.jsxs("span",{className:"text-slate-400",children:[u.toLocaleString(),"/",h.toLocaleString()]})]}),t.jsxs("div",{className:"relative",children:[t.jsx(vp,{value:p,className:"h-2"}),t.jsx("div",{className:"absolute top-0 left-0 h-2 bg-gradient-to-r from-amber-400 via-yellow-500 to-orange-400 rounded-full transition-all duration-300",style:{width:`${p}%`}})]})]})]}),t.jsxs("div",{className:"space-y-3",children:[t.jsx("h3",{className:"text-sm font-semibold text-slate-300 uppercase tracking-wide",children:"Combat Stats"}),t.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[t.jsxs("div",{className:"space-y-2",children:[t.jsxs("div",{className:"flex items-center justify-between text-sm",children:[t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(qe,{className:"h-4 w-4 text-red-400"}),t.jsx("span",{className:"text-muted-foreground",children:"ATK"})]}),t.jsx("span",{className:"font-bold text-red-400",children:t.jsx(Lp,{value:s.atk,baseValue:s.base_atk,equipmentBonus:s.equipment_atk_bonus,className:"text-red-400",size:"sm",showTooltip:!0})})]}),s.magic_attack&&s.magic_attack>0&&t.jsxs("div",{className:"flex items-center justify-between text-sm",children:[t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(ft,{className:"h-4 w-4 text-purple-400"}),t.jsx("span",{className:"text-muted-foreground",children:"M.ATK"})]}),t.jsx("span",{className:"font-bold text-purple-400",children:s.magic_attack})]}),t.jsxs("div",{className:"flex items-center justify-between text-sm",children:[t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx($e,{className:"h-4 w-4 text-blue-400"}),t.jsx("span",{className:"text-muted-foreground",children:"DEF"})]}),t.jsx("span",{className:"font-bold text-blue-400",children:t.jsx(Lp,{value:s.def,baseValue:s.base_def,equipmentBonus:s.equipment_def_bonus,className:"text-blue-400",size:"sm",showTooltip:!0})})]})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsxs("div",{className:"flex items-center justify-between text-sm",children:[t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(Ie,{className:"h-4 w-4 text-yellow-400"}),t.jsx("span",{className:"text-muted-foreground",children:"SPD"})]}),t.jsx("span",{className:"font-bold text-yellow-400",children:t.jsx(Lp,{value:s.speed,baseValue:s.base_speed,equipmentBonus:s.equipment_speed_bonus,className:"text-yellow-400",size:"sm",showTooltip:!0})})]}),t.jsxs("div",{className:"flex items-center justify-between text-sm",children:[t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(gt,{className:"h-4 w-4 text-amber-400"}),t.jsx("span",{className:"text-muted-foreground",children:"CRIT"})]}),t.jsxs("span",{className:"font-bold text-amber-400",children:[(s.critical_chance||0).toFixed(1),"%"]})]})]})]}),t.jsx("div",{className:"bg-slate-800/50 p-3 rounded-lg border border-slate-700",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(bt,{className:"h-4 w-4 text-yellow-400"}),t.jsx("span",{className:"text-sm font-medium text-slate-300",children:"Gold"})]}),t.jsx("p",{className:"text-lg font-bold text-yellow-400",children:s.gold.toLocaleString("pt-BR")})]})})]}),t.jsxs("div",{className:"space-y-3",children:[t.jsx("h3",{className:"text-sm font-semibold text-slate-300 uppercase tracking-wide",children:"Atributos"}),t.jsx("div",{className:"grid grid-cols-3 gap-2",children:g.map((e=>{const s=e.icon;return t.jsx("div",{className:"bg-slate-800/50 p-2 rounded-lg border border-slate-700 hover:bg-slate-700/50 transition-colors",title:e.fullName,children:t.jsxs("div",{className:"flex flex-col items-center gap-1",children:[t.jsx(s,{className:`h-3 w-3 ${e.color}`}),t.jsx("span",{className:"text-xs font-medium text-slate-400",children:e.name}),t.jsx("span",{className:`text-sm font-bold ${e.color}`,children:e.value})]})},e.name)}))}),Boolean(s.critical_chance||s.critical_damage)&&t.jsxs("div",{className:"space-y-2",children:[Boolean(s.critical_chance)&&t.jsx("div",{className:"bg-slate-800/50 p-3 rounded-lg border border-slate-700",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(gt,{className:"h-4 w-4 text-orange-400"}),t.jsx("span",{className:"text-sm font-medium text-slate-300",children:"Chance Crítica"})]}),t.jsxs("p",{className:"text-sm font-bold text-orange-400",children:[(s.critical_chance||0).toFixed(1),"%"]})]})}),s.critical_damage&&t.jsx("div",{className:"bg-slate-800/50 p-3 rounded-lg border border-slate-700",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(vt,{className:"h-4 w-4 text-red-400"}),t.jsx("span",{className:"text-sm font-medium text-slate-300",children:"Dano Crítico"})]}),t.jsxs("p",{className:"text-sm font-bold text-red-400",children:[(s.critical_damage||0).toFixed(0),"%"]})]})})]})]})]}),r&&t.jsxs("div",{className:"border-t border-slate-700 pt-4 space-y-3",children:[t.jsx("h3",{className:"text-sm font-semibold text-slate-300 uppercase tracking-wide",children:"Habilidades de Combate"}),t.jsx("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-3",children:y.map((e=>{const s=100*e.level,a=100*(e.level-1),r=e.xp-a,n=s-a,i=Math.max(0,Math.min(100,r/n*100));return t.jsx("div",{className:"bg-slate-700/50 p-3 rounded-lg border border-slate-600 hover:border-slate-500 transition-colors",children:t.jsxs("div",{className:"flex flex-col items-center gap-2",children:[t.jsx("div",{className:"flex items-center justify-center",children:b(e.key)}),t.jsx("span",{className:"text-xs font-medium text-slate-400 text-center",children:v(e.key)}),t.jsxs(uh,{variant:"outline",className:"border-current bg-transparent text-xs",children:["Nv. ",e.level]}),Boolean(e.xp>0)&&t.jsxs("div",{className:"w-full",children:[t.jsx("div",{className:"w-full h-1 bg-slate-600 rounded-full overflow-hidden",children:t.jsx("div",{className:"h-full bg-gradient-to-r from-blue-500 to-purple-500 transition-all duration-300",style:{width:`${i}%`}})}),t.jsxs("div",{className:"text-xs text-slate-500 mt-1 text-center",children:[r,"/",n," XP"]})]})]})},e.key)}))})]})]})]})}function Fp({title:e,description:s,icon:a,onClick:r,badge:n,badgeColor:i="secondary",accent:o,isPrimary:l=!1}){return t.jsx(rh,{className:"group relative overflow-hidden border-slate-700 bg-slate-900/80 hover:bg-slate-800/80 transition-all duration-300 hover:border-slate-600 cursor-pointer "+(l?"ring-2 ring-red-600/30":""),children:t.jsxs(Da,{variant:"ghost",className:"w-full h-full p-3 flex flex-col items-center justify-center space-y-2 hover:bg-transparent min-h-[120px] cursor-pointer",onClick:r,children:[t.jsxs("div",{className:"relative",children:[t.jsx("div",{className:`p-3 rounded-lg bg-slate-800 group-hover:bg-slate-700 transition-colors duration-300 ${o}`,children:t.jsx(a,{className:"h-5 w-5 text-slate-300 group-hover:text-white transition-colors duration-300"})}),n&&t.jsx(uh,{variant:i,className:"absolute -top-2 -right-2 h-5 w-5 p-0 flex items-center justify-center text-xs font-bold bg-red-600 text-white border-red-500",children:n})]}),t.jsxs("div",{className:"text-center space-y-1 max-w-full",children:[t.jsx("h3",{className:"font-semibold text-sm text-slate-200 group-hover:text-white transition-colors duration-300 leading-tight",children:e}),t.jsx("p",{className:"text-xs text-slate-400 group-hover:text-slate-300 transition-colors duration-300 leading-tight px-1 break-words",children:s})]})]})})}function Op({player:e,onStartAdventure:s,onOpenMap:a,onOpenCharacterStats:r,onOpenShop:n,onOpenInventory:i,onOpenEquipment:o,onOpenSpells:l,onOpenCrafting:c,onOpenCemetery:d,onReturnToSelection:m}){const u=[{title:"Entrar na Torre",description:"Nova aventura",icon:ae,onClick:s,accent:"border-red-600/30",isPrimary:!0},{title:"Mapa da Torre",description:"Usar checkpoint",icon:ct,onClick:a,accent:"border-blue-600/30"},{title:"Atributos",description:"Evoluir personagem",icon:Oe,onClick:r,badge:e.attribute_points&&e.attribute_points>0?e.attribute_points:void 0,badgeColor:"destructive",accent:"border-purple-600/30"},{title:"Grimório",description:"Gerenciar magias",icon:ft,onClick:l,accent:"border-violet-600/30"},{title:"Loja",description:"Comprar itens",icon:Nt,onClick:n,accent:"border-green-600/30"},{title:"Inventário",description:"Consumíveis",icon:wt,onClick:i,accent:"border-orange-600/30"},{title:"Equipamentos",description:"Armas e armaduras",icon:$e,onClick:o,accent:"border-amber-600/30"},{title:"Forja",description:"Crafting de itens",icon:yt,onClick:c,accent:"border-cyan-600/30"},{title:"Cemitério",description:"Personagens mortos",icon:Le,onClick:d,accent:"border-red-600/30"},{title:"Trocar",description:"Outro personagem",icon:Te,onClick:m,accent:"border-slate-600/30"}];return t.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-10 gap-3",children:u.map(((e,s)=>t.jsx(Fp,{title:e.title,description:e.description,icon:e.icon,onClick:e.onClick,badge:e.badge,badgeColor:e.badgeColor,accent:e.accent,isPrimary:e.isPrimary},s)))})}function zp({player:e,showHealNotification:s,healInfo:a,onDismissHealNotification:r}){const n=e.attribute_points&&e.attribute_points>0;return s||n?t.jsxs("div",{className:"space-y-3",children:[n&&t.jsx(rh,{className:"bg-amber-950/50 border-amber-700/50 shadow-lg backdrop-blur-sm",children:t.jsx(lh,{className:"p-3",children:t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("div",{className:"p-2 bg-amber-600/20 rounded-lg",children:t.jsx(gt,{className:"h-4 w-4 text-amber-400"})}),t.jsxs("div",{className:"flex-1",children:[t.jsx("h3",{className:"font-semibold text-amber-200 text-sm",children:"Pontos de Atributo Disponíveis"}),t.jsxs("div",{className:"text-xs text-amber-300/80",children:["Você tem"," ",t.jsx(uh,{variant:"outline",className:"mx-1 text-amber-200 bg-amber-600/20 border-amber-500/50 text-xs px-1.5 py-0.5",children:e.attribute_points}),'ponto(s) para distribuir em "Atributos".']})]}),t.jsx(Ke,{className:"h-4 w-4 text-amber-500 animate-pulse"})]})})}),s&&a&&t.jsx("div",{className:"fixed top-4 right-4 z-50 max-w-sm animate-in slide-in-from-top-2 duration-500",children:t.jsx(rh,{className:"bg-emerald-950/80 border-emerald-700/50 shadow-xl backdrop-blur-md",children:t.jsx(lh,{className:"p-3",children:t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("div",{className:"p-2 bg-emerald-600/20 rounded-lg",children:t.jsx(Ue,{className:"h-4 w-4 text-emerald-400"})}),t.jsxs("div",{className:"flex-1",children:[t.jsxs("h3",{className:"font-semibold text-emerald-200 text-sm",children:[a.character," foi curado!"]}),t.jsxs("div",{className:"flex items-center gap-2 text-xs text-emerald-300",children:[t.jsx("span",{children:"HP:"}),t.jsxs("span",{className:"font-mono bg-emerald-900/50 px-2 py-0.5 rounded text-xs",children:[a.oldHp," → ",a.newHp]}),t.jsxs(uh,{variant:"outline",className:"text-emerald-300 border-emerald-500/50 bg-emerald-600/20 text-xs px-1.5 py-0.5",children:["+",a.newHp-a.oldHp]})]})]}),t.jsx(Da,{variant:"ghost",size:"sm",onClick:r,className:"h-6 w-6 p-0 text-emerald-400 hover:text-emerald-300 hover:bg-emerald-800/50",children:t.jsx(X,{className:"h-3 w-3"})})]})})})})]}):null}Ip.displayName=mt.displayName;const Bp=d("/_authenticated/game/play/hub")({component:function(){const e=o(),{character:s}=Bp.useSearch();if("/game/play/hub"===e.pathname)return t.jsx(Up,{characterId:s});return t.jsx(r,{})},validateSearch:e=>({character:e.character||""})});function Up({characterId:s}){const a=i(),r=Tp(),{gameState:n,loadCharacterForHub:o}=r,{player:l}=n,[c,d]=e.useState(!0),[m,u]=e.useState(!1),[h,p]=e.useState(!1),[x,f]=e.useState(!1),[g,b]=e.useState(null);if(e.useEffect((()=>{(async()=>{if(s)if(m&&l.id===s&&l.name&&l.level>0)d(!1);else try{d(!0);const t=await ta.getCharacterForGame(s);if(t.success&&t.data){const a=sessionStorage.getItem(`player_${s}`);if(a)try{const e=JSON.parse(a),s=t.data.hp-e.hp,r=s/t.data.max_hp*100;s>0&&r>=5&&(b({oldHp:e.hp,newHp:t.data.hp,character:t.data.name}),f(!0),setTimeout((()=>{f(!1)}),5e3))}catch(e){}sessionStorage.setItem(`player_${s}`,JSON.stringify(t.data)),await o(t.data),u(!0)}else _.error("Erro ao carregar personagem",{description:t.error}),a({to:"/game/play"})}catch(t){_.error("Erro ao carregar personagem"),a({to:"/game/play"})}finally{d(!1)}else a({to:"/game/play"})})()}),[s]),c)return t.jsx("div",{className:"flex items-center justify-center min-h-screen bg-slate-950",children:t.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-slate-500"})});return t.jsx("div",{className:"min-h-screen bg-gradient-to-b from-slate-950 to-slate-900 p-4",children:t.jsxs("div",{className:"w-full max-w-7xl mx-auto space-y-4",children:[t.jsx("div",{className:"space-y-3 sm:space-y-4",children:t.jsxs("div",{className:"flex flex-col gap-3",children:[t.jsxs(Da,{variant:"outline",size:"sm",onClick:()=>a({to:"/game/play"}),className:"self-start",children:[t.jsx(Te,{className:"h-4 w-4 mr-2"}),t.jsx("span",{className:"hidden sm:inline",children:"Trocar Personagem"}),t.jsx("span",{className:"sm:hidden",children:"Trocar"})]}),t.jsxs("div",{children:[t.jsxs("h1",{className:"text-2xl sm:text-3xl font-bold text-white",children:["Hub de ",l.name||"Carregando..."]}),t.jsxs("p",{className:"text-sm sm:text-base text-slate-300",children:["Andar ",Math.max(1,l.floor||1)," • Nível ",l.level||1," •"," ",(l.gold||0).toLocaleString("pt-BR")," Gold"]})]})]})}),t.jsx(zp,{player:l,showHealNotification:x,healInfo:g,onDismissHealNotification:()=>f(!1)}),t.jsxs("div",{className:"space-y-4",children:[t.jsx(Vp,{player:l}),t.jsx(Op,{player:l,onStartAdventure:async()=>{try{await ta.updateCharacterFloor(l.id,1),a({to:"/game/play/hub/battle/$character",params:{character:l.id},search:{character:l.id}})}catch(e){_.error("Erro ao iniciar aventura")}},onOpenMap:()=>p(!0),onOpenCharacterStats:()=>window.location.href=`/game/play/hub/character-stats?character=${l.id}`,onOpenShop:()=>window.location.href=`/game/play/hub/shop?character=${l.id}`,onOpenInventory:()=>window.location.href=`/game/play/hub/inventory?character=${l.id}`,onOpenEquipment:()=>window.location.href=`/game/play/hub/equipment?character=${l.id}`,onOpenSpells:()=>window.location.href=`/game/play/hub/spells?character=${l.id}`,onOpenCrafting:()=>window.location.href=`/game/play/hub/crafting?character=${l.id}`,onOpenCemetery:()=>window.location.href="/game/play/hub/cemetery",onReturnToSelection:()=>a({to:"/game/play"})})]}),t.jsx(Rp,{isOpen:h,onClose:()=>p(!1),character:{id:l.id,floor:l.floor},onStartFromCheckpoint:async e=>{try{const t=await ta.startFromCheckpoint(l.id,e);t.success?a({to:"/game/play/hub/battle/$character",params:{character:l.id},search:{character:l.id}}):_.error("Erro ao iniciar do checkpoint",{description:t.error})}catch(t){_.error("Erro ao iniciar do checkpoint")}}})]})})}const Hp=e.lazy((()=>s((()=>import("./SpellsPage-BJgbqMWQ.js")),__vite__mapDeps([9,2,3,4,6,5])))),Gp=d("/_authenticated/game/play/hub/spells")({component:Hp,validateSearch:e=>({character:e.character||""})});function Wp(e,t){if(e&&"object"==typeof e){if("message"in e&&"string"==typeof e.message)return e.message;if(e instanceof Error)return e.message}return t}class Xp{static consumableCache=new Map;static dropCache=new Map;static recipeCache=new Map;static lastFetchTimestamp=0;static CACHE_DURATION=3e5;static async getAvailableConsumables(){try{const e=Date.now();if(e-this.lastFetchTimestamp<this.CACHE_DURATION&&this.consumableCache.size>0){return{data:Array.from(this.consumableCache.values()),error:null,success:!0}}const{data:t,error:s}=await Ss.from("consumables").select("*").order("price");if(s)throw s;return this.consumableCache.clear(),t.forEach((e=>{this.consumableCache.set(e.id,e)})),this.lastFetchTimestamp=e,{data:t,error:null,success:!0}}catch(e){return{data:null,error:"Erro ao buscar consumíveis",success:!1}}}static async getCharacterConsumables(e){try{const{data:t,error:s}=await Ss.from("character_consumables").select("\n          *,\n          consumable:consumable_id (*)\n        ").eq("character_id",e);if(s)throw s;return{data:t,error:null,success:!0}}catch(t){return{data:null,error:"Erro ao buscar consumíveis do personagem",success:!1}}}static async buyConsumable(e,t,s=1){try{const{data:a,error:r}=await Ss.rpc("buy_consumable",{p_character_id:e,p_consumable_id:t,p_quantity:s}).single();if(r)throw r;return{data:{newGold:a},error:null,success:!0}}catch(a){return{data:null,error:Wp(a,"Erro ao comprar consumível"),success:!1}}}static async consumeItem(e,t,s){try{const{data:a,error:r}=await Ss.from("character_consumables").select("\n          *,\n          consumable:consumable_id (*)\n        ").eq("character_id",e).eq("consumable_id",t).single();if(r)throw r;const n=a;if(!n||n.quantity<=0)return{data:null,error:"Você não possui este item",success:!1};const i=n.consumable;let o="";const l={};switch(i.type){case"potion":if(i.description.includes("HP")||i.description.includes("Vida")){const e=Math.floor(Number(s.hp)||0),t=Math.floor(Number(s.max_hp)||1),a=Math.floor(Number(i.effect_value)||0),r=Math.min(t,e+a),n=r-e;s.hp=r,l.hp=r,o=n>0?`Recuperou ${n} HP!`:"HP já estava no máximo!"}else if(i.description.includes("Mana")){const e=Math.floor(Number(s.mana)||0),t=Math.floor(Number(s.max_mana)||1),a=Math.floor(Number(i.effect_value)||0),r=Math.min(t,e+a),n=r-e;s.mana=r,l.mana=r,o=n>0?`Recuperou ${n} Mana!`:"Mana já estava no máximo!"}break;case"antidote":"active_effects"in s?(s.active_effects.debuffs=[],s.active_effects.dots=[],o="Todos os efeitos negativos foram removidos!"):o="Antídoto só pode ser usado durante batalhas!";break;case"buff":"active_effects"in s?i.description.includes("Força")||i.description.includes("ataque")?(s.atk+=i.effect_value,s.active_effects.buffs.push({type:"buff",value:i.effect_value,duration:3,source_spell:"elixir_strength"}),o=`Ataque aumentado em ${i.effect_value} por 3 turnos!`):(i.description.includes("Defesa")||i.description.includes("defesa"))&&(s.def+=i.effect_value,s.active_effects.buffs.push({type:"buff",value:i.effect_value,duration:3,source_spell:"elixir_defense"}),o=`Defesa aumentada em ${i.effect_value} por 3 turnos!`):o="Elixires só podem ser usados durante batalhas!"}const{error:c}=await Ss.rpc("use_consumable",{p_character_id:e,p_consumable_id:t});if(c)throw c;if(Object.keys(l).length>0){const{error:t}=await Ss.from("characters").update(l).eq("id",e);if(t)throw t}return{data:{message:o},error:null,success:!0}}catch(a){return{data:null,error:Wp(a,"Erro ao usar consumível"),success:!1}}}static async getMonsterDrops(){try{if(Date.now()-this.lastFetchTimestamp<this.CACHE_DURATION&&this.dropCache.size>0){return{data:Array.from(this.dropCache.values()),error:null,success:!0}}const{data:e,error:t}=await Ss.from("monster_drops").select("*").order("rarity");if(t)throw t;return this.dropCache.clear(),e.forEach((e=>{this.dropCache.set(e.id,e)})),{data:e,error:null,success:!0}}catch(e){return{data:null,error:"Erro ao buscar drops",success:!1}}}static processMonsterDrops(e,t,s=1){const a=[];return t.forEach((t=>{const r=t.drop_chance*(1+.02*e)*s;if(Math.random()<=Math.min(.95,r)){const e=Math.floor(Math.random()*(t.max_quantity-t.min_quantity+1)+t.min_quantity);e>0&&a.push({drop_id:t.drop_id,quantity:e})}})),a}static async addDropsToInventory(e,t){try{if(0===t.length)return{data:0,error:null,success:!0};const a=t.map((e=>({drop_id:e.drop_id,quantity:e.quantity}))),{supabaseAdmin:r}=await s((async()=>{const{supabaseAdmin:e}=await Promise.resolve().then((()=>Ps));return{supabaseAdmin:e}}),void 0),{data:n,error:i}=await r.rpc("secure_process_combat_drops",{p_character_id:e,p_drops:a}).single();if(i)throw i;return{data:n,error:null,success:!0}}catch(a){return{data:null,error:Wp(a,"Erro ao processar drops"),success:!1}}}static async getCraftingRecipes(){try{if(Date.now()-this.lastFetchTimestamp<this.CACHE_DURATION&&this.recipeCache.size>0){return{data:Array.from(this.recipeCache.values()),error:null,success:!0}}const{data:e,error:t}=await Ss.from("crafting_recipes").select("\n          *,\n          ingredients:crafting_ingredients (*)\n        ");if(t)throw t;return this.recipeCache.clear(),e.forEach((e=>{this.recipeCache.set(e.result_id,e)})),{data:e,error:null,success:!0}}catch(e){return{data:null,error:"Erro ao buscar receitas",success:!1}}}static async canCraftItem(e,t){try{const{data:s,error:a}=await Ss.rpc("check_can_craft",{p_character_id:e,p_recipe_id:t});if(a)throw a;return{data:s,error:null,success:!0}}catch(s){return{data:null,error:Wp(s,"Erro ao verificar crafting"),success:!1}}}static async craftItem(e,t){try{const{error:s}=await Ss.rpc("craft_item",{p_character_id:e,p_recipe_id:t});if(s)throw s;return{data:{message:"Item criado com sucesso!"},error:null,success:!0}}catch(s){return{data:null,error:Wp(s,"Erro ao criar item"),success:!1}}}static async getCharacterDrops(e){try{const{data:t,error:s}=await Ss.from("character_drops").select("\n          *,\n          drop:drop_id (*)\n        ").eq("character_id",e);if(s)throw s;return{data:t,error:null,success:!0}}catch(t){return{data:null,error:"Erro ao buscar drops do personagem",success:!1}}}static async checkIngredients(e,t){try{const s=[];let a=!0;const[r,n]=await Promise.all([this.getCharacterConsumables(e),this.getCharacterDrops(e)]),i=r.success?r.data:[],o=n.success?n.data:[];for(const e of t)if("monster_drop"===e.item_type){const t=o?.find((t=>t.drop_id===e.item_id));if(!t||t.quantity<e.quantity){a=!1;const e=t?.drop?.name||"Item desconhecido";s.push(e)}}else if("consumable"===e.item_type){const t=i?.find((t=>t.consumable_id===e.item_id));if(!t||t.quantity<e.quantity){a=!1;const e=t?.consumable?.name||"Item desconhecido";s.push(e)}}return{data:{hasAll:a,missing:s},error:null,success:!0}}catch(s){return{data:null,error:"Erro ao verificar ingredientes",success:!1}}}static async getDropInfoByIds(e){try{if(0===e.length)return{data:[],error:null,success:!0};const{data:t,error:s}=await Ss.from("monster_drops").select("id, name, description, rarity, value").in("id",e);return s?{data:null,error:s.message,success:!1}:{data:t||[],error:null,success:!0}}catch(t){return{data:null,error:"Erro ao buscar informações dos drops",success:!1}}}}const Yp=Object.freeze(Object.defineProperty({__proto__:null,ConsumableService:Xp},Symbol.toStringTag,{value:"Module"}));var Kp="horizontal",Jp=["horizontal","vertical"],Zp=e.forwardRef(((e,s)=>{const{decorative:a,orientation:r=Kp,...n}=e,i=function(e){return Jp.includes(e)}(r)?r:Kp,o=a?{role:"none"}:{"aria-orientation":"vertical"===i?i:void 0,role:"separator"};return t.jsx(ie.div,{"data-orientation":i,...o,...n,ref:s})}));Zp.displayName="Separator";var Qp=Zp;const ex=e.forwardRef((({className:e,orientation:s="horizontal",decorative:a=!0,...r},n)=>t.jsx(Qp,{ref:n,decorative:a,orientation:s,className:Ta("shrink-0 bg-border","horizontal"===s?"h-[1px] w-full":"h-full w-[1px]",e),...r})));ex.displayName=Qp.displayName;var tx={color:void 0,size:void 0,className:void 0,style:void 0,attr:void 0},sx=h.createContext&&h.createContext(tx),ax=["attr","size","title"];function rx(e,t){if(null==e)return{};var s,a,r=function(e,t){if(null==e)return{};var s={};for(var a in e)if(Object.prototype.hasOwnProperty.call(e,a)){if(t.indexOf(a)>=0)continue;s[a]=e[a]}return s}(e,t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);for(a=0;a<n.length;a++)s=n[a],t.indexOf(s)>=0||Object.prototype.propertyIsEnumerable.call(e,s)&&(r[s]=e[s])}return r}function nx(){return nx=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var s=arguments[t];for(var a in s)Object.prototype.hasOwnProperty.call(s,a)&&(e[a]=s[a])}return e},nx.apply(this,arguments)}function ix(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),s.push.apply(s,a)}return s}function ox(e){for(var t=1;t<arguments.length;t++){var s=null!=arguments[t]?arguments[t]:{};t%2?ix(Object(s),!0).forEach((function(t){lx(e,t,s[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):ix(Object(s)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(s,t))}))}return e}function lx(e,t,s){return t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var s=e[Symbol.toPrimitive];if(void 0!==s){var a=s.call(e,t);if("object"!=typeof a)return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t),t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}function cx(e){return e&&e.map(((e,t)=>h.createElement(e.tag,ox({key:t},e.attr),cx(e.child))))}function dx(e){return t=>h.createElement(mx,nx({attr:ox({},e.attr)},t),cx(e.child))}function mx(e){var t=t=>{var s,{attr:a,size:r,title:n}=e,i=rx(e,ax),o=r||t.size||"1em";return t.className&&(s=t.className),e.className&&(s=(s?s+" ":"")+e.className),h.createElement("svg",nx({stroke:"currentColor",fill:"currentColor",strokeWidth:"0"},t.attr,a,i,{className:s,style:ox(ox({color:e.color||t.color},t.style),e.style),height:o,width:o,xmlns:"http://www.w3.org/2000/svg"}),n&&h.createElement("title",null,n),e.children)};return void 0!==sx?h.createElement(sx.Consumer,null,(e=>t(e))):t(tx)}function ux(e){return dx({attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M413.1 222.5l22.2 22.2c9.4 9.4 9.4 24.6 0 33.9L241 473c-9.4 9.4-24.6 9.4-33.9 0L12.7 278.6c-9.4-9.4-9.4-24.6 0-33.9l22.2-22.2c9.5-9.5 25-9.3 34.3.4L184 343.4V56c0-13.3 10.7-24 24-24h32c13.3 0 24 10.7 24 24v287.4l114.8-120.5c9.3-9.8 24.8-10 34.3-.4z"},child:[]}]})(e)}function hx(e){return dx({attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M34.9 289.5l-22.2-22.2c-9.4-9.4-9.4-24.6 0-33.9L207 39c9.4-9.4 24.6-9.4 33.9 0l194.3 194.3c9.4 9.4 9.4 24.6 0 33.9L413 289.4c-9.5 9.5-25 9.3-34.3-.4L264 168.6V456c0 13.3-10.7 24-24 24h-32c-13.3 0-24-10.7-24-24V168.6L69.2 289.1c-9.3 9.8-24.8 10-34.3.4z"},child:[]}]})(e)}function px(e){return dx({attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M416 304H32c-17.67 0-32 14.33-32 32v32c0 17.67 14.33 32 32 32h384c17.67 0 32-14.33 32-32v-32c0-17.67-14.33-32-32-32zm0-192H32c-17.67 0-32 14.33-32 32v32c0 17.67 14.33 32 32 32h384c17.67 0 32-14.33 32-32v-32c0-17.67-14.33-32-32-32z"},child:[]}]})(e)}function xx(e){return dx({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M304 48c0 26.51-21.49 48-48 48s-48-21.49-48-48 21.49-48 48-48 48 21.49 48 48zm-48 368c-26.51 0-48 21.49-48 48s21.49 48 48 48 48-21.49 48-48-21.49-48-48-48zm208-208c-26.51 0-48 21.49-48 48s21.49 48 48 48 48-21.49 48-48-21.49-48-48-48zM96 256c0-26.51-21.49-48-48-48S0 229.49 0 256s21.49 48 48 48 48-21.49 48-48zm12.922 99.078c-26.51 0-48 21.49-48 48s21.49 48 48 48 48-21.49 48-48c0-26.509-21.491-48-48-48zm294.156 0c-26.51 0-48 21.49-48 48s21.49 48 48 48 48-21.49 48-48c0-26.509-21.49-48-48-48zM108.922 60.922c-26.51 0-48 21.49-48 48s21.49 48 48 48 48-21.49 48-48-21.491-48-48-48z"},child:[]}]})(e)}const fx=({characterId:s,newEquipment:a,slotType:r,currentEquipment:n,showTitle:i=!0,compact:o=!1})=>{const[l,c]=e.useState([]),[d,m]=e.useState(!0),[u,h]=e.useState(null);e.useEffect((()=>{(async()=>{m(!0),h(null);try{if(void 0!==n){const e=((e,t)=>{const s=[];return[{name:"Ataque",current:e?.atk_bonus||0,new:t.atk_bonus},{name:"Defesa",current:e?.def_bonus||0,new:t.def_bonus},{name:"Mana",current:e?.mana_bonus||0,new:t.mana_bonus},{name:"Velocidade",current:e?.speed_bonus||0,new:t.speed_bonus},{name:"HP",current:e?.hp_bonus||0,new:t.hp_bonus},{name:"Chance Crítica",current:e?.critical_chance_bonus||0,new:t.critical_chance_bonus},{name:"Dano Crítico",current:e?.critical_damage_bonus||0,new:t.critical_damage_bonus},{name:"Duplo Ataque",current:e?.double_attack_chance_bonus||0,new:t.double_attack_chance_bonus},{name:"Dano Mágico",current:e?.magic_damage_bonus||0,new:t.magic_damage_bonus}].forEach((e=>{const t=e.new-e.current;0!==t&&s.push({stat_name:e.name,current_value:e.current,new_value:e.new,difference:t,is_improvement:t>0})})),s})(n,a);c(e)}else{const e=await Js.compareEquipmentStats(s,a.id,r);if(e.success&&e.data){const t=e.data.map((e=>({stat_name:e.stat_name,current_value:e.current_value,new_value:e.new_value,difference:e.difference,is_improvement:e.is_improvement})));c(t)}else h(e.error||"Erro ao comparar equipamentos")}}catch(e){h("Erro ao carregar comparação")}finally{m(!1)}})()}),[s,a.id,r,n]);const p=(e,t)=>{if(0===e)return"";return`${t?"+":""}${e.toFixed(e%1==0?0:2)}`},x=(e,t)=>0===t?"text-gray-400":e?"text-green-500":"text-red-500";return d?t.jsx("div",{className:(o?"p-2":"p-4")+" border rounded-lg bg-gray-50",children:t.jsxs("div",{className:"flex items-center justify-center space-x-2",children:[t.jsx(xx,{className:"animate-spin text-blue-500"}),t.jsx("span",{className:"text-sm text-gray-600",children:"Carregando comparação..."})]})}):u?t.jsx("div",{className:(o?"p-2":"p-4")+" border rounded-lg bg-red-50 border-red-200",children:t.jsx("p",{className:"text-sm text-red-600",children:u})}):0===l.length?t.jsx("div",{className:(o?"p-2":"p-4")+" border rounded-lg bg-gray-50",children:t.jsx("p",{className:"text-sm text-gray-600",children:null===n?"Nenhum equipamento equipado atualmente":"Nenhuma mudança nos atributos"})}):t.jsxs("div",{className:(o?"p-2":"p-4")+" border rounded-lg bg-white",children:[i&&t.jsx("h4",{className:(o?"text-sm":"text-base")+" font-semibold text-gray-800 mb-2",children:"Comparação de Atributos"}),t.jsx("div",{className:"space-y-1",children:l.map(((e,s)=>{return t.jsxs("div",{className:`flex items-center justify-between ${o?"text-xs":"text-sm"} py-1`,children:[t.jsxs("span",{className:"text-gray-700 font-medium",children:[e.stat_name,":"]}),t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx("span",{className:"text-gray-600",children:e.current_value.toFixed(e.current_value%1==0?0:2)}),t.jsxs("div",{className:"flex items-center space-x-1",children:[(a=e.is_improvement,r=e.difference,0===r?t.jsx(px,{className:"text-gray-400"}):a?t.jsx(hx,{className:"text-green-500"}):t.jsx(ux,{className:"text-red-500"})),t.jsx("span",{className:x(e.is_improvement,e.difference),children:p(e.difference,e.is_improvement)})]}),t.jsx("span",{className:"text-gray-800 font-semibold",children:e.new_value.toFixed(e.new_value%1==0?0:2)})]})]},s);var a,r}))}),!o&&t.jsx("div",{className:"mt-3 pt-2 border-t border-gray-200",children:t.jsxs("div",{className:"flex items-center space-x-4 text-xs text-gray-500",children:[t.jsxs("div",{className:"flex items-center space-x-1",children:[t.jsx(hx,{className:"text-green-500"}),t.jsx("span",{children:"Melhoria"})]}),t.jsxs("div",{className:"flex items-center space-x-1",children:[t.jsx(ux,{className:"text-red-500"}),t.jsx("span",{children:"Redução"})]}),t.jsxs("div",{className:"flex items-center space-x-1",children:[t.jsx(px,{className:"text-gray-400"}),t.jsx("span",{children:"Sem mudança"})]})]})})]})},gx=({character:s,availableEquipment:a,availableConsumables:r,onEquipmentPurchase:n,onConsumablePurchase:i,onOpenInventory:o})=>{const[l,c]=e.useState("equipment"),[d,m]=e.useState(null),[u,h]=e.useState("all"),[p,x]=e.useState("all"),f=a.filter((e=>"all"===u||e.type===u)),g=r.filter((e=>"all"===p||e.type===p)),b=e=>{const t={common:"bg-slate-800/80 text-slate-300 border-slate-600",uncommon:"bg-emerald-900/80 text-emerald-300 border-emerald-600",rare:"bg-blue-900/80 text-blue-300 border-blue-600",epic:"bg-purple-900/80 text-purple-300 border-purple-600",legendary:"bg-amber-900/80 text-amber-300 border-amber-600"};return t[e]||t.common},v=e=>{switch(e){case"weapon":return t.jsx(qe,{className:"h-4 w-4 text-red-400"});case"armor":return t.jsx($e,{className:"h-4 w-4 text-blue-400"});case"accessory":return t.jsx(bt,{className:"h-4 w-4 text-purple-400"});default:return t.jsx(_t,{className:"h-4 w-4 text-slate-400"})}},y=e=>{switch(e){case"potion":return t.jsx(ft,{className:"h-4 w-4 text-blue-500"});case"antidote":return t.jsx($e,{className:"h-4 w-4 text-green-500"});case"buff":return t.jsx(Ie,{className:"h-4 w-4 text-purple-500"});default:return t.jsx(_t,{className:"h-4 w-4"})}};return t.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6 h-full",children:[t.jsxs("div",{className:"lg:col-span-1 space-y-4",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center gap-2 bg-gradient-to-r from-amber-900/50 to-amber-800/50 border border-amber-700/50 px-4 py-2 rounded-lg backdrop-blur-sm",children:[t.jsx(ze,{className:"h-4 w-4 text-amber-400"}),t.jsx("span",{className:"font-semibold text-amber-300",children:s.gold})]}),t.jsxs(Da,{variant:"outline",size:"sm",onClick:o,className:"border-slate-600 bg-slate-800/50 hover:bg-slate-700/50 text-slate-300 hover:text-slate-100",children:[t.jsx(_t,{className:"h-4 w-4 mr-2"}),"Inventário"]})]}),t.jsxs("div",{className:"flex gap-2 p-1 bg-slate-800/50 rounded-lg border border-slate-700/50",children:[t.jsx(Da,{variant:"equipment"===l?"default":"ghost",size:"sm",onClick:()=>{c("equipment"),m(null)},className:"flex-1 "+("equipment"===l?"bg-primary/20 text-primary border-primary/50":"text-slate-400 hover:text-slate-200 hover:bg-slate-700/50"),children:t.jsx(Ct,{className:"h-4 w-4"})}),t.jsx(Da,{variant:"consumables"===l?"default":"ghost",size:"sm",onClick:()=>{c("consumables"),m(null)},className:"flex-1 "+("consumables"===l?"bg-primary/20 text-primary border-primary/50":"text-slate-400 hover:text-slate-200 hover:bg-slate-700/50"),children:t.jsx(Nt,{className:"h-4 w-4"})})]}),"equipment"===l&&t.jsxs("div",{className:"flex gap-1 flex-wrap p-1 bg-slate-800/30 rounded-lg border border-slate-700/30",children:[t.jsx(Da,{variant:"ghost",size:"sm",onClick:()=>h("all"),className:""+("all"===u?"bg-slate-600/50 text-slate-200":"text-slate-500 hover:text-slate-300 hover:bg-slate-700/30"),children:t.jsx(Et,{className:"h-3 w-3"})}),t.jsx(Da,{variant:"ghost",size:"sm",onClick:()=>h("weapon"),className:""+("weapon"===u?"bg-red-900/30 text-red-400 border border-red-800/50":"text-slate-500 hover:text-red-400 hover:bg-red-900/20"),children:t.jsx(qe,{className:"h-3 w-3"})}),t.jsx(Da,{variant:"ghost",size:"sm",onClick:()=>h("armor"),className:""+("armor"===u?"bg-blue-900/30 text-blue-400 border border-blue-800/50":"text-slate-500 hover:text-blue-400 hover:bg-blue-900/20"),children:t.jsx($e,{className:"h-3 w-3"})}),t.jsx(Da,{variant:"ghost",size:"sm",onClick:()=>h("accessory"),className:""+("accessory"===u?"bg-purple-900/30 text-purple-400 border border-purple-800/50":"text-slate-500 hover:text-purple-400 hover:bg-purple-900/20"),children:t.jsx(bt,{className:"h-3 w-3"})})]}),"consumables"===l&&t.jsxs("div",{className:"flex gap-1 flex-wrap p-1 bg-slate-800/30 rounded-lg border border-slate-700/30",children:[t.jsx(Da,{variant:"ghost",size:"sm",onClick:()=>x("all"),className:""+("all"===p?"bg-slate-600/50 text-slate-200":"text-slate-500 hover:text-slate-300 hover:bg-slate-700/30"),children:t.jsx(Et,{className:"h-3 w-3"})}),t.jsx(Da,{variant:"ghost",size:"sm",onClick:()=>x("potion"),className:""+("potion"===p?"bg-blue-900/30 text-blue-400 border border-blue-800/50":"text-slate-500 hover:text-blue-400 hover:bg-blue-900/20"),children:t.jsx(ft,{className:"h-3 w-3"})}),t.jsx(Da,{variant:"ghost",size:"sm",onClick:()=>x("antidote"),className:""+("antidote"===p?"bg-emerald-900/30 text-emerald-400 border border-emerald-800/50":"text-slate-500 hover:text-emerald-400 hover:bg-emerald-900/20"),children:t.jsx($e,{className:"h-3 w-3"})}),t.jsx(Da,{variant:"ghost",size:"sm",onClick:()=>x("buff"),className:""+("buff"===p?"bg-purple-900/30 text-purple-400 border border-purple-800/50":"text-slate-500 hover:text-purple-400 hover:bg-purple-900/20"),children:t.jsx(Ie,{className:"h-3 w-3"})})]}),t.jsx("div",{className:"space-y-2 max-h-[60vh] overflow-y-auto scrollbar-thin scrollbar-track-slate-800 scrollbar-thumb-slate-600",children:"equipment"===l?0===f.length?t.jsxs("div",{className:"text-center py-8 text-slate-500",children:[t.jsx(_t,{className:"h-8 w-8 mx-auto mb-2 opacity-50"}),t.jsx("p",{className:"text-sm",children:"Nenhum equipamento encontrado"})]}):f.map((e=>{const a=s.gold>=e.price,r=s.level>=e.level_requirement,n=a&&r&&e.is_unlocked,i=d?.id===e.id;return t.jsx(rh,{className:`cursor-pointer transition-all duration-200 hover:shadow-lg hover:shadow-primary/20 border-slate-700/50 bg-slate-800/50 backdrop-blur-sm ${i?"ring-2 ring-primary/60 shadow-lg shadow-primary/30":""} ${n?"hover:bg-slate-800/70":"opacity-60 grayscale"}`,onClick:()=>m(e),children:t.jsx(lh,{className:"p-3",children:t.jsxs("div",{className:"flex items-start gap-3",children:[t.jsx("div",{className:"flex-shrink-0 p-2 rounded-lg bg-slate-700/50",children:v(e.type)}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsx("h3",{className:"font-medium text-sm truncate text-slate-100",children:e.name}),t.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[t.jsx(uh,{variant:"outline",className:`text-xs border ${b(e.rarity)}`,children:e.rarity}),"legendary"===e.rarity&&t.jsx(gt,{className:"h-3 w-3 text-amber-400 animate-pulse"}),"epic"===e.rarity&&t.jsx(ft,{className:"h-3 w-3 text-purple-400"})]}),t.jsxs("div",{className:"flex items-center gap-1 mt-2",children:[t.jsx(ze,{className:"h-3 w-3 text-amber-400"}),t.jsx("span",{className:"text-xs font-medium text-amber-300",children:e.price})]})]})]})})},e.id)})):0===g.length?t.jsxs("div",{className:"text-center py-8 text-slate-500",children:[t.jsx(Nt,{className:"h-8 w-8 mx-auto mb-2 opacity-50"}),t.jsx("p",{className:"text-sm",children:"Nenhum consumível encontrado"})]}):g.map((e=>{const a=s.gold>=e.price,r=s.level>=(e.level_requirement||1),n=a&&r,i=d?.id===e.id;return t.jsx(rh,{className:`cursor-pointer transition-all duration-200 hover:shadow-lg hover:shadow-primary/20 border-slate-700/50 bg-slate-800/50 backdrop-blur-sm ${i?"ring-2 ring-primary/60 shadow-lg shadow-primary/30":""} ${n?"hover:bg-slate-800/70":"opacity-60 grayscale"}`,onClick:()=>m(e),children:t.jsx(lh,{className:"p-3",children:t.jsxs("div",{className:"flex items-start gap-3",children:[t.jsx("div",{className:"flex-shrink-0 p-2 rounded-lg bg-slate-700/50",children:y(e.type)}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsx("h3",{className:"font-medium text-sm truncate text-slate-100",children:e.name}),t.jsx("p",{className:"text-xs text-slate-400 mt-1",children:"potion"===e.type?`+${e.effect_value}`:"antidote"===e.type?"Remove debuffs":`+${e.effect_value} por 3 turnos`}),t.jsxs("div",{className:"flex items-center gap-1 mt-2",children:[t.jsx(ze,{className:"h-3 w-3 text-amber-400"}),t.jsx("span",{className:"text-xs font-medium text-amber-300",children:e.price})]})]})]})})},e.id)}))})]}),t.jsx("div",{className:"lg:col-span-2",children:t.jsx(rh,{className:"h-full border-slate-700/50 bg-slate-800/30 backdrop-blur-sm",children:t.jsx(lh,{className:"p-6 h-full",children:(()=>{if(!d)return t.jsx("div",{className:"flex items-center justify-center h-full text-slate-500",children:t.jsxs("div",{className:"text-center",children:[t.jsx(_t,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),t.jsx("p",{className:"text-lg",children:"Selecione um item para ver os detalhes"}),t.jsx("p",{className:"text-sm mt-2 opacity-75",children:"Clique em qualquer item da lista para visualizar suas informações completas"})]})});const e=d;if("atk_bonus"in d){const a=e,r=s.gold>=a.price,i=s.level>=a.level_requirement,o=r&&i&&a.is_unlocked;return t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{children:[t.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[t.jsx("div",{className:"p-3 rounded-lg bg-slate-700/50 border border-slate-600/50",children:v(a.type)}),t.jsx("h2",{className:"text-xl font-bold text-slate-100",children:a.name})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(uh,{className:`border ${b(a.rarity)}`,children:a.rarity}),t.jsx("span",{className:"text-sm text-slate-400",children:"weapon"===a.type?"Arma":"armor"===a.type?"Armadura":"Acessório"})]})]}),t.jsx(ex,{}),t.jsxs("div",{children:[t.jsx("h3",{className:"font-semibold mb-2 text-slate-200",children:"Descrição"}),t.jsx("p",{className:"text-sm text-slate-400 leading-relaxed",children:a.description})]}),t.jsxs("div",{children:[t.jsx("h3",{className:"font-semibold mb-3 text-slate-200",children:"Atributos"}),t.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[a.atk_bonus>0&&t.jsxs("div",{className:"flex items-center gap-2 p-3 bg-red-900/30 border border-red-800/50 rounded-lg backdrop-blur-sm",children:[t.jsx(qe,{className:"h-4 w-4 text-red-400"}),t.jsxs("span",{className:"text-sm text-red-300 font-medium",children:["+",a.atk_bonus]})]}),a.def_bonus>0&&t.jsxs("div",{className:"flex items-center gap-2 p-3 bg-blue-900/30 border border-blue-800/50 rounded-lg backdrop-blur-sm",children:[t.jsx($e,{className:"h-4 w-4 text-blue-400"}),t.jsxs("span",{className:"text-sm text-blue-300 font-medium",children:["+",a.def_bonus]})]}),a.mana_bonus>0&&t.jsxs("div",{className:"flex items-center gap-2 p-3 bg-purple-900/30 border border-purple-800/50 rounded-lg backdrop-blur-sm",children:[t.jsx(bt,{className:"h-4 w-4 text-purple-400"}),t.jsxs("span",{className:"text-sm text-purple-300 font-medium",children:["+",a.mana_bonus]})]}),a.speed_bonus>0&&t.jsxs("div",{className:"flex items-center gap-2 p-3 bg-amber-900/30 border border-amber-800/50 rounded-lg backdrop-blur-sm",children:[t.jsx(Ie,{className:"h-4 w-4 text-amber-400"}),t.jsxs("span",{className:"text-sm text-amber-300 font-medium",children:["+",a.speed_bonus]})]})]})]}),t.jsxs("div",{children:[t.jsx("h3",{className:"font-semibold mb-2 text-slate-200",children:"Comparação com Equipamento Atual"}),t.jsx(fx,{characterId:s.id,newEquipment:a,slotType:a.type,showTitle:!1,compact:!0})]}),t.jsxs("div",{children:[t.jsx("h3",{className:"font-semibold mb-2 text-slate-200",children:"Requisitos"}),t.jsxs("div",{className:"space-y-2",children:[t.jsxs("div",{className:"flex justify-between items-center p-2 bg-slate-700/30 rounded border border-slate-600/30",children:[t.jsx("span",{className:"text-sm text-slate-300",children:"Nível:"}),t.jsx("span",{className:"text-sm font-medium "+(i?"text-emerald-400":"text-red-400"),children:a.level_requirement})]}),t.jsxs("div",{className:"flex justify-between items-center p-2 bg-slate-700/30 rounded border border-slate-600/30",children:[t.jsx("span",{className:"text-sm text-slate-300",children:"Preço:"}),t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(ze,{className:"h-3 w-3 text-amber-400"}),t.jsx("span",{className:"text-sm font-medium "+(r?"text-emerald-400":"text-red-400"),children:a.price})]})]})]})]}),t.jsx(Da,{onClick:()=>n(a),disabled:!o,className:"w-full font-semibold "+(o?"bg-gradient-to-r from-primary to-primary/80 hover:from-primary/90 hover:to-primary/70 shadow-lg shadow-primary/25":"bg-slate-700/50 text-slate-400 cursor-not-allowed"),children:a.is_unlocked?i?r?"Comprar":"Gold Insuficiente":`Requer Nível ${a.level_requirement}`:"Item Bloqueado"})]})}{const a=e,r=s.gold>=a.price,n=s.level>=(a.level_requirement||1),o=r&&n;return t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{children:[t.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[t.jsx("div",{className:"p-3 rounded-lg bg-slate-700/50 border border-slate-600/50",children:y(a.type)}),t.jsx("h2",{className:"text-xl font-bold text-slate-100",children:a.name})]}),t.jsx("span",{className:"text-sm text-slate-400",children:"potion"===a.type?"Poção":"antidote"===a.type?"Antídoto":"Fortalecimento"})]}),t.jsx(ex,{}),t.jsxs("div",{children:[t.jsx("h3",{className:"font-semibold mb-2 text-slate-200",children:"Descrição"}),t.jsx("p",{className:"text-sm text-slate-400 leading-relaxed",children:a.description})]}),t.jsxs("div",{children:[t.jsx("h3",{className:"font-semibold mb-2 text-slate-200",children:"Efeito"}),t.jsx("div",{className:"p-3 bg-emerald-900/30 border border-emerald-800/50 rounded-lg backdrop-blur-sm",children:t.jsx("span",{className:"text-sm text-emerald-300",children:"potion"===a.type?`Restaura ${a.effect_value} pontos`:"antidote"===a.type?"Remove todos os efeitos negativos":`Aumenta atributo em ${a.effect_value} por 3 turnos`})})]}),t.jsxs("div",{children:[t.jsx("h3",{className:"font-semibold mb-2 text-slate-200",children:"Preço"}),t.jsxs("div",{className:"flex items-center gap-2 p-3 bg-slate-700/30 rounded-lg border border-slate-600/30",children:[t.jsx(ze,{className:"h-4 w-4 text-amber-400"}),t.jsxs("span",{className:"font-medium "+(r?"text-emerald-400":"text-red-400"),children:[a.price," gold cada"]})]})]}),t.jsxs("div",{className:"space-y-3",children:[t.jsx("h3",{className:"font-semibold text-slate-200",children:"Comprar"}),t.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[t.jsx(Da,{onClick:()=>i(a,1),disabled:!o,size:"sm",className:""+(o?"bg-gradient-to-r from-primary to-primary/80 hover:from-primary/90 hover:to-primary/70 shadow-md shadow-primary/20":"bg-slate-700/50 text-slate-400 cursor-not-allowed"),children:"1x"}),t.jsx(Da,{onClick:()=>i(a,5),disabled:!o||s.gold<5*a.price,size:"sm",variant:"outline",className:"border-slate-600 "+(!o||s.gold<5*a.price?"bg-slate-700/50 text-slate-400 cursor-not-allowed border-slate-700":"bg-slate-800/50 text-slate-300 hover:bg-slate-700/50 hover:text-slate-100"),children:"5x"}),t.jsx(Da,{onClick:()=>i(a,10),disabled:!o||s.gold<10*a.price,size:"sm",variant:"outline",className:"border-slate-600 "+(!o||s.gold<10*a.price?"bg-slate-700/50 text-slate-400 cursor-not-allowed border-slate-700":"bg-slate-800/50 text-slate-300 hover:bg-slate-700/50 hover:text-slate-100"),children:"10x"})]})]})]})}})()})})})]})},bx="/src/assets",vx={"poção de vida pequena":"small_health_potion.png","pequena poção de vida":"small_health_potion.png","small health potion":"small_health_potion.png","poção de hp pequena":"small_health_potion.png","poção de mana pequena":"small_mana_potion.png","pequena poção de mana":"small_mana_potion.png","small mana potion":"small_mana_potion.png","poção de mp pequena":"small_mana_potion.png",potion_hp_small:"small_health_potion.png",potion_mana_small:"small_mana_potion.png"};class yx{static iconCache=new Map;static preloadedAnimations=new Map;static loadingPromises=new Map;static getConsumableIcon(e){const t=`consumable-${e.id}`;if(this.iconCache.has(t))return this.iconCache.get(t);let s;const a=e.name.toLowerCase().trim();return s=vx[a]?`${bx}/icons/consumables/${vx[a]}`:this.getConsumableIconByType(e),this.iconCache.set(t,s),s}static getConsumableIconByType(e){const t=`${bx}/icons/consumables`;return"potion"===e.type?e.description.includes("HP")||e.description.includes("Vida")?e.effect_value<=30?`${t}/small_health_potion.png`:e.effect_value<=60?`${t}/health-potion-medium.png`:`${t}/health-potion-large.png`:e.description.includes("Mana")?e.effect_value<=15?`${t}/small_mana_potion.png`:e.effect_value<=30?`${t}/mana-potion-medium.png`:`${t}/mana-potion-large.png`:`${t}/small_health_potion.png`:"buff"===e.type||"elixir"===e.type?e.description.includes("Força")||e.description.includes("ataque")?`${t}/strength-elixir.png`:e.description.includes("Defesa")?`${t}/defense-elixir.png`:`${t}/strength-elixir.png`:"antidote"===e.type?`${t}/antidote.png`:`${t}/small_health_potion.png`}static addConsumableMapping(e,t){vx[e.toLowerCase().trim()]=t}static async preloadCharacterAnimation(e,t,s=3){const a=`${e}-${t}`;if(this.loadingPromises.has(a))return void(await this.loadingPromises.get(a));if(this.preloadedAnimations.has(a))return;const r=this.loadAnimationFrames(e,t,s);this.loadingPromises.set(a,r);try{await r}finally{this.loadingPromises.delete(a)}}static async loadAnimationFrames(e,t,s){const a=`${e}-${t}`,r=new Map,n=[];for(let i=1;i<=s;i++){const s=i.toString().padStart(2,"0"),a=`${bx}/characters/${e}/${t}/${e}-${t}-${s}.png`,o={element:new Image,loaded:!1,path:a};r.set(i,o);const l=new Promise((e=>{o.element.onload=()=>{o.loaded=!0,e()},o.element.onerror=()=>{e()},o.element.src=a}));n.push(l)}await Promise.all(n),this.preloadedAnimations.set(a,r)}static getCharacterAnimationFrame(e,t,s){const a=s.toString().padStart(2,"0"),r=`${bx}/characters/${e}/${t}/${e}-${t}-${a}.png`,n=`character-${e}-${t}-${s}`;return this.iconCache.set(n,r),r}static getPreloadedAnimationFrame(e,t,s){const a=`${e}-${t}`,r=this.preloadedAnimations.get(a);if(!r)return null;const n=r.get(s);return n?.loaded?n.element:null}static isAnimationPreloaded(e,t){const s=`${e}-${t}`;return this.preloadedAnimations.has(s)}static getEquipmentIcon(e){const t=`equipment-${e.id}`;if(this.iconCache.has(t))return this.iconCache.get(t);let s;const a=`${bx}/icons/equipment`;switch(e.type){case"weapon":s=e.name.toLowerCase().includes("espada")||e.name.toLowerCase().includes("sword")?e.level_requirement<=5?`${a}/weapons/swords/wooden-sword.png`:e.level_requirement<=15?`${a}/weapons/swords/iron-sword.png`:`${a}/weapons/swords/steel-sword.png`:e.name.toLowerCase().includes("cajado")||e.name.toLowerCase().includes("staff")?e.level_requirement<=10?`${a}/weapons/staffs/basic-staff.png`:`${a}/weapons/staffs/magic-staff.png`:e.name.toLowerCase().includes("arco")||e.name.toLowerCase().includes("bow")?`${a}/weapons/bows/wooden-bow.png`:`${a}/weapons/swords/iron-sword.png`;break;case"armor":s=e.level_requirement<=5?`${a}/armor/chest/leather-armor.png`:e.level_requirement<=15?`${a}/armor/chest/iron-armor.png`:`${a}/armor/chest/steel-armor.png`;break;case"accessory":s=e.name.toLowerCase().includes("anel")||e.name.toLowerCase().includes("ring")?`${a}/accessories/rings/basic-ring.png`:e.name.toLowerCase().includes("amuleto")||e.name.toLowerCase().includes("amulet")?`${a}/accessories/amulets/basic-amulet.png`:`${a}/accessories/trinkets/basic-trinket.png`;break;default:s=`${a}/weapons/swords/iron-sword.png`}return this.iconCache.set(t,s),s}static getMaterialIcon(e,t){const s=`material-${e}-${t}`;if(this.iconCache.has(s))return this.iconCache.get(s);const a=`${bx}/icons/materials/${e}/${t.toLowerCase().replace(/\s+/g,"-")}.png`;return this.iconCache.set(s,a),a}static getMonsterPortrait(e,t){const s=`monster-portrait-${e}-${t}`;if(this.iconCache.has(s))return this.iconCache.get(s);const a=e.toLowerCase().replace(/\s+/g,"-"),r=`${bx}/monsters/portraits/floor-${t}/${a}.png`;return this.iconCache.set(s,r),r}static getEnvironmentBackground(e,t){const s=`bg-${e}-${t}`;if(this.iconCache.has(s))return this.iconCache.get(s);const a=`${bx}/environments/backgrounds/${e}/${t}-bg.png`;return this.iconCache.set(s,a),a}static getStatusIcon(e,t){const s=`status-${e}-${t}`;if(this.iconCache.has(s))return this.iconCache.get(s);const a=t.toLowerCase().replace(/\s+/g,"-"),r=`${bx}/icons/status/${e}s/${a}.png`;return this.iconCache.set(s,r),r}static getUIIcon(e,t){const s=`ui-${e}-${t}`;if(this.iconCache.has(s))return this.iconCache.get(s);const a=`${bx}/icons/ui/${e}/${t}.png`;return this.iconCache.set(s,a),a}static clearCache(){this.iconCache.clear(),this.preloadedAnimations.clear(),this.loadingPromises.clear()}static async preloadCriticalAssets(){const e=[`${bx}/icons/consumables/small_health_potion.png`,`${bx}/icons/consumables/small_mana_potion.png`,`${bx}/icons/equipment/weapons/swords/wooden-sword.png`,`${bx}/icons/equipment/armor/chest/leather-armor.png`,`${bx}/icons/ui/buttons/primary-button.png`,`${bx}/icons/ui/frames/inventory-frame.png`].map((e=>new Promise(((t,s)=>{const a=new Image;a.onload=()=>t(),a.onerror=()=>s(new Error(`Failed to load ${e}`)),a.src=e})))),t=[this.preloadCharacterAnimation("thief","idle",3)];try{await Promise.all([...e,...t])}catch(s){}}static async assetExists(e){return new Promise((t=>{const s=new Image;s.onload=()=>t(!0),s.onerror=()=>t(!1),s.src=e}))}static getFallbackAsset(e){return{icons:`${bx}/icons/ui/placeholder.png`,characters:`${bx}/characters/player/portraits/default.png`,monsters:`${bx}/monsters/portraits/placeholder.png`,environments:`${bx}/environments/backgrounds/default-bg.png`,effects:`${bx}/effects/placeholder.png`,audio:""}[e]}}function jx(e){if(!e.effect_value||e.effect_value<=0)return"";switch(e.type){case"potion":return e.description.includes("HP")||e.description.includes("Vida")?`+${e.effect_value} HP`:e.description.includes("Mana")?`+${e.effect_value} Mana`:`+${e.effect_value}`;case"buff":case"elixir":return e.description.includes("Força")||e.description.includes("ataque")?`+${e.effect_value} Ataque por 3 turnos`:e.description.includes("Defesa")?`+${e.effect_value} Defesa por 3 turnos`:`+${e.effect_value} por 3 turnos`;case"antidote":return"Remove efeitos negativos";default:return`+${e.effect_value}`}}const Nx=({character:s,isOpen:a,onClose:r,onItemSold:n})=>{const[i,o]=e.useState([]),[l,c]=e.useState([]),[d,m]=e.useState([]),[u,h]=e.useState(!1),[p,x]=e.useState(null);e.useEffect((()=>{a&&s.id&&f()}),[a,s.id]);const f=async()=>{h(!0);try{const[e,t,a]=await Promise.all([Js.getCharacterEquipment(s.id),Xp.getCharacterConsumables(s.id),Xp.getCharacterDrops(s.id)]);o(e||[]),c(t.success&&t.data||[]),m(a.success&&a.data||[])}catch(e){_.error("Erro ao carregar inventário")}finally{h(!1)}},g=async(e,t)=>{if(e.equipment){try{if("toggle"===t){(await Js.toggleEquipment(s.id,e.equipment.id,!e.is_equipped)).success&&(_.success(e.is_equipped?"Item desequipado!":"Item equipado!"),f())}else if("sell"===t){const t=await Js.sellEquipment(s.id,e.equipment.id);t.success&&void 0!==t.data?.newGold?(_.success(`${e.equipment.name} vendido!`),n(t.data.newGold),f()):_.error(t.error||"Erro ao vender equipamento")}}catch(a){_.error("Erro ao executar ação")}x(null)}},b=e=>{const t={common:"text-slate-400",uncommon:"text-emerald-400",rare:"text-blue-400",epic:"text-purple-400",legendary:"text-amber-400"};return t[e]||t.common},v=e=>Math.floor(e.price*{common:.3,uncommon:.35,rare:.4,epic:.45,legendary:.5}[e.rarity]);return u?t.jsx(Kh,{open:a,onOpenChange:r,children:t.jsxs(Qh,{className:"max-w-md",children:[t.jsx(St,{children:t.jsx(sp,{children:"Carregando Inventário"})}),t.jsxs("div",{className:"flex items-center justify-center p-8",children:[t.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-t-2 border-b-2 border-primary"}),t.jsx("span",{className:"ml-2 text-slate-300",children:"Carregando..."})]})]})}):t.jsx(Kh,{open:a,onOpenChange:r,children:t.jsxs(Qh,{className:"max-w-md max-h-[80vh] bg-slate-900/95 border-slate-700/50",onClick:e=>{e.target===e.currentTarget&&x(null)},children:[t.jsx(ep,{className:"pb-2",children:t.jsxs(sp,{className:"flex items-center justify-between text-slate-100",children:[t.jsx("span",{children:"Inventário"}),t.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[t.jsx(ze,{className:"h-4 w-4 text-amber-400"}),t.jsx("span",{className:"text-amber-300",children:s.gold})]})]})}),t.jsxs(Cp,{defaultValue:"equipment",className:"w-full",children:[t.jsxs(Ep,{className:"grid w-full grid-cols-3 bg-slate-800/50",children:[t.jsxs(Sp,{value:"equipment",className:"text-xs",children:["Equipamentos (",i.length,")"]}),t.jsxs(Sp,{value:"consumables",className:"text-xs",children:["Consumíveis (",l.length,")"]}),t.jsxs(Sp,{value:"drops",className:"text-xs",children:["Materiais (",d.length,")"]})]}),t.jsx(kp,{value:"equipment",className:"mt-4",children:t.jsx("div",{className:"space-y-2 max-h-[50vh] overflow-y-auto",children:0===i.length?t.jsxs("div",{className:"text-center py-8 text-slate-500",children:[t.jsx(_t,{className:"h-8 w-8 mx-auto mb-2 opacity-50"}),t.jsx("p",{className:"text-sm",children:"Nenhum equipamento"})]}):i.map((e=>{if(!e.equipment)return null;const a=p===e.id;return t.jsxs("div",{className:"relative",children:[t.jsxs("div",{className:`flex items-center gap-3 p-3 rounded-lg border transition-all cursor-pointer ${e.is_equipped?"bg-primary/10 border-primary/30":"bg-slate-800/30 border-slate-700/30 hover:bg-slate-700/30"} ${a?"ring-2 ring-primary/50":""}`,onClick:()=>x(a?null:e.id),children:[t.jsx("div",{className:"flex-shrink-0",children:(r=e.equipment.type,"weapon"===r?t.jsx(qe,{className:"h-4 w-4"}):"armor"===r?t.jsx($e,{className:"h-4 w-4"}):"accessory"===r?t.jsx(bt,{className:"h-4 w-4"}):"potion"===r?t.jsx(Ue,{className:"h-4 w-4"}):t.jsx(_t,{className:"h-4 w-4"}))}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("span",{className:"text-sm font-medium text-slate-200 truncate",children:e.equipment.name}),e.is_equipped&&t.jsx("span",{className:"text-xs bg-primary/20 text-primary px-1.5 py-0.5 rounded",children:"Equipado"})]}),t.jsxs("div",{className:"flex items-center gap-2 text-xs text-slate-400",children:[t.jsx("span",{className:b(e.equipment.rarity),children:e.equipment.rarity}),e.equipment.atk_bonus>0&&t.jsxs("span",{className:"text-red-400",children:["+",e.equipment.atk_bonus," ATK"]}),e.equipment.def_bonus>0&&t.jsxs("span",{className:"text-blue-400",children:["+",e.equipment.def_bonus," DEF"]})]})]}),t.jsxs("div",{className:"text-xs text-amber-400",children:[t.jsx(ze,{className:"h-3 w-3 inline mr-1"}),v(e.equipment)]})]}),a&&t.jsxs("div",{className:"absolute top-full left-0 right-0 z-10 mt-1 bg-slate-800 border border-slate-600 rounded-lg p-3 shadow-lg space-y-3",children:[!e.is_equipped&&t.jsxs("div",{children:[t.jsx("h4",{className:"text-xs font-semibold text-slate-200 mb-2",children:"Comparação se Equipado"}),t.jsx(fx,{characterId:s.id,newEquipment:e.equipment,slotType:e.equipment.type,showTitle:!1,compact:!0})]}),t.jsxs("div",{className:"flex gap-2",children:[t.jsx(Da,{size:"sm",variant:e.is_equipped?"secondary":"default",onClick:()=>g(e,"toggle"),className:"flex-1 text-xs",children:e.is_equipped?"Desequipar":"Equipar"}),t.jsx(Da,{size:"sm",variant:"destructive",onClick:()=>g(e,"sell"),className:"flex-1 text-xs",children:"Vender"})]})]})]},e.id);var r}))})}),t.jsx(kp,{value:"consumables",className:"mt-4",children:t.jsx("div",{className:"space-y-2 max-h-[50vh] overflow-y-auto",children:0===l.length?t.jsxs("div",{className:"text-center py-8 text-slate-500",children:[t.jsx(ft,{className:"h-8 w-8 mx-auto mb-2 opacity-50"}),t.jsx("p",{className:"text-sm",children:"Nenhum consumível"})]}):l.filter((e=>e.quantity>0)).map((e=>{if(!e.consumable)return null;const a=p===e.id,r=(e=>{if(!e.consumable)return!1;if("potion"===e.consumable.type){if(e.consumable.description.includes("HP")&&s.hp>=s.max_hp)return!1;if(e.consumable.description.includes("Mana")&&s.mana>=s.max_mana)return!1}return!0})(e);return t.jsxs("div",{className:"relative",children:[t.jsxs("div",{className:`flex items-center gap-3 p-3 rounded-lg border transition-all cursor-pointer ${r?"bg-slate-800/30 border-slate-700/30 hover:bg-slate-700/30":"bg-slate-800/20 border-slate-700/20 opacity-60"} ${a?"ring-2 ring-primary/50":""}`,onClick:()=>r&&x(a?null:e.id),children:[t.jsx("div",{className:"flex-shrink-0",children:"potion"===e.consumable.type&&e.consumable.description.includes("HP")?t.jsx(Ue,{className:"h-5 w-5 text-red-400"}):"potion"===e.consumable.type&&e.consumable.description.includes("Mana")?t.jsx(Ie,{className:"h-5 w-5 text-blue-400"}):t.jsx(ft,{className:"h-5 w-5 text-purple-400"})}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("span",{className:"text-sm font-medium text-slate-200 truncate",children:e.consumable.name}),t.jsxs("span",{className:"text-xs bg-slate-700/50 text-slate-300 px-1.5 py-0.5 rounded",children:["x",e.quantity]})]}),t.jsx("div",{className:"text-xs text-slate-400",children:jx(e.consumable)})]})]}),a&&r&&t.jsx("div",{className:"absolute top-full left-0 right-0 z-10 mt-1 bg-slate-800 border border-slate-600 rounded-lg p-2 shadow-lg",children:t.jsx(Da,{size:"sm",onClick:()=>(async e=>{if(e.consumable){try{const t=await Xp.consumeItem(s.id,e.consumable_id,s);t.success?(_.success("Item usado com sucesso!"),f(),n(s.gold)):_.error(t.error||"Erro ao usar item")}catch(t){_.error("Erro ao usar item")}x(null)}})(e),className:"w-full text-xs",children:"Usar Agora"})})]},e.id)}))})}),t.jsx(kp,{value:"drops",className:"mt-4",children:t.jsx("div",{className:"space-y-2 max-h-[50vh] overflow-y-auto",children:0===d.length?t.jsxs("div",{className:"text-center py-8 text-slate-500",children:[t.jsx(gt,{className:"h-8 w-8 mx-auto mb-2 opacity-50"}),t.jsx("p",{className:"text-sm",children:"Nenhum material"})]}):d.filter((e=>e.quantity>0)).map((e=>e.drop?t.jsxs("div",{className:"flex items-center gap-3 p-3 rounded-lg bg-slate-800/30 border border-slate-700/30",children:[t.jsx("div",{className:"flex-shrink-0",children:t.jsx(gt,{className:"h-5 w-5 text-purple-400"})}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("span",{className:"text-sm font-medium text-slate-200 truncate",children:e.drop.name}),t.jsxs("span",{className:"text-xs bg-slate-700/50 text-slate-300 px-1.5 py-0.5 rounded",children:["x",e.quantity]})]}),t.jsxs("div",{className:"flex items-center gap-2 text-xs",children:[t.jsx("span",{className:b(e.drop.rarity),children:e.drop.rarity}),t.jsxs("span",{className:"text-amber-400",children:[e.drop.value," gold cada"]})]})]})]},e.id):null))})})]})]})})},wx=({character:s,onPurchase:a})=>{const[r,n]=e.useState([]),[i,o]=e.useState([]),[l,c]=e.useState(!0),[d,m]=e.useState(!1);e.useEffect((()=>{u()}),[s.level]);const u=async(e=!1)=>{try{let t=0;e?t=window.scrollY||document.documentElement.scrollTop:c(!0);const a=await Js.getAvailableEquipment(s.level);n(a);const r=await Xp.getAvailableConsumables();if(r.success&&r.data){const e=r.data.filter((e=>e.price>0&&!e.name.includes("Elixir")));o(e)}e&&requestAnimationFrame((()=>{window.scrollTo(0,t)}))}catch(t){_.error("Erro ao carregar itens da loja")}finally{e||c(!1)}};return l?t.jsxs("div",{className:"flex items-center justify-center p-8",children:[t.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-t-2 border-b-2 border-primary mr-4"}),t.jsx("span",{children:"Carregando loja..."})]}):t.jsxs(t.Fragment,{children:[t.jsx(gx,{character:s,availableEquipment:r,availableConsumables:i,onEquipmentPurchase:async e=>{if(s.gold<e.price)_.error("Gold insuficiente para comprar este item!");else try{const t=await Js.buyEquipment(s.id,e.id);t.success&&void 0!==t.data?.newGold?(_.success(`${e.name} comprado com sucesso!`),a(t.data.newGold)):_.error(t.error||"Erro ao comprar equipamento!")}catch(t){_.error("Erro ao comprar equipamento!")}},onConsumablePurchase:async(e,t=1)=>{const r=e.price*t;if(s.gold<r)_.error("Gold insuficiente para comprar este item!");else try{const r=await Xp.buyConsumable(s.id,e.id,t);r.success&&r.data?(_.success(`${t}x ${e.name} comprado com sucesso!`),a(r.data.newGold)):_.error(r.error||"Erro ao comprar consumível!")}catch(n){_.error("Erro ao comprar consumível!")}},onOpenInventory:()=>m(!0)}),t.jsx(Nx,{character:s,isOpen:d,onClose:()=>m(!1),onItemSold:e=>{a(e)}})]})};const _x=d("/_authenticated/game/play/hub/shop")({component:function(){const s=i(),{character:a}=_x.useSearch(),[r,n]=e.useState(null),[o,l]=e.useState(!0),[c,d]=e.useState(null);e.useEffect((()=>{m()}),[a]);const m=async()=>{if(a)try{l(!0),d(null);const e=await ta.getCharacter(a);if(e.success&&e.data)n(e.data);else{const t=e.error||"Erro desconhecido ao carregar personagem";d(t),_.error("Erro ao carregar personagem",{description:t})}}catch(e){const t=e instanceof Error?e.message:"Erro desconhecido";d(t),_.error("Erro ao carregar personagem",{description:t})}finally{l(!1)}else s({to:"/game/play"})};return o?t.jsx("div",{className:"min-h-screen flex flex-col items-center justify-center bg-gradient-to-b from-background to-secondary p-4",children:t.jsxs("div",{className:"text-center",children:[t.jsx("div",{className:"inline-block animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-primary mb-4"}),t.jsx("h2",{className:"text-2xl font-bold mb-2",children:"Carregando Loja"}),t.jsx("p",{className:"text-muted-foreground",children:"Aguarde enquanto carregamos os itens..."})]})}):c||!r?t.jsx("div",{className:"min-h-screen flex flex-col items-center justify-center bg-gradient-to-b from-background to-secondary p-4",children:t.jsx("div",{className:"w-full max-w-md text-center",children:t.jsxs(rh,{className:"p-6",children:[t.jsx(nh,{children:t.jsx(ih,{className:"text-red-500",children:"Erro ao Carregar Loja"})}),t.jsxs(lh,{className:"space-y-4",children:[t.jsx("p",{className:"text-muted-foreground",children:c||"Não foi possível carregar o personagem selecionado."}),t.jsxs("div",{className:"flex gap-2",children:[t.jsxs(Da,{onClick:m,className:"flex-1",children:[t.jsx(kt,{className:"h-4 w-4 mr-2"}),"Tentar Novamente"]}),t.jsxs(Da,{variant:"outline",onClick:()=>s({to:"/game/play"}),className:"flex-1",children:[t.jsx(Te,{className:"h-4 w-4 mr-2"}),"Voltar"]})]})]})]})})}):t.jsx("div",{className:"min-h-screen flex flex-col items-center justify-center bg-gradient-to-b from-background to-secondary p-4",children:t.jsxs("div",{className:"w-full max-w-7xl",children:[t.jsx("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-4 mb-6",children:t.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center gap-2 sm:gap-4",children:[t.jsxs(Da,{variant:"outline",size:"sm",onClick:()=>{s(a?{to:"/game/play/hub",search:{character:a}}:{to:"/game/play"})},className:"w-fit",children:[t.jsx(Te,{className:"h-4 w-4 mr-2"}),"Voltar ao Hub"]}),t.jsxs("div",{className:"mt-2 sm:mt-0",children:[t.jsx("h1",{className:"text-2xl sm:text-3xl font-bold",children:"Loja"}),t.jsxs("p",{className:"text-sm sm:text-base text-muted-foreground",children:[r.name," • Nível ",r.level," • Andar ",r.floor]})]})]})}),t.jsx(wx,{character:r,onPurchase:async e=>{r&&n((t=>({...t,gold:e})))}})]})})},validateSearch:e=>({character:e.character||""})});class Cx{static async getCharacterPotionSlots(e){try{const t=new Promise(((e,t)=>{setTimeout((()=>t(new Error("Timeout ao carregar slots de poção"))),8e3)})),s=Ss.rpc("get_character_potion_slots",{p_character_id:e}),{data:a,error:r}=await Promise.race([s,t]);if(r)return this.getFallbackSlots();const n=[];for(let e=1;e<=3;e++){const t=a?.find((t=>t.slot_position===e));n.push(t||{slot_position:e,consumable_id:null,consumable_name:null,consumable_description:null,effect_value:null,consumable_type:null,available_quantity:0,consumable_price:null})}return{data:n,error:null,success:!0}}catch(t){return this.getFallbackSlots()}}static getFallbackSlots(){const e=[];for(let t=1;t<=3;t++)e.push({slot_position:t,consumable_id:null,consumable_name:null,consumable_description:null,effect_value:null,consumable_type:null,available_quantity:0,consumable_price:null});return{data:e,error:null,success:!0}}static async getCharacterSpellSlots(e){try{const{data:t,error:s}=await Ss.rpc("get_character_spell_slots",{p_character_id:e});if(s)throw s;const a=[];for(let e=1;e<=3;e++){const s=t?.find((t=>t.slot_position===e));a.push(s||{slot_position:e,spell_id:null,spell_name:null,spell_description:null,mana_cost:null,damage:null,spell_type:null})}return{data:a,error:null,success:!0}}catch(t){return{data:null,error:"Erro ao buscar slots de spell",success:!1}}}static async setPotionSlot(e,t,s){try{const{data:a,error:r}=await Ss.rpc("set_potion_slot",{p_character_id:e,p_slot_position:t,p_consumable_id:s}).single();if(r)throw r;const n=a;return n.success?{data:null,error:null,success:!0}:{data:null,error:n.error||"Erro ao configurar slot de poção",success:!1}}catch(a){return{data:null,error:a instanceof Error?a.message:"Erro ao configurar slot de poção",success:!1}}}static async clearPotionSlot(e,t){try{const{data:s,error:a}=await Ss.rpc("clear_potion_slot",{p_character_id:e,p_slot_position:t}).single();if(a)throw a;const r=s;return r.success?{data:null,error:null,success:!0}:{data:null,error:r.error||"Erro ao limpar slot de poção",success:!1}}catch(s){return{data:null,error:s instanceof Error?s.message:"Erro ao limpar slot de poção",success:!1}}}static async setSpellSlot(e,t,s){try{const{error:a}=await Ss.rpc("set_spell_slot",{p_character_id:e,p_slot_position:t,p_spell_id:s});if(a)throw a;return{data:null,error:null,success:!0}}catch(a){return{data:null,error:a instanceof Error?a.message:"Erro ao configurar slot de spell",success:!1}}}static async consumePotionFromSlot(e,t){try{if(!e)return{success:!1,error:"ID do personagem é obrigatório",data:null};if(t<1||t>3)return{success:!1,error:"Posição do slot inválida (1-3)",data:null};const{supabaseAdmin:a}=await s((async()=>{const{supabaseAdmin:e}=await Promise.resolve().then((()=>Ps));return{supabaseAdmin:e}}),void 0),{data:r,error:n}=await a.rpc("consume_potion_from_slot",{p_character_id:e,p_slot_position:t});if(n)return{success:!1,error:n.message||"Erro ao usar poção",data:null};if(!r||!Array.isArray(r)||0===r.length)return{success:!1,error:"Nenhum resultado retornado da função",data:null};const i=r[0];if(!i)return{success:!1,error:"Resultado vazio da função",data:null};const o={success:Boolean(i.success),message:String(i.message||"Poção usada"),new_hp:Math.floor(Number(i.new_hp)||0),new_mana:Math.floor(Number(i.new_mana)||0)};return isNaN(o.new_hp)||isNaN(o.new_mana)?{success:!1,error:"Erro nos valores de HP/Mana retornados",data:null}:{success:o.success,error:o.success?null:o.message,data:o}}catch(a){return{success:!1,error:a instanceof Error?a.message:"Erro desconhecido",data:null}}}static async clearSpellSlot(e,t){return this.setSpellSlot(e,t,null)}}const Ex=Object.freeze(Object.defineProperty({__proto__:null,SlotService:Cx},Symbol.toStringTag,{value:"Module"})),Sx={sm:"h-4 w-4",md:"h-6 w-6",lg:"h-8 w-8",xl:"h-12 w-12"};function kx({consumable:s,size:a="md",className:r="",showFallback:n=!0}){const[i,o]=e.useState(!1),[l,c]=e.useState(!0),d=function(e){return yx.getConsumableIcon(e)}(s),m=function(e){switch(e.type){case"potion":return e.description.includes("HP")||e.description.includes("Vida")?"❤️":e.description.includes("Mana")?"💙":"🧪";case"buff":case"elixir":return e.description.includes("Força")||e.description.includes("ataque")?"⚔️":e.description.includes("Defesa")?"🛡️":"✨";case"antidote":return"🌿";default:return"📦"}}(s),u=`${Sx[a]} ${r}`;return i&&n?t.jsx("div",{className:`${u} flex items-center justify-center text-slate-500`,title:`${s.name} (fallback)`,children:t.jsx("span",{className:"text-sm",children:m})}):t.jsxs("div",{className:`${u} relative`,children:[l&&t.jsx("div",{className:"absolute inset-0 bg-slate-700/50 animate-pulse rounded"}),t.jsx("img",{src:d,alt:s.name,className:`${u} object-contain ${l?"opacity-0":"opacity-100"} transition-opacity duration-200`,onLoad:()=>{c(!1),o(!1)},onError:()=>{c(!1),o(!0)},loading:"lazy"})]})}function Px({characterId:s,consumables:a,onSlotsUpdate:r}){const[n,i]=e.useState([]),[o,l]=e.useState(!0),[c,d]=e.useState(null),[m,u]=e.useState(null),h=e.useRef(null),x=e.useRef({}),f=async()=>{try{const e=await Cx.getCharacterPotionSlots(s);e.success&&e.data&&i(e.data)}catch(e){}finally{l(!1)}};e.useEffect((()=>{s&&f()}),[s]),e.useEffect((()=>{const e=e=>{h.current&&!h.current.contains(e.target)&&(d(null),u(null))},t=()=>{d(null),u(null)};return document.addEventListener("mousedown",e),window.addEventListener("scroll",t,!0),()=>{document.removeEventListener("mousedown",e),window.removeEventListener("scroll",t,!0)}}),[]),e.useEffect((()=>{if(null!==c&&x.current[c]){const e=x.current[c];if(e){const t=e.getBoundingClientRect(),s=window.innerHeight,a=200;let r=t.bottom+4,n=t.left;r+a>s&&(r=t.top-a-4),n+240>window.innerWidth&&(n=window.innerWidth-240-8),n<8&&(n=8),u({top:r,left:n})}}}),[c]);const g=e=>{if(!e.consumable_id)return t.jsx(Pt,{className:"h-4 w-4 text-slate-500"});const s=a.find((t=>t.consumable_id===e.consumable_id));return s?.consumable?t.jsx(kx,{consumable:s.consumable,size:"lg"}):e.consumable_description?e.consumable_description.includes("HP")||e.consumable_description.includes("Vida")?t.jsx(Ue,{className:"h-4 w-4 text-red-400"}):e.consumable_description.includes("Mana")?t.jsx(Ie,{className:"h-4 w-4 text-blue-400"}):t.jsx(Pt,{className:"h-4 w-4 text-purple-400"}):t.jsx(Pt,{className:"h-4 w-4 text-slate-500"})},b=e=>{if(!e.consumable_id)return 0;const t=a.find((t=>t.consumable_id===e.consumable_id));return t?.quantity||0},v=e=>{return e.effect_value&&e.consumable_description?(t=e.effect_value,s=e.consumable_description,!t||t<=0?"":s.includes("HP")||s.includes("Vida")?`+${t} HP`:s.includes("Mana")?`+${t} Mana`:`+${t}`):"";var t,s};if(o)return t.jsxs("div",{className:"space-y-2",children:[t.jsx("div",{className:"text-xs text-slate-500 font-medium",children:"Atalhos Rápidos"}),t.jsx("div",{className:"flex gap-2",children:[1,2,3].map((e=>t.jsx("div",{className:"w-12 h-12 bg-slate-700/20 rounded border border-slate-700/30 animate-pulse"},`loading-slot-${e}`)))})]});const y=({slot:e})=>{const i=(e=>{const t=n.filter((t=>t.consumable_id&&t.slot_position!==e)).map((e=>e.consumable_id)),s=a.filter((e=>{const s=e.consumable&&"potion"===e.consumable.type&&e.quantity>0,a=!t.includes(e.consumable_id);return s&&a}));return s})(e.slot_position);return t.jsx("div",{ref:h,className:"fixed w-60 bg-slate-800/95 backdrop-blur-sm border border-slate-600/50 rounded-md shadow-xl max-h-48 overflow-y-auto",style:{top:m?.top||0,left:m?.left||0,zIndex:9999},children:i.length>0?t.jsx("div",{className:"p-1",children:i.map((a=>t.jsxs("button",{className:"w-full text-left px-2 py-1.5 rounded hover:bg-slate-700/50 transition-colors flex items-center gap-2 text-sm",onClick:()=>(async(e,t)=>{try{const a=await Cx.setPotionSlot(s,e,t);a.success?(await f(),r?.(),_.success("Poção atribuída ao slot!"),d(null),u(null)):_.error(a.error||"Erro ao atribuir poção")}catch(a){_.error("Erro ao configurar slot")}})(e.slot_position,a.consumable_id),children:[t.jsx("div",{className:"flex-shrink-0",children:t.jsx(kx,{consumable:a.consumable,size:"sm"})}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsx("div",{className:"text-xs font-medium text-slate-200 truncate",children:a.consumable.name}),t.jsxs("div",{className:"text-xs text-slate-400",children:[jx(a.consumable)," • x",a.quantity]})]})]},`dropdown-${a.id}`)))}):t.jsx("div",{className:"p-3 text-center",children:t.jsx("div",{className:"text-slate-400 text-xs",children:"Nenhuma poção disponível"})})})};return t.jsxs("div",{className:"space-y-2",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("div",{className:"text-xs text-slate-500 font-medium",children:"Atalhos Rápidos"}),t.jsx("div",{className:"text-xs text-slate-600",children:"Q • W • E"})]}),t.jsx("div",{className:"flex gap-2",children:n.map((e=>{const a=(e=>{switch(e){case 1:return"Q";case 2:return"W";case 3:return"E";default:return""}})(e.slot_position),n=!e.consumable_id,i=c===e.slot_position;return t.jsx("div",{className:"relative",ref:t=>{x.current[e.slot_position]=t},children:t.jsxs("div",{className:"relative group",children:[t.jsx(Da,{variant:"outline",className:`w-12 h-12 p-1 border transition-all duration-200 ${n?"border-slate-600/50 bg-slate-800/20 hover:border-slate-500/70 hover:bg-slate-700/30":"border-blue-500/60 bg-blue-900/20 hover:border-blue-400/80 hover:bg-blue-800/30"} ${i?"ring-1 ring-blue-400/50":""}`,onClick:()=>{var t;n&&(t=e.slot_position,c===t?(d(null),u(null)):d(t))},children:t.jsx("div",{className:"flex flex-col items-center justify-center",children:n?t.jsxs("div",{className:"flex items-center",children:[t.jsx(Ze,{className:"h-3 w-3 text-slate-500"}),t.jsx(ce,{className:"h-2 w-2 text-slate-500 transition-transform "+(i?"rotate-180":"")})]}):g(e)})}),t.jsx(uh,{className:"absolute -top-1 -right-1 h-4 w-4 p-0 flex items-center justify-center bg-slate-600 text-white text-xs font-medium border border-slate-700 text-[10px]",children:a}),!n&&t.jsx(Da,{variant:"destructive",size:"sm",className:"absolute -top-1 -left-1 h-4 w-4 p-0 rounded-full opacity-0 group-hover:opacity-100 transition-opacity",onClick:t=>{t.stopPropagation(),(async e=>{try{const t=await Cx.clearPotionSlot(s,e);t.success?(await f(),r?.(),_.success("Slot limpo!")):_.error(t.error||"Erro ao limpar slot")}catch(t){_.error("Erro ao limpar slot")}})(e.slot_position)},children:t.jsx(X,{className:"h-2 w-2"})}),t.jsx("div",{className:"absolute -bottom-8 left-1/2 transform -translate-x-1/2 opacity-0 group-hover:opacity-100 transition-opacity duration-200 z-10",children:t.jsxs("div",{className:"bg-slate-900/95 text-slate-300 text-xs px-2 py-1 rounded border border-slate-700/50 whitespace-nowrap",children:[n?`Slot ${a}`:e.consumable_name||"Poção",!n&&e.effect_value&&t.jsx("div",{className:"text-emerald-300 text-[10px]",children:v(e)}),!n&&b(e)>0&&t.jsxs("div",{className:"text-blue-300 text-[10px]",children:["x",b(e)]})]})})]})},`potion-slot-${e.slot_position}`)}))}),null!==c&&m&&"undefined"!=typeof document&&p.createPortal(t.jsx(y,{slot:n.find((e=>e.slot_position===c))}),document.body)]})}const Ax=({character:s,onInventoryChange:a})=>{const[r,n]=e.useState([]),[i,o]=e.useState([]),[l,c]=e.useState(!0),[d,m]=e.useState(null),[u,h]=e.useState(null),[p,x]=e.useState(null),f=e.useCallback((async()=>{try{c(!0);const[e,t]=await Promise.all([Xp.getCharacterConsumables(s.id),Xp.getCharacterDrops(s.id)]);n(e.success&&e.data||[]),o(t.success&&t.data||[])}catch(e){_.error("Erro ao carregar inventário"),n([]),o([])}finally{c(!1)}}),[s.id]);e.useEffect((()=>{f()}),[f]);const g=e=>{if(!e.consumable)return!1;if("potion"===e.consumable.type){if(e.consumable.description.includes("HP")&&s.hp>=s.max_hp)return!1;if(e.consumable.description.includes("Mana")&&s.mana>=s.max_mana)return!1}return!0},b=e=>{const t={common:"border-slate-600 bg-slate-800/30",uncommon:"border-emerald-600 bg-emerald-900/30",rare:"border-blue-600 bg-blue-900/30",epic:"border-purple-600 bg-purple-900/30",legendary:"border-amber-600 bg-amber-900/30"};return t[e]||t.common};return l?t.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6 h-[70vh]",children:[t.jsx("div",{className:"lg:col-span-2 space-y-6",children:t.jsx(rh,{className:"bg-slate-800/50 border-slate-700/50",children:t.jsx(lh,{className:"p-6",children:t.jsxs("div",{className:"animate-pulse space-y-4",children:[t.jsx("div",{className:"h-6 bg-slate-700 rounded w-32"}),t.jsx("div",{className:"grid grid-cols-8 gap-2",children:Array.from({length:16}).map(((e,s)=>t.jsx("div",{className:"aspect-square bg-slate-700 rounded"},s)))})]})})})}),t.jsx("div",{className:"lg:col-span-1",children:t.jsx(rh,{className:"bg-slate-800/50 border-slate-700/50 h-full",children:t.jsx(lh,{className:"p-6",children:t.jsxs("div",{className:"animate-pulse space-y-4",children:[t.jsx("div",{className:"h-6 bg-slate-700 rounded w-24"}),t.jsx("div",{className:"h-32 bg-slate-700 rounded"})]})})})})]}):t.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[t.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("h2",{className:"text-2xl font-bold text-slate-100",children:"Inventário"}),t.jsxs("div",{className:"flex items-center gap-2 text-amber-400 bg-slate-800/30 px-3 py-1 rounded-lg border border-slate-700/50",children:[t.jsx(ze,{className:"h-4 w-4"}),t.jsx("span",{className:"font-medium",children:s.gold.toLocaleString()})]})]}),t.jsx(rh,{className:"bg-slate-800/50 border-slate-700/50",children:t.jsxs(lh,{className:"p-6",children:[t.jsxs("h3",{className:"text-lg font-bold text-slate-100 mb-4 flex items-center gap-2",children:[t.jsx(ft,{className:"h-5 w-5 text-purple-400"}),"Consumíveis (",r.filter((e=>e.quantity>0)).length,")"]}),t.jsx("div",{className:"mb-6",children:t.jsx(Px,{characterId:s.id,consumables:r,onSlotsUpdate:()=>{f()}})}),(()=>{const e=r.filter((e=>e.consumable&&e.quantity>0));return 0===e.length?t.jsxs("div",{className:"text-center py-12",children:[t.jsx(_t,{className:"h-16 w-16 mx-auto mb-4 text-slate-600 opacity-50"}),t.jsx("p",{className:"text-slate-500",children:"Nenhum consumível disponível"})]}):t.jsx("div",{className:"grid grid-cols-10 gap-2",children:e.map((e=>{const s=d?.id===e.id,a=g(e);return t.jsxs("div",{className:`relative aspect-square border-2 rounded-lg cursor-pointer transition-all duration-200 hover:scale-105 ${s?"border-amber-400 bg-amber-900/30 shadow-lg shadow-amber-400/20":"border-slate-600 bg-slate-800/30 hover:border-slate-400"} ${a?"":"opacity-50"}`,onClick:()=>{m(e),h(null)},children:[t.jsx("div",{className:"absolute inset-0 flex items-center justify-center p-1.5",children:t.jsx(kx,{consumable:e.consumable,size:"xl"})}),e.quantity>1&&t.jsx("div",{className:"absolute bottom-1 right-1 bg-slate-900/80 text-slate-200 text-xs px-1 rounded",children:e.quantity}),!a&&t.jsx("div",{className:"absolute top-1 left-1 w-2 h-2 bg-red-500 rounded-full"})]},`consumable-${e.id}`)}))})})()]})}),t.jsx(rh,{className:"bg-slate-800/50 border-slate-700/50",children:t.jsxs(lh,{className:"p-6",children:[t.jsxs("h3",{className:"text-lg font-bold text-slate-100 mb-4 flex items-center gap-2",children:[t.jsx(gt,{className:"h-5 w-5 text-amber-400"}),"Materiais (",i.filter((e=>e.quantity>0)).length,")"]}),(()=>{const e=i.filter((e=>e.drop&&e.quantity>0));return 0===e.length?t.jsxs("div",{className:"text-center py-12",children:[t.jsx(_t,{className:"h-16 w-16 mx-auto mb-4 text-slate-600 opacity-50"}),t.jsx("p",{className:"text-slate-500",children:"Nenhum material disponível"})]}):t.jsx("div",{className:"grid grid-cols-10 gap-2",children:e.map((e=>{const s=u?.id===e.id,a=e.drop?.rarity||"common";return t.jsxs("div",{className:"relative aspect-square border-2 rounded-lg cursor-pointer transition-all duration-200 hover:scale-105 "+(s?"border-amber-400 bg-amber-900/30 shadow-lg shadow-amber-400/20":`${b(a)} hover:border-slate-400`),onClick:()=>{h(e),m(null)},children:[t.jsx("div",{className:"absolute inset-0 flex items-center justify-center p-1.5",children:t.jsx(gt,{className:"h-7 w-7 text-amber-400"})}),e.quantity>1&&t.jsx("div",{className:"absolute bottom-1 right-1 bg-slate-900/80 text-slate-200 text-xs px-1 rounded",children:e.quantity})]},`drop-${e.id}`)}))})})()]})})]}),t.jsx("div",{className:"lg:col-span-1",children:t.jsx(rh,{className:"bg-slate-800/50 border-slate-700/50 h-full",children:t.jsx(lh,{className:"p-6 h-full",children:(()=>{if(d?.consumable){const e=d,r=e.consumable,n=g(e);return t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"flex items-start gap-4",children:[t.jsx("div",{className:"p-4 rounded-lg border-2 border-slate-600 bg-slate-800/30",children:t.jsx(kx,{consumable:r,size:"xl"})}),t.jsxs("div",{className:"flex-1",children:[t.jsx("h2",{className:"text-2xl font-bold text-slate-100 mb-2",children:r.name}),t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx(uh,{className:"bg-slate-700/50 text-slate-200 border-0",children:r.type}),t.jsxs("span",{className:"text-slate-400",children:["Quantidade: ",e.quantity]})]})]})]}),t.jsx("div",{className:"bg-slate-800/30 border border-slate-700/50 rounded-lg p-4",children:t.jsx("p",{className:"text-slate-300 leading-relaxed",children:r.description})}),r.effect_value>0&&t.jsxs("div",{className:"bg-emerald-900/30 border border-emerald-700/50 rounded-lg p-4",children:[t.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[t.jsx(ft,{className:"h-4 w-4 text-emerald-400"}),t.jsx("span",{className:"text-emerald-300 font-medium",children:"Efeito"})]}),t.jsx("p",{className:"text-emerald-200",children:jx(r)})]}),t.jsx("div",{className:"space-y-3",children:t.jsx(Da,{onClick:()=>(async e=>{if(!e.consumable||e.quantity<=0)_.error("Consumível não disponível");else{x(e.consumable_id);try{const t=await Xp.consumeItem(s.id,e.consumable_id,s);t.success&&t.data?(await f(),a(),_.success(t.data.message)):_.error(t.error||"Erro ao usar consumível")}catch(t){_.error("Erro ao usar consumível")}finally{x(null)}}})(e),disabled:!n||p===e.consumable_id,className:"w-full "+(n?"bg-amber-600 hover:bg-amber-700 text-white":"bg-slate-700 text-slate-400 cursor-not-allowed"),children:p===e.consumable_id?t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-t border-b border-current"}),"Usando..."]}):n?"Usar Item":"potion"===r.type&&r.description.includes("HP")&&s.hp>=s.max_hp?"HP já está no máximo":"potion"===r.type&&r.description.includes("Mana")&&s.mana>=s.max_mana?"Mana já está no máximo":"Não pode ser usado agora"})})]})}if(u?.drop){const e=u,s=e.drop;return t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"flex items-start gap-4",children:[t.jsx("div",{className:`p-4 rounded-lg border-2 ${b(s.rarity)}`,children:t.jsx(gt,{className:"h-6 w-6 text-amber-400"})}),t.jsxs("div",{className:"flex-1",children:[t.jsx("h2",{className:"text-2xl font-bold text-slate-100 mb-2",children:s.name}),t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx(uh,{className:`${b(s.rarity)} border-0 text-slate-200`,children:s.rarity}),t.jsxs("span",{className:"text-slate-400",children:["Quantidade: ",e.quantity]})]})]})]}),t.jsx("div",{className:"bg-slate-800/30 border border-slate-700/50 rounded-lg p-4",children:t.jsx("p",{className:"text-slate-300 leading-relaxed",children:s.description})}),t.jsxs("div",{className:"bg-amber-900/30 border border-amber-700/50 rounded-lg p-4",children:[t.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[t.jsx(ze,{className:"h-4 w-4 text-amber-400"}),t.jsx("span",{className:"text-amber-300 font-medium",children:"Valor"})]}),t.jsxs("p",{className:"text-amber-200",children:[s.value," gold por unidade"]})]})]})}return t.jsx("div",{className:"flex items-center justify-center h-full text-slate-500",children:t.jsxs("div",{className:"text-center",children:[t.jsx(_t,{className:"h-16 w-16 mx-auto mb-4 opacity-50"}),t.jsx("p",{className:"text-lg",children:"Selecione um item"}),t.jsx("p",{className:"text-sm mt-2 opacity-75",children:"Clique em um item para ver os detalhes"})]})})})()})})})]})},Mx=d("/_authenticated/game/play/hub/inventory")({component:function(){const s=i(),{character:a}=Mx.useSearch(),{loadCharacterForHub:r}=Tp(),[n,o]=e.useState(null),[l,c]=e.useState(!0),[d,m]=e.useState(null),[u,h]=e.useState(!1),p=async(e=!0,t=!1)=>{if(a){if(t||!u||n?.id!==a||e){e&&c(!0),m(null);try{const e=await ta.getCharacter(a);if(e.success&&e.data)o(e.data),await r(e.data),h(!0);else{const t=e.error||"Erro desconhecido ao carregar personagem";m(t),_.error("Erro ao carregar personagem",{description:t})}}catch(i){const e=i instanceof Error?i.message:"Erro desconhecido";m(e),_.error("Erro ao carregar personagem",{description:e})}finally{c(!1)}}}else s({to:"/game/play"})};e.useEffect((()=>{p(!0)}),[a]);if(l)return t.jsx("div",{className:"min-h-screen flex flex-col items-center justify-center bg-gradient-to-b from-slate-900 to-black p-4",children:t.jsxs("div",{className:"text-center",children:[t.jsx("div",{className:"inline-block animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-amber-400 mb-4"}),t.jsx("h2",{className:"text-2xl font-bold mb-2 text-slate-100",children:"Carregando Inventário"}),t.jsx("p",{className:"text-slate-400",children:"Aguarde enquanto carregamos seus itens..."})]})});if(d||!n)return t.jsx("div",{className:"min-h-screen flex flex-col items-center justify-center bg-gradient-to-b from-slate-900 to-black p-4",children:t.jsx("div",{className:"w-full max-w-md text-center",children:t.jsxs(rh,{className:"p-6 bg-slate-800/50 border-slate-700/50",children:[t.jsx(nh,{children:t.jsx(ih,{className:"text-red-400",children:"Erro ao Carregar Inventário"})}),t.jsxs(lh,{className:"space-y-4",children:[t.jsx("p",{className:"text-slate-400",children:d||"Não foi possível carregar o personagem selecionado."}),t.jsxs("div",{className:"flex gap-2",children:[t.jsx(Da,{onClick:()=>p(),className:"flex-1 bg-amber-600 hover:bg-amber-700",children:"Tentar Novamente"}),t.jsxs(Da,{variant:"outline",onClick:()=>s({to:"/game/play"}),className:"flex-1 border-slate-600 text-slate-300",children:[t.jsx(Te,{className:"h-4 w-4 mr-2"}),"Voltar"]})]})]})]})})});return t.jsx("div",{className:"min-h-screen bg-gradient-to-b from-slate-900 to-black",children:t.jsxs("div",{className:"container mx-auto px-4 py-6",children:[t.jsx("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-4 mb-6",children:t.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center gap-2 sm:gap-4",children:[t.jsxs(Da,{variant:"outline",size:"sm",onClick:()=>{s(a?{to:"/game/play/hub",search:{character:a}}:{to:"/game/play"})},className:"border-slate-600 text-slate-300 hover:bg-slate-700 w-fit",children:[t.jsx(Te,{className:"h-4 w-4 mr-2"}),"Voltar ao Hub"]}),t.jsxs("div",{className:"mt-2 sm:mt-0",children:[t.jsx("h1",{className:"text-2xl sm:text-3xl font-bold text-slate-100",children:"Inventário"}),t.jsxs("p",{className:"text-sm sm:text-base text-slate-400",children:[n.name," • Nível ",n.level]})]})]})}),t.jsx(Ax,{character:n,onInventoryChange:()=>{p(!1,!0)}})]})})},validateSearch:e=>({character:e.character||""})});const Tx=({selectedItem:e,selectedSlot:s,character:a,onEquipmentChange:r})=>{const n=e=>{const t={common:"bg-slate-800/80 text-slate-300 border-slate-600",uncommon:"bg-emerald-900/80 text-emerald-300 border-emerald-600",rare:"bg-blue-900/80 text-blue-300 border-blue-600",epic:"bg-purple-900/80 text-purple-300 border-purple-600",legendary:"bg-amber-900/80 text-amber-300 border-amber-600"};return t[e]||t.common};return e?t.jsxs(rh,{className:"bg-slate-800/50 border-slate-700/50 h-full",children:[t.jsx(nh,{children:t.jsx(ih,{className:"text-slate-100",children:"Detalhes do Item"})}),t.jsxs(lh,{className:"space-y-6",children:[t.jsxs("div",{className:"flex items-start gap-4",children:[t.jsx("div",{className:`p-4 rounded-lg border-2 ${n(e.rarity)}`,children:(e=>{switch(e.type){case"weapon":return t.jsx(qe,{className:"h-12 w-12 text-red-400"});case"armor":return t.jsx(At,{className:"h-12 w-12 text-blue-400"});case"accessory":return t.jsx(bt,{className:"h-12 w-12 text-purple-400"});default:return t.jsx($e,{className:"h-12 w-12 text-slate-400"})}})(e)}),t.jsxs("div",{className:"flex-1",children:[t.jsx("h2",{className:"text-2xl font-bold text-slate-100 mb-2",children:e.name}),t.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[t.jsx(uh,{className:`border ${n(e.rarity)}`,children:e.rarity}),t.jsx(uh,{variant:"outline",className:"text-slate-300",children:e.type}),"legendary"===e.rarity&&t.jsx(gt,{className:"h-4 w-4 text-amber-400 animate-pulse"})]}),s&&t.jsxs("p",{className:"text-sm text-slate-400",children:["Equipado em: ",(e=>{switch(e){case"main_hand":return"Mão Principal";case"off_hand":return"Mão Secundária";case"armor":return"Armadura";case"accessory":return"Acessório";default:return e}})(s)]})]})]}),t.jsx("div",{className:"bg-slate-800/30 border border-slate-700/50 rounded-lg p-4",children:t.jsx("p",{className:"text-slate-300 leading-relaxed",children:e.description})}),t.jsxs("div",{className:"space-y-3",children:[t.jsx("h3",{className:"text-lg font-semibold text-slate-200",children:"Atributos"}),t.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.atk_bonus>0&&t.jsxs("div",{className:"bg-red-900/30 border border-red-700/50 rounded-lg p-3",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(qe,{className:"h-4 w-4 text-red-400"}),t.jsx("span",{className:"text-red-300 font-medium",children:"Ataque"})]}),t.jsxs("p",{className:"text-red-200 text-lg font-bold",children:["+",e.atk_bonus]})]}),e.def_bonus>0&&t.jsxs("div",{className:"bg-blue-900/30 border border-blue-700/50 rounded-lg p-3",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx($e,{className:"h-4 w-4 text-blue-400"}),t.jsx("span",{className:"text-blue-300 font-medium",children:"Defesa"})]}),t.jsxs("p",{className:"text-blue-200 text-lg font-bold",children:["+",e.def_bonus]})]}),e.mana_bonus>0&&t.jsxs("div",{className:"bg-purple-900/30 border border-purple-700/50 rounded-lg p-3",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(Ie,{className:"h-4 w-4 text-purple-400"}),t.jsx("span",{className:"text-purple-300 font-medium",children:"Mana"})]}),t.jsxs("p",{className:"text-purple-200 text-lg font-bold",children:["+",e.mana_bonus]})]}),e.speed_bonus&&e.speed_bonus>0&&t.jsxs("div",{className:"bg-yellow-900/30 border border-yellow-700/50 rounded-lg p-3",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(Ie,{className:"h-4 w-4 text-yellow-400"}),t.jsx("span",{className:"text-yellow-300 font-medium",children:"Velocidade"})]}),t.jsxs("p",{className:"text-yellow-200 text-lg font-bold",children:["+",e.speed_bonus]})]})]})]}),e.level_requirement&&e.level_requirement>1&&t.jsxs("div",{className:"bg-slate-700/30 border border-slate-600/50 rounded-lg p-3",children:[t.jsx("h4",{className:"text-sm font-medium text-slate-300 mb-2",children:"Requisitos"}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("span",{className:"text-slate-400",children:"Nível mínimo:"}),t.jsx("span",{className:"font-bold "+(a.level>=e.level_requirement?"text-green-400":"text-red-400"),children:e.level_requirement})]})]}),e.weapon_subtype&&t.jsxs("div",{className:"bg-slate-700/30 border border-slate-600/50 rounded-lg p-3",children:[t.jsx("h4",{className:"text-sm font-medium text-slate-300 mb-2",children:"Tipo de Arma"}),t.jsx("p",{className:"text-slate-400 capitalize",children:e.weapon_subtype})]}),s&&t.jsx("div",{className:"pt-4 border-t border-slate-700/50",children:t.jsx(Da,{onClick:async()=>{if(e&&s)try{const t=await Js.toggleEquipment(a.id,e.id,!1);t.success?(_.success("Item desequipado com sucesso!"),r()):_.error(t.error||"Erro ao desequipar item")}catch(t){_.error("Erro ao desequipar item")}},variant:"outline",className:"w-full border-red-600 text-red-400 hover:bg-red-900/30",children:"Desequipar Item"})})]})]}):t.jsxs(rh,{className:"bg-slate-800/50 border-slate-700/50 h-full",children:[t.jsx(nh,{children:t.jsx(ih,{className:"text-slate-100",children:"Detalhes do Item"})}),t.jsx(lh,{className:"flex items-center justify-center h-64",children:t.jsxs("div",{className:"text-center text-slate-500",children:[t.jsx(_t,{className:"h-16 w-16 mx-auto mb-4 opacity-50"}),t.jsx("p",{className:"text-lg",children:"Nenhum item selecionado"}),t.jsx("p",{className:"text-sm mt-2 opacity-75",children:"Clique em um slot para ver os detalhes do equipamento"})]})})]})},Rx=({equippedSlots:s,onSlotClick:a,onSlotLongPress:r})=>{const[n,i]=e.useState(null),[o,l]=e.useState(!1),c=e.useCallback((e=>{l(!1);const t=setTimeout((()=>{l(!0),r(e)}),800);i(t)}),[r]),d=e.useCallback(((e,t)=>{n&&(clearTimeout(n),i(null)),o||a(e,t),setTimeout((()=>l(!1)),100)}),[n,o,a]),m=e.useCallback((()=>{n&&(clearTimeout(n),i(null)),l(!1)}),[n]),u=(e,s)=>{if(s)switch(s.type){case"weapon":return t.jsx(qe,{className:"h-8 w-8 text-red-400"});case"armor":return t.jsx(At,{className:"h-8 w-8 text-blue-400"});case"accessory":return t.jsx(bt,{className:"h-8 w-8 text-purple-400"});default:return t.jsx($e,{className:"h-8 w-8 text-slate-400"})}switch(e){case"main_hand":case"off_hand":return t.jsx(qe,{className:"h-8 w-8 text-slate-500"});case"armor":return t.jsx(At,{className:"h-8 w-8 text-slate-500"});case"accessory":return t.jsx(bt,{className:"h-8 w-8 text-slate-500"});default:return t.jsx(Ze,{className:"h-8 w-8 text-slate-500"})}},h=e=>{if(!e)return"border-slate-600 bg-slate-800/30";const t={common:"border-slate-600 bg-slate-800/30",uncommon:"border-emerald-600 bg-emerald-900/30",rare:"border-blue-600 bg-blue-900/30",epic:"border-purple-600 bg-purple-900/30",legendary:"border-amber-600 bg-amber-900/30"};return t[e]||t.common},p=(e,a)=>{const r=s[e],n=!r;return t.jsxs("div",{className:"space-y-3",children:[t.jsx("label",{className:"text-sm font-medium text-slate-300 block text-center",children:a}),t.jsxs("div",{className:"relative group",children:[t.jsx(Da,{variant:"outline",className:`w-full h-32 p-4 border-2 transition-all duration-300 ${n?"border-dashed border-slate-600 bg-gradient-to-br from-slate-800/40 to-slate-900/60 hover:border-slate-500 hover:from-slate-700/50 hover:to-slate-800/70":`${h(r.rarity)} hover:brightness-110 shadow-lg`} hover:scale-[1.02] active:scale-[0.98] select-none`,onMouseDown:()=>c(e),onMouseUp:()=>d(e,r??null),onMouseLeave:m,onTouchStart:()=>c(e),onTouchEnd:()=>d(e,r??null),onTouchCancel:m,onContextMenu:e=>e.preventDefault(),children:t.jsxs("div",{className:"flex flex-col items-center justify-center gap-3 h-full",children:[t.jsx("div",{className:"p-3 rounded-lg "+(n?"bg-slate-700/30":"bg-black/20"),children:u(e,r??null)}),r?t.jsxs("div",{className:"text-center space-y-1",children:[t.jsx("div",{className:"text-sm font-medium text-slate-200 leading-tight max-w-full",children:r.name.length>12?`${r.name.substring(0,12)}...`:r.name}),t.jsx(uh,{variant:"outline",className:"text-xs px-2 py-0.5",children:r.rarity})]}):t.jsx("div",{className:"text-sm text-slate-500 font-medium",children:"Vazio"})]})}),t.jsx("div",{className:"absolute inset-0 rounded-lg border-2 border-transparent group-active:border-amber-400/50 transition-colors duration-200 pointer-events-none"}),t.jsx("div",{className:"absolute -bottom-2 left-1/2 transform -translate-x-1/2 opacity-0 group-hover:opacity-100 transition-opacity duration-200 z-10",children:t.jsx("div",{className:"bg-slate-900/90 text-slate-300 text-xs px-2 py-1 rounded border border-slate-700/50 shadow-lg whitespace-nowrap",children:n?"Toque e segure para equipar":"Toque para detalhes"})})]})]})},x=e=>{const s=0===e?"Peitoral":1===e?"Capacete":2===e?"Pernas":"Botas";return 0===e?p("armor",s):t.jsxs("div",{className:"space-y-3",children:[t.jsx("label",{className:"text-sm font-medium text-slate-300 block text-center",children:s}),t.jsx("div",{className:"relative group",children:t.jsx(Da,{variant:"outline",className:"w-full h-32 p-4 border-2 border-dashed border-slate-600 bg-gradient-to-br from-slate-800/20 to-slate-900/40 transition-all duration-300 opacity-60",disabled:!0,children:t.jsxs("div",{className:"flex flex-col items-center justify-center gap-3 h-full",children:[t.jsx("div",{className:"p-3 rounded-lg bg-slate-700/20",children:t.jsx(At,{className:"h-8 w-8 text-slate-500"})}),t.jsx("div",{className:"text-sm text-slate-500 font-medium",children:"Em breve"})]})})})]})},f=e=>{const a=0===e&&s.accessory,r=e>0;return t.jsxs("div",{className:"space-y-3",children:[t.jsx("label",{className:"text-sm font-medium text-slate-300 block text-center",children:0===e?"Anel 1":1===e?"Anel 2":2===e?"Colar":"Amuleto"}),t.jsxs("div",{className:"relative group",children:[t.jsx(Da,{variant:"outline",className:`w-full h-32 p-4 border-2 transition-all duration-300 ${a?`${h(s.accessory.rarity)} hover:brightness-110 shadow-lg hover:scale-[1.02]`:r?"border-dashed border-slate-600 bg-gradient-to-br from-slate-800/20 to-slate-900/40 opacity-60":"border-dashed border-slate-600 bg-gradient-to-br from-slate-800/40 to-slate-900/60 hover:border-slate-500 hover:from-slate-700/50 hover:to-slate-800/70 hover:scale-[1.02]"} active:scale-[0.98] select-none`,onMouseDown:()=>0===e&&c("accessory"),onMouseUp:()=>0===e&&d("accessory",s.accessory??null),onMouseLeave:m,onTouchStart:()=>0===e&&c("accessory"),onTouchEnd:()=>0===e&&d("accessory",s.accessory??null),onTouchCancel:m,onContextMenu:e=>e.preventDefault(),disabled:r,children:t.jsxs("div",{className:"flex flex-col items-center justify-center gap-3 h-full",children:[t.jsx("div",{className:"p-3 rounded-lg "+(a?"bg-black/20":"bg-slate-700/30"),children:t.jsx(bt,{className:"h-8 w-8 text-slate-500"})}),a?t.jsxs("div",{className:"text-center space-y-1",children:[t.jsx("div",{className:"text-sm font-medium text-slate-200 leading-tight max-w-full",children:s.accessory.name.length>12?`${s.accessory.name.substring(0,12)}...`:s.accessory.name}),t.jsx(uh,{variant:"outline",className:"text-xs px-2 py-0.5",children:s.accessory.rarity})]}):t.jsx("div",{className:"text-sm text-slate-500 font-medium",children:0===e?"Vazio":"Em breve"})]})}),!r&&t.jsx("div",{className:"absolute inset-0 rounded-lg border-2 border-transparent group-active:border-amber-400/50 transition-colors duration-200 pointer-events-none"}),!r&&t.jsx("div",{className:"absolute -bottom-2 left-1/2 transform -translate-x-1/2 opacity-0 group-hover:opacity-100 transition-opacity duration-200 z-10",children:t.jsx("div",{className:"bg-slate-900/90 text-slate-300 text-xs px-2 py-1 rounded border border-slate-700/50 shadow-lg whitespace-nowrap",children:a?"Toque para detalhes":"Toque e segure para equipar"})})]})]})};return t.jsxs(rh,{className:"bg-slate-800/50 border-slate-700/50",children:[t.jsx(nh,{children:t.jsxs(ih,{className:"text-slate-100 flex items-center gap-2",children:[t.jsx($e,{className:"h-5 w-5 text-amber-400"}),"Equipamentos"]})}),t.jsxs(lh,{className:"space-y-8",children:[t.jsxs("div",{children:[t.jsx("h3",{className:"text-lg font-semibold text-slate-200 mb-6",children:"Armas"}),t.jsxs("div",{className:"grid grid-cols-2 gap-6",children:[p("main_hand","Mão Principal"),p("off_hand","Mão Secundária")]})]}),t.jsxs("div",{children:[t.jsx("h3",{className:"text-lg font-semibold text-slate-200 mb-6",children:"Armaduras"}),t.jsx("div",{className:"grid grid-cols-2 gap-6",children:[0,1,2,3].map((e=>t.jsx("div",{children:x(e)},`armor-slot-${e}`)))})]}),t.jsxs("div",{children:[t.jsx("h3",{className:"text-lg font-semibold text-slate-200 mb-6",children:"Acessórios"}),t.jsx("div",{className:"grid grid-cols-2 gap-6",children:[0,1,2,3].map((e=>t.jsx("div",{children:f(e)},`accessory-slot-${e}`)))})]}),t.jsx("div",{className:"bg-slate-700/30 p-4 rounded-lg",children:t.jsx("p",{className:"text-sm text-slate-400 text-center",children:"Toque para ver detalhes • Toque e segure para equipar/trocar"})})]})]})},Dx=d("/_authenticated/game/play/hub/equipment")({component:function(){if("/game/play/hub/equipment"===o().pathname)return t.jsx(qx,{});return t.jsx(r,{})},validateSearch:e=>({character:e.character||""})});function qx(){const s=i(),{character:a}=Dx.useSearch(),[r,n]=e.useState(null),[o,l]=e.useState({}),[,c]=e.useState([]),[d,m]=e.useState([]),[u,h]=e.useState(null),[p,x]=e.useState(null),[f,g]=e.useState(!0);e.useEffect((()=>{(async()=>{if(a)try{g(!0);const e=await ta.getCharacter(a);e.success&&e.data&&n(e.data);const t=await Js.getEquippedItems(a);l(t);const s=await Js.getCharacterEquipment(a);c(s);const r=await Xp.getCharacterConsumables(a);r.success&&r.data?(r.data.forEach(((e,t)=>{})),m(r.data)):m([])}catch(e){_.error("Erro ao carregar equipamentos")}finally{g(!1)}})()}),[a]);return f?t.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900 p-4",children:t.jsx("div",{className:"max-w-7xl mx-auto",children:t.jsxs("div",{className:"animate-pulse space-y-6",children:[t.jsx("div",{className:"h-8 bg-slate-700 rounded w-64"}),t.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[t.jsx("div",{className:"h-96 bg-slate-700 rounded"}),t.jsx("div",{className:"h-96 bg-slate-700 rounded"})]})]})})}):r?t.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900 p-4",children:t.jsxs("div",{className:"max-w-7xl mx-auto space-y-6",children:[t.jsx("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-4",children:t.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center gap-2 sm:gap-4",children:[t.jsxs(Da,{variant:"outline",size:"sm",onClick:()=>s({to:"/game/play/hub",search:{character:a}}),className:"w-fit",children:[t.jsx(Te,{className:"h-4 w-4 mr-2"}),"Voltar"]}),t.jsxs("div",{className:"mt-2 sm:mt-0",children:[t.jsxs("h1",{className:"text-2xl sm:text-3xl font-bold text-slate-100 flex items-center gap-2",children:[t.jsx($e,{className:"h-6 sm:h-8 w-6 sm:w-8 text-amber-400"}),"Equipamentos"]}),t.jsxs("p",{className:"text-sm sm:text-base text-slate-400",children:[r.name," - Nível ",r.level]})]})]})}),t.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[t.jsxs("div",{className:"space-y-6",children:[t.jsx(Rx,{equippedSlots:o,onSlotClick:(e,t)=>{h(e),x(t)},onSlotLongPress:e=>{s({to:"/game/play/hub/equipment/select",search:{character:a,slot:e}})}}),t.jsxs(rh,{className:"bg-slate-800/50 border-slate-700/50",children:[t.jsx(nh,{children:t.jsxs(ih,{className:"text-slate-100 flex items-center gap-2",children:[t.jsx(qe,{className:"h-5 w-5 text-blue-400"}),"Slots de Poções"]})}),t.jsx(lh,{children:t.jsx(Px,{characterId:a,consumables:d,onSlotsUpdate:async()=>{if(a)try{const e=await Xp.getCharacterConsumables(a);e.success&&e.data&&m(e.data)}catch(e){}}})})]})]}),t.jsx("div",{children:t.jsx(Tx,{selectedItem:p,selectedSlot:u,character:r,onEquipmentChange:async()=>{if(a)try{const e=await Js.getEquippedItems(a);l(e);const t=await Js.getCharacterEquipment(a);c(t)}catch(e){}}})})]})]})}):t.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900 p-4",children:t.jsx("div",{className:"max-w-7xl mx-auto",children:t.jsxs("div",{className:"text-center py-12",children:[t.jsx("h1",{className:"text-2xl font-bold text-slate-100 mb-4",children:"Personagem não encontrado"}),t.jsxs(Da,{onClick:()=>s({to:"/game/play/hub",search:{character:a}}),children:[t.jsx(Te,{className:"h-4 w-4 mr-2"}),"Voltar ao Hub"]})]})})})}const $x=({recipe:e,onCraft:s,isCrafting:a,selectedCharacter:r})=>{if(!e)return t.jsxs("div",{className:"h-full flex flex-col items-center justify-center text-center p-6 bg-muted/10 rounded-lg border-2 border-dashed border-muted",children:[t.jsx(_t,{className:"h-16 w-16 text-muted-foreground mb-4"}),t.jsx("h3",{className:"text-lg font-semibold text-muted-foreground mb-2",children:"Selecione uma Receita"}),t.jsx("p",{className:"text-sm text-muted-foreground",children:"Escolha uma receita da lista para ver os detalhes e ingredientes necessários."})]});const n=()=>{if("equipment"===e.craftType){switch(e.result.rarity){case"legendary":return"text-orange-400 bg-orange-500/10 border-orange-500/20";case"epic":return"text-purple-400 bg-purple-500/10 border-purple-500/20";case"rare":return"text-blue-400 bg-blue-500/10 border-blue-500/20";case"uncommon":return"text-green-400 bg-green-500/10 border-green-500/20";default:return"text-gray-400 bg-gray-500/10 border-gray-500/20"}}else{switch(e.result.type){case"elixir":return"text-purple-400 bg-purple-500/10 border-purple-500/20";case"potion":return"text-red-400 bg-red-500/10 border-red-500/20";case"antidote":return"text-green-400 bg-green-500/10 border-green-500/20";default:return"text-blue-400 bg-blue-500/10 border-blue-500/20"}}};return t.jsxs("div",{className:"h-full flex flex-col overflow-hidden",children:[t.jsxs("div",{className:"flex items-start gap-4 p-6 border-b shrink-0",children:[t.jsx("div",{className:Ta("p-3 rounded-lg border",n()),children:(()=>{if("equipment"===e.craftType){switch(e.result.type){case"weapon":return t.jsx(qe,{className:"h-6 w-6"});case"armor":return t.jsx($e,{className:"h-6 w-6"});case"accessory":return t.jsx(bt,{className:"h-6 w-6"});default:return t.jsx(yt,{className:"h-6 w-6"})}}return t.jsx(ft,{className:"h-6 w-6"})})()}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsxs("div",{className:"flex items-start justify-between gap-2 mb-2",children:[t.jsx("h2",{className:"text-xl font-bold truncate",children:e.result.name}),t.jsxs("div",{className:"flex items-center gap-2 shrink-0",children:[t.jsx(uh,{className:Ta("",n()),children:"equipment"===e.craftType?e.result.rarity:e.result.type}),"equipment"===e.craftType&&e.result.level_requirement&&t.jsxs(uh,{variant:"outline",children:["Nível ",e.result.level_requirement]})]})]}),t.jsx("p",{className:"text-sm text-muted-foreground leading-relaxed mb-3",children:e.result.description}),"equipment"===e.craftType&&t.jsx("div",{className:"flex items-center gap-2 flex-wrap",children:t.jsx(uh,{variant:"secondary",className:"text-xs",children:(()=>{const t=e,s=t.result.type,a=t.result.weapon_subtype;if("weapon"===s&&a)switch(a){case"sword":return"Espada";case"axe":return"Machado";case"blunt":return"Maça";case"staff":return"Cajado";case"dagger":return"Adaga";default:return"Arma"}else{if("armor"===s)return"Armadura";if("accessory"===s)return"Acessório"}return s})()})})]})]}),"equipment"===e.craftType&&(()=>{const s=e;return(s.result.atk_bonus||0)>0||(s.result.def_bonus||0)>0||(s.result.mana_bonus||0)>0||(s.result.speed_bonus||0)>0||(s.result.hp_bonus||0)>0?t.jsxs("div",{className:"p-6 border-b bg-muted/20 shrink-0",children:[t.jsxs("h3",{className:"text-base font-semibold mb-3 flex items-center gap-2",children:[t.jsx(Oe,{className:"h-4 w-4"}),"Atributos do Equipamento"]}),t.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-3 gap-2",children:[(s.result.atk_bonus||0)>0&&t.jsxs("div",{className:"flex items-center gap-2 p-2 bg-red-500/10 border border-red-500/20 rounded-lg",children:[t.jsx(qe,{className:"w-4 h-4 text-red-400"}),t.jsxs("span",{className:"text-sm font-medium",children:["+",s.result.atk_bonus," ATK"]})]}),(s.result.def_bonus||0)>0&&t.jsxs("div",{className:"flex items-center gap-2 p-2 bg-blue-500/10 border border-blue-500/20 rounded-lg",children:[t.jsx($e,{className:"w-4 h-4 text-blue-400"}),t.jsxs("span",{className:"text-sm font-medium",children:["+",s.result.def_bonus," DEF"]})]}),(s.result.mana_bonus||0)>0&&t.jsxs("div",{className:"flex items-center gap-2 p-2 bg-purple-500/10 border border-purple-500/20 rounded-lg",children:[t.jsx(ft,{className:"w-4 h-4 text-purple-400"}),t.jsxs("span",{className:"text-sm font-medium",children:["+",s.result.mana_bonus," MANA"]})]}),(s.result.speed_bonus||0)>0&&t.jsxs("div",{className:"flex items-center gap-2 p-2 bg-green-500/10 border border-green-500/20 rounded-lg",children:[t.jsx(Ie,{className:"w-4 h-4 text-green-400"}),t.jsxs("span",{className:"text-sm font-medium",children:["+",s.result.speed_bonus," VEL"]})]}),(s.result.hp_bonus||0)>0&&t.jsxs("div",{className:"flex items-center gap-2 p-2 bg-pink-500/10 border border-pink-500/20 rounded-lg",children:[t.jsx(Ue,{className:"w-4 h-4 text-pink-400"}),t.jsxs("span",{className:"text-sm font-medium",children:["+",s.result.hp_bonus," HP"]})]})]})]}):null})(),"equipment"===e.craftType&&(()=>{const s=e,a={id:s.result_equipment_id,name:s.result.name,description:s.result.description,type:s.result.type,rarity:s.result.rarity,weapon_subtype:s.result.weapon_subtype,atk_bonus:s.result.atk_bonus||0,def_bonus:s.result.def_bonus||0,mana_bonus:s.result.mana_bonus||0,speed_bonus:s.result.speed_bonus||0,hp_bonus:s.result.hp_bonus||0,level_requirement:s.result.level_requirement||1,price:0,is_unlocked:!0};return t.jsxs("div",{className:"p-6 border-b bg-muted/10 shrink-0",children:[t.jsx("h3",{className:"text-base font-semibold mb-3",children:"Comparação com Equipamento Atual"}),t.jsx(fx,{characterId:r?.id||"",newEquipment:a,slotType:s.result.type,showTitle:!1,compact:!0})]})})(),t.jsxs("div",{className:"flex-1 p-6 overflow-hidden",children:[t.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[t.jsx("h3",{className:"text-lg font-semibold",children:"equipment"===e.craftType?"Materiais Necessários":"Ingredientes Necessários"}),t.jsxs(uh,{variant:"outline",className:"ml-auto",children:[e.ingredients.length," itens"]})]}),t.jsx("div",{className:"space-y-3 overflow-y-auto max-h-96 pr-2 scrollbar-thin scrollbar-thumb-border scrollbar-track-transparent",children:e.ingredients.map(((e,s)=>{const a=e.have>=e.quantity;return t.jsxs("div",{className:Ta("flex items-center justify-between p-3 rounded-lg border transition-colors",a?"bg-green-500/5 border-green-500/20":"bg-red-500/5 border-red-500/20"),children:[t.jsxs("div",{className:"flex items-center gap-2",children:["equipment"===e.type&&t.jsx(yt,{className:"h-4 w-4 text-blue-400"}),"drop"===e.type&&t.jsx(bt,{className:"h-4 w-4 text-orange-400"}),"consumable"===e.type&&t.jsx(ft,{className:"h-4 w-4 text-purple-400"}),t.jsx("span",{className:"font-medium",children:e.name})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsxs("span",{className:Ta("text-sm font-mono",a?"text-green-400":"text-red-400"),children:[e.have,"/",e.quantity]}),a?t.jsx(Mt,{className:"h-4 w-4 text-green-400"}):t.jsx(Me,{className:"h-4 w-4 text-red-400"})]})]},s)}))})]}),t.jsx("div",{className:"p-6 border-t bg-card/50 shrink-0",children:t.jsx(Da,{onClick:async()=>{e.canCraft&&!a&&await s(e.id,e.craftType)},disabled:!e.canCraft||a,className:Ta("w-full h-12 text-base font-semibold transition-all",e.canCraft&&!a?"bg-emerald-600 hover:bg-emerald-700 text-white":"bg-muted text-muted-foreground cursor-not-allowed"),children:a?t.jsxs(t.Fragment,{children:[t.jsx(Tt,{className:"h-4 w-4 mr-2 animate-spin"}),"equipment"===e.craftType?"Forjando...":"Criando..."]}):e.canCraft?t.jsxs(t.Fragment,{children:[t.jsx(yt,{className:"h-4 w-4 mr-2"}),"equipment"===e.craftType?"Forjar Item":"Criar Item"]}):t.jsxs(t.Fragment,{children:[t.jsx(Me,{className:"h-4 w-4 mr-2"}),"Materiais Insuficientes"]})})})]})},Ix=({recipe:e,isSelected:s,onClick:a})=>t.jsx("div",{onClick:a,className:Ta("p-4 border rounded-lg cursor-pointer transition-all border-l-4",(()=>{if("equipment"===e.craftType){switch(e.result.rarity){case"legendary":return"border-l-orange-500 bg-orange-500/5";case"epic":return"border-l-purple-500 bg-purple-500/5";case"rare":return"border-l-blue-500 bg-blue-500/5";case"uncommon":return"border-l-green-500 bg-green-500/5";default:return"border-l-gray-500 bg-gray-500/5"}}else{switch(e.result.type){case"elixir":return"border-l-purple-500 bg-purple-500/5";case"potion":return"border-l-red-500 bg-red-500/5";case"antidote":return"border-l-green-500 bg-green-500/5";default:return"border-l-blue-500 bg-blue-500/5"}}})(),s?"ring-2 ring-primary border-primary bg-primary/5":"hover:bg-accent/50 hover:border-accent"),children:t.jsxs("div",{className:"flex items-start gap-3",children:[t.jsx("div",{className:"shrink-0 mt-1",children:"equipment"===e.craftType?t.jsx(yt,{className:"h-4 w-4 text-blue-400"}):t.jsx(ft,{className:"h-4 w-4 text-purple-400"})}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[t.jsx("h3",{className:"font-semibold truncate",children:e.result.name}),e.canCraft?t.jsx(Mt,{className:"h-4 w-4 text-green-400 shrink-0"}):t.jsx(Me,{className:"h-4 w-4 text-red-400 shrink-0"})]}),t.jsx("p",{className:"text-sm text-muted-foreground line-clamp-2 mb-2",children:e.result.description}),t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx(uh,{variant:"outline",className:"text-xs",children:"equipment"===e.craftType?e.result.rarity:e.result.type}),t.jsxs("span",{className:"text-xs text-muted-foreground",children:[e.ingredients.length," ingredientes"]})]})]})]})});const Lx=d("/_authenticated/game/play/hub/crafting")({component:function(){const s=i(),{character:a}=Lx.useSearch(),{characters:r,selectedCharacter:n,selectCharacter:o}=Tp(),[l,c]=e.useState(!1),[d,m]=e.useState(!1),[u,h]=e.useState([]),[p,x]=e.useState([]),[f,g]=e.useState({consumables:[],drops:[],equipment:[]}),[b,v]=e.useState([]),[y,j]=e.useState([]),[N,w]=e.useState([]),[C,E]=e.useState([]),[S,k]=e.useState(null),[P,A]=e.useState(!1),[M,T]=e.useState(""),[R,D]=e.useState("all"),[q,$]=e.useState("all"),[I,L]=e.useState("all"),[V,F]=e.useState("all"),[O,z]=e.useState("all");e.useEffect((()=>{A(!0)}),[]),e.useEffect((()=>{if(P&&a&&r.length>0){const e=r.find((e=>e.id===a));!e||n&&n.id===a||o(e)}}),[P,a,r.length]),e.useEffect((()=>{if(!P||!n)return;(async()=>{c(!0);try{const[e,t,s,a,r,i,o,l]=await Promise.all([Xp.getCraftingRecipes(),Js.getEquipmentCraftingRecipes(),Xp.getCharacterConsumables(n.id),Xp.getCharacterDrops(n.id),Js.getCharacterEquipment(n.id),Xp.getAvailableConsumables(),Xp.getMonsterDrops(),Js.getAllEquipments()]);e.success&&e.data&&h(e.data),t.success&&t.data&&x(t.data),g({consumables:s.success&&s.data||[],drops:a.success&&a.data||[],equipment:r||[]}),i.success&&i.data&&v(i.data),o.success&&o.data&&j(o.data),l&&Array.isArray(l)&&w(l)}catch(e){_.error("Erro ao carregar receitas e inventário")}finally{c(!1)}})()}),[P,n]),e.useEffect((()=>{if(!P||!u.length&&!p.length||!n)return;(()=>{const e=[];for(const s of u)try{const t=f.consumables.find((e=>e.consumable_id===s.result_id))?.consumable,a={name:s.name,description:s.description,type:"potion"};t&&(a.name=t.name,a.description=t.description,a.type=t.type);const r=s.ingredients.map((e=>{let t="",s=0,a="drop";if("monster_drop"===e.item_type){const r=f.drops.find((t=>t.drop_id===e.item_id));if(s=r?.quantity||0,a="drop",r?.drop?.name)t=r.drop.name;else{const s=y.find((t=>t.id===e.item_id));t=s?.name||`Drop ID: ${e.item_id}`}}else if("consumable"===e.item_type){const r=f.consumables.find((t=>t.consumable_id===e.item_id));if(s=r?.quantity||0,a="consumable",r?.consumable?.name)t=r.consumable.name;else{const s=b.find((t=>t.id===e.item_id));t=s?.name||`Consumível ID: ${e.item_id}`}}else if("equipment"===e.item_type){const r=f.equipment.filter((t=>t.equipment_id===e.item_id&&!t.is_equipped));if(s=r.length,a="equipment",r[0]?.equipment?.name)t=r[0].equipment.name;else{const s=N.find((t=>t.id===e.item_id));t=s?.name||`Equipamento ID: ${e.item_id}`}}return{name:t,quantity:e.quantity,have:s,type:a}})),n=r.every((e=>e.have>=e.quantity));e.push({id:s.id,result_id:s.result_id,result:a,ingredients:r,canCraft:n,craftType:"consumable"})}catch(t){}for(const s of p)try{if(s.equipment){const t=s.ingredients.map((e=>{let t="",s=0,a="drop";if("monster_drop"===e.item_type){const r=f.drops.find((t=>t.drop_id===e.item_id));if(s=r?.quantity||0,a="drop",r?.drop?.name)t=r.drop.name;else{const s=y.find((t=>t.id===e.item_id));t=s?.name||`Drop ID: ${e.item_id}`}}else if("consumable"===e.item_type){const r=f.consumables.find((t=>t.consumable_id===e.item_id));if(s=r?.quantity||0,a="consumable",r?.consumable?.name)t=r.consumable.name;else{const s=b.find((t=>t.id===e.item_id));t=s?.name||`Consumível ID: ${e.item_id}`}}else if("equipment"===e.item_type){const r=f.equipment.filter((t=>t.equipment_id===e.item_id&&!t.is_equipped));if(s=r.length,a="equipment",r[0]?.equipment?.name)t=r[0].equipment.name;else{const s=N.find((t=>t.id===e.item_id));t=s?.name||`Equipamento ID: ${e.item_id}`}}return{name:t,quantity:e.quantity,have:s,type:a}})),a=t.every((e=>e.have>=e.quantity));e.push({id:s.id,result_equipment_id:s.result_equipment_id,result:{name:s.equipment.name,description:s.equipment.description,type:s.equipment.type,rarity:s.equipment.rarity,weapon_subtype:s.equipment.weapon_subtype||void 0,atk_bonus:s.equipment.atk_bonus||0,def_bonus:s.equipment.def_bonus||0,mana_bonus:s.equipment.mana_bonus||0,speed_bonus:s.equipment.speed_bonus||0,hp_bonus:0,level_requirement:s.equipment.level_requirement||1},ingredients:t,canCraft:a,craftType:"equipment"})}}catch(t){}if(E(e),S){const t=e.find((e=>e.id===S.id));t&&k(t)}})()}),[P,u,p,f,n,S?.id,b,y,N]);const B=e.useMemo((()=>{let e=C;return M&&(e=e.filter((e=>e.result.name.toLowerCase().includes(M.toLowerCase())||e.result.description.toLowerCase().includes(M.toLowerCase())))),"all"!==R&&(e=e.filter((e=>e.craftType===R))),"all"!==I&&(e=e.filter((e=>{if("equipment"===e.craftType){return e.result.type===I}return!0}))),"all"!==V&&(e=e.filter((e=>{if("equipment"===e.craftType){return e.result.weapon_subtype===V}return!0}))),"all"!==O&&(e=e.filter((e=>{if("equipment"===e.craftType){return e.result.rarity===O}return e.result.type===O}))),"craftable"===q?e=e.filter((e=>e.canCraft)):"missing"===q&&(e=e.filter((e=>!e.canCraft))),e}),[C,M,R,q,I,V,O]);return P?a&&""!==a.trim()?n?t.jsxs("div",{className:"container mx-auto py-6 px-4 max-w-7xl",children:[t.jsx("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-4 mb-6",children:t.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center gap-2 sm:gap-4",children:[t.jsxs(Da,{variant:"outline",size:"sm",onClick:()=>s({to:"/game/play/hub",search:{character:n.id}}),className:"w-fit",children:[t.jsx(Te,{className:"h-4 w-4 mr-2"}),"Voltar ao Hub"]}),t.jsxs("div",{className:"mt-2 sm:mt-0",children:[t.jsx("h1",{className:"text-2xl sm:text-3xl font-bold",children:"Forja de Artefatos"}),t.jsx("p",{className:"text-sm sm:text-base text-muted-foreground",children:"Crie poções, elixires e forje equipamentos únicos com materiais raros"})]})]})}),t.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-12 gap-6",children:[t.jsx("div",{className:"lg:col-span-5",children:t.jsxs(rh,{className:"h-full max-h-[calc(100vh-280px)]",children:[t.jsxs(nh,{className:"pb-4",children:[t.jsxs("div",{className:"flex items-center justify-between mb-4",children:[t.jsxs(ih,{className:"flex items-center gap-2",children:[t.jsx(yt,{className:"h-5 w-5"}),"Receitas Disponíveis"]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsxs(uh,{variant:"outline",children:[B.length," de ",C.length]}),(M||"all"!==R||"all"!==q||"all"!==I||"all"!==V||"all"!==O)&&t.jsx(Da,{variant:"ghost",size:"sm",onClick:()=>{T(""),D("all"),$("all"),L("all"),F("all"),z("all")},className:"h-6 px-2 text-xs",children:"Limpar Filtros"})]})]}),t.jsxs("div",{className:"space-y-3",children:[t.jsxs("div",{className:"relative",children:[t.jsx(He,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),t.jsx(jr,{placeholder:"Buscar receita...",value:M,onChange:e=>T(e.target.value),className:"pl-9"})]}),t.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[t.jsxs(Ju,{value:R,onValueChange:e=>{D(e),"equipment"!==e&&(L("all"),F("all"),z("all"))},children:[t.jsx(Qu,{children:t.jsx(Zu,{placeholder:"Tipo"})}),t.jsxs(sh,{children:[t.jsx(ah,{value:"all",children:"Todos os Tipos"}),t.jsx(ah,{value:"equipment",children:"Equipamentos"}),t.jsx(ah,{value:"consumable",children:"Consumíveis"})]})]}),t.jsxs(Ju,{value:q,onValueChange:e=>$(e),children:[t.jsx(Qu,{children:t.jsx(Zu,{placeholder:"Status"})}),t.jsxs(sh,{children:[t.jsx(ah,{value:"all",children:"Todos"}),t.jsx(ah,{value:"craftable",children:"Criáveis"}),t.jsx(ah,{value:"missing",children:"Faltam Materiais"})]})]})]}),"equipment"===R&&t.jsxs("div",{className:"space-y-2",children:[t.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[t.jsxs(Ju,{value:I,onValueChange:e=>{L(e),"weapon"!==e&&F("all")},children:[t.jsx(Qu,{children:t.jsx(Zu,{placeholder:"Tipo de Equipamento"})}),t.jsxs(sh,{children:[t.jsx(ah,{value:"all",children:"Todos Equipamentos"}),t.jsx(ah,{value:"weapon",children:"Armas"}),t.jsx(ah,{value:"armor",children:"Armaduras"}),t.jsx(ah,{value:"accessory",children:"Acessórios"})]})]}),t.jsxs(Ju,{value:O,onValueChange:e=>z(e),children:[t.jsx(Qu,{children:t.jsx(Zu,{placeholder:"Raridade"})}),t.jsxs(sh,{children:[t.jsx(ah,{value:"all",children:"Todas Raridades"}),t.jsx(ah,{value:"common",children:"Comum"}),t.jsx(ah,{value:"uncommon",children:"Incomum"}),t.jsx(ah,{value:"rare",children:"Raro"}),t.jsx(ah,{value:"epic",children:"Épico"}),t.jsx(ah,{value:"legendary",children:"Lendário"})]})]})]}),"weapon"===I&&t.jsxs(Ju,{value:V,onValueChange:e=>F(e),children:[t.jsx(Qu,{children:t.jsx(Zu,{placeholder:"Tipo de Arma"})}),t.jsxs(sh,{children:[t.jsx(ah,{value:"all",children:"Todas as Armas"}),t.jsx(ah,{value:"sword",children:"Espadas"}),t.jsx(ah,{value:"axe",children:"Machados"}),t.jsx(ah,{value:"blunt",children:"Maças"}),t.jsx(ah,{value:"staff",children:"Cajados"}),t.jsx(ah,{value:"dagger",children:"Adagas"})]})]})]})]})]}),t.jsx(lh,{className:"flex-1 overflow-hidden",children:l?t.jsxs("div",{className:"flex items-center justify-center h-64",children:[t.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-2 border-primary border-t-transparent"}),t.jsx("span",{className:"ml-2 text-muted-foreground",children:"Carregando receitas..."})]}):B.length>0?t.jsx("div",{className:"space-y-2 h-full max-h-96 overflow-y-auto pr-2 scrollbar-thin scrollbar-thumb-border scrollbar-track-transparent",children:B.map((e=>t.jsx(Ix,{recipe:e,isSelected:S?.id===e.id,onClick:()=>k(e)},e.id)))}):t.jsxs("div",{className:"flex flex-col items-center justify-center h-64 text-center",children:[t.jsx(Et,{className:"h-12 w-12 text-muted-foreground mb-3"}),t.jsx("p",{className:"text-muted-foreground text-lg",children:"Nenhuma receita encontrada"}),t.jsx("p",{className:"text-muted-foreground text-sm mt-1",children:"Tente ajustar os filtros ou explore a torre para encontrar novas receitas"})]})})]})}),t.jsx("div",{className:"lg:col-span-7",children:t.jsx(rh,{className:"h-full max-h-[calc(100vh-280px)]",children:t.jsx($x,{recipe:S,onCraft:async(e,t)=>{if(n&&!d){m(!0);try{let s;if(s="consumable"===t?await Xp.craftItem(n.id,e):await Js.craftEquipment(n.id,e),s.success){_.success("Item criado com sucesso!",{description:s.data?.message});const[e,t,a]=await Promise.all([Xp.getCharacterConsumables(n.id),Xp.getCharacterDrops(n.id),Js.getCharacterEquipment(n.id)]);g({consumables:e.success?e.data||[]:f.consumables,drops:t.success?t.data||[]:f.drops,equipment:a||f.equipment})}else _.error("Erro ao criar item",{description:s.error})}catch(s){_.error("Erro ao criar item")}finally{m(!1)}}},isCrafting:d,selectedCharacter:n})})})]})]}):t.jsx("div",{className:"container mx-auto py-6 text-center",children:t.jsx("p",{children:"Carregando personagem..."})}):t.jsxs("div",{className:"container mx-auto py-6 text-center",children:[t.jsx("p",{children:"Redirecionando para seleção de personagem..."}),t.jsx(Da,{onClick:()=>s({to:"/game/play"}),children:"Selecionar Personagem"})]}):t.jsx("div",{className:"container mx-auto py-6 text-center",children:t.jsx("p",{children:"Carregando..."})})},validateSearch:e=>{const t=e.character;return t&&"string"==typeof t?{character:t.trim()}:{character:""}}});function Vx(){const[t,s]=e.useState(!1);return e.useEffect((()=>{if("undefined"==typeof window)return;const e=()=>{const e=window.innerWidth,t=window.innerHeight;s(e>t&&t<=500&&e<=1024)};return e(),window.addEventListener("resize",e),window.addEventListener("orientationchange",(()=>{setTimeout(e,100)})),()=>{window.removeEventListener("resize",e),window.removeEventListener("orientationchange",e)}}),[]),t}function Fx({icon:s,label:a,value:r,color:n,bgColor:i,borderColor:o,tooltipData:l}){const[c,d]=e.useState(!1),m=function(t){const[s,a]=e.useState(!1);return e.useEffect((()=>{if("undefined"==typeof window)return;const e=window.matchMedia(t);a(e.matches);const s=e=>{a(e.matches)};return e.addEventListener?e.addEventListener("change",s):e.addListener(s),()=>{e.removeEventListener?e.removeEventListener("change",s):e.removeListener(s)}}),[t]),s}("(max-width: 768px)"),{elementRef:u,tooltipPosition:h,updatePosition:p}=function(){const t=e.useRef(null),[s,a]=e.useState("right"),r=e.useCallback((()=>{if(!t.current)return;const e=t.current,s=e.getBoundingClientRect();let r=e.parentElement;for(;r&&!r.classList.contains("grid");)r=r.parentElement;if(!r)return void a("right");const n=r.getBoundingClientRect(),i=n.width,o=s.left+s.width/2-n.left;a(o<i/3?"right":o>2*i/3?"left":"bottom")}),[]);return e.useEffect((()=>{r();const e=()=>r();return window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)}),[r]),{elementRef:t,tooltipPosition:s,updatePosition:r}}(),x=()=>t.jsxs("div",{className:"bg-slate-900 border border-slate-700 rounded-lg p-3 shadow-xl",children:[t.jsx("div",{className:"text-sm font-medium text-slate-200 mb-2",children:l.title}),t.jsxs("div",{className:"text-xs text-slate-300 font-mono space-y-1",children:[l.calculations.map(((e,s)=>t.jsxs("div",{className:"flex justify-between",children:[t.jsx("span",{children:e.label}),t.jsx("span",{className:e.color,children:e.value})]},s))),t.jsxs("div",{className:"border-t border-slate-600 pt-1 mt-1 flex justify-between font-bold",children:[t.jsx("span",{children:l.total.label}),t.jsx("span",{className:l.total.color,children:l.total.value})]})]})]});return t.jsxs(t.Fragment,{children:[t.jsxs("div",{ref:u,className:`p-3 rounded-lg border ${i} ${o} ${m?"cursor-pointer":"cursor-help group"} relative`,onClick:()=>{m&&d(!0)},onMouseEnter:()=>{m||p()},title:m?`Toque para ver a fórmula de ${a}`:"Clique para ver a fórmula",children:[t.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[t.jsx(s,{className:`h-4 w-4 ${n}`}),t.jsx("span",{className:`text-sm font-medium ${n}`,children:a})]}),t.jsx("div",{className:`text-2xl font-bold ${n}`,children:"number"==typeof r?r.toLocaleString():r}),!m&&t.jsx("div",{className:"absolute z-50 invisible group-hover:visible min-w-[280px] "+("left"===h?"right-full mr-2 -top-2":"right"===h?"left-full ml-2 -top-2":"top-full mt-2 left-1/2 transform -translate-x-1/2"),children:t.jsx(x,{})})]}),m&&t.jsx(Kh,{open:c,onOpenChange:d,children:t.jsxs(Qh,{className:"max-w-sm",children:[t.jsx(ep,{children:t.jsxs(sp,{className:"flex items-center gap-2",children:[t.jsx(s,{className:`h-5 w-5 ${n}`}),"Fórmula de ",a]})}),t.jsxs("div",{className:"space-y-2",children:[l.calculations.map(((e,s)=>t.jsxs("div",{className:"flex justify-between text-sm",children:[t.jsx("span",{className:"text-muted-foreground",children:e.label}),t.jsx("span",{className:`font-mono ${e.color}`,children:e.value})]},s))),t.jsxs("div",{className:"border-t pt-2 flex justify-between font-bold",children:[t.jsx("span",{children:l.total.label}),t.jsx("span",{className:`${l.total.color}`,children:l.total.value})]})]})]})})]})}function Ox({characterStats:e}){const s=e.strength||10,a=e.dexterity||10,r=e.intelligence||10,n=e.wisdom||10,i=e.vitality||10,o=e.luck||10,l=e.level,c=s+a+r+n+i+o,d=1-(Math.abs(s/c-1/6)+Math.abs(a/c-1/6)+Math.abs(r/c-1/6)+Math.abs(n/c-1/6)+Math.abs(i/c-1/6)+Math.abs(o/c-1/6))/2,m=1+.2*d;let u=1;const h=Math.max(s/c,a/c,r/c,n/c,i/c,o/c);h>.8&&(u=.7);const p=Math.pow(s,1.2)*m*u,x=Math.pow(a,1.15)*m*u,f=Math.pow(r,1.25)*m*u,g=Math.pow(n,1.1)*m*u,b=Math.pow(i,1.3)*m*u,v=o*m*u,y=e.sword_mastery||1,j=e.axe_mastery||1,N=e.blunt_mastery||1,w=e.defense_mastery||1,_=e.magic_mastery||1,C=Math.pow(Math.max(y,j,N),1.1)*m,E=Math.pow(w,1.2)*m,S=Math.pow(_,1.15)*m,k=20+1*l,P=2+l,A=1+l,M=3+l,T=50+2*l,R=Math.floor(2.5*b),D=Math.floor(.3*p),q=T+R+D,$=k,I=Math.floor(1.5*f),L=Math.floor(1*g),V=Math.floor(.8*S),F=$+I+L+V,O=P,z=Math.floor(1.2*p),B=Math.floor(.6*C),U=Math.floor(.2*x),H=O+z+B+U,G=P,W=Math.floor(1.4*f),X=Math.floor(.8*g),Y=Math.floor(1*S),K=G+W+X+Y,J=A,Z=Math.floor(.6*b),Q=Math.floor(.5*g),ee=Math.floor(1*E),te=J+Z+Q+ee,se=M,ae=Math.floor(1*x),re=Math.floor(.2*v),ne=se+ae+re,ie=.25*x,oe=.35*v,le=.1*p,ce=Math.min(75,ie+oe+le),de=.4*p,me=.6*v,ue=.3*C,he=Math.min(250,130+de+me+ue),pe=1.2*f,xe=.8*g,fe=1.5*S;let ge=pe+xe+fe;ge>100&&(ge=100+.7*(ge-100));const be=Math.min(200,ge),ve=(e,s)=>{const a=s||0,r=e+a;return a>0?t.jsxs("span",{children:[r.toLocaleString(),t.jsxs("span",{className:"text-orange-400 text-sm ml-1 font-medium",children:["(+",a,")"]})]}):t.jsx("span",{children:r.toLocaleString()})},ye=(e,t,s,a)=>{const r=[...t];return r.push({label:`Diversidade da Build: ${(100*d).toFixed(1)}%`,value:`Bônus: ${(100*(m-1)).toFixed(1)}%`,color:d>.7?"text-green-400":d>.4?"text-yellow-400":"text-orange-400"}),u<1&&r.push({label:"Penalidade Mono-Build:",value:`-${(100*(1-u)).toFixed(0)}%`,color:"text-red-400"}),s>0&&r.push({label:"Bônus Equipamentos:",value:`+${s}`,color:"text-orange-400"}),{title:e,calculations:r,total:{label:"Total Final (Sistema):",value:a.toLocaleString(),color:"text-green-400"}}},je=[{icon:Ue,label:"HP Máximo",value:ve(e.max_hp-(e.equipment_hp_bonus||0),e.equipment_hp_bonus),color:"text-red-400",bgColor:"bg-red-500/5",borderColor:"border-red-500/20",tooltipData:ye("Cálculo Exato do HP:",[{label:`Base (50 + 2×${l}):`,value:T,color:"text-blue-400"},{label:"Vitalidade^1.3 × 2.5:",value:`+${R} (${i}^1.3)`,color:"text-pink-400"},{label:"Força^1.2 × 0.3:",value:`+${D} (${s}^1.2)`,color:"text-red-400"},{label:"Subtotal Calculado:",value:q,color:"text-gray-300"}],e.equipment_hp_bonus||0,e.max_hp)},{icon:Rt,label:"Mana Máxima",value:ve(e.max_mana-(e.equipment_mana_bonus||0),e.equipment_mana_bonus),color:"text-blue-400",bgColor:"bg-blue-500/5",borderColor:"border-blue-500/20",tooltipData:ye("Cálculo Exato da Mana:",[{label:`Base (20 + 1×${l}):`,value:$,color:"text-blue-400"},{label:"Inteligência^1.25 × 1.5:",value:`+${I} (${r}^1.25)`,color:"text-purple-400"},{label:"Sabedoria^1.1 × 1.0:",value:`+${L} (${n}^1.1)`,color:"text-blue-300"},{label:"Maestria Mágica^1.15 × 0.8:",value:`+${V} (${_}^1.15)`,color:"text-cyan-400"},{label:"Subtotal Calculado:",value:F,color:"text-gray-300"}],e.equipment_mana_bonus||0,e.max_mana)},{icon:qe,label:"ATK Físico",value:ve(e.atk-(e.equipment_atk_bonus||0),e.equipment_atk_bonus),color:"text-red-400",bgColor:"bg-red-500/5",borderColor:"border-red-500/20",tooltipData:ye("Cálculo Exato do ATK Físico:",[{label:`Base (2 + ${l}):`,value:O,color:"text-blue-400"},{label:"Força^1.2 × 1.2:",value:`+${z} (${s}^1.2)`,color:"text-red-400"},{label:"Maior Maestria^1.1 × 0.6:",value:`+${B} (${Math.max(y,j,N)}^1.1)`,color:"text-orange-400"},{label:"Destreza^1.15 × 0.2:",value:`+${U} (${a}^1.15)`,color:"text-green-400"},{label:"Subtotal Calculado:",value:H,color:"text-gray-300"}],e.equipment_atk_bonus||0,e.atk)},...e.magic_attack&&e.magic_attack>0?[{icon:ft,label:"ATK Mágico",value:t.jsx("span",{children:e.magic_attack.toLocaleString()}),color:"text-purple-400",bgColor:"bg-purple-500/5",borderColor:"border-purple-500/20",tooltipData:ye("Cálculo Exato do ATK Mágico:",[{label:`Base (2 + ${l}):`,value:G,color:"text-blue-400"},{label:"Inteligência^1.25 × 1.4:",value:`+${W} (${r}^1.25)`,color:"text-purple-400"},{label:"Sabedoria^1.1 × 0.8:",value:`+${X} (${n}^1.1)`,color:"text-blue-300"},{label:"Maestria Mágica^1.15 × 1.0:",value:`+${Y} (${_}^1.15)`,color:"text-cyan-400"},{label:"Subtotal Calculado:",value:K,color:"text-gray-300"}],0,e.magic_attack)}]:[],{icon:$e,label:"Defesa",value:ve(e.def-(e.equipment_def_bonus||0),e.equipment_def_bonus),color:"text-blue-400",bgColor:"bg-blue-500/5",borderColor:"border-blue-500/20",tooltipData:ye("Cálculo Exato da Defesa:",[{label:`Base (1 + ${l}):`,value:J,color:"text-blue-400"},{label:"Vitalidade^1.3 × 0.6:",value:`+${Z} (${i}^1.3)`,color:"text-pink-400"},{label:"Sabedoria^1.1 × 0.5:",value:`+${Q} (${n}^1.1)`,color:"text-blue-300"},{label:"Maestria Defesa^1.2 × 1.0:",value:`+${ee} (${w}^1.2)`,color:"text-cyan-400"},{label:"Subtotal Calculado:",value:te,color:"text-gray-300"}],e.equipment_def_bonus||0,e.def)},{icon:Ie,label:"Velocidade",value:ve(e.speed-(e.equipment_speed_bonus||0),e.equipment_speed_bonus),color:"text-yellow-400",bgColor:"bg-yellow-500/5",borderColor:"border-yellow-500/20",tooltipData:ye("Cálculo Exato da Velocidade:",[{label:`Base (3 + ${l}):`,value:se,color:"text-blue-400"},{label:"Destreza^1.15 × 1.0:",value:`+${ae} (${a}^1.15)`,color:"text-green-400"},{label:"Sorte × 0.2:",value:`+${re} (${o})`,color:"text-yellow-300"},{label:"Subtotal Calculado:",value:ne,color:"text-gray-300"}],e.equipment_speed_bonus||0,e.speed)},{icon:gt,label:"Chance Crítica",value:t.jsxs("span",{children:[e.critical_chance.toFixed(1),"%"]}),color:"text-yellow-400",bgColor:"bg-yellow-500/5",borderColor:"border-yellow-500/20",tooltipData:ye("Cálculo Exato da Chance Crítica:",[{label:"Destreza^1.15 × 0.25:",value:`${ie.toFixed(1)}% (${a}^1.15)`,color:"text-green-400"},{label:"Sorte × 0.35:",value:`+${oe.toFixed(1)}% (${o})`,color:"text-yellow-300"},{label:"Força^1.2 × 0.1:",value:`+${le.toFixed(1)}% (${s}^1.2)`,color:"text-red-400"},{label:"Cap Máximo: 75%",value:"",color:"text-orange-400"},{label:"Valor Calculado:",value:`${ce.toFixed(1)}%`,color:"text-gray-300"}],0,e.critical_chance)},{icon:vt,label:"Dano Crítico",value:t.jsxs("span",{children:[e.critical_damage.toFixed(0),"%"]}),color:"text-orange-400",bgColor:"bg-orange-500/5",borderColor:"border-orange-500/20",tooltipData:ye("Cálculo Exato do Dano Crítico:",[{label:"Base:",value:"130%",color:"text-blue-400"},{label:"Força^1.2 × 0.4:",value:`+${de.toFixed(1)}% (${s}^1.2)`,color:"text-red-400"},{label:"Sorte × 0.6:",value:`+${me.toFixed(1)}% (${o})`,color:"text-yellow-300"},{label:"Maior Maestria^1.1 × 0.3:",value:`+${ue.toFixed(1)}% (${Math.max(y,j,N)}^1.1)`,color:"text-orange-400"},{label:"Cap Máximo: 250%",value:"",color:"text-orange-400"},{label:"Valor Calculado:",value:`${he.toFixed(0)}%`,color:"text-gray-300"}],0,e.critical_damage)},{icon:ft,label:"Bônus Mágico",value:t.jsxs("span",{children:["+",Math.round(e.magic_damage_bonus),"%"]}),color:"text-purple-400",bgColor:"bg-purple-500/5",borderColor:"border-purple-500/20",tooltipData:ye("Cálculo Exato do Bônus Mágico:",[{label:"Inteligência^1.25 × 1.2:",value:`${pe.toFixed(1)}% (${r}^1.25)`,color:"text-purple-400"},{label:"Sabedoria^1.1 × 0.8:",value:`+${xe.toFixed(1)}% (${n}^1.1)`,color:"text-blue-300"},{label:"Maestria Mágica^1.15 × 1.5:",value:`+${fe.toFixed(1)}% (${_}^1.15)`,color:"text-cyan-400"},{label:"Diminishing Returns após 100%",value:"",color:"text-orange-400"},{label:"Cap Máximo: 200%",value:"",color:"text-orange-400"},{label:"Valor Calculado:",value:`${be.toFixed(1)}%`,color:"text-gray-300"}],0,e.magic_damage_bonus)}];return t.jsxs(rh,{children:[t.jsx(nh,{children:t.jsxs(ih,{className:"flex items-center gap-2",children:[t.jsx(Dt,{className:"h-5 w-5"}),"Stats Derivados"]})}),t.jsxs(lh,{className:"space-y-4 overflow-visible",children:[t.jsx("div",{className:"grid grid-cols-2 lg:grid-cols-3 gap-4 overflow-visible",children:je.map(((e,s)=>t.jsx(Fx,{icon:e.icon,label:e.label,value:e.value,color:e.color,bgColor:e.bgColor,borderColor:e.borderColor,tooltipData:e.tooltipData},s)))}),t.jsxs("div",{className:"mt-6 p-4 bg-slate-800/50 border border-slate-700 rounded-lg",children:[t.jsx("h4",{className:"text-sm font-medium text-slate-200 mb-2",children:"Análise da Build:"}),t.jsxs("div",{className:"grid grid-cols-2 gap-4 text-xs",children:[t.jsxs("div",{children:[t.jsx("span",{className:"text-slate-400",children:"Diversidade:"}),t.jsxs("span",{className:"ml-2 "+(d>.7?"text-green-400":d>.4?"text-yellow-400":"text-orange-400"),children:[(100*d).toFixed(1),"%"]})]}),t.jsxs("div",{children:[t.jsx("span",{className:"text-slate-400",children:"Bônus:"}),t.jsxs("span",{className:"ml-2 text-green-400",children:["+",(100*(m-1)).toFixed(1),"%"]})]}),u<1&&t.jsxs(t.Fragment,{children:[t.jsxs("div",{children:[t.jsx("span",{className:"text-slate-400",children:"Mono-Build:"}),t.jsxs("span",{className:"ml-2 text-red-400",children:["-",(100*(1-u)).toFixed(0),"%"]})]}),t.jsxs("div",{children:[t.jsx("span",{className:"text-slate-400",children:"Dominante:"}),t.jsxs("span",{className:"ml-2 text-yellow-400",children:[(100*h).toFixed(0),"%"]})]})]})]})]})]})]})}const zx=d("/_authenticated/game/play/hub/character-stats")({component:function(){const s=i(),{character:a}=zx.useSearch();const[r,n]=e.useState(null),[o,l]=e.useState(!0),[c,d]=e.useState(!1),[m,u]=e.useState({strength:0,dexterity:0,intelligence:0,wisdom:0,vitality:0,luck:0}),h=e.useCallback((async()=>{if(a&&""!==a.trim())try{l(!0);const e=await ta.getCharacterStats(a);e.success&&e.data?n(e.data):(_.error("Erro ao carregar stats do personagem",{description:e.error}),s({to:"/game/play/hub",search:{character:a}}))}catch(e){_.error("Erro ao carregar stats do personagem"),s({to:"/game/play/hub",search:{character:a}})}finally{l(!1)}else s({to:"/game/play"})}),[a,s]);e.useEffect((()=>{a&&h()}),[a]);const p=Object.values(m).reduce(((e,t)=>e+t),0),x=(r?.attribute_points||0)-p,f=()=>{u({strength:0,dexterity:0,intelligence:0,wisdom:0,vitality:0,luck:0})},g={strength:{label:"Força",icon:Oe,color:"text-red-400",bgColor:"bg-red-500/10",borderColor:"border-red-500/20",description:"Aumenta dano físico e capacidade de carga"},dexterity:{label:"Destreza",icon:Ie,color:"text-green-400",bgColor:"bg-green-500/10",borderColor:"border-green-500/20",description:"Aumenta velocidade e chance de crítico"},intelligence:{label:"Inteligência",icon:ft,color:"text-purple-400",bgColor:"bg-purple-500/10",borderColor:"border-purple-500/20",description:"Aumenta dano mágico e pontos de mana"},wisdom:{label:"Sabedoria",icon:qt,color:"text-blue-400",bgColor:"bg-blue-500/10",borderColor:"border-blue-500/20",description:"Aumenta regeneração de mana e resistência"},vitality:{label:"Vitalidade",icon:Ue,color:"text-pink-400",bgColor:"bg-pink-500/10",borderColor:"border-pink-500/20",description:"Aumenta pontos de vida e regeneração"},luck:{label:"Sorte",icon:gt,color:"text-yellow-400",bgColor:"bg-yellow-500/10",borderColor:"border-yellow-500/20",description:"Aumenta chance de drops raros e críticos"}};if(o)return t.jsx("div",{className:"flex items-center justify-center min-h-screen",children:t.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-purple-500"})});if(!r)return t.jsx("div",{className:"flex items-center justify-center min-h-screen",children:t.jsxs("div",{className:"text-center",children:[t.jsx("h2",{className:"text-2xl font-bold mb-2",children:"Erro ao carregar"}),t.jsx("p",{className:"text-muted-foreground mb-4",children:"Não foi possível carregar os stats do personagem"}),t.jsx(Da,{onClick:()=>s({to:"/game/play/hub",search:{character:a}}),children:"Voltar ao Hub"})]})});return t.jsx("div",{className:"min-h-screen bg-gradient-to-b from-background to-secondary p-4 overflow-visible",children:t.jsxs("div",{className:"max-w-6xl mx-auto space-y-6",children:[t.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[t.jsxs("div",{className:"flex flex-col items-start gap-4",children:[t.jsxs(Da,{variant:"outline",size:"sm",onClick:()=>s({to:"/game/play/hub",search:{character:a}}),className:"w-fit",children:[t.jsx(Te,{className:"h-4 w-4 mr-2"}),"Voltar ao Hub"]}),t.jsxs("div",{children:[t.jsx("h1",{className:"text-2xl sm:text-3xl font-bold",children:"Atributos & Habilidades"}),t.jsx("p",{className:"text-sm text-muted-foreground",children:"Gerencie os stats do seu personagem"})]})]}),r.attribute_points>0&&t.jsxs(uh,{variant:"outline",className:"bg-yellow-500/10 border-yellow-500/30 text-yellow-400 px-3 py-1",children:[t.jsx(gt,{className:"h-4 w-4 mr-2"}),x," pontos disponíveis"]})]}),t.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 overflow-visible",children:[t.jsxs(rh,{children:[t.jsx(nh,{children:t.jsxs(ih,{className:"flex items-center gap-2",children:[t.jsx(Oe,{className:"h-5 w-5"}),"Atributos Primários"]})}),t.jsxs(lh,{className:"space-y-4",children:[Object.entries(g).map((([e,s])=>{const a=e,n=r[a]||0,i=s.icon;return t.jsxs(Ou.div,{className:`flex items-center gap-4 p-4 rounded-lg border ${s.bgColor} ${s.borderColor}`,whileHover:{scale:1.01},children:[t.jsxs("div",{className:"flex items-center gap-3 flex-1",children:[t.jsx(i,{className:`h-5 w-5 ${s.color}`}),t.jsxs("div",{className:"flex-1",children:[t.jsx("div",{className:"font-semibold text-sm",children:s.label}),t.jsx("div",{className:"text-xs text-muted-foreground",children:s.description})]})]}),t.jsxs("div",{className:"text-center min-w-[80px]",children:[t.jsxs("div",{className:"text-lg font-bold",children:[n,m[a]>0&&t.jsxs("span",{className:"text-green-400 ml-1 text-sm",children:["+",m[a]]})]}),t.jsxs("div",{className:"text-xs text-muted-foreground",children:[n+m[a],"/50"]})]}),r.attribute_points>0&&t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(Da,{size:"icon",variant:"ghost",className:"h-8 w-8 rounded-full",onClick:()=>(e=>{m[e]>0&&u((t=>({...t,[e]:t[e]-1})))})(a),disabled:0===m[a],children:t.jsx($t,{className:"h-4 w-4"})}),t.jsx("div",{className:"w-8 text-center text-sm font-mono",children:m[a]}),t.jsx(Da,{size:"icon",variant:"ghost",className:"h-8 w-8 rounded-full",onClick:()=>(e=>{x>0&&u((t=>({...t,[e]:t[e]+1})))})(a),disabled:0===x,children:t.jsx(Ze,{className:"h-4 w-4"})})]})]},a)})),r.attribute_points>0&&p>0&&t.jsx(zl,{children:t.jsxs(Ou.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},className:"border-t pt-4 mt-4",children:[t.jsxs("div",{className:"bg-primary/5 border border-primary/20 rounded-lg p-3 mb-4",children:[t.jsxs("div",{className:"text-sm font-medium mb-2 flex items-center gap-2",children:[t.jsx(ft,{className:"h-4 w-4 text-primary"}),"Preview dos Melhoramentos"]}),t.jsxs("div",{className:"grid grid-cols-2 gap-2 text-xs",children:[m.vitality>0&&t.jsxs("div",{className:"flex justify-between",children:[t.jsx("span",{children:"HP:"}),t.jsxs("span",{className:"text-green-400",children:["+",8*m.vitality]})]}),m.intelligence>0&&t.jsxs("div",{className:"flex justify-between",children:[t.jsx("span",{children:"Mana:"}),t.jsxs("span",{className:"text-blue-400",children:["+",5*m.intelligence]})]}),m.strength>0&&t.jsxs("div",{className:"flex justify-between",children:[t.jsx("span",{children:"Ataque:"}),t.jsxs("span",{className:"text-red-400",children:["+",2*m.strength]})]}),m.dexterity>0&&t.jsxs("div",{className:"flex justify-between",children:[t.jsx("span",{children:"Velocidade:"}),t.jsxs("span",{className:"text-green-400",children:["+",Math.floor(1.5*m.dexterity)]})]})]})]}),t.jsxs("div",{className:"flex gap-2",children:[t.jsxs(Da,{variant:"outline",onClick:f,className:"flex-1",children:[t.jsx(It,{className:"h-4 w-4 mr-2"}),"Resetar"]}),t.jsxs(Da,{onClick:async()=>{if(0!==p&&a){d(!0);try{const e=await ta.distributeAttributePoints(a,m);e.success?(_.success("Pontos distribuídos com sucesso!"),f(),await h()):_.error("Erro ao distribuir pontos",{description:e.error})}catch(e){_.error("Erro ao distribuir pontos")}finally{d(!1)}}},disabled:c,className:"flex-1 bg-emerald-500 hover:bg-emerald-600",children:[c?t.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-2 border-white border-t-transparent mr-2"}):t.jsx(Lt,{className:"h-4 w-4 mr-2"}),"Confirmar"]})]})]})})]})]}),t.jsx(Ox,{characterStats:r}),t.jsxs(rh,{className:"lg:col-span-2",children:[t.jsx(nh,{children:t.jsxs(ih,{className:"flex items-center gap-2",children:[t.jsx(ft,{className:"h-5 w-5"}),"Habilidades de Combate"]})}),t.jsx(lh,{children:t.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:Object.values($s).map((e=>{const s=(e=>{switch(e){case $s.SWORD_MASTERY:return qe;case $s.AXE_MASTERY:return Ie;case $s.BLUNT_MASTERY:return vt;case $s.DEFENSE_MASTERY:return $e;case $s.MAGIC_MASTERY:return ft}})(e),a=r[`${e}_mastery`],n=r[`${e}_mastery_xp`],i=(o=a,Math.floor(50*Math.pow(1.4,o-1)));var o;const l=n/i*100;return t.jsxs("div",{className:"bg-card p-4 rounded-lg border",children:[t.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[t.jsx(s,{className:"h-5 w-5 text-primary"}),t.jsxs("div",{className:"flex-1",children:[t.jsx("h3",{className:"font-semibold capitalize",children:e.replace("_"," ")}),t.jsxs("div",{className:"text-sm text-muted-foreground",children:["Nível ",a]})]})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsxs("div",{className:"flex justify-between text-sm",children:[t.jsxs("span",{children:["XP: ",n,"/",i]}),t.jsxs("span",{children:[Math.round(l),"%"]})]}),t.jsx(vp,{value:l,className:"h-2"})]}),t.jsx("p",{className:"text-xs text-muted-foreground mt-2",children:Is(e)})]},e)}))})})]})]})]})})},validateSearch:e=>{const t=e.character;return t&&"string"==typeof t&&""!==t.trim()?{character:t.trim()}:{character:""}}});function Bx({className:s="",showHeader:a=!0,collapsible:r=!1}){const{user:n}=aa(),[i,o]=e.useState([]),[l,c]=e.useState(null),[d,m]=e.useState(!0),[u,h]=e.useState(1),[p,x]=e.useState(!1),[f,g]=e.useState(0),[b,v]=e.useState(!1),[y,j]=e.useState(null);e.useEffect((()=>{n?.id&&N()}),[n?.id,u]);const N=async()=>{if(n?.id){m(!0);try{const e=await ua.getUserCemetery(n.id,{page:u,limit:6});e.success&&e.data?(o(e.data.characters),c(e.data.stats),g(e.data.total),x(e.data.hasMore)):_.error("Erro ao carregar cemitério",{description:e.error||"Erro desconhecido"})}catch(e){_.error("Erro ao carregar cemitério")}finally{m(!1)}}},w=e=>ua.formatSurvivalTime(e),C=(e,t)=>ua.formatDeathCause(e,t),E=e=>new Date(e).toLocaleDateString("pt-BR",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"});return d&&0===i.length?t.jsxs(rh,{className:s,children:[a&&t.jsx(nh,{className:"pb-4",children:t.jsxs(ih,{className:"flex items-center gap-2",children:[t.jsx(Le,{className:"h-5 w-5 text-red-500"}),"Cemitério"]})}),t.jsx(lh,{children:t.jsx("div",{className:"flex items-center justify-center py-8",children:t.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-red-500"})})})]}):l&&0!==l.total_deaths?t.jsxs(rh,{className:s,children:[a&&t.jsx(nh,{className:"pb-4",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs(ih,{className:"flex items-center gap-2",children:[t.jsx(Le,{className:"h-5 w-5 text-red-500"}),"Cemitério",t.jsxs(uh,{variant:"destructive",className:"ml-2",children:[l.total_deaths," mort",1===l.total_deaths?"e":"es"]})]}),r&&t.jsx(Da,{variant:"ghost",size:"sm",onClick:()=>v(!b),children:b?t.jsx(qt,{className:"h-4 w-4"}):t.jsx(Ge,{className:"h-4 w-4"})})]})}),(!r||!b)&&t.jsxs(lh,{className:"space-y-6",children:[t.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[t.jsxs("div",{className:"bg-red-500/10 border border-red-500/20 rounded-lg p-3 text-center",children:[t.jsx(re,{className:"h-6 w-6 mx-auto mb-2 text-red-400"}),t.jsx("div",{className:"text-sm text-muted-foreground",children:"Maior Nível"}),t.jsx("div",{className:"text-xl font-bold text-red-400",children:l.highest_level_reached})]}),t.jsxs("div",{className:"bg-orange-500/10 border border-orange-500/20 rounded-lg p-3 text-center",children:[t.jsx(vt,{className:"h-6 w-6 mx-auto mb-2 text-orange-400"}),t.jsx("div",{className:"text-sm text-muted-foreground",children:"Maior Andar"}),t.jsx("div",{className:"text-xl font-bold text-orange-400",children:l.highest_floor_reached})]}),t.jsxs("div",{className:"bg-blue-500/10 border border-blue-500/20 rounded-lg p-3 text-center",children:[t.jsx(Vt,{className:"h-6 w-6 mx-auto mb-2 text-blue-400"}),t.jsx("div",{className:"text-sm text-muted-foreground",children:"Tempo Total"}),t.jsxs("div",{className:"text-xl font-bold text-blue-400",children:[l.total_survival_time_hours,"h"]})]}),t.jsxs("div",{className:"bg-purple-500/10 border border-purple-500/20 rounded-lg p-3 text-center",children:[t.jsx(Ft,{className:"h-6 w-6 mx-auto mb-2 text-purple-400"}),t.jsx("div",{className:"text-sm text-muted-foreground",children:"Maior Ameaça"}),t.jsx("div",{className:"text-xs font-bold text-purple-400 truncate",title:l.deadliest_monster,children:l.deadliest_monster})]})]}),t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("h3",{className:"text-lg font-semibold",children:"Personagens Perdidos"}),t.jsxs("div",{className:"text-sm text-muted-foreground",children:[i.length," de ",f]})]}),d?t.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[1,2,3].map((e=>t.jsxs("div",{className:"bg-muted/20 rounded-lg p-4 animate-pulse",children:[t.jsx("div",{className:"h-6 bg-muted/40 rounded w-24 mb-3"}),t.jsxs("div",{className:"space-y-2",children:[t.jsx("div",{className:"h-4 bg-muted/30 rounded w-full"}),t.jsx("div",{className:"h-4 bg-muted/30 rounded w-3/4"})]})]},e)))}):t.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:i.map((e=>t.jsx(rh,{className:"cursor-pointer transition-all duration-200 hover:shadow-lg hover:scale-105 bg-red-500/5 border-red-500/20",onClick:()=>j(e),children:t.jsx(lh,{className:"p-4",children:t.jsxs("div",{className:"space-y-3",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("h4",{className:"font-semibold text-lg truncate",children:e.name}),t.jsxs(uh,{variant:"outline",className:"bg-background/50",children:["Nv ",e.level]})]}),t.jsxs("div",{className:"grid grid-cols-3 gap-2 text-xs",children:[t.jsxs("div",{className:"text-center",children:[t.jsx(qe,{className:"h-3 w-3 mx-auto mb-1 text-red-400"}),t.jsx("div",{className:"text-red-400 font-medium",children:e.atk})]}),t.jsxs("div",{className:"text-center",children:[t.jsx($e,{className:"h-3 w-3 mx-auto mb-1 text-blue-400"}),t.jsx("div",{className:"text-blue-400 font-medium",children:e.def})]}),t.jsxs("div",{className:"text-center",children:[t.jsx(Ie,{className:"h-3 w-3 mx-auto mb-1 text-yellow-400"}),t.jsx("div",{className:"text-yellow-400 font-medium",children:e.speed})]})]}),t.jsxs("div",{className:"space-y-2 text-xs text-muted-foreground",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("span",{children:"Andar alcançado:"}),t.jsx("span",{className:"font-medium text-orange-400",children:e.floor_reached})]}),t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("span",{children:"Tempo de vida:"}),t.jsx("span",{className:"font-medium text-blue-400",children:w(e.survival_time_minutes)})]}),t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("span",{children:"Gold acumulado:"}),t.jsx("span",{className:"font-medium text-yellow-400",children:Gh(e.gold)})]})]}),t.jsxs("div",{className:"bg-red-500/10 border border-red-500/20 rounded p-2",children:[t.jsx("div",{className:"text-xs text-red-400 font-medium",children:C(e.death_cause,e.killed_by_monster)}),t.jsx("div",{className:"text-xs text-muted-foreground mt-1",children:E(e.died_at)})]})]})})},e.id)))})]}),f>6&&t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs(Da,{variant:"outline",size:"sm",onClick:()=>h((e=>Math.max(1,e-1))),disabled:1===u||d,children:[t.jsx(Ge,{className:"h-4 w-4 mr-1"}),"Anterior"]}),t.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:["Página ",u," de ",Math.ceil(f/6)]}),t.jsxs(Da,{variant:"outline",size:"sm",onClick:()=>h((e=>e+1)),disabled:!p||d,children:["Próxima",t.jsx(We,{className:"h-4 w-4 ml-1"})]})]})]}),y&&t.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:t.jsxs(rh,{className:"w-full max-w-2xl max-h-[80vh] overflow-y-auto",children:[t.jsx(nh,{children:t.jsxs(ih,{className:"flex items-center gap-2",children:[t.jsx(Le,{className:"h-5 w-5 text-red-500"}),y.name,t.jsxs(uh,{variant:"outline",className:"ml-2",children:["Nível ",y.level]})]})}),t.jsxs(lh,{className:"space-y-6",children:[t.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4",children:[t.jsxs("div",{className:"bg-red-500/10 border border-red-500/20 rounded p-3 text-center",children:[t.jsx(qe,{className:"h-5 w-5 mx-auto mb-2 text-red-400"}),t.jsx("div",{className:"text-sm text-muted-foreground",children:"Ataque"}),t.jsx("div",{className:"text-xl font-bold text-red-400",children:y.atk})]}),t.jsxs("div",{className:"bg-blue-500/10 border border-blue-500/20 rounded p-3 text-center",children:[t.jsx($e,{className:"h-5 w-5 mx-auto mb-2 text-blue-400"}),t.jsx("div",{className:"text-sm text-muted-foreground",children:"Defesa"}),t.jsx("div",{className:"text-xl font-bold text-blue-400",children:y.def})]}),t.jsxs("div",{className:"bg-yellow-500/10 border border-yellow-500/20 rounded p-3 text-center",children:[t.jsx(Ie,{className:"h-5 w-5 mx-auto mb-2 text-yellow-400"}),t.jsx("div",{className:"text-sm text-muted-foreground",children:"Velocidade"}),t.jsx("div",{className:"text-xl font-bold text-yellow-400",children:y.speed})]}),t.jsxs("div",{className:"bg-green-500/10 border border-green-500/20 rounded p-3 text-center",children:[t.jsx(gt,{className:"h-5 w-5 mx-auto mb-2 text-green-400"}),t.jsx("div",{className:"text-sm text-muted-foreground",children:"HP Máximo"}),t.jsx("div",{className:"text-xl font-bold text-green-400",children:y.max_hp})]}),t.jsxs("div",{className:"bg-purple-500/10 border border-purple-500/20 rounded p-3 text-center",children:[t.jsx(gt,{className:"h-5 w-5 mx-auto mb-2 text-purple-400"}),t.jsx("div",{className:"text-sm text-muted-foreground",children:"Mana Máxima"}),t.jsx("div",{className:"text-xl font-bold text-purple-400",children:y.max_mana})]}),t.jsxs("div",{className:"bg-orange-500/10 border border-orange-500/20 rounded p-3 text-center",children:[t.jsx(vt,{className:"h-5 w-5 mx-auto mb-2 text-orange-400"}),t.jsx("div",{className:"text-sm text-muted-foreground",children:"Andar Alcançado"}),t.jsx("div",{className:"text-xl font-bold text-orange-400",children:y.floor_reached})]})]}),t.jsxs("div",{children:[t.jsx("h3",{className:"text-lg font-semibold mb-3",children:"Atributos Primários"}),t.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[t.jsxs("div",{className:"bg-background/50 rounded p-2 text-center",children:[t.jsx("div",{className:"text-sm text-muted-foreground",children:"Força"}),t.jsx("div",{className:"text-lg font-bold",children:y.strength})]}),t.jsxs("div",{className:"bg-background/50 rounded p-2 text-center",children:[t.jsx("div",{className:"text-sm text-muted-foreground",children:"Destreza"}),t.jsx("div",{className:"text-lg font-bold",children:y.dexterity})]}),t.jsxs("div",{className:"bg-background/50 rounded p-2 text-center",children:[t.jsx("div",{className:"text-sm text-muted-foreground",children:"Inteligência"}),t.jsx("div",{className:"text-lg font-bold",children:y.intelligence})]}),t.jsxs("div",{className:"bg-background/50 rounded p-2 text-center",children:[t.jsx("div",{className:"text-sm text-muted-foreground",children:"Sabedoria"}),t.jsx("div",{className:"text-lg font-bold",children:y.wisdom})]}),t.jsxs("div",{className:"bg-background/50 rounded p-2 text-center",children:[t.jsx("div",{className:"text-sm text-muted-foreground",children:"Vitalidade"}),t.jsx("div",{className:"text-lg font-bold",children:y.vitality})]}),t.jsxs("div",{className:"bg-background/50 rounded p-2 text-center",children:[t.jsx("div",{className:"text-sm text-muted-foreground",children:"Sorte"}),t.jsx("div",{className:"text-lg font-bold",children:y.luck})]})]})]}),t.jsxs("div",{children:[t.jsx("h3",{className:"text-lg font-semibold mb-3",children:"Resumo da Jornada"}),t.jsxs("div",{className:"space-y-3",children:[t.jsxs("div",{className:"flex items-center justify-between p-3 bg-background/50 rounded",children:[t.jsxs("span",{className:"flex items-center gap-2",children:[t.jsx(Tt,{className:"h-4 w-4 text-blue-400"}),"Tempo de sobrevivência"]}),t.jsx("span",{className:"font-medium text-blue-400",children:w(y.survival_time_minutes)})]}),t.jsxs("div",{className:"flex items-center justify-between p-3 bg-background/50 rounded",children:[t.jsxs("span",{className:"flex items-center gap-2",children:[t.jsx(gt,{className:"h-4 w-4 text-yellow-400"}),"XP acumulado"]}),t.jsx("span",{className:"font-medium text-yellow-400",children:Gh(y.xp)})]}),t.jsxs("div",{className:"flex items-center justify-between p-3 bg-background/50 rounded",children:[t.jsxs("span",{className:"flex items-center gap-2",children:[t.jsx(ze,{className:"h-4 w-4 text-yellow-400"}),"Gold acumulado"]}),t.jsx("span",{className:"font-medium text-yellow-400",children:Gh(y.gold)})]})]})]}),t.jsxs("div",{className:"bg-red-500/10 border border-red-500/20 rounded p-4",children:[t.jsx("h3",{className:"text-lg font-semibold mb-2 text-red-400",children:"Fim da Jornada"}),t.jsxs("div",{className:"space-y-2",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(Le,{className:"h-4 w-4 text-red-400"}),t.jsx("span",{className:"font-medium",children:C(y.death_cause,y.killed_by_monster)})]}),t.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[t.jsx(Xe,{className:"h-4 w-4"}),t.jsx("span",{children:E(y.died_at)})]})]})]}),t.jsx("div",{className:"flex justify-end",children:t.jsx(Da,{onClick:()=>j(null),children:"Fechar"})})]})]})})]}):t.jsxs(rh,{className:s,children:[a&&t.jsx(nh,{className:"pb-4",children:t.jsxs(ih,{className:"flex items-center gap-2",children:[t.jsx(Le,{className:"h-5 w-5 text-red-500"}),"Cemitério"]})}),t.jsx(lh,{children:t.jsxs("div",{className:"text-center py-8 space-y-4",children:[t.jsx("div",{className:"text-6xl opacity-50",children:"⚰️"}),t.jsxs("div",{className:"space-y-2",children:[t.jsx("h3",{className:"text-lg font-medium text-muted-foreground",children:"Cemitério Vazio"}),t.jsx("p",{className:"text-sm text-muted-foreground",children:"Nenhum personagem foi perdido ainda. Que a sorte continue com você!"})]})]})})]})}const Ux=d("/_authenticated/game/play/hub/cemetery")({component:function(){const e=i();return t.jsx("div",{className:"min-h-screen bg-gradient-to-b from-background to-secondary",children:t.jsxs("div",{className:"container mx-auto p-4 max-w-6xl",children:[t.jsx("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-4 mb-6",children:t.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center gap-2 sm:gap-4",children:[t.jsxs(Da,{variant:"ghost",onClick:()=>e({to:"/game/play"}),className:"w-fit",children:[t.jsx(Te,{className:"h-4 w-4 mr-2"}),"Voltar à Seleção"]}),t.jsxs("div",{className:"text-center sm:text-left mt-2 sm:mt-0",children:[t.jsx("h1",{className:"text-2xl sm:text-3xl font-bold bg-gradient-to-r from-red-500 to-orange-500 bg-clip-text text-transparent",children:"Cemitério do Tower Trials"}),t.jsx("p",{className:"text-sm sm:text-base text-muted-foreground",children:"Honre a memória dos bravos aventureiros que caíram nas trevas da torre"})]})]})}),t.jsx(Bx,{className:"w-full",showHeader:!1,collapsible:!1})]})})}});const Hx=d("/_authenticated/game/play/hub/equipment/select")({component:function(){const s=i(),{character:a,slot:r}=Hx.useSearch(),[n,o]=e.useState(null),[l,c]=e.useState([]),[d,m]=e.useState([]),[u,h]=e.useState(null),[p,x]=e.useState(!0),[f,g]=e.useState(""),[b,v]=e.useState("all"),[y,j]=e.useState("name"),[N,w]=e.useState(!1);e.useEffect((()=>{(async()=>{if(a&&r)try{x(!0);const e=await ta.getCharacter(a);e.success&&e.data&&o(e.data);const t=await Js.getCharacterEquipment(a);c(t)}catch(e){_.error("Erro ao carregar equipamentos")}finally{x(!1)}else s({to:"/game/play/hub",search:{character:a}})})()}),[a,r,s]),e.useEffect((()=>{const e=l.filter((e=>{if(!e.equipment)return!1;const t=e.equipment;return!!C(t,r)&&(("all"===b||t.type===b)&&!(f&&!t.name.toLowerCase().includes(f.toLowerCase())))}));e.sort(((e,t)=>{const s=e.equipment,a=t.equipment;switch(y){case"name":return s.name.localeCompare(a.name);case"level":return(a.level_requirement||0)-(s.level_requirement||0);case"rarity":{const e={common:1,uncommon:2,rare:3,epic:4,legendary:5};return(e[a.rarity]||0)-(e[s.rarity]||0)}case"attack":return a.atk_bonus-s.atk_bonus;case"defense":return a.def_bonus-s.def_bonus;default:return 0}})),m(e)}),[l,f,b,y,r]);const C=(e,t)=>{switch(t){case"main_hand":case"off_hand":return"weapon"===e.type;case"armor":return"armor"===e.type;case"accessory":return"accessory"===e.type;default:return!1}},E=e=>{switch(e){case"main_hand":return"Mão Principal";case"off_hand":return"Mão Secundária";case"armor":return"Armadura";case"accessory":return"Acessório";default:return e}},S=e=>{switch(e.type){case"weapon":return t.jsx(qe,{className:"h-6 w-6 text-red-400"});case"armor":return t.jsx(At,{className:"h-6 w-6 text-blue-400"});case"accessory":return t.jsx(bt,{className:"h-6 w-6 text-purple-400"});default:return t.jsx($e,{className:"h-6 w-6 text-slate-400"})}},k=e=>{const t={common:"border-slate-600 bg-slate-800/30 text-slate-300",uncommon:"border-emerald-600 bg-emerald-900/30 text-emerald-300",rare:"border-blue-600 bg-blue-900/30 text-blue-300",epic:"border-purple-600 bg-purple-900/30 text-purple-300",legendary:"border-amber-600 bg-amber-900/30 text-amber-300"};return t[e]||t.common};if(p)return t.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900 p-4",children:t.jsx("div",{className:"max-w-7xl mx-auto",children:t.jsxs("div",{className:"animate-pulse space-y-6",children:[t.jsx("div",{className:"h-8 bg-slate-700 rounded w-64"}),t.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[t.jsx("div",{className:"h-96 bg-slate-700 rounded"}),t.jsx("div",{className:"lg:col-span-2 h-96 bg-slate-700 rounded"})]})]})})});if(!n)return t.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900 p-4",children:t.jsx("div",{className:"max-w-7xl mx-auto",children:t.jsxs("div",{className:"text-center py-12",children:[t.jsx("h1",{className:"text-2xl font-bold text-slate-100 mb-4",children:"Personagem não encontrado"}),t.jsxs(Da,{onClick:()=>s({to:"/game/play/hub",search:{character:a}}),children:[t.jsx(Te,{className:"h-4 w-4 mr-2"}),"Voltar ao Hub"]})]})})});return t.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900 p-4",children:t.jsxs("div",{className:"max-w-7xl mx-auto space-y-6",children:[t.jsx("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:t.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center gap-2 sm:gap-4",children:[t.jsxs(Da,{variant:"outline",size:"sm",onClick:()=>s({to:"/game/play/hub/equipment",search:{character:a}}),className:"w-fit",children:[t.jsx(Te,{className:"h-4 w-4 mr-2"}),"Voltar"]}),t.jsxs("div",{className:"mt-2 sm:mt-0",children:[t.jsxs("h1",{className:"text-2xl sm:text-3xl font-bold text-slate-100 flex items-center gap-2",children:[t.jsx(qe,{className:"h-6 sm:h-8 w-6 sm:w-8 text-amber-400"}),t.jsx("span",{className:"hidden sm:inline",children:"Selecionar Equipamento"}),t.jsx("span",{className:"sm:hidden",children:"Equipamentos"})]}),t.jsxs("p",{className:"text-slate-400 text-sm sm:text-base",children:[n.name," - ",E(r)]})]})]})}),t.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[t.jsxs("div",{className:"space-y-4",children:[t.jsxs(rh,{className:"bg-slate-800/50 border-slate-700/50",children:[t.jsx(nh,{className:"pb-3",children:t.jsxs(ih,{className:"text-slate-100 flex items-center gap-2 text-lg",children:[t.jsx(Et,{className:"h-5 w-5 text-amber-400"}),"Filtros"]})}),t.jsxs(lh,{className:"space-y-4",children:[t.jsxs("div",{className:"relative",children:[t.jsx(He,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-slate-500"}),t.jsx(jr,{placeholder:"Buscar equipamento...",value:f,onChange:e=>g(e.target.value),className:"pl-10 bg-slate-700/50 border-slate-600 text-slate-200"})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsx("label",{className:"text-sm font-medium text-slate-300",children:"Tipo"}),t.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-4 lg:grid-cols-2 gap-2",children:[{value:"all",label:"Todos"},{value:"weapon",label:"Armas"},{value:"armor",label:"Armaduras"},{value:"accessory",label:"Acessórios"}].map((e=>t.jsx(Da,{variant:b===e.value?"default":"outline",size:"sm",onClick:()=>v(e.value),className:"text-xs",children:e.label},e.value)))})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsx("label",{className:"text-sm font-medium text-slate-300",children:"Ordenar por"}),t.jsxs("select",{value:y,onChange:e=>j(e.target.value),className:"w-full p-2 rounded-md bg-slate-700/50 border border-slate-600 text-slate-200 text-sm",children:[t.jsx("option",{value:"name",children:"Nome"}),t.jsx("option",{value:"level",children:"Nível"}),t.jsx("option",{value:"rarity",children:"Raridade"}),t.jsx("option",{value:"attack",children:"Ataque"}),t.jsx("option",{value:"defense",children:"Defesa"})]})]})]})]}),t.jsxs(rh,{className:"bg-slate-800/50 border-slate-700/50",children:[t.jsx(nh,{className:"pb-3",children:t.jsxs(ih,{className:"text-slate-100 text-lg",children:["Equipamentos (",d.length,")"]})}),t.jsx(lh,{className:"space-y-3 max-h-[400px] sm:max-h-[500px] lg:max-h-[600px] overflow-y-auto",children:0===d.length?t.jsxs("div",{className:"text-center py-8",children:[t.jsx(_t,{className:"h-12 w-12 mx-auto mb-3 text-slate-600 opacity-50"}),t.jsx("p",{className:"text-slate-500",children:"Nenhum equipamento encontrado"})]}):d.map((e=>{if(!e.equipment)return null;const s=e.equipment,a=u?.id===s.id;return t.jsx("div",{className:"relative cursor-pointer transition-all duration-200 "+(a?"transform scale-[1.02]":"hover:transform hover:scale-[1.01]"),onClick:()=>h(s),children:t.jsx(rh,{className:"border-2 transition-all duration-200 "+(a?"border-amber-400 bg-amber-900/20 shadow-lg shadow-amber-400/20":`${k(s.rarity)} hover:brightness-110`),children:t.jsx(lh,{className:"p-4",children:t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("div",{className:`p-2 rounded-lg ${k(s.rarity)}`,children:S(s)}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsx("h3",{className:"font-medium text-slate-200 truncate",children:s.name}),t.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[t.jsx(uh,{variant:"outline",className:"text-xs",children:s.rarity}),s.level_requirement&&s.level_requirement>1&&t.jsxs(uh,{variant:"outline",className:"text-xs",children:["Nv. ",s.level_requirement]})]}),t.jsxs("div",{className:"flex items-center gap-3 mt-2 text-xs text-slate-400",children:[s.atk_bonus>0&&t.jsxs("span",{className:"flex items-center gap-1",children:[t.jsx(qe,{className:"h-3 w-3 text-red-400"}),"+",s.atk_bonus]}),s.def_bonus>0&&t.jsxs("span",{className:"flex items-center gap-1",children:[t.jsx($e,{className:"h-3 w-3 text-blue-400"}),"+",s.def_bonus]}),s.mana_bonus>0&&t.jsxs("span",{className:"flex items-center gap-1",children:[t.jsx(Ie,{className:"h-3 w-3 text-purple-400"}),"+",s.mana_bonus]})]})]})]})})})},s.id)}))})]})]}),t.jsx("div",{className:"lg:col-span-2",children:t.jsxs(rh,{className:"bg-slate-800/50 border-slate-700/50 h-full min-h-[400px]",children:[t.jsx(nh,{children:t.jsx(ih,{className:"text-slate-100",children:"Detalhes do Equipamento"})}),t.jsx(lh,{className:"h-full",children:(()=>{if(!u)return t.jsx("div",{className:"flex items-center justify-center h-full text-slate-500",children:t.jsxs("div",{className:"text-center",children:[t.jsx(_t,{className:"h-16 w-16 mx-auto mb-4 opacity-50"}),t.jsx("p",{className:"text-lg",children:"Selecione um equipamento"}),t.jsx("p",{className:"text-sm mt-2 opacity-75",children:"Clique em um item para ver os detalhes"})]})});const e=!!n&&n.level>=(u.level_requirement||1);return t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"flex items-start gap-4",children:[t.jsx("div",{className:`p-4 rounded-lg border-2 ${k(u.rarity)}`,children:S(u)}),t.jsxs("div",{className:"flex-1",children:[t.jsx("h2",{className:"text-2xl font-bold text-slate-100 mb-2",children:u.name}),t.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[t.jsx(uh,{className:`border ${k(u.rarity)}`,children:u.rarity}),t.jsx(uh,{variant:"outline",className:"text-slate-300",children:u.type}),"legendary"===u.rarity&&t.jsx(gt,{className:"h-4 w-4 text-amber-400 animate-pulse"})]})]})]}),t.jsx("div",{className:"bg-slate-800/30 border border-slate-700/50 rounded-lg p-4",children:t.jsx("p",{className:"text-slate-300 leading-relaxed",children:u.description})}),t.jsxs("div",{className:"space-y-3",children:[t.jsx("h3",{className:"text-lg font-semibold text-slate-200",children:"Atributos"}),t.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[u.atk_bonus>0&&t.jsxs("div",{className:"bg-red-900/30 border border-red-700/50 rounded-lg p-3",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(qe,{className:"h-4 w-4 text-red-400"}),t.jsx("span",{className:"text-red-300 font-medium",children:"Ataque"})]}),t.jsxs("p",{className:"text-red-200 text-lg font-bold",children:["+",u.atk_bonus]})]}),u.def_bonus>0&&t.jsxs("div",{className:"bg-blue-900/30 border border-blue-700/50 rounded-lg p-3",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx($e,{className:"h-4 w-4 text-blue-400"}),t.jsx("span",{className:"text-blue-300 font-medium",children:"Defesa"})]}),t.jsxs("p",{className:"text-blue-200 text-lg font-bold",children:["+",u.def_bonus]})]}),u.mana_bonus>0&&t.jsxs("div",{className:"bg-purple-900/30 border border-purple-700/50 rounded-lg p-3",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(Ie,{className:"h-4 w-4 text-purple-400"}),t.jsx("span",{className:"text-purple-300 font-medium",children:"Mana"})]}),t.jsxs("p",{className:"text-purple-200 text-lg font-bold",children:["+",u.mana_bonus]})]}),u.speed_bonus&&u.speed_bonus>0&&t.jsxs("div",{className:"bg-yellow-900/30 border border-yellow-700/50 rounded-lg p-3",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(Ie,{className:"h-4 w-4 text-yellow-400"}),t.jsx("span",{className:"text-yellow-300 font-medium",children:"Velocidade"})]}),t.jsxs("p",{className:"text-yellow-200 text-lg font-bold",children:["+",u.speed_bonus]})]})]})]}),u.level_requirement&&u.level_requirement>1&&t.jsxs("div",{className:"bg-slate-700/30 border border-slate-600/50 rounded-lg p-3",children:[t.jsx("h4",{className:"text-sm font-medium text-slate-300 mb-2",children:"Requisitos"}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("span",{className:"text-slate-400",children:"Nível mínimo:"}),t.jsx("span",{className:"font-bold "+(e?"text-green-400":"text-red-400"),children:u.level_requirement})]})]}),u.weapon_subtype&&t.jsxs("div",{className:"bg-slate-700/30 border border-slate-600/50 rounded-lg p-3",children:[t.jsx("h4",{className:"text-sm font-medium text-slate-300 mb-2",children:"Tipo de Arma"}),t.jsx("p",{className:"text-slate-400 capitalize",children:u.weapon_subtype})]}),t.jsx("div",{className:"pt-4 border-t border-slate-700/50",children:t.jsx(Da,{onClick:()=>(async e=>{if(a&&!N)try{w(!0);const t=await Js.toggleEquipment(a,e.id,!0,r);t.success?(_.success(`${e.name} equipado com sucesso!`),s({to:"/game/play/hub/equipment",search:{character:a}})):_.error(t.error||"Erro ao equipar item")}catch(t){_.error("Erro ao equipar item")}finally{w(!1)}})(u),disabled:!e||N,className:"w-full "+(e?"bg-amber-600 hover:bg-amber-700 text-white":"bg-slate-700 text-slate-400 cursor-not-allowed"),children:N?t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-t border-b border-current"}),"Equipando..."]}):e?`Equipar em ${E(r)}`:`Nível ${u.level_requirement} necessário`})})]})})()})]})})]})]})})},validateSearch:e=>({character:e.character||"",slot:e.slot||"main_hand"})});const Gx={xs:"w-4 h-4",sm:"w-6 h-6",md:"w-8 h-8",lg:"w-12 h-12",xl:"w-16 h-16"};function Wx({character:s,animation:a,frameNumber:r,size:n="md",className:i="",onFrameChange:o,transitionDuration:l=100}){const[c,d]=e.useState(!1),[m,u]=e.useState(r),h=e.useRef(null),p=e.useRef(r),x=e.useRef(null);e.useEffect((()=>{(async()=>{try{await yx.preloadCharacterAnimation(s,a,3),d(!0)}catch(e){d(!0)}})()}),[s,a]);const f=e.useCallback((e=>{if(!h.current||!c)return;const t=h.current,r=t.getContext("2d");if(!r)return;const n=yx.getPreloadedAnimationFrame(s,a,e);if(n)r.clearRect(0,0,t.width,t.height),r.drawImage(n,0,0,t.width,t.height);else{const n=yx.getCharacterAnimationFrame(s,a,e),i=new Image;i.onload=()=>{r.clearRect(0,0,t.width,t.height),r.drawImage(i,0,0,t.width,t.height)},i.src=n}}),[s,a,c]);return e.useEffect((()=>{if(r!==p.current){if(p.current=r,x.current&&clearTimeout(x.current),l<=0||m===r)return u(r),f(r),void o?.(r);u(r),x.current=setTimeout((()=>{f(r),o?.(r)}),l/2)}}),[r,m,f,o,l]),e.useEffect((()=>{c&&f(m)}),[c,f,m]),e.useEffect((()=>()=>{x.current&&clearTimeout(x.current)}),[]),c?t.jsx("canvas",{ref:h,className:`${Gx[n]} ${i} transition-opacity duration-${l}`,width:64,height:64,style:{imageRendering:"pixelated"},"aria-label":`${s} ${a} animation - frame ${r}`}):t.jsx("div",{className:`${Gx[n]} ${i} bg-slate-700/50 animate-pulse rounded flex items-center justify-center`,"aria-label":"Carregando animação...",children:t.jsx("div",{className:"text-slate-500 text-xs",children:"..."})})}function Xx({className:s="",size:a=64}){const[r,n]=e.useState(1),[i,o]=e.useState(!0);e.useEffect((()=>{if(!i)return;const e=setInterval((()=>{n((e=>e%3+1))}),600);return()=>clearInterval(e)}),[i]);return t.jsx("div",{className:`relative ${s}`,style:{width:a,height:a},onMouseEnter:()=>o(!0),onMouseLeave:()=>o(!0),children:t.jsx(Wx,{character:"thief",animation:"idle",frameNumber:r,size:"xl",className:"w-full h-full object-contain",onFrameChange:e=>{},transitionDuration:150})})}function Yx({player:s,currentEnemy:a,playerHpPercentage:r,playerManaPercentage:n,enemyHpPercentage:i,isPlayerTurn:o}){e.useEffect((()=>{}),[s,a,r,i,o]);const[l,c]=e.useState(!1),[d,m]=e.useState(!1),[u,h]=e.useState([]),[p,x]=e.useState(!1),f=e.useRef(null);e.useEffect((()=>{const e=e=>{f.current&&!f.current.contains(e.target)&&x(!1)};return p&&(document.addEventListener("mousedown",e),document.addEventListener("touchstart",e)),()=>{document.removeEventListener("mousedown",e),document.removeEventListener("touchstart",e)}}),[p]);const g=()=>{x(!p)},[b,v]=e.useState({playerHp:s.hp,enemyHp:a.hp,battleId:`${s.floor}-${a.name}-${Date.now()}`});e.useEffect((()=>{const e=`${s.floor}-${a.name}`;if(!b.battleId.includes(e))return void v({playerHp:s.hp,enemyHp:a.hp,battleId:e});let t=!1;if(s.hp<b.playerHp&&b.playerHp-s.hp>=1){const e=b.playerHp-s.hp;y(e,!0,!1,"physical"),t=!0}if(a.hp<b.enemyHp&&b.enemyHp-a.hp>=1){const e=b.enemyHp-a.hp,r=e>1.5*s.atk;y(e,!1,r,"physical"),t=!0}t&&v({playerHp:s.hp,enemyHp:a.hp,battleId:e})}),[s.hp,a.hp,s.atk,s.floor,a.name]);const y=(e,t,s,a)=>{const r=`${Date.now()}-${Math.random()}`,n={id:r,damage:e,isPlayer:t,isCritical:s,damageType:a,timestamp:Date.now()};h((e=>[...e,n])),setTimeout((()=>{h((e=>e.filter((e=>e.id!==r))))}),2e3)},j=e=>({armored:"Blindado",swift:"Veloz",magical:"Mágico",brutish:"Brutal",resilient:"Resistente",berserker:"Berserker",ethereal:"Etéreo",venomous:"Venenoso"}[e]||e),N=e=>{switch(e){case"armored":return t.jsx($e,{className:"h-3 w-3"});case"swift":return t.jsx(Ie,{className:"h-3 w-3"});case"magical":return t.jsx(ft,{className:"h-3 w-3"});case"brutish":return t.jsx(qe,{className:"h-3 w-3"});case"resilient":return t.jsx(Ut,{className:"h-3 w-3"});case"berserker":return t.jsx(vt,{className:"h-3 w-3"});case"ethereal":return t.jsx(qt,{className:"h-3 w-3"});case"venomous":return t.jsx(Gt,{className:"h-3 w-3"});default:return t.jsx(Ht,{className:"h-3 w-3"})}};return t.jsxs("div",{className:"relative",children:[t.jsx("div",{className:"absolute inset-0 bg-gradient-to-b from-slate-900/30 via-transparent to-slate-900/30 rounded-xl"}),t.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-blue-500/5 via-transparent to-red-500/5 rounded-xl"}),t.jsx(rh,{className:"relative border-2 backdrop-blur-sm overflow-hidden transition-all duration-500 "+(r>=70?"battle-card-healthy":r>=30?"battle-card-wounded":"battle-card-critical"),children:t.jsxs(lh,{className:"p-3 md:p-6",children:[t.jsx("div",{className:"text-center mb-3 md:mb-6",children:t.jsxs("div",{className:"flex items-center justify-center gap-2 md:gap-3 mb-2",children:[t.jsxs(uh,{variant:"outline",className:"px-2 py-1 text-xs bg-background/50",children:[t.jsx(qe,{className:"h-3 w-3 mr-1"}),"Andar ",s.floor]}),t.jsx("div",{className:"h-1.5 w-1.5 md:h-2 md:w-2 rounded-full bg-primary animate-pulse"}),t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(uh,{variant:o?"default":"secondary",className:"px-2 py-1 text-xs "+(o?"bg-primary text-primary-foreground border-primary":"bg-secondary text-secondary-foreground border-secondary"),children:o?"Seu Turno":"Turno do Inimigo"}),o&&t.jsxs("div",{className:"relative",ref:f,children:[t.jsx("button",{className:"ml-1 text-muted-foreground hover:text-foreground transition-colors touch-manipulation",onClick:g,onTouchStart:g,"aria-label":"Mostrar atalhos de teclado",children:t.jsx(Ot,{className:"h-3 w-3 md:h-4 md:w-4"})}),p&&t.jsxs("div",{className:"absolute top-full left-1/2 transform -translate-x-1/2 mt-2 z-50 bg-background border border-border rounded-lg shadow-xl p-4 w-72 md:w-80 max-w-[90vw]",children:[t.jsxs("div",{className:"text-sm",children:[t.jsx("div",{className:"font-semibold mb-3 text-center text-foreground",children:"Atalhos de Teclado"}),t.jsxs("div",{className:"space-y-2.5",children:[t.jsxs("div",{className:"flex items-center justify-between gap-3",children:[t.jsxs("div",{className:"flex gap-1",children:[t.jsx("span",{className:"font-mono bg-primary/20 text-primary px-2 py-1 rounded text-xs border",children:"A"}),t.jsx("span",{className:"font-mono bg-primary/20 text-primary px-2 py-1 rounded text-xs border",children:"S"}),t.jsx("span",{className:"font-mono bg-primary/20 text-primary px-2 py-1 rounded text-xs border",children:"D"})]}),t.jsx("span",{className:"text-xs text-muted-foreground flex-1 text-right",children:"Atacar, Defender, Fugir"})]}),t.jsxs("div",{className:"flex items-center justify-between gap-3",children:[t.jsxs("div",{className:"flex gap-1",children:[t.jsx("span",{className:"font-mono bg-blue-500/20 text-blue-400 px-2 py-1 rounded text-xs border border-blue-500/30",children:"1"}),t.jsx("span",{className:"font-mono bg-blue-500/20 text-blue-400 px-2 py-1 rounded text-xs border border-blue-500/30",children:"2"}),t.jsx("span",{className:"font-mono bg-blue-500/20 text-blue-400 px-2 py-1 rounded text-xs border border-blue-500/30",children:"3"})]}),t.jsx("span",{className:"text-xs text-muted-foreground flex-1 text-right",children:"Magias 1, 2, 3"})]}),t.jsxs("div",{className:"flex items-center justify-between gap-3",children:[t.jsxs("div",{className:"flex gap-1",children:[t.jsx("span",{className:"font-mono bg-green-500/20 text-green-400 px-2 py-1 rounded text-xs border border-green-500/30",children:"Q"}),t.jsx("span",{className:"font-mono bg-green-500/20 text-green-400 px-2 py-1 rounded text-xs border border-green-500/30",children:"W"}),t.jsx("span",{className:"font-mono bg-green-500/20 text-green-400 px-2 py-1 rounded text-xs border border-green-500/30",children:"E"})]}),t.jsx("span",{className:"text-xs text-muted-foreground flex-1 text-right",children:"Poções 1, 2, 3"})]})]})]}),t.jsx("div",{className:"absolute bottom-full left-1/2 transform -translate-x-1/2 w-0 h-0 border-l-4 border-r-4 border-b-4 border-l-transparent border-r-transparent border-b-border"}),t.jsx("div",{className:"absolute bottom-full left-1/2 transform -translate-x-1/2 translate-y-px w-0 h-0 border-l-4 border-r-4 border-b-4 border-l-transparent border-r-transparent border-b-background"})]})]})]})]})}),t.jsxs("div",{className:"grid grid-cols-2 gap-3 md:gap-8 items-start",children:[t.jsxs("div",{className:"space-y-2 md:space-y-4",children:[t.jsxs("div",{className:"text-center relative",children:[t.jsxs("div",{className:"relative inline-block mb-2 md:mb-4",children:[t.jsx("div",{className:"w-16 h-16 md:w-24 md:h-24 lg:w-28 lg:h-28 rounded-full bg-gradient-to-br from-blue-500/20 to-purple-500/20 border-2 md:border-3 flex items-center justify-center transition-all duration-500 overflow-hidden "+(o?"border-blue-500 shadow-xl md:shadow-2xl shadow-blue-500/40 scale-105 md:scale-110":"border-blue-500/30 scale-100"),children:t.jsx(Xx,{size:64,className:"scale-75 md:scale-100 lg:scale-110"})}),o&&t.jsxs("div",{className:"absolute -top-1 -right-1 md:-top-2 md:-right-2",children:[t.jsx("div",{className:"w-3 h-3 md:w-5 md:h-5 bg-blue-500 rounded-full animate-ping"}),t.jsx("div",{className:"absolute top-0 right-0 w-3 h-3 md:w-5 md:h-5 bg-blue-500 rounded-full"})]}),s.isDefending&&t.jsx("div",{className:"absolute -bottom-1 -left-1 md:-bottom-2 md:-left-2",children:t.jsx("div",{className:"w-6 h-6 md:w-8 md:h-8 bg-blue-600/90 rounded-full flex items-center justify-center border-2 border-background",children:t.jsx($e,{className:"h-3 w-3 md:h-4 md:w-4 text-white"})})})]}),t.jsxs("div",{className:"space-y-1 md:space-y-2",children:[t.jsxs("h3",{className:"font-bold text-sm md:text-lg lg:text-xl flex items-center justify-center gap-1 md:gap-2",children:[t.jsx(Qe,{className:"h-3 w-3 md:h-5 md:w-5 text-yellow-500"}),t.jsx("span",{className:"truncate",children:s.name})]}),t.jsxs("div",{className:"flex items-center justify-center gap-1 md:gap-2 flex-wrap",children:[t.jsxs(uh,{variant:"outline",className:"bg-background/50 text-xs px-1 md:px-2",children:[t.jsx(gt,{className:"h-2 w-2 md:h-3 md:w-3 mr-1"}),"Nv ",s.level]}),t.jsxs(uh,{variant:"outline",className:"bg-background/50 text-yellow-400 text-xs px-1 md:px-2",children:[s.gold.toLocaleString("pt-BR"),"G"]})]})]}),u.filter((e=>e.isPlayer)).map((e=>t.jsxs("div",{className:"absolute pointer-events-none z-20 font-bold text-lg animate-damage-float "+(e.isCritical?"text-red-400 text-2xl animate-damage-critical":"text-red-300"),style:{left:"50%",top:"20%",transform:"translateX(-50%)",textShadow:"2px 2px 4px rgba(0,0,0,0.8)"},children:["-",e.damage,e.isCritical&&t.jsx("span",{className:"ml-1 text-yellow-400 text-sm",children:"CRÍTICO!"})]},e.id)))]}),t.jsxs("div",{className:"space-y-2 md:space-y-3",children:[t.jsxs("div",{children:[t.jsxs("div",{className:"flex justify-between items-center mb-1",children:[t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(Ue,{className:"h-3 w-3 md:h-4 md:w-4 text-red-500"}),t.jsx("span",{className:"font-medium text-xs md:text-sm",children:"HP"})]}),t.jsxs("span",{className:"text-xs md:text-sm font-bold",children:[s.hp,"/",s.max_hp]})]}),t.jsxs("div",{className:"relative",children:[t.jsx(vp,{value:r,className:"h-2 md:h-3",style:{background:"rgba(0,0,0,0.2)"}}),t.jsx("div",{className:"absolute top-0 left-0 h-2 md:h-3 rounded-full transition-all duration-300 "+(r>=70?"bg-green-500":r>=40?"bg-yellow-500":r>=20?"bg-orange-500":"bg-red-500"),style:{width:`${r}%`}})]})]}),t.jsxs("div",{children:[t.jsxs("div",{className:"flex justify-between items-center mb-1",children:[t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(ft,{className:"h-3 w-3 md:h-4 md:w-4 text-blue-500"}),t.jsx("span",{className:"font-medium text-xs md:text-sm",children:"MP"})]}),t.jsxs("span",{className:"text-xs md:text-sm font-bold",children:[s.mana,"/",s.max_mana]})]}),t.jsxs("div",{className:"relative",children:[t.jsx(vp,{value:n,className:"h-2 md:h-3",style:{background:"rgba(0,0,0,0.2)"}}),t.jsx("div",{className:"absolute top-0 left-0 h-2 md:h-3 rounded-full transition-all duration-300 "+(n>=70?"bg-blue-500":n>=40?"bg-cyan-500":n>=20?"bg-indigo-500":"bg-purple-500"),style:{width:`${n}%`}})]})]})]}),t.jsxs("div",{className:"grid gap-1 md:gap-2 "+(s.magic_attack&&!isNaN(s.magic_attack)&&s.magic_attack>0?"grid-cols-4":"grid-cols-3"),children:[t.jsxs("div",{className:"bg-red-500/10 border border-red-500/20 rounded p-1 md:p-2 text-center",children:[t.jsx(qe,{className:"h-3 w-3 md:h-4 md:w-4 mx-auto mb-1 text-red-400"}),t.jsx("div",{className:"text-xs text-red-300 mb-1",children:"ATK"}),t.jsx("div",{className:"text-xs font-bold text-red-400",children:t.jsx(Lp,{value:s.atk||0,baseValue:s.base_atk,equipmentBonus:s.equipment_atk_bonus,modifications:s.active_effects?.attribute_modifications?.filter((e=>"atk"===e.attribute))||[],size:"sm",showTooltip:!0})})]}),s.magic_attack&&!isNaN(s.magic_attack)&&s.magic_attack>0&&t.jsxs("div",{className:"bg-purple-500/10 border border-purple-500/20 rounded p-1 md:p-2 text-center",children:[t.jsx(ft,{className:"h-3 w-3 md:h-4 md:w-4 mx-auto mb-1 text-purple-400"}),t.jsx("div",{className:"text-xs text-purple-300 mb-1",children:"MAG"}),t.jsx("div",{className:"text-xs font-bold text-purple-400",children:t.jsx(Lp,{value:s.magic_attack,modifications:s.active_effects?.attribute_modifications?.filter((e=>"magic_attack"===e.attribute))||[],size:"sm",showTooltip:!0})})]}),t.jsxs("div",{className:"bg-blue-500/10 border border-blue-500/20 rounded p-1 md:p-2 text-center",children:[t.jsx($e,{className:"h-3 w-3 md:h-4 md:w-4 mx-auto mb-1 text-blue-400"}),t.jsx("div",{className:"text-xs text-blue-300 mb-1",children:"DEF"}),t.jsx("div",{className:"text-xs font-bold text-blue-400",children:t.jsx(Lp,{value:s.def||0,baseValue:s.base_def,equipmentBonus:s.equipment_def_bonus,modifications:s.active_effects?.attribute_modifications?.filter((e=>"def"===e.attribute))||[],size:"sm",showTooltip:!0})})]}),t.jsxs("div",{className:"bg-yellow-500/10 border border-yellow-500/20 rounded p-1 md:p-2 text-center",children:[t.jsx(Ie,{className:"h-3 w-3 md:h-4 md:w-4 mx-auto mb-1 text-yellow-400"}),t.jsx("div",{className:"text-xs text-yellow-300 mb-1",children:"SPD"}),t.jsx("div",{className:"text-xs font-bold text-yellow-400",children:t.jsx(Lp,{value:s.speed||0,baseValue:s.base_speed,equipmentBonus:s.equipment_speed_bonus,modifications:s.active_effects?.attribute_modifications?.filter((e=>"speed"===e.attribute))||[],size:"sm",showTooltip:!0})})]})]}),t.jsxs("div",{className:"hidden md:block",children:[t.jsxs(Da,{variant:"ghost",size:"sm",onClick:()=>c(!l),className:"w-full h-8 text-xs bg-background/30 hover:bg-background/50",children:[l?t.jsx(me,{className:"h-3 w-3 mr-1"}):t.jsx(ce,{className:"h-3 w-3 mr-1"}),l?"Menos":"Mais"," Detalhes"]}),l&&t.jsxs("div",{className:"space-y-3 pt-2 border-t border-border/50 animate-in slide-in-from-top-2 duration-300",children:[t.jsx("div",{className:"space-y-2",children:(()=>{const e=(a=s.level)<=1?0:Math.floor(100*Math.pow(1.5,a-2));var a;const r=s.xp_next_level,n=s.xp-e,i=r-e,o=Math.max(0,Math.min(100,n/i*100));return t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"flex justify-between items-center",children:[t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(gt,{className:"h-3 w-3 text-yellow-500"}),t.jsx("span",{className:"font-medium text-xs text-muted-foreground",children:"Experiência"})]}),t.jsxs("div",{className:"text-xs font-bold",children:[t.jsx("span",{className:"text-yellow-400",children:Gh(n)}),t.jsx("span",{className:"text-muted-foreground mx-1",children:"/"}),t.jsx("span",{className:"text-muted-foreground",children:Gh(i)})]})]}),t.jsxs("div",{className:"relative",children:[t.jsxs("div",{className:"relative",children:[t.jsx(vp,{value:o,className:"h-2",style:{background:"rgba(0,0,0,0.2)"}}),t.jsx("div",{className:"absolute top-0 left-0 h-2 bg-gradient-to-r from-amber-400 via-yellow-500 to-orange-400 rounded-full transition-all duration-300",style:{width:`${o}%`}})]}),t.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-yellow-500/10 via-yellow-500/5 to-yellow-500/10 rounded-full pointer-events-none"})]}),t.jsxs("div",{className:"flex justify-between text-xs",children:[t.jsxs("span",{className:"text-muted-foreground",children:["Nível ",s.level]}),t.jsxs("span",{className:"text-yellow-400 font-medium",children:[Gh(i-n)," para nv"," ",s.level+1]})]})]})})()}),(s.strength||s.dexterity||s.intelligence||s.wisdom||s.vitality||s.luck)&&t.jsxs("div",{className:"space-y-2",children:[t.jsx("div",{className:"text-xs font-medium text-muted-foreground",children:"Atributos Primários:"}),t.jsxs("div",{className:"grid grid-cols-3 gap-2 text-xs",children:[s.strength&&t.jsxs("div",{className:"bg-red-500/10 rounded p-1 text-center",children:[t.jsx(Oe,{className:"h-3 w-3 mx-auto mb-1 text-red-400"}),t.jsx("div",{className:"text-muted-foreground",children:"FOR"}),t.jsx("div",{className:"font-medium",children:s.strength})]}),s.dexterity&&t.jsxs("div",{className:"bg-green-500/10 rounded p-1 text-center",children:[t.jsx(Ie,{className:"h-3 w-3 mx-auto mb-1 text-green-400"}),t.jsx("div",{className:"text-muted-foreground",children:"DES"}),t.jsx("div",{className:"font-medium",children:s.dexterity})]}),s.intelligence&&t.jsxs("div",{className:"bg-purple-500/10 rounded p-1 text-center",children:[t.jsx(ft,{className:"h-3 w-3 mx-auto mb-1 text-purple-400"}),t.jsx("div",{className:"text-muted-foreground",children:"INT"}),t.jsx("div",{className:"font-medium",children:s.intelligence})]}),s.wisdom&&t.jsxs("div",{className:"bg-blue-500/10 rounded p-1 text-center",children:[t.jsx(qt,{className:"h-3 w-3 mx-auto mb-1 text-blue-400"}),t.jsx("div",{className:"text-muted-foreground",children:"SAB"}),t.jsx("div",{className:"font-medium",children:s.wisdom})]}),s.vitality&&t.jsxs("div",{className:"bg-pink-500/10 rounded p-1 text-center",children:[t.jsx(Ue,{className:"h-3 w-3 mx-auto mb-1 text-pink-400"}),t.jsx("div",{className:"text-muted-foreground",children:"VIT"}),t.jsx("div",{className:"font-medium",children:s.vitality})]}),s.luck&&t.jsxs("div",{className:"bg-yellow-500/10 rounded p-1 text-center",children:[t.jsx(gt,{className:"h-3 w-3 mx-auto mb-1 text-yellow-400"}),t.jsx("div",{className:"text-muted-foreground",children:"SOR"}),t.jsx("div",{className:"font-medium",children:s.luck})]})]})]}),(s.critical_chance||s.critical_damage)&&t.jsxs("div",{className:"space-y-2",children:[t.jsx("div",{className:"text-xs font-medium text-muted-foreground",children:"Combate Avançado:"}),t.jsxs("div",{className:"grid grid-cols-2 gap-2 text-xs",children:[s.critical_chance&&t.jsxs("div",{className:"bg-background/20 rounded p-2",children:[t.jsxs("div",{className:"flex items-center gap-1 text-muted-foreground",children:[t.jsx(zt,{className:"h-3 w-3"}),t.jsx("span",{children:"Crítico"})]}),t.jsx("div",{className:"font-medium text-yellow-400",children:t.jsx(Lp,{value:s.critical_chance,modifications:s.active_effects?.attribute_modifications?.filter((e=>"critical_chance"===e.attribute))||[],size:"sm",showTooltip:!0,label:"%"})})]}),s.critical_damage&&t.jsxs("div",{className:"bg-background/20 rounded p-2",children:[t.jsxs("div",{className:"flex items-center gap-1 text-muted-foreground",children:[t.jsx(vt,{className:"h-3 w-3"}),t.jsx("span",{children:"Dano Crit"})]}),t.jsx("div",{className:"font-medium text-orange-400",children:t.jsx(Lp,{value:s.critical_damage,modifications:s.active_effects?.attribute_modifications?.filter((e=>"critical_damage"===e.attribute))||[],size:"sm",showTooltip:!0,label:"%"})})]})]})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsx("div",{className:"text-xs font-medium text-muted-foreground",children:"Habilidades:"}),t.jsxs("div",{className:"grid grid-cols-2 gap-2 text-xs",children:[(s.sword_mastery||0)>1&&t.jsxs("div",{className:"bg-red-500/10 rounded p-1 text-center",children:[t.jsx(qe,{className:"h-3 w-3 mx-auto mb-1 text-red-400"}),t.jsx("div",{className:"text-muted-foreground",children:"Espada"}),t.jsxs("div",{className:"font-medium",children:["Lv ",s.sword_mastery]}),t.jsxs("div",{className:"text-xs text-muted-foreground",children:[s.sword_mastery_xp||0," XP"]})]}),(s.axe_mastery||0)>1&&t.jsxs("div",{className:"bg-orange-500/10 rounded p-1 text-center",children:[t.jsx(vt,{className:"h-3 w-3 mx-auto mb-1 text-orange-400"}),t.jsx("div",{className:"text-muted-foreground",children:"Machado"}),t.jsxs("div",{className:"font-medium",children:["Lv ",s.axe_mastery]}),t.jsxs("div",{className:"text-xs text-muted-foreground",children:[s.axe_mastery_xp||0," XP"]})]}),(s.blunt_mastery||0)>1&&t.jsxs("div",{className:"bg-brown-500/10 rounded p-1 text-center",children:[t.jsx(Bt,{className:"h-3 w-3 mx-auto mb-1 text-brown-400"}),t.jsx("div",{className:"text-muted-foreground",children:"Concussão"}),t.jsxs("div",{className:"font-medium",children:["Lv ",s.blunt_mastery]}),t.jsxs("div",{className:"text-xs text-muted-foreground",children:[s.blunt_mastery_xp||0," XP"]})]}),(s.defense_mastery||0)>1&&t.jsxs("div",{className:"bg-blue-500/10 rounded p-1 text-center",children:[t.jsx($e,{className:"h-3 w-3 mx-auto mb-1 text-blue-400"}),t.jsx("div",{className:"text-muted-foreground",children:"Defesa"}),t.jsxs("div",{className:"font-medium",children:["Lv ",s.defense_mastery]}),t.jsxs("div",{className:"text-xs text-muted-foreground",children:[s.defense_mastery_xp||0," XP"]})]}),(s.magic_mastery||0)>1&&t.jsxs("div",{className:"bg-purple-500/10 rounded p-1 text-center",children:[t.jsx(ft,{className:"h-3 w-3 mx-auto mb-1 text-purple-400"}),t.jsx("div",{className:"text-muted-foreground",children:"Magia"}),t.jsxs("div",{className:"font-medium",children:["Lv ",s.magic_mastery]}),t.jsxs("div",{className:"text-xs text-muted-foreground",children:[s.magic_mastery_xp||0," XP"]})]})]})]}),Boolean(s.attribute_points&&s.attribute_points>0)&&t.jsxs("button",{onClick:()=>{window.dispatchEvent(new CustomEvent("openAttributeModal"))},className:"w-full bg-yellow-500/10 border border-yellow-500/20 rounded p-2 hover:bg-yellow-500/20 hover:border-yellow-500/40 transition-all duration-200 cursor-pointer relative overflow-hidden",children:[t.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-yellow-500/5 via-yellow-500/10 to-yellow-500/5 animate-pulse"}),t.jsxs("div",{className:"relative flex items-center gap-2 text-yellow-400",children:[t.jsx(gt,{className:"h-4 w-4 animate-pulse"}),t.jsxs("span",{className:"text-sm font-medium",children:[s.attribute_points," pontos de atributo disponíveis"]})]})]}),Boolean(s.isDefending)&&t.jsxs("div",{className:"flex items-center gap-2 text-blue-400 bg-blue-500/10 rounded p-2",children:[t.jsx($e,{className:"h-4 w-4"}),t.jsx("span",{className:"text-sm font-medium",children:"Postura Defensiva Ativa"})]}),Boolean(s.defenseCooldown>0)&&t.jsxs("div",{className:"flex items-center gap-2 text-orange-400 bg-orange-500/10 rounded p-2",children:[t.jsx(Bt,{className:"h-4 w-4"}),t.jsxs("span",{className:"text-sm",children:["Defesa em Cooldown: ",s.defenseCooldown," turnos"]})]})]})]})]}),t.jsxs("div",{className:"space-y-2 md:space-y-4",children:[t.jsxs("div",{className:"text-center relative",children:[t.jsxs("div",{className:"relative inline-block mb-2 md:mb-4",children:[t.jsx("div",{className:"w-16 h-16 md:w-24 md:h-24 lg:w-28 lg:h-28 rounded-full bg-gradient-to-br from-red-500/20 to-orange-500/20 border-2 md:border-3 flex items-center justify-center text-2xl md:text-4xl lg:text-5xl transition-all duration-500 "+(o?"border-red-500/30 scale-100":"border-red-500 shadow-xl md:shadow-2xl shadow-red-500/40 scale-105 md:scale-110"),children:a.image||"👾"}),!o&&t.jsxs("div",{className:"absolute -top-1 -right-1 md:-top-2 md:-right-2",children:[t.jsx("div",{className:"w-3 h-3 md:w-5 md:h-5 bg-red-500 rounded-full animate-ping"}),t.jsx("div",{className:"absolute top-0 right-0 w-3 h-3 md:w-5 md:h-5 bg-red-500 rounded-full"})]})]}),t.jsxs("div",{className:"space-y-1 md:space-y-2",children:[t.jsxs("h3",{className:"font-bold text-sm md:text-lg lg:text-xl flex items-center justify-center gap-1 md:gap-2",children:[t.jsx(Le,{className:"h-3 w-3 md:h-5 md:w-5 text-red-500"}),t.jsx("span",{className:"truncate",children:a.name})]}),t.jsxs("div",{className:"flex items-center justify-center gap-1 md:gap-2 flex-wrap",children:[t.jsxs(uh,{variant:"outline",className:"bg-background/50 text-xs px-1 md:px-2",children:[t.jsx(qt,{className:"h-2 w-2 md:h-3 md:w-3 mr-1"}),"Nv ",a.level]}),a.tier&&a.tier>1&&t.jsxs(uh,{variant:"outline",className:"bg-purple-500/20 text-purple-400 border-purple-500/30 text-xs px-1 md:px-2",children:[t.jsx(gt,{className:"h-2 w-2 md:h-3 md:w-3 mr-1"}),"Tier ",a.tier]}),a.is_boss&&t.jsxs(uh,{className:"bg-red-500/20 text-red-400 border-red-500/30 text-xs px-1 md:px-2",children:[t.jsx(Qe,{className:"h-2 w-2 md:h-3 md:w-3 mr-1"}),"BOSS"]}),t.jsx(uh,{className:`text-xs border px-1 md:px-2 ${(e=>{switch(e){case"aggressive":return"bg-red-500/20 text-red-400 border-red-500/30";case"defensive":return"bg-blue-500/20 text-blue-400 border-blue-500/30";case"balanced":return"bg-green-500/20 text-green-400 border-green-500/30";default:return"bg-gray-500/20 text-gray-400 border-gray-500/30"}})(a.behavior)}`,children:(w=a.behavior,{aggressive:"Agressivo",defensive:"Defensivo",balanced:"Equilibrado"}[w]||w)})]})]}),u.filter((e=>!e.isPlayer)).map((e=>t.jsxs("div",{className:"absolute pointer-events-none z-20 font-bold text-lg animate-damage-float "+(e.isCritical?"text-orange-400 text-2xl animate-damage-critical":"text-orange-300"),style:{left:"50%",top:"20%",transform:"translateX(-50%)",textShadow:"2px 2px 4px rgba(0,0,0,0.8)"},children:["-",e.damage,e.isCritical&&t.jsx("span",{className:"ml-1 text-yellow-400 text-sm",children:"CRÍTICO!"})]},e.id)))]}),t.jsxs("div",{className:"space-y-2 md:space-y-3",children:[t.jsxs("div",{children:[t.jsxs("div",{className:"flex justify-between items-center mb-1",children:[t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(Ue,{className:"h-3 w-3 md:h-4 md:w-4 text-red-500"}),t.jsx("span",{className:"font-medium text-xs md:text-sm",children:"HP"})]}),t.jsxs("span",{className:"text-xs md:text-sm font-bold",children:[a.hp,"/",a.maxHp]})]}),t.jsxs("div",{className:"relative",children:[t.jsx(vp,{value:i,className:"h-2 md:h-3",style:{background:"rgba(0,0,0,0.2)"}}),t.jsx("div",{className:"absolute top-0 left-0 h-2 md:h-3 rounded-full transition-all duration-300 "+(i>=70?"bg-green-500":i>=40?"bg-yellow-500":i>=20?"bg-orange-500":"bg-red-500"),style:{width:`${i}%`}})]})]}),Boolean(a.mana>0)&&t.jsxs("div",{children:[t.jsxs("div",{className:"flex justify-between items-center mb-1",children:[t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(ft,{className:"h-3 w-3 md:h-4 md:w-4 text-purple-500"}),t.jsx("span",{className:"font-medium text-xs md:text-sm",children:"MP"})]}),t.jsx("span",{className:"text-xs md:text-sm font-bold",children:a.mana})]}),t.jsxs("div",{className:"relative",children:[t.jsx("div",{className:"h-2 md:h-3 bg-black/20 rounded-full"}),t.jsx("div",{className:"absolute top-0 left-0 h-2 md:h-3 bg-gradient-to-r from-blue-500 via-cyan-500 to-purple-500 rounded-full transition-all duration-300",style:{width:`${Math.min(100,a.mana/Math.max(a.mana,100)*100)}%`}})]})]})]}),t.jsxs("div",{className:"grid grid-cols-3 gap-1 md:gap-2",children:[t.jsxs("div",{className:"bg-red-500/10 border border-red-500/20 rounded p-1 md:p-2 text-center",children:[t.jsx(qe,{className:"h-3 w-3 md:h-4 md:w-4 mx-auto mb-1 text-red-400"}),t.jsx("div",{className:"text-xs font-bold text-red-400",children:a.attack})]}),t.jsxs("div",{className:"bg-blue-500/10 border border-blue-500/20 rounded p-1 md:p-2 text-center",children:[t.jsx($e,{className:"h-3 w-3 md:h-4 md:w-4 mx-auto mb-1 text-blue-400"}),t.jsx("div",{className:"text-xs font-bold text-blue-400",children:a.defense})]}),t.jsxs("div",{className:"bg-yellow-500/10 border border-yellow-500/20 rounded p-1 md:p-2 text-center",children:[t.jsx(Ie,{className:"h-3 w-3 md:h-4 md:w-4 mx-auto mb-1 text-yellow-400"}),t.jsx("div",{className:"text-xs font-bold text-yellow-400",children:a.speed})]})]}),t.jsxs("div",{className:"hidden md:block",children:[t.jsxs(Da,{variant:"ghost",size:"sm",onClick:()=>m(!d),className:"w-full h-8 text-xs bg-background/30 hover:bg-background/50",children:[d?t.jsx(me,{className:"h-3 w-3 mr-1"}):t.jsx(ce,{className:"h-3 w-3 mr-1"}),d?"Menos":"Mais"," Detalhes"]}),d&&t.jsxs("div",{className:"space-y-3 pt-2 border-t border-border/50 animate-in slide-in-from-top-2 duration-300",children:[t.jsxs("div",{className:"grid grid-cols-2 gap-3 text-xs",children:[t.jsxs("div",{className:"bg-background/20 rounded p-2",children:[t.jsx("div",{className:"text-muted-foreground",children:"Recompensa XP"}),t.jsx("div",{className:"font-medium text-blue-400",children:a.reward_xp})]}),t.jsxs("div",{className:"bg-background/20 rounded p-2",children:[t.jsx("div",{className:"text-muted-foreground",children:"Recompensa Gold"}),t.jsx("div",{className:"font-medium text-yellow-400",children:a.reward_gold})]})]}),Boolean(a.strength||a.dexterity||a.intelligence)&&t.jsxs("div",{className:"space-y-2",children:[t.jsx("div",{className:"text-xs font-medium text-muted-foreground",children:"Atributos Primários:"}),t.jsxs("div",{className:"grid grid-cols-3 gap-2 text-xs",children:[Boolean(a.strength)&&t.jsxs("div",{className:"bg-red-500/10 rounded p-1 text-center",children:[t.jsx(Oe,{className:"h-3 w-3 mx-auto mb-1 text-red-400"}),t.jsx("div",{className:"text-muted-foreground",children:"FOR"}),t.jsx("div",{className:"font-medium",children:a.strength})]}),Boolean(a.dexterity)&&t.jsxs("div",{className:"bg-green-500/10 rounded p-1 text-center",children:[t.jsx(Ie,{className:"h-3 w-3 mx-auto mb-1 text-green-400"}),t.jsx("div",{className:"text-muted-foreground",children:"DES"}),t.jsx("div",{className:"font-medium",children:a.dexterity})]}),Boolean(a.intelligence)&&t.jsxs("div",{className:"bg-purple-500/10 rounded p-1 text-center",children:[t.jsx(ft,{className:"h-3 w-3 mx-auto mb-1 text-purple-400"}),t.jsx("div",{className:"text-muted-foreground",children:"INT"}),t.jsx("div",{className:"font-medium",children:a.intelligence})]})]})]}),Boolean(a.critical_chance||a.critical_damage)&&t.jsxs("div",{className:"space-y-2",children:[t.jsx("div",{className:"text-xs font-medium text-muted-foreground",children:"Combate Avançado:"}),t.jsxs("div",{className:"grid grid-cols-2 gap-2 text-xs",children:[Boolean(a.critical_chance)&&t.jsxs("div",{className:"bg-background/20 rounded p-2",children:[t.jsxs("div",{className:"flex items-center gap-1 text-muted-foreground",children:[t.jsx(zt,{className:"h-3 w-3"}),t.jsx("span",{children:"Crítico"})]}),t.jsxs("div",{className:"font-medium text-yellow-400",children:[(a.critical_chance||0).toFixed(1),"%"]})]}),Boolean(a.critical_damage)&&t.jsxs("div",{className:"bg-background/20 rounded p-2",children:[t.jsxs("div",{className:"flex items-center gap-1 text-muted-foreground",children:[t.jsx(vt,{className:"h-3 w-3"}),t.jsx("span",{children:"Dano Crit"})]}),t.jsxs("div",{className:"font-medium text-orange-400",children:[(a.critical_damage||0).toFixed(0),"%"]})]})]})]}),Boolean(a.physical_resistance||a.magical_resistance||a.debuff_resistance)&&t.jsxs("div",{className:"space-y-2",children:[t.jsx("div",{className:"text-xs font-medium text-muted-foreground",children:"Resistências:"}),t.jsxs("div",{className:"space-y-1",children:[Boolean(a.physical_resistance&&a.physical_resistance>0)&&t.jsxs("div",{className:"flex justify-between items-center text-xs",children:[t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx($e,{className:"h-3 w-3 text-red-400"}),t.jsx("span",{children:"Física"})]}),t.jsxs("span",{className:"text-red-400",children:[(100*(a.physical_resistance||0)).toFixed(0),"%"]})]}),Boolean(a.magical_resistance&&a.magical_resistance>0)&&t.jsxs("div",{className:"flex justify-between items-center text-xs",children:[t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(ft,{className:"h-3 w-3 text-blue-400"}),t.jsx("span",{children:"Mágica"})]}),t.jsxs("span",{className:"text-blue-400",children:[(100*(a.magical_resistance||0)).toFixed(0),"%"]})]}),Boolean(a.debuff_resistance&&a.debuff_resistance>0)&&t.jsxs("div",{className:"flex justify-between items-center text-xs",children:[t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(Ut,{className:"h-3 w-3 text-green-400"}),t.jsx("span",{children:"Debuffs"})]}),t.jsxs("span",{className:"text-green-400",children:[(100*(a.debuff_resistance||0)).toFixed(0),"%"]})]})]})]}),Boolean(a.physical_vulnerability&&a.physical_vulnerability>1||a.magical_vulnerability&&a.magical_vulnerability>1)&&t.jsxs("div",{className:"space-y-2",children:[t.jsx("div",{className:"text-xs font-medium text-muted-foreground",children:"Vulnerabilidades:"}),t.jsxs("div",{className:"space-y-1",children:[Boolean(a.physical_vulnerability&&a.physical_vulnerability>1)&&t.jsxs("div",{className:"flex justify-between items-center text-xs",children:[t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(xt,{className:"h-3 w-3 text-red-400"}),t.jsx("span",{children:"Física"})]}),t.jsxs("span",{className:"text-red-400",children:["+",(100*((a.physical_vulnerability||1)-1)).toFixed(0),"%"]})]}),Boolean(a.magical_vulnerability&&a.magical_vulnerability>1)&&t.jsxs("div",{className:"flex justify-between items-center text-xs",children:[t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(xt,{className:"h-3 w-3 text-blue-400"}),t.jsx("span",{children:"Mágica"})]}),t.jsxs("span",{className:"text-blue-400",children:["+",(100*((a.magical_vulnerability||1)-1)).toFixed(0),"%"]})]})]})]}),Boolean(a.primary_trait||a.secondary_trait)&&t.jsxs("div",{className:"space-y-2",children:[t.jsx("div",{className:"text-xs font-medium text-muted-foreground",children:"Características:"}),t.jsxs("div",{className:"space-y-1",children:[Boolean(a.primary_trait)&&t.jsxs("div",{className:"flex items-center gap-2 text-xs",children:[N(a.primary_trait),t.jsx("span",{className:"text-purple-400",children:j(a.primary_trait)})]}),Boolean(a.secondary_trait)&&t.jsxs("div",{className:"flex items-center gap-2 text-xs",children:[N(a.secondary_trait),t.jsx("span",{className:"text-blue-400",children:j(a.secondary_trait)})]})]})]})]})]})]})]})]})})]});var w}function Kx({handleAction:s,isPlayerTurn:a,loading:r,player:n,onPlayerStatsUpdate:i,currentEnemy:o,battleRewards:l,potionSlots:c,loadingPotionSlots:d,onSlotsChange:m}){const{performAction:u}=e.useContext(Vs),[h,p]=e.useState(null),[x,f]=e.useState(null),[g,b]=e.useState(null),[v,y]=e.useState(null),[j,N]=e.useState(!1),w=e.useRef(!1),C=e.useRef(0),E=e.useRef(null),S=e.useCallback((async()=>{if(!j&&l){N(!0);try{u("continue"),_.success("Avançando para o próximo andar!",{description:"Preparando nova batalha...",duration:2e3})}catch(e){_.error("Erro ao avançar para o próximo andar"),N(!1)}}}),[j,l,u]),k=!a||r.performAction,P=n.potionUsedThisTurn||!1,A=n.hp<=0;e.useEffect((()=>{o&&o.hp>0&&!a&&r.performAction}),[a,r.performAction,k,o?.name,o?.hp,l]);const M=Boolean(l&&!r.performAction&&!A&&!j&&(!o||o.hp<=0)),T=r.performAction||A;e.useEffect((()=>{}),[M,l,r.performAction,A,j,o?.hp]);const R=async e=>{if(A||k||null!==h)return;const t=c.find((t=>t.slot_position===e));if(t?.consumable_id)if(P)_.error("Você já usou uma poção neste turno!",{description:"Você só pode usar uma poção por turno",duration:3e3});else if(t.available_quantity<=0)_.error("Poção não disponível!",{description:"Você não possui esta poção no inventário",duration:3e3});else{p(e);try{const t=await Cx.consumePotionFromSlot(n.id,e);if(t.success&&t.data){const{message:s,new_hp:a,new_mana:r}=t.data;i(a,r),n.potionUsedThisTurn=!0,y(e),setTimeout((()=>y(null)),2e3),await m(),_.success(s,{description:`HP: ${a} | Mana: ${r}`,duration:4e3})}else _.error(t.error||"Erro ao usar poção")}catch(s){_.error("Erro ao usar poção")}finally{p(null)}}else _.warning(`Slot ${D(e)} está vazio`)};e.useEffect((()=>{const e=e=>{if(A||null!==h)return;const t=e.target;if("INPUT"===t.tagName||"TEXTAREA"===t.tagName||"true"===t.contentEditable)return;const a=e.key.toLowerCase();switch(a){case"a":if(k)return;return e.preventDefault(),void s("attack");case"s":if(k||n.defenseCooldown>0)return;return e.preventDefault(),void s("defend");case"d":if(T)return;return e.preventDefault(),void I("flee")}if(k)return;let r=0;switch(a){case"q":r=1;break;case"w":r=2;break;case"e":r=3;break;default:{const t=parseInt(a)-1;if(t>=0&&t<Math.min(3,n.spells.length)){const a=n.spells[t];n.mana>=a.mana_cost&&0===a.current_cooldown&&(e.preventDefault(),s("spell",a.id))}return}}r>0&&(e.preventDefault(),R(r))};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)}),[k,T,h,c,n.spells,n.mana,n.defenseCooldown,P,A]);const D=e=>{switch(e){case 1:return"Q";case 2:return"W";case 3:return"E";default:return""}},q=(e,t)=>{f({...e,position:t})},$=e.useCallback((()=>{const e=Date.now()-C.current;return!w.current&&!(e<300)}),[]),I=e.useCallback((async(e,t,a)=>{if($()){a?.preventDefault?.(),w.current=!0,C.current=Date.now();try{await s(e,t)}finally{setTimeout((()=>{w.current=!1}),300)}}}),[$,s]),L=(e,t)=>{const s=t.currentTarget.getBoundingClientRect(),a={x:s.left+s.width/2,y:s.top-10},r=setTimeout((()=>{q(e,a)}),500);b(r)},V=()=>{g&&(clearTimeout(g),b(null))},F=()=>{g&&(clearTimeout(g),b(null)),E.current&&clearTimeout(E.current),E.current=setTimeout((()=>{f(null)}),150)},O=(e,t)=>{t.preventDefault();const s=t.currentTarget.getBoundingClientRect(),a={x:s.left+s.width/2,y:s.top-10},r=setTimeout((()=>{q(e,a)}),500);b(r)},z=()=>{g&&(clearTimeout(g),b(null))},B=n.spells.slice(0,3);return t.jsxs(t.Fragment,{children:[A&&t.jsx("div",{className:"absolute inset-0 bg-black/60 backdrop-blur-sm z-50 flex items-center justify-center rounded-xl",children:t.jsxs("div",{className:"text-center space-y-3",children:[t.jsx("div",{className:"text-red-400 text-2xl animate-pulse",children:"💀"}),t.jsx("div",{className:"text-red-400 font-bold text-lg",children:"Personagem Morto"}),t.jsx("div",{className:"text-muted-foreground text-sm",children:"Interface bloqueada"})]})}),t.jsx(rh,{className:"border-0 bg-card/50 backdrop-blur-sm relative",children:t.jsxs(lh,{className:"p-3 md:p-3 space-y-3 md:space-y-2",children:[M&&!A&&t.jsx("div",{className:"mb-4 p-4 bg-gradient-to-r from-green-500/10 via-emerald-500/10 to-teal-500/10 border border-green-500/20 rounded-xl animate-in slide-in-from-top-2 duration-500",children:t.jsxs("div",{className:"text-center space-y-3",children:[t.jsxs("div",{className:"flex items-center justify-center gap-2",children:[t.jsx("div",{className:"text-lg",children:"⚔️"}),t.jsx("div",{className:"text-sm text-green-400 font-medium",children:"Inimigo derrotado - Pronto para avançar"}),t.jsx("div",{className:"text-lg",children:"⚔️"})]}),t.jsxs("div",{className:"bg-background/30 rounded-lg p-3 border border-green-500/10",children:[t.jsx("div",{className:"text-xs text-green-300 font-medium mb-1",children:"Recompensas Obtidas:"}),t.jsxs("div",{className:"flex justify-center items-center gap-4 text-sm",children:[t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(gt,{className:"h-4 w-4 text-blue-400"}),t.jsxs("span",{className:"text-blue-400 font-semibold",children:["+",l?.xp," XP"]})]}),t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx("span",{className:"text-yellow-400 text-lg",children:"💰"}),t.jsxs("span",{className:"text-yellow-400 font-semibold",children:["+",l?.gold," Gold"]})]}),l?.drops&&l.drops.length>0&&t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx("span",{className:"text-purple-400 text-lg",children:"📦"}),t.jsxs("span",{className:"text-purple-400 font-semibold",children:["+",l.drops.length," item",l.drops.length>1?"s":""]})]})]}),l?.leveledUp&&t.jsx("div",{className:"mt-2 text-center",children:t.jsxs(uh,{className:"bg-yellow-500/20 text-yellow-400 border-yellow-500/30 animate-pulse",children:["🎊 LEVEL UP! Nível ",l.newLevel]})})]}),t.jsx(Da,{onClick:S,disabled:r.performAction||A||j,size:"lg",className:"bg-gradient-to-r from-green-600 to-emerald-600 hover:from-green-700 hover:to-emerald-700 text-white font-semibold px-6 py-3 rounded-xl shadow-lg shadow-green-500/20 transition-all duration-200 transform hover:scale-105 w-full md:w-auto cursor-pointer",children:r.performAction||j?t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-2 border-white border-t-transparent mr-2"}),"Avançando..."]}):t.jsxs(t.Fragment,{children:[t.jsx(Wt,{className:"h-4 w-4 mr-2"}),"Continuar Aventura"]})}),t.jsx("div",{className:"text-xs text-muted-foreground",children:"Continue para o próximo andar da torre"})]})}),t.jsxs("div",{className:"flex flex-col md:flex-row md:justify-center md:items-start gap-3 md:gap-4",children:[t.jsxs("div",{className:"flex-1 md:max-w-xs md:flex-none",children:[t.jsx("div",{className:"text-xs font-medium text-muted-foreground/80 mb-2 text-center md:text-left",children:"Ações de Combate"}),t.jsxs("div",{className:"flex justify-center md:justify-start gap-2",children:[t.jsxs("div",{className:"relative",children:[t.jsx(Da,{onClick:e=>{e.preventDefault(),I("attack",void 0,e)},disabled:k||M||A,variant:"ghost",size:"lg",className:"h-12 w-12 md:h-14 md:w-14 rounded-xl p-0 border-2 border-red-500/30 bg-red-500/5 hover:bg-red-500/10 hover:border-red-500/50 shadow-lg shadow-red-500/10 transition-all duration-200 cursor-pointer "+(A?"opacity-30 cursor-not-allowed":""),children:t.jsx(qe,{className:"h-4 w-4 md:h-5 md:w-5 text-red-500/80"})}),t.jsx(uh,{variant:"outline",className:"absolute -top-1 -right-1 md:-top-2 md:-right-2 h-4 w-4 md:h-5 md:w-5 p-0 text-xs font-medium flex items-center justify-center bg-background/90 border-muted-foreground/30 hidden md:flex",children:"A"})]}),t.jsxs("div",{className:"relative",children:[t.jsx(Da,{onClick:e=>{e.preventDefault(),I("defend",void 0,e)},disabled:k||n.defenseCooldown>0||M||A,variant:"ghost",size:"lg",className:"h-12 w-12 md:h-14 md:w-14 rounded-xl p-0 border-2 border-blue-500/30 bg-blue-500/5 hover:bg-blue-500/10 hover:border-blue-500/50 shadow-lg shadow-blue-500/10 transition-all duration-200 cursor-pointer "+(A?"opacity-30 cursor-not-allowed":""),children:t.jsx($e,{className:"h-4 w-4 md:h-5 md:w-5 text-blue-500/80"})}),t.jsx(uh,{variant:"outline",className:"absolute -top-1 -right-1 md:-top-2 md:-right-2 h-4 w-4 md:h-5 md:w-5 p-0 text-xs font-medium flex items-center justify-center bg-background/90 border-muted-foreground/30 hidden md:flex",style:{display:n.defenseCooldown>0?"none":"flex"},children:"S"})]}),t.jsxs("div",{className:"relative",children:[t.jsx(Da,{onClick:e=>{e.preventDefault(),I("flee")},disabled:T,variant:"ghost",size:"lg",className:"h-12 w-12 md:h-14 md:w-14 rounded-xl p-0 border-2 border-amber-500/30 bg-amber-500/5 hover:bg-amber-500/10 hover:border-amber-500/50 shadow-lg shadow-amber-500/10 transition-all duration-200 cursor-pointer "+(A?"opacity-30 cursor-not-allowed":r.performAction?"opacity-50 animate-pulse":""),children:t.jsx(Te,{className:"h-4 w-4 md:h-5 md:w-5 text-amber-500/80"})}),t.jsx(uh,{variant:"outline",className:"absolute -top-1 -right-1 md:-top-2 md:-right-2 h-4 w-4 md:h-5 md:w-5 p-0 text-xs font-medium flex items-center justify-center bg-background/90 border-muted-foreground/30 hidden md:flex",children:"D"})]})]})]}),t.jsxs("div",{className:"flex-1 md:max-w-xs md:flex-none",children:[t.jsxs("div",{className:"text-xs font-medium text-muted-foreground/80 mb-2 text-center md:text-right",children:["Poções Rápidas",P&&t.jsx("span",{className:"ml-2 text-orange-400 text-xs",children:"• Poção usada neste turno"})]}),t.jsx("div",{className:"flex justify-center md:justify-end gap-2",children:d?[1,2,3].map((e=>t.jsx("div",{className:"w-12 h-12 md:w-14 md:h-14 bg-muted/20 rounded-xl animate-pulse"},e))):c.map((e=>{const s=h===e.slot_position,a=!e.consumable_id,r=D(e.slot_position),n=P&&!a,i=v===e.slot_position,o=i?Math.max(0,e.available_quantity-1):e.available_quantity,l={title:e.consumable_name||`Slot ${r}`,description:a?"Slot vazio - Configure no inventário":0===o?"Sem unidades disponíveis":P?"Poção já usada neste turno":e.consumable_description||"Poção",stats:a?[]:[{label:"Efeito",value:`+${e.effect_value}`},{label:"Disponível",value:`x${o}`},{label:"Tecla",value:r},...P?[{label:"Status",value:"Indisponível neste turno"}]:[]]},c=!a&&0===o;return t.jsxs("div",{className:"relative",children:[t.jsxs(Da,{onClick:()=>R(e.slot_position),disabled:k||a||s||M||n||c||A,variant:"ghost",className:`h-12 w-12 md:h-14 md:w-14 rounded-xl p-2 relative border-2 transition-all duration-200 cursor-pointer ${a?"border-dashed border-muted-foreground/20 bg-transparent hover:bg-muted/10 hover:border-muted-foreground/30":c?"border-red-500/30 bg-red-500/5 opacity-50 cursor-not-allowed":n?"border-orange-500/30 bg-orange-500/5 opacity-50 cursor-not-allowed":"border-emerald-500/30 bg-emerald-500/5 hover:bg-emerald-500/10 hover:border-emerald-500/50 shadow-lg shadow-emerald-500/10"} ${s?"opacity-50":""} ${i?"animate-pulse scale-110":""} ${A?"opacity-30 cursor-not-allowed":""}`,onMouseDown:e=>L(l,e),onMouseUp:V,onMouseLeave:F,onTouchStart:e=>O(l,e),onTouchEnd:z,children:[a?t.jsx(Ze,{className:"h-4 w-4 md:h-5 md:w-5 text-muted-foreground/40"}):e.consumable_id?t.jsxs("div",{className:"flex items-center justify-center",children:[t.jsx(kx,{consumable:{id:e.consumable_id,name:e.consumable_name||"Poção",description:e.consumable_description||"",type:e.consumable_type||"potion",effect_value:e.effect_value||0,price:e.consumable_price||0,level_requirement:1,created_at:"",updated_at:""},size:"lg",className:"h-5 w-5",showFallback:!0}),(n||c)&&t.jsxs("div",{className:"absolute inset-0 flex items-center justify-center",children:[t.jsx("div",{className:"w-6 h-0.5 bg-red-500 rotate-45 absolute"}),t.jsx("div",{className:"w-6 h-0.5 bg-red-500 -rotate-45 absolute"})]})]}):null,s&&t.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-background/80 rounded-xl",children:t.jsx("div",{className:"animate-spin rounded-full h-3 w-3 md:h-4 md:w-4 border-2 border-primary border-t-transparent"})}),i&&t.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:t.jsx("div",{className:"text-green-400 font-bold text-xs animate-bounce",children:"✓"})})]}),!a&&t.jsx("div",{className:"absolute -bottom-1 -left-1 text-white text-xs rounded-full h-5 w-5 flex items-center justify-center border border-background font-semibold "+(c?"bg-red-500/90":o<5?"bg-orange-500/90":"bg-emerald-500/90"),children:o}),t.jsx(uh,{variant:"outline",className:"absolute -top-1 -right-1 md:-top-2 md:-right-2 h-4 w-4 md:h-5 md:w-5 p-0 text-xs font-medium flex items-center justify-center border-muted-foreground/30 "+(n?"bg-orange-500/20 text-orange-400 border-orange-500/30":c?"bg-red-500/20 text-red-400 border-red-500/30":"bg-background/90"),children:r}),n&&t.jsx("div",{className:"absolute top-0 left-0 bg-orange-500 text-white text-xs rounded-full h-4 w-4 flex items-center justify-center border border-background",children:"✗"}),c&&t.jsx("div",{className:"absolute top-0 left-0 bg-red-500 text-white text-xs rounded-full h-4 w-4 flex items-center justify-center border border-background",children:"⚠"})]},e.slot_position)}))})]})]}),B.length>0&&t.jsx(t.Fragment,{children:t.jsxs("div",{className:"border-t border-border/50 pt-2",children:[t.jsx("div",{className:"text-xs font-medium text-muted-foreground/80 mb-2 text-center",children:"Magias"}),t.jsx("div",{className:"flex justify-center gap-2 md:max-w-md md:mx-auto",children:B.map(((e,s)=>{const a=n.mana>=e.mana_cost&&0===e.current_cooldown,r=(e=>{const s=e.name.toLowerCase(),a=e.description.toLowerCase();return s.includes("bola de fogo")||s.includes("fireball")||a.includes("fogo")?t.jsx(Gt,{className:"h-4 w-4"}):s.includes("raio de gelo")||s.includes("ice")||a.includes("gelo")?t.jsx(Xt,{className:"h-4 w-4"}):s.includes("cura")||s.includes("heal")||a.includes("restaura")?t.jsx(Ue,{className:"h-4 w-4"}):s.includes("raio")||s.includes("bolt")||a.includes("raio")?t.jsx(Ie,{className:"h-4 w-4"}):s.includes("escudo")||s.includes("shield")||a.includes("defesa")?t.jsx(Ut,{className:"h-4 w-4"}):s.includes("dano")||a.includes("damage")||a.includes("dano")?t.jsx(vt,{className:"h-4 w-4"}):a.includes("overtime")||a.includes("tempo")?t.jsx(Bt,{className:"h-4 w-4"}):t.jsx(ft,{className:"h-4 w-4"})})(e),i=(s+1).toString(),o={title:e.name,description:e.description,stats:[{label:"Custo de Mana",value:`${e.mana_cost}`},{label:"Cooldown",value:e.current_cooldown>0?`${e.current_cooldown} turnos`:"Disponível"},{label:"Dano/Efeito",value:`${e.effect_value}`},{label:"Tecla",value:i}]};return t.jsxs("div",{className:"relative",children:[t.jsxs(Da,{onClick:t=>{return s=t,a=e.id,s.preventDefault(),void I("spell",a,s);var s,a},onMouseDown:e=>L(o,e),onMouseUp:V,onMouseLeave:F,onTouchStart:e=>O(o,e),onTouchEnd:z,disabled:k||!a||M||A,variant:"ghost",size:"lg",className:`h-12 w-12 md:h-14 md:w-14 rounded-xl p-0 relative border-2 transition-all duration-200 cursor-pointer ${a?"border-violet-500/30 bg-violet-500/5 hover:bg-violet-500/10 hover:border-violet-500/50 shadow-lg shadow-violet-500/10":"border-muted-foreground/10 bg-muted/5 opacity-50 cursor-not-allowed"} ${A?"opacity-30 cursor-not-allowed":""}`,children:[t.jsx("div",{className:a?"text-violet-500/80":"text-muted-foreground/50",children:r}),e.current_cooldown>0&&t.jsx("div",{className:"absolute -top-1 -right-1 bg-red-500/90 text-white text-xs rounded-full h-4 w-4 flex items-center justify-center border border-background",children:e.current_cooldown}),t.jsx("div",{className:"absolute -bottom-1 -right-1 text-white text-xs rounded-full h-4 w-4 flex items-center justify-center border border-background "+(a?"bg-blue-500/90":"bg-muted-foreground/70"),children:e.mana_cost})]}),t.jsx(uh,{variant:"outline",className:"absolute -top-1 -left-1 md:-top-2 md:-left-2 h-4 w-4 md:h-5 md:w-5 p-0 text-xs font-medium flex items-center justify-center bg-background/90 border-muted-foreground/30 hidden md:flex",children:i})]},e.id)}))})]})}),t.jsx("div",{className:"hidden md:block text-center",children:t.jsx("div",{className:"text-xs text-muted-foreground/60",children:A?"Interface bloqueada - Personagem morto":"Atalhos: A/S/D (Combate) • Q/W/E (Poções) • 1/2/3 (Magias)"})})]})}),x&&t.jsx("div",{className:"fixed z-50 pointer-events-none",style:{left:x.position.x,top:x.position.y,transform:"translate(-50%, -100%)"},children:t.jsxs("div",{className:"bg-background/95 backdrop-blur-sm border border-border/50 rounded-lg p-3 shadow-xl max-w-xs",children:[t.jsx("h4",{className:"font-medium text-sm mb-1",children:x.title}),t.jsx("p",{className:"text-xs text-muted-foreground mb-2 leading-relaxed",children:x.description}),x.stats.length>0&&t.jsx("div",{className:"space-y-1",children:x.stats.map(((e,s)=>t.jsxs("div",{className:"flex justify-between text-xs",children:[t.jsxs("span",{className:"text-muted-foreground",children:[e.label,":"]}),t.jsx("span",{className:"font-medium",children:e.value})]},s)))})]})})]})}function Jx({isOpen:s,onContinue:a,onReturnToHub:r,onOpenAttributeModal:n,rewards:i,leveledUp:o,newLevel:l,hasAttributePoints:c}){const d=Vx();e.useEffect((()=>{if(d){const e=document.createElement("style");return e.textContent="\n        .victory-modal-landscape .scroll-area {\n          max-height: calc(90vh - 140px);\n          overflow-y: auto;\n          -webkit-overflow-scrolling: touch;\n        }\n        .victory-modal-buttons {\n          min-height: 24px !important;\n          padding: 0.15rem 0.3rem !important;\n          font-size: 0.65rem !important;\n          font-weight: 600 !important;\n          line-height: 1 !important;\n        }\n        .victory-modal-landscape [data-radix-dialog-content] {\n          max-height: 90vh !important;\n        }\n      ",document.head.appendChild(e),()=>{document.head.removeChild(e)}}}),[d]);return t.jsx(zl,{children:s&&t.jsx(Kh,{open:s,children:t.jsxs(Qh,{className:"overflow-hidden "+(d?"max-w-[98vw] max-h-[98vh] p-2 victory-modal-landscape w-[98vw]":"sm:max-w-[425px]"),children:[t.jsxs(ep,{className:"relative "+(d?"pb-2":""),children:[!d&&t.jsx(Ou.div,{initial:{scale:0},animate:{scale:1},transition:{type:"spring",duration:.5},className:"absolute -top-12 left-1/2 -translate-x-1/2 w-24 h-24 bg-yellow-500/20 rounded-full flex items-center justify-center",children:t.jsx(re,{className:"h-12 w-12 text-yellow-500"})}),t.jsxs(Ou.div,{initial:{y:20,opacity:0},animate:{y:0,opacity:1},transition:{delay:.3},className:"flex items-center gap-3 "+(d?"justify-start":"flex-col text-center pt-12"),children:[d&&t.jsx(Ou.div,{initial:{scale:0},animate:{scale:1},transition:{type:"spring",duration:.5},className:"w-10 h-10 bg-yellow-500/20 rounded-full flex items-center justify-center flex-shrink-0",children:t.jsx(re,{className:"h-5 w-5 text-yellow-500"})}),t.jsxs("div",{className:d?"text-left":"text-center",children:[t.jsx(sp,{className:"font-bold "+(d?"text-base":"text-2xl"),children:"Vitória!"}),t.jsx(ap,{className:""+(d?"text-xs":""),children:"Você derrotou o inimigo e avançou para o próximo andar!"})]})]})]}),t.jsx("div",{className:d?"scroll-area overflow-y-auto max-h-[calc(98vh-100px)]":"",children:t.jsxs(Ou.div,{className:""+(d?"py-1 space-y-1":"space-y-4 py-4"),initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.5},children:[t.jsxs("div",{className:""+(d?"grid grid-cols-2 gap-1 mb-1":"space-y-4"),children:[t.jsxs(Ou.div,{className:"flex items-center gap-2 bg-primary/10 rounded-lg "+(d?"p-1":"p-3 text-lg"),whileHover:{scale:1.02},children:[t.jsx(gt,{className:"text-yellow-500 "+(d?"h-3 w-3":"h-6 w-6")}),t.jsxs("div",{className:"min-w-0 flex-1",children:[t.jsx("div",{className:"font-semibold "+(d?"text-xs":""),children:"Experiência"}),t.jsxs("div",{className:"font-bold text-primary "+(d?"text-xs":"text-2xl"),children:["+",i.xp," XP"]})]})]}),t.jsxs(Ou.div,{className:"flex items-center gap-2 bg-primary/10 rounded-lg "+(d?"p-1":"p-3 text-lg"),whileHover:{scale:1.02},children:[t.jsx(ze,{className:"text-yellow-400 "+(d?"h-3 w-3":"h-6 w-6")}),t.jsxs("div",{className:"min-w-0 flex-1",children:[t.jsx("div",{className:"font-semibold "+(d?"text-xs":""),children:"Ouro"}),t.jsxs("div",{className:"font-bold text-primary "+(d?"text-xs":"text-2xl"),children:["+",Gh(i.gold)," Gold"]})]})]})]}),o&&l&&t.jsxs(Ou.div,{className:"rounded-lg bg-gradient-to-r from-primary/20 to-primary/30 text-center "+(d?"p-2 mt-2":"p-4 mt-2"),initial:{scale:.8,opacity:0},animate:{scale:1,opacity:1},transition:{delay:.7,type:"spring"},children:[t.jsxs("div",{className:"flex items-center gap-2 "+(d?"justify-start mb-1":"justify-center mb-2"),children:[t.jsx(ft,{className:"text-primary "+(d?"h-4 w-4":"h-6 w-6")}),t.jsxs("div",{className:"font-bold "+(d?"text-sm":"text-xl"),children:["Nível ",l,"!"]})]}),t.jsx("div",{className:"opacity-80 "+(d?"text-xs mb-1":"text-sm mb-2"),children:"Seu personagem evoluiu e ficou mais forte!"}),t.jsxs("div",{className:"grid gap-1 "+(d?"grid-cols-4 text-xs":"grid-cols-2 gap-2 text-sm"),children:[t.jsx("div",{className:"bg-background/50 rounded "+(d?"p-1":"p-2"),children:"HP +10"}),t.jsx("div",{className:"bg-background/50 rounded "+(d?"p-1":"p-2"),children:"Mana +5"}),t.jsx("div",{className:"bg-background/50 rounded "+(d?"p-1":"p-2"),children:"Ataque +2"}),t.jsx("div",{className:"bg-background/50 rounded "+(d?"p-1":"p-2"),children:"Defesa +1"})]})]}),i.drops.length>0&&t.jsxs(Ou.div,{className:"bg-primary/10 rounded-lg "+(d?"mt-2 p-2":"mt-4 p-4"),initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.9},children:[t.jsxs("h4",{className:"font-semibold flex items-center gap-2 "+(d?"mb-1 text-xs":"mb-3"),children:[t.jsx(Nt,{className:d?"h-3 w-3":"h-5 w-5"}),"Itens Obtidos"]}),t.jsx("div",{className:""+(d?"grid grid-cols-2 gap-1":"space-y-2"),children:i.drops.map(((e,s)=>t.jsxs(Ou.div,{className:"flex items-center gap-2 bg-background/50 rounded "+(d?"p-1 text-xs":"p-2"),initial:{x:-20,opacity:0},animate:{x:0,opacity:1},transition:{delay:1+.1*s},children:[t.jsx("span",{className:d?"text-xs":"text-xl",children:"🎁"}),t.jsx("span",{className:"flex-1 truncate",children:e.name}),t.jsxs("span",{className:"font-mono flex-shrink-0",children:["x",e.quantity]})]},s)))})]})]})}),t.jsx(tp,{className:"flex flex-col gap-1 "+(d?"mt-1":"mt-4"),children:t.jsxs("div",{className:"w-full "+(d?"grid grid-cols-3 gap-1":"flex flex-col gap-2"),children:[c&&t.jsxs(Da,{onClick:()=>{n()},className:"bg-gradient-to-r from-purple-500 to-purple-600 hover:from-purple-600 hover:to-purple-700 text-white shadow-lg "+(d?"victory-modal-buttons text-xs":"w-full"),children:[t.jsx(Oe,{className:""+(d?"h-3 w-3":"h-4 w-4 mr-2")}),d?"Pts":"Distribuir Pontos de Atributo"]}),t.jsxs(Da,{onClick:()=>{r()},variant:"outline",className:"items-center justify-center "+(d?"victory-modal-buttons text-xs":"flex-1"),children:[t.jsx(Yt,{className:""+(d?"h-3 w-3":"h-4 w-4 mr-2")}),d?"":"Voltar ao Hub"]}),t.jsxs(Da,{onClick:()=>{a()},className:"bg-emerald-500 hover:bg-emerald-600 "+(d?"victory-modal-buttons text-xs":"flex-1"),children:[t.jsx(Wt,{className:""+(d?"h-3 w-3":"h-4 w-4 mr-2")}),"Continuar"]})]})})]})})})}function Zx({isOpen:s,onClose:a,player:r,gameMessage:n=`${r.name} foi derrotado no Andar ${r.floor}...`,highestFloor:o=r.floor,isCharacterDeleted:l=!1,userId:c,onReturnToCharacterSelect:d,onViewCemetery:m}){const u=i(),[h,p]=e.useState(!1),[x,f]=e.useState(!1),g=Vx();return t.jsx(Kh,{open:s,onOpenChange:a,children:t.jsxs(Qh,{className:"overflow-hidden "+(g?"max-w-[95vw] max-h-[95vh] w-[95vw] p-3":"sm:max-w-md"),children:[t.jsx(ep,{className:"text-center "+(g?"pb-2":""),children:t.jsxs(sp,{className:"flex items-center justify-center gap-2 "+(g?"text-lg":"text-2xl"),children:[t.jsx(Le,{className:"text-red-500 "+(g?"h-5 w-5":"h-8 w-8")}),l?"Permadeath - Personagem Perdido":"Fim de Jogo"]})}),t.jsxs("div",{className:""+(g?"space-y-2 max-h-[calc(95vh-140px)] overflow-y-auto":"space-y-4"),children:[t.jsxs("div",{className:"text-center",children:[t.jsx("p",{className:"mb-2 "+(g?"text-sm":"text-lg"),children:n}),t.jsxs("div",{className:"flex items-center justify-center gap-2 mb-2 "+(g?"mb-2":"mb-4"),children:[t.jsx(re,{className:"text-yellow-500 "+(g?"h-4 w-4":"h-6 w-6")}),t.jsxs("span",{className:"font-bold "+(g?"text-lg":"text-2xl"),children:["Andar ",r.floor-1]})]}),t.jsxs("p",{className:"text-muted-foreground "+(g?"text-xs":"text-sm"),children:["Seu recorde atual: Andar ",o]})]}),t.jsxs("div",{className:g?"grid grid-cols-2 gap-2":"space-y-3",children:[t.jsxs("div",{className:"bg-muted rounded-lg "+(g?"p-2":"p-4"),children:[t.jsx("h3",{className:"font-medium mb-2 "+(g?"text-sm":""),children:"Estatísticas Finais"}),t.jsxs("div",{className:"grid grid-cols-2 gap-1 "+(g?"text-xs":"gap-2 text-sm"),children:[t.jsx("div",{children:"Personagem:"}),t.jsx("div",{className:"font-medium truncate",children:r.name}),t.jsx("div",{children:"Andares:"}),t.jsx("div",{className:"font-medium",children:r.floor-1}),t.jsx("div",{children:"HP final:"}),t.jsxs("div",{className:"font-medium",children:[r.hp,"/",r.max_hp]}),t.jsx("div",{children:"Nível:"}),t.jsx("div",{className:"font-medium",children:r.level}),t.jsx("div",{children:"Gold:"}),t.jsx("div",{className:"font-medium",children:Gh(r.gold)}),t.jsx("div",{children:"XP total:"}),t.jsx("div",{className:"font-medium",children:Gh(r.xp)})]})]}),t.jsxs("div",{className:"bg-red-500/10 border border-red-500/20 rounded-lg "+(g?"p-2":"p-4"),children:[t.jsxs("div",{className:"flex items-center gap-2 mb-2 "+(g?"mb-1":""),children:[t.jsx(Ft,{className:"text-red-400 "+(g?"h-3 w-3":"h-5 w-5")}),t.jsx("span",{className:"font-medium text-red-400 "+(g?"text-xs":"text-sm"),children:"Aviso de Permadeath"})]}),t.jsx("p",{className:"text-red-400 mb-2 "+(g?"text-xs mb-1":"text-sm"),children:l?"Este personagem foi permanentemente deletado.":"Este personagem será permanentemente deletado ao continuar."}),t.jsx("p",{className:"text-red-300 text-xs",children:"Suas estatísticas serão salvas no ranking para comparação."})]})]}),l&&t.jsx("div",{className:"bg-blue-500/10 border border-blue-500/20 rounded-lg "+(g?"p-2":"p-3"),children:t.jsxs("div",{className:"text-blue-400 text-xs",children:["💀 ",t.jsx("strong",{children:"Estatísticas da Jornada:"}),t.jsx("br",{}),t.jsxs("div",{className:"mt-1 "+(g?"grid grid-cols-2 gap-1":""),children:[t.jsxs("div",{children:["• Nível alcançado: ",r.level]}),t.jsxs("div",{children:["• Andar mais alto: ",r.floor]}),t.jsxs("div",{children:["• Gold acumulado: ",r.gold]}),t.jsxs("div",{children:["• XP total: ",r.xp]})]})]})})]}),t.jsxs("div",{className:"flex gap-2 "+(g?"flex-row pt-2":"flex-col pt-4"),children:[l&&t.jsxs(Da,{variant:"outline",onClick:()=>{m?m():u({to:"/game/play/hub/cemetery",search:{character:r.id}})},className:"border-blue-500/30 text-blue-400 hover:bg-blue-500/10 "+(g?"flex-1 text-xs h-8":"w-full"),disabled:h||x,children:[t.jsx(qt,{className:"mr-1 "+(g?"h-3 w-3":"h-4 w-4 mr-2")}),g?"Cemitério":"Ver Cemitério"]}),t.jsx(Da,{variant:"destructive",onClick:async()=>{if(c&&r.id)try{p(!0),f(!0);const e=await zh.saveScore({player_name:r.name,floor:r.floor-1,user_id:c,character_level:r.level,character_gold:r.gold,character_alive:!1});if(e.error)throw new Error(e.error);if(!l){const{error:e}=await ta.deleteCharacter(r.id);if(e)throw new Error(e)}_.success("Fim de jogo",{description:"Pontuação salva e personagem deletado permanentemente."}),d()}catch(e){_.error("Erro ao finalizar jogo",{description:e instanceof Error?e.message:"Erro desconhecido"})}finally{p(!1),f(!1)}},disabled:h||x,className:""+(g?"flex-1 text-xs h-8":"w-full"),children:h||x?t.jsxs("span",{className:"flex items-center gap-1",children:[t.jsx("div",{className:"animate-spin rounded-full border-t-2 border-b-2 border-white "+(g?"h-3 w-3":"h-4 w-4")}),"Finalizando..."]}):t.jsxs("span",{className:"flex items-center gap-1",children:[t.jsx(Le,{className:""+(g?"h-3 w-3":"h-4 w-4")}),g?"Aceitar Derrota":l?"Criar Novo Personagem":"Aceitar Derrota e Salvar"]})}),t.jsxs(Da,{variant:"outline",onClick:()=>{u({to:"/game/ranking"})},className:""+(g?"flex-1 text-xs h-8":"w-full"),disabled:h||x,children:[t.jsx(re,{className:"mr-1 "+(g?"h-3 w-3":"h-4 w-4 mr-2")}),g?"Ranking":"Ver Ranking"]})]})]})})}const Qx=({isOpen:s,onClose:a,character:r,onAttributesUpdated:n})=>{const[i,o]=e.useState({strength:0,dexterity:0,intelligence:0,wisdom:0,vitality:0,luck:0}),[l,c]=e.useState(!1),d=Vx(),m=Object.values(i).reduce(((e,t)=>e+t),0),u=(r.attribute_points||0)-m,h=()=>{o({strength:0,dexterity:0,intelligence:0,wisdom:0,vitality:0,luck:0})},p={strength:{label:"Força",icon:Oe,color:"text-red-400",bgColor:"bg-red-500/10",borderColor:"border-red-500/20",benefit:"+2 Ataque + 0.5% Dano Crítico"},dexterity:{label:"Destreza",icon:Ie,color:"text-green-400",bgColor:"bg-green-500/10",borderColor:"border-green-500/20",benefit:"+1.5 Velocidade + 0.3% Crítico"},intelligence:{label:"Inteligência",icon:ft,color:"text-purple-400",bgColor:"bg-purple-500/10",borderColor:"border-purple-500/20",benefit:"+5 Mana + 10% Dano Mágico"},wisdom:{label:"Sabedoria",icon:qt,color:"text-blue-400",bgColor:"bg-blue-500/10",borderColor:"border-blue-500/20",benefit:"+1 Def + 5% Magia + 12% Cura"},vitality:{label:"Vitalidade",icon:Ue,color:"text-pink-400",bgColor:"bg-pink-500/10",borderColor:"border-pink-500/20",benefit:"+8 HP + 1 Defesa"},luck:{label:"Sorte",icon:gt,color:"text-yellow-400",bgColor:"bg-yellow-500/10",borderColor:"border-yellow-500/20",benefit:"+0.5% Crítico + 1% Dano Crítico"}};return s&&r.attribute_points&&0!==r.attribute_points?t.jsx(Kh,{open:s,onOpenChange:a,children:t.jsxs(Qh,{className:"overflow-hidden "+(d?"max-w-[95vw] max-h-[95vh] w-[95vw] p-3":"sm:max-w-2xl max-h-[90vh] overflow-y-auto"),children:[t.jsxs(ep,{className:""+(d?"pb-2":"text-center"),children:[!d&&t.jsx(Ou.div,{initial:{scale:0},animate:{scale:1},transition:{type:"spring",duration:.5},className:"mx-auto w-16 h-16 bg-yellow-500/20 rounded-full flex items-center justify-center mb-4",children:t.jsx(gt,{className:"h-8 w-8 text-yellow-500"})}),t.jsxs(Ou.div,{initial:{y:20,opacity:0},animate:{y:0,opacity:1},transition:{delay:.3},className:"flex items-center gap-3 "+(d?"justify-start":"flex-col text-center"),children:[d&&t.jsx(Ou.div,{initial:{scale:0},animate:{scale:1},transition:{type:"spring",duration:.5},className:"w-10 h-10 bg-yellow-500/20 rounded-full flex items-center justify-center flex-shrink-0",children:t.jsx(gt,{className:"h-5 w-5 text-yellow-500"})}),t.jsxs("div",{className:d?"text-left flex-1":"text-center",children:[t.jsx(sp,{className:"font-bold "+(d?"text-lg":"text-xl"),children:"Distribuir Pontos de Atributo"}),t.jsx(ap,{asChild:!0,children:t.jsxs("div",{className:""+(d?"flex items-center justify-between mt-1":"text-center space-y-3"),children:[t.jsxs(uh,{variant:"outline",className:"bg-yellow-500/10 border-yellow-500/30 text-yellow-400 "+(d?"px-2 py-1 text-xs":"px-3 py-1"),children:[t.jsx(gt,{className:"mr-2 "+(d?"h-3 w-3":"h-4 w-4")}),u," pontos"]}),!d&&t.jsx("p",{className:"text-sm text-muted-foreground",children:"Distribua seus pontos estrategicamente para fortalecer seu personagem na torre."})]})})]})]})]}),t.jsx("div",{className:""+(d?"overflow-y-auto max-h-[calc(95vh-120px)]":""),children:t.jsxs(Ou.div,{className:""+(d?"py-2":"space-y-4 py-4"),initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.3},children:[t.jsx("div",{className:""+(d?"grid grid-cols-2 gap-2 mb-3":"space-y-3"),children:Object.entries(p).map((([e,s])=>{const a=e,n=r[a]||0,l=s.icon;return t.jsxs(Ou.div,{className:`flex items-center gap-2 rounded-lg border ${s.bgColor} ${s.borderColor} ${d?"p-2 text-xs":"gap-3 p-3"}`,whileHover:{scale:1.01},children:[t.jsxs("div",{className:"flex items-center gap-2 flex-1 "+(d?"min-w-0":"gap-3"),children:[t.jsx(l,{className:`flex-shrink-0 ${s.color} ${d?"h-4 w-4":"h-5 w-5"}`}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsx("div",{className:"font-semibold "+(d?"text-xs truncate":"text-sm"),children:s.label}),!d&&t.jsx("div",{className:"text-xs text-muted-foreground",children:s.benefit})]})]}),t.jsx("div",{className:"text-center "+(d?"min-w-[40px]":"min-w-[60px]"),children:t.jsxs("div",{className:"font-bold "+(d?"text-xs":"text-sm"),children:[n,i[a]>0&&t.jsxs("span",{className:"text-green-400 ml-1",children:["+",i[a]]})]})}),t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(Da,{size:"icon",variant:"ghost",className:"rounded-full "+(d?"h-6 w-6":"h-8 w-8"),onClick:()=>(e=>{i[e]>0&&o((t=>({...t,[e]:t[e]-1})))})(a),disabled:0===i[a],children:t.jsx($t,{className:d?"h-3 w-3":"h-4 w-4"})}),t.jsx("div",{className:"text-center font-mono "+(d?"w-6 text-xs":"w-8 text-sm"),children:i[a]}),t.jsx(Da,{size:"icon",variant:"ghost",className:"rounded-full "+(d?"h-6 w-6":"h-8 w-8"),onClick:()=>(e=>{u>0&&o((t=>({...t,[e]:t[e]+1})))})(a),disabled:0===u,children:t.jsx(Ze,{className:d?"h-3 w-3":"h-4 w-4"})})]})]},a)}))}),m>0&&t.jsxs(Ou.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},className:"bg-primary/5 border border-primary/20 rounded-lg "+(d?"p-2 mt-2":"p-3"),children:[t.jsxs("div",{className:"font-medium mb-2 flex items-center gap-2 "+(d?"text-xs":"text-sm"),children:[t.jsx(vt,{className:"text-primary "+(d?"h-3 w-3":"h-4 w-4")}),"Preview dos Melhoramentos"]}),t.jsxs("div",{className:"grid gap-1 "+(d?"grid-cols-4 text-xs":"grid-cols-2 gap-2 text-xs"),children:[i.vitality>0&&t.jsxs("div",{className:"flex justify-between",children:[t.jsx("span",{children:"HP:"}),t.jsxs("span",{className:"text-green-400",children:["+",8*i.vitality]})]}),i.intelligence>0&&t.jsxs("div",{className:"flex justify-between",children:[t.jsx("span",{children:"Mana:"}),t.jsxs("span",{className:"text-blue-400",children:["+",5*i.intelligence]})]}),i.strength>0&&t.jsxs("div",{className:"flex justify-between",children:[t.jsx("span",{children:"Ataque:"}),t.jsxs("span",{className:"text-red-400",children:["+",2*i.strength]})]}),i.dexterity>0&&t.jsxs("div",{className:"flex justify-between",children:[t.jsx("span",{children:"Velocidade:"}),t.jsxs("span",{className:"text-green-400",children:["+",Math.floor(1.5*i.dexterity)]})]})]})]})]})}),t.jsxs("div",{className:"flex gap-2 pt-2",children:[t.jsx(Da,{variant:"outline",onClick:a,className:"flex-1 "+(d?"text-xs h-8":""),children:"Cancelar"}),m>0&&t.jsxs(Da,{variant:"outline",onClick:h,className:"flex-1 "+(d?"text-xs h-8":""),children:[t.jsx(It,{className:"mr-1 "+(d?"h-3 w-3":"h-4 w-4 mr-2")}),d?"Reset":"Resetar"]}),t.jsxs(Da,{onClick:async()=>{if(0!==m){c(!0);try{const e=await ta.distributeAttributePoints(r.id,i);if(e.success&&e.data?.new_stats){if(_.success("Pontos distribuídos com sucesso!"),n){const t={...r,...e.data.new_stats,attribute_points:e.data.new_stats.attribute_points};n(t)}h(),a()}else _.error("Erro ao distribuir pontos",{description:e.error||e.data?.message})}catch(e){_.error("Erro ao distribuir pontos")}finally{c(!1)}}},disabled:l||0===m,className:"flex-1 bg-emerald-500 hover:bg-emerald-600 "+(d?"text-xs h-8":""),children:[l?t.jsx("div",{className:"animate-spin rounded-full border-2 border-white border-t-transparent mr-1 "+(d?"h-3 w-3":"h-4 w-4 mr-2")}):t.jsx(Lt,{className:"mr-1 "+(d?"h-3 w-3":"h-4 w-4 mr-2")}),d?`OK (${m})`:`Confirmar (${m})`]})]})]})}):null};function ef({currentFloor:e,playerLevel:s}){h.useEffect((()=>{}),[e,s]);const a=e.floorNumber||1,r=Math.ceil(a/20),n=(a-1)%20+1,i=[5,10,15,20].includes(n),o=r>1;return t.jsx("div",{className:"mb-4",children:t.jsxs("div",{className:"text-center",children:[t.jsxs("div",{className:"flex items-center justify-center gap-2 mb-2 flex-wrap",children:[t.jsxs("h2",{className:"text-2xl font-bold text-primary",children:[(e=>{switch(e){case"boss":return"👑";case"elite":return"⭐";case"event":return"❓";default:return"🗺️"}})(e.type)," ",e.description]}),t.jsxs(uh,{variant:"outline",className:"bg-background/50",children:[t.jsx(Kt,{className:"h-3 w-3 mr-1"}),"Andar ",a]}),o&&t.jsxs(uh,{className:"bg-purple-500/20 text-purple-400 border-purple-500/30",children:[t.jsx(Qe,{className:"h-3 w-3 mr-1"}),"Tier ",r]}),i&&t.jsxs(uh,{className:"bg-red-500/20 text-red-400 border-red-500/30 animate-pulse",children:[t.jsx(vt,{className:"h-3 w-3 mr-1"}),"BOSS"]}),e.isCheckpoint&&t.jsxs(uh,{className:"bg-primary/20 text-primary",children:[t.jsx(gt,{className:"h-3 w-3 mr-1"}),"Checkpoint"]})]}),o&&t.jsx("div",{className:"text-xs text-muted-foreground mb-2",children:t.jsxs("span",{className:"bg-purple-500/10 px-2 py-1 rounded border border-purple-500/20",children:["Sistema Cíclico: Posição ",n,"/20 no Ciclo ",r,i&&" • Monstros Escalados"]})}),s<e.minLevel&&t.jsxs("div",{className:"text-yellow-500 text-sm",children:["⚠️ Nível recomendado: ",e.minLevel]}),o&&t.jsx("div",{className:"text-sm text-purple-400 mt-2",children:"Os monstros foram fortalecidos pelo poder ancestral da torre!"})]})})}var tf="Popover",[sf,af]=_e(tf,[Qt]),rf=Qt(),[nf,of]=sf(tf),lf=s=>{const{__scopePopover:a,children:r,open:n,defaultOpen:i,onOpenChange:o,modal:l=!1}=s,c=rf(a),d=e.useRef(null),[m,u]=e.useState(!1),[h,p]=cs({prop:n,defaultProp:i??!1,onChange:o,caller:tf});return t.jsx(ds,{...c,children:t.jsx(nf,{scope:a,contentId:ms(),triggerRef:d,open:h,onOpenChange:p,onOpenToggle:e.useCallback((()=>p((e=>!e))),[p]),hasCustomAnchor:m,onCustomAnchorAdd:e.useCallback((()=>u(!0)),[]),onCustomAnchorRemove:e.useCallback((()=>u(!1)),[]),modal:l,children:r})})};lf.displayName=tf;var cf="PopoverAnchor";e.forwardRef(((s,a)=>{const{__scopePopover:r,...n}=s,i=of(cf,r),o=rf(r),{onCustomAnchorAdd:l,onCustomAnchorRemove:c}=i;return e.useEffect((()=>(l(),()=>c())),[l,c]),t.jsx(us,{...o,...n,ref:a})})).displayName=cf;var df="PopoverTrigger",mf=e.forwardRef(((e,s)=>{const{__scopePopover:a,...r}=e,n=of(df,a),i=rf(a),o=es(s,n.triggerRef),l=t.jsx(ie.button,{type:"button","aria-haspopup":"dialog","aria-expanded":n.open,"aria-controls":n.contentId,"data-state":wf(n.open),...r,ref:o,onClick:rs(e.onClick,n.onOpenToggle)});return n.hasCustomAnchor?l:t.jsx(us,{asChild:!0,...i,children:l})}));mf.displayName=df;var uf="PopoverPortal",[hf,pf]=sf(uf,{forceMount:void 0}),xf=e=>{const{__scopePopover:s,forceMount:a,children:r,container:n}=e,i=of(uf,s);return t.jsx(hf,{scope:s,forceMount:a,children:t.jsx(Jt,{present:a||i.open,children:t.jsx(Zt,{asChild:!0,container:n,children:r})})})};xf.displayName=uf;var ff="PopoverContent",gf=e.forwardRef(((e,s)=>{const a=pf(ff,e.__scopePopover),{forceMount:r=a.forceMount,...n}=e,i=of(ff,e.__scopePopover);return t.jsx(Jt,{present:r||i.open,children:i.modal?t.jsx(vf,{...n,ref:s}):t.jsx(yf,{...n,ref:s})})}));gf.displayName=ff;var bf=as("PopoverContent.RemoveScroll"),vf=e.forwardRef(((s,a)=>{const r=of(ff,s.__scopePopover),n=e.useRef(null),i=es(a,n),o=e.useRef(!1);return e.useEffect((()=>{const e=n.current;if(e)return ts(e)}),[]),t.jsx(ss,{as:bf,allowPinchZoom:!0,children:t.jsx(jf,{...s,ref:i,trapFocus:r.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:rs(s.onCloseAutoFocus,(e=>{e.preventDefault(),o.current||r.triggerRef.current?.focus()})),onPointerDownOutside:rs(s.onPointerDownOutside,(e=>{const t=e.detail.originalEvent,s=0===t.button&&!0===t.ctrlKey,a=2===t.button||s;o.current=a}),{checkForDefaultPrevented:!1}),onFocusOutside:rs(s.onFocusOutside,(e=>e.preventDefault()),{checkForDefaultPrevented:!1})})})})),yf=e.forwardRef(((s,a)=>{const r=of(ff,s.__scopePopover),n=e.useRef(!1),i=e.useRef(!1);return t.jsx(jf,{...s,ref:a,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:e=>{s.onCloseAutoFocus?.(e),e.defaultPrevented||(n.current||r.triggerRef.current?.focus(),e.preventDefault()),n.current=!1,i.current=!1},onInteractOutside:e=>{s.onInteractOutside?.(e),e.defaultPrevented||(n.current=!0,"pointerdown"===e.detail.originalEvent.type&&(i.current=!0));const t=e.target,a=r.triggerRef.current?.contains(t);a&&e.preventDefault(),"focusin"===e.detail.originalEvent.type&&i.current&&e.preventDefault()}})})),jf=e.forwardRef(((e,s)=>{const{__scopePopover:a,trapFocus:r,onOpenAutoFocus:n,onCloseAutoFocus:i,disableOutsidePointerEvents:o,onEscapeKeyDown:l,onPointerDownOutside:c,onFocusOutside:d,onInteractOutside:m,...u}=e,h=of(ff,a),p=rf(a);return ns(),t.jsx(is,{asChild:!0,loop:!0,trapped:r,onMountAutoFocus:n,onUnmountAutoFocus:i,children:t.jsx(os,{asChild:!0,disableOutsidePointerEvents:o,onInteractOutside:m,onEscapeKeyDown:l,onPointerDownOutside:c,onFocusOutside:d,onDismiss:()=>h.onOpenChange(!1),children:t.jsx(ls,{"data-state":wf(h.open),role:"dialog",id:h.contentId,...p,...u,ref:s,style:{...u.style,"--radix-popover-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-popover-content-available-width":"var(--radix-popper-available-width)","--radix-popover-content-available-height":"var(--radix-popper-available-height)","--radix-popover-trigger-width":"var(--radix-popper-anchor-width)","--radix-popover-trigger-height":"var(--radix-popper-anchor-height)"}})})})})),Nf="PopoverClose";e.forwardRef(((e,s)=>{const{__scopePopover:a,...r}=e,n=of(Nf,a);return t.jsx(ie.button,{type:"button",...r,ref:s,onClick:rs(e.onClick,(()=>n.onOpenChange(!1)))})})).displayName=Nf;function wf(e){return e?"open":"closed"}e.forwardRef(((e,s)=>{const{__scopePopover:a,...r}=e,n=rf(a);return t.jsx(hs,{...n,...r,ref:s})})).displayName="PopoverArrow";var _f=xf,Cf=gf;const Ef=lf,Sf=mf,kf=e.forwardRef((({className:e,align:s="center",sideOffset:a=4,...r},n)=>t.jsx(_f,{children:t.jsx(Cf,{ref:n,align:s,sideOffset:a,className:Ta("z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-popover-content-transform-origin]",e),...r})})));kf.displayName=Cf.displayName;var Pf="Checkbox",[Af,Mf]=_e(Pf),[Tf,Rf]=Af(Pf);function Df(s){const{__scopeCheckbox:a,checked:r,children:n,defaultChecked:i,disabled:o,form:l,name:c,onCheckedChange:d,required:m,value:u="on",internal_do_not_use_render:h}=s,[p,x]=cs({prop:r,defaultProp:i??!1,onChange:d,caller:Pf}),[f,g]=e.useState(null),[b,v]=e.useState(null),y=e.useRef(!1),j=!f||(!!l||!!f.closest("form")),N={checked:p,disabled:o,setChecked:x,control:f,setControl:g,name:c,form:l,value:u,hasConsumerStoppedPropagationRef:y,required:m,defaultChecked:!Bf(i)&&i,isFormControl:j,bubbleInput:b,setBubbleInput:v};return t.jsx(Tf,{scope:a,...N,children:zf(h)?h(N):n})}var qf="CheckboxTrigger",$f=e.forwardRef((({__scopeCheckbox:s,onKeyDown:a,onClick:r,...n},i)=>{const{control:o,value:l,disabled:c,checked:d,required:m,setControl:u,setChecked:h,hasConsumerStoppedPropagationRef:p,isFormControl:x,bubbleInput:f}=Rf(qf,s),g=es(i,u),b=e.useRef(d);return e.useEffect((()=>{const e=o?.form;if(e){const t=()=>h(b.current);return e.addEventListener("reset",t),()=>e.removeEventListener("reset",t)}}),[o,h]),t.jsx(ie.button,{type:"button",role:"checkbox","aria-checked":Bf(d)?"mixed":d,"aria-required":m,"data-state":Uf(d),"data-disabled":c?"":void 0,disabled:c,value:l,...n,ref:g,onKeyDown:rs(a,(e=>{"Enter"===e.key&&e.preventDefault()})),onClick:rs(r,(e=>{h((e=>!!Bf(e)||!e)),f&&x&&(p.current=e.isPropagationStopped(),p.current||e.stopPropagation())}))})}));$f.displayName=qf;var If=e.forwardRef(((e,s)=>{const{__scopeCheckbox:a,name:r,checked:n,defaultChecked:i,required:o,disabled:l,value:c,onCheckedChange:d,form:m,...u}=e;return t.jsx(Df,{__scopeCheckbox:a,checked:n,defaultChecked:i,disabled:l,required:o,onCheckedChange:d,name:r,form:m,value:c,internal_do_not_use_render:({isFormControl:e})=>t.jsxs(t.Fragment,{children:[t.jsx($f,{...u,ref:s,__scopeCheckbox:a}),e&&t.jsx(Of,{__scopeCheckbox:a})]})})}));If.displayName=Pf;var Lf="CheckboxIndicator",Vf=e.forwardRef(((e,s)=>{const{__scopeCheckbox:a,forceMount:r,...n}=e,i=Rf(Lf,a);return t.jsx(Jt,{present:r||Bf(i.checked)||!0===i.checked,children:t.jsx(ie.span,{"data-state":Uf(i.checked),"data-disabled":i.disabled?"":void 0,...n,ref:s,style:{pointerEvents:"none",...e.style}})})}));Vf.displayName=Lf;var Ff="CheckboxBubbleInput",Of=e.forwardRef((({__scopeCheckbox:s,...a},r)=>{const{control:n,hasConsumerStoppedPropagationRef:i,checked:o,defaultChecked:l,required:c,disabled:d,name:m,value:u,form:h,bubbleInput:p,setBubbleInput:x}=Rf(Ff,s),f=es(r,x),g=ps(o),b=xs(n);e.useEffect((()=>{const e=p;if(!e)return;const t=window.HTMLInputElement.prototype,s=Object.getOwnPropertyDescriptor(t,"checked").set,a=!i.current;if(g!==o&&s){const t=new Event("click",{bubbles:a});e.indeterminate=Bf(o),s.call(e,!Bf(o)&&o),e.dispatchEvent(t)}}),[p,g,o,i]);const v=e.useRef(!Bf(o)&&o);return t.jsx(ie.input,{type:"checkbox","aria-hidden":!0,defaultChecked:l??v.current,required:c,disabled:d,name:m,value:u,form:h,...a,tabIndex:-1,ref:f,style:{...a.style,...b,position:"absolute",pointerEvents:"none",opacity:0,margin:0,transform:"translateX(-100%)"}})}));function zf(e){return"function"==typeof e}function Bf(e){return"indeterminate"===e}function Uf(e){return Bf(e)?"indeterminate":e?"checked":"unchecked"}Of.displayName=Ff;const Hf=e.forwardRef((({className:e,...s},a)=>t.jsx(If,{ref:a,className:Ta("peer h-4 w-4 shrink-0 rounded-sm border border-primary shadow focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground",e),...s,children:t.jsx(Vf,{className:Ta("flex items-center justify-center text-current"),children:t.jsx(ve,{className:"h-4 w-4"})})})));function Gf({gameLog:s}){const a=e.useRef(null),[r,n]=e.useState({system:!0,battle:!0,lore:!0,skill_xp:!0,level_up:!0,equipment:!0,enemy_action:!0,player_action:!0,damage:!0,healing:!0});e.useEffect((()=>{if(a.current){const e=a.current.querySelector("[data-radix-scroll-area-viewport]");e&&(e.scrollTop=e.scrollHeight)}}),[s]);const i=e=>{n({system:e,battle:e,lore:e,skill_xp:e,level_up:e,equipment:e,enemy_action:e,player_action:e,damage:e,healing:e})},o=s.filter((e=>r[e.type])),l=e=>{switch(e){case"system":case"player_action":return"text-blue-400";case"battle":default:return"text-foreground";case"lore":return"text-purple-400 italic";case"skill_xp":return"text-green-400";case"level_up":return"text-yellow-400 font-semibold";case"equipment":return"text-orange-400";case"enemy_action":return"text-red-400";case"damage":return"text-red-300";case"healing":return"text-green-300"}},c=e=>{switch(e){case"enemy_action":return t.jsx(qe,{className:"h-3 w-3 text-red-400 mr-2"});case"player_action":return t.jsx($e,{className:"h-3 w-3 text-blue-400 mr-2"});case"damage":return t.jsx(Ie,{className:"h-3 w-3 text-red-300 mr-2"});case"healing":return t.jsx(ft,{className:"h-3 w-3 text-green-300 mr-2"});case"level_up":return t.jsx("span",{className:"mr-2",children:"🌟"});case"equipment":return t.jsx("span",{className:"mr-2",children:"⚔️"});case"skill_xp":return t.jsx("span",{className:"mr-2",children:"📈"});case"lore":return t.jsx("span",{className:"mr-2",children:"📜"});default:return null}},d=e=>{switch(e){case"system":return"Sistema";case"battle":return"Batalha";case"lore":return"História";case"skill_xp":return"XP de Habilidade";case"level_up":return"Level Up";case"equipment":return"Equipamentos";case"enemy_action":return"Ações do Inimigo";case"player_action":return"Ações do Jogador";case"damage":return"Dano";case"healing":return"Cura";default:return e}},m=e=>{let t=e.text;if(t.includes("causou")&&t.includes("de dano")){const e=t.match(/(\d+)\s+de dano/);if(e){const s=e[1];t=t.replace(`${s} de dano`,`**${s}** de dano`)}}if(t.includes("recuperou")&&t.includes("HP")){const e=t.match(/(\d+)\s+HP/);if(e){const s=e[1];t=t.replace(`${s} HP`,`**${s}** HP`)}}return t};return t.jsxs(rh,{className:"mt-6",children:[t.jsxs(nh,{className:"pb-2 flex flex-row items-center justify-between",children:[t.jsxs(ih,{className:"text-lg flex items-center gap-2",children:[t.jsx(fs,{className:"h-5 w-5"}),"Log de Batalha"]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsxs("span",{className:"text-sm text-muted-foreground",children:[o.length,"/",s.length]}),t.jsxs(Ef,{children:[t.jsx(Sf,{asChild:!0,children:t.jsx(Da,{variant:"outline",size:"sm",className:"h-8 w-8 p-0",children:t.jsx(Et,{className:"h-4 w-4"})})}),t.jsx(kf,{className:"w-80",align:"end",children:t.jsxs("div",{className:"space-y-3",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("h4",{className:"font-medium",children:"Filtros do Log"}),t.jsxs("div",{className:"flex gap-1",children:[t.jsxs(Da,{variant:"ghost",size:"sm",onClick:()=>i(!0),className:"h-6 px-2 text-xs",children:[t.jsx(qt,{className:"h-3 w-3 mr-1"}),"Todos"]}),t.jsxs(Da,{variant:"ghost",size:"sm",onClick:()=>i(!1),className:"h-6 px-2 text-xs",children:[t.jsx(gs,{className:"h-3 w-3 mr-1"}),"Nenhum"]})]})]}),t.jsx("div",{className:"grid grid-cols-2 gap-2",children:Object.entries(r).map((([e,s])=>t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(Hf,{id:e,checked:s,onCheckedChange:t=>((e,t)=>{n((s=>({...s,[e]:t})))})(e,!!t)}),t.jsx("label",{htmlFor:e,className:`text-xs font-medium cursor-pointer ${l(e)}`,children:d(e)})]},e)))})]})})]})]})]}),t.jsx(lh,{children:t.jsx(Pp,{ref:a,className:"h-56 rounded border p-3 bg-card/50 backdrop-blur-sm",children:0===o.length?t.jsx("div",{className:"flex items-center justify-center h-full text-muted-foreground",children:t.jsxs("div",{className:"text-center",children:[t.jsx(fs,{className:"h-8 w-8 mx-auto mb-2 opacity-50"}),t.jsx("p",{className:"text-sm",children:0===s.length?"Nenhum evento ainda":"Nenhum evento corresponde aos filtros"})]})}):t.jsx("div",{className:"space-y-2",children:o.map(((e,s)=>t.jsxs("div",{className:`flex items-start text-sm leading-relaxed ${l(e.type)} transition-all duration-200 hover:bg-muted/20 rounded p-2 -m-2`,children:[c(e.type),t.jsx("span",{className:"flex-1",dangerouslySetInnerHTML:{__html:m(e).replace(/\*\*(.+?)\*\*/g,'<strong class="text-yellow-300">$1</strong>')}}),t.jsx("span",{className:"text-xs text-muted-foreground/60 ml-2 flex-shrink-0",children:(new Date).toLocaleTimeString("pt-BR",{hour:"2-digit",minute:"2-digit",second:"2-digit"})})]},`${s}-${e.text.substring(0,20)}`)))})})})]})}Hf.displayName=If.displayName;const Wf=e=>{switch(e.effect_type){case"damage":return t.jsx(Gt,{className:"w-3 h-3"});case"heal":return t.jsx(Ue,{className:"w-3 h-3"});case"buff":return t.jsx(ft,{className:"w-3 h-3"});case"debuff":return t.jsx(Xt,{className:"w-3 h-3"});default:return t.jsx(Ie,{className:"w-3 h-3"})}},Xf=e=>{switch(e.effect_type){case"damage":return"bg-red-500/20 hover:bg-red-500/30 border-red-500/50";case"heal":return"bg-green-500/20 hover:bg-green-500/30 border-green-500/50";case"buff":return"bg-blue-500/20 hover:bg-blue-500/30 border-blue-500/50";case"debuff":return"bg-purple-500/20 hover:bg-purple-500/30 border-purple-500/50";default:return"bg-slate-500/20 hover:bg-slate-500/30 border-slate-500/50"}};function Yf({handleAction:e,isPlayerTurn:s,loading:a,player:r,potionSlots:n,loadingPotionSlots:i}){const o=r.spells?.slice(0,3)||[],l=!s||a.performAction;return t.jsxs("div",{className:"quick-action-panel flex flex-col gap-1 p-2 bg-slate-900/40 rounded-lg border border-slate-700/50 w-16 shadow-lg",children:[t.jsxs("div",{className:"flex flex-col gap-1",children:[t.jsxs("div",{className:"relative",children:[t.jsx(Da,{variant:"outline",size:"sm",onClick:()=>e("attack"),disabled:l,className:"quick-action-button w-12 h-12 p-0 bg-red-500/20 hover:bg-red-500/30 border-red-500/50 text-red-400 transition-all duration-150 cursor-pointer",title:"Atacar (A)",children:t.jsx(qe,{className:"w-4 h-4"})}),t.jsx("span",{className:"absolute -top-1 -left-1 bg-slate-800 text-white text-xs rounded-full w-4 h-4 flex items-center justify-center border border-slate-600",children:"A"})]}),t.jsxs("div",{className:"relative",children:[t.jsxs(Da,{variant:"outline",size:"sm",onClick:()=>e("defend"),disabled:l||r.defenseCooldown>0,className:"quick-action-button w-12 h-12 p-0 bg-blue-500/20 hover:bg-blue-500/30 border-blue-500/50 text-blue-400 transition-all duration-150 relative cursor-pointer "+(r.defenseCooldown>0?"opacity-50":""),title:"Defender (S)"+(r.defenseCooldown>0?` - Cooldown: ${r.defenseCooldown}`:""),children:[t.jsx($e,{className:"w-4 h-4"}),r.defenseCooldown>0&&t.jsx("span",{className:"absolute -top-1 -right-1 bg-blue-600 text-white text-xs rounded-full w-4 h-4 flex items-center justify-center",children:r.defenseCooldown})]}),t.jsx("span",{className:"absolute -top-1 -left-1 bg-slate-800 text-white text-xs rounded-full w-4 h-4 flex items-center justify-center border border-slate-600",children:"S"})]}),t.jsxs("div",{className:"relative",children:[t.jsx(Da,{variant:"outline",size:"sm",onClick:()=>e("flee"),disabled:l,className:"quick-action-button w-12 h-12 p-0 bg-yellow-500/20 hover:bg-yellow-500/30 border-yellow-500/50 text-yellow-400 transition-all duration-150 cursor-pointer",title:"Fugir (D)",children:t.jsx(Te,{className:"w-4 h-4"})}),t.jsx("span",{className:"absolute -top-1 -left-1 bg-slate-800 text-white text-xs rounded-full w-4 h-4 flex items-center justify-center border border-slate-600",children:"D"})]})]}),t.jsx("div",{className:"h-px bg-slate-700/50 my-1"}),t.jsx("div",{className:"flex flex-col gap-1",children:o.map(((s,a)=>{const n=r.mana>=s.mana_cost&&0===s.current_cooldown;return t.jsxs("div",{className:"relative",children:[t.jsxs(Da,{variant:"outline",size:"sm",onClick:()=>e("spell",s.id),disabled:l||!n,className:`quick-action-button w-12 h-12 p-0 ${Xf(s)} relative transition-all duration-150 cursor-pointer ${n?"":"opacity-50"}`,title:`${s.name} (${1+a}) - ${s.mana_cost} Mana${s.current_cooldown>0?` - Cooldown: ${s.current_cooldown}`:r.mana<s.mana_cost?" - Mana insuficiente":""}`,children:[Wf(s),s.current_cooldown>0&&t.jsx("span",{className:"absolute -top-1 -right-1 bg-red-600 text-white text-xs rounded-full w-4 h-4 flex items-center justify-center",children:s.current_cooldown}),t.jsx("span",{className:"absolute -bottom-1 -right-1 text-white text-xs rounded-full w-4 h-4 flex items-center justify-center "+(r.mana>=s.mana_cost?"bg-blue-600":"bg-red-600"),children:s.mana_cost})]}),t.jsx("span",{className:"absolute -top-1 -left-1 bg-slate-800 text-white text-xs rounded-full w-4 h-4 flex items-center justify-center border border-slate-600",children:1+a})]},s.id)}))}),n.length>0&&t.jsx("div",{className:"h-px bg-slate-700/50 my-1"}),t.jsx("div",{className:"flex flex-col gap-1",children:i?[1,2,3].map((e=>t.jsx("div",{className:"w-12 h-12 bg-muted/20 rounded-lg animate-pulse"},e))):n.map((s=>{const a=!s.consumable_id,n=(e=>{switch(e){case 1:return"Q";case 2:return"W";case 3:return"E";default:return""}})(s.slot_position),i=s.available_quantity,o=!a&&0===i;return t.jsxs("div",{className:"relative",children:[t.jsxs(Da,{variant:"outline",size:"sm",onClick:()=>e("consumable",s.consumable_id||void 0),disabled:l||r.potionUsedThisTurn||a||o,className:"quick-action-button w-12 h-12 p-2 relative transition-all duration-150 cursor-pointer "+(a?"border-dashed border-muted-foreground/20 bg-transparent hover:bg-muted/10":o?"border-red-500/30 bg-red-500/5 opacity-50":r.potionUsedThisTurn?"border-orange-500/30 bg-orange-500/5 opacity-50":"border-green-500/30 bg-green-500/20 hover:bg-green-500/30 text-green-400"),title:a?`Slot ${n} - Vazio`:o?`${s.consumable_name} - Sem unidades`:`${s.consumable_name} (${n}) - ${s.effect_value} HP${r.potionUsedThisTurn?" - Já usou poção neste turno":""}`,children:[a?t.jsx(Ze,{className:"w-4 h-4 text-muted-foreground/40"}):s.consumable_id?t.jsx(kx,{consumable:{id:s.consumable_id,name:s.consumable_name||"Poção",description:s.consumable_description||"",type:s.consumable_type||"potion",effect_value:s.effect_value||0,price:s.consumable_price||0,level_requirement:1,created_at:"",updated_at:""},size:"lg",className:"w-4 h-4",showFallback:!0}):null,(r.potionUsedThisTurn||o)&&!a&&t.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-orange-500/30 rounded-lg",children:t.jsx("span",{className:"text-orange-400 text-xs font-bold",children:"✗"})})]}),!a&&t.jsx("span",{className:"absolute -bottom-1 -left-1 text-white text-xs rounded-full w-4 h-4 flex items-center justify-center border border-background "+(o?"bg-red-500/90":"bg-slate-800"),children:i}),t.jsx("span",{className:"absolute -top-1 -left-1 bg-slate-800 text-white text-xs rounded-full w-4 h-4 flex items-center justify-center border border-slate-600",children:n})]},`slot-${s.slot_position}`)}))})]})}const Kf=({isVisible:s,isSuccess:a,playerName:r,enemyName:n,onComplete:i})=>{const[o,l]=e.useState(!1),[c,d]=e.useState(0);if(e.useEffect((()=>(l(!0),()=>l(!1))),[]),e.useEffect((()=>{if(!s)return;const e=setInterval((()=>{d((e=>{const t=a?2.5:3.3;return Math.min(e+t,100)}))}),50),t=setTimeout((()=>{i()}),a?3e3:2500);return()=>{clearInterval(e),clearTimeout(t)}}),[s,a,r,n,i]),!o||!s)return null;const m=a?{emoji:"🏃‍♂️",title:"Fuga Bem-Sucedida!",subtitle:"Redirecionando para o hub...",description:n?`${r} conseguiu fugir de ${n}!`:`${r} conseguiu escapar!`,bgColor:"bg-gradient-to-r from-green-500/20 via-emerald-500/20 to-teal-500/20",borderColor:"border-green-500/30",textColor:"text-green-400",accentColor:"border-green-400"}:{emoji:"⚔️",title:"Fuga Falhou!",subtitle:"Prepare-se para o contra-ataque...",description:n?`${n} impediu a fuga de ${r}!`:`O inimigo impediu a fuga de ${r}!`,bgColor:"bg-gradient-to-r from-red-500/20 via-orange-500/20 to-yellow-500/20",borderColor:"border-red-500/30",textColor:"text-red-400",accentColor:"border-red-400"};return t.jsxs("div",{className:"fixed inset-0 backdrop-blur-md z-50 flex items-center justify-center",children:[t.jsx("div",{className:"absolute inset-0 bg-black/40"}),t.jsxs("div",{className:`relative ${m.bgColor} border ${m.borderColor} rounded-2xl p-8 shadow-2xl max-w-md mx-4 transform transition-all duration-500 animate-in zoom-in-95 fade-in-0`,children:[t.jsxs("div",{className:"text-center space-y-4",children:[t.jsx("div",{className:`text-6xl ${a?"animate-bounce":"animate-pulse"} transition-all duration-300`,children:m.emoji}),t.jsx("div",{className:`font-bold text-2xl ${m.textColor}`,children:m.title}),t.jsx("div",{className:"text-muted-foreground text-base",children:m.subtitle}),t.jsx("div",{className:"w-full bg-background/30 rounded-full h-2 overflow-hidden",children:t.jsx("div",{className:"h-full transition-all duration-150 ease-out "+(a?"bg-green-400":"bg-red-400"),style:{width:`${c}%`}})}),t.jsx("div",{className:"text-sm text-muted-foreground/90 leading-relaxed px-2",children:m.description}),t.jsxs("div",{className:"flex items-center justify-center gap-3 pt-2",children:[t.jsx("div",{className:`animate-spin rounded-full h-5 w-5 border-2 border-t-transparent ${m.accentColor}`}),t.jsx("span",{className:`text-sm font-medium ${m.textColor}`,children:a?"Redirecionando...":"Retornando..."})]})]}),t.jsx("div",{className:`absolute inset-0 rounded-2xl border-2 ${m.borderColor} animate-pulse pointer-events-none`})]})]})};function Jf(){const a=i(),{user:r}=aa(),{gameState:n,performAction:o,loading:l,initializeBattle:c,addGameLogMessage:d,updatePlayerStats:m,gameLog:u}=Tp(),{player:h,currentEnemy:p,currentFloor:f,isPlayerTurn:g}=n,[b,v]=e.useState(!1),[y,j]=e.useState(!1),[N,w]=e.useState(!1),[C,E]=e.useState(!1),[S,k]=e.useState(!1),[P,A]=e.useState(!0),[M,T]=e.useState(!1),[R,D]=e.useState(null),[q,$]=e.useState({xp:0,gold:0,drops:[],leveledUp:!1,newLevel:0}),[I,L]=e.useState({step:"init",progress:0,message:"Preparando..."}),[V,F]=e.useState(0),[O]=e.useState(5),[z,B]=e.useState(!1),[U,H]=e.useState([]),[G,W]=e.useState(!0),X=e.useRef(!1),Y=e.useRef(!1),K=e.useRef(!1),J=e.useRef(null),Z=e.useRef(null),Q=e.useRef(0),{character:ee}=x({from:"/_authenticated/game/play/hub/battle/$character"}),te=e.useCallback((async()=>{if(h.id&&!X.current&&!G)try{W(!0);const e=await Cx.getCharacterPotionSlots(h.id);if(e.success&&e.data)H(e.data),X.current=!0,e.error&&e.error.includes("fallback")&&_.warning("Slots de poção carregados em modo simplificado",{description:"Algumas funcionalidades podem estar limitadas",duration:3e3});else{const e=Array.from({length:3},((e,t)=>({slot_position:t+1,consumable_id:null,consumable_name:null,consumable_description:null,effect_value:null,consumable_type:null,available_quantity:0,consumable_price:null})));H(e),X.current=!0}}catch(e){const t=Array.from({length:3},((e,t)=>({slot_position:t+1,consumable_id:null,consumable_name:null,consumable_description:null,effect_value:null,consumable_type:null,available_quantity:0,consumable_price:null})));H(t),X.current=!0}finally{W(!1)}}),[h.id]),se=e.useCallback((async()=>{const e=Date.now();if(!(e-Q.current<5e3)&&r?.id&&ee&&K.current&&(!Y.current||J.current!==ee)){Q.current=e;try{A(!0),D(null),B(!1),F(0),Y.current=!0,J.current=ee;const e=await ta.getCharacter(ee);if(!e.success||!e.data)throw new Error(e.error||"Personagem não encontrado");const{BattleInitializationService:t}=await s((async()=>{const{BattleInitializationService:e}=await import("./battle-initialization.service-BghrgNc3.js");return{BattleInitializationService:e}}),__vite__mapDeps([0,1,2,3,4,5,6])),a=await t.initializeBattle(e.data,(e=>{L(e)}));if(!a.success)throw new Error(a.error||"Falha na inicialização robusta");if(!a.gameState)throw new Error("Estado de jogo não foi gerado");await c(e.data,ee),A(!1),D(null)}catch(t){Y.current=!1,J.current=null,Q.current=0;const e=t instanceof Error?t.message:"Erro desconhecido";D(e),B(!0)}}}),[r?.id,ee,c]),ae=e.useCallback((async()=>{Y.current=!1,J.current=null,Q.current=0,B(!1),await se()}),[]),re=e.useCallback((async()=>{try{const{BattleInitializationService:e}=await s((async()=>{const{BattleInitializationService:e}=await import("./battle-initialization.service-BghrgNc3.js");return{BattleInitializationService:e}}),__vite__mapDeps([0,1,2,3,4,5,6])),t=await e.healthCheck();return t.healthy||_.warning("Alguns serviços estão indisponíveis",{description:t.issues.join(", "),duration:5e3}),t.healthy}catch(e){return!1}}),[]),ne=e.useMemo((()=>({enemyHpPercentage:p&&p.maxHp>0?Math.max(0,Math.min(100,p.hp/p.maxHp*100)):0,playerHpPercentage:h.max_hp>0?Math.max(0,Math.min(100,h.hp/h.max_hp*100)):0,playerManaPercentage:h.max_mana>0?Math.max(0,Math.min(100,h.mana/h.max_mana*100)):0})),[p?.hp,p?.maxHp,h.hp,h.max_hp,h.mana,h.max_mana]);e.useEffect((()=>(K.current=!0,()=>{K.current=!1,Z.current&&(clearTimeout(Z.current),Z.current=null)})),[]),e.useEffect((()=>{if(!K.current||!r?.id||!ee||l.loadProgress)return;if(Y.current)return;const e=setTimeout((()=>{K.current&&!Y.current&&se().catch((e=>{}))}),500);return()=>clearTimeout(e)}),[r?.id,ee]),e.useEffect((()=>{if(!n.battleRewards||b)return;if(!n.battleRewards.xp&&!n.battleRewards.gold)return;const e=n.battleRewards;$({xp:e.xp,gold:e.gold,drops:e.drops||[],leveledUp:e.leveledUp,newLevel:e.newLevel}),v(!0),d(`Vitória! Você derrotou o inimigo e recebeu ${e.xp} XP e ${e.gold} Gold.`,"system"),e.leveledUp&&e.newLevel&&d(`Você subiu para o nível ${e.newLevel}!`,"system")}),[n.battleRewards,b,d]),e.useEffect((()=>{"gameover"===n.mode&&h.hp<=0&&!y&&(j(!0),n.characterDeleted&&d(`${h.name} foi perdido permanentemente. O sistema de Permadeath está ativo.`,"system"))}),[n.mode,h.hp,n.characterDeleted,y,d]),e.useEffect((()=>{if(("fled"===n.mode||!0===n.fleeSuccessful)&&!C){const e="fled"===n.mode||!0===n.fleeSuccessful;k(e),E(!0)}}),[n.mode,n.fleeSuccessful,C]),e.useEffect((()=>{const e=()=>{const e=window.innerWidth<=768,t=window.innerHeight>window.innerWidth;T(e&&t)};return e(),window.addEventListener("resize",e),window.addEventListener("orientationchange",e),()=>{window.removeEventListener("resize",e),window.removeEventListener("orientationchange",e)}}),[]),e.useEffect((()=>{const e=()=>w(!0);return window.addEventListener("openAttributeModal",e),()=>window.removeEventListener("openAttributeModal",e)}),[]);const ie=e.useCallback((async(e,t,s)=>{try{await o(e,t,s)}catch(a){_.error(`Erro ao executar ação: ${e}`)}}),[o]),oe=e.useCallback(((e,t)=>{m(e,t),n.player.id&&ta.updateCharacterHpMana(n.player.id,e,t).then((e=>{e.success||_.error("Erro ao atualizar status do personagem")})).catch((e=>{_.error("Erro ao atualizar status do personagem")}))}),[m,n.player.id]),le=e.useCallback((async()=>{v(!1);try{await ie("continue")}catch(e){_.error("Erro ao avançar para o próximo andar"),v(!0)}}),[ie]),ce=e.useCallback((()=>{a({to:"/game/play/hub",search:{character:n.player.id}})}),[a,n.player.id]),de=e.useCallback((()=>{a({to:"/game/play"})}),[a]),me=e.useCallback((()=>{w(!0),v(!1)}),[]),ue=e.useCallback((async()=>{if(E(!1),S){_.success("Fuga bem-sucedida!",{description:"Retornando ao hub...",duration:2e3});try{await ta.updateCharacterFloor(n.player.id,1)}catch(e){}a({to:"/game/play/hub",search:{character:n.player.id}})}else _.warning("Fuga falhou!",{description:"Prepare-se para o contra-ataque...",duration:3e3})}),[S,n.player.id,a]);return e.useEffect((()=>{if(h.id&&!X.current){const e=setTimeout((()=>{K.current&&!X.current&&te().catch((e=>{W(!1)}))}),1e3);return()=>clearTimeout(e)}}),[h.id]),z&&R?t.jsx("div",{className:"min-h-screen flex flex-col items-center justify-center bg-gradient-to-b from-background to-secondary p-4",children:t.jsxs("div",{className:"text-center max-w-lg",children:[t.jsx("div",{className:"text-destructive text-6xl mb-4",children:"⚠️"}),t.jsx("h2",{className:"text-2xl font-bold mb-4",children:"Falha na Inicialização da Batalha"}),t.jsxs("div",{className:"bg-card rounded-lg p-4 mb-6 text-left",children:[t.jsx("h3",{className:"font-semibold mb-2",children:"Detalhes do Erro:"}),t.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:R}),t.jsxs("div",{className:"space-y-2",children:[t.jsxs("div",{className:"flex justify-between text-sm",children:[t.jsx("span",{children:"Tentativas realizadas:"}),t.jsxs("span",{children:[V,"/",O]})]}),t.jsxs("div",{className:"flex justify-between text-sm",children:[t.jsx("span",{children:"Última etapa:"}),t.jsx("span",{children:I.step})]})]})]}),t.jsxs("div",{className:"space-y-3",children:[t.jsx(Da,{onClick:ae,className:"w-full",size:"lg",children:"🔄 Tentar Novamente"}),t.jsx(Da,{onClick:re,variant:"outline",className:"w-full",children:"🏥 Verificar Sistema"}),t.jsx(Da,{onClick:()=>a({to:"/game/play"}),variant:"secondary",className:"w-full",children:"🏠 Voltar ao Hub"})]}),t.jsx("p",{className:"text-xs text-muted-foreground mt-4",children:"Se o problema persistir, verifique sua conexão com a internet"})]})}):P||!Y.current?t.jsx("div",{className:"min-h-screen flex flex-col items-center justify-center bg-gradient-to-b from-background to-secondary p-4",children:t.jsxs("div",{className:"text-center max-w-md",children:[t.jsx("div",{className:"inline-block animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-primary mb-4"}),t.jsx("h2",{className:"text-2xl font-bold mb-2",children:"Inicializando Batalha"}),t.jsxs("div",{className:"bg-card rounded-lg p-4 mb-4",children:[t.jsxs("div",{className:"mb-2",children:[t.jsxs("div",{className:"flex justify-between text-sm mb-1",children:[t.jsx("span",{children:I.message}),t.jsxs("span",{children:[I.progress,"%"]})]}),t.jsx("div",{className:"w-full bg-secondary rounded-full h-2",children:t.jsx("div",{className:"bg-primary h-2 rounded-full transition-all duration-300",style:{width:`${I.progress}%`}})})]}),V>0&&t.jsxs("p",{className:"text-sm text-muted-foreground",children:["Tentativa ",V,"/",O]})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsx(Da,{onClick:()=>B(!0),variant:"outline",size:"sm",disabled:0===V,children:"Mostrar Detalhes"}),t.jsx(Da,{onClick:()=>a({to:"/game/play"}),variant:"ghost",size:"sm",children:"Cancelar e Voltar"})]})]})}):t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"w-full max-w-6xl",children:[t.jsx(ef,{currentFloor:{floorNumber:h.floor,type:f?.type||"common",description:f?.description||`Andar ${h.floor}`,isCheckpoint:f?.isCheckpoint||!1,minLevel:f?.minLevel||1},playerLevel:h.level}),t.jsxs("div",{className:"mb-6 relative",children:[!M&&t.jsx("div",{className:"absolute left-0 top-1/2 transform -translate-y-1/2 -translate-x-20 z-10 hidden lg:block",children:t.jsx(Yf,{handleAction:ie,isPlayerTurn:g,loading:l,player:h,potionSlots:U,loadingPotionSlots:G})}),!M&&t.jsx("div",{className:"fixed bottom-4 left-4 z-20 block lg:hidden",children:t.jsx(Yf,{handleAction:ie,isPlayerTurn:g,loading:l,player:h,potionSlots:U,loadingPotionSlots:G})}),t.jsx(Yx,{player:h,currentEnemy:p||{id:"placeholder",name:n.battleRewards?"Inimigo derrotado!":"Preparando próximo inimigo...",level:1,hp:0,maxHp:1,attack:0,defense:0,speed:1,image:n.battleRewards?"💀":"⏳",behavior:"balanced",mana:0,reward_xp:0,reward_gold:0,possible_drops:[],active_effects:{buffs:[],debuffs:[],dots:[],hots:[],attribute_modifications:[]}},playerHpPercentage:ne.playerHpPercentage,playerManaPercentage:ne.playerManaPercentage,enemyHpPercentage:ne.enemyHpPercentage,isPlayerTurn:g})]}),t.jsx("div",{className:"mb-6",children:t.jsx(Kx,{handleAction:ie,isPlayerTurn:g,loading:l,player:h,onPlayerStatsUpdate:oe,currentEnemy:p,battleRewards:n.battleRewards,potionSlots:U,loadingPotionSlots:G,onSlotsChange:te})}),t.jsx(Gf,{gameLog:u})]}),t.jsx(Jx,{isOpen:b,onContinue:le,onReturnToHub:ce,onOpenAttributeModal:me,rewards:q,leveledUp:q.leveledUp,newLevel:q.newLevel,hasAttributePoints:(h.attribute_points||0)>0}),t.jsx(Zx,{isOpen:y,onClose:()=>j(!1),player:{id:h.id,name:h.name,level:h.level,floor:h.floor,hp:h.hp,max_hp:h.max_hp,xp:h.xp,gold:h.gold},gameMessage:`${h.name} foi derrotado no Andar ${h.floor}...`,highestFloor:h.floor,isCharacterDeleted:n.characterDeleted,userId:r?.id,onReturnToCharacterSelect:de,onViewCemetery:()=>{a({to:"/game/play/hub/cemetery",search:{character:h.id}})}}),t.jsx(Qx,{isOpen:N,onClose:()=>{w(!1),n.battleRewards&&!b&&v(!0)},character:h}),C&&t.jsx("div",{className:"fixed inset-0 z-50",children:t.jsx(Kf,{isVisible:C,isSuccess:S,playerName:h.name,enemyName:p?.name,onComplete:ue})})]})}const Zf=d("/_authenticated/game/play/hub/battle/$character")({component:function(){const s=i(),{character:a}=Zf.useParams(),{loading:r}=Tp(),[n,o]=e.useState(!0),l=e.useRef(!1),c=e.useRef(!1),d=e.useMemo((()=>({isGameLoading:r.loadProgress,shouldShowLoading:n||r.loadProgress})),[r.loadProgress,n]);return e.useEffect((()=>(c.current=!0,()=>{c.current=!1,l.current=!1})),[]),e.useEffect((()=>{if(!c.current)return;const e=d.isGameLoading;if(!e&&n){const e=setTimeout((()=>{c.current&&o(!1)}),100);return()=>clearTimeout(e)}e&&!n&&o(!0)}),[d.isGameLoading,n]),e.useEffect((()=>{c.current&&!l.current&&(a?l.current=!0:(l.current=!0,_.error("Personagem não especificado",{description:"Redirecionando para a seleção de personagens"}),s({to:"/game/play"})))}),[a,s]),d.shouldShowLoading?t.jsx("div",{className:"min-h-screen flex flex-col items-center justify-center bg-gradient-to-b from-background to-secondary p-4",children:t.jsxs("div",{className:"w-full max-w-6xl",children:[t.jsxs("div",{className:"text-center mb-8",children:[t.jsx("div",{className:"h-8 w-64 bg-muted/50 animate-pulse rounded mx-auto mb-4"}),t.jsx("div",{className:"h-4 w-48 bg-muted/30 animate-pulse rounded mx-auto"})]}),t.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6 mb-6",children:[1,2,3].map((e=>t.jsxs("div",{className:"bg-card rounded-lg overflow-hidden shadow animate-pulse",children:[t.jsx("div",{className:"p-4 bg-muted/20",children:t.jsx("div",{className:"h-6 bg-muted/40 rounded w-24 mx-auto"})}),t.jsxs("div",{className:"p-6",children:[t.jsx("div",{className:"aspect-square bg-muted/30 rounded-md mb-4"}),t.jsxs("div",{className:"space-y-3",children:[t.jsx("div",{className:"h-4 bg-muted/40 rounded w-full"}),t.jsx("div",{className:"h-2 bg-muted/30 rounded w-full"}),t.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[t.jsx("div",{className:"h-8 bg-muted/20 rounded"}),t.jsx("div",{className:"h-8 bg-muted/20 rounded"})]})]})]})]},e)))}),t.jsxs("div",{className:"bg-card rounded-lg p-4 animate-pulse",children:[t.jsx("div",{className:"h-6 bg-muted/40 rounded w-32 mx-auto mb-4"}),t.jsxs("div",{className:"flex gap-2 justify-center",children:[t.jsx("div",{className:"h-10 bg-muted/30 rounded w-24"}),t.jsx("div",{className:"h-10 bg-muted/30 rounded w-24"}),t.jsx("div",{className:"h-10 bg-muted/30 rounded w-24"})]})]})]})}):t.jsx("div",{className:"min-h-screen flex flex-col items-center justify-center bg-gradient-to-b from-background to-secondary p-4",children:t.jsx(Jf,{})})}}),Qf=Fa.update({id:"/_public",getParentRoute:()=>Sa}),eg=tr.update({id:"/_authenticated",getParentRoute:()=>Sa}),tg=ar.update({id:"/",path:"/",getParentRoute:()=>Sa}),sg=rr.update({id:"/logout",path:"/logout",getParentRoute:()=>Qf}),ag=Bu.update({id:"/auth",path:"/auth",getParentRoute:()=>Qf}),rg=ph.update({id:"/users",path:"/users",getParentRoute:()=>eg}),ng=$h.update({id:"/profile",path:"/profile",getParentRoute:()=>eg}),ig=Lh.update({id:"/game",path:"/game",getParentRoute:()=>eg}),og=Fh.update({id:"/403",path:"/403",getParentRoute:()=>eg}),lg=Oh.update({id:"/verify-email",path:"/verify-email",getParentRoute:()=>ag}),cg=Uh.update({id:"/$id",path:"/$id",getParentRoute:()=>rg}),dg=Yh.update({id:"/ranking",path:"/ranking",getParentRoute:()=>ig}),mg=wp.update({id:"/play",path:"/play",getParentRoute:()=>ig}),ug=Mp.update({id:"/guide",path:"/guide",getParentRoute:()=>ig}),hg=Bp.update({id:"/hub",path:"/hub",getParentRoute:()=>mg}),pg=Gp.update({id:"/spells",path:"/spells",getParentRoute:()=>hg}),xg=_x.update({id:"/shop",path:"/shop",getParentRoute:()=>hg}),fg=Mx.update({id:"/inventory",path:"/inventory",getParentRoute:()=>hg}),gg=Dx.update({id:"/equipment",path:"/equipment",getParentRoute:()=>hg}),bg=Lx.update({id:"/crafting",path:"/crafting",getParentRoute:()=>hg}),vg=zx.update({id:"/character-stats",path:"/character-stats",getParentRoute:()=>hg}),yg=Ux.update({id:"/cemetery",path:"/cemetery",getParentRoute:()=>hg}),jg=Hx.update({id:"/select",path:"/select",getParentRoute:()=>gg}),Ng=Zf.update({id:"/battle/$character",path:"/battle/$character",getParentRoute:()=>hg}),wg={AuthenticatedGamePlayHubEquipmentSelectRoute:jg},_g={AuthenticatedGamePlayHubCemeteryRoute:yg,AuthenticatedGamePlayHubCharacterStatsRoute:vg,AuthenticatedGamePlayHubCraftingRoute:bg,AuthenticatedGamePlayHubEquipmentRoute:gg._addFileChildren(wg),AuthenticatedGamePlayHubInventoryRoute:fg,AuthenticatedGamePlayHubShopRoute:xg,AuthenticatedGamePlayHubSpellsRoute:pg,AuthenticatedGamePlayHubBattleCharacterRoute:Ng},Cg={AuthenticatedGamePlayHubRoute:hg._addFileChildren(_g)},Eg={AuthenticatedGameGuideRoute:ug,AuthenticatedGamePlayRoute:mg._addFileChildren(Cg),AuthenticatedGameRankingRoute:dg},Sg={AuthenticatedUsersIdRoute:cg},kg={Authenticated403Route:og,AuthenticatedGameRoute:ig._addFileChildren(Eg),AuthenticatedProfileRoute:ng,AuthenticatedUsersRoute:rg._addFileChildren(Sg)},Pg=eg._addFileChildren(kg),Ag={PublicAuthVerifyEmailRoute:lg},Mg={PublicAuthRoute:ag._addFileChildren(Ag),PublicLogoutRoute:sg},Tg={IndexRoute:tg,AuthenticatedRoute:Pg,PublicRoute:Qf._addFileChildren(Mg)},Rg=f({routeTree:Sa._addFileChildren(Tg)._addFileTypes()});"serviceWorker"in navigator&&window.addEventListener("load",(()=>{navigator.serviceWorker.register("/sw.js").then((e=>{e.addEventListener("updatefound",(()=>{const t=e.installing;t&&t.addEventListener("statechange",(()=>{"installed"===t.state&&navigator.serviceWorker.controller&&confirm("Nova versão disponível! Deseja atualizar?")&&(t.postMessage({type:"SKIP_WAITING"}),window.location.reload())}))})),setInterval((()=>{e.update()}),3e4)})).catch((e=>{})),navigator.serviceWorker.addEventListener("controllerchange",(()=>{window.location.reload()}))})),bs.createRoot(document.getElementById("root")).render(t.jsx(e.StrictMode,{children:t.jsx(g,{router:Rg})}));export{Da as B,ta as C,jr as I,la as M,da as S,rh as a,nh as b,ih as c,lh as d,Pp as e,uh as f,Xp as g,sa as h,ca as m,Ss as s};
