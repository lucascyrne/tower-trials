import{C as e,M as r}from"./main-BRzRyVm5.js";import{FloorService as a}from"./floor.service-r0yLIAYT.js";import"./unknown-BjZws6l5.js";import"./unknown-DE60C25c.js";import"./unknown-Chho9maJ.js";import"./unknown-CgHcGUJm.js";import"./unknown-CWUl0966.js";class o{static async initializeBattle(o,t){try{t?.({step:"character",progress:25,message:"Carregando personagem..."});const s=await e.getCharacterForGame(o.id);if(!s.success||!s.data)throw new Error(s.error||"Falha ao carregar personagem");const n=s.data;t?.({step:"floor",progress:50,message:`Carregando andar ${n.floor}...`});const c=await a.getFloorData(n.floor);if(!c)throw new Error(`Falha ao carregar andar ${n.floor}`);t?.({step:"event",progress:70,message:"Verificando eventos..."});const i=await a.checkForSpecialEvent(n.floor);let l=null;if(!i){t?.({step:"enemy",progress:85,message:"Gerando inimigo..."});const e=await r.getEnemyForFloor(n.floor);if(!e.success||!e.data)throw new Error(`Falha ao gerar inimigo para andar ${n.floor}`);l=e.data}t?.({step:"complete",progress:100,message:"Batalha pronta!"});return{success:!0,gameState:{mode:i?"special_event":"battle",player:{...n,isPlayerTurn:!0,isDefending:!1,potionUsedThisTurn:!1,defenseCooldown:Math.max(0,(n.defenseCooldown||0)-1)},currentFloor:c,currentEnemy:l,currentSpecialEvent:i,isPlayerTurn:!0,gameMessage:i?`Evento especial: ${i.name}!`:`Andar ${c.floorNumber}: ${l?.name} apareceu!`,highestFloor:Math.max(n.floor,c.floorNumber),selectedSpell:null,battleRewards:null,fleeSuccessful:!1,characterDeleted:!1}}}catch(s){return{success:!1,error:s instanceof Error?s.message:"Erro desconhecido"}}}static async healthCheck(){const o=[],t={};try{try{await r.getEnemyForFloor(1),t.monster=!0}catch{t.monster=!1,o.push("MonsterService indisponível")}try{await a.getFloorData(1),t.floor=!0}catch{t.floor=!1,o.push("FloorService indisponível")}try{await e.getUserCharacters("test-health-check"),t.character=!0}catch{t.character=!1,o.push("CharacterService indisponível")}return{healthy:0===o.length,issues:o,services:t}}catch{return{healthy:!1,issues:["Falha crítica no health check"],services:{}}}}}export{o as BattleInitializationService};
